import{r as p}from"./react-58122654.js";import{_ as G,k as V,a as P,p as re,r as H,d as ee,b as de,j as Ce,e as Te,f as Ie,g as fe,h as Ae,i as ge,c as B}from"./@babel-ee6b9e1a.js";import{w as j,l as Ue,m as Le,t as We}from"./rc-util-852b41a6.js";import{S as je}from"./async-validator-1193b133.js";var K="RC_FORM_INTERNAL_HOOKS",k=function(){j(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},q=p.exports.createContext({getFieldValue:k,getFieldsValue:k,getFieldError:k,getFieldWarning:k,getFieldsError:k,isFieldsTouched:k,isFieldTouched:k,isFieldValidating:k,isFieldsValidating:k,resetFields:k,setFields:k,setFieldsValue:k,validateFields:k,submit:k,getInternalHooks:function(){return k(),{dispatch:k,initEntityValue:k,registerField:k,useSubscribe:k,setInitialValues:k,destroyForm:k,setCallbacks:k,registerWatch:k,getFields:k,setValidateMessages:k,setPreserve:k,getInitialValue:k}}});function ae(s){return s==null?[]:Array.isArray(s)?s:[s]}var S="'${name}' is not a valid ${type}",ke={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:S,method:S,array:S,object:S,number:S,date:S,boolean:S,integer:S,float:S,regexp:S,email:S,url:S,hex:S},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}};function te(s){return Array.isArray(s)?_e(s):G(s)==="object"&&s!==null?He(s):s}function He(s){if(Object.getPrototypeOf(s)===Object.prototype){var a={};for(var r in s)a[r]=te(s[r]);return a}return s}function _e(s){return s.map(function(a){return te(a)})}function M(s){return ae(s)}function W(s,a){var r=Ue(s,a);return r}function L(s,a,r){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,e=Le(s,a,r,t);return e}function ye(s,a){var r={};return a.forEach(function(t){var e=W(s,t);r=L(r,t,e)}),r}function Y(s,a){return s&&s.some(function(r){return Re(r,a)})}function Ve(s){return G(s)==="object"&&s!==null&&Object.getPrototypeOf(s)===Object.prototype}function xe(s,a){var r=Array.isArray(s)?V(s):P({},s);return a&&Object.keys(a).forEach(function(t){var e=r[t],n=a[t],o=Ve(e)&&Ve(n);r[t]=o?xe(e,n||{}):te(n)}),r}function Z(s){for(var a=arguments.length,r=new Array(a>1?a-1:0),t=1;t<a;t++)r[t-1]=arguments[t];return r.reduce(function(e,n){return xe(e,n)},s)}function Re(s,a){return!s||!a||s.length!==a.length?!1:s.every(function(r,t){return a[t]===r})}function De(s,a){if(s===a)return!0;if(!s&&a||s&&!a||!s||!a||G(s)!=="object"||G(a)!=="object")return!1;var r=Object.keys(s),t=Object.keys(a),e=new Set([].concat(V(r),V(t)));return V(e).every(function(n){var o=s[n],c=a[n];return typeof o=="function"&&typeof c=="function"?!0:o===c})}function Ke(s){var a=arguments.length<=1?void 0:arguments[1];return a&&a.target&&G(a.target)==="object"&&s in a.target?a.target[s]:a}function Pe(s,a,r){var t=s.length;if(a<0||a>=t||r<0||r>=t)return s;var e=s[a],n=a-r;return n>0?[].concat(V(s.slice(0,r)),[e],V(s.slice(r,a)),V(s.slice(a+1,t))):n<0?[].concat(V(s.slice(0,a)),V(s.slice(a+1,r+1)),[e],V(s.slice(r+1,t))):s}var ze=je;function Ge(s,a){return s.replace(/\$\{\w+\}/g,function(r){var t=r.slice(2,-1);return a[t]})}var Ee="CODE_LOGIC_ERROR";function se(s,a,r,t,e){return ue.apply(this,arguments)}function ue(){return ue=re(H.mark(function s(a,r,t,e,n){var o,c,l,i,u,f,d,y,F;return H.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return o=P({},t),delete o.ruleIndex,o.validator&&(c=o.validator,o.validator=function(){try{return c.apply(void 0,arguments)}catch(m){return console.error(m),Promise.reject(Ee)}}),l=null,o&&o.type==="array"&&o.defaultField&&(l=o.defaultField,delete o.defaultField),i=new ze(ee({},a,[o])),u=Z({},ke,e.validateMessages),i.messages(u),f=[],g.prev=9,g.next=12,Promise.resolve(i.validate(ee({},a,r),P({},e)));case 12:g.next=17;break;case 14:g.prev=14,g.t0=g.catch(9),g.t0.errors&&(f=g.t0.errors.map(function(m,h){var E=m.message,w=E===Ee?u.default:E;return p.exports.isValidElement(w)?p.exports.cloneElement(w,{key:"error_".concat(h)}):w}));case 17:if(!(!f.length&&l)){g.next=22;break}return g.next=20,Promise.all(r.map(function(m,h){return se("".concat(a,".").concat(h),m,l,e,n)}));case 20:return d=g.sent,g.abrupt("return",d.reduce(function(m,h){return[].concat(V(m),V(h))},[]));case 22:return y=P(P({},t),{},{name:a,enum:(t.enum||[]).join(", ")},n),F=f.map(function(m){return typeof m=="string"?Ge(m,y):m}),g.abrupt("return",F);case 25:case"end":return g.stop()}},s,null,[[9,14]])})),ue.apply(this,arguments)}function qe(s,a,r,t,e,n){var o=s.join("."),c=r.map(function(u,f){var d=u.validator,y=P(P({},u),{},{ruleIndex:f});return d&&(y.validator=function(F,v,g){var m=!1,h=function(){for(var C=arguments.length,b=new Array(C),$=0;$<C;$++)b[$]=arguments[$];Promise.resolve().then(function(){j(!m,"Your validator function has already return a promise. `callback` will be ignored."),m||g.apply(void 0,b)})},E=d(F,v,h);m=E&&typeof E.then=="function"&&typeof E.catch=="function",j(m,"`callback` is deprecated. Please return a promise instead."),m&&E.then(function(){g()}).catch(function(w){g(w||" ")})}),y}).sort(function(u,f){var d=u.warningOnly,y=u.ruleIndex,F=f.warningOnly,v=f.ruleIndex;return!!d==!!F?y-v:d?1:-1}),l;if(e===!0)l=new Promise(function(){var u=re(H.mark(function f(d,y){var F,v,g;return H.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:F=0;case 1:if(!(F<c.length)){h.next=12;break}return v=c[F],h.next=5,se(o,a,v,t,n);case 5:if(g=h.sent,!g.length){h.next=9;break}return y([{errors:g,rule:v}]),h.abrupt("return");case 9:F+=1,h.next=1;break;case 12:d([]);case 13:case"end":return h.stop()}},f)}));return function(f,d){return u.apply(this,arguments)}}());else{var i=c.map(function(u){return se(o,a,u,t,n).then(function(f){return{errors:f,rule:u}})});l=(e?Ye(i):Je(i)).then(function(u){return Promise.reject(u)})}return l.catch(function(u){return u}),l}function Je(s){return oe.apply(this,arguments)}function oe(){return oe=re(H.mark(function s(a){return H.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(a).then(function(e){var n,o=(n=[]).concat.apply(n,V(e));return o}));case 1:case"end":return t.stop()}},s)})),oe.apply(this,arguments)}function Ye(s){return le.apply(this,arguments)}function le(){return le=re(H.mark(function s(a){var r;return H.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0,e.abrupt("return",new Promise(function(n){a.forEach(function(o){o.then(function(c){c.errors.length&&n([c]),r+=1,r===a.length&&n([])})})}));case 2:case"end":return e.stop()}},s)})),le.apply(this,arguments)}var Be=["name"],T=[];function be(s,a,r,t,e,n){return typeof s=="function"?s(a,r,"source"in n?{source:n.source}:{}):t!==e}var ve=function(s){Te(r,s);var a=Ie(r);function r(t){var e;if(fe(this,r),e=a.call(this,t),e.state={resetCount:0},e.cancelRegisterFunc=null,e.mounted=!1,e.touched=!1,e.dirty=!1,e.validatePromise=null,e.prevValidating=void 0,e.errors=T,e.warnings=T,e.cancelRegister=function(){var l=e.props,i=l.preserve,u=l.isListField,f=l.name;e.cancelRegisterFunc&&e.cancelRegisterFunc(u,i,M(f)),e.cancelRegisterFunc=null},e.getNamePath=function(){var l=e.props,i=l.name,u=l.fieldContext,f=u.prefixName,d=f===void 0?[]:f;return i!==void 0?[].concat(V(d),V(i)):[]},e.getRules=function(){var l=e.props,i=l.rules,u=i===void 0?[]:i,f=l.fieldContext;return u.map(function(d){return typeof d=="function"?d(f):d})},e.refresh=function(){!e.mounted||e.setState(function(l){var i=l.resetCount;return{resetCount:i+1}})},e.triggerMetaEvent=function(l){var i=e.props.onMetaChange;i==null||i(P(P({},e.getMeta()),{},{destroy:l}))},e.onStoreChange=function(l,i,u){var f=e.props,d=f.shouldUpdate,y=f.dependencies,F=y===void 0?[]:y,v=f.onReset,g=u.store,m=e.getNamePath(),h=e.getValue(l),E=e.getValue(g),w=i&&Y(i,m);switch(u.type==="valueUpdate"&&u.source==="external"&&h!==E&&(e.touched=!0,e.dirty=!0,e.validatePromise=null,e.errors=T,e.warnings=T,e.triggerMetaEvent()),u.type){case"reset":if(!i||w){e.touched=!1,e.dirty=!1,e.validatePromise=null,e.errors=T,e.warnings=T,e.triggerMetaEvent(),v==null||v(),e.refresh();return}break;case"remove":{if(d){e.reRender();return}break}case"setField":{if(w){var C=u.data;"touched"in C&&(e.touched=C.touched),"validating"in C&&!("originRCField"in C)&&(e.validatePromise=C.validating?Promise.resolve([]):null),"errors"in C&&(e.errors=C.errors||T),"warnings"in C&&(e.warnings=C.warnings||T),e.dirty=!0,e.triggerMetaEvent(),e.reRender();return}if(d&&!m.length&&be(d,l,g,h,E,u)){e.reRender();return}break}case"dependenciesUpdate":{var b=F.map(M);if(b.some(function($){return Y(u.relatedFields,$)})){e.reRender();return}break}default:if(w||(!F.length||m.length||d)&&be(d,l,g,h,E,u)){e.reRender();return}break}d===!0&&e.reRender()},e.validateRules=function(l){var i=e.getNamePath(),u=e.getValue(),f=Promise.resolve().then(function(){if(!e.mounted)return[];var d=e.props,y=d.validateFirst,F=y===void 0?!1:y,v=d.messageVariables,g=l||{},m=g.triggerName,h=e.getRules();m&&(h=h.filter(function(w){var C=w.validateTrigger;if(!C)return!0;var b=ae(C);return b.includes(m)}));var E=qe(i,u,h,l,F,v);return E.catch(function(w){return w}).then(function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T;if(e.validatePromise===f){e.validatePromise=null;var C=[],b=[];w.forEach(function($){var R=$.rule.warningOnly,x=$.errors,N=x===void 0?T:x;R?b.push.apply(b,V(N)):C.push.apply(C,V(N))}),e.errors=C,e.warnings=b,e.triggerMetaEvent(),e.reRender()}}),E});return e.validatePromise=f,e.dirty=!0,e.errors=T,e.warnings=T,e.triggerMetaEvent(),e.reRender(),f},e.isFieldValidating=function(){return!!e.validatePromise},e.isFieldTouched=function(){return e.touched},e.isFieldDirty=function(){if(e.dirty||e.props.initialValue!==void 0)return!0;var l=e.props.fieldContext,i=l.getInternalHooks(K),u=i.getInitialValue;return u(e.getNamePath())!==void 0},e.getErrors=function(){return e.errors},e.getWarnings=function(){return e.warnings},e.isListField=function(){return e.props.isListField},e.isList=function(){return e.props.isList},e.isPreserve=function(){return e.props.preserve},e.getMeta=function(){e.prevValidating=e.isFieldValidating();var l={touched:e.isFieldTouched(),validating:e.prevValidating,errors:e.errors,warnings:e.warnings,name:e.getNamePath()};return l},e.getOnlyChild=function(l){if(typeof l=="function"){var i=e.getMeta();return P(P({},e.getOnlyChild(l(e.getControlled(),i,e.props.fieldContext))),{},{isFunction:!0})}var u=We(l);return u.length!==1||!p.exports.isValidElement(u[0])?{child:u,isFunction:!1}:{child:u[0],isFunction:!1}},e.getValue=function(l){var i=e.props.fieldContext.getFieldsValue,u=e.getNamePath();return W(l||i(!0),u)},e.getControlled=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=e.props,u=i.trigger,f=i.validateTrigger,d=i.getValueFromEvent,y=i.normalize,F=i.valuePropName,v=i.getValueProps,g=i.fieldContext,m=f!==void 0?f:g.validateTrigger,h=e.getNamePath(),E=g.getInternalHooks,w=g.getFieldsValue,C=E(K),b=C.dispatch,$=e.getValue(),R=v||function(O){return ee({},F,O)},x=l[u],N=P(P({},l),R($));N[u]=function(){e.touched=!0,e.dirty=!0,e.triggerMetaEvent();for(var O,_=arguments.length,I=new Array(_),U=0;U<_;U++)I[U]=arguments[U];d?O=d.apply(void 0,I):O=Ke.apply(void 0,[F].concat(I)),y&&(O=y(O,$,w(!0))),b({type:"updateValue",namePath:h,value:O}),x&&x.apply(void 0,I)};var J=ae(m||[]);return J.forEach(function(O){var _=N[O];N[O]=function(){_&&_.apply(void 0,arguments);var I=e.props.rules;I&&I.length&&b({type:"validateField",namePath:h,triggerName:O})}}),N},t.fieldContext){var n=t.fieldContext.getInternalHooks,o=n(K),c=o.initEntityValue;c(Ae(e))}return e}return ge(r,[{key:"componentDidMount",value:function(){var e=this.props,n=e.shouldUpdate,o=e.fieldContext;if(this.mounted=!0,o){var c=o.getInternalHooks,l=c(K),i=l.registerField;this.cancelRegisterFunc=i(this)}n===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){!this.mounted||this.forceUpdate()}},{key:"render",value:function(){var e=this.state.resetCount,n=this.props.children,o=this.getOnlyChild(n),c=o.child,l=o.isFunction,i;return l?i=c:p.exports.isValidElement(c)?i=p.exports.cloneElement(c,this.getControlled(c.props)):(j(!c,"`children` of Field is not validate ReactElement."),i=c),p.exports.createElement(p.exports.Fragment,{key:e},i)}}]),r}(p.exports.Component);ve.contextType=q;ve.defaultProps={trigger:"onChange",valuePropName:"value"};function $e(s){var a=s.name,r=de(s,Be),t=p.exports.useContext(q),e=a!==void 0?M(a):void 0,n="keep";return r.isListField||(n="_".concat((e||[]).join("_"))),p.exports.createElement(ve,Ce({key:n,name:e},r,{fieldContext:t}))}var Qe=p.exports.createContext(null),Xe=function(a){var r=a.name,t=a.initialValue,e=a.children,n=a.rules,o=a.validateTrigger,c=p.exports.useContext(q),l=p.exports.useRef({keys:[],id:0}),i=l.current,u=p.exports.useMemo(function(){var F=M(c.prefixName)||[];return[].concat(V(F),V(M(r)))},[c.prefixName,r]),f=p.exports.useMemo(function(){return P(P({},c),{},{prefixName:u})},[c,u]),d=p.exports.useMemo(function(){return{getKey:function(v){var g=u.length,m=v[g];return[i.keys[m],v.slice(g+1)]}}},[u]);if(typeof e!="function")return j(!1,"Form.List only accepts function as children."),null;var y=function(v,g,m){var h=m.source;return h==="internal"?!1:v!==g};return p.exports.createElement(Qe.Provider,{value:d},p.exports.createElement(q.Provider,{value:f},p.exports.createElement($e,{name:[],shouldUpdate:y,rules:n,validateTrigger:o,initialValue:t,isList:!0},function(F,v){var g=F.value,m=g===void 0?[]:g,h=F.onChange,E=c.getFieldValue,w=function(){var R=E(u||[]);return R||[]},C={add:function(R,x){var N=w();x>=0&&x<=N.length?(i.keys=[].concat(V(i.keys.slice(0,x)),[i.id],V(i.keys.slice(x))),h([].concat(V(N.slice(0,x)),[R],V(N.slice(x))))):(i.keys=[].concat(V(i.keys),[i.id]),h([].concat(V(N),[R]))),i.id+=1},remove:function(R){var x=w(),N=new Set(Array.isArray(R)?R:[R]);N.size<=0||(i.keys=i.keys.filter(function(J,O){return!N.has(O)}),h(x.filter(function(J,O){return!N.has(O)})))},move:function(R,x){if(R!==x){var N=w();R<0||R>=N.length||x<0||x>=N.length||(i.keys=Pe(i.keys,R,x),h(Pe(N,R,x)))}}},b=m||[];return Array.isArray(b)||(b=[]),e(b.map(function($,R){var x=i.keys[R];return x===void 0&&(i.keys[R]=i.id,x=i.keys[R],i.id+=1),{name:R,key:x,isListField:!0}}),C,v)})))};function Ze(s){var a=!1,r=s.length,t=[];return s.length?new Promise(function(e,n){s.forEach(function(o,c){o.catch(function(l){return a=!0,l}).then(function(l){r-=1,t[c]=l,!(r>0)&&(a&&n(t),e(t))})})}):Promise.resolve([])}var Ne="__@field_split__";function ie(s){return s.map(function(a){return"".concat(G(a),":").concat(a)}).join(Ne)}var z=function(){function s(){fe(this,s),this.kvs=new Map}return ge(s,[{key:"set",value:function(r,t){this.kvs.set(ie(r),t)}},{key:"get",value:function(r){return this.kvs.get(ie(r))}},{key:"update",value:function(r,t){var e=this.get(r),n=t(e);n?this.set(r,n):this.delete(r)}},{key:"delete",value:function(r){this.kvs.delete(ie(r))}},{key:"map",value:function(r){return V(this.kvs.entries()).map(function(t){var e=B(t,2),n=e[0],o=e[1],c=n.split(Ne);return r({key:c.map(function(l){var i=l.match(/^([^:]*):(.*)$/),u=B(i,3),f=u[1],d=u[2];return f==="number"?Number(d):d}),value:o})})}},{key:"toJSON",value:function(){var r={};return this.map(function(t){var e=t.key,n=t.value;return r[e.join(".")]=n,null}),r}}]),s}(),er=["name","errors"],rr=ge(function s(a){var r=this;fe(this,s),this.formHooked=!1,this.forceRootUpdate=void 0,this.subscribable=!0,this.store={},this.fieldEntities=[],this.initialValues={},this.callbacks={},this.validateMessages=null,this.preserve=null,this.lastValidatePromise=null,this.getForm=function(){return{getFieldValue:r.getFieldValue,getFieldsValue:r.getFieldsValue,getFieldError:r.getFieldError,getFieldWarning:r.getFieldWarning,getFieldsError:r.getFieldsError,isFieldsTouched:r.isFieldsTouched,isFieldTouched:r.isFieldTouched,isFieldValidating:r.isFieldValidating,isFieldsValidating:r.isFieldsValidating,resetFields:r.resetFields,setFields:r.setFields,setFieldsValue:r.setFieldsValue,validateFields:r.validateFields,submit:r.submit,_init:!0,getInternalHooks:r.getInternalHooks}},this.getInternalHooks=function(t){return t===K?(r.formHooked=!0,{dispatch:r.dispatch,initEntityValue:r.initEntityValue,registerField:r.registerField,useSubscribe:r.useSubscribe,setInitialValues:r.setInitialValues,destroyForm:r.destroyForm,setCallbacks:r.setCallbacks,setValidateMessages:r.setValidateMessages,getFields:r.getFields,setPreserve:r.setPreserve,getInitialValue:r.getInitialValue,registerWatch:r.registerWatch}):(j(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)},this.useSubscribe=function(t){r.subscribable=t},this.prevWithoutPreserves=null,this.setInitialValues=function(t,e){if(r.initialValues=t||{},e){var n,o=Z({},t,r.store);(n=r.prevWithoutPreserves)===null||n===void 0||n.map(function(c){var l=c.key;o=L(o,l,W(t,l))}),r.prevWithoutPreserves=null,r.updateStore(o)}},this.destroyForm=function(){var t=new z;r.getFieldEntities(!0).forEach(function(e){e.isPreserve()||t.set(e.getNamePath(),!0)}),r.prevWithoutPreserves=t},this.getInitialValue=function(t){var e=W(r.initialValues,t);return t.length?te(e):e},this.setCallbacks=function(t){r.callbacks=t},this.setValidateMessages=function(t){r.validateMessages=t},this.setPreserve=function(t){r.preserve=t},this.watchList=[],this.registerWatch=function(t){return r.watchList.push(t),function(){r.watchList=r.watchList.filter(function(e){return e!==t})}},this.notifyWatch=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(r.watchList.length){var e=r.getFieldsValue();r.watchList.forEach(function(n){n(e,t)})}},this.timeoutId=null,this.warningUnhooked=function(){},this.updateStore=function(t){r.store=t},this.getFieldEntities=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return t?r.fieldEntities.filter(function(e){return e.getNamePath().length}):r.fieldEntities},this.getFieldsMap=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=new z;return r.getFieldEntities(t).forEach(function(n){var o=n.getNamePath();e.set(o,n)}),e},this.getFieldEntitiesForNamePathList=function(t){if(!t)return r.getFieldEntities(!0);var e=r.getFieldsMap(!0);return t.map(function(n){var o=M(n);return e.get(o)||{INVALIDATE_NAME_PATH:M(n)}})},this.getFieldsValue=function(t,e){if(r.warningUnhooked(),t===!0&&!e)return r.store;var n=r.getFieldEntitiesForNamePathList(Array.isArray(t)?t:null),o=[];return n.forEach(function(c){var l,i="INVALIDATE_NAME_PATH"in c?c.INVALIDATE_NAME_PATH:c.getNamePath();if(!(!t&&((l=c.isListField)===null||l===void 0?void 0:l.call(c))))if(!e)o.push(i);else{var u="getMeta"in c?c.getMeta():null;e(u)&&o.push(i)}}),ye(r.store,o.map(M))},this.getFieldValue=function(t){r.warningUnhooked();var e=M(t);return W(r.store,e)},this.getFieldsError=function(t){r.warningUnhooked();var e=r.getFieldEntitiesForNamePathList(t);return e.map(function(n,o){return n&&!("INVALIDATE_NAME_PATH"in n)?{name:n.getNamePath(),errors:n.getErrors(),warnings:n.getWarnings()}:{name:M(t[o]),errors:[],warnings:[]}})},this.getFieldError=function(t){r.warningUnhooked();var e=M(t),n=r.getFieldsError([e])[0];return n.errors},this.getFieldWarning=function(t){r.warningUnhooked();var e=M(t),n=r.getFieldsError([e])[0];return n.warnings},this.isFieldsTouched=function(){r.warningUnhooked();for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var o=e[0],c=e[1],l,i=!1;e.length===0?l=null:e.length===1?Array.isArray(o)?(l=o.map(M),i=!1):(l=null,i=o):(l=o.map(M),i=c);var u=r.getFieldEntities(!0),f=function(g){return g.isFieldTouched()};if(!l)return i?u.every(f):u.some(f);var d=new z;l.forEach(function(v){d.set(v,[])}),u.forEach(function(v){var g=v.getNamePath();l.forEach(function(m){m.every(function(h,E){return g[E]===h})&&d.update(m,function(h){return[].concat(V(h),[v])})})});var y=function(g){return g.some(f)},F=d.map(function(v){var g=v.value;return g});return i?F.every(y):F.some(y)},this.isFieldTouched=function(t){return r.warningUnhooked(),r.isFieldsTouched([t])},this.isFieldsValidating=function(t){r.warningUnhooked();var e=r.getFieldEntities();if(!t)return e.some(function(o){return o.isFieldValidating()});var n=t.map(M);return e.some(function(o){var c=o.getNamePath();return Y(n,c)&&o.isFieldValidating()})},this.isFieldValidating=function(t){return r.warningUnhooked(),r.isFieldsValidating([t])},this.resetWithFieldInitialValue=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=new z,n=r.getFieldEntities(!0);n.forEach(function(l){var i=l.props.initialValue,u=l.getNamePath();if(i!==void 0){var f=e.get(u)||new Set;f.add({entity:l,value:i}),e.set(u,f)}});var o=function(i){i.forEach(function(u){var f=u.props.initialValue;if(f!==void 0){var d=u.getNamePath(),y=r.getInitialValue(d);if(y!==void 0)j(!1,"Form already set 'initialValues' with path '".concat(d.join("."),"'. Field can not overwrite it."));else{var F=e.get(d);if(F&&F.size>1)j(!1,"Multiple Field with path '".concat(d.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(F){var v=r.getFieldValue(d);(!t.skipExist||v===void 0)&&r.updateStore(L(r.store,d,V(F)[0].value))}}}})},c;t.entities?c=t.entities:t.namePathList?(c=[],t.namePathList.forEach(function(l){var i=e.get(l);if(i){var u;(u=c).push.apply(u,V(V(i).map(function(f){return f.entity})))}})):c=n,o(c)},this.resetFields=function(t){r.warningUnhooked();var e=r.store;if(!t){r.updateStore(Z({},r.initialValues)),r.resetWithFieldInitialValue(),r.notifyObservers(e,null,{type:"reset"}),r.notifyWatch();return}var n=t.map(M);n.forEach(function(o){var c=r.getInitialValue(o);r.updateStore(L(r.store,o,c))}),r.resetWithFieldInitialValue({namePathList:n}),r.notifyObservers(e,n,{type:"reset"}),r.notifyWatch(n)},this.setFields=function(t){r.warningUnhooked();var e=r.store,n=[];t.forEach(function(o){var c=o.name;o.errors;var l=de(o,er),i=M(c);n.push(i),"value"in l&&r.updateStore(L(r.store,i,l.value)),r.notifyObservers(e,[i],{type:"setField",data:o})}),r.notifyWatch(n)},this.getFields=function(){var t=r.getFieldEntities(!0),e=t.map(function(n){var o=n.getNamePath(),c=n.getMeta(),l=P(P({},c),{},{name:o,value:r.getFieldValue(o)});return Object.defineProperty(l,"originRCField",{value:!0}),l});return e},this.initEntityValue=function(t){var e=t.props.initialValue;if(e!==void 0){var n=t.getNamePath(),o=W(r.store,n);o===void 0&&r.updateStore(L(r.store,n,e))}},this.registerField=function(t){r.fieldEntities.push(t);var e=t.getNamePath();if(r.notifyWatch([e]),t.props.initialValue!==void 0){var n=r.store;r.resetWithFieldInitialValue({entities:[t],skipExist:!0}),r.notifyObservers(n,[t.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(o,c){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];r.fieldEntities=r.fieldEntities.filter(function(d){return d!==t});var i=c!==void 0?c:r.preserve;if(i===!1&&(!o||l.length>1)){var u=o?void 0:r.getInitialValue(e);if(e.length&&r.getFieldValue(e)!==u&&r.fieldEntities.every(function(d){return!Re(d.getNamePath(),e)})){var f=r.store;r.updateStore(L(f,e,u,!0)),r.notifyObservers(f,[e],{type:"remove"}),r.triggerDependenciesUpdate(f,e)}}r.notifyWatch([e])}},this.dispatch=function(t){switch(t.type){case"updateValue":{var e=t.namePath,n=t.value;r.updateValue(e,n);break}case"validateField":{var o=t.namePath,c=t.triggerName;r.validateFields([o],{triggerName:c});break}}},this.notifyObservers=function(t,e,n){if(r.subscribable){var o=P(P({},n),{},{store:r.getFieldsValue(!0)});r.getFieldEntities().forEach(function(c){var l=c.onStoreChange;l(t,e,o)})}else r.forceRootUpdate()},this.triggerDependenciesUpdate=function(t,e){var n=r.getDependencyChildrenFields(e);return n.length&&r.validateFields(n),r.notifyObservers(t,n,{type:"dependenciesUpdate",relatedFields:[e].concat(V(n))}),n},this.updateValue=function(t,e){var n=M(t),o=r.store;r.updateStore(L(r.store,n,e)),r.notifyObservers(o,[n],{type:"valueUpdate",source:"internal"}),r.notifyWatch([n]);var c=r.triggerDependenciesUpdate(o,n),l=r.callbacks.onValuesChange;if(l){var i=ye(r.store,[n]);l(i,r.getFieldsValue())}r.triggerOnFieldsChange([n].concat(V(c)))},this.setFieldsValue=function(t){r.warningUnhooked();var e=r.store;if(t){var n=Z(r.store,t);r.updateStore(n)}r.notifyObservers(e,null,{type:"valueUpdate",source:"external"}),r.notifyWatch()},this.getDependencyChildrenFields=function(t){var e=new Set,n=[],o=new z;r.getFieldEntities().forEach(function(l){var i=l.props.dependencies;(i||[]).forEach(function(u){var f=M(u);o.update(f,function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return d.add(l),d})})});var c=function l(i){var u=o.get(i)||new Set;u.forEach(function(f){if(!e.has(f)){e.add(f);var d=f.getNamePath();f.isFieldDirty()&&d.length&&(n.push(d),l(d))}})};return c(t),n},this.triggerOnFieldsChange=function(t,e){var n=r.callbacks.onFieldsChange;if(n){var o=r.getFields();if(e){var c=new z;e.forEach(function(i){var u=i.name,f=i.errors;c.set(u,f)}),o.forEach(function(i){i.errors=c.get(i.name)||i.errors})}var l=o.filter(function(i){var u=i.name;return Y(t,u)});n(l,o)}},this.validateFields=function(t,e){r.warningUnhooked();var n=!!t,o=n?t.map(M):[],c=[];r.getFieldEntities(!0).forEach(function(u){if(n||o.push(u.getNamePath()),(e==null?void 0:e.recursive)&&n){var f=u.getNamePath();f.every(function(F,v){return t[v]===F||t[v]===void 0})&&o.push(f)}if(!(!u.props.rules||!u.props.rules.length)){var d=u.getNamePath();if(!n||Y(o,d)){var y=u.validateRules(P({validateMessages:P(P({},ke),r.validateMessages)},e));c.push(y.then(function(){return{name:d,errors:[],warnings:[]}}).catch(function(F){var v=[],g=[];return F.forEach(function(m){var h=m.rule.warningOnly,E=m.errors;h?g.push.apply(g,V(E)):v.push.apply(v,V(E))}),v.length?Promise.reject({name:d,errors:v,warnings:g}):{name:d,errors:v,warnings:g}}))}}});var l=Ze(c);r.lastValidatePromise=l,l.catch(function(u){return u}).then(function(u){var f=u.map(function(d){var y=d.name;return y});r.notifyObservers(r.store,f,{type:"validateFinish"}),r.triggerOnFieldsChange(f,u)});var i=l.then(function(){return r.lastValidatePromise===l?Promise.resolve(r.getFieldsValue(o)):Promise.reject([])}).catch(function(u){var f=u.filter(function(d){return d&&d.errors.length});return Promise.reject({values:r.getFieldsValue(o),errorFields:f,outOfDate:r.lastValidatePromise!==l})});return i.catch(function(u){return u}),i},this.submit=function(){r.warningUnhooked(),r.validateFields().then(function(t){var e=r.callbacks.onFinish;if(e)try{e(t)}catch(n){console.error(n)}}).catch(function(t){var e=r.callbacks.onFinishFailed;e&&e(t)})},this.forceRootUpdate=a});function Me(s){var a=p.exports.useRef(),r=p.exports.useState({}),t=B(r,2),e=t[1];if(!a.current)if(s)a.current=s;else{var n=function(){e({})},o=new rr(n);a.current=o.getForm()}return[a.current]}var ce=p.exports.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),tr=function(a){var r=a.validateMessages,t=a.onFormChange,e=a.onFormFinish,n=a.children,o=p.exports.useContext(ce),c=p.exports.useRef({});return p.exports.createElement(ce.Provider,{value:P(P({},o),{},{validateMessages:P(P({},o.validateMessages),r),triggerFormChange:function(i,u){t&&t(i,{changedFields:u,forms:c.current}),o.triggerFormChange(i,u)},triggerFormFinish:function(i,u){e&&e(i,{values:u,forms:c.current}),o.triggerFormFinish(i,u)},registerForm:function(i,u){i&&(c.current=P(P({},c.current),{},ee({},i,u))),o.registerForm(i,u)},unregisterForm:function(i){var u=P({},c.current);delete u[i],c.current=u,o.unregisterForm(i)}})},n)},nr=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed"],ir=function(a,r){var t=a.name,e=a.initialValues,n=a.fields,o=a.form,c=a.preserve,l=a.children,i=a.component,u=i===void 0?"form":i,f=a.validateMessages,d=a.validateTrigger,y=d===void 0?"onChange":d,F=a.onValuesChange,v=a.onFieldsChange,g=a.onFinish,m=a.onFinishFailed,h=de(a,nr),E=p.exports.useContext(ce),w=Me(o),C=B(w,1),b=C[0],$=b.getInternalHooks(K),R=$.useSubscribe,x=$.setInitialValues,N=$.setCallbacks,J=$.setValidateMessages,O=$.setPreserve,_=$.destroyForm;p.exports.useImperativeHandle(r,function(){return b}),p.exports.useEffect(function(){return E.registerForm(t,b),function(){E.unregisterForm(t)}},[E,b,t]),J(P(P({},E.validateMessages),f)),N({onValuesChange:F,onFieldsChange:function(A){if(E.triggerFormChange(t,A),v){for(var D=arguments.length,Fe=new Array(D>1?D-1:0),X=1;X<D;X++)Fe[X-1]=arguments[X];v.apply(void 0,[A].concat(Fe))}},onFinish:function(A){E.triggerFormFinish(t,A),g&&g(A)},onFinishFailed:m}),O(c);var I=p.exports.useRef(null);x(e,!I.current),I.current||(I.current=!0),p.exports.useEffect(function(){return _},[]);var U,he=typeof l=="function";if(he){var Oe=b.getFieldsValue(!0);U=l(Oe,b)}else U=l;R(!he);var me=p.exports.useRef();p.exports.useEffect(function(){De(me.current||[],n||[])||b.setFields(n||[]),me.current=n},[n,b]);var Se=p.exports.useMemo(function(){return P(P({},b),{},{validateTrigger:y})},[b,y]),pe=p.exports.createElement(q.Provider,{value:Se},U);return u===!1?pe:p.exports.createElement(u,Ce({},h,{onSubmit:function(A){A.preventDefault(),A.stopPropagation(),b.submit()},onReset:function(A){var D;A.preventDefault(),b.resetFields(),(D=h.onReset)===null||D===void 0||D.call(h,A)}}),pe)};function we(s){try{return JSON.stringify(s)}catch(a){return Math.random()}}function ar(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0,r=p.exports.useState(),t=B(r,2),e=t[0],n=t[1],o=p.exports.useMemo(function(){return we(e)},[e]),c=p.exports.useRef(o);c.current=o;var l=p.exports.useContext(q),i=a||l,u=i&&i._init,f=M(s),d=p.exports.useRef(f);return d.current=f,p.exports.useEffect(function(){if(!!u){var y=i.getFieldsValue,F=i.getInternalHooks,v=F(K),g=v.registerWatch,m=g(function(E){var w=W(E,d.current),C=we(w);c.current!==C&&n(w)}),h=W(y(),d.current);return n(h),m}},[]),e}var sr=p.exports.forwardRef(ir),Q=sr;Q.FormProvider=tr;Q.Field=$e;Q.List=Xe;Q.useForm=Me;Q.useWatch=ar;export{tr as F};
