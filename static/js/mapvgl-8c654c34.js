import{o as ri}from"./@babel-ee6b9e1a.js";var Zs={exports:{}};(function(Vh,Vs){(function(F,Dt){Dt(Vs)})(ri,function(F){function Dt(e){this.options=e||{},this.paneName=this.options.paneName||"labelPane",this.zIndex=this.options.zIndex||1,this._map=e.map,this._lastDrawTime=null,this.show()}function tt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function V(e,i){return i={exports:{}},e(i,i.exports),i.exports}function Gs(e,i){return function(t){return i(e(t))}}function Ks(e){var i=function(t){return t==null?t:(1<arguments.length&&(t=Array.prototype.slice.call(arguments)),e(t))};return"conversion"in e&&(i.conversion=e.conversion),i}function Qs(e){var i=function(t){if(t==null)return t;1<arguments.length&&(t=Array.prototype.slice.call(arguments));var r=e(t);if((typeof r=="undefined"?"undefined":Ut(r))==="object")for(var a=r.length,n=0;n<a;n++)r[n]=Math.round(r[n]);return r};return"conversion"in e&&(i.conversion=e.conversion),i}function mt(e,i){if(!(this instanceof mt))return new mt(e,i);if(i&&i in va&&(i=null),i&&!(i in Nt))throw Error("Unknown model: "+i);if(typeof e=="undefined")this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof mt)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if(typeof e=="string"){if(i=Fr.get(e),i===null)throw Error("Unable to parse color from string: "+e);this.model=i.model;var t=Nt[this.model].channels;this.color=i.value.slice(0,t),this.valpha=typeof i.value[t]=="number"?i.value[t]:1}else if(e.length)this.model=i||"rgb",t=Nt[this.model].channels,i=Sn.call(e,0,t),this.color=Xi(i,t),this.valpha=typeof e[t]=="number"?e[t]:1;else if(typeof e=="number")e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,e&255],this.valpha=1;else{if(this.valpha=1,i=yt(e),"alpha"in e&&(i.splice(i.indexOf("alpha"),1),this.valpha=typeof e.alpha=="number"?e.alpha:0),i=i.sort().join(""),!(i in Pn))throw Error("Unable to parse color from object: "+Er(e));this.model=Pn[i],t=Nt[this.model].labels;var r=[];for(i=0;i<t.length;i++)r.push(e[t[i]]);this.color=Xi(r)}if(Si[this.model])for(t=Nt[this.model].channels,i=0;i<t;i++)(e=Si[this.model][i])&&(this.color[i]=e(this.color[i]));this.valpha=Math.max(0,Math.min(1,this.valpha)),ca&&ca(this)}function Js(e){return function(i){return Number(i.toFixed(e))}}function ct(e,i,t){return e=Array.isArray(e)?e:[e],e.forEach(function(r){(Si[r]||(Si[r]=[]))[i]=t}),e=e[0],function(r){if(arguments.length){t&&(r=t(r));var a=this[e]();return a.color[i]=r,a}return a=this[e]().color[i],t&&(a=t(a)),a}}function xt(e){return function(i){return Math.max(0,Math.min(e,i))}}function Xi(e,i){for(var t=0;t<i;t++)typeof e[t]!="number"&&(e[t]=0);return e}function Mt(e){return e*Math.PI/180}function Wi(e){return e/Math.PI*180}function oe(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Yi(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function Zi(e,i){return 1e-8>Math.abs(e-i)}function Vi(e){var i=e[0],t=e[e.length-1];return Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2)+Math.pow((i[2]||0)-(t[2]||0),2))<(1<arguments.length&&arguments[1]!==void 0?arguments[1]:2e-7)}function Lt(){}function Gi(e,i){for(var t in i)e[t]=i[t]}function bt(e,i){this.lng=e,this.lat=i}function po(e,i){this.x=e,this.y=i}function Ki(e,i){var t=document.createElement("canvas");return e&&(t.width=e),i&&(t.height=i),t}function St(e){e=e||{},this.gradient=e.gradient||{"0.25":"rgba(0, 0, 255, 1)","0.55":"rgba(0, 255, 0, 1)","0.85":"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=e.maxSize===void 0?35:e.maxSize,this.minSize=e.minSize||0,this.max=e.max||100,this.min=e.min||0,this.initPalette()}function ae(e){this.options=e||{},this._initialize()}function Qi(e,i,t,r,a){var n=1-e,s=1-e;return n*n*n*i+3*s*s*e*t+3*(1-e)*e*e*r+e*e*e*a}function me(e){this.WORLD_SIZE_MC_HALF=20037726372307256e-9,this.WORLD_SIZE_MC=2*this.WORLD_SIZE_MC_HALF,this.options=e||{},this._initialize()}function go(e,i){return e&&i?Math.round(Math.sqrt(Math.pow(e.lng-i.lng,2)+Math.pow(e.lat-i.lat,2))):0}function ii(e){return e=e.split("|"),e[0]=e[0].split(","),{lng:parseFloat(e[0][0]),lat:parseFloat(e[0][1])}}function Ke(e){for(var i=e.length;0<=--i;)e[i]=0}function Ji(e,i,t,r,a){this.static_tree=e,this.extra_bits=i,this.extra_base=t,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}function qi(e,i){this.dyn_tree=e,this.max_code=0,this.stat_desc=i}function qt(e,i,t,r,a){this.good_length=e,this.max_lazy=i,this.nice_length=t,this.max_chain=r,this.func=a}function qs(){this.strm=null,this.status=0,this.pending_buf=null,this.wrap=this.pending=this.pending_out=this.pending_buf_size=0,this.gzhead=null,this.gzindex=0,this.method=Li,this.last_flush=-1,this.w_mask=this.w_bits=this.w_size=0,this.window=null,this.window_size=0,this.head=this.prev=null,this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ee(this.dyn_ltree),Ee(this.dyn_dtree),Ee(this.bl_tree),this.bl_desc=this.d_desc=this.l_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ee(this.heap),this.heap_max=this.heap_len=0,this.depth=new Uint16Array(573),Ee(this.depth),this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function dr(e){e=this.options=Fi.assign({level:Xl,method:Yl,chunkSize:16384,windowBits:15,memLevel:8,strategy:Wl},e||{}),e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&16>e.windowBits&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ba,this.strm.avail_out=0;var i=Ur.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==Di)throw Error(Xe[i]);if(e.header&&Ur.deflateSetHeader(this.strm,e.header),e.dictionary){if(e=typeof e.dictionary=="string"?jr.string2buf(e.dictionary):ka.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,i=Ur.deflateSetDictionary(this.strm,e),i!==Di)throw Error(Xe[i]);this._dict_set=!0}}function $i(e,i){if(i=new dr(i),i.push(e,!0),i.err)throw i.msg||Xe[i.err];return i.result}function $s(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.total=this.check=this.dmax=this.flags=0,this.head=null,this.wnext=this.whave=this.wsize=this.wbits=0,this.window=null,this.extra=this.offset=this.length=this.bits=this.hold=0,this.distcode=this.lencode=null,this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.distdyn=this.lendyn=null,this.was=this.back=this.sane=0}function vr(e){var i=this.options=Fi.assign({chunkSize:65536,windowBits:15,to:""},e||{});if(i.raw&&0<=i.windowBits&&16>i.windowBits&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),!(0<=i.windowBits&&16>i.windowBits)||e&&e.windowBits||(i.windowBits+=32),15<i.windowBits&&48>i.windowBits&&(i.windowBits&15)===0&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ba,this.strm.avail_out=0,e=ce.inflateInit2(this.strm,i.windowBits),e!==Xr||(this.header=new ef,ce.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=jr.string2buf(i.dictionary):Ka.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(e=ce.inflateSetDictionary(this.strm,i.dictionary),e!==Xr))))throw Error(Xe[e])}function tn(e,i){if(i=new vr(i),i.push(e),i.err)throw i.msg||Xe[i.err];return i.result}function mo(e,i){for(var t=["webgl2","experimental-webgl2","webgl","experimental-webgl"],r=void 0,a=0;a<t.length;a++)try{if(r=e.getContext(t[a],{alpha:!0,premultipliedAlpha:!1,antialias:i.antialias||!0,preserveDrawingBuffer:i.preserveDrawingBuffer||!1}))break}catch(n){}return r}function Qe(e,i,t){t=K({TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"REPEAT",TEXTURE_WRAP_T:"REPEAT"},t);var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i);for(var a in t)e.texParameteri(e.TEXTURE_2D,e[a],e[t[a]]);return e.bindTexture(e.TEXTURE_2D,null),r}function Pt(e,i,t,r){if((typeof i=="undefined"?"undefined":Ut(i))==="object")i=Qe(e,i,r),t(i,null);else{var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var n=Yi(a.width),s=Yi(a.height),o=document.createElement("canvas");o.width=n,o.height=s,o.getContext("2d").drawImage(a,0,0,n,s),a=o,n=Qe(e,a,r),t(n,a)},a.src=i}}function se(e,i){if(i instanceof Array){var t,r=(t={zero:e.ZERO,one:e.ONE,src_color:e.SRC_COLOR,one_minus_src_color:e.ONE_MINUS_SRC_COLOR,dst_color:e.DST_COLOR,one_minus_dst_color:e.ONE_MINUS_DST_COLOR,src_alpha:e.SRC_ALPHA},It(t,"one_minus_src_color",e.ONE_MINUS_SRC_ALPHA),It(t,"dst_alpha",e.DST_ALPHA),It(t,"one_minus_dst_alpha",e.ONE_MINUS_DST_ALPHA),It(t,"constant_color",e.CONSTANT_COLOR),It(t,"one_minus_constant_color",e.ONE_MINUS_CONSTANT_COLOR),It(t,"constant_alpha",e.CONSTANT_ALPHA),It(t,"one_minus_constant_color",e.ONE_MINUS_CONSTANT_ALPHA),It(t,"src_alpha_saturate",e.SRC_ALPHA_SATURATE),t);return i.map(function(a){return r[a]})}switch(i){case"default":return[e.ONE,e.ZERO];case"deeper":return[e.ONE,e.ONE_MINUS_SRC_ALPHA];case"normal":return[e.SRC_ALPHA,e.ONE];case"lighter":return[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA];default:return[e.ONE,e.ZERO]}}function jt(e,i,t){t=t||2;var r=i&&i.length,a=r?i[0]*t:e.length,n=xo(e,0,a,t,!0),s=[];if(!n||n.next===n.prev)return s;var o;if(r){var u=t;r=[];var h,v=0;for(h=i.length;v<h;v++){var l=i[v]*u,f=v<h-1?i[v+1]*u:e.length;l=xo(e,l,f,u,!1),l===l.next&&(l.steiner=!0),r.push(iu(l))}for(r.sort(eu),v=0;v<r.length;v++)u=r[v],i=n,(i=ru(u,i))&&(u=_o(i,u),xe(i,i.next),xe(u,u.next)),n=xe(n,n.next)}if(e.length>80*t){var d=o=e[0],c=r=e[1];for(u=t;u<a;u+=t)v=e[u],i=e[u+1],v<d&&(d=v),i<c&&(c=i),v>o&&(o=v),i>r&&(r=i);o=Math.max(o-d,r-c),o=o!==0?1/o:0}return pr(n,s,t,d,c,o),s}function xo(e,i,t,r,a){if(a===0<nn(e,i,t,r))for(a=i;a<t;a+=r)var n=Ao(a,e[a],e[a+1],n);else for(a=t-r;a>=i;a-=r)n=Ao(a,e[a],e[a+1],n);return n&&ni(n,n.next)&&(mr(n),n=n.next),n}function xe(e,i){if(!e)return e;i||(i=e);do{var t=!1;if(e.steiner||!ni(e,e.next)&&ft(e.prev,e,e.next)!==0)e=e.next;else{if(mr(e),e=i=e.prev,e===e.next)break;t=!0}}while(t||e!==i);return i}function pr(e,i,t,r,a,n,s){if(e){if(!s&&n){var o=e,u=o;do u.z===null&&(u.z=en(u.x,u.y,r,a,n)),u.prevZ=u.prev,u=u.nextZ=u.next;while(u!==o);u.prevZ.nextZ=null,u.prevZ=null,o=u;var h,v,l,f,d=1;do{u=o;var c=o=null;for(v=0;u;){v++;var p=u;for(h=l=0;h<d&&(l++,p=p.nextZ,p);h++);for(f=d;0<l||0<f&&p;)l!==0&&(f===0||!p||u.z<=p.z)?(h=u,u=u.nextZ,l--):(h=p,p=p.nextZ,f--),c?c.nextZ=h:o=h,h.prevZ=c,c=h;u=p}c.nextZ=null,d*=2}while(1<v)}for(o=e;e.prev!==e.next;){if(u=e.prev,p=e.next,n)c=tu(e,r,a,n);else t:if(c=e,v=c.prev,l=c,d=c.next,0<=ft(v,l,d))c=!1;else{for(h=c.next.next;h!==c.prev;){if(Je(v.x,v.y,l.x,l.y,d.x,d.y,h.x,h.y)&&0<=ft(h.prev,h,h.next)){c=!1;break t}h=h.next}c=!0}if(c)i.push(u.i/t),i.push(e.i/t),i.push(p.i/t),mr(e),o=e=p.next;else if(e=p,e===o){if(!s)pr(xe(e),i,t,r,a,n,1);else if(s===1){e=xe(e),s=i,o=t,u=e;do p=u.prev,c=u.next.next,!ni(p,c)&&yo(p,u,u.next,c)&&gr(p,c)&&gr(c,p)&&(s.push(p.i/o),s.push(u.i/o),s.push(c.i/o),mr(u),mr(u.next),u=e=c),u=u.next;while(u!==e);e=xe(u),pr(e,i,t,r,a,n,2)}else if(s===2)t:{s=e;do{for(o=s.next.next;o!==s.prev;){if(u=s.i!==o.i){if(u=s,p=o,c=u.next.i!==p.i&&u.prev.i!==p.i){e:{c=u;do{if(c.i!==u.i&&c.next.i!==u.i&&c.i!==p.i&&c.next.i!==p.i&&yo(c,c.next,u,p)){c=!0;break e}c=c.next}while(c!==u);c=!1}c=!c}if(c){if(c=gr(u,p)&&gr(p,u)){c=u,v=!1,l=(u.x+p.x)/2,d=(u.y+p.y)/2;do c.y>d!=c.next.y>d&&c.next.y!==c.y&&l<(c.next.x-c.x)*(d-c.y)/(c.next.y-c.y)+c.x&&(v=!v),c=c.next;while(c!==u);c=v}c=c&&(ft(u.prev,u,p.prev)||ft(u,p.prev,p))||ni(u,p)&&0<ft(u.prev,u,u.next)&&0<ft(p.prev,p,p.next)}u=c}if(u){e=_o(s,o),s=xe(s,s.next),e=xe(e,e.next),pr(s,i,t,r,a,n),pr(e,i,t,r,a,n);break t}o=o.next}s=s.next}while(s!==e)}break}}}}function tu(e,i,t,r){var a=e.prev,n=e.next;if(0<=ft(a,e,n))return!1;var s=a.x>e.x?a.x>n.x?a.x:n.x:e.x>n.x?e.x:n.x,o=a.y>e.y?a.y>n.y?a.y:n.y:e.y>n.y?e.y:n.y,u=en(a.x<e.x?a.x<n.x?a.x:n.x:e.x<n.x?e.x:n.x,a.y<e.y?a.y<n.y?a.y:n.y:e.y<n.y?e.y:n.y,i,t,r);for(i=en(s,o,i,t,r),t=e.prevZ,r=e.nextZ;t&&t.z>=u&&r&&r.z<=i;){if(t!==e.prev&&t!==e.next&&Je(a.x,a.y,e.x,e.y,n.x,n.y,t.x,t.y)&&0<=ft(t.prev,t,t.next)||(t=t.prevZ,r!==e.prev&&r!==e.next&&Je(a.x,a.y,e.x,e.y,n.x,n.y,r.x,r.y)&&0<=ft(r.prev,r,r.next)))return!1;r=r.nextZ}for(;t&&t.z>=u;){if(t!==e.prev&&t!==e.next&&Je(a.x,a.y,e.x,e.y,n.x,n.y,t.x,t.y)&&0<=ft(t.prev,t,t.next))return!1;t=t.prevZ}for(;r&&r.z<=i;){if(r!==e.prev&&r!==e.next&&Je(a.x,a.y,e.x,e.y,n.x,n.y,r.x,r.y)&&0<=ft(r.prev,r,r.next))return!1;r=r.nextZ}return!0}function eu(e,i){return e.x-i.x}function ru(e,i){var t=i,r=e.x,a=e.y,n=-1/0;do{if(a<=t.y&&a>=t.next.y&&t.next.y!==t.y){var s=t.x+(a-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(s<=r&&s>n){if(n=s,s===r){if(a===t.y)return t;if(a===t.next.y)return t.next}var o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==i);if(!o)return null;if(r===n)return o;i=o,s=o.x;var u=o.y,h=1/0;t=o;do{if(r>=t.x&&t.x>=s&&r!==t.x&&Je(a<u?r:n,a,s,u,a<u?n:r,a,t.x,t.y)){var v=Math.abs(a-t.y)/(r-t.x),l;if((l=gr(t,e))&&!(l=v<h)&&(l=v===h)&&!(l=t.x>o.x)&&(l=t.x===o.x)){l=o;var f=t;l=0>ft(l.prev,l,f.prev)&&0>ft(f.next,l,l.next)}l&&(o=t,h=v)}t=t.next}while(t!==i);return o}function en(e,i,t,r,a){return e=32767*(e-t)*a,i=32767*(i-r)*a,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,(e|e<<1)&1431655765|((i|i<<1)&1431655765)<<1}function iu(e){var i=e,t=e;do(i.x<t.x||i.x===t.x&&i.y<t.y)&&(t=i),i=i.next;while(i!==e);return t}function Je(e,i,t,r,a,n,s,o){return 0<=(a-s)*(i-o)-(e-s)*(n-o)&&0<=(e-s)*(r-o)-(t-s)*(i-o)&&0<=(t-s)*(n-o)-(a-s)*(r-o)}function ft(e,i,t){return(i.y-e.y)*(t.x-i.x)-(i.x-e.x)*(t.y-i.y)}function ni(e,i){return e.x===i.x&&e.y===i.y}function yo(e,i,t,r){var a=ai(ft(e,i,t)),n=ai(ft(e,i,r)),s=ai(ft(t,r,e)),o=ai(ft(t,r,i));return!!(a!==n&&s!==o||a===0&&oi(e,t,i)||n===0&&oi(e,r,i)||s===0&&oi(t,e,r)||o===0&&oi(t,i,r))}function oi(e,i,t){return i.x<=Math.max(e.x,t.x)&&i.x>=Math.min(e.x,t.x)&&i.y<=Math.max(e.y,t.y)&&i.y>=Math.min(e.y,t.y)}function ai(e){return 0<e?1:0>e?-1:0}function gr(e,i){return 0>ft(e.prev,e,e.next)?0<=ft(e,i,e.next)&&0<=ft(e,e.prev,i):0>ft(e,i,e.prev)||0>ft(e,e.next,i)}function _o(e,i){var t=new rn(e.i,e.x,e.y),r=new rn(i.i,i.x,i.y),a=e.next,n=i.prev;return e.next=i,i.prev=e,t.next=a,a.prev=t,r.next=t,t.prev=r,n.next=r,r.prev=n,r}function Ao(e,i,t,r){return e=new rn(e,i,t),r?(e.next=r.next,e.prev=r,r.next.prev=e,r.next=e):(e.prev=e,e.next=e),e}function mr(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function rn(e,i,t){this.i=e,this.x=i,this.y=t,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function nn(e,i,t,r){for(var a=0,n=t-r;i<t;i+=r)a+=(e[n]-e[i])*(e[i+1]+e[n+1]),n=i;return a}function To(e){try{return zi.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(t){var i=new Lf;return i.append(e),zi.createObjectURL(i.getBlob(type))}}function ze(e,i){this.shapeLayer=e,this.gl=i,this.initData()}function wo(e,i,t,r){var a=[];return r=r*Math.PI/180,a[0]=(e-t[0])*Math.cos(r)-(i-t[1])*Math.sin(r)+t[0],a[1]=(e-t[0])*Math.sin(r)+(i-t[1])*Math.cos(r)+t[1],a}function ye(e){var i=0,t=0,r=!0,a=!1,n=void 0;try{for(var s=rr(e),o;!(r=(o=s.next()).done);r=!0){var u=o.value;i+=u.w*u.h,t=Math.max(t,u.w)}}catch(p){a=!0,n=p}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}e.sort(function(p,m){return m.h-p.h}),t=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),t),h:1/0}],a=r=0,n=!0,s=!1,o=void 0;try{for(var h=rr(e),v;!(n=(v=h.next()).done);n=!0)for(var l=v.value,f=t.length-1;0<=f;f--){var d=t[f];if(!(l.w>d.w||l.h>d.h)){if(l.x=d.x,l.y=d.y,a=Math.max(a,l.y+l.h),r=Math.max(r,l.x+l.w),l.w===d.w&&l.h===d.h){var c=t.pop();f<t.length&&(t[f]=c)}else l.h===d.h?(d.x+=l.w,d.w-=l.w):(l.w!==d.w&&t.push({x:d.x+l.w,y:d.y,w:d.w-l.w,h:l.h}),d.y+=l.h,d.h-=l.h);break}}}catch(p){s=!0,o=p}finally{try{!n&&h.return&&h.return()}finally{if(s)throw o}}return{w:r,h:a,fill:i/(r*a)||0}}function Ht(e,i){var t=[];return e.forEach(function(r){t.push(i?-r:r,r)}),t}function Mo(e){for(var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,t=[],r=0;r<e-1;r++){var a=2*(r+i);t.push(a,a+1,a+2),t.push(a+2,a+1,a+3)}return t}function si(e){return function(i,t,r){return i=t+e,t=r.length-1,r[0<t?0>i?0:i>t?t:i:i<t?t:0<i?0:i]}}function $t(e){if(!e[0]||!e[0].length)return e;for(var i=e[0].length,t=[],r=0,a=0;a<e.length;a++)for(var n=0;n<i;n++)t[r++]=e[a][n];return t}function Co(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],i=[],t=0,r=0;r<e.length;r++){var a=e[r];if(0<r){var n=e[r-1];t+=Math.sqrt(Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2))}i.push(t)}return{arr:i,total:t}}function So(){var e=document.createElement("canvas");e.width=e.height=32;var i=e.getContext("2d");return{canvas:e,ctx:i}}function Po(){var e=(0<arguments.length&&arguments[0]!==void 0?arguments[0]:{}).color,i=So(),t=i.canvas;return i=i.ctx,i.save(),i.moveTo(0,0),i.lineTo(20,0),i.lineTo(32,16),i.lineTo(20,32),i.lineTo(0,32),i.lineTo(10,16),i.fillStyle=e||"#fff",i.fill(),i.restore(),t}function ui(e,i){return J.set(e,-i[1],i[0])}function Eo(e,i,t){return J.sub(e,i,t),J.normalize(e,e),e}function nu(e){var i,t;this.promise=new e(function(r,a){if(i!==void 0||t!==void 0)throw TypeError("Bad Promise constructor");i=r,t=a}),this.resolve=be(i),this.reject=be(t)}function ou(e,i,t){return t=Math.PI/180*(60*t+30),[e.x+i*Math.cos(t),e.y+i*Math.sin(t)]}function au(e,i,t){for(var r={},a=[],n=e.length,s=i/2/Math.sin(Math.PI/3),o=1.5*s,u=1,h=0;h<n;++h){var v=e[h].geometry.coordinates;t&&(v=t(v));var l=+v[0],f=+v[1];if(!isNaN(l)&&!isNaN(f)){v=Math.round(f/=o);var d=Math.round(l=l/i-(v&1)/2),c=f-v;if(1<3*Math.abs(c)){var p=l-d,m=d+(l<d?-1:1)/2,g=v+(f<v?-1:1);l-=m,f-=g,p*p+c*c>l*l+f*f&&(d=m+(v&1?1:-1)/2,v=g)}c=d+"-"+v,(p=r[c])?(p.count+=e[h].count||1,u=Math.max(u,p.count)):(r[c]={center:{x:(d+(v&1)/2)*i,y:v*o},count:e[h].count||1},a.push(r[c]))}}return a.max=u,a.r=s,a}function su(e,i,t,r){switch(r){case 5122:return new Int16Array(e,i,t);case 5123:return new Uint16Array(e,i,t);case 5124:return new Int32Array(e,i,t);case 5125:return new Uint32Array(e,i,t);case 5126:return new Float32Array(e,i,t);default:return null}}function li(e){return su(e.bufferView.data,e.byteOffset,e.count*ho[e.type],e.componentType)}function uu(e){var i="",t=e.lastIndexOf("/");return t!==-1&&(i=e.substring(0,t+1)),i}function lu(e,i){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",e,!0),t.onreadystatechange=function(){t.readyState==4&&t.status=="200"&&i(t.responseText,this)},t.send(null)}function fu(e,i){var t=new XMLHttpRequest;t.responseType="arraybuffer",t.open("GET",e,!0),t.onreadystatechange=function(){if(t.readyState==4&&t.status=="200"){var r=t.response;r&&i&&i(r)}},t.send(null)}function hu(e,i,t){var r=new Image;r.crossOrigin="Anonymous",r.src=e,r.onload=function(){t(r,i)}}function cu(e){function i(S,D){t.uniform1i(S,D.index),t.activeTexture(t.TEXTURE0+D.index),S=T.glTF.textures[D.index],t.bindTexture(t.TEXTURE_2D,S.texture),t.bindSampler(D.index,S.sampler?S.sampler.sampler:s)}var t=e.gl,r=0,a=[];e=t.canvas;var n=function(S,D,Z){for(this.glTFScene=S,this.glTF=D,this.id=Z,this.rootTransform=z.create(),this.nodeMatrix=Array(D.nodes.length),S=0,D=this.nodeMatrix.length;S<D;S++)this.nodeMatrix[S]=z.create()},s=t.createSampler();t.samplerParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_LINEAR),t.samplerParameteri(s,t.TEXTURE_MAG_FILTER,t.LINEAR),t.samplerParameteri(s,t.TEXTURE_WRAP_S,t.REPEAT),t.samplerParameteri(s,t.TEXTURE_WRAP_T,t.REPEAT),t.bindVertexArray(null),t.bindVertexArray(null);var o={HAS_SKIN:1,SKIN_VEC8:2,HAS_BASECOLORMAP:4,HAS_NORMALMAP:8,HAS_METALROUGHNESSMAP:16,HAS_OCCLUSIONMAP:32,HAS_EMISSIVEMAP:64},u={},h=function(){this.flags=0,this.programObject=null};h.prototype.hasSkin=function(){return this.flags&o.HAS_SKIN},h.prototype.hasBaseColorMap=function(){return this.flags&o.HAS_BASECOLORMAP},h.prototype.hasNormalMap=function(){return this.flags&o.HAS_NORMALMAP},h.prototype.hasMetalRoughnessMap=function(){return this.flags&o.HAS_METALROUGHNESSMAP},h.prototype.hasOcclusionMap=function(){return this.flags&o.HAS_OCCLUSIONMAP},h.prototype.hasEmissiveMap=function(){return this.flags&o.HAS_EMISSIVEMAP},h.prototype.defineMacro=function(S){o[S]!==void 0&&(this.flags|=o[S])},h.prototype.compile=function(){var S=u[this.flags];if(S)this.programObject=S;else{var D=S="";this.flags&o.HAS_SKIN&&(S+=`#define HAS_SKIN
`),this.flags&o.SKIN_VEC8&&(S+=`#define SKIN_VEC8
`),this.flags&o.HAS_BASECOLORMAP&&(D+=`#define HAS_BASECOLORMAP
`),this.flags&o.HAS_NORMALMAP&&(D+=`#define HAS_NORMALMAP
`),this.flags&o.HAS_METALROUGHNESSMAP&&(D+=`#define HAS_METALROUGHNESSMAP
`),this.flags&o.HAS_OCCLUSIONMAP&&(D+=`#define HAS_OCCLUSIONMAP
`),this.flags&o.HAS_EMISSIVEMAP&&(D+=`#define HAS_EMISSIVEMAP
`),S=cr.createProgram(t,`#version 300 es
`+S+`#define POSITION_LOCATION 0
#define NORMAL_LOCATION 1
#define TEXCOORD_0_LOCATION 2
#define JOINTS_0_LOCATION 3
#define JOINTS_1_LOCATION 5
#define WEIGHTS_0_LOCATION 4
#define WEIGHTS_1_LOCATION 6
#define TANGENT_LOCATION 7
precision highp float;precision highp int;uniform mat4 u_MVP;uniform mat4 u_MV;uniform mat4 u_MVNormal;
#ifdef HAS_SKIN
uniform JointMatrix{mat4 matrix[65];}u_jointMatrix;
#endif
layout(location=POSITION_LOCATION)in vec3 position;layout(location=NORMAL_LOCATION)in vec3 normal;layout(location=TEXCOORD_0_LOCATION)in vec2 uv;
#ifdef HAS_SKIN
layout(location=JOINTS_0_LOCATION)in vec4 joint0;layout(location=WEIGHTS_0_LOCATION)in vec4 weight0;
#ifdef SKIN_VEC8
layout(location=JOINTS_1_LOCATION)in vec4 joint1;layout(location=WEIGHTS_1_LOCATION)in vec4 weight1;
#endif
#endif
out vec3 v_position;out vec3 v_normal;out vec2 v_uv;void main(){
#ifdef HAS_SKIN
mat4 skinMatrix=weight0.x*u_jointMatrix.matrix[int(joint0.x)]+weight0.y*u_jointMatrix.matrix[int(joint0.y)]+weight0.z*u_jointMatrix.matrix[int(joint0.z)]+weight0.w*u_jointMatrix.matrix[int(joint0.w)];
#ifdef SKIN_VEC8
skinMatrix+=weight1.x*u_jointMatrix.matrix[int(joint1.x)]+weight1.y*u_jointMatrix.matrix[int(joint1.y)]+weight1.z*u_jointMatrix.matrix[int(joint1.z)]+weight1.w*u_jointMatrix.matrix[int(joint1.w)];
#endif
#endif
v_uv=uv;
#ifdef HAS_SKIN
v_normal=normalize((u_MVNormal*transpose(inverse(skinMatrix))*vec4(normal,0)).xyz);vec4 pos=u_MV*skinMatrix*vec4(position,1.0);gl_Position=u_MVP*skinMatrix*vec4(position,1.0);
#else
v_normal=normalize((u_MVNormal*vec4(normal,0)).xyz);vec4 pos=u_MV*vec4(position,1.0);gl_Position=u_MVP*vec4(position,1.0);
#endif
v_position=vec3(pos.xyz)/pos.w;}`,`#version 300 es
`+D+`#define FRAG_COLOR_LOCATION 0
precision highp float;precision highp int;uniform sampler2D u_brdfLUT;uniform vec4 u_baseColorFactor;
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_baseColorTexture;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_normalTexture;uniform float u_normalTextureScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_emissiveTexture;uniform vec3 u_emissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_metallicRoughnessTexture;
#endif
uniform float u_metallicFactor;uniform float u_roughnessFactor;
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_occlusionTexture;uniform float u_occlusionStrength;
#endif
in vec3 v_position;in vec3 v_normal;in vec2 v_uv;layout(location=FRAG_COLOR_LOCATION)out vec4 frag_color;struct PBRInfo{float NdotL;float NdotV;float NdotH;float LdotH;float VdotH;float perceptualRoughness;float metalness;vec3 reflectance0;vec3 reflectance90;float alphaRoughness;vec3 diffuseColor;vec3 specularColor;};const float M_PI=3.141592653589793;const float c_MinRoughness=0.04;vec3 getNormal(){vec3 pos_dx=dFdx(v_position);vec3 pos_dy=dFdy(v_position);vec3 tex_dx=dFdx(vec3(v_uv,0.0));vec3 tex_dy=dFdy(vec3(v_uv,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=v_normal;t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));mat3 tbn=mat3(t,b,ng);
#ifdef HAS_NORMALMAP
vec3 n=texture(u_normalTexture,v_uv).rgb;n=normalize(tbn*((2.0*n-1.0)*vec3(u_normalTextureScale,u_normalTextureScale,1.0)));
#else
vec3 n=tbn[2].xyz;
#endif
return n;}vec3 getIBLContribution(PBRInfo pbrInputs,vec3 n,vec3 reflection){float mipCount=10.0;float lod=(pbrInputs.perceptualRoughness*mipCount);vec3 brdf=texture(u_brdfLUT,vec2(pbrInputs.NdotV,1.0-pbrInputs.perceptualRoughness)).rgb;vec3 diffuseLight=vec3(0.6,0.6,0.6);vec3 specularLight=vec3(0.6,0.6,0.6);vec3 diffuse=diffuseLight*pbrInputs.diffuseColor;vec3 specular=specularLight*(pbrInputs.specularColor*brdf.x+brdf.y);return diffuse+specular;}vec3 diffuse(PBRInfo pbrInputs){return pbrInputs.diffuseColor/M_PI;}vec3 specularReflection(PBRInfo pbrInputs){return pbrInputs.reflectance0+(pbrInputs.reflectance90-pbrInputs.reflectance0)*pow(clamp(1.0-pbrInputs.VdotH,0.0,1.0),5.0);}float geometricOcclusion(PBRInfo pbrInputs){float NdotL=pbrInputs.NdotL;float NdotV=pbrInputs.NdotV;float r=pbrInputs.alphaRoughness;float attenuationL=2.0*NdotL/(NdotL+sqrt(r*r+(1.0-r*r)*(NdotL*NdotL)));float attenuationV=2.0*NdotV/(NdotV+sqrt(r*r+(1.0-r*r)*(NdotV*NdotV)));return attenuationL*attenuationV;}float microfacetDistribution(PBRInfo pbrInputs){float roughnessSq=pbrInputs.alphaRoughness*pbrInputs.alphaRoughness;float f=(pbrInputs.NdotH*roughnessSq-pbrInputs.NdotH)*pbrInputs.NdotH+1.0;return roughnessSq/(M_PI*f*f);}void main(){float perceptualRoughness=u_roughnessFactor;float metallic=u_metallicFactor;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample=texture(u_metallicRoughnessTexture,v_uv);perceptualRoughness=mrSample.g*perceptualRoughness;metallic=mrSample.b*metallic;
#endif
perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;
#ifdef HAS_BASECOLORMAP
vec4 baseColor=texture(u_baseColorTexture,v_uv)*u_baseColorFactor;
#else
vec4 baseColor=u_baseColorFactor;
#endif
vec3 f0=vec3(0.04);vec3 diffuseColor=baseColor.rgb*(vec3(1.0)-f0);diffuseColor*=1.0-metallic;vec3 specularColor=mix(f0,baseColor.rgb,metallic);float reflectance=max(max(specularColor.r,specularColor.g),specularColor.b);float reflectance90=clamp(reflectance*25.0,0.0,1.0);vec3 specularEnvironmentR0=specularColor.rgb;vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;vec3 n=getNormal();vec3 v=normalize(-v_position);vec3 l=normalize(vec3(1.0,1.0,1.0));vec3 h=normalize(l+v);vec3 reflection=-normalize(reflect(v,n));float NdotL=clamp(dot(n,l),0.001,1.0);float NdotV=abs(dot(n,v))+0.001;float NdotH=clamp(dot(n,h),0.0,1.0);float LdotH=clamp(dot(l,h),0.0,1.0);float VdotH=clamp(dot(v,h),0.0,1.0);PBRInfo pbrInputs=PBRInfo(NdotL,NdotV,NdotH,LdotH,VdotH,perceptualRoughness,metallic,specularEnvironmentR0,specularEnvironmentR90,alphaRoughness,diffuseColor,specularColor);vec3 F=specularReflection(pbrInputs);float G=geometricOcclusion(pbrInputs);float D=microfacetDistribution(pbrInputs);vec3 diffuseContrib=(1.0-F)*diffuse(pbrInputs);vec3 specContrib=max(vec3(0.0),F*G*D/(4.0*NdotL*NdotV));vec3 color=NdotL*(diffuseContrib+specContrib);color+=getIBLContribution(pbrInputs,n,reflection);
#ifdef HAS_OCCLUSIONMAP
float ao=texture(u_occlusionTexture,v_uv).r;color=mix(color,color*ao,u_occlusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive=texture(u_emissiveTexture,v_uv).rgb*u_emissiveFactor;color+=emissive;
#endif
frag_color=vec4(color,baseColor.a);}`),this.programObject={program:S,uniformLocations:{},uniformBlockIndices:{}},this.flags&o.HAS_SKIN&&(this.programObject.uniformBlockIndices.JointMatrix=t.getUniformBlockIndex(S,"JointMatrix")),D=this.programObject.uniformLocations,D.MVP=t.getUniformLocation(S,"u_MVP"),D.MVNormal=t.getUniformLocation(S,"u_MVNormal"),D.MV=t.getUniformLocation(S,"u_MV"),D.baseColorFactor=t.getUniformLocation(S,"u_baseColorFactor"),D.metallicFactor=t.getUniformLocation(S,"u_metallicFactor"),D.roughnessFactor=t.getUniformLocation(S,"u_roughnessFactor"),this.flags&o.HAS_BASECOLORMAP&&(D.baseColorTexture=t.getUniformLocation(S,"u_baseColorTexture")),this.flags&o.HAS_NORMALMAP&&(D.normalTexture=t.getUniformLocation(S,"u_normalTexture"),D.normalTextureScale=t.getUniformLocation(S,"u_normalTextureScale")),this.flags&o.HAS_METALROUGHNESSMAP&&(D.metallicRoughnessTexture=t.getUniformLocation(S,"u_metallicRoughnessTexture")),this.flags&o.HAS_OCCLUSIONMAP&&(D.occlusionTexture=t.getUniformLocation(S,"u_occlusionTexture"),D.occlusionStrength=t.getUniformLocation(S,"u_occlusionStrength")),this.flags&o.HAS_EMISSIVEMAP&&(D.emissiveTexture=t.getUniformLocation(S,"u_emissiveTexture"),D.emissiveFactor=t.getUniformLocation(S,"u_emissiveFactor")),t.useProgram(null),u[this.flags]=this.programObject}};var v=1,l=j.create(),f=z.create();Oi.create();var d=[];t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW);var c=!0;t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL);var p=p||{},m=null;j.create();var g=z.create();z.perspective(g,.785,e.width/e.height,.01,100),z.create();var x=z.create(),y=z.create(),_=z.create();z.create();var A,T,w=[1,1,1,1],C=p.drawPrimitive=function(S,D){if(H){y=x=H.matrix,z.invert(_,x),z.transpose(_,_),D=w;var Z=S.shader,X=S.material;if(X!==null){var B=X.pbrMetallicRoughness;D=B.baseColorFactor,S.material.doubleSided===c&&((c=!S.material.doubleSided)?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE))}m!=S.shader.programObject&&(m=S.shader.programObject,t.useProgram(m.program)),X&&(Z.hasBaseColorMap()&&i(m.uniformLocations.baseColorTexture,B.baseColorTexture),Z.hasNormalMap()&&(i(m.uniformLocations.normalTexture,X.normalTexture),t.uniform1f(m.uniformLocations.normalTextureScale,X.normalTexture.scale)),Z.hasMetalRoughnessMap()&&i(m.uniformLocations.metallicRoughnessTexture,B.metallicRoughnessTexture),t.uniform1f(m.uniformLocations.metallicFactor,B.metallicFactor),t.uniform1f(m.uniformLocations.roughnessFactor,B.roughnessFactor),Z.hasOcclusionMap()&&(i(m.uniformLocations.occlusionTexture,X.occlusionTexture),t.uniform1f(m.uniformLocations.occlusionStrength,X.occlusionTexture.strength)),Z.hasEmissiveMap()&&(i(m.uniformLocations.emissiveTexture,X.emissiveTexture),t.uniform3fv(m.uniformLocations.emissiveFactor,X.emissiveFactor))),Z.hasSkin()&&t.uniformBlockBinding(m.program,m.uniformBlockIndices.JointMatrix,A),t.activeTexture(t.TEXTURE0+29),t.bindTexture(t.TEXTURE_2D,null),t.uniform4fv(m.uniformLocations.baseColorFactor,D),t.uniformMatrix4fv(m.uniformLocations.MV,!1,x),t.uniformMatrix4fv(m.uniformLocations.MVP,!1,y),t.uniformMatrix4fv(m.uniformLocations.MVNormal,!1,_),t.bindVertexArray(S.vertexArray),S.indices!==null?t.drawElements(S.mode,S.indicesLength,S.indicesComponentType,S.indicesOffset):t.drawArrays(S.mode,S.drawArraysOffset,S.drawArraysCount),t.bindVertexArray(null)}},M=z.create(),E=z.create(),P=p.drawNode=function(S,D,Z,X){if(D=Z[D],X!==void 0?z.mul(D,X,S.matrix):z.copy(D,S.matrix),S.skin!==null){var B=S.skin;A=B.uniformBlockID;var Zt=S.skin.joints;for(z.invert(E,D),X=0,ut=Zt.length;X<ut;X++){var st=Zt[X];z.mul(M,Z[st.nodeID],B.inverseBindMatrix[X]),z.mul(M,E,M),B.jointMatrixUnidormBufferData.set(M,16*X)}t.bindBuffer(t.UNIFORM_BUFFER,B.jointMatrixUniformBuffer),t.bufferSubData(t.UNIFORM_BUFFER,0,B.jointMatrixUnidormBufferData,0,B.jointMatrixUnidormBufferData.length)}var ut;if(S.mesh!==null)for(B=S.mesh,X=0,ut=B.primitives.length;X<ut;X++)C(B.primitives[X],D);for(S.skin!==null&&t.bindBuffer(t.UNIFORM_BUFFER,null),X=0,ut=S.children.length;X<ut;X++)P(S.children[X],S.children[X].nodeID,Z,D)},L=p.drawScene=function(S){var D=S.glTF;if(D.animations){var Z=D.animations[r],X,B=0;for(X=Z.samplers.length;B<X;B++)Z.samplers[B].getValue(b);for(B=0,X=Z.channels.length;B<X;B++){var Zt=Z.channels[B],st=Zt.sampler,ut=D.nodes[Zt.target.nodeID];switch(Zt.target.path){case"rotation":ht.copy(ut.rotation,st.curValue);break;case"translation":j.copy(ut.translation,st.curValue);break;case"scale":j.copy(ut.scale,st.curValue)}ut.updateMatrixFromTRS()}}for(Z=0,D=S.glTFScene.nodes.length;Z<D;Z++)P(S.glTFScene.nodes[Z],S.glTFScene.nodes[Z].nodeID,S.nodeMatrix,S.rootTransform)},R=performance.now(),b=0,H;return{setupScene:function(S,D){function Z(vo,Zh){if(vo!==void 0){var ei=vo.bufferView;return ei.target===null?(t.bindBuffer(t.ARRAY_BUFFER,ei.buffer),t.bufferData(t.ARRAY_BUFFER,ei.data,t.STATIC_DRAW)):t.bindBuffer(ei.target,ei.buffer),vo.prepareVertexAttrib(Zh,t),!0}return!1}var X;if(S.animations){var B=0;for(X=S.animations.length;B<X;B++)a.add(S.animations[B].name||B)}r=0,B=S.scenes[S.defaultScene],j.fromValues(1.2*B.boundingBox.transform[0],0,0),j.create(),D?D=d[D.id]=new n(B,S,D.id):(D=new n(B,S,d.length),d.push(D)),d.length===1&&(z.identity(f),v=1/Math.max(B.boundingBox.transform[0],Math.max(B.boundingBox.transform[5],B.boundingBox.transform[10])),z.getTranslation(l,B.boundingBox.transform),j.scale(l,l,-1),l[0]+=-.5*B.boundingBox.transform[0],l[1]+=-.5*B.boundingBox.transform[5],l[2]+=-.5*B.boundingBox.transform[10],v*=.5,f[0]=v,f[5]=v,f[10]=v,z.translate(f,f,l),j.set(l,0,0,-1.5),v=1);var Zt;for(B=0,X=S.bufferViews.length;B<X;B++){var st=S.bufferViews[B];st.createBuffer(t),st.bindData(t)}if(S.textures)for(B=0,X=S.textures.length;B<X;B++){var ut=S.textures[B];ut.createTexture(t)}if(S.samplers)for(B=0,X=S.samplers.length;B<X;B++)ut=S.samplers[B],ut.createSampler(t);if(S.skins)for(B=0,X=S.skins.length;B<X;B++)ut=S.skins[B],ut.jointMatrixUniformBuffer=t.createBuffer(),t.bindBufferBase(t.UNIFORM_BUFFER,ut.uniformBlockID,ut.jointMatrixUniformBuffer),t.bindBuffer(t.UNIFORM_BUFFER,ut.jointMatrixUniformBuffer),t.bufferData(t.UNIFORM_BUFFER,ut.jointMatrixUnidormBufferData,t.DYNAMIC_DRAW),t.bufferSubData(t.UNIFORM_BUFFER,0,ut.jointMatrixUnidormBufferData),t.bindBuffer(t.UNIFORM_BUFFER,null);var co=0;for(Zt=S.meshes.length;co<Zt;co++)for(ut=S.meshes[co],B=0,X=ut.primitives.length;B<X;++B){var gt=ut.primitives[B];gt.shader=new h,gt.vertexArray=st=t.createVertexArray(),t.bindVertexArray(st),Z(gt.attributes.POSITION,0),Z(gt.attributes.NORMAL,1),Z(gt.attributes.TEXCOORD_0,2),Z(gt.attributes.JOINTS_0,3)&&Z(gt.attributes.WEIGHTS_0,4)&&gt.shader.defineMacro("HAS_SKIN"),Z(gt.attributes.JOINTS_1,5)&&Z(gt.attributes.WEIGHTS_1,6)&&gt.shader.defineMacro("SKIN_VEC8"),gt.indices!==null&&(st=S.accessors[gt.indices],st=st.bufferView,st.target===null?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,st.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,st.data,t.STATIC_DRAW)):t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,st.buffer)),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),(st=gt.material)&&(st.pbrMetallicRoughness.baseColorTexture&&gt.shader.defineMacro("HAS_BASECOLORMAP"),st.pbrMetallicRoughness.metallicRoughnessTexture&&gt.shader.defineMacro("HAS_METALROUGHNESSMAP"),st.normalTexture&&gt.shader.defineMacro("HAS_NORMALMAP"),st.occlusionTexture&&gt.shader.defineMacro("HAS_OCCLUSIONMAP"),st.emissiveTexture&&gt.shader.defineMacro("HAS_EMISSIVEMAP")),gt.shader.compile()}return D},render:p.render=function(S){H=S,S=new Date().getTime();var D,Z=0;for(D=d.length;Z<D;Z++)T=d[Z],L(d[Z]);m=null,b=.001*(S-R)}}}function du(e,i,t,r,a,n){if(typeof i=="string"&&typeof t=="number"&&typeof r=="number")for(i=i.split(n),n=0;n<i.length;n++)e.fillText(i[n],t,r),r+=a}function dt(e){this.options=e=e||{},e.colors=e.colors||["rgba(0,192,73,0.99609375)","rgba(242,48,48,0.99609375)","rgba(255,159,25,0.99609375)"];var i=e.colors;this.drawTogether=!0,this.parseColors(i),this.tileSize=256,this.ratio=window.devicePixelRatio,this.cache={},e.getTileUrl&&(this.getTileUrl=e.getTileUrl),this._loadCount={}}function vu(e){var i=e/2,t=e+i,r=new Ki(2*t,2*t),a=r.getContext("2d");return a.shadowBlur=i,a.shadowColor="black",a.shadowOffsetX=a.shadowOffsetY=1e4,a.beginPath(),a.arc(t-1e4,t-1e4,e,0,2*Math.PI,!0),a.closePath(),a.fill(),r}var on=window.BMapGL||window.BMap;on&&on.Overlay&&(Dt.prototype=new on.Overlay),Dt.prototype.initialize=function(e){this._map=e;var i=this.canvas=document.createElement("canvas"),t=this.ctx=this.canvas.getContext("2d");i.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";",this.adjustSize(),this.adjustRatio(t),e.getContainer().appendChild(i);var r=this;return e.addEventListener("resize",function(){r.adjustSize(),r._draw()}),this.canvas},Dt.prototype.adjustSize=function(){var e=this._map.getSize(),i=this.canvas;i.width=e.width,i.height=e.height,i.style.width=i.width+"px",i.style.height=i.height+"px"},Dt.prototype.adjustRatio=function(e){var i=(window.devicePixelRatio||1)/(e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),t=e.canvas.width,r=e.canvas.height;e.canvas.width=t*i,e.canvas.height=r*i,e.canvas.style.width=t+"px",e.canvas.style.height=r+"px",e.scale(i,i)},Dt.prototype.draw=function(){this._draw.apply(this,arguments)},Dt.prototype._draw=function(){this.dispatchEvent("draw"),this.options.update&&this.options.update.apply(this,arguments)},Dt.prototype.getContainer=function(){return this.canvas},Dt.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},Dt.prototype.hide=function(){this.canvas.style.display="none"},Dt.prototype.setZIndex=function(e){this.canvas.style.zIndex=e},Dt.prototype.getZIndex=function(){return this.zIndex};var Ro=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof ri!="undefined"?ri:typeof self!="undefined"?self:{},pu=V(function(e,i){i.__esModule=!0,i.default=function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}}),O=tt(pu),_e=function(e){if(e==null)throw TypeError("Can't call method on  "+e);return e},gu={}.hasOwnProperty,ot=function(e,i){return gu.call(e,i)},mu={}.toString,Ie=function(e){return mu.call(e).slice(8,-1)},an=Object("z").propertyIsEnumerable(0)?Object:function(e){return Ie(e)=="String"?e.split(""):Object(e)},te=function(e){return an(_e(e))},xu=Math.ceil,yu=Math.floor,sn=function(e){return isNaN(e=+e)?0:(0<e?yu:xu)(e)},_u=Math.min,fi=function(e){return 0<e?_u(sn(e),9007199254740991):0},Au=Math.max,Tu=Math.min,it=V(function(e){e=e.exports={version:"2.6.5"},typeof __e=="number"&&(__e=e)}),$=V(function(e){e=e.exports=typeof window!="undefined"&&Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),typeof __g=="number"&&(__g=e)}),xr=V(function(e){var i=$["__core-js_shared__"]||($["__core-js_shared__"]={});(e.exports=function(t,r){return i[t]||(i[t]=r!==void 0?r:{})})("versions",[]).push({version:it.version,mode:"pure",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),wu=0,Mu=Math.random(),hi=function(e){return"Symbol(".concat(e===void 0?"":e,")_",(++wu+Mu).toString(36))},Lo=xr("keys"),un=function(e){return Lo[e]||(Lo[e]=hi(e))},Cu=function(e){return function(i,t,r){i=te(i);var a=fi(i.length);if(r=sn(r),r=0>r?Au(r+a,0):Tu(r,a),e&&t!=t){for(;a>r;)if(t=i[r++],t!=t)return!0}else for(;a>r;r++)if((e||r in i)&&i[r]===t)return e||r||0;return!e&&-1}}(!1),Su=un("IE_PROTO"),Fo=function(e,i){e=te(e);var t=0,r=[],a;for(a in e)a!=Su&&ot(e,a)&&r.push(a);for(;i.length>t;)ot(e,a=i[t++])&&(~Cu(r,a)||r.push(a));return r},ci="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),qe=Object.keys||function(e){return Fo(e,ci)},be=function(e){if(typeof e!="function")throw TypeError(e+" is not a function!");return e},At=function(e,i,t){if(be(e),i===void 0)return e;switch(t){case 1:return function(r){return e.call(i,r)};case 2:return function(r,a){return e.call(i,r,a)};case 3:return function(r,a,n){return e.call(i,r,a,n)}}return function(){return e.apply(i,arguments)}},Et=function(e){return typeof e=="object"?e!==null:typeof e=="function"},Ft=function(e){if(!Et(e))throw TypeError(e+" is not an object!");return e},Ae=function(e){try{return!!e()}catch(i){return!0}},Xt=!Ae(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),$e=$.document,di=Et($e)&&Et($e.createElement),Do=!Xt&&!Ae(function(){return Object.defineProperty(di?$e.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),yr=function(e,i){if(!Et(e))return e;var t,r;if(i&&typeof(t=e.toString)=="function"&&!Et(r=t.call(e))||typeof(t=e.valueOf)=="function"&&!Et(r=t.call(e))||!i&&typeof(t=e.toString)=="function"&&!Et(r=t.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Pu=Object.defineProperty,kt={f:Xt?Object.defineProperty:function(e,i,t){if(Ft(e),i=yr(i,!0),Ft(t),Do)try{return Pu(e,i,t)}catch(r){}if("get"in t||"set"in t)throw TypeError("Accessors not supported!");return"value"in t&&(e[i]=t.value),e}},Te=function(e,i){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:i}},ue=Xt?function(e,i,t){return kt.f(e,i,Te(1,t))}:function(e,i,t){return e[i]=t,e},Rt=function(e,i,t){var r=e&Rt.F,a=e&Rt.G,n=e&Rt.S,s=e&Rt.P,o=e&Rt.B,u=e&Rt.W,h=a?it:it[i]||(it[i]={}),v=h.prototype;n=a?$:n?$[i]:($[i]||{}).prototype;var l;a&&(t=i);for(l in t)if(i=!r&&n&&n[l]!==void 0,!i||!ot(h,l)){var f=i?n[l]:t[l];h[l]=a&&typeof n[l]!="function"?t[l]:o&&i?At(f,$):u&&n[l]==f?function(d){var c=function(p,m,g){if(this instanceof d){switch(arguments.length){case 0:return new d;case 1:return new d(p);case 2:return new d(p,m)}return new d(p,m,g)}return d.apply(this,arguments)};return c.prototype=d.prototype,c}(f):s&&typeof f=="function"?At(Function.call,f):f,s&&((h.virtual||(h.virtual={}))[l]=f,e&Rt.R&&v&&!v[l]&&ue(v,l,f))}};Rt.F=1,Rt.G=2,Rt.S=4,Rt.P=8,Rt.B=16,Rt.W=32,Rt.U=64,Rt.R=128;var N=Rt,vi=function(e,i){var t=(it.Object||{})[e]||Object[e],r={};r[e]=i(t),N(N.S+N.F*Ae(function(){t(1)}),"Object",r)};vi("keys",function(){return function(e){return qe(Object(_e(e)))}});var Eu=it.Object.keys,Ru=V(function(e){e.exports={default:Eu,__esModule:!0}}),yt=tt(Ru),ln=Object.getOwnPropertySymbols,pi={}.propertyIsEnumerable,gi=Object.assign,Lu=!gi||Ae(function(){var e={},i={},t=Symbol();return e[t]=7,"abcdefghijklmnopqrst".split("").forEach(function(r){i[r]=r}),gi({},e)[t]!=7||Object.keys(gi({},i)).join("")!="abcdefghijklmnopqrst"})?function(e,i){for(var t=Object(_e(e)),r=arguments.length,a=1,n=ln,s=pi;r>a;)for(var o=an(arguments[a++]),u=n?qe(o).concat(n(o)):qe(o),h=u.length,v=0,l;h>v;)s.call(o,l=u[v++])&&(t[l]=o[l]);return t}:gi;N(N.S+N.F,"Object",{assign:Lu});var Fu=it.Object.assign,Du=V(function(e){e.exports={default:Fu,__esModule:!0}}),K=tt(Du),Bo=un("IE_PROTO"),Bu=Object.prototype,Oo=Object.getPrototypeOf||function(e){return e=Object(_e(e)),ot(e,Bo)?e[Bo]:typeof e.constructor=="function"&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Bu:null};vi("getPrototypeOf",function(){return function(e){return Oo(Object(_e(e)))}});var Ou=it.Object.getPrototypeOf,_r=V(function(e){e.exports={default:Ou,__esModule:!0}}),U=tt(_r);N(N.S+N.F*!Xt,"Object",{defineProperty:kt.f});var zu=it.Object,Iu=function(e,i,t){return zu.defineProperty(e,i,t)},le=V(function(e){e.exports={default:Iu,__esModule:!0}}),pt=tt(le),bu=V(function(e,i){i.__esModule=!0;var t=le&&le.__esModule?le:{default:le};i.default=function(){function r(a,n){for(var s=0;s<n.length;s++){var o=n[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,t.default)(a,o.key,o)}}return function(a,n,s){return n&&r(a.prototype,n),s&&r(a,s),a}}()}),I=tt(bu),ee={},ku=Xt?Object.defineProperties:function(e,i){Ft(e);for(var t=qe(i),r=t.length,a=0,n;r>a;)kt.f(e,n=t[a++],i[n]);return e},zo=$.document,fn=zo&&zo.documentElement,Uu=un("IE_PROTO"),hn=function(){},mi=function(){var e=di?$e.createElement("iframe"):{},i=ci.length;for(e.style.display="none",fn.appendChild(e),e.src="javascript:",e=e.contentWindow.document,e.open(),e.write("<script>document.F=Object<\/script>"),e.close(),mi=e.F;i--;)delete mi.prototype[ci[i]];return mi()},we=Object.create||function(e,i){if(e!==null){hn.prototype=Ft(e);var t=new hn;hn.prototype=null,t[Uu]=e}else t=mi();return i===void 0?t:ku(t,i)},_t=V(function(e){var i=xr("wks"),t=$.Symbol,r=typeof t=="function";(e.exports=function(a){return i[a]||(i[a]=r&&t[a]||(r?t:hi)("Symbol."+a))}).store=i}),Nu=kt.f,Io=_t("toStringTag"),ke=function(e,i,t){e&&!ot(e=t?e:e.prototype,Io)&&Nu(e,Io,{configurable:!0,value:i})},bo={};ue(bo,_t("iterator"),function(){return this});var ju=function(e,i,t){e.prototype=we(bo,{next:Te(1,t)}),ke(e,i+" Iterator")},cn=_t("iterator"),dn=!([].keys&&"next"in[].keys()),Hu=function(){return this},vn=function(e,i,t,r,a,n,s){ju(t,i,r),r=function(g){return!dn&&g in v?v[g]:function(){return new t(this,g)}};var o=i+" Iterator",u=a=="values",h=!1,v=e.prototype,l=v[cn]||v["@@iterator"]||a&&v[a],f=l||r(a),d=a?u?r("entries"):f:void 0,c=i=="Array"&&v.entries||l,p;if(c&&(e=Oo(c.call(new e)),e!==Object.prototype&&e.next&&ke(e,o,!0)),u&&l&&l.name!=="values"&&(h=!0,f=function(){return l.call(this)}),s&&(dn||h||!v[cn])&&ue(v,cn,f),ee[i]=f,ee[o]=Hu,a){var m={values:u?f:r("values"),keys:n?f:r("keys"),entries:d};if(s)for(p in m)p in v||ue(v,p,m[p]);else N(N.P+N.F*(dn||h),i,m)}return m},Xu=function(e){return function(i,t){i=String(_e(i)),t=sn(t);var r=i.length,a;if(0>t||t>=r)return e?"":void 0;var n=i.charCodeAt(t);return 55296>n||56319<n||t+1===r||56320>(a=i.charCodeAt(t+1))||57343<a?e?i.charAt(t):n:e?i.slice(t,t+2):(n-55296<<10)+(a-56320)+65536}}(!0);vn(String,"String",function(e){this._t=String(e),this._i=0},function(){var e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(e=Xu(e,i),this._i+=e.length,{value:e,done:!1})});var Me=function(e,i){return{value:i,done:!!e}};vn(Array,"Array",function(e,i){this._t=te(e),this._i=0,this._k=i},function(){var e=this._t,i=this._k,t=this._i++;return!e||t>=e.length?(this._t=void 0,Me(1)):i=="keys"?Me(0,t):i=="values"?Me(0,e[t]):Me(0,[t,e[t]])},"values"),ee.Arguments=ee.Array;for(var ko=_t("toStringTag"),Uo="CSSRuleList CSSStyleDeclaration CSSValueList ClientRectList DOMRectList DOMStringList DOMTokenList DataTransferItemList FileList HTMLAllCollection HTMLCollection HTMLFormElement HTMLSelectElement MediaList MimeTypeArray NamedNodeMap NodeList PaintRequestList Plugin PluginArray SVGLengthList SVGNumberList SVGPathSegList SVGPointList SVGStringList SVGTransformList SourceBufferList StyleSheetList TextTrackCueList TextTrackList TouchList".split(" "),pn=0;pn<Uo.length;pn++){var gn=Uo[pn],No=$[gn],mn=No&&No.prototype;mn&&!mn[ko]&&ue(mn,ko,gn),ee[gn]=ee.Array}var xi={f:_t},Wu=xi.f("iterator"),Ar=V(function(e){e.exports={default:Wu,__esModule:!0}});tt(Ar);var yi=V(function(e){var i=hi("meta"),t=kt.f,r=0,a=Object.isExtensible||function(){return!0},n=!Ae(function(){return a(Object.preventExtensions({}))}),s=function(u){t(u,i,{value:{i:"O"+ ++r,w:{}}})},o=e.exports={KEY:i,NEED:!1,fastKey:function(u,h){if(!Et(u))return typeof u=="symbol"?u:(typeof u=="string"?"S":"P")+u;if(!ot(u,i)){if(!a(u))return"F";if(!h)return"E";s(u)}return u[i].i},getWeak:function(u,h){if(!ot(u,i)){if(!a(u))return!0;if(!h)return!1;s(u)}return u[i].w},onFreeze:function(u){return n&&o.NEED&&a(u)&&!ot(u,i)&&s(u),u}}}),Yu=kt.f,xn=function(e){var i=it.Symbol||(it.Symbol={});e.charAt(0)=="_"||e in i||Yu(i,e,{value:xi.f(e)})},yn=Array.isArray||function(e){return Ie(e)=="Array"},Zu=ci.concat("length","prototype"),jo=Object.getOwnPropertyNames||function(e){return Fo(e,Zu)},Ho=jo,Vu={}.toString,Xo=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Wo=function(e){if(Xo&&Vu.call(e)=="[object Window]")try{var i=Ho(e)}catch(t){i=Xo.slice()}else i=Ho(te(e));return i},Yo=Object.getOwnPropertyDescriptor,_i={f:Xt?Yo:function(e,i){if(e=te(e),i=yr(i,!0),Do)try{return Yo(e,i)}catch(t){}if(ot(e,i))return Te(!pi.call(e,i),e[i])}},Gu=yi.KEY,Zo=_i.f,Ue=kt.f,Vo=Wo,Bt=$.Symbol,Ai=$.JSON,Ti=Ai&&Ai.stringify,Ot=_t("_hidden"),Go=_t("toPrimitive"),Ku={}.propertyIsEnumerable,Tr=xr("symbol-registry"),fe=xr("symbols"),wr=xr("op-symbols"),Vt=Object.prototype,tr=typeof Bt=="function",_n=$.QObject,An=!_n||!_n.prototype||!_n.prototype.findChild,Tn=Xt&&Ae(function(){return we(Ue({},"a",{get:function(){return Ue(this,"a",{value:7}).a}})).a!=7})?function(e,i,t){var r=Zo(Vt,i);r&&delete Vt[i],Ue(e,i,t),r&&e!==Vt&&Ue(Vt,i,r)}:Ue,Ko=function(e){var i=fe[e]=we(Bt.prototype);return i._k=e,i},wn=tr&&typeof Bt.iterator=="symbol"?function(e){return typeof e=="symbol"}:function(e){return e instanceof Bt},wi=function(e,i,t){return e===Vt&&wi(wr,i,t),Ft(e),i=yr(i,!0),Ft(t),ot(fe,i)?(t.enumerable?(ot(e,Ot)&&e[Ot][i]&&(e[Ot][i]=!1),t=we(t,{enumerable:Te(0,!1)})):(ot(e,Ot)||Ue(e,Ot,Te(1,{})),e[Ot][i]=!0),Tn(e,i,t)):Ue(e,i,t)},Qo=function(e,i){Ft(e);var t=i=te(i),r=qe(t),a=ln;if(a){a=a(t);for(var n=pi,s=0,o;a.length>s;)n.call(t,o=a[s++])&&r.push(o)}t=0,o=r.length;for(var u;o>t;)wi(e,u=r[t++],i[u]);return e},Qu=function(e){var i=Ku.call(this,e=yr(e,!0));return this===Vt&&ot(fe,e)&&!ot(wr,e)?!1:i||!ot(this,e)||!ot(fe,e)||ot(this,Ot)&&this[Ot][e]?i:!0},Jo=function(e,i){if(e=te(e),i=yr(i,!0),e!==Vt||!ot(fe,i)||ot(wr,i)){var t=Zo(e,i);return!t||!ot(fe,i)||ot(e,Ot)&&e[Ot][i]||(t.enumerable=!0),t}},qo=function(e){e=Vo(te(e));for(var i=[],t=0,r;e.length>t;)ot(fe,r=e[t++])||r==Ot||r==Gu||i.push(r);return i},$o=function(e){var i=e===Vt;e=Vo(i?wr:te(e));for(var t=[],r=0,a;e.length>r;)ot(fe,a=e[r++])&&(i?ot(Vt,a):1)&&t.push(fe[a]);return t};tr||(Bt=function(){if(this instanceof Bt)throw TypeError("Symbol is not a constructor!");var e=hi(0<arguments.length?arguments[0]:void 0),i=function(t){this===Vt&&i.call(wr,t),ot(this,Ot)&&ot(this[Ot],e)&&(this[Ot][e]=!1),Tn(this,e,Te(1,t))};return Xt&&An&&Tn(Vt,e,{configurable:!0,set:i}),Ko(e)},ue(Bt.prototype,"toString",function(){return this._k}),_i.f=Jo,kt.f=wi,jo=Wo=qo,pi=Qu,ln=$o,xi.f=function(e){return Ko(_t(e))}),N(N.G+N.W+N.F*!tr,{Symbol:Bt});for(var ta="hasInstance isConcatSpreadable iterator match replace search species split toPrimitive toStringTag unscopables".split(" "),ea=0;ta.length>ea;)_t(ta[ea++]);for(var ra=qe(_t.store),ia=0;ra.length>ia;)xn(ra[ia++]);N(N.S+N.F*!tr,"Symbol",{for:function(e){return ot(Tr,e+="")?Tr[e]:Tr[e]=Bt(e)},keyFor:function(e){if(!wn(e))throw TypeError(e+" is not a symbol!");for(var i in Tr)if(Tr[i]===e)return i},useSetter:function(){An=!0},useSimple:function(){An=!1}}),N(N.S+N.F*!tr,"Object",{create:function(e,i){return i===void 0?we(e):Qo(we(e),i)},defineProperty:wi,defineProperties:Qo,getOwnPropertyDescriptor:Jo,getOwnPropertyNames:qo,getOwnPropertySymbols:$o}),Ai&&N(N.S+N.F*(!tr||Ae(function(){var e=Bt();return Ti([e])!="[null]"||Ti({a:e})!="{}"||Ti(Object(e))!="{}"})),"JSON",{stringify:function(e){for(var i=[e],t=1,r;arguments.length>t;)i.push(arguments[t++]);if(r=t=i[1],(Et(t)||e!==void 0)&&!wn(e))return yn(t)||(t=function(a,n){if(typeof r=="function"&&(n=r.call(this,a,n)),!wn(n))return n}),i[1]=t,Ti.apply(Ai,i)}}),Bt.prototype[Go]||ue(Bt.prototype,Go,Bt.prototype.valueOf),ke(Bt,"Symbol"),ke(Math,"Math",!0),ke($.JSON,"JSON",!0),xn("asyncIterator"),xn("observable");var Ju=it.Symbol,Mr=V(function(e){e.exports={default:Ju,__esModule:!0}}),na=tt(Mr),er=V(function(e,i){i.__esModule=!0,e=Ar&&Ar.__esModule?Ar:{default:Ar};var t=Mr&&Mr.__esModule?Mr:{default:Mr},r=typeof t.default=="function"&&typeof e.default=="symbol"?function(a){return typeof a}:function(a){return a&&typeof t.default=="function"&&a.constructor===t.default&&a!==t.default.prototype?"symbol":typeof a};i.default=typeof t.default=="function"&&r(e.default)==="symbol"?function(a){return typeof a=="undefined"?"undefined":r(a)}:function(a){return a&&typeof t.default=="function"&&a.constructor===t.default&&a!==t.default.prototype?"symbol":typeof a=="undefined"?"undefined":r(a)}}),Ut=tt(er),qu=V(function(e,i){i.__esModule=!0;var t=er&&er.__esModule?er:{default:er};i.default=function(r,a){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||(typeof a=="undefined"?"undefined":(0,t.default)(a))!=="object"&&typeof a!="function"?r:a}}),W=tt(qu),$u=Object.setPrototypeOf||("__proto__"in{}?function(e,i,t){try{t=At(Function.call,_i.f(Object.prototype,"__proto__").set,2),t(e,[]),i=!(e instanceof Array)}catch(r){i=!0}return function(r,a){if(Ft(r),!Et(a)&&a!==null)throw TypeError(a+": can't set as prototype!");return i?r.__proto__=a:t(r,a),r}}({},!1):void 0);N(N.S,"Object",{setPrototypeOf:$u});var tl=it.Object.setPrototypeOf,oa=V(function(e){e.exports={default:tl,__esModule:!0}});tt(oa),N(N.S,"Object",{create:we});var el=it.Object,rl=function(e,i){return el.create(e,i)},aa=V(function(e){e.exports={default:rl,__esModule:!0}}),il=tt(aa),nl=V(function(e,i){function t(s){return s&&s.__esModule?s:{default:s}}i.__esModule=!0;var r=t(oa),a=t(aa),n=t(er);i.default=function(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+(typeof o=="undefined"?"undefined":(0,n.default)(o)));s.prototype=(0,a.default)(o&&o.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),o&&(r.default?(0,r.default)(s,o):s.__proto__=o)}}),Y=tt(nl),ol=_t("toStringTag"),al=Ie(function(){return arguments}())=="Arguments",Mi=function(e){var i;if(e===void 0)var t="Undefined";else{if(e===null)var r="Null";else{t:{var a=e=Object(e);try{r=a[ol];break t}catch(n){}r=void 0}r=typeof(t=r)=="string"?t:al?Ie(e):(i=Ie(e))=="Object"&&typeof e.callee=="function"?"Arguments":i}t=r}return t},sl=_t("iterator"),ul=it.isIterable=function(e){return e=Object(e),e[sl]!==void 0||"@@iterator"in e||ee.hasOwnProperty(Mi(e))},Cr=V(function(e){e.exports={default:ul,__esModule:!0}});tt(Cr);var ll=_t("iterator"),Mn=it.getIteratorMethod=function(e){if(e!=null)return e[ll]||e["@@iterator"]||ee[Mi(e)]},fl=it.getIterator=function(e){var i=Mn(e);if(typeof i!="function")throw TypeError(e+" is not iterable!");return Ft(i.call(e))},Sr=V(function(e){e.exports={default:fl,__esModule:!0}}),rr=tt(Sr),hl=V(function(e,i){i.__esModule=!0;var t=Cr&&Cr.__esModule?Cr:{default:Cr},r=Sr&&Sr.__esModule?Sr:{default:Sr};i.default=function(){return function(a,n){if(Array.isArray(a))return a;if((0,t.default)(Object(a))){var s=[],o=!0,u=!1,h=void 0;try{for(var v=(0,r.default)(a),l;!(o=(l=v.next()).done)&&(s.push(l.value),!n||s.length!==n);o=!0);}catch(f){u=!0,h=f}finally{try{!o&&v.return&&v.return()}finally{if(u)throw h}}return s}throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()}),nt=tt(hl),sa=function(e,i,t,r){try{return r?i(Ft(t)[0],t[1]):i(t)}catch(a){throw i=e.return,i!==void 0&&Ft(i.call(e)),a}},ua=_t("iterator"),la=Array.prototype,Cn=_t("iterator"),fa=!1;try{[7][Cn]().return=function(){fa=!0}}catch(e){}var ha=function(e,i){if(!i&&!fa)return!1;var t=!1;try{i=[7];var r=i[Cn]();r.next=function(){return{done:t=!0}},i[Cn]=function(){return r},e(i)}catch(a){}return t};N(N.S+N.F*!ha(function(e){}),"Array",{from:function(e){var i=Object(_e(e)),t=typeof this=="function"?this:Array,r=arguments.length,a=1<r?arguments[1]:void 0,n=a!==void 0,s=0,o=Mn(i),u;if(n&&(a=At(a,2<r?arguments[2]:void 0,2)),o!=null&&(t!=Array||o===void 0||ee.Array!==o&&la[ua]!==o))for(i=o.call(i),t=new t;!(u=i.next()).done;s++)r=t,o=s,u=n?sa(i,a,[u.value,s],!0):u.value,o in r?kt.f(r,o,Te(0,u)):r[o]=u;else for(r=fi(i.length),t=new t(r);r>s;s++){o=t,u=s;var h=n?a(i[s],s):i[s];u in o?kt.f(o,u,Te(0,h)):o[u]=h}return t.length=s,t}});var cl=it.Array.from,Pr=V(function(e){e.exports={default:cl,__esModule:!0}}),Ci=tt(Pr),dl=V(function(e,i){i.__esModule=!0;var t=Pr&&Pr.__esModule?Pr:{default:Pr};i.default=function(r){if(Array.isArray(r)){for(var a=0,n=Array(r.length);a<r.length;a++)n[a]=r[a];return n}return(0,t.default)(r)}}),Q=tt(dl),vl=yi.onFreeze;vi("freeze",function(e){return function(i){return e&&Et(i)?e(vl(i)):i}});var pl=it.Object.freeze,gl=V(function(e){e.exports={default:pl,__esModule:!0}}),ca=tt(gl),da=it.JSON||(it.JSON={stringify:JSON.stringify}),ml=function(e){return da.stringify.apply(da,arguments)},xl=V(function(e){e.exports={default:ml,__esModule:!0}}),Er=tt(xl),Gt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},yl=_i.f;vi("getOwnPropertyDescriptor",function(){return function(e,i){return yl(te(e),i)}});var _l=it.Object,Al=function(e,i){return _l.getOwnPropertyDescriptor(e,i)},Rr=V(function(e){e.exports={default:Al,__esModule:!0}}),vt=tt(Rr),Lr=V(function(e){var i=Array.prototype.concat,t=Array.prototype.slice,r=e.exports=function(a){for(var n=[],s=0,o=a.length;s<o;s++){var u=a[s],h=(h=u)&&typeof h!="string"?h instanceof Array||Array.isArray(h)||0<=h.length&&(h.splice instanceof Function||vt(h,h.length-1)&&h.constructor.name!=="String"):!1;h?n=i.call(n,t.call(u)):n.push(u)}return n};r.wrap=function(a){return function(){return a(r(arguments))}}}),Fr=V(function(e){function i(s,o,u){return Math.min(Math.max(o,s),u)}function t(s){return s=s.toString(16).toUpperCase(),2>s.length?"0"+s:s}var r={},a;for(a in Gt)Gt.hasOwnProperty(a)&&(r[Gt[a]]=a);var n=e.exports={to:{},get:{}};n.get=function(s){switch(s.substring(0,3).toLowerCase()){case"hsl":s=n.get.hsl(s);var o="hsl";break;case"hwb":s=n.get.hwb(s),o="hwb";break;default:s=n.get.rgb(s),o="rgb"}return s?{model:o,value:s}:null},n.get.rgb=function(s){if(!s)return null;var o=/^#([a-f0-9]{3,4})$/i,u=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,h=/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,v=/(\D+)/,l=[0,0,0,1],f;if(f=s.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(o=f[2],f=f[1],s=0;3>s;s++)u=2*s,l[s]=parseInt(f.slice(u,u+2),16);o&&(l[3]=Math.round(parseInt(o,16)/255*100)/100)}else if(f=s.match(o)){for(f=f[1],o=f[3],s=0;3>s;s++)l[s]=parseInt(f[s]+f[s],16);o&&(l[3]=Math.round(parseInt(o+o,16)/255*100)/100)}else if(f=s.match(u)){for(s=0;3>s;s++)l[s]=parseInt(f[s+1],0);f[4]&&(l[3]=parseFloat(f[4]))}else if(f=s.match(h)){for(s=0;3>s;s++)l[s]=Math.round(2.55*parseFloat(f[s+1]));f[4]&&(l[3]=parseFloat(f[4]))}else return(f=s.match(v))?f[1]==="transparent"?[0,0,0,0]:(l=Gt[f[1]],l?(l[3]=1,l):null):null;for(s=0;3>s;s++)l[s]=i(l[s],0,255);return l[3]=i(l[3],0,1),l},n.get.hsl=function(s){if(!s)return null;var o=s.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(o){var u=parseFloat(o[4]);s=(parseFloat(o[1])+360)%360;var h=i(parseFloat(o[2]),0,100);return o=i(parseFloat(o[3]),0,100),u=i(isNaN(u)?1:u,0,1),[s,h,o,u]}return null},n.get.hwb=function(s){if(!s)return null;var o=s.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(o){var u=parseFloat(o[4]);s=(parseFloat(o[1])%360+360)%360;var h=i(parseFloat(o[2]),0,100);return o=i(parseFloat(o[3]),0,100),u=i(isNaN(u)?1:u,0,1),[s,h,o,u]}return null},n.to.hex=function(){var s=Lr(arguments);return"#"+t(s[0])+t(s[1])+t(s[2])+(1>s[3]?t(Math.round(255*s[3])):"")},n.to.rgb=function(){var s=Lr(arguments);return 4>s.length||s[3]===1?"rgb("+Math.round(s[0])+", "+Math.round(s[1])+", "+Math.round(s[2])+")":"rgba("+Math.round(s[0])+", "+Math.round(s[1])+", "+Math.round(s[2])+", "+s[3]+")"},n.to.rgb.percent=function(){var s=Lr(arguments),o=Math.round(s[0]/255*100),u=Math.round(s[1]/255*100),h=Math.round(s[2]/255*100);return 4>s.length||s[3]===1?"rgb("+o+"%, "+u+"%, "+h+"%)":"rgba("+o+"%, "+u+"%, "+h+"%, "+s[3]+")"},n.to.hsl=function(){var s=Lr(arguments);return 4>s.length||s[3]===1?"hsl("+s[0]+", "+s[1]+"%, "+s[2]+"%)":"hsla("+s[0]+", "+s[1]+"%, "+s[2]+"%, "+s[3]+")"},n.to.hwb=function(){var s=Lr(arguments),o="";return 4<=s.length&&s[3]!==1&&(o=", "+s[3]),"hwb("+s[0]+", "+s[1]+"%, "+s[2]+"%"+o+")"},n.to.keyword=function(s){return r[s.slice(0,3)]}}),Ne=V(function(e){var i={};for(a in Gt)Gt.hasOwnProperty(a)&&(i[Gt[a]]=a);var t=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},r;for(r in t)if(t.hasOwnProperty(r)){if(!("channels"in t[r]))throw Error("missing channels property: "+r);if(!("labels"in t[r]))throw Error("missing channel labels property: "+r);if(t[r].labels.length!==t[r].channels)throw Error("channel and label counts mismatch: "+r);e=t[r].channels;var a=t[r].labels;delete t[r].channels,delete t[r].labels,Object.defineProperty(t[r],"channels",{value:e}),Object.defineProperty(t[r],"labels",{value:a})}t.rgb.hsl=function(n){var s=n[0]/255,o=n[1]/255,u=n[2]/255;n=Math.min(s,o,u);var h=Math.max(s,o,u),v=h-n,l;return h===n?l=0:s===h?l=(o-u)/v:o===h?l=2+(u-s)/v:u===h&&(l=4+(s-o)/v),l=Math.min(60*l,360),0>l&&(l+=360),s=(n+h)/2,[l,100*(h===n?0:.5>=s?v/(h+n):v/(2-h-n)),100*s]},t.rgb.hsv=function(n){var s,o=n[0]/255,u=n[1]/255,h=n[2]/255,v=Math.max(o,u,h),l=v-Math.min(o,u,h);if(l===0)var f=s=0;else{s=l/v,n=(v-o)/6/l+.5;var d=(v-u)/6/l+.5;l=(v-h)/6/l+.5,o===v?f=l-d:u===v?f=1/3+n-l:h===v&&(f=2/3+d-n),0>f?f+=1:1<f&&--f}return[360*f,100*s,100*v]},t.rgb.hwb=function(n){var s=n[0],o=n[1],u=n[2];n=t.rgb.hsl(n)[0];var h=1/255*Math.min(s,Math.min(o,u));return u=1-1/255*Math.max(s,Math.max(o,u)),[n,100*h,100*u]},t.rgb.cmyk=function(n){var s=n[0]/255,o=n[1]/255;n=n[2]/255;var u=Math.min(1-s,1-o,1-n);return[100*((1-s-u)/(1-u)||0),100*((1-o-u)/(1-u)||0),100*((1-n-u)/(1-u)||0),100*u]},t.rgb.keyword=function(n){var s=i[n];if(s)return s;s=1/0;var o;for(o in Gt)if(Gt.hasOwnProperty(o)){var u=Gt[o];if(u=Math.pow(n[0]-u[0],2)+Math.pow(n[1]-u[1],2)+Math.pow(n[2]-u[2],2),u<s){s=u;var h=o}}return h},t.keyword.rgb=function(n){return Gt[n]},t.rgb.xyz=function(n){var s=n[0]/255,o=n[1]/255;return n=n[2]/255,s=.04045<s?Math.pow((s+.055)/1.055,2.4):s/12.92,o=.04045<o?Math.pow((o+.055)/1.055,2.4):o/12.92,n=.04045<n?Math.pow((n+.055)/1.055,2.4):n/12.92,[100*(.4124*s+.3576*o+.1805*n),100*(.2126*s+.7152*o+.0722*n),100*(.0193*s+.1192*o+.9505*n)]},t.rgb.lab=function(n){var s=t.rgb.xyz(n);n=s[0];var o=s[1];return s=s[2],n/=95.047,o/=100,s/=108.883,n=.008856<n?Math.pow(n,1/3):7.787*n+16/116,o=.008856<o?Math.pow(o,1/3):7.787*o+16/116,s=.008856<s?Math.pow(s,1/3):7.787*s+16/116,[116*o-16,500*(n-o),200*(o-s)]},t.hsl.rgb=function(n){var s=n[0]/360,o=n[1]/100;if(n=n[2]/100,o===0){var u=255*n;return[u,u,u]}o=.5>n?n*(1+o):n+o-n*o,n=2*n-o;for(var h=[0,0,0],v=0;3>v;v++)u=s+1/3*-(v-1),0>u&&u++,1<u&&u--,u=1>6*u?n+6*(o-n)*u:1>2*u?o:2>3*u?n+(o-n)*(2/3-u)*6:n,h[v]=255*u;return h},t.hsl.hsv=function(n){var s=n[0],o=n[1]/100;n=n[2]/100;var u=o,h=Math.max(n,.01);return n*=2,o*=1>=n?n:2-n,u*=1>=h?h:2-h,[s,100*(n===0?2*u/(h+u):2*o/(n+o)),(n+o)/2*100]},t.hsv.rgb=function(n){var s=n[0]/60,o=n[1]/100;n=n[2]/100;var u=Math.floor(s)%6,h=s-Math.floor(s);s=255*n*(1-o);var v=255*n*(1-o*h);switch(o=255*n*(1-o*(1-h)),n*=255,u){case 0:return[n,o,s];case 1:return[v,n,s];case 2:return[s,n,o];case 3:return[s,v,n];case 4:return[o,s,n];case 5:return[n,s,v]}},t.hsv.hsl=function(n){var s=n[0],o=n[1]/100;n=n[2]/100;var u=Math.max(n,.01),h=(2-o)*u;return u=o*u/(1>=h?h:2-h)||0,[s,100*u,(2-o)*n/2*100]},t.hwb.rgb=function(n){var s=n[0]/360,o=n[1]/100;n=n[2]/100;var u=o+n;switch(1<u&&(o/=u,n/=u),u=Math.floor(6*s),n=1-n,s=6*s-u,(u&1)!==0&&(s=1-s),s=o+s*(n-o),u){default:case 6:case 0:u=n;var h=s;break;case 1:u=s,h=n;break;case 2:u=o,h=n,o=s;break;case 3:u=o,h=s,o=n;break;case 4:u=s,h=o,o=n;break;case 5:u=n,h=o,o=s}return[255*u,255*h,255*o]},t.cmyk.rgb=function(n){var s=n[3]/100;return[255*(1-Math.min(1,n[0]/100*(1-s)+s)),255*(1-Math.min(1,n[1]/100*(1-s)+s)),255*(1-Math.min(1,n[2]/100*(1-s)+s))]},t.xyz.rgb=function(n){var s=n[0]/100,o=n[1]/100,u=n[2]/100;n=3.2406*s+-1.5372*o+-.4986*u;var h=-.9689*s+1.8758*o+.0415*u;return s=.0557*s+-.204*o+1.057*u,n=.0031308<n?1.055*Math.pow(n,1/2.4)-.055:12.92*n,h=.0031308<h?1.055*Math.pow(h,1/2.4)-.055:12.92*h,s=.0031308<s?1.055*Math.pow(s,1/2.4)-.055:12.92*s,n=Math.min(Math.max(0,n),1),h=Math.min(Math.max(0,h),1),s=Math.min(Math.max(0,s),1),[255*n,255*h,255*s]},t.xyz.lab=function(n){var s=n[0],o=n[1];return n=n[2],s/=95.047,o/=100,n/=108.883,s=.008856<s?Math.pow(s,1/3):7.787*s+16/116,o=.008856<o?Math.pow(o,1/3):7.787*o+16/116,n=.008856<n?Math.pow(n,1/3):7.787*n+16/116,[116*o-16,500*(s-o),200*(o-n)]},t.lab.xyz=function(n){var s=n[1],o=n[2];n=(n[0]+16)/116,s=s/500+n,o=n-o/200;var u=Math.pow(n,3),h=Math.pow(s,3),v=Math.pow(o,3);return[95.047*(.008856<h?h:(s-16/116)/7.787),100*(.008856<u?u:(n-16/116)/7.787),108.883*(.008856<v?v:(o-16/116)/7.787)]},t.lab.lch=function(n){var s=n[0],o=n[1];n=n[2];var u=360*Math.atan2(n,o)/2/Math.PI;return 0>u&&(u+=360),[s,Math.sqrt(o*o+n*n),u]},t.lch.lab=function(n){var s=n[0],o=n[1];return n=n[2]/360*2*Math.PI,[s,o*Math.cos(n),o*Math.sin(n)]},t.rgb.ansi16=function(n){var s=n[0],o=n[1],u=n[2],h=1 in arguments?arguments[1]:t.rgb.hsv(n)[2];return h=Math.round(h/50),h===0?30:(s=30+(Math.round(u/255)<<2|Math.round(o/255)<<1|Math.round(s/255)),h===2&&(s+=60),s)},t.hsv.ansi16=function(n){return t.rgb.ansi16(t.hsv.rgb(n),n[2])},t.rgb.ansi256=function(n){var s=n[0],o=n[1];return n=n[2],s===o&&o===n?8>s?16:248<s?231:Math.round((s-8)/247*24)+232:16+36*Math.round(s/255*5)+6*Math.round(o/255*5)+Math.round(n/255*5)},t.ansi16.rgb=function(n){var s=n%10;return s===0||s===7?(50<n&&(s+=3.5),s=s/10.5*255,[s,s,s]):(n=.5*(~~(50<n)+1),[(s&1)*n*255,(s>>1&1)*n*255,(s>>2&1)*n*255])},t.ansi256.rgb=function(n){if(232<=n){var s=10*(n-232)+8;return[s,s,s]}n-=16,s=Math.floor(n/36)/5*255;var o=Math.floor((n%=36)/6)/5*255;return[s,o,n%6/5*255]},t.rgb.hex=function(n){return n=(((Math.round(n[0])&255)<<16)+((Math.round(n[1])&255)<<8)+(Math.round(n[2])&255)).toString(16).toUpperCase(),"000000".substring(n.length)+n},t.hex.rgb=function(n){if(n=n.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i),!n)return[0,0,0];var s=n[0];return n[0].length===3&&(s=s.split("").map(function(o){return o+o}).join("")),n=parseInt(s,16),[n>>16&255,n>>8&255,n&255]},t.rgb.hcg=function(n){var s=n[0]/255,o=n[1]/255;n=n[2]/255;var u=Math.max(Math.max(s,o),n),h=Math.min(Math.min(s,o),n),v=u-h;return[(0>=v?0:u===s?(o-n)/v%6:u===o?2+(n-s)/v:(s-o)/v+8)/6%1*360,100*v,100*(1>v?h/(1-v):0)]},t.hsl.hcg=function(n){var s=n[1]/100,o=n[2]/100,u=0;return s=.5>o?2*s*o:2*s*(1-o),1>s&&(u=(o-.5*s)/(1-s)),[n[0],100*s,100*u]},t.hsv.hcg=function(n){var s=n[2]/100,o=n[1]/100*s,u=0;return 1>o&&(u=(s-o)/(1-o)),[n[0],100*o,100*u]},t.hcg.rgb=function(n){var s=n[1]/100,o=n[2]/100;if(s===0)return[255*o,255*o,255*o];var u=[0,0,0];n=n[0]/360%1*6;var h=n%1,v=1-h;switch(Math.floor(n)){case 0:u[0]=1,u[1]=h,u[2]=0;break;case 1:u[0]=v,u[1]=1,u[2]=0;break;case 2:u[0]=0,u[1]=1,u[2]=h;break;case 3:u[0]=0,u[1]=v,u[2]=1;break;case 4:u[0]=h,u[1]=0,u[2]=1;break;default:u[0]=1,u[1]=0,u[2]=v}return o*=1-s,[255*(s*u[0]+o),255*(s*u[1]+o),255*(s*u[2]+o)]},t.hcg.hsv=function(n){var s=n[1]/100,o=s+n[2]/100*(1-s),u=0;return 0<o&&(u=s/o),[n[0],100*u,100*o]},t.hcg.hsl=function(n){var s=n[1]/100,o=n[2]/100*(1-s)+.5*s,u=0;return 0<o&&.5>o?u=s/(2*o):.5<=o&&1>o&&(u=s/(2*(1-o))),[n[0],100*u,100*o]},t.hcg.hwb=function(n){var s=n[1]/100,o=s+n[2]/100*(1-s);return[n[0],100*(o-s),100*(1-o)]},t.hwb.hcg=function(n){var s=1-n[2]/100,o=s-n[1]/100,u=0;return 1>o&&(u=(s-o)/(1-o)),[n[0],100*o,100*u]},t.apple.rgb=function(n){return[n[0]/65535*255,n[1]/65535*255,n[2]/65535*255]},t.rgb.apple=function(n){return[n[0]/255*65535,n[1]/255*65535,n[2]/255*65535]},t.gray.rgb=function(n){return[n[0]/100*255,n[0]/100*255,n[0]/100*255]},t.gray.hsl=t.gray.hsv=function(n){return[0,0,n[0]]},t.gray.hwb=function(n){return[0,100,n[0]]},t.gray.cmyk=function(n){return[0,0,0,n[0]]},t.gray.lab=function(n){return[n[0],0,0]},t.gray.hex=function(n){return n=Math.round(n[0]/100*255)&255,n=((n<<16)+(n<<8)+n).toString(16).toUpperCase(),"000000".substring(n.length)+n},t.rgb.gray=function(n){return[(n[0]+n[1]+n[2])/3/255*100]}}),Tl=function(e){for(var i={},t=yt(Ne),r=t.length,a=0;a<r;a++)i[t[a]]={distance:-1,parent:null};for(t=[e],i[e].distance=0;t.length;){e=t.pop(),r=yt(Ne[e]),a=r.length;for(var n=0;n<a;n++){var s=r[n],o=i[s];o.distance===-1&&(o.distance=i[e].distance+1,o.parent=e,t.unshift(s))}}for(t={},e=yt(i),r=e.length,a=0;a<r;a++){var u=e[a];if(i[u].parent!==null){n=u,s=i,o=[s[u].parent,u];var h=Ne[s[u].parent][u];for(u=s[u].parent;s[u].parent;)o.unshift(s[u].parent),h=Gs(Ne[s[u].parent][u],h),u=s[u].parent;h.conversion=o,t[n]=h}}return t},ir={};yt(Ne).forEach(function(e){ir[e]={},Object.defineProperty(ir[e],"channels",{value:Ne[e].channels}),Object.defineProperty(ir[e],"labels",{value:Ne[e].labels});var i=Tl(e);yt(i).forEach(function(t){var r=i[t];ir[e][t]=Qs(r),ir[e][t].raw=Ks(r)})});var Nt=ir,Sn=[].slice,va=["keyword","gray","hex"],Pn={};yt(Nt).forEach(function(e){Pn[Sn.call(Nt[e].labels).sort().join("")]=e});var Si={};mt.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var i=this.model in Fr.to?this:this.rgb();return i=i.round(typeof e=="number"?e:1),e=i.valpha===1?i.color:i.color.concat(this.valpha),Fr.to[i.model](e)},percentString:function(e){return e=this.rgb().round(typeof e=="number"?e:1),e=e.valpha===1?e.color:e.color.concat(this.valpha),Fr.to.rgb.percent(e)},array:function(){return this.valpha===1?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},i=Nt[this.model].channels,t=Nt[this.model].labels,r=0;r<i;r++)e[t[r]]=this.color[r];return this.valpha!==1&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,this.valpha!==1&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,this.valpha!==1&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new mt(this.color.map(Js(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new mt(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:ct("rgb",0,xt(255)),green:ct("rgb",1,xt(255)),blue:ct("rgb",2,xt(255)),hue:ct(["hsl","hsv","hsl","hwb","hcg"],0,function(e){return(e%360+360)%360}),saturationl:ct("hsl",1,xt(100)),lightness:ct("hsl",2,xt(100)),saturationv:ct("hsv",1,xt(100)),value:ct("hsv",2,xt(100)),chroma:ct("hcg",1,xt(100)),gray:ct("hcg",2,xt(100)),white:ct("hwb",1,xt(100)),wblack:ct("hwb",2,xt(100)),cyan:ct("cmyk",0,xt(100)),magenta:ct("cmyk",1,xt(100)),yellow:ct("cmyk",2,xt(100)),black:ct("cmyk",3,xt(100)),x:ct("xyz",0,xt(100)),y:ct("xyz",1,xt(100)),z:ct("xyz",2,xt(100)),l:ct("lab",0,xt(100)),a:ct("lab",1),b:ct("lab",2),keyword:function(e){return arguments.length?new mt(e):Nt[this.model].keyword(this.color)},hex:function(e){return arguments.length?new mt(e):Fr.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(e[0]&255)<<16|(e[1]&255)<<8|e[2]&255},luminosity:function(){for(var e=this.rgb().color,i=[],t=0;t<e.length;t++){var r=e[t]/255;i[t]=.03928>=r?r/12.92:Math.pow((r+.055)/1.055,2.4)}return .2126*i[0]+.7152*i[1]+.0722*i[2]},contrast:function(e){var i=this.luminosity();return e=e.luminosity(),i>e?(i+.05)/(e+.05):(e+.05)/(i+.05)},level:function(e){return e=this.contrast(e),7.1<=e?"AAA":4.5<=e?"AA":""},isDark:function(){var e=this.rgb().color;return 128>(299*e[0]+587*e[1]+114*e[2])/1e3},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),i=0;3>i;i++)e.color[i]=255-e.color[i];return e},lighten:function(e){var i=this.hsl();return i.color[2]+=i.color[2]*e,i},darken:function(e){var i=this.hsl();return i.color[2]-=i.color[2]*e,i},saturate:function(e){var i=this.hsl();return i.color[1]+=i.color[1]*e,i},desaturate:function(e){var i=this.hsl();return i.color[1]-=i.color[1]*e,i},whiten:function(e){var i=this.hwb();return i.color[1]+=i.color[1]*e,i},blacken:function(e){var i=this.hwb();return i.color[2]+=i.color[2]*e,i},grayscale:function(){var e=this.rgb().color;return e=.3*e[0]+.59*e[1]+.11*e[2],mt.rgb(e,e,e)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var i=this.hsl(),t=i.color[0];return t=(t+e)%360,i.color[0]=0>t?360+t:t,i},mix:function(e,i){if(!e||!e.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+(typeof e=="undefined"?"undefined":Ut(e)));e=e.rgb();var t=this.rgb();i=i===void 0?.5:i;var r=2*i-1,a=e.alpha()-t.alpha();return r=((r*a===-1?r:(r+a)/(1+r*a))+1)/2,a=1-r,mt.rgb(r*e.red()+a*t.red(),r*e.green()+a*t.green(),r*e.blue()+a*t.blue(),e.alpha()*i+t.alpha()*(1-i))}},yt(Nt).forEach(function(e){if(va.indexOf(e)===-1){var i=Nt[e].channels;mt.prototype[e]=function(){if(this.model===e)return new mt(this);if(arguments.length)return new mt(arguments,e);var t=typeof arguments[i]=="number"?i:this.valpha,r=Nt[this.model][e].raw(this.color);return r=Array.isArray(r)?r:[r],new mt(r.concat(t),e)},mt[e]=function(t){return typeof t=="number"&&(t=Xi(Sn.call(arguments),i)),new mt(t,e)}}}),Gi(bt.prototype,{equals:function(e){return this.lat===e.lat&&this.lng===e.lng},clone:function(){return new bt(this.lat,this.lng)},getLngSpan:function(e){return e=Math.abs(e-this.lng),180<e&&(e=360-e),e},sub:function(e){return new bt(this.lat-e.lat,this.lng-e.lng)},toString:function(){return"Point"}}),Gi(Lt,{EARTHRADIUS:637099681e-2,MCBAND:[1289059486e-2,836237787e-2,5591021,348198983e-2,167804312e-2,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1410526172116255e-23,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,173379812e-1],[-7435856389565537e-24,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1026014486e-2],[-3030883460898826e-23,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,685681737e-2],[-1981981304930552e-23,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,448277706e-2],[309191371068437e-23,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,25551644e-1],[2890871144776878e-24,8983055095805407e-21,-3068298e-14,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,6477955746671607e-7,-4082003173641316e-6,1077490566351142e-5,-1517187553151559e-5,1205306533862167e-5,-5124939663577472e-6,9133119359512032e-7,67.5],[.00337398766765,111320.7020202162,4481351045890365e-9,-2339375119931662e-8,7968221547186455e-8,-1159649932797253e-7,9723671115602145e-8,-4366194633752821e-8,8477230501135234e-9,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837749470245e-9,992013.7397791013,-122195221711287e-8,1340652697009075e-9,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758690035394e-9,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(e,i){if(!e||!i||(e=this.convertMC2LL(e),!e))return 0;var t=this.toRadians(e.lng);if(e=this.toRadians(e.lat),i=this.convertMC2LL(i),!i)return 0;var r=this.toRadians(i.lng);return i=this.toRadians(i.lat),this.getDistance(t,r,e,i)},getDistanceByLL:function(e,i){if(!e||!i)return 0;e.lng=this.getLoop(e.lng,-180,180),e.lat=this.getRange(e.lat,-74,74),i.lng=this.getLoop(i.lng,-180,180),i.lat=this.getRange(i.lat,-74,74);var t=this.toRadians(e.lng),r=this.toRadians(e.lat);return e=this.toRadians(i.lng),i=this.toRadians(i.lat),this.getDistance(t,e,r,i)},convertMC2LL:function(e){if(e==null)return new bt(0,0);if(180>e.lng&&-180<e.lng&&90>e.lat&&-90<e.lat)return e;for(var i=new bt(Math.abs(e.lng),Math.abs(e.lat)),t=0;t<this.MCBAND.length;t++)if(i.lat>=this.MCBAND[t]){var r=this.MC2LL[t];break}return e=this.convertor(e,r),e=new bt(e.lng.toFixed(6),e.lat.toFixed(6))},convertLL2MC:function(e){if(e==null)return new bt(0,0);if(180<e.lng||-180>e.lng||90<e.lat||-90>e.lat)return e;e.lng=this.getLoop(e.lng,-180,180),e.lat=this.getRange(e.lat,-74,74);for(var i=new bt(e.lng,e.lat),t=0;t<this.LLBAND.length;t++)if(i.lat>=this.LLBAND[t]){var r=this.LL2MC[t];break}if(!r){for(t=0;t<this.LLBAND.length;t++)if(i.lat<=-this.LLBAND[t]){r=this.LL2MC[t];break}}return e=this.convertor(e,r),e=new bt(Number(e.lng.toFixed(2)),Number(e.lat.toFixed(2)))},convertor:function(e,i){if(e&&i){var t=i[0]+i[1]*Math.abs(e.lng),r=Math.abs(e.lat)/i[9];return i=i[2]+i[3]*r+i[4]*r*r+i[5]*r*r*r+i[6]*r*r*r*r+i[7]*r*r*r*r*r+i[8]*r*r*r*r*r*r,t*=0>e.lng?-1:1,i*=0>e.lat?-1:1,new bt(t,i)}},getDistance:function(e,i,t,r){return this.EARTHRADIUS*Math.acos(Math.sin(t)*Math.sin(r)+Math.cos(t)*Math.cos(r)*Math.cos(i-e))},toRadians:function(e){return Math.PI*e/180},toDegrees:function(e){return 180*e/Math.PI},getRange:function(e,i,t){return i!=null&&(e=Math.max(e,i)),t!=null&&(e=Math.min(e,t)),e},getLoop:function(e,i,t){for(;e>t;)e-=t-i;for(;e<i;)e+=t-i;return e}}),Gi(Lt.prototype,{lngLatToMercator:function(e){return Lt.convertLL2MC(e)},lngLatToPoint:function(e){return e=Lt.convertLL2MC(e),new po(e.lng,e.lat)},mercatorToLngLat:function(e){return Lt.convertMC2LL(e)},pointToLngLat:function(e){return e=new bt(e.x,e.y),Lt.convertMC2LL(e)},pointToPixel:function(e,i,t,r,a){if(e)return e=this.lngLatToMercator(e,a),i=this.getZoomUnits(i),new po(Math.round((e.lng-t.lng)/i+r.width/2),Math.round((t.lat-e.lat)/i+r.height/2))},pixelToPoint:function(e,i,t,r,a){if(e)return i=this.getZoomUnits(i),e=new bt(t.lng+i*(e.x-r.width/2),t.lat-i*(e.y-r.height/2)),this.mercatorToLngLat(e,a)},getZoomUnits:function(e){return Math.pow(2,18-e)}}),St.prototype.setMax=function(e){this.max=e||100},St.prototype.setMin=function(e){this.min=e||0},St.prototype.setMaxSize=function(e){this.maxSize=e||35},St.prototype.setMinSize=function(e){this.minSize=e||0},St.prototype.initPalette=function(){var e=this.gradient,i=this.paletteCtx=new Ki(256,1).getContext("2d"),t=i.createLinearGradient(0,0,256,1);yt(e).forEach(function(r){t.addColorStop(parseFloat(r),e[r])}),i.fillStyle=t,i.fillRect(0,0,256,1),i.imageData=i.getImageData(0,0,256,1).data},St.prototype.getColor=function(e){return e=this.getImageData(e),"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]/256+")"},St.prototype.getImageData=function(e){var i=this.paletteCtx.imageData;if(e===void 0)return i;var t=this.max,r=this.min;return e>t&&(e=t),e<r&&(e=r),e=4*Math.floor((e-r)/(t-r)*255),[i[e],i[e+1],i[e+2],i[e+3]]},St.prototype.getSize=function(e){var i=this.max,t=this.min,r=this.maxSize,a=this.minSize;return e>i&&(e=i),e<t&&(e=t),a+(e-t)/(i-t)*(r-a)},ae.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start),this.v3=this._normalizaCoord(this.options.end),this.v1=this._getControlPoint(this.v0,this.v3,4),this.v2=this._getControlPoint(this.v3,this.v0,5),this.v0[2]||(this.v0[2]=0),this.v3[2]||(this.v3[2]=0)},ae.prototype.setOptions=function(e){this.options=e||{},this._initialize()},ae.prototype.getPoints=function(e){e===void 0&&(e=20);for(var i=[],t=0;t<=e;t++)i.push(this._getPoint(t/e));return i},ae.prototype._normalizaCoord=function(e){return e?(e=Lt.convertLL2MC({lng:Number(e[0]),lat:Number(e[1])}),[e.lng,e.lat]):[]},ae.prototype._getControlPoint=function(e,i){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return[].concat(Q(this._getQuarter(e,i)),[this._getDistance(e,i)/t])},ae.prototype._getQuarter=function(e,i){return[(3*e[0]+i[0])/4,(3*e[1]+i[1])/4]},ae.prototype._getDistance=function(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))},ae.prototype._getPoint=function(e){var i=[],t=this.v0,r=this.v1,a=this.v2,n=this.v3;return i.push(Qi(e,t[0],r[0],a[0],n[0]),Qi(e,t[1],r[1],a[1],n[1]),Qi(e,t[2],r[2],a[2],n[2])),i},me.prototype._initialize=function(){this.points=this.options.points||this.options.point||[],this.greatCirclePoints=[];for(var e=[],i=0;i<this.points.length;i++){var t=this._normalizaCoord(this.points[i]);t&&e.push(t)}this.points=e},me.prototype.setOptions=function(e){this.options=e||{},this._initialize()},me.prototype.getPoints=function(){if(this.greatCirclePoints.length===0)for(var e=0;e<this.points.length-1;e++)this._calcGreatCirclePoints(this.points[e],this.points[e+1]);return this.greatCirclePoints},me.prototype._normalizaCoord=function(e){if(!e)return null;e instanceof Array&&(e={lng:Number(e[0]),lat:Number(e[1])});var i=Lt.convertLL2MC(e);return e=Lt.convertMC2LL(e),i.latLng=e,i},me.prototype._calcGreatCirclePoints=function(e,i){var t=e.latLng,r=i.latLng;if(!Zi(t.lng,r.lng)||!Zi(t.lat,r.lat)){var a=Lt.getDistance(Mt(t.lng),Mt(t.lat),Mt(r.lng),Mt(r.lat));if(!(25e4>a)){a=Math.round(a/15e4);var n=this._calcAngularDistance(t,r);this.greatCirclePoints.push([e.lng,e.lat]);for(var s=0;s<a;s++){var o=this._calcMiddlePoint(t,r,s/a,n);o=Lt.convertLL2MC(o);var u=go(o,e);30037726<u&&(o.lng=o.lng<e.lng?o.lng+this.WORLD_SIZE_MC:o.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([o.lng,o.lat]),e=o}u=go(i,e),30037726<u&&(i.lng=i.lng<e.lng?i.lng+this.WORLD_SIZE_MC:i.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([i.lng,i.lat])}}},me.prototype._calcAngularDistance=function(e,i){var t=Mt(e.lat),r=Mt(i.lat);return e=Mt(e.lng),i=Mt(i.lng),Math.acos(Math.sin(t)*Math.sin(r)+Math.cos(t)*Math.cos(r)*Math.cos(Math.abs(i-e)))},me.prototype._calcMiddlePoint=function(e,i,t,r){var a=i.lat,n=e.lng;i=i.lng,e=Mt(e.lat),a=Mt(a),n=Mt(n);var s=Mt(i);return i=Math.sin((1-t)*r)/Math.sin(r),r=Math.sin(t*r)/Math.sin(r),t=i*Math.cos(e)*Math.cos(n)+r*Math.cos(a)*Math.cos(s),n=i*Math.cos(e)*Math.sin(n)+r*Math.cos(a)*Math.sin(s),e=Math.atan2(i*Math.sin(e)+r*Math.sin(a),Math.sqrt(Math.pow(t,2)+Math.pow(n,2))),new bt(Wi(Math.atan2(n,t)),Wi(e))};var wl=function(){function e(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};O(this,e),this.options=i,this._initialize()}return I(e,[{key:"_initialize",value:function(){this.points=this.options.points}},{key:"_normalizaCoord",value:function(i){return i?(i instanceof Array&&(i={lng:Number(i[0]),lat:Number(i[1])}),Lt.convertLL2MC(i)):null}},{key:"setOptions",value:function(){this.options=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},this._initialize()}},{key:"getPoints",value:function(i){for(var t=[],r=this.points,a=0;a<r.length-1;a++){var n=this.getCurveByTwoPoints(this._normalizaCoord(r[a]),this._normalizaCoord(r[a+1]),i);n&&0<n.length&&(t=t.concat(n))}return t}},{key:"getCurveByTwoPoints",value:function(i,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:20;if(!i||!t)return null;var a=[],n=0;if((typeof t=="undefined"?"undefined":Ut(t))===void 0)typeof a=="undefined"||Ut(a);else{var s=parseFloat(i.lat),o=parseFloat(t.lat),u=parseFloat(i.lng),h=parseFloat(t.lng);h>u&&180<parseFloat(h-u)&&0>u&&(u=parseFloat(360+u),h=parseFloat(360+h));var v=0;if(o===s)var l=0,f=u-h;else h===u?(l=Math.PI/2,f=s-o):(l=Math.atan((o-s)/(h-u)),f=(o-s)/Math.sin(l));for(v===0&&(v=l+Math.PI/5),f/=2,l=f*Math.cos(v)+u,v=f*Math.sin(v)+s,f=0;f<r+1;f++){var d=u*(1-2*n+n*n)+l*(2*n-2*n*n)+h*n*n,c=t.lng;a.push([0>i.lng&&0<c?d-360:d,s*(1-2*n+n*n)+v*(2*n-2*n*n)+o*n*n]),n+=1/r}return a}}}]),e}(),En=[{n:"\u5317\u4EAC",g:"116.395645,39.929986|12"},{n:"\u4E0A\u6D77",g:"121.487899,31.249162|12"},{n:"\u5929\u6D25",g:"117.210813,39.14393|12"},{n:"\u91CD\u5E86",g:"106.530635,29.544606|12"}],je=[{n:"\u5B89\u5FBD",g:"117.216005,31.859252|8",cities:[{n:"\u5408\u80A5",g:"117.282699,31.866942|12"},{n:"\u5B89\u5E86",g:"117.058739,30.537898|13"},{n:"\u868C\u57E0",g:"117.35708,32.929499|13"},{n:"\u4EB3\u5DDE",g:"115.787928,33.871211|13"},{n:"\u5DE2\u6E56",g:"117.88049,31.608733|13"},{n:"\u6C60\u5DDE",g:"117.494477,30.660019|14"},{n:"\u6EC1\u5DDE",g:"118.32457,32.317351|13"},{n:"\u961C\u9633",g:"115.820932,32.901211|13"},{n:"\u6DEE\u5317",g:"116.791447,33.960023|13"},{n:"\u6DEE\u5357",g:"117.018639,32.642812|13"},{n:"\u9EC4\u5C71",g:"118.29357,29.734435|13"},{n:"\u516D\u5B89",g:"116.505253,31.755558|13"},{n:"\u9A6C\u978D\u5C71",g:"118.515882,31.688528|13"},{n:"\u5BBF\u5DDE",g:"116.988692,33.636772|13"},{n:"\u94DC\u9675",g:"117.819429,30.94093|14"},{n:"\u829C\u6E56",g:"118.384108,31.36602|12"},{n:"\u5BA3\u57CE",g:"118.752096,30.951642|13"}]},{n:"\u798F\u5EFA",g:"117.984943,26.050118|8",cities:[{n:"\u798F\u5DDE",g:"119.330221,26.047125|12"},{n:"\u9F99\u5CA9",g:"117.017997,25.078685|13"},{n:"\u5357\u5E73",g:"118.181883,26.643626|13"},{n:"\u5B81\u5FB7",g:"119.542082,26.656527|14"},{n:"\u8386\u7530",g:"119.077731,25.44845|13"},{n:"\u6CC9\u5DDE",g:"118.600362,24.901652|12"},{n:"\u4E09\u660E",g:"117.642194,26.270835|14"},{n:"\u53A6\u95E8",g:"118.103886,24.489231|12"},{n:"\u6F33\u5DDE",g:"117.676205,24.517065|12"}]},{n:"\u7518\u8083",g:"102.457625,38.103267|6",cities:[{n:"\u5170\u5DDE",g:"103.823305,36.064226|12"},{n:"\u767D\u94F6",g:"104.171241,36.546682|13"},{n:"\u5B9A\u897F",g:"104.626638,35.586056|13"},{n:"\u7518\u5357\u5DDE",g:"102.917442,34.992211|14"},{n:"\u5609\u5CEA\u5173",g:"98.281635,39.802397|13"},{n:"\u91D1\u660C",g:"102.208126,38.516072|13"},{n:"\u9152\u6CC9",g:"98.508415,39.741474|13"},{n:"\u4E34\u590F\u5DDE",g:"103.215249,35.598514|13"},{n:"\u9647\u5357",g:"104.934573,33.39448|14"},{n:"\u5E73\u51C9",g:"106.688911,35.55011|13"},{n:"\u5E86\u9633",g:"107.644227,35.726801|13"},{n:"\u5929\u6C34",g:"105.736932,34.584319|13"},{n:"\u6B66\u5A01",g:"102.640147,37.933172|13"},{n:"\u5F20\u6396",g:"100.459892,38.93932|13"}]},{n:"\u5E7F\u4E1C",g:"113.394818,23.408004|8",cities:[{n:"\u5E7F\u5DDE",g:"113.30765,23.120049|12"},{n:"\u6F6E\u5DDE",g:"116.630076,23.661812|13"},{n:"\u4E1C\u839E",g:"113.763434,23.043024|12"},{n:"\u4F5B\u5C71",g:"113.134026,23.035095|13"},{n:"\u6CB3\u6E90",g:"114.713721,23.757251|12"},{n:"\u60E0\u5DDE",g:"114.410658,23.11354|12"},{n:"\u6C5F\u95E8",g:"113.078125,22.575117|13"},{n:"\u63ED\u9633",g:"116.379501,23.547999|13"},{n:"\u8302\u540D",g:"110.931245,21.668226|13"},{n:"\u6885\u5DDE",g:"116.126403,24.304571|13"},{n:"\u6E05\u8FDC",g:"113.040773,23.698469|13"},{n:"\u6C55\u5934",g:"116.72865,23.383908|13"},{n:"\u6C55\u5C3E",g:"115.372924,22.778731|14"},{n:"\u97F6\u5173",g:"113.594461,24.80296|13"},{n:"\u6DF1\u5733",g:"114.025974,22.546054|12"},{n:"\u9633\u6C5F",g:"111.97701,21.871517|14"},{n:"\u4E91\u6D6E",g:"112.050946,22.937976|13"},{n:"\u6E5B\u6C5F",g:"110.365067,21.257463|13"},{n:"\u8087\u5E86",g:"112.479653,23.078663|13"},{n:"\u4E2D\u5C71",g:"113.42206,22.545178|12"},{n:"\u73E0\u6D77",g:"113.562447,22.256915|13"}]},{n:"\u5E7F\u897F",g:"108.924274,23.552255|7",cities:[{n:"\u5357\u5B81",g:"108.297234,22.806493|12"},{n:"\u767E\u8272",g:"106.631821,23.901512|13"},{n:"\u5317\u6D77",g:"109.122628,21.472718|13"},{n:"\u5D07\u5DE6",g:"107.357322,22.415455|14"},{n:"\u9632\u57CE\u6E2F",g:"108.351791,21.617398|15"},{n:"\u6842\u6797",g:"110.26092,25.262901|12"},{n:"\u8D35\u6E2F",g:"109.613708,23.103373|13"},{n:"\u6CB3\u6C60",g:"108.069948,24.699521|14"},{n:"\u8D3A\u5DDE",g:"111.552594,24.411054|14"},{n:"\u6765\u5BBE",g:"109.231817,23.741166|14"},{n:"\u67F3\u5DDE",g:"109.422402,24.329053|12"},{n:"\u94A6\u5DDE",g:"108.638798,21.97335|13"},{n:"\u68A7\u5DDE",g:"111.305472,23.485395|13"},{n:"\u7389\u6797",g:"110.151676,22.643974|14"}]},{n:"\u8D35\u5DDE",g:"106.734996,26.902826|8",cities:[{n:"\u8D35\u9633",g:"106.709177,26.629907|12"},{n:"\u5B89\u987A",g:"105.92827,26.228595|13"},{n:"\u6BD5\u8282\u5730\u533A",g:"105.300492,27.302612|14"},{n:"\u516D\u76D8\u6C34",g:"104.852087,26.591866|13"},{n:"\u94DC\u4EC1\u5730\u533A",g:"109.196161,27.726271|14"},{n:"\u9075\u4E49",g:"106.93126,27.699961|13"},{n:"\u9ED4\u897F\u5357\u5DDE",g:"104.900558,25.095148|11"},{n:"\u9ED4\u4E1C\u5357\u5DDE",g:"107.985353,26.583992|11"},{n:"\u9ED4\u5357\u5DDE",g:"107.523205,26.264536|11"}]},{n:"\u6D77\u5357",g:"109.733755,19.180501|9",cities:[{n:"\u6D77\u53E3",g:"110.330802,20.022071|13"},{n:"\u767D\u6C99",g:"109.358586,19.216056|12"},{n:"\u4FDD\u4EAD",g:"109.656113,18.597592|12"},{n:"\u660C\u6C5F",g:"109.0113,19.222483|12"},{n:"\u510B\u5DDE",g:"109.413973,19.571153|13"},{n:"\u6F84\u8FC8",g:"109.996736,19.693135|13"},{n:"\u4E1C\u65B9",g:"108.85101,18.998161|13"},{n:"\u5B9A\u5B89",g:"110.32009,19.490991|13"},{n:"\u743C\u6D77",g:"110.414359,19.21483|13"},{n:"\u743C\u4E2D",g:"109.861849,19.039771|12"},{n:"\u4E50\u4E1C",g:"109.062698,18.658614|12"},{n:"\u4E34\u9AD8",g:"109.724101,19.805922|13"},{n:"\u9675\u6C34",g:"109.948661,18.575985|12"},{n:"\u4E09\u4E9A",g:"109.522771,18.257776|12"},{n:"\u5C6F\u660C",g:"110.063364,19.347749|13"},{n:"\u4E07\u5B81",g:"110.292505,18.839886|13"},{n:"\u6587\u660C",g:"110.780909,19.750947|13"},{n:"\u4E94\u6307\u5C71",g:"109.51775,18.831306|13"}]},{n:"\u6CB3\u5317",g:"115.661434,38.61384|7",cities:[{n:"\u77F3\u5BB6\u5E84",g:"114.522082,38.048958|12"},{n:"\u4FDD\u5B9A",g:"115.49481,38.886565|13"},{n:"\u6CA7\u5DDE",g:"116.863806,38.297615|13"},{n:"\u627F\u5FB7",g:"117.933822,40.992521|14"},{n:"\u90AF\u90F8",g:"114.482694,36.609308|13"},{n:"\u8861\u6C34",g:"115.686229,37.746929|13"},{n:"\u5ECA\u574A",g:"116.703602,39.518611|13"},{n:"\u79E6\u7687\u5C9B",g:"119.604368,39.945462|12"},{n:"\u5510\u5C71",g:"118.183451,39.650531|13"},{n:"\u90A2\u53F0",g:"114.520487,37.069531|13"},{n:"\u5F20\u5BB6\u53E3",g:"114.893782,40.811188|13"}]},{n:"\u6CB3\u5357",g:"113.486804,34.157184|7",cities:[{n:"\u90D1\u5DDE",g:"113.649644,34.75661|12"},{n:"\u5B89\u9633",g:"114.351807,36.110267|12"},{n:"\u9E64\u58C1",g:"114.29777,35.755426|13"},{n:"\u7126\u4F5C",g:"113.211836,35.234608|13"},{n:"\u5F00\u5C01",g:"114.351642,34.801854|13"},{n:"\u6D1B\u9633",g:"112.447525,34.657368|12"},{n:"\u6F2F\u6CB3",g:"114.046061,33.576279|13"},{n:"\u5357\u9633",g:"112.542842,33.01142|13"},{n:"\u5E73\u9876\u5C71",g:"113.300849,33.745301|13"},{n:"\u6FEE\u9633",g:"115.026627,35.753298|12"},{n:"\u4E09\u95E8\u5CE1",g:"111.181262,34.78332|13"},{n:"\u5546\u4E18",g:"115.641886,34.438589|13"},{n:"\u65B0\u4E61",g:"113.91269,35.307258|13"},{n:"\u4FE1\u9633",g:"114.085491,32.128582|13"},{n:"\u8BB8\u660C",g:"113.835312,34.02674|13"},{n:"\u5468\u53E3",g:"114.654102,33.623741|13"},{n:"\u9A7B\u9A6C\u5E97",g:"114.049154,32.983158|13"}]},{n:"\u9ED1\u9F99\u6C5F",g:"128.047414,47.356592|6",cities:[{n:"\u54C8\u5C14\u6EE8",g:"126.657717,45.773225|12"},{n:"\u5927\u5E86",g:"125.02184,46.596709|12"},{n:"\u5927\u5174\u5B89\u5CAD\u5730\u533A",g:"124.196104,51.991789|10"},{n:"\u9E64\u5C97",g:"130.292472,47.338666|13"},{n:"\u9ED1\u6CB3",g:"127.50083,50.25069|14"},{n:"\u9E21\u897F",g:"130.941767,45.32154|13"},{n:"\u4F73\u6728\u65AF",g:"130.284735,46.81378|12"},{n:"\u7261\u4E39\u6C5F",g:"129.608035,44.588521|13"},{n:"\u4E03\u53F0\u6CB3",g:"131.019048,45.775005|14"},{n:"\u9F50\u9F50\u54C8\u5C14",g:"123.987289,47.3477|13"},{n:"\u53CC\u9E2D\u5C71",g:"131.171402,46.655102|13"},{n:"\u7EE5\u5316",g:"126.989095,46.646064|13"},{n:"\u4F0A\u6625",g:"128.910766,47.734685|14"}]},{n:"\u6E56\u5317",g:"112.410562,31.209316|8",cities:[{n:"\u6B66\u6C49",g:"114.3162,30.581084|12"},{n:"\u9102\u5DDE",g:"114.895594,30.384439|14"},{n:"\u6069\u65BD",g:"109.517433,30.308978|14"},{n:"\u9EC4\u5188",g:"114.906618,30.446109|14"},{n:"\u9EC4\u77F3",g:"115.050683,30.216127|13"},{n:"\u8346\u95E8",g:"112.21733,31.042611|13"},{n:"\u8346\u5DDE",g:"112.241866,30.332591|12"},{n:"\u6F5C\u6C5F",g:"112.768768,30.343116|13"},{n:"\u795E\u519C\u67B6\u6797\u533A",g:"110.487231,31.595768|13"},{n:"\u5341\u5830",g:"110.801229,32.636994|13"},{n:"\u968F\u5DDE",g:"113.379358,31.717858|13"},{n:"\u5929\u95E8",g:"113.12623,30.649047|13"},{n:"\u4ED9\u6843",g:"113.387448,30.293966|13"},{n:"\u54B8\u5B81",g:"114.300061,29.880657|13"},{n:"\u8944\u9633",g:"112.176326,32.094934|12"},{n:"\u5B5D\u611F",g:"113.935734,30.927955|13"},{n:"\u5B9C\u660C",g:"111.310981,30.732758|13"}]},{n:"\u6E56\u5357",g:"111.720664,27.695864|7",cities:[{n:"\u957F\u6C99",g:"112.979353,28.213478|12"},{n:"\u5E38\u5FB7",g:"111.653718,29.012149|12"},{n:"\u90F4\u5DDE",g:"113.037704,25.782264|13"},{n:"\u8861\u9633",g:"112.583819,26.898164|13"},{n:"\u6000\u5316",g:"109.986959,27.557483|13"},{n:"\u5A04\u5E95",g:"111.996396,27.741073|13"},{n:"\u90B5\u9633",g:"111.461525,27.236811|13"},{n:"\u6E58\u6F6D",g:"112.935556,27.835095|13"},{n:"\u6E58\u897F\u5DDE",g:"109.745746,28.317951|14"},{n:"\u76CA\u9633",g:"112.366547,28.588088|13"},{n:"\u6C38\u5DDE",g:"111.614648,26.435972|13"},{n:"\u5CB3\u9633",g:"113.146196,29.378007|13"},{n:"\u5F20\u5BB6\u754C",g:"110.48162,29.124889|13"},{n:"\u682A\u6D32",g:"113.131695,27.827433|13"}]},{n:"\u6C5F\u82CF",g:"119.368489,33.013797|8",cities:[{n:"\u5357\u4EAC",g:"118.778074,32.057236|12"},{n:"\u5E38\u5DDE",g:"119.981861,31.771397|12"},{n:"\u6DEE\u5B89",g:"119.030186,33.606513|12"},{n:"\u8FDE\u4E91\u6E2F",g:"119.173872,34.601549|12"},{n:"\u5357\u901A",g:"120.873801,32.014665|12"},{n:"\u82CF\u5DDE",g:"120.619907,31.317987|12"},{n:"\u5BBF\u8FC1",g:"118.296893,33.95205|13"},{n:"\u6CF0\u5DDE",g:"119.919606,32.476053|13"},{n:"\u65E0\u9521",g:"120.305456,31.570037|12"},{n:"\u5F90\u5DDE",g:"117.188107,34.271553|12"},{n:"\u76D0\u57CE",g:"120.148872,33.379862|12"},{n:"\u626C\u5DDE",g:"119.427778,32.408505|13"},{n:"\u9547\u6C5F",g:"119.455835,32.204409|13"}]},{n:"\u6C5F\u897F",g:"115.676082,27.757258|7",cities:[{n:"\u5357\u660C",g:"115.893528,28.689578|12"},{n:"\u629A\u5DDE",g:"116.360919,27.954545|13"},{n:"\u8D63\u5DDE",g:"114.935909,25.845296|13"},{n:"\u5409\u5B89",g:"114.992039,27.113848|13"},{n:"\u666F\u5FB7\u9547",g:"117.186523,29.303563|12"},{n:"\u4E5D\u6C5F",g:"115.999848,29.71964|13"},{n:"\u840D\u4E61",g:"113.859917,27.639544|13"},{n:"\u4E0A\u9976",g:"117.955464,28.457623|13"},{n:"\u65B0\u4F59",g:"114.947117,27.822322|13"},{n:"\u5B9C\u6625",g:"114.400039,27.81113|13"},{n:"\u9E70\u6F6D",g:"117.03545,28.24131|13"}]},{n:"\u5409\u6797",g:"126.262876,43.678846|7",cities:[{n:"\u957F\u6625",g:"125.313642,43.898338|12"},{n:"\u767D\u57CE",g:"122.840777,45.621086|13"},{n:"\u767D\u5C71",g:"126.435798,41.945859|13"},{n:"\u5409\u6797",g:"126.564544,43.871988|12"},{n:"\u8FBD\u6E90",g:"125.133686,42.923303|13"},{n:"\u56DB\u5E73",g:"124.391382,43.175525|12"},{n:"\u677E\u539F",g:"124.832995,45.136049|13"},{n:"\u901A\u5316",g:"125.94265,41.736397|13"},{n:"\u5EF6\u8FB9",g:"129.485902,42.896414|13"}]},{n:"\u8FBD\u5B81",g:"122.753592,41.6216|8",cities:[{n:"\u6C88\u9633",g:"123.432791,41.808645|12"},{n:"\u978D\u5C71",g:"123.007763,41.118744|13"},{n:"\u672C\u6EAA",g:"123.778062,41.325838|12"},{n:"\u671D\u9633",g:"120.446163,41.571828|13"},{n:"\u5927\u8FDE",g:"121.593478,38.94871|12"},{n:"\u4E39\u4E1C",g:"124.338543,40.129023|12"},{n:"\u629A\u987A",g:"123.92982,41.877304|12"},{n:"\u961C\u65B0",g:"121.660822,42.01925|14"},{n:"\u846B\u82A6\u5C9B",g:"120.860758,40.74303|13"},{n:"\u9526\u5DDE",g:"121.147749,41.130879|13"},{n:"\u8FBD\u9633",g:"123.172451,41.273339|14"},{n:"\u76D8\u9526",g:"122.073228,41.141248|13"},{n:"\u94C1\u5CAD",g:"123.85485,42.299757|13"},{n:"\u8425\u53E3",g:"122.233391,40.668651|13"}]},{n:"\u5185\u8499\u53E4",g:"114.415868,43.468238|5",cities:[{n:"\u547C\u548C\u6D69\u7279",g:"111.660351,40.828319|12"},{n:"\u963F\u62C9\u5584\u76DF",g:"105.695683,38.843075|14"},{n:"\u5305\u5934",g:"109.846239,40.647119|12"},{n:"\u5DF4\u5F66\u6DD6\u5C14",g:"107.423807,40.76918|12"},{n:"\u8D64\u5CF0",g:"118.930761,42.297112|12"},{n:"\u9102\u5C14\u591A\u65AF",g:"109.993706,39.81649|12"},{n:"\u547C\u4F26\u8D1D\u5C14",g:"119.760822,49.201636|12"},{n:"\u901A\u8FBD",g:"122.260363,43.633756|12"},{n:"\u4E4C\u6D77",g:"106.831999,39.683177|13"},{n:"\u4E4C\u5170\u5BDF\u5E03",g:"113.112846,41.022363|12"},{n:"\u9521\u6797\u90ED\u52D2\u76DF",g:"116.02734,43.939705|11"},{n:"\u5174\u5B89\u76DF",g:"122.048167,46.083757|11"}]},{n:"\u5B81\u590F",g:"106.155481,37.321323|8",cities:[{n:"\u94F6\u5DDD",g:"106.206479,38.502621|12"},{n:"\u56FA\u539F",g:"106.285268,36.021523|13"},{n:"\u77F3\u5634\u5C71",g:"106.379337,39.020223|13"},{n:"\u5434\u5FE0",g:"106.208254,37.993561|14"},{n:"\u4E2D\u536B",g:"105.196754,37.521124|14"}]},{n:"\u9752\u6D77",g:"96.202544,35.499761|7",cities:[{n:"\u897F\u5B81",g:"101.767921,36.640739|12"},{n:"\u679C\u6D1B\u5DDE",g:"100.223723,34.480485|11"},{n:"\u6D77\u4E1C\u5730\u533A",g:"102.085207,36.51761|11"},{n:"\u6D77\u5317\u5DDE",g:"100.879802,36.960654|11"},{n:"\u6D77\u5357\u5DDE",g:"100.624066,36.284364|11"},{n:"\u6D77\u897F\u5DDE",g:"97.342625,37.373799|11"},{n:"\u9EC4\u5357\u5DDE",g:"102.0076,35.522852|11"},{n:"\u7389\u6811\u5DDE",g:"97.013316,33.00624|14"}]},{n:"\u5C71\u4E1C",g:"118.527663,36.09929|8",cities:[{n:"\u6D4E\u5357",g:"117.024967,36.682785|12"},{n:"\u6EE8\u5DDE",g:"117.968292,37.405314|12"},{n:"\u4E1C\u8425",g:"118.583926,37.487121|12"},{n:"\u5FB7\u5DDE",g:"116.328161,37.460826|12"},{n:"\u83CF\u6CFD",g:"115.46336,35.26244|13"},{n:"\u6D4E\u5B81",g:"116.600798,35.402122|13"},{n:"\u83B1\u829C",g:"117.684667,36.233654|13"},{n:"\u804A\u57CE",g:"115.986869,36.455829|12"},{n:"\u4E34\u6C82",g:"118.340768,35.072409|12"},{n:"\u9752\u5C9B",g:"120.384428,36.105215|12"},{n:"\u65E5\u7167",g:"119.50718,35.420225|12"},{n:"\u6CF0\u5B89",g:"117.089415,36.188078|13"},{n:"\u5A01\u6D77",g:"122.093958,37.528787|13"},{n:"\u6F4D\u574A",g:"119.142634,36.716115|12"},{n:"\u70DF\u53F0",g:"121.309555,37.536562|12"},{n:"\u67A3\u5E84",g:"117.279305,34.807883|13"},{n:"\u6DC4\u535A",g:"118.059134,36.804685|12"}]},{n:"\u5C71\u897F",g:"112.515496,37.866566|7",cities:[{n:"\u592A\u539F",g:"112.550864,37.890277|12"},{n:"\u957F\u6CBB",g:"113.120292,36.201664|12"},{n:"\u5927\u540C",g:"113.290509,40.113744|12"},{n:"\u664B\u57CE",g:"112.867333,35.499834|13"},{n:"\u664B\u4E2D",g:"112.738514,37.693362|13"},{n:"\u4E34\u6C7E",g:"111.538788,36.099745|13"},{n:"\u5415\u6881",g:"111.143157,37.527316|14"},{n:"\u6714\u5DDE",g:"112.479928,39.337672|13"},{n:"\u5FFB\u5DDE",g:"112.727939,38.461031|12"},{n:"\u9633\u6CC9",g:"113.569238,37.869529|13"},{n:"\u8FD0\u57CE",g:"111.006854,35.038859|13"}]},{n:"\u9655\u897F",g:"109.503789,35.860026|7",cities:[{n:"\u897F\u5B89",g:"108.953098,34.2778|12"},{n:"\u5B89\u5EB7",g:"109.038045,32.70437|13"},{n:"\u5B9D\u9E21",g:"107.170645,34.364081|12"},{n:"\u6C49\u4E2D",g:"107.045478,33.081569|13"},{n:"\u5546\u6D1B",g:"109.934208,33.873907|13"},{n:"\u94DC\u5DDD",g:"108.968067,34.908368|13"},{n:"\u6E2D\u5357",g:"109.483933,34.502358|13"},{n:"\u54B8\u9633",g:"108.707509,34.345373|13"},{n:"\u5EF6\u5B89",g:"109.50051,36.60332|13"},{n:"\u6986\u6797",g:"109.745926,38.279439|12"}]},{n:"\u56DB\u5DDD",g:"102.89916,30.367481|7",cities:[{n:"\u6210\u90FD",g:"104.067923,30.679943|12"},{n:"\u963F\u575D\u5DDE",g:"102.228565,31.905763|15"},{n:"\u5DF4\u4E2D",g:"106.757916,31.869189|14"},{n:"\u8FBE\u5DDE",g:"107.494973,31.214199|14"},{n:"\u5FB7\u9633",g:"104.402398,31.13114|13"},{n:"\u7518\u5B5C\u5DDE",g:"101.969232,30.055144|15"},{n:"\u5E7F\u5B89",g:"106.63572,30.463984|13"},{n:"\u5E7F\u5143",g:"105.819687,32.44104|13"},{n:"\u4E50\u5C71",g:"103.760824,29.600958|13"},{n:"\u51C9\u5C71\u5DDE",g:"102.259591,27.892393|14"},{n:"\u6CF8\u5DDE",g:"105.44397,28.89593|14"},{n:"\u5357\u5145",g:"106.105554,30.800965|13"},{n:"\u7709\u5C71",g:"103.84143,30.061115|13"},{n:"\u7EF5\u9633",g:"104.705519,31.504701|12"},{n:"\u5185\u6C5F",g:"105.073056,29.599462|13"},{n:"\u6500\u679D\u82B1",g:"101.722423,26.587571|14"},{n:"\u9042\u5B81",g:"105.564888,30.557491|12"},{n:"\u96C5\u5B89",g:"103.009356,29.999716|13"},{n:"\u5B9C\u5BBE",g:"104.633019,28.769675|13"},{n:"\u8D44\u9633",g:"104.63593,30.132191|13"},{n:"\u81EA\u8D21",g:"104.776071,29.359157|13"}]},{n:"\u897F\u85CF",g:"89.137982,31.367315|6",cities:[{n:"\u62C9\u8428",g:"91.111891,29.662557|13"},{n:"\u963F\u91CC\u5730\u533A",g:"81.107669,30.404557|11"},{n:"\u660C\u90FD\u5730\u533A",g:"97.185582,31.140576|15"},{n:"\u6797\u829D\u5730\u533A",g:"94.349985,29.666941|11"},{n:"\u90A3\u66F2\u5730\u533A",g:"92.067018,31.48068|14"},{n:"\u65E5\u5580\u5219\u5730\u533A",g:"88.891486,29.269023|14"},{n:"\u5C71\u5357\u5730\u533A",g:"91.750644,29.229027|11"}]},{n:"\u65B0\u7586",g:"85.614899,42.127001|6",cities:[{n:"\u4E4C\u9C81\u6728\u9F50",g:"87.564988,43.84038|12"},{n:"\u963F\u62C9\u5C14",g:"81.291737,40.61568|13"},{n:"\u963F\u514B\u82CF\u5730\u533A",g:"80.269846,41.171731|12"},{n:"\u963F\u52D2\u6CF0\u5730\u533A",g:"88.137915,47.839744|13"},{n:"\u5DF4\u97F3\u90ED\u695E",g:"86.121688,41.771362|12"},{n:"\u535A\u5C14\u5854\u62C9\u5DDE",g:"82.052436,44.913651|11"},{n:"\u660C\u5409\u5DDE",g:"87.296038,44.007058|13"},{n:"\u54C8\u5BC6\u5730\u533A",g:"93.528355,42.858596|13"},{n:"\u548C\u7530\u5730\u533A",g:"79.930239,37.116774|13"},{n:"\u5580\u4EC0\u5730\u533A",g:"75.992973,39.470627|12"},{n:"\u514B\u62C9\u739B\u4F9D",g:"84.88118,45.594331|13"},{n:"\u514B\u5B5C\u52D2\u82CF\u5DDE",g:"76.137564,39.750346|11"},{n:"\u77F3\u6CB3\u5B50",g:"86.041865,44.308259|13"},{n:"\u5854\u57CE\u5730\u533A",g:"82.974881,46.758684|12"},{n:"\u56FE\u6728\u8212\u514B",g:"79.198155,39.889223|13"},{n:"\u5410\u9C81\u756A\u5730\u533A",g:"89.181595,42.96047|13"},{n:"\u4E94\u5BB6\u6E20",g:"87.565449,44.368899|13"},{n:"\u4F0A\u7281\u5DDE",g:"81.297854,43.922248|11"}]},{n:"\u4E91\u5357",g:"101.592952,24.864213|7",cities:[{n:"\u6606\u660E",g:"102.714601,25.049153|12"},{n:"\u4FDD\u5C71",g:"99.177996,25.120489|13"},{n:"\u695A\u96C4\u5DDE",g:"101.529382,25.066356|13"},{n:"\u5927\u7406\u5DDE",g:"100.223675,25.5969|14"},{n:"\u5FB7\u5B8F\u5DDE",g:"98.589434,24.44124|14"},{n:"\u8FEA\u5E86\u5DDE",g:"99.713682,27.831029|14"},{n:"\u7EA2\u6CB3\u5DDE",g:"103.384065,23.367718|11"},{n:"\u4E3D\u6C5F",g:"100.229628,26.875351|13"},{n:"\u4E34\u6CA7",g:"100.092613,23.887806|14"},{n:"\u6012\u6C5F\u5DDE",g:"98.859932,25.860677|14"},{n:"\u666E\u6D31",g:"100.980058,22.788778|14"},{n:"\u66F2\u9756",g:"103.782539,25.520758|12"},{n:"\u662D\u901A",g:"103.725021,27.340633|13"},{n:"\u6587\u5C71",g:"104.089112,23.401781|14"},{n:"\u897F\u53CC\u7248\u7EB3",g:"100.803038,22.009433|13"},{n:"\u7389\u6EAA",g:"102.545068,24.370447|13"}]},{n:"\u6D59\u6C5F",g:"119.957202,29.159494|8",cities:[{n:"\u676D\u5DDE",g:"120.219375,30.259244|12"},{n:"\u6E56\u5DDE",g:"120.137243,30.877925|12"},{n:"\u5609\u5174",g:"120.760428,30.773992|13"},{n:"\u91D1\u534E",g:"119.652576,29.102899|12"},{n:"\u4E3D\u6C34",g:"119.929576,28.4563|13"},{n:"\u5B81\u6CE2",g:"121.579006,29.885259|12"},{n:"\u8862\u5DDE",g:"118.875842,28.95691|12"},{n:"\u7ECD\u5174",g:"120.592467,30.002365|13"},{n:"\u53F0\u5DDE",g:"121.440613,28.668283|13"},{n:"\u6E29\u5DDE",g:"120.690635,28.002838|12"},{n:"\u821F\u5C71",g:"122.169872,30.03601|13"}]}],Rn=[{n:"\u9999\u6E2F",g:"114.186124,22.293586|11"},{n:"\u6FB3\u95E8",g:"113.557519,22.204118|13"},{n:"\u53F0\u6E7E",g:"120.961454,23.80406|8"}],Dr=void 0,pa=function(){if(Dr!==void 0)return Dr;var e=navigator.userAgent,i="Android;iPhone;SymbianOS;Windows Phone;iPad;iPod".split(";");Dr=!1;for(var t=0;t<i.length;t++)if(0<e.indexOf(i[t])){Dr=!0;break}return Dr}(),Ln=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Pi=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ml=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ga=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),he=Array(576);Ke(he);var Br=Array(60);Ke(Br);var He=Array(512);Ke(He);var Or=Array(256);Ke(Or);var Fn=Array(29);Ke(Fn);var Ei=Array(30);Ke(Ei);var ma=void 0,xa=void 0,ya=void 0,zr=function(e,i){e.pending_buf[e.pending++]=i&255,e.pending_buf[e.pending++]=i>>>8&255},zt=function(e,i,t){e.bi_valid>16-t?(e.bi_buf|=i<<e.bi_valid&65535,zr(e,e.bi_buf),e.bi_buf=i>>16-e.bi_valid,e.bi_valid+=t-16):(e.bi_buf|=i<<e.bi_valid&65535,e.bi_valid+=t)},re=function(e,i,t){zt(e,t[2*i],t[2*i+1])},_a=function(e,i){var t=0;do t|=e&1,e>>>=1,t<<=1;while(0<--i);return t>>>1},Aa=function(e,i,t){var r=Array(16),a=0,n;for(n=1;15>=n;n++)r[n]=a=a+t[n-1]<<1;for(t=0;t<=i;t++)a=e[2*t+1],a!==0&&(e[2*t]=_a(r[a]++,a))},Ta=function(e){var i;for(i=0;286>i;i++)e.dyn_ltree[2*i]=0;for(i=0;30>i;i++)e.dyn_dtree[2*i]=0;for(i=0;19>i;i++)e.bl_tree[2*i]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},wa=function(e){8<e.bi_valid?zr(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Ma=function(e,i,t,r){var a=2*i,n=2*t;return e[a]<e[n]||e[a]===e[n]&&r[i]<=r[t]},Dn=function(e,i,t){for(var r=e.heap[t],a=t<<1;a<=e.heap_len&&(a<e.heap_len&&Ma(i,e.heap[a+1],e.heap[a],e.depth)&&a++,!Ma(i,r,e.heap[a],e.depth));)e.heap[t]=e.heap[a],t=a,a<<=1;e.heap[t]=r},Ca=function(e,i,t){var r=0;if(e.last_lit!==0)do{var a=e.pending_buf[e.d_buf+2*r]<<8|e.pending_buf[e.d_buf+2*r+1],n=e.pending_buf[e.l_buf+r];if(r++,a===0)re(e,n,i);else{var s=Or[n];re(e,s+256+1,i);var o=Ln[s];o!==0&&(n-=Fn[s],zt(e,n,o)),a--,s=256>a?He[a]:He[256+(a>>>7)],re(e,s,t),o=Pi[s],o!==0&&(a-=Ei[s],zt(e,a,o))}}while(r<e.last_lit);re(e,256,i)},Bn=function(e,i){var t=i.dyn_tree,r=i.stat_desc.static_tree,a=i.stat_desc.has_stree,n=i.stat_desc.elems,s,o=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<n;s++)t[2*s]!==0?(e.heap[++e.heap_len]=o=s,e.depth[s]=0):t[2*s+1]=0;for(;2>e.heap_len;){var u=e.heap[++e.heap_len]=2>o?++o:0;t[2*u]=1,e.depth[u]=0,e.opt_len--,a&&(e.static_len-=r[2*u+1])}for(i.max_code=o,s=e.heap_len>>1;1<=s;s--)Dn(e,t,s);u=n;do s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Dn(e,t,1),r=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=r,t[2*u]=t[2*s]+t[2*r],e.depth[u]=(e.depth[s]>=e.depth[r]?e.depth[s]:e.depth[r])+1,t[2*s+1]=t[2*r+1]=u,e.heap[1]=u++,Dn(e,t,1);while(2<=e.heap_len);e.heap[--e.heap_max]=e.heap[1],s=i.dyn_tree,u=i.max_code,r=i.stat_desc.static_tree,a=i.stat_desc.has_stree,n=i.stat_desc.extra_bits;var h=i.stat_desc.extra_base,v=i.stat_desc.max_length,l,f=0;for(l=0;15>=l;l++)e.bl_count[l]=0;for(s[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;573>i;i++){var d=e.heap[i];if(l=s[2*s[2*d+1]+1]+1,l>v&&(l=v,f++),s[2*d+1]=l,!(d>u)){e.bl_count[l]++;var c=0;d>=h&&(c=n[d-h]);var p=s[2*d];e.opt_len+=p*(l+c),a&&(e.static_len+=p*(r[2*d+1]+c))}}if(f!==0){do{for(l=v-1;e.bl_count[l]===0;)l--;e.bl_count[l]--,e.bl_count[l+1]+=2,e.bl_count[v]--,f-=2}while(0<f);for(l=v;l!==0;l--)for(d=e.bl_count[l];d!==0;)r=e.heap[--i],r>u||(s[2*r+1]!==l&&(e.opt_len+=(l-s[2*r+1])*s[2*r],s[2*r+1]=l),d--)}Aa(t,o,e.bl_count)},Sa=function(e,i,t){var r,a=-1,n=i[1],s=0,o=7,u=4;for(n===0&&(o=138,u=3),i[2*(t+1)+1]=65535,r=0;r<=t;r++){var h=n;n=i[2*(r+1)+1],++s<o&&h===n||(s<u?e.bl_tree[2*h]+=s:h!==0?(h!==a&&e.bl_tree[2*h]++,e.bl_tree[32]++):10>=s?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=h,n===0?(o=138,u=3):h===n?(o=6,u=3):(o=7,u=4))}},Pa=function(e,i,t){var r,a=-1,n=i[1],s=0,o=7,u=4;for(n===0&&(o=138,u=3),r=0;r<=t;r++){var h=n;if(n=i[2*(r+1)+1],!(++s<o&&h===n)){if(s<u)do re(e,h,e.bl_tree);while(--s!==0);else h!==0?(h!==a&&(re(e,h,e.bl_tree),s--),re(e,16,e.bl_tree),zt(e,s-3,2)):10>=s?(re(e,17,e.bl_tree),zt(e,s-3,3)):(re(e,18,e.bl_tree),zt(e,s-11,7));s=0,a=h,n===0?(o=138,u=3):h===n?(o=6,u=3):(o=7,u=4)}}},Cl=function(e){var i=4093624447,t;for(t=0;31>=t;t++,i>>>=1)if(i&1&&e.dyn_ltree[2*t]!==0)return 0;if(e.dyn_ltree[18]!==0||e.dyn_ltree[20]!==0||e.dyn_ltree[26]!==0)return 1;for(t=32;256>t;t++)if(e.dyn_ltree[2*t]!==0)return 1;return 0},Ea=!1,Ra=function(e,i,t,r){zt(e,r?1:0,3),wa(e),zr(e,t),zr(e,~t),e.pending_buf.set(e.window.subarray(i,i+t),e.pending),e.pending+=t},Ir=function(e,i,t,r){var a=e&65535|0;e=e>>>16&65535|0;for(var n;t!==0;){n=2e3<t?2e3:t,t-=n;do a=a+i[r++]|0,e=e+a|0;while(--n);a%=65521,e%=65521}return a|e<<16|0},Sl=new Uint32Array(function(){for(var e,i=[],t=0;256>t;t++){e=t;for(var r=0;8>r;r++)e=e&1?3988292384^e>>>1:e>>>1;i[t]=e}return i}()),Tt=function(e,i,t,r){for(t=r+t,e^=-1;r<t;r++)e=e>>>8^Sl[(e^i[r])&255];return e^-1},Xe={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},G={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Ce=function(e,i,t){return e.pending_buf[e.d_buf+2*e.last_lit]=i>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=i&255,e.pending_buf[e.l_buf+e.last_lit]=t&255,e.last_lit++,i===0?e.dyn_ltree[2*t]++:(e.matches++,i--,e.dyn_ltree[2*(Or[t]+256+1)]++,e.dyn_dtree[2*(256>i?He[i]:He[256+(i>>>7)])]++),e.last_lit===e.lit_bufsize-1},We=G.Z_NO_FLUSH,Pl=G.Z_PARTIAL_FLUSH,El=G.Z_FULL_FLUSH,Se=G.Z_FINISH,La=G.Z_BLOCK,ie=G.Z_OK,Fa=G.Z_STREAM_END,Kt=G.Z_STREAM_ERROR,Rl=G.Z_DATA_ERROR,On=G.Z_BUF_ERROR,Ll=G.Z_DEFAULT_COMPRESSION,Fl=G.Z_FILTERED,Ri=G.Z_HUFFMAN_ONLY,Dl=G.Z_RLE,Bl=G.Z_FIXED,Ol=G.Z_DEFAULT_STRATEGY,zl=G.Z_UNKNOWN,Li=G.Z_DEFLATED,Pe=function(e,i){return e.msg=Xe[i],i},Ee=function(e){for(var i=e.length;0<=--i;)e[i]=0},Re=function(e,i,t){return(i<<e.hash_shift^t)&e.hash_mask},Le=function(e){var i=e.state,t=i.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+t),e.next_out),e.next_out+=t,i.pending_out+=t,e.total_out+=t,e.avail_out-=t,i.pending-=t,i.pending===0&&(i.pending_out=0))},Ct=function(e,i){var t=0<=e.block_start?e.block_start:-1,r=e.strstart-e.block_start,a=0;if(0<e.level){for(e.strm.data_type===2&&(e.strm.data_type=Cl(e)),Bn(e,e.l_desc),Bn(e,e.d_desc),Sa(e,e.dyn_ltree,e.l_desc.max_code),Sa(e,e.dyn_dtree,e.d_desc.max_code),Bn(e,e.bl_desc),a=18;3<=a&&e.bl_tree[2*ga[a]+1]===0;a--);e.opt_len+=3*(a+1)+14;var n=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3;s<=n&&(n=s)}else n=s=r+5;if(r+4<=n&&t!==-1)Ra(e,t,r,i);else if(e.strategy===4||s===n)zt(e,2+(i?1:0),3),Ca(e,he,Br);else{for(zt(e,4+(i?1:0),3),t=e.l_desc.max_code+1,r=e.d_desc.max_code+1,a+=1,zt(e,t-257,5),zt(e,r-1,5),zt(e,a-4,4),n=0;n<a;n++)zt(e,e.bl_tree[2*ga[n]+1],3);Pa(e,e.dyn_ltree,t-1),Pa(e,e.dyn_dtree,r-1),Ca(e,e.dyn_ltree,e.dyn_dtree)}Ta(e),i&&wa(e),e.block_start=e.strstart,Le(e.strm)},et=function(e,i){e.pending_buf[e.pending++]=i},br=function(e,i){e.pending_buf[e.pending++]=i>>>8&255,e.pending_buf[e.pending++]=i&255},Da=function(e,i){var t=e.max_chain_length,r=e.strstart,a=e.prev_length,n=e.nice_match,s=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,o=e.window,u=e.w_mask,h=e.prev,v=e.strstart+258,l=o[r+a-1],f=o[r+a];e.prev_length>=e.good_match&&(t>>=2),n>e.lookahead&&(n=e.lookahead);do{var d=i;if(o[d+a]===f&&o[d+a-1]===l&&o[d]===o[r]&&o[++d]===o[r+1]){for(r+=2,d++;o[++r]===o[++d]&&o[++r]===o[++d]&&o[++r]===o[++d]&&o[++r]===o[++d]&&o[++r]===o[++d]&&o[++r]===o[++d]&&o[++r]===o[++d]&&o[++r]===o[++d]&&r<v;);if(d=258-(v-r),r=v-258,d>a){if(e.match_start=i,a=d,d>=n)break;l=o[r+a-1],f=o[r+a]}}}while((i=h[i&u])>s&&--t!==0);return a<=e.lookahead?a:e.lookahead},Ye=function(e){var i=e.w_size,t;do{var r=e.window_size-e.lookahead-e.strstart;if(e.strstart>=i+(i-262)){e.window.set(e.window.subarray(i,i+i),0),e.match_start-=i,e.strstart-=i,e.block_start-=i;var a=t=e.hash_size;do{var n=e.head[--a];e.head[a]=n>=i?n-i:0}while(--t);a=t=i;do n=e.prev[--a],e.prev[a]=n>=i?n-i:0;while(--t);r+=i}if(e.strm.avail_in===0)break;a=e.strm,t=e.window,n=e.strstart+e.lookahead;var s=a.avail_in;if(s>r&&(s=r),s===0?t=0:(a.avail_in-=s,t.set(a.input.subarray(a.next_in,a.next_in+s),n),a.state.wrap===1?a.adler=Ir(a.adler,t,s,n):a.state.wrap===2&&(a.adler=Tt(a.adler,t,s,n)),a.next_in+=s,a.total_in+=s,t=s),e.lookahead+=t,3<=e.lookahead+e.insert)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=Re(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=Re(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(3>e.lookahead+e.insert)););}while(262>e.lookahead&&e.strm.avail_in!==0)},zn=function(e,i){for(var t;;){if(262>e.lookahead){if(Ye(e),262>e.lookahead&&i===We)return 1;if(e.lookahead===0)break}if(t=0,3<=e.lookahead&&(e.ins_h=Re(e,e.ins_h,e.window[e.strstart+3-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),t!==0&&e.strstart-t<=e.w_size-262&&(e.match_length=Da(e,t)),3<=e.match_length)if(t=Ce(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&3<=e.lookahead){e.match_length--;do e.strstart++,e.ins_h=Re(e,e.ins_h,e.window[e.strstart+3-1]),e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Re(e,e.ins_h,e.window[e.strstart+1]);else t=Ce(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(t&&(Ct(e,!1),e.strm.avail_out===0))return 1}return e.insert=2>e.strstart?e.strstart:2,i===Se?(Ct(e,!0),e.strm.avail_out===0?3:4):e.last_lit&&(Ct(e,!1),e.strm.avail_out===0)?1:2},nr=function(e,i){for(var t,r;;){if(262>e.lookahead){if(Ye(e),262>e.lookahead&&i===We)return 1;if(e.lookahead===0)break}if(t=0,3<=e.lookahead&&(e.ins_h=Re(e,e.ins_h,e.window[e.strstart+3-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,t!==0&&e.prev_length<e.max_lazy_match&&e.strstart-t<=e.w_size-262&&(e.match_length=Da(e,t),5>=e.match_length&&(e.strategy===Fl||e.match_length===3&&4096<e.strstart-e.match_start)&&(e.match_length=2)),3<=e.prev_length&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,t=Ce(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=Re(e,e.ins_h,e.window[e.strstart+3-1]),e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=2,e.strstart++,t&&(Ct(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if((t=Ce(e,0,e.window[e.strstart-1]))&&Ct(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(Ce(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=2>e.strstart?e.strstart:2,i===Se?(Ct(e,!0),e.strm.avail_out===0?3:4):e.last_lit&&(Ct(e,!1),e.strm.avail_out===0)?1:2},Il=function(e,i){for(var t,r,a,n=e.window;;){if(258>=e.lookahead){if(Ye(e),258>=e.lookahead&&i===We)return 1;if(e.lookahead===0)break}if(e.match_length=0,3<=e.lookahead&&0<e.strstart&&(r=e.strstart-1,t=n[r],t===n[++r]&&t===n[++r]&&t===n[++r])){for(a=e.strstart+258;t===n[++r]&&t===n[++r]&&t===n[++r]&&t===n[++r]&&t===n[++r]&&t===n[++r]&&t===n[++r]&&t===n[++r]&&r<a;);e.match_length=258-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(3<=e.match_length?(t=Ce(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(t=Ce(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),t&&(Ct(e,!1),e.strm.avail_out===0))return 1}return e.insert=0,i===Se?(Ct(e,!0),e.strm.avail_out===0?3:4):e.last_lit&&(Ct(e,!1),e.strm.avail_out===0)?1:2},bl=function(e,i){for(var t;;){if(e.lookahead===0&&(Ye(e),e.lookahead===0)){if(i===We)return 1;break}if(e.match_length=0,t=Ce(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,t&&(Ct(e,!1),e.strm.avail_out===0))return 1}return e.insert=0,i===Se?(Ct(e,!0),e.strm.avail_out===0?3:4):e.last_lit&&(Ct(e,!1),e.strm.avail_out===0)?1:2},kr=[new qt(0,0,0,0,function(e,i){var t=65535;for(t>e.pending_buf_size-5&&(t=e.pending_buf_size-5);;){if(1>=e.lookahead){if(Ye(e),e.lookahead===0&&i===We)return 1;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+t;if((e.strstart===0||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,Ct(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-262&&(Ct(e,!1),e.strm.avail_out===0))return 1}return e.insert=0,i===Se?(Ct(e,!0),e.strm.avail_out===0?3:4):(e.strstart>e.block_start&&Ct(e,!1),1)}),new qt(4,4,8,4,zn),new qt(4,5,16,8,zn),new qt(4,6,32,32,zn),new qt(4,4,16,16,nr),new qt(8,16,32,32,nr),new qt(8,16,128,128,nr),new qt(8,32,128,256,nr),new qt(32,128,258,1024,nr),new qt(32,258,258,4096,nr)],Ba=function(e){if(!e||!e.state)return Pe(e,Kt);e.total_in=e.total_out=0,e.data_type=zl;var i=e.state;if(i.pending=0,i.pending_out=0,0>i.wrap&&(i.wrap=-i.wrap),i.status=i.wrap?42:113,e.adler=i.wrap===2?0:1,i.last_flush=We,!Ea){var t,r,a;for(e=Array(16),a=r=0;28>a;a++)for(Fn[a]=r,t=0;t<1<<Ln[a];t++)Or[r++]=a;for(Or[r-1]=a,a=r=0;16>a;a++)for(Ei[a]=r,t=0;t<1<<Pi[a];t++)He[r++]=a;for(r>>=7;30>a;a++)for(Ei[a]=r<<7,t=0;t<1<<Pi[a]-7;t++)He[256+r++]=a;for(t=0;15>=t;t++)e[t]=0;for(t=0;143>=t;)he[2*t+1]=8,t++,e[8]++;for(;255>=t;)he[2*t+1]=9,t++,e[9]++;for(;279>=t;)he[2*t+1]=7,t++,e[7]++;for(;287>=t;)he[2*t+1]=8,t++,e[8]++;for(Aa(he,287,e),t=0;30>t;t++)Br[2*t+1]=5,Br[2*t]=_a(t,5);ma=new Ji(he,Ln,257,286,15),xa=new Ji(Br,Pi,0,30,15),ya=new Ji([],Ml,0,19,7),Ea=!0}return i.l_desc=new qi(i.dyn_ltree,ma),i.d_desc=new qi(i.dyn_dtree,xa),i.bl_desc=new qi(i.bl_tree,ya),i.bi_buf=0,i.bi_valid=0,Ta(i),ie},Oa=function(e){var i=Ba(e);return i===ie&&(e=e.state,e.window_size=2*e.w_size,Ee(e.head),e.max_lazy_match=kr[e.level].max_lazy,e.good_match=kr[e.level].good_length,e.nice_match=kr[e.level].nice_length,e.max_chain_length=kr[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),i},za=function(e,i,t,r,a,n){if(!e)return Kt;var s=1;if(i===Ll&&(i=6),0>r?(s=0,r=-r):15<r&&(s=2,r-=16),1>a||9<a||t!==Li||8>r||15<r||0>i||9<i||0>n||n>Bl)return Pe(e,Kt);r===8&&(r=9);var o=new qs;return e.state=o,o.strm=e,o.wrap=s,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=i,o.strategy=n,o.method=t,Oa(e)},Ur={deflateInit:function(e,i){return za(e,i,Li,15,8,Ol)},deflateInit2:za,deflateReset:Oa,deflateResetKeep:Ba,deflateSetHeader:function(e,i){return!e||!e.state||e.state.wrap!==2?Kt:(e.state.gzhead=i,ie)},deflate:function(e,i){if(!e||!e.state||i>La||0>i)return e?Pe(e,Kt):Kt;var t=e.state;if(!e.output||!e.input&&e.avail_in!==0||t.status===666&&i!==Se)return Pe(e,e.avail_out===0?On:Kt);t.strm=e;var r=t.last_flush;if(t.last_flush=i,t.status===42)if(t.wrap===2)e.adler=0,et(t,31),et(t,139),et(t,8),t.gzhead?(et(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),et(t,t.gzhead.time&255),et(t,t.gzhead.time>>8&255),et(t,t.gzhead.time>>16&255),et(t,t.gzhead.time>>24&255),et(t,t.level===9?2:t.strategy>=Ri||2>t.level?4:0),et(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(et(t,t.gzhead.extra.length&255),et(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(e.adler=Tt(e.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69):(et(t,0),et(t,0),et(t,0),et(t,0),et(t,0),et(t,t.level===9?2:t.strategy>=Ri||2>t.level?4:0),et(t,3),t.status=113);else{var a=Li+(t.w_bits-8<<4)<<8;a|=(t.strategy>=Ri||2>t.level?0:6>t.level?1:t.level===6?2:3)<<6,t.strstart!==0&&(a|=32),t.status=113,br(t,a+(31-a%31)),t.strstart!==0&&(br(t,e.adler>>>16),br(t,e.adler&65535)),e.adler=1}if(t.status===69)if(t.gzhead.extra){for(a=t.pending;t.gzindex<(t.gzhead.extra.length&65535)&&(t.pending!==t.pending_buf_size||(t.gzhead.hcrc&&t.pending>a&&(e.adler=Tt(e.adler,t.pending_buf,t.pending-a,a)),Le(e),a=t.pending,t.pending!==t.pending_buf_size));)et(t,t.gzhead.extra[t.gzindex]&255),t.gzindex++;t.gzhead.hcrc&&t.pending>a&&(e.adler=Tt(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex===t.gzhead.extra.length&&(t.gzindex=0,t.status=73)}else t.status=73;if(t.status===73)if(t.gzhead.name){a=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>a&&(e.adler=Tt(e.adler,t.pending_buf,t.pending-a,a)),Le(e),a=t.pending,t.pending===t.pending_buf_size)){var n=1;break}n=t.gzindex<t.gzhead.name.length?t.gzhead.name.charCodeAt(t.gzindex++)&255:0,et(t,n)}while(n!==0);t.gzhead.hcrc&&t.pending>a&&(e.adler=Tt(e.adler,t.pending_buf,t.pending-a,a)),n===0&&(t.gzindex=0,t.status=91)}else t.status=91;if(t.status===91)if(t.gzhead.comment){a=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>a&&(e.adler=Tt(e.adler,t.pending_buf,t.pending-a,a)),Le(e),a=t.pending,t.pending===t.pending_buf_size)){n=1;break}n=t.gzindex<t.gzhead.comment.length?t.gzhead.comment.charCodeAt(t.gzindex++)&255:0,et(t,n)}while(n!==0);t.gzhead.hcrc&&t.pending>a&&(e.adler=Tt(e.adler,t.pending_buf,t.pending-a,a)),n===0&&(t.status=103)}else t.status=103;if(t.status===103&&(t.gzhead.hcrc?(t.pending+2>t.pending_buf_size&&Le(e),t.pending+2<=t.pending_buf_size&&(et(t,e.adler&255),et(t,e.adler>>8&255),e.adler=0,t.status=113)):t.status=113),t.pending!==0){if(Le(e),e.avail_out===0)return t.last_flush=-1,ie}else if(e.avail_in===0&&(i<<1)-(4<i?9:0)<=(r<<1)-(4<r?9:0)&&i!==Se)return Pe(e,On);if(t.status===666&&e.avail_in!==0)return Pe(e,On);if(e.avail_in!==0||t.lookahead!==0||i!==We&&t.status!==666){if(r=t.strategy===Ri?bl(t,i):t.strategy===Dl?Il(t,i):kr[t.level].func(t,i),(r===3||r===4)&&(t.status=666),r===1||r===3)return e.avail_out===0&&(t.last_flush=-1),ie;if(r===2&&(i===Pl?(zt(t,2,3),re(t,256,he),t.bi_valid===16?(zr(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)):i!==La&&(Ra(t,0,0,!1),i===El&&(Ee(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),Le(e),e.avail_out===0))return t.last_flush=-1,ie}return i!==Se?ie:0>=t.wrap?Fa:(t.wrap===2?(et(t,e.adler&255),et(t,e.adler>>8&255),et(t,e.adler>>16&255),et(t,e.adler>>24&255),et(t,e.total_in&255),et(t,e.total_in>>8&255),et(t,e.total_in>>16&255),et(t,e.total_in>>24&255)):(br(t,e.adler>>>16),br(t,e.adler&65535)),Le(e),0<t.wrap&&(t.wrap=-t.wrap),t.pending!==0?ie:Fa)},deflateEnd:function(e){if(!e||!e.state)return Kt;var i=e.state.status;return i!==42&&i!==69&&i!==73&&i!==91&&i!==103&&i!==113&&i!==666?Pe(e,Kt):(e.state=null,i===113?Pe(e,Rl):ie)},deflateSetDictionary:function(e,i){var t=i.length;if(!e||!e.state)return Kt;var r=e.state,a=r.wrap;if(a===2||a===1&&r.status!==42||r.lookahead)return Kt;if(a===1&&(e.adler=Ir(e.adler,i,t,0)),r.wrap=0,t>=r.w_size){a===0&&(Ee(r.head),r.strstart=0,r.block_start=0,r.insert=0);var n=new Uint8Array(r.w_size);n.set(i.subarray(t-r.w_size,t),0),i=n,t=r.w_size}n=e.avail_in;var s=e.next_in,o=e.input;for(e.avail_in=t,e.next_in=0,e.input=i,Ye(r);3<=r.lookahead;){i=r.strstart,t=r.lookahead-2;do r.ins_h=Re(r,r.ins_h,r.window[i+3-1]),r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++;while(--t);r.strstart=i,r.lookahead=2,Ye(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=o,e.avail_in=n,r.wrap=a,ie},deflateInfo:"pako deflate (from Nodeca project)"},Fi={assign:function(e){for(var i=Array.prototype.slice.call(arguments,1);i.length;){var t=i.shift();if(t){if((typeof t=="undefined"?"undefined":Ut(t))!=="object")throw new TypeError(t+"must be non-object");for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}}return e},flattenChunks:function(e){for(var i=0,t=0,r=e.length;t<r;t++)i+=e[t].length;i=new Uint8Array(i),r=t=0;for(var a=e.length;t<a;t++){var n=e[t];i.set(n,r),r+=n.length}return i}},Ia=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ia=!1}for(var Nr=new Uint8Array(256),Fe=0;256>Fe;Fe++)Nr[Fe]=252<=Fe?6:248<=Fe?5:240<=Fe?4:224<=Fe?3:192<=Fe?2:1;Nr[254]=Nr[254]=1;var jr={string2buf:function(e){var i,t,r=e.length,a=0;for(i=0;i<r;i++){var n=e.charCodeAt(i);if((n&64512)===55296&&i+1<r){var s=e.charCodeAt(i+1);(s&64512)===56320&&(n=65536+(n-55296<<10)+(s-56320),i++)}a+=128>n?1:2048>n?2:65536>n?3:4}var o=new Uint8Array(a);for(i=t=0;t<a;i++)n=e.charCodeAt(i),(n&64512)===55296&&i+1<r&&(s=e.charCodeAt(i+1),(s&64512)===56320&&(n=65536+(n-55296<<10)+(s-56320),i++)),128>n?o[t++]=n:(2048>n?o[t++]=192|n>>>6:(65536>n?o[t++]=224|n>>>12:(o[t++]=240|n>>>18,o[t++]=128|n>>>12&63),o[t++]=128|n>>>6&63),o[t++]=128|n&63);return o},buf2string:function(e,i){var t,r,a=i||e.length;for(i=Array(2*a),t=r=0;t<a;){var n=e[t++];if(128>n)i[r++]=n;else{var s=Nr[n];if(4<s)i[r++]=65533,t+=s-1;else{for(n&=s===2?31:s===3?15:7;1<s&&t<a;)n=n<<6|e[t++]&63,s--;1<s?i[r++]=65533:65536>n?i[r++]=n:(n-=65536,i[r++]=55296|n>>10&1023,i[r++]=56320|n&1023)}}}if(e=r,65534>e&&i.subarray&&Ia)i=String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));else{for(t="",r=0;r<e;r++)t+=String.fromCharCode(i[r]);i=t}return i},utf8border:function(e,i){i=i||e.length,i>e.length&&(i=e.length);for(var t=i-1;0<=t&&(e[t]&192)===128;)t--;return 0>t||t===0?i:t+Nr[e[t]]>i?t:i}},ba=function(){this.input=null,this.total_in=this.avail_in=this.next_in=0,this.output=null,this.total_out=this.avail_out=this.next_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},ka=Object.prototype.toString,kl=G.Z_NO_FLUSH,Ul=G.Z_SYNC_FLUSH,Nl=G.Z_FULL_FLUSH,jl=G.Z_FINISH,Di=G.Z_OK,Hl=G.Z_STREAM_END,Xl=G.Z_DEFAULT_COMPRESSION,Wl=G.Z_DEFAULT_STRATEGY,Yl=G.Z_DEFLATED;dr.prototype.push=function(e,i){var t=this.strm,r=this.options.chunkSize;if(this.ended)return!1;for(i=i===~~i?i:i===!0?jl:kl,typeof e=="string"?t.input=jr.string2buf(e):ka.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;)if(t.avail_out===0&&(t.output=new Uint8Array(r),t.next_out=0,t.avail_out=r),(i===Ul||i===Nl)&&6>=t.avail_out)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else{if(e=Ur.deflate(t,i),e===Hl)return 0<t.next_out&&this.onData(t.output.subarray(0,t.next_out)),e=Ur.deflateEnd(this.strm),this.onEnd(e),this.ended=!0,e===Di;if(t.avail_out===0)this.onData(t.output);else if(0<i&&0<t.next_out)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else if(t.avail_in===0)break}return!0},dr.prototype.onData=function(e){this.chunks.push(e)},dr.prototype.onEnd=function(e){e===Di&&(this.result=Fi.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Zl=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Vl=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Gl=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Kl=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Hr=function(e,i,t,r,a,n,s,o){var u=o.bits,h,v,l,f,d,c,p=0,m=new Uint16Array(16),g=new Uint16Array(16),x,y=0;for(h=0;15>=h;h++)m[h]=0;for(v=0;v<r;v++)m[i[t+v]]++;var _=u;for(l=15;1<=l&&m[l]===0;l--);if(_>l&&(_=l),l===0)return a[n++]=20971520,a[n++]=20971520,o.bits=1,0;for(u=1;u<l&&m[u]===0;u++);for(_<u&&(_=u),h=f=1;15>=h;h++)if(f<<=1,f-=m[h],0>f)return-1;if(0<f&&(e===0||l!==1))return-1;for(g[1]=0,h=1;15>h;h++)g[h+1]=g[h]+m[h];for(v=0;v<r;v++)i[t+v]!==0&&(s[g[i[t+v]]++]=v);if(e===0)var A=x=s,T=19;else e===1?(A=Zl,p-=257,x=Vl,y-=257,T=256):(A=Gl,x=Kl,T=-1);v=d=0,h=u;var w=n;r=_,g=0;var C=-1,M=1<<_,E=M-1;if(e===1&&852<M||e===2&&592<M)return 1;for(;;){var P=h-g;if(s[v]<T)var L=0,R=s[v];else s[v]>T?(L=x[y+s[v]],R=A[p+s[v]]):(L=96,R=0);f=1<<h-g,u=c=1<<r;do c-=f,a[w+(d>>g)+c]=P<<24|L<<16|R|0;while(c!==0);for(f=1<<h-1;d&f;)f>>=1;if(f!==0?(d&=f-1,d+=f):d=0,v++,--m[h]===0){if(h===l)break;h=i[t+s[v]]}if(h>_&&(d&E)!==C){for(g===0&&(g=_),w+=u,r=h-g,f=1<<r;r+g<l&&(f-=m[r+g],!(0>=f));)r++,f<<=1;if(M+=1<<r,e===1&&852<M||e===2&&592<M)return 1;C=d&E,a[C]=_<<24|r<<16|w-n|0}}return d!==0&&(a[w+d]=h-g<<24|4194304),o.bits=_,0},Ua=G.Z_FINISH,Ql=G.Z_BLOCK,Bi=G.Z_TREES,Ze=G.Z_OK,Jl=G.Z_STREAM_END,ql=G.Z_NEED_DICT,Wt=G.Z_STREAM_ERROR,Na=G.Z_DATA_ERROR,$l=G.Z_MEM_ERROR,tf=G.Z_BUF_ERROR,ja=G.Z_DEFLATED,Ha=function(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)},Xa=function(e){if(!e||!e.state)return Wt;var i=e.state;return e.total_in=e.total_out=i.total=0,e.msg="",i.wrap&&(e.adler=i.wrap&1),i.mode=1,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,Ze},Wa=function(e){if(!e||!e.state)return Wt;var i=e.state;return i.wsize=0,i.whave=0,i.wnext=0,Xa(e)},Ya=function(e,i){if(!e||!e.state)return Wt;var t=e.state;if(0>i){var r=0;i=-i}else r=(i>>4)+1,48>i&&(i&=15);return i&&(8>i||15<i)?Wt:(t.window!==null&&t.wbits!==i&&(t.window=null),t.wrap=r,t.wbits=i,Wa(e))},Za=function(e,i){if(!e)return Wt;var t=new $s;return e.state=t,t.window=null,i=Ya(e,i),i!==Ze&&(e.state=null),i},Va=!0,In=void 0,bn=void 0,Ga=function(e,i,t,r){var a=e.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(i.subarray(t-a.wsize,t),0),a.wnext=0,a.whave=a.wsize):(e=a.wsize-a.wnext,e>r&&(e=r),a.window.set(i.subarray(t-r,t-r+e),a.wnext),(r-=e)?(a.window.set(i.subarray(t-r,t),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=e,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=e))),0},ce={inflateReset:Wa,inflateReset2:Ya,inflateResetKeep:Xa,inflateInit:function(e){return Za(e,15)},inflateInit2:Za,inflate:function(e,i){var t=new Uint8Array(4),r=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return Wt;var a=e.state;a.mode===12&&(a.mode=13);var n=e.next_out,s=e.output,o=e.avail_out,u=e.next_in,h=e.input,v=e.avail_in,l=a.hold,f=a.bits,d=v,c=o,p=Ze;t:for(;;)switch(a.mode){case 1:if(a.wrap===0){a.mode=13;break}for(;16>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if(a.wrap&2&&l===35615){a.check=0,t[0]=l&255,t[1]=l>>>8&255,a.check=Tt(a.check,t,2,0),f=l=0,a.mode=2;break}if(a.flags=0,a.head&&(a.head.done=!1),!(a.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",a.mode=30;break}if((l&15)!==ja){e.msg="unknown compression method",a.mode=30;break}l>>>=4,f-=4;var m=(l&15)+8;if(a.wbits===0)a.wbits=m;else if(m>a.wbits){e.msg="invalid window size",a.mode=30;break}a.dmax=1<<a.wbits,e.adler=a.check=1,a.mode=l&512?10:12,f=l=0;break;case 2:for(;16>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if(a.flags=l,(a.flags&255)!==ja){e.msg="unknown compression method",a.mode=30;break}if(a.flags&57344){e.msg="unknown header flags set",a.mode=30;break}a.head&&(a.head.text=l>>8&1),a.flags&512&&(t[0]=l&255,t[1]=l>>>8&255,a.check=Tt(a.check,t,2,0)),f=l=0,a.mode=3;case 3:for(;32>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}a.head&&(a.head.time=l),a.flags&512&&(t[0]=l&255,t[1]=l>>>8&255,t[2]=l>>>16&255,t[3]=l>>>24&255,a.check=Tt(a.check,t,4,0)),f=l=0,a.mode=4;case 4:for(;16>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}a.head&&(a.head.xflags=l&255,a.head.os=l>>8),a.flags&512&&(t[0]=l&255,t[1]=l>>>8&255,a.check=Tt(a.check,t,2,0)),f=l=0,a.mode=5;case 5:if(a.flags&1024){for(;16>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}a.length=l,a.head&&(a.head.extra_len=l),a.flags&512&&(t[0]=l&255,t[1]=l>>>8&255,a.check=Tt(a.check,t,2,0)),f=l=0}else a.head&&(a.head.extra=null);a.mode=6;case 6:if(a.flags&1024){var g=a.length;if(g>v&&(g=v),g&&(a.head&&(m=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(h.subarray(u,u+g),m)),a.flags&512&&(a.check=Tt(a.check,h,g,u)),v-=g,u+=g,a.length-=g),a.length)break t}a.length=0,a.mode=7;case 7:if(a.flags&2048){if(v===0)break t;g=0;do m=h[u+g++],a.head&&m&&65536>a.length&&(a.head.name+=String.fromCharCode(m));while(m&&g<v);if(a.flags&512&&(a.check=Tt(a.check,h,g,u)),v-=g,u+=g,m)break t}else a.head&&(a.head.name=null);a.length=0,a.mode=8;case 8:if(a.flags&4096){if(v===0)break t;g=0;do m=h[u+g++],a.head&&m&&65536>a.length&&(a.head.comment+=String.fromCharCode(m));while(m&&g<v);if(a.flags&512&&(a.check=Tt(a.check,h,g,u)),v-=g,u+=g,m)break t}else a.head&&(a.head.comment=null);a.mode=9;case 9:if(a.flags&512){for(;16>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if(l!==(a.check&65535)){e.msg="header crc mismatch",a.mode=30;break}f=l=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=12;break;case 10:for(;32>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}e.adler=a.check=Ha(l),f=l=0,a.mode=11;case 11:if(a.havedict===0)return e.next_out=n,e.avail_out=o,e.next_in=u,e.avail_in=v,a.hold=l,a.bits=f,ql;e.adler=a.check=1,a.mode=12;case 12:if(i===Ql||i===Bi)break t;case 13:if(a.last){l>>>=f&7,f-=f&7,a.mode=27;break}for(;3>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}switch(a.last=l&1,l>>>=1,--f,l&3){case 0:a.mode=14;break;case 1:if(g=a,Va){for(In=new Int32Array(512),bn=new Int32Array(32),m=0;144>m;)g.lens[m++]=8;for(;256>m;)g.lens[m++]=9;for(;280>m;)g.lens[m++]=7;for(;288>m;)g.lens[m++]=8;for(Hr(1,g.lens,0,288,In,0,g.work,{bits:9}),m=0;32>m;)g.lens[m++]=5;Hr(2,g.lens,0,32,bn,0,g.work,{bits:5}),Va=!1}if(g.lencode=In,g.lenbits=9,g.distcode=bn,g.distbits=5,a.mode=20,i===Bi){l>>>=2,f-=2;break t}break;case 2:a.mode=17;break;case 3:e.msg="invalid block type",a.mode=30}l>>>=2,f-=2;break;case 14:for(l>>>=f&7,f-=f&7;32>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",a.mode=30;break}if(a.length=l&65535,f=l=0,a.mode=15,i===Bi)break t;case 15:a.mode=16;case 16:if(g=a.length){if(g>v&&(g=v),g>o&&(g=o),g===0)break t;s.set(h.subarray(u,u+g),n),v-=g,u+=g,o-=g,n+=g,a.length-=g;break}a.mode=12;break;case 17:for(;14>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if(a.nlen=(l&31)+257,l>>>=5,f-=5,a.ndist=(l&31)+1,l>>>=5,f-=5,a.ncode=(l&15)+4,l>>>=4,f-=4,286<a.nlen||30<a.ndist){e.msg="too many length or distance symbols",a.mode=30;break}a.have=0,a.mode=18;case 18:for(;a.have<a.ncode;){for(;3>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}a.lens[r[a.have++]]=l&7,l>>>=3,f-=3}for(;19>a.have;)a.lens[r[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,g={bits:a.lenbits},p=Hr(0,a.lens,0,19,a.lencode,0,a.work,g),a.lenbits=g.bits,p){e.msg="invalid code lengths set",a.mode=30;break}a.have=0,a.mode=19;case 19:for(;a.have<a.nlen+a.ndist;){for(;;){var x=a.lencode[l&(1<<a.lenbits)-1];if(g=x>>>24,x&=65535,g<=f)break;if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if(16>x)l>>>=g,f-=g,a.lens[a.have++]=x;else{if(x===16){for(m=g+2;f<m;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if(l>>>=g,f-=g,a.have===0){e.msg="invalid bit length repeat",a.mode=30;break}m=a.lens[a.have-1],g=3+(l&3),l>>>=2,f-=2}else if(x===17){for(m=g+3;f<m;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}l>>>=g,f-=g,m=0,g=3+(l&7),l>>>=3,f-=3}else{for(m=g+7;f<m;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}l>>>=g,f-=g,m=0,g=11+(l&127),l>>>=7,f-=7}if(a.have+g>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=30;break}for(;g--;)a.lens[a.have++]=m}}if(a.mode===30)break;if(a.lens[256]===0){e.msg="invalid code -- missing end-of-block",a.mode=30;break}if(a.lenbits=9,g={bits:a.lenbits},p=Hr(1,a.lens,0,a.nlen,a.lencode,0,a.work,g),a.lenbits=g.bits,p){e.msg="invalid literal/lengths set",a.mode=30;break}if(a.distbits=6,a.distcode=a.distdyn,g={bits:a.distbits},p=Hr(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,g),a.distbits=g.bits,p){e.msg="invalid distances set",a.mode=30;break}if(a.mode=20,i===Bi)break t;case 20:a.mode=21;case 21:if(6<=v&&258<=o){e.next_out=n,e.avail_out=o,e.next_in=u,e.avail_in=v,a.hold=l,a.bits=f,h=e;var y=h.state;s=h.next_in;var _=h.input;u=s+(h.avail_in-5),n=h.next_out;var A=h.output;v=n-(c-h.avail_out),o=n+(h.avail_out-257),l=y.dmax,f=y.wsize,g=y.whave,m=y.wnext;var T=y.window,w=y.hold,C=y.bits;x=y.lencode;var M=y.distcode,E=(1<<y.lenbits)-1,P=(1<<y.distbits)-1;e:do{15>C&&(w+=_[s++]<<C,C+=8,w+=_[s++]<<C,C+=8);var L=x[w&E];r:for(;;){var R=L>>>24;if(w>>>=R,C-=R,R=L>>>16&255,R===0)A[n++]=L&65535;else if(R&16){var b=L&65535;(R&=15)&&(C<R&&(w+=_[s++]<<C,C+=8),b+=w&(1<<R)-1,w>>>=R,C-=R),15>C&&(w+=_[s++]<<C,C+=8,w+=_[s++]<<C,C+=8),L=M[w&P];i:for(;;){if(R=L>>>24,w>>>=R,C-=R,R=L>>>16&255,R&16){if(L&=65535,R&=15,C<R&&(w+=_[s++]<<C,C+=8,C<R&&(w+=_[s++]<<C,C+=8)),L+=w&(1<<R)-1,L>l){h.msg="invalid distance too far back",y.mode=30;break e}if(w>>>=R,C-=R,R=n-v,L>R){if(R=L-R,R>g&&y.sane){h.msg="invalid distance too far back",y.mode=30;break e}var H=0,S=T;if(m===0){if(H+=f-R,R<b){b-=R;do A[n++]=T[H++];while(--R);H=n-L,S=A}}else if(m<R){if(H+=f+m-R,R-=m,R<b){b-=R;do A[n++]=T[H++];while(--R);if(H=0,m<b){R=m,b-=R;do A[n++]=T[H++];while(--R);H=n-L,S=A}}}else if(H+=m-R,R<b){b-=R;do A[n++]=T[H++];while(--R);H=n-L,S=A}for(;2<b;)A[n++]=S[H++],A[n++]=S[H++],A[n++]=S[H++],b-=3;b&&(A[n++]=S[H++],1<b&&(A[n++]=S[H++]))}else{H=n-L;do A[n++]=A[H++],A[n++]=A[H++],A[n++]=A[H++],b-=3;while(2<b);b&&(A[n++]=A[H++],1<b&&(A[n++]=A[H++]))}}else if((R&64)===0){L=M[(L&65535)+(w&(1<<R)-1)];continue i}else{h.msg="invalid distance code",y.mode=30;break e}break}}else if((R&64)===0){L=x[(L&65535)+(w&(1<<R)-1)];continue r}else{R&32?y.mode=12:(h.msg="invalid literal/length code",y.mode=30);break e}break}}while(s<u&&n<o);b=C>>3,s-=b,C-=b<<3,h.next_in=s,h.next_out=n,h.avail_in=s<u?5+(u-s):5-(s-u),h.avail_out=n<o?257+(o-n):257-(n-o),y.hold=w&(1<<C)-1,y.bits=C,n=e.next_out,s=e.output,o=e.avail_out,u=e.next_in,h=e.input,v=e.avail_in,l=a.hold,f=a.bits,a.mode===12&&(a.back=-1);break}for(a.back=0;x=a.lencode[l&(1<<a.lenbits)-1],g=x>>>24,m=x>>>16&255,x&=65535,!(g<=f);){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if(m&&(m&240)===0){for(T=g,w=m,C=x;x=a.lencode[C+((l&(1<<T+w)-1)>>T)],g=x>>>24,m=x>>>16&255,x&=65535,!(T+g<=f);){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}l>>>=T,f-=T,a.back+=T}if(l>>>=g,f-=g,a.back+=g,a.length=x,m===0){a.mode=26;break}if(m&32){a.back=-1,a.mode=12;break}if(m&64){e.msg="invalid literal/length code",a.mode=30;break}a.extra=m&15,a.mode=22;case 22:if(a.extra){for(m=a.extra;f<m;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}a.length+=l&(1<<a.extra)-1,l>>>=a.extra,f-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=23;case 23:for(;x=a.distcode[l&(1<<a.distbits)-1],g=x>>>24,m=x>>>16&255,x&=65535,!(g<=f);){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if((m&240)===0){for(T=g,w=m,C=x;x=a.distcode[C+((l&(1<<T+w)-1)>>T)],g=x>>>24,m=x>>>16&255,x&=65535,!(T+g<=f);){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}l>>>=T,f-=T,a.back+=T}if(l>>>=g,f-=g,a.back+=g,m&64){e.msg="invalid distance code",a.mode=30;break}a.offset=x,a.extra=m&15,a.mode=24;case 24:if(a.extra){for(m=a.extra;f<m;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}a.offset+=l&(1<<a.extra)-1,l>>>=a.extra,f-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=30;break}a.mode=25;case 25:if(o===0)break t;if(g=c-o,a.offset>g){if(g=a.offset-g,g>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=30;break}g>a.wnext?(g-=a.wnext,m=a.wsize-g):m=a.wnext-g,g>a.length&&(g=a.length),T=a.window}else T=s,m=n-a.offset,g=a.length;g>o&&(g=o),o-=g,a.length-=g;do s[n++]=T[m++];while(--g);a.length===0&&(a.mode=21);break;case 26:if(o===0)break t;s[n++]=a.length,o--,a.mode=21;break;case 27:if(a.wrap){for(;32>f;){if(v===0)break t;v--,l|=h[u++]<<f,f+=8}if(c-=o,e.total_out+=c,a.total+=c,c&&(e.adler=a.check=a.flags?Tt(a.check,s,c,n-c):Ir(a.check,s,c,n-c)),c=o,(a.flags?l:Ha(l))!==a.check){e.msg="incorrect data check",a.mode=30;break}f=l=0}a.mode=28;case 28:if(a.wrap&&a.flags){for(;32>f;){if(v===0)break t;v--,l+=h[u++]<<f,f+=8}if(l!==(a.total&4294967295)){e.msg="incorrect length check",a.mode=30;break}f=l=0}a.mode=29;case 29:p=Jl;break t;case 30:p=Na;break t;case 31:return $l;default:return Wt}return e.next_out=n,e.avail_out=o,e.next_in=u,e.avail_in=v,a.hold=l,a.bits=f,(a.wsize||c!==e.avail_out&&30>a.mode&&(27>a.mode||i!==Ua))&&Ga(e,e.output,e.next_out,c-e.avail_out),d-=e.avail_in,c-=e.avail_out,e.total_in+=d,e.total_out+=c,a.total+=c,a.wrap&&c&&(e.adler=a.check=a.flags?Tt(a.check,s,c,e.next_out-c):Ir(a.check,s,c,e.next_out-c)),e.data_type=a.bits+(a.last?64:0)+(a.mode===12?128:0)+(a.mode===20||a.mode===15?256:0),(d===0&&c===0||i===Ua)&&p===Ze&&(p=tf),p},inflateEnd:function(e){if(!e||!e.state)return Wt;var i=e.state;return i.window&&(i.window=null),e.state=null,Ze},inflateGetHeader:function(e,i){return!e||!e.state||(e=e.state,(e.wrap&2)===0)?Wt:(e.head=i,i.done=!1,Ze)},inflateSetDictionary:function(e,i){var t=i.length;if(!e||!e.state)return Wt;var r=e.state;if(r.wrap!==0&&r.mode!==11)return Wt;if(r.mode===11){var a=Ir(1,i,t,0);if(a!==r.check)return Na}return Ga(e,i,t,t),r.havedict=1,Ze},inflateInfo:"pako inflate (from Nodeca project)"},ef=function(){this.os=this.xflags=this.time=this.text=0,this.extra=null,this.extra_len=0,this.comment=this.name="",this.hcrc=0,this.done=!1},Ka=Object.prototype.toString,rf=G.Z_NO_FLUSH,nf=G.Z_FINISH,Xr=G.Z_OK,kn=G.Z_STREAM_END,Un=G.Z_NEED_DICT,of=G.Z_STREAM_ERROR,Qa=G.Z_DATA_ERROR,af=G.Z_MEM_ERROR;vr.prototype.push=function(e,i){var t=this.strm,r=this.options.chunkSize,a=this.options.dictionary;if(this.ended)return!1;var n=i===~~i?i:i===!0?nf:rf;for(Ka.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(r),t.next_out=0,t.avail_out=r),i=ce.inflate(t,n),i===Un&&a&&(i=ce.inflateSetDictionary(t,a),i===Xr?i=ce.inflate(t,n):i===Qa&&(i=Un));0<t.avail_in&&i===kn&&0<t.state.wrap&&e[t.next_in]!==0;)ce.inflateReset(t),i=ce.inflate(t,n);switch(i){case of:case Qa:case Un:case af:return this.onEnd(i),this.ended=!0,!1}var s=t.avail_out;if(t.next_out&&(t.avail_out===0||i===kn))if(this.options.to==="string"){var o=jr.utf8border(t.output,t.next_out),u=t.next_out-o,h=jr.buf2string(t.output,o);t.next_out=u,t.avail_out=r-u,u&&t.output.set(t.output.subarray(o,o+u),0),this.onData(h)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(i!==Xr||s!==0){if(i===kn){i=ce.inflateEnd(this.strm),this.onEnd(i),this.ended=!0;break}if(t.avail_in===0)break}}return!0},vr.prototype.onData=function(e){this.chunks.push(e)},vr.prototype.onEnd=function(e){e===Xr&&(this.result=this.options.to==="string"?this.chunks.join(""):Fi.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ja={Deflate:dr,deflate:$i,deflateRaw:function(e,i){return i=i||{},i.raw=!0,$i(e,i)},gzip:function(e,i){return i=i||{},i.gzip=!0,$i(e,i)},Inflate:vr,inflate:tn,inflateRaw:function(e,i){return i=i||{},i.raw=!0,tn(e,i)},ungzip:tn,constants:G},Qt=V(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setMatrixArrayType=function(n){i.ARRAY_TYPE=r=n},i.toRadian=function(n){return n*a},i.equals=function(n,s){return Math.abs(n-s)<=t*Math.max(1,Math.abs(n),Math.abs(s))},i.RANDOM=i.ARRAY_TYPE=i.EPSILON=void 0;var t=1e-6;i.EPSILON=t;var r=typeof Float32Array!="undefined"?Float32Array:Array;i.ARRAY_TYPE=r,i.RANDOM=Math.random;var a=Math.PI/180});tt(Qt);var qa=V(function(e,i){function t(n,s,o){var u=s[0],h=s[1],v=s[2];s=s[3];var l=o[0],f=o[1],d=o[2];return o=o[3],n[0]=u*l+v*f,n[1]=h*l+s*f,n[2]=u*d+v*o,n[3]=h*d+s*o,n}function r(n,s,o){return n[0]=s[0]-o[0],n[1]=s[1]-o[1],n[2]=s[2]-o[2],n[3]=s[3]-o[3],n}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var n=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},i.clone=function(n){var s=new a.ARRAY_TYPE(4);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s},i.copy=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n},i.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},i.fromValues=function(n,s,o,u){var h=new a.ARRAY_TYPE(4);return h[0]=n,h[1]=s,h[2]=o,h[3]=u,h},i.set=function(n,s,o,u,h){return n[0]=s,n[1]=o,n[2]=u,n[3]=h,n},i.transpose=function(n,s){if(n===s){var o=s[1];n[1]=s[2],n[2]=o}else n[0]=s[0],n[1]=s[2],n[2]=s[1],n[3]=s[3];return n},i.invert=function(n,s){var o=s[0],u=s[1],h=s[2];s=s[3];var v=o*s-h*u;return v?(v=1/v,n[0]=s*v,n[1]=-u*v,n[2]=-h*v,n[3]=o*v,n):null},i.adjoint=function(n,s){var o=s[0];return n[0]=s[3],n[1]=-s[1],n[2]=-s[2],n[3]=o,n},i.determinant=function(n){return n[0]*n[3]-n[2]*n[1]},i.multiply=t,i.rotate=function(n,s,o){var u=s[0],h=s[1],v=s[2];s=s[3];var l=Math.sin(o);return o=Math.cos(o),n[0]=u*o+v*l,n[1]=h*o+s*l,n[2]=u*-l+v*o,n[3]=h*-l+s*o,n},i.scale=function(n,s,o){var u=s[1],h=s[2],v=s[3],l=o[0];return o=o[1],n[0]=s[0]*l,n[1]=u*l,n[2]=h*o,n[3]=v*o,n},i.fromRotation=function(n,s){var o=Math.sin(s);return s=Math.cos(s),n[0]=s,n[1]=o,n[2]=-o,n[3]=s,n},i.fromScaling=function(n,s){return n[0]=s[0],n[1]=0,n[2]=0,n[3]=s[1],n},i.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},i.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2))},i.LDU=function(n,s,o,u){return n[2]=u[2]/u[0],o[0]=u[0],o[1]=u[1],o[3]=u[3]-n[2]*o[1],[n,s,o]},i.add=function(n,s,o){return n[0]=s[0]+o[0],n[1]=s[1]+o[1],n[2]=s[2]+o[2],n[3]=s[3]+o[3],n},i.subtract=r,i.exactEquals=function(n,s){return n[0]===s[0]&&n[1]===s[1]&&n[2]===s[2]&&n[3]===s[3]},i.equals=function(n,s){var o=n[0],u=n[1],h=n[2];n=n[3];var v=s[0],l=s[1],f=s[2];return s=s[3],Math.abs(o-v)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(u-l)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(l))&&Math.abs(h-f)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(f))&&Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},i.multiplyScalar=function(n,s,o){return n[0]=s[0]*o,n[1]=s[1]*o,n[2]=s[2]*o,n[3]=s[3]*o,n},i.multiplyScalarAndAdd=function(n,s,o,u){return n[0]=s[0]+o[0]*u,n[1]=s[1]+o[1]*u,n[2]=s[2]+o[2]*u,n[3]=s[3]+o[3]*u,n},i.sub=i.mul=void 0;var a=function(n){if(n&&n.__esModule)return n;var s={};if(n!=null){for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var u=pt&&vt?vt(n,o):{};u.get||u.set?pt(s,o,u):s[o]=n[o]}}return s.default=n,s}(Qt);i.mul=t,i.sub=r});tt(qa);var $a=V(function(e,i){function t(n,s,o){var u=s[0],h=s[1],v=s[2],l=s[3],f=s[4];s=s[5];var d=o[0],c=o[1],p=o[2],m=o[3],g=o[4];return o=o[5],n[0]=u*d+v*c,n[1]=h*d+l*c,n[2]=u*p+v*m,n[3]=h*p+l*m,n[4]=u*g+v*o+f,n[5]=h*g+l*o+s,n}function r(n,s,o){return n[0]=s[0]-o[0],n[1]=s[1]-o[1],n[2]=s[2]-o[2],n[3]=s[3]-o[3],n[4]=s[4]-o[4],n[5]=s[5]-o[5],n}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var n=new a.ARRAY_TYPE(6);return a.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[4]=0,n[5]=0),n[0]=1,n[3]=1,n},i.clone=function(n){var s=new a.ARRAY_TYPE(6);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s},i.copy=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n},i.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},i.fromValues=function(n,s,o,u,h,v){var l=new a.ARRAY_TYPE(6);return l[0]=n,l[1]=s,l[2]=o,l[3]=u,l[4]=h,l[5]=v,l},i.set=function(n,s,o,u,h,v,l){return n[0]=s,n[1]=o,n[2]=u,n[3]=h,n[4]=v,n[5]=l,n},i.invert=function(n,s){var o=s[0],u=s[1],h=s[2],v=s[3],l=s[4];s=s[5];var f=o*v-u*h;return f?(f=1/f,n[0]=v*f,n[1]=-u*f,n[2]=-h*f,n[3]=o*f,n[4]=(h*s-v*l)*f,n[5]=(u*l-o*s)*f,n):null},i.determinant=function(n){return n[0]*n[3]-n[1]*n[2]},i.multiply=t,i.rotate=function(n,s,o){var u=s[0],h=s[1],v=s[2],l=s[3],f=s[4];s=s[5];var d=Math.sin(o);return o=Math.cos(o),n[0]=u*o+v*d,n[1]=h*o+l*d,n[2]=u*-d+v*o,n[3]=h*-d+l*o,n[4]=f,n[5]=s,n},i.scale=function(n,s,o){var u=s[1],h=s[2],v=s[3],l=s[4],f=s[5],d=o[0];return o=o[1],n[0]=s[0]*d,n[1]=u*d,n[2]=h*o,n[3]=v*o,n[4]=l,n[5]=f,n},i.translate=function(n,s,o){var u=s[0],h=s[1],v=s[2],l=s[3],f=s[4];s=s[5];var d=o[0];return o=o[1],n[0]=u,n[1]=h,n[2]=v,n[3]=l,n[4]=u*d+v*o+f,n[5]=h*d+l*o+s,n},i.fromRotation=function(n,s){var o=Math.sin(s);return s=Math.cos(s),n[0]=s,n[1]=o,n[2]=-o,n[3]=s,n[4]=0,n[5]=0,n},i.fromScaling=function(n,s){return n[0]=s[0],n[1]=0,n[2]=0,n[3]=s[1],n[4]=0,n[5]=0,n},i.fromTranslation=function(n,s){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=s[0],n[5]=s[1],n},i.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"},i.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+1)},i.add=function(n,s,o){return n[0]=s[0]+o[0],n[1]=s[1]+o[1],n[2]=s[2]+o[2],n[3]=s[3]+o[3],n[4]=s[4]+o[4],n[5]=s[5]+o[5],n},i.subtract=r,i.multiplyScalar=function(n,s,o){return n[0]=s[0]*o,n[1]=s[1]*o,n[2]=s[2]*o,n[3]=s[3]*o,n[4]=s[4]*o,n[5]=s[5]*o,n},i.multiplyScalarAndAdd=function(n,s,o,u){return n[0]=s[0]+o[0]*u,n[1]=s[1]+o[1]*u,n[2]=s[2]+o[2]*u,n[3]=s[3]+o[3]*u,n[4]=s[4]+o[4]*u,n[5]=s[5]+o[5]*u,n},i.exactEquals=function(n,s){return n[0]===s[0]&&n[1]===s[1]&&n[2]===s[2]&&n[3]===s[3]&&n[4]===s[4]&&n[5]===s[5]},i.equals=function(n,s){var o=n[0],u=n[1],h=n[2],v=n[3],l=n[4];n=n[5];var f=s[0],d=s[1],c=s[2],p=s[3],m=s[4];return s=s[5],Math.abs(o-f)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(u-d)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))&&Math.abs(h-c)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(c))&&Math.abs(v-p)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(p))&&Math.abs(l-m)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},i.sub=i.mul=void 0;var a=function(n){if(n&&n.__esModule)return n;var s={};if(n!=null){for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var u=pt&&vt?vt(n,o):{};u.get||u.set?pt(s,o,u):s[o]=n[o]}}return s.default=n,s}(Qt);i.mul=t,i.sub=r});tt($a);var Nn=V(function(e,i){function t(n,s,o){var u=s[0],h=s[1],v=s[2],l=s[3],f=s[4],d=s[5],c=s[6],p=s[7];s=s[8];var m=o[0],g=o[1],x=o[2],y=o[3],_=o[4],A=o[5],T=o[6],w=o[7];return o=o[8],n[0]=m*u+g*l+x*c,n[1]=m*h+g*f+x*p,n[2]=m*v+g*d+x*s,n[3]=y*u+_*l+A*c,n[4]=y*h+_*f+A*p,n[5]=y*v+_*d+A*s,n[6]=T*u+w*l+o*c,n[7]=T*h+w*f+o*p,n[8]=T*v+w*d+o*s,n}function r(n,s,o){return n[0]=s[0]-o[0],n[1]=s[1]-o[1],n[2]=s[2]-o[2],n[3]=s[3]-o[3],n[4]=s[4]-o[4],n[5]=s[5]-o[5],n[6]=s[6]-o[6],n[7]=s[7]-o[7],n[8]=s[8]-o[8],n}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var n=new a.ARRAY_TYPE(9);return a.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},i.fromMat4=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[4],n[4]=s[5],n[5]=s[6],n[6]=s[8],n[7]=s[9],n[8]=s[10],n},i.clone=function(n){var s=new a.ARRAY_TYPE(9);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s},i.copy=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n},i.fromValues=function(n,s,o,u,h,v,l,f,d){var c=new a.ARRAY_TYPE(9);return c[0]=n,c[1]=s,c[2]=o,c[3]=u,c[4]=h,c[5]=v,c[6]=l,c[7]=f,c[8]=d,c},i.set=function(n,s,o,u,h,v,l,f,d,c){return n[0]=s,n[1]=o,n[2]=u,n[3]=h,n[4]=v,n[5]=l,n[6]=f,n[7]=d,n[8]=c,n},i.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},i.transpose=function(n,s){if(n===s){var o=s[1],u=s[2],h=s[5];n[1]=s[3],n[2]=s[6],n[3]=o,n[5]=s[7],n[6]=u,n[7]=h}else n[0]=s[0],n[1]=s[3],n[2]=s[6],n[3]=s[1],n[4]=s[4],n[5]=s[7],n[6]=s[2],n[7]=s[5],n[8]=s[8];return n},i.invert=function(n,s){var o=s[0],u=s[1],h=s[2],v=s[3],l=s[4],f=s[5],d=s[6],c=s[7];s=s[8];var p=s*l-f*c,m=-s*v+f*d,g=c*v-l*d,x=o*p+u*m+h*g;return x?(x=1/x,n[0]=p*x,n[1]=(-s*u+h*c)*x,n[2]=(f*u-h*l)*x,n[3]=m*x,n[4]=(s*o-h*d)*x,n[5]=(-f*o+h*v)*x,n[6]=g*x,n[7]=(-c*o+u*d)*x,n[8]=(l*o-u*v)*x,n):null},i.adjoint=function(n,s){var o=s[0],u=s[1],h=s[2],v=s[3],l=s[4],f=s[5],d=s[6],c=s[7];return s=s[8],n[0]=l*s-f*c,n[1]=h*c-u*s,n[2]=u*f-h*l,n[3]=f*d-v*s,n[4]=o*s-h*d,n[5]=h*v-o*f,n[6]=v*c-l*d,n[7]=u*d-o*c,n[8]=o*l-u*v,n},i.determinant=function(n){var s=n[3],o=n[4],u=n[5],h=n[6],v=n[7],l=n[8];return n[0]*(l*o-u*v)+n[1]*(-l*s+u*h)+n[2]*(v*s-o*h)},i.multiply=t,i.translate=function(n,s,o){var u=s[0],h=s[1],v=s[2],l=s[3],f=s[4],d=s[5],c=s[6],p=s[7];s=s[8];var m=o[0];return o=o[1],n[0]=u,n[1]=h,n[2]=v,n[3]=l,n[4]=f,n[5]=d,n[6]=m*u+o*l+c,n[7]=m*h+o*f+p,n[8]=m*v+o*d+s,n},i.rotate=function(n,s,o){var u=s[0],h=s[1],v=s[2],l=s[3],f=s[4],d=s[5],c=s[6],p=s[7];s=s[8];var m=Math.sin(o);return o=Math.cos(o),n[0]=o*u+m*l,n[1]=o*h+m*f,n[2]=o*v+m*d,n[3]=o*l-m*u,n[4]=o*f-m*h,n[5]=o*d-m*v,n[6]=c,n[7]=p,n[8]=s,n},i.scale=function(n,s,o){var u=o[0];return o=o[1],n[0]=u*s[0],n[1]=u*s[1],n[2]=u*s[2],n[3]=o*s[3],n[4]=o*s[4],n[5]=o*s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n},i.fromTranslation=function(n,s){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=s[0],n[7]=s[1],n[8]=1,n},i.fromRotation=function(n,s){var o=Math.sin(s);return s=Math.cos(s),n[0]=s,n[1]=o,n[2]=0,n[3]=-o,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},i.fromScaling=function(n,s){return n[0]=s[0],n[1]=0,n[2]=0,n[3]=0,n[4]=s[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},i.fromMat2d=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=0,n[3]=s[2],n[4]=s[3],n[5]=0,n[6]=s[4],n[7]=s[5],n[8]=1,n},i.fromQuat=function(n,s){var o=s[0],u=s[1],h=s[2];s=s[3];var v=o+o,l=u+u,f=h+h;o*=v;var d=u*v;u*=l;var c=h*v,p=h*l;return h*=f,v*=s,l*=s,s*=f,n[0]=1-u-h,n[3]=d-s,n[6]=c+l,n[1]=d+s,n[4]=1-o-h,n[7]=p-v,n[2]=c-l,n[5]=p+v,n[8]=1-o-u,n},i.normalFromMat4=function(n,s){var o=s[0],u=s[1],h=s[2],v=s[3],l=s[4],f=s[5],d=s[6],c=s[7],p=s[8],m=s[9],g=s[10],x=s[11],y=s[12],_=s[13],A=s[14];s=s[15];var T=o*f-u*l,w=o*d-h*l,C=o*c-v*l,M=u*d-h*f,E=u*c-v*f,P=h*c-v*d,L=p*_-m*y,R=p*A-g*y;p=p*s-x*y;var b=m*A-g*_;return m=m*s-x*_,g=g*s-x*A,x=T*g-w*m+C*b+M*p-E*R+P*L,x?(x=1/x,n[0]=(f*g-d*m+c*b)*x,n[1]=(d*p-l*g-c*R)*x,n[2]=(l*m-f*p+c*L)*x,n[3]=(h*m-u*g-v*b)*x,n[4]=(o*g-h*p+v*R)*x,n[5]=(u*p-o*m-v*L)*x,n[6]=(_*P-A*E+s*M)*x,n[7]=(A*C-y*P-s*w)*x,n[8]=(y*E-_*C+s*T)*x,n):null},i.projection=function(n,s,o){return n[0]=2/s,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/o,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,n},i.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"},i.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2))},i.add=function(n,s,o){return n[0]=s[0]+o[0],n[1]=s[1]+o[1],n[2]=s[2]+o[2],n[3]=s[3]+o[3],n[4]=s[4]+o[4],n[5]=s[5]+o[5],n[6]=s[6]+o[6],n[7]=s[7]+o[7],n[8]=s[8]+o[8],n},i.subtract=r,i.multiplyScalar=function(n,s,o){return n[0]=s[0]*o,n[1]=s[1]*o,n[2]=s[2]*o,n[3]=s[3]*o,n[4]=s[4]*o,n[5]=s[5]*o,n[6]=s[6]*o,n[7]=s[7]*o,n[8]=s[8]*o,n},i.multiplyScalarAndAdd=function(n,s,o,u){return n[0]=s[0]+o[0]*u,n[1]=s[1]+o[1]*u,n[2]=s[2]+o[2]*u,n[3]=s[3]+o[3]*u,n[4]=s[4]+o[4]*u,n[5]=s[5]+o[5]*u,n[6]=s[6]+o[6]*u,n[7]=s[7]+o[7]*u,n[8]=s[8]+o[8]*u,n},i.exactEquals=function(n,s){return n[0]===s[0]&&n[1]===s[1]&&n[2]===s[2]&&n[3]===s[3]&&n[4]===s[4]&&n[5]===s[5]&&n[6]===s[6]&&n[7]===s[7]&&n[8]===s[8]},i.equals=function(n,s){var o=n[0],u=n[1],h=n[2],v=n[3],l=n[4],f=n[5],d=n[6],c=n[7];n=n[8];var p=s[0],m=s[1],g=s[2],x=s[3],y=s[4],_=s[5],A=s[6],T=s[7];return s=s[8],Math.abs(o-p)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(u-m)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(h-g)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(v-x)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(x))&&Math.abs(l-y)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(f-_)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(_))&&Math.abs(d-A)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(c-T)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},i.sub=i.mul=void 0;var a=function(n){if(n&&n.__esModule)return n;var s={};if(n!=null){for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var u=pt&&vt?vt(n,o):{};u.get||u.set?pt(s,o,u):s[o]=n[o]}}return s.default=n,s}(Qt);i.mul=t,i.sub=r});tt(Nn);var jn=V(function(e,i){function t(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function r(o,u,h){var v=u[0],l=u[1],f=u[2],d=u[3],c=u[4],p=u[5],m=u[6],g=u[7],x=u[8],y=u[9],_=u[10],A=u[11],T=u[12],w=u[13],C=u[14];u=u[15];var M=h[0],E=h[1],P=h[2],L=h[3];return o[0]=M*v+E*c+P*x+L*T,o[1]=M*l+E*p+P*y+L*w,o[2]=M*f+E*m+P*_+L*C,o[3]=M*d+E*g+P*A+L*u,M=h[4],E=h[5],P=h[6],L=h[7],o[4]=M*v+E*c+P*x+L*T,o[5]=M*l+E*p+P*y+L*w,o[6]=M*f+E*m+P*_+L*C,o[7]=M*d+E*g+P*A+L*u,M=h[8],E=h[9],P=h[10],L=h[11],o[8]=M*v+E*c+P*x+L*T,o[9]=M*l+E*p+P*y+L*w,o[10]=M*f+E*m+P*_+L*C,o[11]=M*d+E*g+P*A+L*u,M=h[12],E=h[13],P=h[14],L=h[15],o[12]=M*v+E*c+P*x+L*T,o[13]=M*l+E*p+P*y+L*w,o[14]=M*f+E*m+P*_+L*C,o[15]=M*d+E*g+P*A+L*u,o}function a(o,u,h){var v=u[0],l=u[1],f=u[2],d=u[3],c=v+v,p=l+l,m=f+f;u=v*c;var g=v*p;v*=m;var x=l*p;return l*=m,f*=m,c*=d,p*=d,d*=m,o[0]=1-(x+f),o[1]=g+d,o[2]=v-p,o[3]=0,o[4]=g-d,o[5]=1-(u+f),o[6]=l+c,o[7]=0,o[8]=v+p,o[9]=l-c,o[10]=1-(u+x),o[11]=0,o[12]=h[0],o[13]=h[1],o[14]=h[2],o[15]=1,o}function n(o,u,h){return o[0]=u[0]-h[0],o[1]=u[1]-h[1],o[2]=u[2]-h[2],o[3]=u[3]-h[3],o[4]=u[4]-h[4],o[5]=u[5]-h[5],o[6]=u[6]-h[6],o[7]=u[7]-h[7],o[8]=u[8]-h[8],o[9]=u[9]-h[9],o[10]=u[10]-h[10],o[11]=u[11]-h[11],o[12]=u[12]-h[12],o[13]=u[13]-h[13],o[14]=u[14]-h[14],o[15]=u[15]-h[15],o}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var o=new s.ARRAY_TYPE(16);return s.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},i.clone=function(o){var u=new s.ARRAY_TYPE(16);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},i.copy=function(o,u){return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=u[7],o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},i.fromValues=function(o,u,h,v,l,f,d,c,p,m,g,x,y,_,A,T){var w=new s.ARRAY_TYPE(16);return w[0]=o,w[1]=u,w[2]=h,w[3]=v,w[4]=l,w[5]=f,w[6]=d,w[7]=c,w[8]=p,w[9]=m,w[10]=g,w[11]=x,w[12]=y,w[13]=_,w[14]=A,w[15]=T,w},i.set=function(o,u,h,v,l,f,d,c,p,m,g,x,y,_,A,T,w){return o[0]=u,o[1]=h,o[2]=v,o[3]=l,o[4]=f,o[5]=d,o[6]=c,o[7]=p,o[8]=m,o[9]=g,o[10]=x,o[11]=y,o[12]=_,o[13]=A,o[14]=T,o[15]=w,o},i.identity=t,i.transpose=function(o,u){if(o===u){var h=u[1],v=u[2],l=u[3],f=u[6],d=u[7],c=u[11];o[1]=u[4],o[2]=u[8],o[3]=u[12],o[4]=h,o[6]=u[9],o[7]=u[13],o[8]=v,o[9]=f,o[11]=u[14],o[12]=l,o[13]=d,o[14]=c}else o[0]=u[0],o[1]=u[4],o[2]=u[8],o[3]=u[12],o[4]=u[1],o[5]=u[5],o[6]=u[9],o[7]=u[13],o[8]=u[2],o[9]=u[6],o[10]=u[10],o[11]=u[14],o[12]=u[3],o[13]=u[7],o[14]=u[11],o[15]=u[15];return o},i.invert=function(o,u){var h=u[0],v=u[1],l=u[2],f=u[3],d=u[4],c=u[5],p=u[6],m=u[7],g=u[8],x=u[9],y=u[10],_=u[11],A=u[12],T=u[13],w=u[14];u=u[15];var C=h*c-v*d,M=h*p-l*d,E=h*m-f*d,P=v*p-l*c,L=v*m-f*c,R=l*m-f*p,b=g*T-x*A,H=g*w-y*A,S=g*u-_*A,D=x*w-y*T,Z=x*u-_*T,X=y*u-_*w,B=C*X-M*Z+E*D+P*S-L*H+R*b;return B?(B=1/B,o[0]=(c*X-p*Z+m*D)*B,o[1]=(l*Z-v*X-f*D)*B,o[2]=(T*R-w*L+u*P)*B,o[3]=(y*L-x*R-_*P)*B,o[4]=(p*S-d*X-m*H)*B,o[5]=(h*X-l*S+f*H)*B,o[6]=(w*E-A*R-u*M)*B,o[7]=(g*R-y*E+_*M)*B,o[8]=(d*Z-c*S+m*b)*B,o[9]=(v*S-h*Z-f*b)*B,o[10]=(A*L-T*E+u*C)*B,o[11]=(x*E-g*L-_*C)*B,o[12]=(c*H-d*D-p*b)*B,o[13]=(h*D-v*H+l*b)*B,o[14]=(T*M-A*P-w*C)*B,o[15]=(g*P-x*M+y*C)*B,o):null},i.adjoint=function(o,u){var h=u[0],v=u[1],l=u[2],f=u[3],d=u[4],c=u[5],p=u[6],m=u[7],g=u[8],x=u[9],y=u[10],_=u[11],A=u[12],T=u[13],w=u[14];return u=u[15],o[0]=c*(y*u-_*w)-x*(p*u-m*w)+T*(p*_-m*y),o[1]=-(v*(y*u-_*w)-x*(l*u-f*w)+T*(l*_-f*y)),o[2]=v*(p*u-m*w)-c*(l*u-f*w)+T*(l*m-f*p),o[3]=-(v*(p*_-m*y)-c*(l*_-f*y)+x*(l*m-f*p)),o[4]=-(d*(y*u-_*w)-g*(p*u-m*w)+A*(p*_-m*y)),o[5]=h*(y*u-_*w)-g*(l*u-f*w)+A*(l*_-f*y),o[6]=-(h*(p*u-m*w)-d*(l*u-f*w)+A*(l*m-f*p)),o[7]=h*(p*_-m*y)-d*(l*_-f*y)+g*(l*m-f*p),o[8]=d*(x*u-_*T)-g*(c*u-m*T)+A*(c*_-m*x),o[9]=-(h*(x*u-_*T)-g*(v*u-f*T)+A*(v*_-f*x)),o[10]=h*(c*u-m*T)-d*(v*u-f*T)+A*(v*m-f*c),o[11]=-(h*(c*_-m*x)-d*(v*_-f*x)+g*(v*m-f*c)),o[12]=-(d*(x*w-y*T)-g*(c*w-p*T)+A*(c*y-p*x)),o[13]=h*(x*w-y*T)-g*(v*w-l*T)+A*(v*y-l*x),o[14]=-(h*(c*w-p*T)-d*(v*w-l*T)+A*(v*p-l*c)),o[15]=h*(c*y-p*x)-d*(v*y-l*x)+g*(v*p-l*c),o},i.determinant=function(o){var u=o[0],h=o[1],v=o[2],l=o[3],f=o[4],d=o[5],c=o[6],p=o[7],m=o[8],g=o[9],x=o[10],y=o[11],_=o[12],A=o[13],T=o[14];return o=o[15],(u*d-h*f)*(x*o-y*T)-(u*c-v*f)*(g*o-y*A)+(u*p-l*f)*(g*T-x*A)+(h*c-v*d)*(m*o-y*_)-(h*p-l*d)*(m*T-x*_)+(v*p-l*c)*(m*A-g*_)},i.multiply=r,i.translate=function(o,u,h){var v=h[0],l=h[1];if(h=h[2],u===o)o[12]=u[0]*v+u[4]*l+u[8]*h+u[12],o[13]=u[1]*v+u[5]*l+u[9]*h+u[13],o[14]=u[2]*v+u[6]*l+u[10]*h+u[14],o[15]=u[3]*v+u[7]*l+u[11]*h+u[15];else{var f=u[0],d=u[1],c=u[2],p=u[3],m=u[4],g=u[5],x=u[6],y=u[7],_=u[8],A=u[9],T=u[10],w=u[11];o[0]=f,o[1]=d,o[2]=c,o[3]=p,o[4]=m,o[5]=g,o[6]=x,o[7]=y,o[8]=_,o[9]=A,o[10]=T,o[11]=w,o[12]=f*v+m*l+_*h+u[12],o[13]=d*v+g*l+A*h+u[13],o[14]=c*v+x*l+T*h+u[14],o[15]=p*v+y*l+w*h+u[15]}return o},i.scale=function(o,u,h){var v=h[0],l=h[1];return h=h[2],o[0]=u[0]*v,o[1]=u[1]*v,o[2]=u[2]*v,o[3]=u[3]*v,o[4]=u[4]*l,o[5]=u[5]*l,o[6]=u[6]*l,o[7]=u[7]*l,o[8]=u[8]*h,o[9]=u[9]*h,o[10]=u[10]*h,o[11]=u[11]*h,o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},i.rotate=function(o,u,h,v){var l=v[0],f=v[1];v=v[2];var d=Math.sqrt(l*l+f*f+v*v);if(d<s.EPSILON)return null;d=1/d,l*=d,f*=d,v*=d;var c=Math.sin(h),p=Math.cos(h),m=1-p;h=u[0],d=u[1];var g=u[2],x=u[3],y=u[4],_=u[5],A=u[6],T=u[7],w=u[8],C=u[9],M=u[10],E=u[11],P=l*l*m+p,L=f*l*m+v*c,R=v*l*m-f*c,b=l*f*m-v*c,H=f*f*m+p,S=v*f*m+l*c,D=l*v*m+f*c;return l=f*v*m-l*c,f=v*v*m+p,o[0]=h*P+y*L+w*R,o[1]=d*P+_*L+C*R,o[2]=g*P+A*L+M*R,o[3]=x*P+T*L+E*R,o[4]=h*b+y*H+w*S,o[5]=d*b+_*H+C*S,o[6]=g*b+A*H+M*S,o[7]=x*b+T*H+E*S,o[8]=h*D+y*l+w*f,o[9]=d*D+_*l+C*f,o[10]=g*D+A*l+M*f,o[11]=x*D+T*l+E*f,u!==o&&(o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o},i.rotateX=function(o,u,h){var v=Math.sin(h);h=Math.cos(h);var l=u[4],f=u[5],d=u[6],c=u[7],p=u[8],m=u[9],g=u[10],x=u[11];return u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=l*h+p*v,o[5]=f*h+m*v,o[6]=d*h+g*v,o[7]=c*h+x*v,o[8]=p*h-l*v,o[9]=m*h-f*v,o[10]=g*h-d*v,o[11]=x*h-c*v,o},i.rotateY=function(o,u,h){var v=Math.sin(h);h=Math.cos(h);var l=u[0],f=u[1],d=u[2],c=u[3],p=u[8],m=u[9],g=u[10],x=u[11];return u!==o&&(o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=u[7],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=l*h-p*v,o[1]=f*h-m*v,o[2]=d*h-g*v,o[3]=c*h-x*v,o[8]=l*v+p*h,o[9]=f*v+m*h,o[10]=d*v+g*h,o[11]=c*v+x*h,o},i.rotateZ=function(o,u,h){var v=Math.sin(h);h=Math.cos(h);var l=u[0],f=u[1],d=u[2],c=u[3],p=u[4],m=u[5],g=u[6],x=u[7];return u!==o&&(o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=l*h+p*v,o[1]=f*h+m*v,o[2]=d*h+g*v,o[3]=c*h+x*v,o[4]=p*h-l*v,o[5]=m*h-f*v,o[6]=g*h-d*v,o[7]=x*h-c*v,o},i.fromTranslation=function(o,u){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=u[0],o[13]=u[1],o[14]=u[2],o[15]=1,o},i.fromScaling=function(o,u){return o[0]=u[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=u[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromRotation=function(o,u,h){var v=h[0],l=h[1];h=h[2];var f=Math.sqrt(v*v+l*l+h*h);if(f<s.EPSILON)return null;f=1/f,v*=f,l*=f,h*=f,f=Math.sin(u),u=Math.cos(u);var d=1-u;return o[0]=v*v*d+u,o[1]=l*v*d+h*f,o[2]=h*v*d-l*f,o[3]=0,o[4]=v*l*d-h*f,o[5]=l*l*d+u,o[6]=h*l*d+v*f,o[7]=0,o[8]=v*h*d+l*f,o[9]=l*h*d-v*f,o[10]=h*h*d+u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromXRotation=function(o,u){var h=Math.sin(u);return u=Math.cos(u),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=h,o[7]=0,o[8]=0,o[9]=-h,o[10]=u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromYRotation=function(o,u){var h=Math.sin(u);return u=Math.cos(u),o[0]=u,o[1]=0,o[2]=-h,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=h,o[9]=0,o[10]=u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromZRotation=function(o,u){var h=Math.sin(u);return u=Math.cos(u),o[0]=u,o[1]=h,o[2]=0,o[3]=0,o[4]=-h,o[5]=u,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromRotationTranslation=a,i.fromQuat2=function(o,u){var h=new s.ARRAY_TYPE(3),v=-u[0],l=-u[1],f=-u[2],d=u[3],c=u[4],p=u[5],m=u[6],g=u[7],x=v*v+l*l+f*f+d*d;return 0<x?(h[0]=2*(c*d+g*v+p*f-m*l)/x,h[1]=2*(p*d+g*l+m*v-c*f)/x,h[2]=2*(m*d+g*f+c*l-p*v)/x):(h[0]=2*(c*d+g*v+p*f-m*l),h[1]=2*(p*d+g*l+m*v-c*f),h[2]=2*(m*d+g*f+c*l-p*v)),a(o,u,h),o},i.getTranslation=function(o,u){return o[0]=u[12],o[1]=u[13],o[2]=u[14],o},i.getScaling=function(o,u){var h=u[0],v=u[1],l=u[2],f=u[4],d=u[5],c=u[6],p=u[8],m=u[9];return u=u[10],o[0]=Math.sqrt(h*h+v*v+l*l),o[1]=Math.sqrt(f*f+d*d+c*c),o[2]=Math.sqrt(p*p+m*m+u*u),o},i.getRotation=function(o,u){var h=u[0]+u[5]+u[10];return 0<h?(h=2*Math.sqrt(h+1),o[3]=.25*h,o[0]=(u[6]-u[9])/h,o[1]=(u[8]-u[2])/h,o[2]=(u[1]-u[4])/h):u[0]>u[5]&&u[0]>u[10]?(h=2*Math.sqrt(1+u[0]-u[5]-u[10]),o[3]=(u[6]-u[9])/h,o[0]=.25*h,o[1]=(u[1]+u[4])/h,o[2]=(u[8]+u[2])/h):u[5]>u[10]?(h=2*Math.sqrt(1+u[5]-u[0]-u[10]),o[3]=(u[8]-u[2])/h,o[0]=(u[1]+u[4])/h,o[1]=.25*h,o[2]=(u[6]+u[9])/h):(h=2*Math.sqrt(1+u[10]-u[0]-u[5]),o[3]=(u[1]-u[4])/h,o[0]=(u[8]+u[2])/h,o[1]=(u[6]+u[9])/h,o[2]=.25*h),o},i.fromRotationTranslationScale=function(o,u,h,v){var l=u[0],f=u[1],d=u[2],c=u[3],p=l+l,m=f+f,g=d+d;u=l*p;var x=l*m;l*=g;var y=f*m;f*=g,d*=g,p*=c,m*=c,c*=g,g=v[0];var _=v[1];return v=v[2],o[0]=(1-(y+d))*g,o[1]=(x+c)*g,o[2]=(l-m)*g,o[3]=0,o[4]=(x-c)*_,o[5]=(1-(u+d))*_,o[6]=(f+p)*_,o[7]=0,o[8]=(l+m)*v,o[9]=(f-p)*v,o[10]=(1-(u+y))*v,o[11]=0,o[12]=h[0],o[13]=h[1],o[14]=h[2],o[15]=1,o},i.fromRotationTranslationScaleOrigin=function(o,u,h,v,l){var f=u[0],d=u[1],c=u[2],p=u[3],m=f+f,g=d+d,x=c+c;u=f*m;var y=f*g,_=f*x;f=d*g,d*=x;var A=c*x;c=p*m,g*=p;var T=p*x,w=v[0],C=v[1];x=v[2],v=l[0],p=l[1],l=l[2],m=(1-(f+A))*w;var M=(y+T)*w;return w*=_-g,y=(y-T)*C,A=(1-(u+A))*C,C*=d+c,_=(_+g)*x,d=(d-c)*x,u=(1-(u+f))*x,o[0]=m,o[1]=M,o[2]=w,o[3]=0,o[4]=y,o[5]=A,o[6]=C,o[7]=0,o[8]=_,o[9]=d,o[10]=u,o[11]=0,o[12]=h[0]+v-(m*v+y*p+_*l),o[13]=h[1]+p-(M*v+A*p+d*l),o[14]=h[2]+l-(w*v+C*p+u*l),o[15]=1,o},i.fromQuat=function(o,u){var h=u[0],v=u[1],l=u[2];u=u[3];var f=h+h,d=v+v,c=l+l;h*=f;var p=v*f;v*=d;var m=l*f,g=l*d;return l*=c,f*=u,d*=u,u*=c,o[0]=1-v-l,o[1]=p+u,o[2]=m-d,o[3]=0,o[4]=p-u,o[5]=1-h-l,o[6]=g+f,o[7]=0,o[8]=m+d,o[9]=g-f,o[10]=1-h-v,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.frustum=function(o,u,h,v,l,f,d){var c=1/(h-u),p=1/(l-v),m=1/(f-d);return o[0]=2*f*c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*f*p,o[6]=0,o[7]=0,o[8]=(h+u)*c,o[9]=(l+v)*p,o[10]=(d+f)*m,o[11]=-1,o[12]=0,o[13]=0,o[14]=d*f*2*m,o[15]=0,o},i.perspective=function(o,u,h,v,l){return u=1/Math.tan(u/2),o[0]=u/h,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,l!=null&&l!==1/0?(h=1/(v-l),o[10]=(l+v)*h,o[14]=2*l*v*h):(o[10]=-1,o[14]=-2*v),o},i.perspectiveFromFieldOfView=function(o,u,h,v){var l=Math.tan(u.upDegrees*Math.PI/180),f=Math.tan(u.downDegrees*Math.PI/180),d=Math.tan(u.leftDegrees*Math.PI/180);u=Math.tan(u.rightDegrees*Math.PI/180);var c=2/(d+u),p=2/(l+f);return o[0]=c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=p,o[6]=0,o[7]=0,o[8]=-((d-u)*c*.5),o[9]=(l-f)*p*.5,o[10]=v/(h-v),o[11]=-1,o[12]=0,o[13]=0,o[14]=v*h/(h-v),o[15]=0,o},i.ortho=function(o,u,h,v,l,f,d){var c=1/(u-h),p=1/(v-l),m=1/(f-d);return o[0]=-2*c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*p,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*m,o[11]=0,o[12]=(u+h)*c,o[13]=(l+v)*p,o[14]=(d+f)*m,o[15]=1,o},i.lookAt=function(o,u,h,v){var l=u[0],f=u[1];u=u[2];var d=v[0],c=v[1],p=v[2],m=h[0];v=h[1];var g=h[2];if(Math.abs(l-m)<s.EPSILON&&Math.abs(f-v)<s.EPSILON&&Math.abs(u-g)<s.EPSILON)return t(o);h=l-m,v=f-v,m=u-g;var x=1/Math.sqrt(h*h+v*v+m*m);h*=x,v*=x,m*=x,g=c*m-p*v,p=p*h-d*m,d=d*v-c*h,(x=Math.sqrt(g*g+p*p+d*d))?(x=1/x,g*=x,p*=x,d*=x):d=p=g=0,c=v*d-m*p;var y=m*g-h*d,_=h*p-v*g;return(x=Math.sqrt(c*c+y*y+_*_))?(x=1/x,c*=x,y*=x,_*=x):_=y=c=0,o[0]=g,o[1]=c,o[2]=h,o[3]=0,o[4]=p,o[5]=y,o[6]=v,o[7]=0,o[8]=d,o[9]=_,o[10]=m,o[11]=0,o[12]=-(g*l+p*f+d*u),o[13]=-(c*l+y*f+_*u),o[14]=-(h*l+v*f+m*u),o[15]=1,o},i.targetTo=function(o,u,h,v){var l=u[0],f=u[1];u=u[2];var d=v[0],c=v[1],p=v[2];v=l-h[0];var m=f-h[1];h=u-h[2];var g=v*v+m*m+h*h;0<g&&(g=1/Math.sqrt(g),v*=g,m*=g,h*=g);var x=c*h-p*m;return p=p*v-d*h,d=d*m-c*v,g=x*x+p*p+d*d,0<g&&(g=1/Math.sqrt(g),x*=g,p*=g,d*=g),o[0]=x,o[1]=p,o[2]=d,o[3]=0,o[4]=m*d-h*p,o[5]=h*x-v*d,o[6]=v*p-m*x,o[7]=0,o[8]=v,o[9]=m,o[10]=h,o[11]=0,o[12]=l,o[13]=f,o[14]=u,o[15]=1,o},i.str=function(o){return"mat4("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+", "+o[8]+", "+o[9]+", "+o[10]+", "+o[11]+", "+o[12]+", "+o[13]+", "+o[14]+", "+o[15]+")"},i.frob=function(o){return Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)+Math.pow(o[2],2)+Math.pow(o[3],2)+Math.pow(o[4],2)+Math.pow(o[5],2)+Math.pow(o[6],2)+Math.pow(o[7],2)+Math.pow(o[8],2)+Math.pow(o[9],2)+Math.pow(o[10],2)+Math.pow(o[11],2)+Math.pow(o[12],2)+Math.pow(o[13],2)+Math.pow(o[14],2)+Math.pow(o[15],2))},i.add=function(o,u,h){return o[0]=u[0]+h[0],o[1]=u[1]+h[1],o[2]=u[2]+h[2],o[3]=u[3]+h[3],o[4]=u[4]+h[4],o[5]=u[5]+h[5],o[6]=u[6]+h[6],o[7]=u[7]+h[7],o[8]=u[8]+h[8],o[9]=u[9]+h[9],o[10]=u[10]+h[10],o[11]=u[11]+h[11],o[12]=u[12]+h[12],o[13]=u[13]+h[13],o[14]=u[14]+h[14],o[15]=u[15]+h[15],o},i.subtract=n,i.multiplyScalar=function(o,u,h){return o[0]=u[0]*h,o[1]=u[1]*h,o[2]=u[2]*h,o[3]=u[3]*h,o[4]=u[4]*h,o[5]=u[5]*h,o[6]=u[6]*h,o[7]=u[7]*h,o[8]=u[8]*h,o[9]=u[9]*h,o[10]=u[10]*h,o[11]=u[11]*h,o[12]=u[12]*h,o[13]=u[13]*h,o[14]=u[14]*h,o[15]=u[15]*h,o},i.multiplyScalarAndAdd=function(o,u,h,v){return o[0]=u[0]+h[0]*v,o[1]=u[1]+h[1]*v,o[2]=u[2]+h[2]*v,o[3]=u[3]+h[3]*v,o[4]=u[4]+h[4]*v,o[5]=u[5]+h[5]*v,o[6]=u[6]+h[6]*v,o[7]=u[7]+h[7]*v,o[8]=u[8]+h[8]*v,o[9]=u[9]+h[9]*v,o[10]=u[10]+h[10]*v,o[11]=u[11]+h[11]*v,o[12]=u[12]+h[12]*v,o[13]=u[13]+h[13]*v,o[14]=u[14]+h[14]*v,o[15]=u[15]+h[15]*v,o},i.exactEquals=function(o,u){return o[0]===u[0]&&o[1]===u[1]&&o[2]===u[2]&&o[3]===u[3]&&o[4]===u[4]&&o[5]===u[5]&&o[6]===u[6]&&o[7]===u[7]&&o[8]===u[8]&&o[9]===u[9]&&o[10]===u[10]&&o[11]===u[11]&&o[12]===u[12]&&o[13]===u[13]&&o[14]===u[14]&&o[15]===u[15]},i.equals=function(o,u){var h=o[0],v=o[1],l=o[2],f=o[3],d=o[4],c=o[5],p=o[6],m=o[7],g=o[8],x=o[9],y=o[10],_=o[11],A=o[12],T=o[13],w=o[14];o=o[15];var C=u[0],M=u[1],E=u[2],P=u[3],L=u[4],R=u[5],b=u[6],H=u[7],S=u[8],D=u[9],Z=u[10],X=u[11],B=u[12],Zt=u[13],st=u[14];return u=u[15],Math.abs(h-C)<=s.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(v-M)<=s.EPSILON*Math.max(1,Math.abs(v),Math.abs(M))&&Math.abs(l-E)<=s.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(f-P)<=s.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(d-L)<=s.EPSILON*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(c-R)<=s.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(p-b)<=s.EPSILON*Math.max(1,Math.abs(p),Math.abs(b))&&Math.abs(m-H)<=s.EPSILON*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(g-S)<=s.EPSILON*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(x-D)<=s.EPSILON*Math.max(1,Math.abs(x),Math.abs(D))&&Math.abs(y-Z)<=s.EPSILON*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(_-X)<=s.EPSILON*Math.max(1,Math.abs(_),Math.abs(X))&&Math.abs(A-B)<=s.EPSILON*Math.max(1,Math.abs(A),Math.abs(B))&&Math.abs(T-Zt)<=s.EPSILON*Math.max(1,Math.abs(T),Math.abs(Zt))&&Math.abs(w-st)<=s.EPSILON*Math.max(1,Math.abs(w),Math.abs(st))&&Math.abs(o-u)<=s.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},i.sub=i.mul=void 0;var s=function(o){if(o&&o.__esModule)return o;var u={};if(o!=null){for(var h in o)if(Object.prototype.hasOwnProperty.call(o,h)){var v=pt&&vt?vt(o,h):{};v.get||v.set?pt(u,h,v):u[h]=o[h]}}return u.default=o,u}(Qt);i.mul=r,i.sub=n});tt(jn);var Hn=V(function(e,i){function t(){var c=new d.ARRAY_TYPE(3);return d.ARRAY_TYPE!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function r(c){var p=c[0],m=c[1];return c=c[2],Math.sqrt(p*p+m*m+c*c)}function a(c,p,m){var g=new d.ARRAY_TYPE(3);return g[0]=c,g[1]=p,g[2]=m,g}function n(c,p,m){return c[0]=p[0]-m[0],c[1]=p[1]-m[1],c[2]=p[2]-m[2],c}function s(c,p,m){return c[0]=p[0]*m[0],c[1]=p[1]*m[1],c[2]=p[2]*m[2],c}function o(c,p,m){return c[0]=p[0]/m[0],c[1]=p[1]/m[1],c[2]=p[2]/m[2],c}function u(c,p){var m=p[0]-c[0],g=p[1]-c[1];return c=p[2]-c[2],Math.sqrt(m*m+g*g+c*c)}function h(c,p){var m=p[0]-c[0],g=p[1]-c[1];return c=p[2]-c[2],m*m+g*g+c*c}function v(c){var p=c[0],m=c[1];return c=c[2],p*p+m*m+c*c}function l(c,p){var m=p[0],g=p[1],x=p[2];return m=m*m+g*g+x*x,0<m&&(m=1/Math.sqrt(m)),c[0]=p[0]*m,c[1]=p[1]*m,c[2]=p[2]*m,c}function f(c,p){return c[0]*p[0]+c[1]*p[1]+c[2]*p[2]}Object.defineProperty(i,"__esModule",{value:!0}),i.create=t,i.clone=function(c){var p=new d.ARRAY_TYPE(3);return p[0]=c[0],p[1]=c[1],p[2]=c[2],p},i.length=r,i.fromValues=a,i.copy=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c},i.set=function(c,p,m,g){return c[0]=p,c[1]=m,c[2]=g,c},i.add=function(c,p,m){return c[0]=p[0]+m[0],c[1]=p[1]+m[1],c[2]=p[2]+m[2],c},i.subtract=n,i.multiply=s,i.divide=o,i.ceil=function(c,p){return c[0]=Math.ceil(p[0]),c[1]=Math.ceil(p[1]),c[2]=Math.ceil(p[2]),c},i.floor=function(c,p){return c[0]=Math.floor(p[0]),c[1]=Math.floor(p[1]),c[2]=Math.floor(p[2]),c},i.min=function(c,p,m){return c[0]=Math.min(p[0],m[0]),c[1]=Math.min(p[1],m[1]),c[2]=Math.min(p[2],m[2]),c},i.max=function(c,p,m){return c[0]=Math.max(p[0],m[0]),c[1]=Math.max(p[1],m[1]),c[2]=Math.max(p[2],m[2]),c},i.round=function(c,p){return c[0]=Math.round(p[0]),c[1]=Math.round(p[1]),c[2]=Math.round(p[2]),c},i.scale=function(c,p,m){return c[0]=p[0]*m,c[1]=p[1]*m,c[2]=p[2]*m,c},i.scaleAndAdd=function(c,p,m,g){return c[0]=p[0]+m[0]*g,c[1]=p[1]+m[1]*g,c[2]=p[2]+m[2]*g,c},i.distance=u,i.squaredDistance=h,i.squaredLength=v,i.negate=function(c,p){return c[0]=-p[0],c[1]=-p[1],c[2]=-p[2],c},i.inverse=function(c,p){return c[0]=1/p[0],c[1]=1/p[1],c[2]=1/p[2],c},i.normalize=l,i.dot=f,i.cross=function(c,p,m){var g=p[0],x=p[1];p=p[2];var y=m[0],_=m[1];return m=m[2],c[0]=x*m-p*_,c[1]=p*y-g*m,c[2]=g*_-x*y,c},i.lerp=function(c,p,m,g){var x=p[0],y=p[1];return p=p[2],c[0]=x+g*(m[0]-x),c[1]=y+g*(m[1]-y),c[2]=p+g*(m[2]-p),c},i.hermite=function(c,p,m,g,x,y){var _=y*y,A=_*(2*y-3)+1,T=_*(y-2)+y,w=_*(y-1);return y=_*(3-2*y),c[0]=p[0]*A+m[0]*T+g[0]*w+x[0]*y,c[1]=p[1]*A+m[1]*T+g[1]*w+x[1]*y,c[2]=p[2]*A+m[2]*T+g[2]*w+x[2]*y,c},i.bezier=function(c,p,m,g,x,y){var _=1-y,A=_*_,T=y*y,w=A*_;return A*=3*y,_*=3*T,y*=T,c[0]=p[0]*w+m[0]*A+g[0]*_+x[0]*y,c[1]=p[1]*w+m[1]*A+g[1]*_+x[1]*y,c[2]=p[2]*w+m[2]*A+g[2]*_+x[2]*y,c},i.random=function(c,p){p=p||1;var m=2*d.RANDOM()*Math.PI,g=2*d.RANDOM()-1,x=Math.sqrt(1-g*g)*p;return c[0]=Math.cos(m)*x,c[1]=Math.sin(m)*x,c[2]=g*p,c},i.transformMat4=function(c,p,m){var g=p[0],x=p[1];p=p[2];var y=m[3]*g+m[7]*x+m[11]*p+m[15];return y=y||1,c[0]=(m[0]*g+m[4]*x+m[8]*p+m[12])/y,c[1]=(m[1]*g+m[5]*x+m[9]*p+m[13])/y,c[2]=(m[2]*g+m[6]*x+m[10]*p+m[14])/y,c},i.transformMat3=function(c,p,m){var g=p[0],x=p[1];return p=p[2],c[0]=g*m[0]+x*m[3]+p*m[6],c[1]=g*m[1]+x*m[4]+p*m[7],c[2]=g*m[2]+x*m[5]+p*m[8],c},i.transformQuat=function(c,p,m){var g=m[0],x=m[1],y=m[2],_=p[0],A=p[1];p=p[2];var T=x*p-y*A,w=y*_-g*p,C=g*A-x*_;return m=2*m[3],c[0]=_+T*m+2*(x*C-y*w),c[1]=A+w*m+2*(y*T-g*C),c[2]=p+C*m+2*(g*w-x*T),c},i.rotateX=function(c,p,m,g){var x=[],y=[];return x[0]=p[0]-m[0],x[1]=p[1]-m[1],x[2]=p[2]-m[2],y[0]=x[0],y[1]=x[1]*Math.cos(g)-x[2]*Math.sin(g),y[2]=x[1]*Math.sin(g)+x[2]*Math.cos(g),c[0]=y[0]+m[0],c[1]=y[1]+m[1],c[2]=y[2]+m[2],c},i.rotateY=function(c,p,m,g){var x=[],y=[];return x[0]=p[0]-m[0],x[1]=p[1]-m[1],x[2]=p[2]-m[2],y[0]=x[2]*Math.sin(g)+x[0]*Math.cos(g),y[1]=x[1],y[2]=x[2]*Math.cos(g)-x[0]*Math.sin(g),c[0]=y[0]+m[0],c[1]=y[1]+m[1],c[2]=y[2]+m[2],c},i.rotateZ=function(c,p,m,g){var x=[],y=[];return x[0]=p[0]-m[0],x[1]=p[1]-m[1],x[2]=p[2]-m[2],y[0]=x[0]*Math.cos(g)-x[1]*Math.sin(g),y[1]=x[0]*Math.sin(g)+x[1]*Math.cos(g),y[2]=x[2],c[0]=y[0]+m[0],c[1]=y[1]+m[1],c[2]=y[2]+m[2],c},i.angle=function(c,p){return c=a(c[0],c[1],c[2]),p=a(p[0],p[1],p[2]),l(c,c),l(p,p),p=f(c,p),1<p?0:-1>p?Math.PI:Math.acos(p)},i.zero=function(c){return c[0]=0,c[1]=0,c[2]=0,c},i.str=function(c){return"vec3("+c[0]+", "+c[1]+", "+c[2]+")"},i.exactEquals=function(c,p){return c[0]===p[0]&&c[1]===p[1]&&c[2]===p[2]},i.equals=function(c,p){var m=c[0],g=c[1];c=c[2];var x=p[0],y=p[1];return p=p[2],Math.abs(m-x)<=d.EPSILON*Math.max(1,Math.abs(m),Math.abs(x))&&Math.abs(g-y)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(y))&&Math.abs(c-p)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))},i.forEach=i.sqrLen=i.len=i.sqrDist=i.dist=i.div=i.mul=i.sub=void 0;var d=function(c){if(c&&c.__esModule)return c;var p={};if(c!=null){for(var m in c)if(Object.prototype.hasOwnProperty.call(c,m)){var g=pt&&vt?vt(c,m):{};g.get||g.set?pt(p,m,g):p[m]=c[m]}}return p.default=c,p}(Qt);i.sub=n,i.mul=s,i.div=o,i.dist=u,i.sqrDist=h,i.len=r,i.sqrLen=v,e=function(){var c=t();return function(p,m,g,x,y,_){for(m||(m=3),g||(g=0),x=x?Math.min(x*m+g,p.length):p.length;g<x;g+=m)c[0]=p[g],c[1]=p[g+1],c[2]=p[g+2],y(c,c,_),p[g]=c[0],p[g+1]=c[1],p[g+2]=c[2];return p}}(),i.forEach=e});tt(Hn);var Xn=V(function(e,i){function t(){var l=new v.ARRAY_TYPE(4);return v.ARRAY_TYPE!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function r(l,f,d){return l[0]=f[0]-d[0],l[1]=f[1]-d[1],l[2]=f[2]-d[2],l[3]=f[3]-d[3],l}function a(l,f,d){return l[0]=f[0]*d[0],l[1]=f[1]*d[1],l[2]=f[2]*d[2],l[3]=f[3]*d[3],l}function n(l,f,d){return l[0]=f[0]/d[0],l[1]=f[1]/d[1],l[2]=f[2]/d[2],l[3]=f[3]/d[3],l}function s(l,f){var d=f[0]-l[0],c=f[1]-l[1],p=f[2]-l[2];return l=f[3]-l[3],Math.sqrt(d*d+c*c+p*p+l*l)}function o(l,f){var d=f[0]-l[0],c=f[1]-l[1],p=f[2]-l[2];return l=f[3]-l[3],d*d+c*c+p*p+l*l}function u(l){var f=l[0],d=l[1],c=l[2];return l=l[3],Math.sqrt(f*f+d*d+c*c+l*l)}function h(l){var f=l[0],d=l[1],c=l[2];return l=l[3],f*f+d*d+c*c+l*l}Object.defineProperty(i,"__esModule",{value:!0}),i.create=t,i.clone=function(l){var f=new v.ARRAY_TYPE(4);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f},i.fromValues=function(l,f,d,c){var p=new v.ARRAY_TYPE(4);return p[0]=l,p[1]=f,p[2]=d,p[3]=c,p},i.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l},i.set=function(l,f,d,c,p){return l[0]=f,l[1]=d,l[2]=c,l[3]=p,l},i.add=function(l,f,d){return l[0]=f[0]+d[0],l[1]=f[1]+d[1],l[2]=f[2]+d[2],l[3]=f[3]+d[3],l},i.subtract=r,i.multiply=a,i.divide=n,i.ceil=function(l,f){return l[0]=Math.ceil(f[0]),l[1]=Math.ceil(f[1]),l[2]=Math.ceil(f[2]),l[3]=Math.ceil(f[3]),l},i.floor=function(l,f){return l[0]=Math.floor(f[0]),l[1]=Math.floor(f[1]),l[2]=Math.floor(f[2]),l[3]=Math.floor(f[3]),l},i.min=function(l,f,d){return l[0]=Math.min(f[0],d[0]),l[1]=Math.min(f[1],d[1]),l[2]=Math.min(f[2],d[2]),l[3]=Math.min(f[3],d[3]),l},i.max=function(l,f,d){return l[0]=Math.max(f[0],d[0]),l[1]=Math.max(f[1],d[1]),l[2]=Math.max(f[2],d[2]),l[3]=Math.max(f[3],d[3]),l},i.round=function(l,f){return l[0]=Math.round(f[0]),l[1]=Math.round(f[1]),l[2]=Math.round(f[2]),l[3]=Math.round(f[3]),l},i.scale=function(l,f,d){return l[0]=f[0]*d,l[1]=f[1]*d,l[2]=f[2]*d,l[3]=f[3]*d,l},i.scaleAndAdd=function(l,f,d,c){return l[0]=f[0]+d[0]*c,l[1]=f[1]+d[1]*c,l[2]=f[2]+d[2]*c,l[3]=f[3]+d[3]*c,l},i.distance=s,i.squaredDistance=o,i.length=u,i.squaredLength=h,i.negate=function(l,f){return l[0]=-f[0],l[1]=-f[1],l[2]=-f[2],l[3]=-f[3],l},i.inverse=function(l,f){return l[0]=1/f[0],l[1]=1/f[1],l[2]=1/f[2],l[3]=1/f[3],l},i.normalize=function(l,f){var d=f[0],c=f[1],p=f[2];f=f[3];var m=d*d+c*c+p*p+f*f;return 0<m&&(m=1/Math.sqrt(m)),l[0]=d*m,l[1]=c*m,l[2]=p*m,l[3]=f*m,l},i.dot=function(l,f){return l[0]*f[0]+l[1]*f[1]+l[2]*f[2]+l[3]*f[3]},i.cross=function(l,f,d,c){var p=d[0]*c[1]-d[1]*c[0],m=d[0]*c[2]-d[2]*c[0],g=d[0]*c[3]-d[3]*c[0],x=d[1]*c[2]-d[2]*c[1],y=d[1]*c[3]-d[3]*c[1];d=d[2]*c[3]-d[3]*c[2],c=f[0];var _=f[1],A=f[2];return f=f[3],l[0]=_*d-A*y+f*x,l[1]=-(c*d)+A*g-f*m,l[2]=c*y-_*g+f*p,l[3]=-(c*x)+_*m-A*p,l},i.lerp=function(l,f,d,c){var p=f[0],m=f[1],g=f[2];return f=f[3],l[0]=p+c*(d[0]-p),l[1]=m+c*(d[1]-m),l[2]=g+c*(d[2]-g),l[3]=f+c*(d[3]-f),l},i.random=function(l,f){f=f||1;do var d=2*v.RANDOM()-1,c=2*v.RANDOM()-1,p=d*d+c*c;while(1<=p);do var m=2*v.RANDOM()-1,g=2*v.RANDOM()-1,x=m*m+g*g;while(1<=x);return p=Math.sqrt((1-p)/x),l[0]=f*d,l[1]=f*c,l[2]=f*m*p,l[3]=f*g*p,l},i.transformMat4=function(l,f,d){var c=f[0],p=f[1],m=f[2];return f=f[3],l[0]=d[0]*c+d[4]*p+d[8]*m+d[12]*f,l[1]=d[1]*c+d[5]*p+d[9]*m+d[13]*f,l[2]=d[2]*c+d[6]*p+d[10]*m+d[14]*f,l[3]=d[3]*c+d[7]*p+d[11]*m+d[15]*f,l},i.transformQuat=function(l,f,d){var c=f[0],p=f[1],m=f[2],g=d[0],x=d[1],y=d[2];d=d[3];var _=d*c+x*m-y*p,A=d*p+y*c-g*m,T=d*m+g*p-x*c;return c=-g*c-x*p-y*m,l[0]=_*d+c*-g+A*-y-T*-x,l[1]=A*d+c*-x+T*-g-_*-y,l[2]=T*d+c*-y+_*-x-A*-g,l[3]=f[3],l},i.zero=function(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=0,l},i.str=function(l){return"vec4("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},i.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]},i.equals=function(l,f){var d=l[0],c=l[1],p=l[2];l=l[3];var m=f[0],g=f[1],x=f[2];return f=f[3],Math.abs(d-m)<=v.EPSILON*Math.max(1,Math.abs(d),Math.abs(m))&&Math.abs(c-g)<=v.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(p-x)<=v.EPSILON*Math.max(1,Math.abs(p),Math.abs(x))&&Math.abs(l-f)<=v.EPSILON*Math.max(1,Math.abs(l),Math.abs(f))},i.forEach=i.sqrLen=i.len=i.sqrDist=i.dist=i.div=i.mul=i.sub=void 0;var v=function(l){if(l&&l.__esModule)return l;var f={};if(l!=null){for(var d in l)if(Object.prototype.hasOwnProperty.call(l,d)){var c=pt&&vt?vt(l,d):{};c.get||c.set?pt(f,d,c):f[d]=l[d]}}return f.default=l,f}(Qt);i.sub=r,i.mul=a,i.div=n,i.dist=s,i.sqrDist=o,i.len=u,i.sqrLen=h,e=function(){var l=t();return function(f,d,c,p,m,g){for(d||(d=4),c||(c=0),p=p?Math.min(p*d+c,f.length):f.length;c<p;c+=d)l[0]=f[c],l[1]=f[c+1],l[2]=f[c+2],l[3]=f[c+3],m(l,l,g),f[c]=l[0],f[c+1]=l[1],f[c+2]=l[2],f[c+3]=l[3];return f}}(),i.forEach=e});tt(Xn);var Wn=V(function(e,i){function t(d){if(d&&d.__esModule)return d;var c={};if(d!=null){for(var p in d)if(Object.prototype.hasOwnProperty.call(d,p)){var m=pt&&vt?vt(d,p):{};m.get||m.set?pt(c,p,m):c[p]=d[p]}}return c.default=d,c}function r(){var d=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d[3]=1,d}function a(d,c,p){p*=.5;var m=Math.sin(p);return d[0]=m*c[0],d[1]=m*c[1],d[2]=m*c[2],d[3]=Math.cos(p),d}function n(d,c,p){var m=c[0],g=c[1],x=c[2];c=c[3];var y=p[0],_=p[1],A=p[2];return p=p[3],d[0]=m*p+c*y+g*A-x*_,d[1]=g*p+c*_+x*y-m*A,d[2]=x*p+c*A+m*_-g*y,d[3]=c*p-m*y-g*_-x*A,d}function s(d,c,p,m){var g=c[0],x=c[1],y=c[2];c=c[3];var _=p[0],A=p[1],T=p[2];p=p[3];var w=g*_+x*A+y*T+c*p;if(0>w&&(w=-w,_=-_,A=-A,T=-T,p=-p),1-w>u.EPSILON){var C=Math.acos(w),M=Math.sin(C);w=Math.sin((1-m)*C)/M,m=Math.sin(m*C)/M}else w=1-m;return d[0]=w*g+m*_,d[1]=w*x+m*A,d[2]=w*y+m*T,d[3]=w*c+m*p,d}function o(d,c){var p=c[0]+c[4]+c[8];if(0<p)p=Math.sqrt(p+1),d[3]=.5*p,p=.5/p,d[0]=(c[5]-c[7])*p,d[1]=(c[6]-c[2])*p,d[2]=(c[1]-c[3])*p;else{var m=0;c[4]>c[0]&&(m=1),c[8]>c[3*m+m]&&(m=2);var g=(m+1)%3,x=(m+2)%3;p=Math.sqrt(c[3*m+m]-c[3*g+g]-c[3*x+x]+1),d[m]=.5*p,p=.5/p,d[3]=(c[3*g+x]-c[3*x+g])*p,d[g]=(c[3*g+m]+c[3*m+g])*p,d[x]=(c[3*x+m]+c[3*m+x])*p}return d}Object.defineProperty(i,"__esModule",{value:!0}),i.create=r,i.identity=function(d){return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d},i.setAxisAngle=a,i.getAxisAngle=function(d,c){var p=2*Math.acos(c[3]),m=Math.sin(p/2);return m>u.EPSILON?(d[0]=c[0]/m,d[1]=c[1]/m,d[2]=c[2]/m):(d[0]=1,d[1]=0,d[2]=0),p},i.multiply=n,i.rotateX=function(d,c,p){p*=.5;var m=c[0],g=c[1],x=c[2];c=c[3];var y=Math.sin(p);return p=Math.cos(p),d[0]=m*p+c*y,d[1]=g*p+x*y,d[2]=x*p-g*y,d[3]=c*p-m*y,d},i.rotateY=function(d,c,p){p*=.5;var m=c[0],g=c[1],x=c[2];c=c[3];var y=Math.sin(p);return p=Math.cos(p),d[0]=m*p-x*y,d[1]=g*p+c*y,d[2]=x*p+m*y,d[3]=c*p-g*y,d},i.rotateZ=function(d,c,p){p*=.5;var m=c[0],g=c[1],x=c[2];c=c[3];var y=Math.sin(p);return p=Math.cos(p),d[0]=m*p+g*y,d[1]=g*p-m*y,d[2]=x*p+c*y,d[3]=c*p-x*y,d},i.calculateW=function(d,c){var p=c[0],m=c[1];return c=c[2],d[0]=p,d[1]=m,d[2]=c,d[3]=Math.sqrt(Math.abs(1-p*p-m*m-c*c)),d},i.slerp=s,i.random=function(d){var c=u.RANDOM(),p=u.RANDOM(),m=u.RANDOM(),g=Math.sqrt(1-c);return c=Math.sqrt(c),d[0]=g*Math.sin(2*Math.PI*p),d[1]=g*Math.cos(2*Math.PI*p),d[2]=c*Math.sin(2*Math.PI*m),d[3]=c*Math.cos(2*Math.PI*m),d},i.invert=function(d,c){var p=c[0],m=c[1],g=c[2];c=c[3];var x=p*p+m*m+g*g+c*c;return x=x?1/x:0,d[0]=-p*x,d[1]=-m*x,d[2]=-g*x,d[3]=c*x,d},i.conjugate=function(d,c){return d[0]=-c[0],d[1]=-c[1],d[2]=-c[2],d[3]=c[3],d},i.fromMat3=o,i.fromEuler=function(d,c,p,m){var g=.5*Math.PI/180;c*=g,p*=g,m*=g,g=Math.sin(c),c=Math.cos(c);var x=Math.sin(p);p=Math.cos(p);var y=Math.sin(m);return m=Math.cos(m),d[0]=g*p*m-c*x*y,d[1]=c*x*m+g*p*y,d[2]=c*p*y-g*x*m,d[3]=c*p*m+g*x*y,d},i.str=function(d){return"quat("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")"},i.setAxes=i.sqlerp=i.rotationTo=i.equals=i.exactEquals=i.normalize=i.sqrLen=i.squaredLength=i.len=i.length=i.lerp=i.dot=i.scale=i.mul=i.add=i.set=i.copy=i.fromValues=i.clone=void 0;var u=t(Qt),h=t(Nn),v=t(Hn);e=t(Xn),i.clone=e.clone,i.fromValues=e.fromValues,i.copy=e.copy,i.set=e.set,i.add=e.add,i.mul=n,i.scale=e.scale,i.dot=e.dot,i.lerp=e.lerp;var l=e.length;i.length=l,i.len=l,l=e.squaredLength,i.squaredLength=l,i.sqrLen=l;var f=e.normalize;i.normalize=f,i.exactEquals=e.exactEquals,i.equals=e.equals,e=function(){var d=v.create(),c=v.fromValues(1,0,0),p=v.fromValues(0,1,0);return function(m,g,x){var y=v.dot(g,x);return-.999999>y?(v.cross(d,c,g),1e-6>v.len(d)&&v.cross(d,p,g),v.normalize(d,d),a(m,d,Math.PI),m):.999999<y?(m[0]=0,m[1]=0,m[2]=0,m[3]=1,m):(v.cross(d,g,x),m[0]=d[0],m[1]=d[1],m[2]=d[2],m[3]=1+y,f(m,m))}}(),i.rotationTo=e,e=function(){var d=r(),c=r();return function(p,m,g,x,y,_){return s(d,m,y,_),s(c,g,x,_),s(p,d,c,2*_*(1-_)),p}}(),i.sqlerp=e,e=function(){var d=h.create();return function(c,p,m,g){return d[0]=m[0],d[3]=m[1],d[6]=m[2],d[1]=g[0],d[4]=g[1],d[7]=g[2],d[2]=-p[0],d[5]=-p[1],d[8]=-p[2],f(c,o(c,d))}}(),i.setAxes=e});tt(Wn);var ts=V(function(e,i){function t(l){if(l&&l.__esModule)return l;var f={};if(l!=null){for(var d in l)if(Object.prototype.hasOwnProperty.call(l,d)){var c=pt&&vt?vt(l,d):{};c.get||c.set?pt(f,d,c):f[d]=l[d]}}return f.default=l,f}function r(l,f,d){var c=.5*d[0],p=.5*d[1];d=.5*d[2];var m=f[0],g=f[1],x=f[2];return f=f[3],l[0]=m,l[1]=g,l[2]=x,l[3]=f,l[4]=c*f+p*x-d*g,l[5]=p*f+d*m-c*x,l[6]=d*f+c*g-p*m,l[7]=-c*m-p*g-d*x,l}function a(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l}function n(l,f,d){var c=f[0],p=f[1],m=f[2],g=f[3],x=d[4],y=d[5],_=d[6],A=d[7],T=f[4],w=f[5],C=f[6];f=f[7];var M=d[0],E=d[1],P=d[2];return d=d[3],l[0]=c*d+g*M+p*P-m*E,l[1]=p*d+g*E+m*M-c*P,l[2]=m*d+g*P+c*E-p*M,l[3]=g*d-c*M-p*E-m*P,l[4]=c*A+g*x+p*_-m*y+T*d+f*M+w*P-C*E,l[5]=p*A+g*y+m*x-c*_+w*d+f*E+C*M-T*P,l[6]=m*A+g*_+c*y-p*x+C*d+f*P+T*E-w*M,l[7]=g*A-c*x-p*y-m*_+f*d-T*M-w*E-C*P,l}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var l=new s.ARRAY_TYPE(8);return s.ARRAY_TYPE!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[4]=0,l[5]=0,l[6]=0,l[7]=0),l[3]=1,l},i.clone=function(l){var f=new s.ARRAY_TYPE(8);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f},i.fromValues=function(l,f,d,c,p,m,g,x){var y=new s.ARRAY_TYPE(8);return y[0]=l,y[1]=f,y[2]=d,y[3]=c,y[4]=p,y[5]=m,y[6]=g,y[7]=x,y},i.fromRotationTranslationValues=function(l,f,d,c,p,m,g){var x=new s.ARRAY_TYPE(8);return x[0]=l,x[1]=f,x[2]=d,x[3]=c,p*=.5,m*=.5,g*=.5,x[4]=p*c+m*d-g*f,x[5]=m*c+g*l-p*d,x[6]=g*c+p*f-m*l,x[7]=-p*l-m*f-g*d,x},i.fromRotationTranslation=r,i.fromTranslation=function(l,f){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l[4]=.5*f[0],l[5]=.5*f[1],l[6]=.5*f[2],l[7]=0,l},i.fromRotation=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=0,l[5]=0,l[6]=0,l[7]=0,l},i.fromMat4=function(l,f){var d=o.create();u.getRotation(d,f);var c=new s.ARRAY_TYPE(3);return u.getTranslation(c,f),r(l,d,c),l},i.copy=a,i.identity=function(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l[6]=0,l[7]=0,l},i.set=function(l,f,d,c,p,m,g,x,y){return l[0]=f,l[1]=d,l[2]=c,l[3]=p,l[4]=m,l[5]=g,l[6]=x,l[7]=y,l},i.getDual=function(l,f){return l[0]=f[4],l[1]=f[5],l[2]=f[6],l[3]=f[7],l},i.setDual=function(l,f){return l[4]=f[0],l[5]=f[1],l[6]=f[2],l[7]=f[3],l},i.getTranslation=function(l,f){var d=f[4],c=f[5],p=f[6],m=f[7],g=-f[0],x=-f[1],y=-f[2];return f=f[3],l[0]=2*(d*f+m*g+c*y-p*x),l[1]=2*(c*f+m*x+p*g-d*y),l[2]=2*(p*f+m*y+d*x-c*g),l},i.translate=function(l,f,d){var c=f[0],p=f[1],m=f[2],g=f[3],x=.5*d[0],y=.5*d[1];d=.5*d[2];var _=f[4],A=f[5],T=f[6];return f=f[7],l[0]=c,l[1]=p,l[2]=m,l[3]=g,l[4]=g*x+p*d-m*y+_,l[5]=g*y+m*x-c*d+A,l[6]=g*d+c*y-p*x+T,l[7]=-c*x-p*y-m*d+f,l},i.rotateX=function(l,f,d){var c=-f[0],p=-f[1],m=-f[2],g=f[3],x=f[4],y=f[5],_=f[6],A=f[7],T=x*g+A*c+y*m-_*p,w=y*g+A*p+_*c-x*m,C=_*g+A*m+x*p-y*c;return x=A*g-x*c-y*p-_*m,o.rotateX(l,f,d),c=l[0],p=l[1],m=l[2],g=l[3],l[4]=T*g+x*c+w*m-C*p,l[5]=w*g+x*p+C*c-T*m,l[6]=C*g+x*m+T*p-w*c,l[7]=x*g-T*c-w*p-C*m,l},i.rotateY=function(l,f,d){var c=-f[0],p=-f[1],m=-f[2],g=f[3],x=f[4],y=f[5],_=f[6],A=f[7],T=x*g+A*c+y*m-_*p,w=y*g+A*p+_*c-x*m,C=_*g+A*m+x*p-y*c;return x=A*g-x*c-y*p-_*m,o.rotateY(l,f,d),c=l[0],p=l[1],m=l[2],g=l[3],l[4]=T*g+x*c+w*m-C*p,l[5]=w*g+x*p+C*c-T*m,l[6]=C*g+x*m+T*p-w*c,l[7]=x*g-T*c-w*p-C*m,l},i.rotateZ=function(l,f,d){var c=-f[0],p=-f[1],m=-f[2],g=f[3],x=f[4],y=f[5],_=f[6],A=f[7],T=x*g+A*c+y*m-_*p,w=y*g+A*p+_*c-x*m,C=_*g+A*m+x*p-y*c;return x=A*g-x*c-y*p-_*m,o.rotateZ(l,f,d),c=l[0],p=l[1],m=l[2],g=l[3],l[4]=T*g+x*c+w*m-C*p,l[5]=w*g+x*p+C*c-T*m,l[6]=C*g+x*m+T*p-w*c,l[7]=x*g-T*c-w*p-C*m,l},i.rotateByQuatAppend=function(l,f,d){var c=d[0],p=d[1],m=d[2];d=d[3];var g=f[0],x=f[1],y=f[2],_=f[3];return l[0]=g*d+_*c+x*m-y*p,l[1]=x*d+_*p+y*c-g*m,l[2]=y*d+_*m+g*p-x*c,l[3]=_*d-g*c-x*p-y*m,g=f[4],x=f[5],y=f[6],_=f[7],l[4]=g*d+_*c+x*m-y*p,l[5]=x*d+_*p+y*c-g*m,l[6]=y*d+_*m+g*p-x*c,l[7]=_*d-g*c-x*p-y*m,l},i.rotateByQuatPrepend=function(l,f,d){var c=f[0],p=f[1],m=f[2];f=f[3];var g=d[0],x=d[1],y=d[2],_=d[3];return l[0]=c*_+f*g+p*y-m*x,l[1]=p*_+f*x+m*g-c*y,l[2]=m*_+f*y+c*x-p*g,l[3]=f*_-c*g-p*x-m*y,g=d[4],x=d[5],y=d[6],_=d[7],l[4]=c*_+f*g+p*y-m*x,l[5]=p*_+f*x+m*g-c*y,l[6]=m*_+f*y+c*x-p*g,l[7]=f*_-c*g-p*x-m*y,l},i.rotateAroundAxis=function(l,f,d,c){if(Math.abs(c)<s.EPSILON)return a(l,f);var p=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);c*=.5;var m=Math.sin(c),g=m*d[0]/p,x=m*d[1]/p;d=m*d[2]/p,c=Math.cos(c),p=f[0],m=f[1];var y=f[2],_=f[3];return l[0]=p*c+_*g+m*d-y*x,l[1]=m*c+_*x+y*g-p*d,l[2]=y*c+_*d+p*x-m*g,l[3]=_*c-p*g-m*x-y*d,p=f[4],m=f[5],y=f[6],f=f[7],l[4]=p*c+f*g+m*d-y*x,l[5]=m*c+f*x+y*g-p*d,l[6]=y*c+f*d+p*x-m*g,l[7]=f*c-p*g-m*x-y*d,l},i.add=function(l,f,d){return l[0]=f[0]+d[0],l[1]=f[1]+d[1],l[2]=f[2]+d[2],l[3]=f[3]+d[3],l[4]=f[4]+d[4],l[5]=f[5]+d[5],l[6]=f[6]+d[6],l[7]=f[7]+d[7],l},i.multiply=n,i.scale=function(l,f,d){return l[0]=f[0]*d,l[1]=f[1]*d,l[2]=f[2]*d,l[3]=f[3]*d,l[4]=f[4]*d,l[5]=f[5]*d,l[6]=f[6]*d,l[7]=f[7]*d,l},i.lerp=function(l,f,d,c){var p=1-c;return 0>h(f,d)&&(c=-c),l[0]=f[0]*p+d[0]*c,l[1]=f[1]*p+d[1]*c,l[2]=f[2]*p+d[2]*c,l[3]=f[3]*p+d[3]*c,l[4]=f[4]*p+d[4]*c,l[5]=f[5]*p+d[5]*c,l[6]=f[6]*p+d[6]*c,l[7]=f[7]*p+d[7]*c,l},i.invert=function(l,f){var d=v(f);return l[0]=-f[0]/d,l[1]=-f[1]/d,l[2]=-f[2]/d,l[3]=f[3]/d,l[4]=-f[4]/d,l[5]=-f[5]/d,l[6]=-f[6]/d,l[7]=f[7]/d,l},i.conjugate=function(l,f){return l[0]=-f[0],l[1]=-f[1],l[2]=-f[2],l[3]=f[3],l[4]=-f[4],l[5]=-f[5],l[6]=-f[6],l[7]=f[7],l},i.normalize=function(l,f){var d=v(f);if(0<d){d=Math.sqrt(d);var c=f[0]/d,p=f[1]/d,m=f[2]/d,g=f[3]/d,x=f[4],y=f[5],_=f[6];f=f[7];var A=c*x+p*y+m*_+g*f;l[0]=c,l[1]=p,l[2]=m,l[3]=g,l[4]=(x-c*A)/d,l[5]=(y-p*A)/d,l[6]=(_-m*A)/d,l[7]=(f-g*A)/d}return l},i.str=function(l){return"quat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+")"},i.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]&&l[4]===f[4]&&l[5]===f[5]&&l[6]===f[6]&&l[7]===f[7]},i.equals=function(l,f){var d=l[0],c=l[1],p=l[2],m=l[3],g=l[4],x=l[5],y=l[6];l=l[7];var _=f[0],A=f[1],T=f[2],w=f[3],C=f[4],M=f[5],E=f[6];return f=f[7],Math.abs(d-_)<=s.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(c-A)<=s.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(p-T)<=s.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(m-w)<=s.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))&&Math.abs(g-C)<=s.EPSILON*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(x-M)<=s.EPSILON*Math.max(1,Math.abs(x),Math.abs(M))&&Math.abs(y-E)<=s.EPSILON*Math.max(1,Math.abs(y),Math.abs(E))&&Math.abs(l-f)<=s.EPSILON*Math.max(1,Math.abs(l),Math.abs(f))},i.sqrLen=i.squaredLength=i.len=i.length=i.dot=i.mul=i.setReal=i.getReal=void 0;var s=t(Qt),o=t(Wn),u=t(jn);i.getReal=o.copy,i.setReal=o.copy,i.mul=n;var h=o.dot;i.dot=h,e=o.length,i.length=e,i.len=e;var v=o.squaredLength;i.squaredLength=v,i.sqrLen=v});tt(ts);var es=V(function(e,i){function t(){var l=new v.ARRAY_TYPE(2);return v.ARRAY_TYPE!=Float32Array&&(l[0]=0,l[1]=0),l}function r(l,f,d){return l[0]=f[0]-d[0],l[1]=f[1]-d[1],l}function a(l,f,d){return l[0]=f[0]*d[0],l[1]=f[1]*d[1],l}function n(l,f,d){return l[0]=f[0]/d[0],l[1]=f[1]/d[1],l}function s(l,f){var d=f[0]-l[0];return l=f[1]-l[1],Math.sqrt(d*d+l*l)}function o(l,f){var d=f[0]-l[0];return l=f[1]-l[1],d*d+l*l}function u(l){var f=l[0];return l=l[1],Math.sqrt(f*f+l*l)}function h(l){var f=l[0];return l=l[1],f*f+l*l}Object.defineProperty(i,"__esModule",{value:!0}),i.create=t,i.clone=function(l){var f=new v.ARRAY_TYPE(2);return f[0]=l[0],f[1]=l[1],f},i.fromValues=function(l,f){var d=new v.ARRAY_TYPE(2);return d[0]=l,d[1]=f,d},i.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l},i.set=function(l,f,d){return l[0]=f,l[1]=d,l},i.add=function(l,f,d){return l[0]=f[0]+d[0],l[1]=f[1]+d[1],l},i.subtract=r,i.multiply=a,i.divide=n,i.ceil=function(l,f){return l[0]=Math.ceil(f[0]),l[1]=Math.ceil(f[1]),l},i.floor=function(l,f){return l[0]=Math.floor(f[0]),l[1]=Math.floor(f[1]),l},i.min=function(l,f,d){return l[0]=Math.min(f[0],d[0]),l[1]=Math.min(f[1],d[1]),l},i.max=function(l,f,d){return l[0]=Math.max(f[0],d[0]),l[1]=Math.max(f[1],d[1]),l},i.round=function(l,f){return l[0]=Math.round(f[0]),l[1]=Math.round(f[1]),l},i.scale=function(l,f,d){return l[0]=f[0]*d,l[1]=f[1]*d,l},i.scaleAndAdd=function(l,f,d,c){return l[0]=f[0]+d[0]*c,l[1]=f[1]+d[1]*c,l},i.distance=s,i.squaredDistance=o,i.length=u,i.squaredLength=h,i.negate=function(l,f){return l[0]=-f[0],l[1]=-f[1],l},i.inverse=function(l,f){return l[0]=1/f[0],l[1]=1/f[1],l},i.normalize=function(l,f){var d=f[0],c=f[1];return d=d*d+c*c,0<d&&(d=1/Math.sqrt(d)),l[0]=f[0]*d,l[1]=f[1]*d,l},i.dot=function(l,f){return l[0]*f[0]+l[1]*f[1]},i.cross=function(l,f,d){return f=f[0]*d[1]-f[1]*d[0],l[0]=l[1]=0,l[2]=f,l},i.lerp=function(l,f,d,c){var p=f[0];return f=f[1],l[0]=p+c*(d[0]-p),l[1]=f+c*(d[1]-f),l},i.random=function(l,f){f=f||1;var d=2*v.RANDOM()*Math.PI;return l[0]=Math.cos(d)*f,l[1]=Math.sin(d)*f,l},i.transformMat2=function(l,f,d){var c=f[0];return f=f[1],l[0]=d[0]*c+d[2]*f,l[1]=d[1]*c+d[3]*f,l},i.transformMat2d=function(l,f,d){var c=f[0];return f=f[1],l[0]=d[0]*c+d[2]*f+d[4],l[1]=d[1]*c+d[3]*f+d[5],l},i.transformMat3=function(l,f,d){var c=f[0];return f=f[1],l[0]=d[0]*c+d[3]*f+d[6],l[1]=d[1]*c+d[4]*f+d[7],l},i.transformMat4=function(l,f,d){var c=f[0];return f=f[1],l[0]=d[0]*c+d[4]*f+d[12],l[1]=d[1]*c+d[5]*f+d[13],l},i.rotate=function(l,f,d,c){var p=f[0]-d[0];f=f[1]-d[1];var m=Math.sin(c);return c=Math.cos(c),l[0]=p*c-f*m+d[0],l[1]=p*m+f*c+d[1],l},i.angle=function(l,f){var d=l[0];l=l[1];var c=f[0];f=f[1];var p=d*d+l*l;0<p&&(p=1/Math.sqrt(p));var m=c*c+f*f;return 0<m&&(m=1/Math.sqrt(m)),d=(d*c+l*f)*p*m,1<d?0:-1>d?Math.PI:Math.acos(d)},i.zero=function(l){return l[0]=0,l[1]=0,l},i.str=function(l){return"vec2("+l[0]+", "+l[1]+")"},i.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]},i.equals=function(l,f){var d=l[0];l=l[1];var c=f[0];return f=f[1],Math.abs(d-c)<=v.EPSILON*Math.max(1,Math.abs(d),Math.abs(c))&&Math.abs(l-f)<=v.EPSILON*Math.max(1,Math.abs(l),Math.abs(f))},i.forEach=i.sqrLen=i.sqrDist=i.dist=i.div=i.mul=i.sub=i.len=void 0;var v=function(l){if(l&&l.__esModule)return l;var f={};if(l!=null){for(var d in l)if(Object.prototype.hasOwnProperty.call(l,d)){var c=pt&&vt?vt(l,d):{};c.get||c.set?pt(f,d,c):f[d]=l[d]}}return f.default=l,f}(Qt);i.len=u,i.sub=r,i.mul=a,i.div=n,i.dist=s,i.sqrDist=o,i.sqrLen=h,e=function(){var l=t();return function(f,d,c,p,m,g){for(d||(d=2),c||(c=0),p=p?Math.min(p*d+c,f.length):f.length;c<p;c+=d)l[0]=f[c],l[1]=f[c+1],m(l,l,g),f[c]=l[0],f[c+1]=l[1];return f}}(),i.forEach=e});tt(es);var Yt=V(function(e,i){function t(r){if(r&&r.__esModule)return r;var a={};if(r!=null){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var s=pt&&vt?vt(r,n):{};s.get||s.set?pt(a,n,s):a[n]=r[n]}}return a.default=r,a}Object.defineProperty(i,"__esModule",{value:!0}),i.vec4=i.vec3=i.vec2=i.quat2=i.quat=i.mat4=i.mat3=i.mat2d=i.mat2=i.glMatrix=void 0,e=t(Qt),i.glMatrix=e,e=t(qa),i.mat2=e,e=t($a),i.mat2d=e,e=t(Nn),i.mat3=e,e=t(jn),i.mat4=e,e=t(Wn),i.quat=e,e=t(ts),i.quat2=e,e=t(es),i.vec2=e,e=t(Hn),i.vec3=e,e=t(Xn),i.vec4=e});tt(Yt);var ht=Yt.vec4,j=Yt.vec3,J=Yt.vec2,sf=Yt.quat2,Oi=Yt.quat,z=Yt.mat4,uf=Yt.mat3,lf=Yt.mat2d,ff=Yt.mat2,hf=Yt.glMatrix,cf=V(function(e,i){i.__esModule=!0;var t=le&&le.__esModule?le:{default:le};i.default=function(r,a,n){return a in r?(0,t.default)(r,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[a]=n,r}}),It=tt(cf),q=function(){function e(i,t,r){O(this,e),this.options=t,this.gl=i,r&&(this.map=r.map),r=this.getVertexShader(t.vertexShader);var a=this.getFragmentShader(t.fragmentShader);t=i.createShader(i.VERTEX_SHADER),i.shaderSource(t,r),i.compileShader(t),i.getShaderParameter(t,i.COMPILE_STATUS)?(r=i.createShader(i.FRAGMENT_SHADER),i.shaderSource(r,a),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)?(a=i.createProgram(),i.attachShader(a,t),i.attachShader(a,r),i.deleteShader(t),i.deleteShader(r),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)?t=a:(t="Shader program failed to link.  The error log is:"+i.getProgramInfoLog(a),console.error(t),t=-1)):(t="Fragment shader failed to compile.  The error log is:"+i.getShaderInfoLog(r),console.error(t),t=-1)):(t="Vertex shader failed to compile.  The error log is:"+i.getShaderInfoLog(t),console.error(t),t=-1),t=this.program=t,r={},a=i.getProgramParameter(t,i.ACTIVE_ATTRIBUTES);for(var n=0;n<a;n++){var s=i.getActiveAttrib(t,n);r[s.name]=i.getAttribLocation(t,s.name)}n={},s={};for(var o=i.getProgramParameter(t,i.ACTIVE_UNIFORMS),u=0;u<o;u++){var h=i.getActiveUniform(t,u);n[h.name]=i.getUniformLocation(t,h.name),s[h.name]=h.type}this.parameter=i={attributes:r,numAttributes:a,uniformsType:s,uniforms:n},this.attributes=i.attributes,this.uniforms=i.uniforms,this.parameter=i}return I(e,[{key:"getVertexShader",value:function(i){var t="";return this.map&&this.map.type==="cesium"&&(t=`#define LOG_DEPTH
`),t+=`#ifdef LOG_DEPTH
uniform float currentFrustumX;varying float v_depthFromNearPlusOne;
#endif
uniform vec2 MAPV_resolution;
#if defined(PICK)
uniform bool uIsPickRender;attribute vec3 aPickColor;uniform vec3 uPickedColor;varying vec4 vPickColor;uniform bool uEnablePicked;bool mapvIsPicked(){return uEnablePicked&&aPickColor==uPickedColor;}
#endif
void afterMain(){
#if defined(LOG_DEPTH)
v_depthFromNearPlusOne=(gl_Position.w-currentFrustumX)+1.0;gl_Position.z=clamp(gl_Position.z/gl_Position.w,-1.0,1.0)*gl_Position.w;
#endif
#if defined(PICK)
vPickColor=vec4(aPickColor,0.0);if(mapvIsPicked()){vPickColor.a=1.0;}
#endif
}`,i=this.getDefines()+t+i,i=i.replace("void main","void originMain"),i+"void main() {originMain(); afterMain();}"}},{key:"getFragmentShader",value:function(i){var t="";return this.map&&this.map.type==="cesium"&&(t=`#define LOG_DEPTH
`),t+=`#if defined(LOG_DEPTH)
#extension GL_EXT_frag_depth : enable
#endif
precision highp float;uniform vec2 MAPV_resolution;uniform bool uIsPickRender;
#if defined(PICK)
varying vec4 vPickColor;bool mapvIsPicked(){return vPickColor.a==1.0;}
#endif
#if defined(LOG_DEPTH)
uniform float oneOverLog2FarDepthFromNearPlusOne;uniform float farDepthFromNearPlusOne;varying float v_depthFromNearPlusOne;void writeLogDepth(float depth){if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}gl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;}
#endif
void afterMain(){
#if defined(PICK)
if(uIsPickRender){gl_FragColor=vec4(vPickColor.rgb,1.0);return;}
#endif
#if defined(LOG_DEPTH)
writeLogDepth(v_depthFromNearPlusOne);
#endif
}`,i=this.getDefines()+t+i,i=i.replace("void main","void originMain"),i+"void main() {originMain(); afterMain();}"}},{key:"getDefines",value:function(){var i="",t=this.options.defines;if(t)for(var r=0;r<t.length;r++)i+="#define "+t[r]+`
`;return i}},{key:"use",value:function(i,t){this.gl=i,i.useProgram(this.program),this.map&&this.map.type==="cesium"&&this.setUniforms({currentFrustumX:this.map.map.scene.camera.frustum.near,oneOverLog2FarDepthFromNearPlusOne:this.map.map.scene.context.uniformState.oneOverLog2FarDepthFromNearPlusOne,farDepthFromNearPlusOne:this.map.map.scene.context.uniformState.farDepthFromNearPlusOne}),this.uniforms.MAPV_resolution&&this.setUniforms({MAPV_resolution:[i.canvas.width,i.canvas.height]})}},{key:"setUniform",value:function(i,t){var r=this.gl,a=this.uniforms[i];if(a)switch(this.parameter.uniformsType[i]){case r.FLOAT:r.uniform1f(a,t);break;case r.FLOAT_VEC2:r.uniform2f(a,t[0],t[1]);break;case r.FLOAT_VEC3:r.uniform3f(a,t[0],t[1],t[2]);break;case r.FLOAT_VEC4:r.uniform4f(a,t[0],t[1],t[2],t[3]);break;case r.SAMPLER_2D:case r.SAMPLER_CUBE:r.activeTexture(r["TEXTURE"+this.textureIndex]),r.uniform1i(a,this.textureIndex),r.bindTexture(r.TEXTURE_2D,t),this.textureIndex++;break;case r.INT:case r.BOOL:r.uniform1i(a,t);break;case r.INT_VEC2:case r.BOOL_VEC2:r.uniform2i(a,t[0],t[1]);break;case r.INT_VEC3:case r.BOOL_VEC3:r.uniform3i(a,t[0],t[1],t[2]);break;case r.INT_VEC4:case r.BOOL_VEC4:r.uniform4i(a,t[0],t[1],t[2],t[3]);break;case r.FLOAT_MAT2:r.uniformMatrix2fv(a,!1,t);break;case r.FLOAT_MAT3:r.uniformMatrix3fv(a,!1,t);break;case r.FLOAT_MAT4:r.uniformMatrix4fv(a,!1,t);break;default:console.error("Unrecognized uniform type: "+i)}else console.warn("Unrecognized uniform type: "+i)}},{key:"setUniforms",value:function(i){this.textureIndex=0;for(var t in i)this.setUniform(t,i[t])}}]),e}(),de=function(e,i,t,r){var a=t?t.call(r,e,i):void 0;if(a!==void 0)return!!a;if(e===i)return!0;if((typeof e=="undefined"?"undefined":Ut(e))!=="object"||!e||(typeof i=="undefined"?"undefined":Ut(i))!=="object"||!i)return!1;var n=yt(e),s=yt(i);if(n.length!==s.length)return!1;s=Object.prototype.hasOwnProperty.bind(i);for(var o=0;o<n.length;o++){if(a=n[o],!s(a))return!1;var u=e[a],h=i[a];if(a=t?t.call(r,u,h,a):void 0,a===!1||a===void 0&&u!==h)return!1}return!0},rs=function(){function e(i){O(this,e),this.options=i,this.gl=i.gl,this.savedState=[],this.currentState=this.getDefaultState()}return I(e,[{key:"setDefaultState",value:function(){this.setState()}},{key:"getDefaultState",value:function(){var i=this.gl;return{blend:!1,blendEquation:i.FUNC_ADD,blendFunc:[i.ONE,i.ZERO],depthMask:!0,depthTest:!0,depthFunc:i.LEQUAL,polygonOffset:[0,0],cullFace:!1,stencilTest:!1}}},{key:"getRealState",value:function(){var i=this.gl;return{blend:i.getParameter(i.BLEND),blendEquation:i.getParameter(i.BLEND_EQUATION),depthMask:i.getParameter(i.DEPTH_WRITEMASK),depthTest:i.getParameter(i.DEPTH_TEST),depthFunc:i.getParameter(i.DEPTH_FUNC),polygonOffset:[i.getParameter(i.POLYGON_OFFSET_FACTOR),i.getParameter(i.POLYGON_OFFSET_UNITS)],cullFace:i.getParameter(i.CULL_FACE),stencilTest:i.getParameter(i.STENCIL_TEST)}}},{key:"getCurrentState",value:function(){return this.currentState}},{key:"save",value:function(){this.savedState.push(this.getCurrentState())}},{key:"restore",value:function(){var i=this.savedState.pop();this.setState(i,{force:!0})}},{key:"setState",value:function(i){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};i=K(this.getDefaultState(),i),this.setBlend(i,t),this.setDepth(i,t),this.setCullFace(i,t),this.setPolygonOffset(i,t),this.setStencil(i,t),this.currentState=i}},{key:"setBlend",value:function(i,t){var r=this.gl,a=this.getCurrentState();((t=t.force)||!de(i.blend,a.blend))&&(i.blend?r.enable(r.BLEND):r.disable(r.BLEND)),!t&&de(i.blendEquation,a.blendEquation)||r.blendEquation(i.blendEquation),!t&&de(i.blendFunc,a.blendFunc)||r.blendFunc(i.blendFunc[0],i.blendFunc[1])}},{key:"setDepth",value:function(i,t){var r=this.gl,a=this.getCurrentState();((t=t.force)||!de(i.depthTest,a.depthTest))&&(i.depthTest?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST)),(t||!de(i.depthMask,a.depthMask))&&(i.depthMask?r.depthMask(!0):r.depthMask(!1)),!t&&de(i.depthFunc,a.depthFunc)||r.depthFunc(i.depthFunc)}},{key:"setPolygonOffset",value:function(i,t){var r=this.gl,a=this.getCurrentState();(t.force||!de(i.polygonOffset,a.polygonOffset))&&(i.polygonOffset[0]!==0&&i.polygonOffset[1]!==0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.polygonOffset(i.polygonOffset[0],i.polygonOffset[1]))}},{key:"setCullFace",value:function(i,t){var r=this.gl,a=this.getCurrentState();(t.force||!de(i.cullFace,a.cullFace))&&(i.cullFace?(r.enable(r.CULL_FACE),r.cullFace(r.BACK)):r.disable(r.CULL_FACE))}},{key:"setStencil",value:function(i,t){var r=this.gl,a=this.getCurrentState();(t.force||!de(i.stencilTest,a.stencilTest))&&(i.stencilTest?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST))}}]),e}(),k=function(){function e(i){O(this,e),this.options=i,this.gl=i.gl,this.buffer=this.gl.createBuffer(),i.data&&this.updateData(i.data)}return I(e,[{key:"updateData",value:function(i){var t=this.options,r=this.gl;this.bind(),r.bufferData(r[t.target],i,r[t.usage])}},{key:"bind",value:function(i){i=i||this.gl,i.bindBuffer(i[this.options.target],this.buffer)}},{key:"unBind",value:function(i){i=i||this.gl,i.bindBuffer(i[this.options.target],null)}},{key:"destroy",value:function(){this.buffer=null}}]),e}(),df={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FLOAT:4},at=function(){function e(i){for(O(this,e),this.options=i,this.attributes=i.attributes,this.gl=i.gl,this.program=i.program,i=this.stride=0;i<this.attributes.length;i++)this.stride+=df[this.attributes[i].type]*this.attributes[i].size}return I(e,[{key:"setVertexAttribPointers",value:function(){for(var i=this.gl,t=this.program,r=0;r<this.attributes.length;r++){var a=this.attributes[r],n=t.attributes[a.name];n!==void 0&&(a.buffer.bind(i),i.vertexAttribPointer(n,a.size,i[a.type],a.normalize||!1,a.stride!==void 0?a.stride:this.stride,a.offset),i.enableVertexAttribArray(n))}}},{key:"bind",value:function(){this.setVertexAttribPointers()}},{key:"destroy",value:function(){}}]),e}(),wt=function e(i,t,r){O(this,e),t=t||i.canvas.width,r=r||i.canvas.height;var a=i.createFramebuffer(),n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,r,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),a.texture=n;var s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,r),a.depthBuffer=s,i.bindFramebuffer(i.FRAMEBUFFER,a),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,s),t=i.checkFramebufferStatus(i.FRAMEBUFFER),i.FRAMEBUFFER_COMPLETE===t&&(i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),this.framebuffer=a)},or=function(){function e(i){O(this,e),this.options={},K(this.options,i),this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0],this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}return I(e,[{key:"getOptions",value:function(){return this.options}},{key:"onResize",value:function(i){}},{key:"render",value:function(i){var t=i.gl;i=i.texture;var r=this.programSample;t.useProgram(r.program);var a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);var n=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW),t.enableVertexAttribArray(r.attributes.aPos),t.vertexAttribPointer(r.attributes.aPos,3,t.FLOAT,!1,0,0),a=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),t.STATIC_DRAW),t.enableVertexAttribArray(r.attributes.aTextureCoord),t.vertexAttribPointer(r.attributes.aTextureCoord,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.uniform1i(r.uniforms.uSampler,0),t.drawArrays(t.TRIANGLES,0,n.length/3)}}]),e}(),vf=function(e){function i(t){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t))}return Y(i,e),I(i,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new q(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(void){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;vec4 fxaa_2_0(sampler2D tex,vec2 fragCoord,vec2 resolution,vec2 v_rgbNW,vec2 v_rgbNE,vec2 v_rgbSW,vec2 v_rgbSE,vec2 v_rgbM){vec4 color;mediump vec2 inverseVP=vec2(1.0/resolution.x,1.0/resolution.y);vec3 rgbNW=texture2D(tex,v_rgbNW).xyz;vec3 rgbNE=texture2D(tex,v_rgbNE).xyz;vec3 rgbSW=texture2D(tex,v_rgbSW).xyz;vec3 rgbSE=texture2D(tex,v_rgbSE).xyz;vec4 texColor=texture2D(tex,v_rgbM);vec3 rgbM=texColor.xyz;vec3 luma=vec3(0.299,0.587,0.114);float lumaNW=dot(rgbNW,luma);float lumaNE=dot(rgbNE,luma);float lumaSW=dot(rgbSW,luma);float lumaSE=dot(rgbSE,luma);float lumaM=dot(rgbM,luma);float lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));float lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));mediump vec2 dir;dir.x=-((lumaNW+lumaNE)-(lumaSW+lumaSE));dir.y=((lumaNW+lumaSW)-(lumaNE+lumaSE));float dirReduce=max((lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*1.0/8.0),1.0/128.0);float rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);dir=min(vec2(8.0,8.0),max(vec2(-8.0,-8.0),dir*rcpDirMin))*inverseVP;vec3 rgbA=0.5*(texture2D(tex,fragCoord*inverseVP+dir*(1.0/3.0-0.5)).xyz+texture2D(tex,fragCoord*inverseVP+dir*(2.0/3.0-0.5)).xyz);vec3 rgbB=rgbA*0.5+0.25*(texture2D(tex,fragCoord*inverseVP+dir*-0.5).xyz+texture2D(tex,fragCoord*inverseVP+dir*0.5).xyz);float lumaB=dot(rgbB,luma);if((lumaB<lumaMin)||(lumaB>lumaMax)){color=vec4(rgbA,texColor.a);}else{color=vec4(rgbB,texColor.a);}return color;}void texcoords_3_1(vec2 fragCoord,vec2 resolution,out vec2 v_rgbNW,out vec2 v_rgbNE,out vec2 v_rgbSW,out vec2 v_rgbSE,out vec2 v_rgbM){vec2 inverseVP=1.0/resolution.xy;v_rgbNW=(fragCoord+vec2(-1.0,-1.0))*inverseVP;v_rgbNE=(fragCoord+vec2(1.0,-1.0))*inverseVP;v_rgbSW=(fragCoord+vec2(-1.0,1.0))*inverseVP;v_rgbSE=(fragCoord+vec2(1.0,1.0))*inverseVP;v_rgbM=vec2(fragCoord*inverseVP);}vec4 apply_1_2(sampler2D tex,vec2 fragCoord,vec2 resolution){mediump vec2 v_rgbNW;mediump vec2 v_rgbNE;mediump vec2 v_rgbSW;mediump vec2 v_rgbSE;mediump vec2 v_rgbM;texcoords_3_1(fragCoord,resolution,v_rgbNW,v_rgbNE,v_rgbSW,v_rgbSE,v_rgbM);return fxaa_2_0(tex,fragCoord,resolution,v_rgbNW,v_rgbNE,v_rgbSW,v_rgbSE,v_rgbM);}void main(void){vec2 fragCoord=vTextureCoord*canvasSize;gl_FragColor=apply_1_2(uSampler,fragCoord,canvasSize);}"})),this.programSample}},{key:"render",value:function(t){var r=t.gl;t=t.texture,this.getOptions(),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var a=this.getProgram(r);r.useProgram(a.program);var n=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.vertex),r.STATIC_DRAW),r.enableVertexAttribArray(a.attributes.aPos),r.vertexAttribPointer(a.attributes.aPos,3,r.FLOAT,!1,0,0),n=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.sampleCoord),r.STATIC_DRAW),r.enableVertexAttribArray(a.attributes.aTextureCoord),r.vertexAttribPointer(a.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(a.uniforms.uSampler,1),r.uniform2fv(a.uniforms.canvasSize,[r.canvas.width,r.canvas.height]),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.bindBuffer(r.ARRAY_BUFFER,null),r.useProgram(null)}}]),i}(or),pf=function(e){function i(t){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t))}return Y(i,e),I(i,[{key:"getProgram",value:function(t){if(this.program1||(this.program1=new q(t,{vertexShader:"attribute vec3 position;attribute vec2 uv;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];void SMAAEdgeDetectionVS(vec2 texcoord){vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-1.0,0.0,0.0,1.0);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(1.0,0.0,0.0,-1.0);vOffset[2]=texcoord.xyxy+resolution.xyxy*vec4(-2.0,0.0,0.0,2.0);}void main(){vUv=uv;SMAAEdgeDetectionVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:`precision highp float;
#define SMAA_THRESHOLD 0.1
uniform sampler2D tDiffuse;varying vec2 vUv;varying vec4 vOffset[3];vec4 SMAAColorEdgeDetectionPS(vec2 texcoord,vec4 offset[3],sampler2D colorTex){vec2 threshold=vec2(SMAA_THRESHOLD,SMAA_THRESHOLD);vec4 delta;vec3 C=texture2D(colorTex,texcoord).rgb;vec3 Cleft=texture2D(colorTex,offset[0].xy).rgb;vec3 t=abs(C-Cleft);delta.x=max(max(t.r,t.g),t.b);vec3 Ctop=texture2D(colorTex,offset[0].zw).rgb;t=abs(C-Ctop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0,1.0))==0.0)discard;vec3 Cright=texture2D(colorTex,offset[1].xy).rgb;t=abs(C-Cright);delta.z=max(max(t.r,t.g),t.b);vec3 Cbottom=texture2D(colorTex,offset[1].zw).rgb;t=abs(C-Cbottom);delta.w=max(max(t.r,t.g),t.b);float maxDelta=max(max(max(delta.x,delta.y),delta.z),delta.w);vec3 Cleftleft=texture2D(colorTex,offset[2].xy).rgb;t=abs(C-Cleftleft);delta.z=max(max(t.r,t.g),t.b);vec3 Ctoptop=texture2D(colorTex,offset[2].zw).rgb;t=abs(C-Ctoptop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(max(maxDelta,delta.z),delta.w);edges.xy*=step(0.5*maxDelta,delta.xy);return vec4(edges,0.0,0.0);}void main(){gl_FragColor=SMAAColorEdgeDetectionPS(vUv,vOffset,tDiffuse);}`})),this.program2||(this.program2=new q(t,{vertexShader:`precision highp float;
#define SMAA_MAX_SEARCH_STEPS 8
#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
#define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )
attribute vec3 position;attribute vec2 uv;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixcoord;void SMAABlendingWeightCalculationVS(vec2 texcoord){vPixcoord=texcoord/resolution;vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-0.25,0.125,1.25,0.125);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(-0.125,0.25,-0.125,-1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*resolution.xxyy*float(SMAA_MAX_SEARCH_STEPS);}void main(){vUv=uv;SMAABlendingWeightCalculationVS(vUv);gl_Position=vec4(position,1.0);}`,fragmentShader:`precision highp float;
#define SMAA_MAX_SEARCH_STEPS 8
#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
#define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )
#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )
uniform sampler2D tDiffuse;uniform sampler2D tArea;uniform sampler2D tSearch;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixcoord;vec2 round(vec2 x){return sign(x)*floor(abs(x)+0.5);}float SMAASearchLength(sampler2D searchTex,vec2 e,float bias,float scale){e.r=bias+e.r*scale;return 255.0*texture2D(searchTex,e,0.0).r;}float SMAASearchXLeft(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){/***@PSEUDO_GATHER4*This texcoord has been offset by(-0.25,-0.125)in the vertex shader to*sample between edge,thus fetching four edges in a row.*Sampling with different offsets in each direction allows to disambiguate*which edges are active from the four fetched ones.*/vec2 e=vec2(0.0,1.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord-=vec2(2.0,0.0)*resolution;if(!(texcoord.x>end&&e.g>0.8281&&e.r==0.0))break;}texcoord.x+=0.25*resolution.x;texcoord.x+=resolution.x;texcoord.x+=2.0*resolution.x;texcoord.x-=resolution.x*SMAASearchLength(searchTex,e,0.0,0.5);return texcoord.x;}float SMAASearchXRight(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord+=vec2(2.0,0.0)*resolution;if(!(texcoord.x<end&&e.g>0.8281&&e.r==0.0))break;}texcoord.x-=0.25*resolution.x;texcoord.x-=resolution.x;texcoord.x-=2.0*resolution.x;texcoord.x+=resolution.x*SMAASearchLength(searchTex,e,0.5,0.5);return texcoord.x;}float SMAASearchYUp(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord+=vec2(0.0,2.0)*resolution;if(!(texcoord.y>end&&e.r>0.8281&&e.g==0.0))break;}texcoord.y-=0.25*resolution.y;texcoord.y-=resolution.y;texcoord.y-=2.0*resolution.y;texcoord.y+=resolution.y*SMAASearchLength(searchTex,e.gr,0.0,0.5);return texcoord.y;}float SMAASearchYDown(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord-=vec2(0.0,2.0)*resolution;if(!(texcoord.y<end&&e.r>0.8281&&e.g==0.0))break;}texcoord.y+=0.25*resolution.y;texcoord.y+=resolution.y;texcoord.y+=2.0*resolution.y;texcoord.y-=resolution.y*SMAASearchLength(searchTex,e.gr,0.5,0.5);return texcoord.y;}vec2 SMAAArea(sampler2D areaTex,vec2 dist,float e1,float e2,float offset){vec2 texcoord=float(SMAA_AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texcoord=SMAA_AREATEX_PIXEL_SIZE*texcoord+(0.5*SMAA_AREATEX_PIXEL_SIZE);texcoord.y+=SMAA_AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTex,texcoord,0.0).rg;}vec4 SMAABlendingWeightCalculationPS(vec2 texcoord,vec2 pixcoord,vec4 offset[3],sampler2D edgesTex,sampler2D areaTex,sampler2D searchTex,ivec4 subsampleIndices){vec4 weights=vec4(0.0,0.0,0.0,0.0);vec2 e=texture2D(edgesTex,texcoord).rg;if(e.g>0.0){vec2 d;vec2 coords;coords.x=SMAASearchXLeft(edgesTex,searchTex,offset[0].xy,offset[2].x);coords.y=offset[1].y;d.x=coords.x;float e1=texture2D(edgesTex,coords,0.0).r;coords.x=SMAASearchXRight(edgesTex,searchTex,offset[0].zw,offset[2].y);d.y=coords.x;d=d/resolution.x-pixcoord.x;vec2 sqrt_d=sqrt(abs(d));coords.y-=1.0*resolution.y;float e2=SMAASampleLevelZeroOffset(edgesTex,coords,ivec2(1,0)).r;weights.rg=SMAAArea(areaTex,sqrt_d,e1,e2,float(subsampleIndices.y));}if(e.r>0.0){vec2 d;vec2 coords;coords.y=SMAASearchYUp(edgesTex,searchTex,offset[1].xy,offset[2].z);coords.x=offset[0].x;d.x=coords.y;float e1=texture2D(edgesTex,coords,0.0).g;coords.y=SMAASearchYDown(edgesTex,searchTex,offset[1].zw,offset[2].w);d.y=coords.y;d=d/resolution.y-pixcoord.y;vec2 sqrt_d=sqrt(abs(d));coords.y-=1.0*resolution.y;float e2=SMAASampleLevelZeroOffset(edgesTex,coords,ivec2(0,1)).g;weights.ba=SMAAArea(areaTex,sqrt_d,e1,e2,float(subsampleIndices.x));}return weights;}void main(){gl_FragColor=SMAABlendingWeightCalculationPS(vUv,vPixcoord,vOffset,tDiffuse,tArea,tSearch,ivec4(0.0));}`})),this.program3||(this.program3=new q(t,{vertexShader:"precision highp float;uniform vec2 resolution;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;varying vec4 vOffset[2];void SMAANeighborhoodBlendingVS(vec2 texcoord){vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-1.0,0.0,0.0,1.0);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(1.0,0.0,0.0,-1.0);}void main(){vUv=uv;SMAANeighborhoodBlendingVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:"precision highp float;uniform sampler2D tDiffuse;uniform sampler2D tColor;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[2];vec4 SMAANeighborhoodBlendingPS(vec2 texcoord,vec4 offset[2],sampler2D colorTex,sampler2D blendTex){vec4 a;a.xz=texture2D(blendTex,texcoord).xz;a.y=texture2D(blendTex,offset[1].zw).g;a.w=texture2D(blendTex,offset[1].xy).a;if(dot(a,vec4(1.0,1.0,1.0,1.0))<1e-5){return texture2D(colorTex,texcoord,0.0);}else{vec2 offset;offset.x=a.a>a.b ? a.a :-a.b;offset.y=a.g>a.r ?-a.g : a.r;if(abs(offset.x)>abs(offset.y)){offset.y=0.0;}else{offset.x=0.0;}vec4 C=texture2D(colorTex,texcoord,0.0);texcoord+=sign(offset)*resolution;vec4 Cop=texture2D(colorTex,texcoord,0.0);float s=abs(offset.x)>abs(offset.y)? abs(offset.x): abs(offset.y);C.xyz=pow(C.xyz,vec3(2.2));Cop.xyz=pow(Cop.xyz,vec3(2.2));vec4 mixed=mix(C,Cop,s);mixed.xyz=pow(mixed.xyz,vec3(1.0/2.2));return mixed;}}void main(){gl_FragColor=SMAANeighborhoodBlendingPS(vUv,vOffset,tColor,tDiffuse);}"})),!this.vertexBuffer||!this.sampleBuffer){this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord));var r=[{stride:12,name:"position",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"uv",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}];this.vertexArray1=new at({gl:t,program:this.program1,attributes:r}),this.vertexArray2=new at({gl:t,program:this.program2,attributes:r}),this.vertexArray3=new at({gl:t,program:this.program3,attributes:r})}return{program1:this.program1,program2:this.program2,program3:this.program3}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new wt(t),this.bloomBuffer=new wt(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new wt(t)),this.bloomBuffer||(this.bloomBuffer=new wt(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var r=t.gl,a=t.texture;t=t.fbo,this.getOptions(),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var n=this.getProgram(r),s=n.program1,o=n.program2;n=n.program3;var u=this.getExtraFbo(r),h=u.collectBrightBuffer;u=u.bloomBuffer;var v=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,v),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.vertex),r.STATIC_DRAW),r.enableVertexAttribArray(s.attributes.position),r.vertexAttribPointer(s.attributes.position,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(o.attributes.position),r.vertexAttribPointer(o.attributes.position,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(n.attributes.position),r.vertexAttribPointer(n.attributes.position,3,r.FLOAT,!1,0,0),v=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,v),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.sampleCoord),r.STATIC_DRAW),r.enableVertexAttribArray(s.attributes.uv),r.vertexAttribPointer(s.attributes.uv,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(o.attributes.uv),r.vertexAttribPointer(o.attributes.uv,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(n.attributes.uv),r.vertexAttribPointer(n.attributes.uv,2,r.FLOAT,!1,0,0),r.useProgram(s.program),r.bindFramebuffer(r.FRAMEBUFFER,h),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,a),r.uniform1i(s.uniforms.tDiffuse,2),r.uniform2fv(s.uniforms.resolution,[r.canvas.width,r.canvas.height]),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.useProgram(o.program),r.bindFramebuffer(r.FRAMEBUFFER,u),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,h.texture),r.uniform1i(o.uniforms.uSampler,2),r.uniform2fv(o.uniforms.resolution,[r.canvas.width,r.canvas.height]),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.useProgram(n.program),r.bindFramebuffer(r.FRAMEBUFFER,t),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,a),r.uniform1i(n.uniforms.tDiffuse,2),r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,u.texture),r.uniform1i(n.uniforms.tColor,3),r.uniform2fv(n.uniforms.resolution,[r.canvas.width,r.canvas.height]),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.bindBuffer(r.ARRAY_BUFFER,null),r.useProgram(null)}},{key:"getAreaTexture",value:function(){return"data:image/png;base64,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"}},{key:"getSearchTexture",value:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAIAAADiVupLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFZJREFUeNrs00EKgAAIRNEZ739mTQoiwmhRi4L/FiKiu9ERISkzbXdTVV3H4WhfOG6ehl1rNR7qDSF8hwkVcJXt+3A//I0Nv0GoCBUAAAAAAMA/LAIMAB+Dcg2OE2zsAAAAAElFTkSuQmCC"}}]),i}(or),gf=function(e){function i(t){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t))}return Y(i,e),I(i,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new q(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord)),this.vertexArray=new at({gl:t,program:this.programSample,attributes:[{stride:12,name:"aPos",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"aTextureCoord",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}]})),this.programSample}},{key:"render",value:function(t){var r=t.gl;t=t.texture,r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var a=this.getProgram(r);a.use(r),this.vertexArray.bind(),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(a.uniforms.uSampler,1),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3)}}]),i}(or),mf=function(e){function i(t){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t))}return Y(i,e),I(i,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new q(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-(1.0-threshold)/5.0));float brightness=dot(color.rgb,vec3(0.2126,0.7152,0.0722));if(brightness>threshold){color=lightColor;}else{color=vec4(0.0);}gl_FragColor=color;}"})),this.programBloom||(this.programBloom=new q(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new q(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord);vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new wt(t),this.bloomBuffer=new wt(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new wt(t)),this.bloomBuffer||(this.bloomBuffer=new wt(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var r=t.gl,a=t.texture;t=t.fbo;var n=this.getOptions();r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var s=this.getProgram(r),o=s.programBright,u=s.programBloom;s=s.programResult;var h=this.getExtraFbo(r),v=h.collectBrightBuffer;h=h.bloomBuffer;var l=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,l),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.vertex),r.STATIC_DRAW),r.enableVertexAttribArray(o.attributes.aPos),r.vertexAttribPointer(o.attributes.aPos,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(u.attributes.aPos),r.vertexAttribPointer(u.attributes.aPos,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(s.attributes.aPos),r.vertexAttribPointer(s.attributes.aPos,3,r.FLOAT,!1,0,0),l=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,l),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.sampleCoord),r.STATIC_DRAW),r.enableVertexAttribArray(o.attributes.aTextureCoord),r.vertexAttribPointer(o.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(u.attributes.aTextureCoord),r.vertexAttribPointer(u.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(s.attributes.aTextureCoord),r.vertexAttribPointer(s.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.useProgram(o.program),r.bindFramebuffer(r.FRAMEBUFFER,v),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,a),r.uniform1i(o.uniforms.uSampler,1),r.uniform1f(o.uniforms.threshold,n.threshold||0),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.useProgram(u.program),r.bindFramebuffer(r.FRAMEBUFFER,h),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,v.texture),r.uniform1i(u.uniforms.uSampler,1),r.uniform1i(u.uniforms.isVertical,!0),r.uniform1f(u.uniforms.blurSize,n.blurSize||2),r.uniform1f(u.uniforms.devicePixelRatio,window.devicePixelRatio),r.uniform2fv(u.uniforms.canvasSize,[r.canvas.width,r.canvas.height]),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.useProgram(u.program),r.bindFramebuffer(r.FRAMEBUFFER,v),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,h.texture),r.uniform1i(u.uniforms.uSampler,1),r.uniform1i(u.uniforms.isVertical,!1),r.uniform1f(u.uniforms.blurSize,n.blurSize||2),r.uniform1f(u.uniforms.devicePixelRatio,window.devicePixelRatio),r.uniform2fv(u.uniforms.canvasSize,[r.canvas.width,r.canvas.height]),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.useProgram(s.program),r.bindFramebuffer(r.FRAMEBUFFER,t),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,a),r.uniform1i(s.uniforms.originalTexture,1),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,v.texture),r.uniform1i(s.uniforms.bloomTexture,0),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.bindBuffer(r.ARRAY_BUFFER,null),r.useProgram(null)}}]),i}(or),xf=function(e){function i(t){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t))}return Y(i,e),I(i,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new q(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-threshold));gl_FragColor=lightColor;}"})),this.programBloom||(this.programBloom=new q(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new q(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;uniform float toneScale;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord)*toneScale;vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new wt(t),this.bloomBuffer=new wt(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new wt(t)),this.bloomBuffer||(this.bloomBuffer=new wt(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var r=t.gl,a=t.texture;t=t.fbo;var n=this.getOptions(),s="clarity"in n?n.clarity:1;s=Math.max(0,s),s=Math.min(1,s),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var o=this.getProgram(r),u=o.programBright,h=o.programBloom;o=o.programResult;var v=this.getExtraFbo(r),l=v.collectBrightBuffer;v=v.bloomBuffer;var f=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,f),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.vertex),r.STATIC_DRAW),r.enableVertexAttribArray(u.attributes.aPos),r.vertexAttribPointer(u.attributes.aPos,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(h.attributes.aPos),r.vertexAttribPointer(h.attributes.aPos,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(o.attributes.aPos),r.vertexAttribPointer(o.attributes.aPos,3,r.FLOAT,!1,0,0),f=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,f),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.sampleCoord),r.STATIC_DRAW),r.enableVertexAttribArray(u.attributes.aTextureCoord),r.vertexAttribPointer(u.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(h.attributes.aTextureCoord),r.vertexAttribPointer(h.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(o.attributes.aTextureCoord),r.vertexAttribPointer(o.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.useProgram(u.program),r.bindFramebuffer(r.FRAMEBUFFER,l),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,a),r.uniform1i(u.uniforms.uSampler,1),r.uniform1f(u.uniforms.threshold,n.threshold||0),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.useProgram(h.program),r.bindFramebuffer(r.FRAMEBUFFER,v),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,l.texture),r.uniform1i(h.uniforms.uSampler,1),r.uniform1i(h.uniforms.isVertical,!0),r.uniform1f(h.uniforms.blurSize,n.blurSize||2),r.uniform1f(h.uniforms.devicePixelRatio,window.devicePixelRatio),r.uniform2fv(h.uniforms.canvasSize,[r.canvas.width,r.canvas.height]),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.useProgram(h.program),r.bindFramebuffer(r.FRAMEBUFFER,l),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,v.texture),r.uniform1i(h.uniforms.uSampler,1),r.uniform1i(h.uniforms.isVertical,!1),r.uniform1f(h.uniforms.blurSize,n.blurSize||2),r.uniform1f(h.uniforms.devicePixelRatio,window.devicePixelRatio),r.uniform2fv(h.uniforms.canvasSize,[r.canvas.width,r.canvas.height]),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.useProgram(o.program),r.bindFramebuffer(r.FRAMEBUFFER,t),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,a),r.uniform1i(o.uniforms.originalTexture,1),r.uniform1f(o.uniforms.toneScale,s),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.texture),r.uniform1i(o.uniforms.bloomTexture,0),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3),r.bindBuffer(r.ARRAY_BUFFER,null),r.useProgram(null)}}]),i}(or),yf=function(e){function i(t){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t))}return Y(i,e),I(i,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new q(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"})),this.programSample}},{key:"render",value:function(t){var r=t.gl;t=t.texture;var a=this.getProgram(r);r.useProgram(a.program);var n=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.vertex),r.STATIC_DRAW),r.enableVertexAttribArray(a.attributes.aPos),r.vertexAttribPointer(a.attributes.aPos,3,r.FLOAT,!1,0,0),n=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,new Float32Array(this.sampleCoord),r.STATIC_DRAW),r.enableVertexAttribArray(a.attributes.aTextureCoord),r.vertexAttribPointer(a.attributes.aTextureCoord,2,r.FLOAT,!1,0,0),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(a.uniforms.uSampler,1),r.uniform2fv(a.uniforms.canvasSize,[r.canvas.width,r.canvas.height]),r.drawArrays(r.TRIANGLES,0,this.vertex.length/3)}}]),i}(or),is=function(){function e(i){O(this,e),this.gl=i,this.effects=[],this.initFbo()}return I(e,[{key:"addEffect",value:function(i){this.effects.push(i)}},{key:"removeEffect",value:function(i){}},{key:"setEffects",value:function(i){this.effects=i}},{key:"onResize",value:function(){this.initFbo();var i=this.gl,t=this.effects;if(t&&1<t.length)for(var r=1;r<t.length;r++){var a=t[r];a.onResize&&a.onResize(i)}}},{key:"initFbo",value:function(){var i=this.gl;i&&(this.fbo=[new wt(i),new wt(i)])}},{key:"destroy",value:function(){this.effects=[],this.fbo=[],this.gl=null}},{key:"render",value:function(){var i=this.gl,t=this.effects;if(t&&0<t.length)for(var r={},a=0;a<t.length;a++){var n=this.fbo[a%2].framebuffer;a===t.length-1&&(n=null),i.bindFramebuffer(i.FRAMEBUFFER,n);var s=[0,0,0,0];i.clearColor(s[0],s[1],s[2],s[3]),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),t[a].render({isPickRender:!1,gl:i,texture:r.texture,fbo:n}),r=n}}}]),e}(),Wr=function(){function e(i,t){O(this,e),this.map=i,this.options=t||{},this.eventMap={}}return I(e,[{key:"onResize",value:function(i){}},{key:"onUpdate",value:function(i){throw"\u672A\u5B9E\u73B0onUpdate\u65B9\u6CD5"}},{key:"getContainer",value:function(){throw"\u672A\u5B9E\u73B0getContainer\u65B9\u6CD5"}},{key:"getSize",value:function(){throw"\u672A\u5B9E\u73B0getSize\u65B9\u6CD5"}},{key:"getTilt",value:function(){throw"\u672A\u5B9E\u73B0getTilt\u65B9\u6CD5"}},{key:"getHeading",value:function(){throw"\u672A\u5B9E\u73B0getHeading\u65B9\u6CD5"}},{key:"getZoomUnits",value:function(){throw"\u672A\u5B9E\u73B0getZoomUnits\u65B9\u6CD5"}},{key:"getCenter",value:function(){throw"\u672A\u5B9E\u73B0getCenter\u65B9\u6CD5"}},{key:"getMapType",value:function(){throw"\u672A\u5B9E\u73B0getMapType\u65B9\u6CD5"}},{key:"lnglatToMercator",value:function(i,t){return this.options.coordinateSystem==="gcj02"?(t=t*Math.PI/180,t=31890685e-1*Math.log((1+Math.sin(t))/(1-Math.sin(t))),[parseFloat((i*Math.PI/180*6378137).toFixed(2)),parseFloat(t.toFixed(2))]):(i=Lt.convertLL2MC({lng:i,lat:t}),[i.lng,i.lat])}}]),e}(),_f=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.eventMap={},t}return Y(i,e),I(i,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onMousemove",value:function(t){t=this.extendCallback(t),this.map.addEventListener("mousemove",t),this.eventMap.mousemove=t}},{key:"onClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("click",t),this.eventMap.click=t}},{key:"onDblClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("dblclick",t),this.eventMap.dblclick=t}},{key:"onRightClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("rightclick",t),this.eventMap.rightclick=t}},{key:"onUpdate",value:function(t){this.map.addEventListener("update",t),this.map.addEventListener("onearthstatuschange",t),this.eventMap.update=t,this.eventMap.onearthstatuschange=t}},{key:"extendCallback",value:function(t){return function(r){t(K(r,{x:r.x,y:r.y}))}}},{key:"unbind",value:function(t){var r=this;this.eventMap[t]?(this.map.removeEventListener(t,this.eventMap[t]),delete this.eventMap[t]):(yt(this.eventMap).forEach(function(a){r.map.removeEventListener(a,r.eventMap[a])}),this.eventMap={})}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getBounds",value:function(){return this.map.getBounds()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},{key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var t=this.map.getCenter();return-180<=t.lng&&180>=t.lng&&(t=this.map.lnglatToMercator(t.lng,t.lat),t={lng:t[0],lat:t[1]}),t}},{key:"getMapType",value:function(){return this.map.getMapType()}},{key:"lnglatToMercator",value:function(t,r){return this.map.lnglatToMercator(t,r)}},{key:"mercatorToLnglat",value:function(t,r){return this.map.mercatorToLnglat(t,r)}}]),i}(Wr),Af=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.div=document.createElement("div"),t.div.style.position="absolute",t.div.style.userSelect="none",t.map.getPanes().mapPane.appendChild(t.div),t.eventMap={},t}return Y(i,e),I(i,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onMousemove",value:function(t){t=this.extendCallback(t),this.map.addEventListener("mousemove",t),this.eventMap.mousemove=t}},{key:"onClick",value:function(t){t=this.extendCallback(t),pa?(this.map.addEventListener("touchend",t),this.eventMap.touchend=t):(this.map.addEventListener("click",t),this.eventMap.click=t)}},{key:"onDblClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("dblclick",t),this.eventMap.dblclick=t}},{key:"onRightClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("rightclick",t),this.eventMap.rightclick=t}},{key:"changeCanvas",value:function(){var t=this.map,r=t.getSize(),a=t.getCenter();t=t.pointToOverlayPixel(a),this.div.style.left=t.x-r.width/2+"px",this.div.style.top=t.y-r.height/2+"px"}},{key:"onUpdate",value:function(t){var r=this,a=function(){r.changeCanvas(),t()};this.map.addEventListener("moveend",a),this.map.addEventListener("moving",a),this.map.addEventListener("zoomend",a),this.eventMap.moveend=a,this.eventMap.moving=a,this.eventMap.zoomend=a}},{key:"extendCallback",value:function(t){return function(r){t(K(r,{x:r.pixel.x,y:r.pixel.y}))}}},{key:"unbind",value:function(){var t=this;yt(this.eventMap).forEach(function(r){t.map.removeEventListener(r,t.eventMap[r])}),this.eventMap={}}},{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getBounds",value:function(){return this.map.getBounds()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",value:function(){return 0}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getZoomUnits",value:function(){var t=this.getZoom();return this.map.getMapType().getZoomUnits?this.map.getMapType().getZoomUnits(t):Math.pow(2,18-t)}},{key:"getCenter",value:function(){var t=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:t.x,lat:t.y}}},{key:"lnglatToMercator",value:function(t,r){return t=this.map.getMapType().getProjection().lngLatToPoint({lng:t,lat:r}),[t.x,t.y]}},{key:"mercatorToLnglat",value:function(t,r){return t=this.map.getMapType().getProjection().pointToLngLat({lng:t,lat:r}),[t.lng,t.lat]}}]),i}(Wr),Tf=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.eventMap={},t}return Y(i,e),I(i,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;yt(this.eventMap).forEach(function(r){window.removeEventListener(r,t.eventMap[r])}),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},{key:"getSize",value:function(){var t=this.map;return{width:t.canvas.clientWidth,height:t.canvas.clientHeight}}},{key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/Math.PI}},{key:"getZoomUnits",value:function(){var t=this.map;return 6.8*t.scene.globe.ellipsoid.cartesianToCartographic(t.camera.position).height/6500}},{key:"getZoom",value:function(){return 10}},{key:"getCenter",value:function(){var t=this.map;return t=t.camera.pickEllipsoid(new Cesium.Cartesian2(t.canvas.clientWidth/2,t.canvas.clientHeight/2)),t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),t=this.getMercator([180*t.longitude/Math.PI,180*t.latitude/Math.PI]),{lng:t[0],lat:t[1]}}},{key:"getMercator",value:function(t){var r=[];return r[0]=t[0]*Math.PI/180*6378137,t=t[1]*Math.PI/180,r[1]=31890685e-1*Math.log((1+Math.sin(t))/(1-Math.sin(t))),r}}]),i}(Wr),wf=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.eventMap={},t}return Y(i,e),I(i,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;yt(this.eventMap).forEach(function(r){window.removeEventListener(r,t.eventMap[r])}),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getZoom",value:function(){return this.map.zoom}},{key:"getCenter",value:function(){return this.map.center}}]),i}(Wr),Mf=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.eventMap={},t}return Y(i,e),I(i,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;yt(this.eventMap).forEach(function(r){window.removeEventListener(r,t.eventMap[r])}),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]),i}(Wr),ns=function(){function e(i,t){var r=this;O(this,e),t=t||{},t.mapType==="bmap"?this.map=new Af(i,t):t.mapType==="blank"?this.map=new wf(i,t):t.mapType==="cesium"?this.map=new Tf(i,t):t.mapType==="three"?this.map=new Mf(i,t):(t.mapType="bmapgl",this.map=new _f(i,t)),this.map.type=t.mapType,this._dpr=window.devicePixelRatio,t.mapType==="bmapgl"&&(this._dpr=this.map.map.config.ratio),this.options=t||{},this.renderArr=[],(i=t.canvas)||(i=document.createElement("canvas")),this.canvas=i,this.gl=t.gl?t.gl:mo(i,t),["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"].forEach(function(a){r.gl.getExtension(a)}),this.changeSize(),this.projectionMatrix=z.create(Float64Array),this.orthoMatrix=z.create(Float64Array),this.matrix=z.create(Float64Array),this.viewMatrix=z.create(Float64Array),this.pointToPixelMatrix=z.create(Float64Array),this.pixelToViewMatrix=z.create(Float64Array),this.fovy=35,this.fps=Math.min(t.fps,60)||60,this.renderTime=new Date().valueOf(),this._animation=this.animation.bind(this),this._update=this.update.bind(this),this.onInitialize(this.options.onInitialize),this.options.onRender&&this.renderArr.push(this.options.onRender),this.stateManager=new rs({gl:this.gl}),this.pickFBO=new wt(this.gl),this.transferOptions={},this.bind()}return I(e,[{key:"bind",value:function(){var i=this,t=this.map;t.onResize(function(){i.changeSize(),i.render()}),t.onUpdate(this._update),t.onClick&&t.onClick(function(r){i.onClick&&i.onClick(r)}),t.onDblClick&&t.onDblClick(function(r){i.onDblClick&&i.onDblClick(r)}),t.onRightClick&&t.onRightClick(function(r){i.onRightClick&&i.onRightClick(r)}),t.onMousemove&&t.onMousemove(function(r){i.onMousemove&&i.onMousemove(r)}),this.options.canvas||t.getContainer().appendChild(this.canvas)}},{key:"unbind",value:function(){var i=this.map;i.unbind&&i.unbind()}},{key:"setOptions",value:function(i){this.options=i}},{key:"onInitialize",value:function(i){i&&(this.transferOptions=i.bind(this)(this.gl)||{})}},{key:"bindFramebuffer",value:function(i){var t=this.gl;i?t.bindFramebuffer(t.FRAMEBUFFER,i.framebuffer):t.bindFramebuffer(t.FRAMEBUFFER,null)}},{key:"saveFramebuffer",value:function(){var i=this.gl;this.preFramebuffer=i.getParameter(i.FRAMEBUFFER_BINDING)}},{key:"restoreFramebuffer",value:function(){var i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,this.preFramebuffer)}},{key:"onRender",value:function(i){this.renderArr.push(i)}},{key:"changeSize",value:function(){var i=this.canvas,t=this.options;if(i){var r=i.style,a=this.map.getSize(),n=this._dpr;i.width=a.width*n,i.height=a.height*n,r.cssText="position: absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px;z-index:2;",t.mapType!=="cesium"||t.canvas||(r.pointerEvents="none"),this.gl.viewport(0,0,i.width,i.height)}}},{key:"update",value:function(){this.options.autoUpdate===!1||this.isAnimation&&60<=this.fps||this.render()}},{key:"render",value:function(){if(this.map&&this.gl){var i=this.options,t=this.projectionMatrix,r=this.viewMatrix;if(i.mapType==="three")r=this.map.map.camera,t=r.projectionMatrix.elements,r=r.matrixWorldInverse.elements;else if(i.mapType==="cesium"){r=this.map.map;var a=r.camera.frustum.projectionMatrix;t=new Float32Array([a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]),a=r.camera.viewMatrix,r=new Float32Array([a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]])}else this.map.map.mapType==="B_EARTH_MAP"?(t=this.map.map.getEarth().scene._camera.getProjectionMatrix(),r=this.map.map.getEarth().scene._camera.getModelViewMatrix()):(this.updateProjectionMatrix(),this.updateModelViewMatrix());for(a=z.multiply(this.matrix,t,r),K(this.transferOptions,{gl:this.gl,matrix:a,pointToPixelMatrix:this.pointToPixelMatrix,pixelToViewMatrix:this.pixelToViewMatrix,projectionMatrix:t,orthoMatrix:this.orthoMatrix,viewMatrix:r,stateManager:this.stateManager}),i.mapType!=="three"&&i.mapType!=="cesium"&&i.autoUpdate!==!1&&this.clear(),i=0;i<this.renderArr.length;i++)this.renderArr[i]&&this.renderArr[i].bind(this)(this.transferOptions)}}},{key:"clear",value:function(i){var t=this.gl,r=this.options.clearColor||[0,0,0,0];t.clearColor(r[0],r[1],r[2],r[3]),i&&(i instanceof Array||(i=mt(i).unitArray()),t.clearColor(i[0],i[1],i[2],i[3])),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var i=this.gl.canvas.width/this.gl.canvas.height,t=this.options.cameraNear||1,r=this.options.cameraFar||4e3;z.perspective(this.projectionMatrix,Mt(this.fovy),i,t,r),i=this.map.getSize(),z.ortho(this.orthoMatrix,-i.width/2,i.width/2,-i.height/2,i.height/2,t,r)}},{key:"updateModelViewMatrix",value:function(){var i=this.map,t=this.viewMatrix,r=this.pointToPixelMatrix,a=this.pixelToViewMatrix;z.identity(t),z.identity(r),z.identity(a);var n=i.getSize();n=Math.round(-n.height/(2*Math.tan(Mt(this.fovy)/2))),z.translate(a,a,[0,0,n]),z.rotate(a,a,Mt(i.getTilt()),[-1,0,0]),z.rotate(a,a,Mt(i.getHeading()),[0,0,-1]),n=i.getCenter();var s=this.options.pointOffset||[0,0];i=i.getZoomUnits(),z.translate(r,r,[(s[0]-n.lng)/i,(s[1]-n.lat)/i,0]),i=1/i,z.scale(r,r,[i,i,i]),z.multiply(t,a,r)}},{key:"destroy",value:function(){this.stopAnimation(),this.unbind();var i=this.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this.map.getContainer().removeChild(this.canvas),this.gl=this.canvas=null}},{key:"animation",value:function(){if(this.isAnimation){if(60<=this.fps)this.render();else{var i=new Date().valueOf(),t=Math.floor(1e3/this.fps),r=i-this.renderTime;r>t&&(this.render(),this.renderTime=i-r%t)}window.requestAnimationFrame(this._animation)}}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",value:function(){this.isAnimation=!1}}]),e}(),Cf=function(){function e(i){O(this,e),this.layers=[],this.options=i,this.webglLayer=i.webglLayer}return I(e,[{key:"addLayer",value:function(i){for(var t=!1,r=0;r<this.layers.length;r++)if(this.layers[r]===i){t=!0;break}t||(i.map=this.webglLayer.map,i.layerType==="threeLayer"?(i.setWebglLayer(this.webglLayer),t=i.getThreeLayer(),this.addLayer(t),i.initialize&&i.initialize(t)):(i.setWebglLayer(this.webglLayer),i.commonInitialize&&i.commonInitialize(this.webglLayer.gl),i.initialize&&i.initialize(this.webglLayer.gl),i.onOptionsChanged(i.getOptions(),{}),i.onDataChanged(i.getData()),i.onChanged(i.getOptions(),i.getData())),this.putInLayer(i)),this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"putInLayer",value:function(i){i.options.renderOrder===void 0&&(i.options.renderOrder=this.layers.length),this.layers.push(i),this.layers=this.layers.sort(function(t,r){return t.options.renderOrder-r.options.renderOrder})}},{key:"removeLayer",value:function(i){for(var t=0;t<this.layers.length;t++)this.layers[t]===i&&this.layers.splice(t,1);this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"showLayer",value:function(i){for(var t=0;t<this.layers.length;t++)this.layers[t]===i&&i.show();this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"hideLayer",value:function(i){for(var t=0;t<this.layers.length;t++)this.layers[t]===i&&i.hide();this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"removeAllLayers",value:function(){this.layers=[],this.webglLayer.stopAnimation(),this.webglLayer.render()}},{key:"destroyAllLayers",value:function(){for(var i=0;i<this.layers.length;i++){var t=this.layers[i];t.destroy&&t.destroy()}}},{key:"getAllLayers",value:function(){return this.layers}},{key:"getAllThreeLayers",value:function(){for(var i=[],t=0;t<this.layers.length;t++){var r=this.layers[t];r.layerType==="ThreeLayer"&&i.push(r)}return i}},{key:"isRequestAnimation",value:function(){for(var i=!1,t=0;t<this.layers.length;t++)if(this.layers[t].isRequestAnimation()){i=!0;break}return i}},{key:"beforeRender",value:function(i){i.gl&&this.webglLayer.stateManager.setDefaultState()}},{key:"afterRender",value:function(i){(i=i.gl)&&(i.bindBuffer(i.ARRAY_BUFFER,null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),i.useProgram(null))}},{key:"renderGLLayers",value:function(i){this.webglLayer.stateManager.save();for(var t=0;t<this.layers.length;t++){var r=this.layers[t];if(r._visible===!0&&r.layerType!=="threeLayer"&&r.layerType!=="ThreeLayer"){var a=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(a<n[0]||a>=n[1])||(this.beforeRender(i),r.render(i),this.afterRender(i))}}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayer",value:function(i){this.webglLayer.stateManager.save(),this.webglLayer.stateManager.setState({blendFunc:[i.gl.SRC_ALPHA,i.gl.ONE],depthMask:!1,depthTest:!0,depthFunc:i.gl.LESS,cullFace:!1});for(var t=0;t<this.layers.length;t++){var r=this.layers[t];if(r._visible===!0&&r.layerType==="ThreeLayer"){var a=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(a<n[0]||a>=n[1])||r.render(i)}}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayers",value:function(i){this.webglLayer.stateManager.save(),this.webglLayer.stateManager.setState({blendFunc:[i.gl.SRC_ALPHA,i.gl.ONE],depthMask:!1,depthTest:!0,depthFunc:i.gl.LESS,cullFace:!1});for(var t=0;t<this.layers.length;t++){var r=this.layers[t];if(r._visible===!0&&r.layerType==="threeLayer"){var a=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(a<n[0]||a>=n[1])||r.render(i)}}this.webglLayer.stateManager.restore()}},{key:"onClick",value:function(i){for(var t=0;t<this.layers.length;t++){var r=this.layers[t];if(r._visible===!0&&r.layerType!=="threeLayer"&&r.layerType!=="ThreeLayer"){var a=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(a<=n[0]||a>=n[1])||!r.options.enablePicked||!r.options.onClick||!r.pick||(a=r.pick(i.x,i.y),r.options.onClick(a,i),r.options.autoSelect&&this.webglLayer.render())}}}},{key:"onDblClick",value:function(i){for(var t=0;t<this.layers.length;t++){var r=this.layers[t];if(r._visible===!0&&r.layerType!=="threeLayer"&&r.layerType!=="ThreeLayer"){var a=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(a<=n[0]||a>=n[1])||!r.options.enablePicked||!r.options.onDblClick||!r.pick||(a=r.pick(i.x,i.y),r.options.onDblClick(a,i),r.options.autoSelect&&this.webglLayer.render())}}}},{key:"onRightClick",value:function(i){for(var t=0;t<this.layers.length;t++){var r=this.layers[t];if(r._visible===!0&&r.layerType!=="threeLayer"&&r.layerType!=="ThreeLayer"){var a=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(a<=n[0]||a>=n[1])||!r.options.enablePicked||!r.options.onRightClick||!r.pick||(a=r.pick(i.x,i.y),r.options.onRightClick(a,i),r.options.autoSelect&&this.webglLayer.render())}}}},{key:"onMousemove",value:function(i){for(var t=!1,r=0;r<this.layers.length;r++){var a=this.layers[r];if(a._visible===!0&&a.layerType!=="threeLayer"&&a.layerType!=="ThreeLayer"){var n=a.map.getZoom(),s=a.getOptions().zoomThreshold;(!s||!(n<=s[0]||n>=s[1]))&&a.options.enablePicked&&a.pick&&(a.options.onMousemove||a.options.autoSelect)&&(n=a.pick(i.x,i.y),this.webglLayer.map.map.platform.style.cursor=n.dataIndex===-1?"default":"pointer",a.options.onMousemove&&a.options.onMousemove(n,i),a.options.autoSelect&&(t=!0))}}t&&(this.webglLayer.isAnimation||this.webglLayer.render())}},{key:"destroy",value:function(){this.destroyAllLayers(),this.removeAllLayers()}}]),e}(),Yn=function(){function e(i){var t=this;O(this,e),this.options={autoUpdate:!0},this._visible=!0,K(this.options,i);var r=i.pointOffset;this.webglLayer=i.webglLayer||new ns(i.map,this.options),this.layerManager=new Cf({autoUpdate:this.options.autoUpdate,webglLayer:this.webglLayer}),this.effectManager=new is(this.webglLayer.gl),this.webglRender={render:function(){}},this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects)),this.webglLayer.onRender(function(a){t._render(a)}),this.webglLayer.onClick=function(a){t._visible&&t.layerManager.onClick(a)},this.webglLayer.onDblClick=function(a){t._visible&&t.layerManager.onDblClick(a)},this.webglLayer.onRightClick=function(a){t._visible&&t.layerManager.onRightClick(a)},this.webglLayer.onMousemove=function(a){t._visible&&t.layerManager.onMousemove(a)},r||this.webglLayer.options.mapType==="cesium"||(r=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[r.lng,r.lat]),this.webglLayer.map.onResize(function(){t.effectManager.onResize()}),(this.postProcessing=i.postProcessing)&&(this.postProcessing.setWebglLayer(this.webglLayer),i=this.postProcessing.getThreeLayer(),this.addLayer(i),this.postProcessing.initialize(i),i.postProcessing=this.postProcessing)}return I(e,[{key:"renderCanvas",value:function(i){var t=this;this.postProcessing?this.postProcessing.addRender(function(){t.layerManager.renderGLLayers(i)}):this.layerManager.renderGLLayers(i),this.layerManager.renderThreeLayers(i),this.layerManager.renderThreeLayer(i)}},{key:"render",value:function(){this.webglLayer&&this.webglLayer.render()}},{key:"_render",value:function(i){var t=this;if(this._visible){var r=this.options.effects;r&&0<r.length?(this.webglRender.render=function(){t.renderCanvas(i)},this.effectManager.render()):(this.webglLayer.saveFramebuffer(),this.renderCanvas(i),this.webglLayer.restoreFramebuffer())}}},{key:"onRender",value:function(i){this.webglLayer.onRender(i)}},{key:"destroy",value:function(){this.stopAnimation(),this.layerManager.destroy(),this.effectManager.destroy(),this.webglLayer.destroy()}},{key:"isRequestAnimation",value:function(){return this.layerManager.isRequestAnimation()}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}},{key:"show",value:function(){this._visible!==!0&&(this._visible=!0,this.webglLayer.render(),this.isRequestAnimation()&&this.startAnimation())}},{key:"hide",value:function(){this._visible!==!1&&(this._visible=!1,this.stopAnimation(),this.webglLayer.clear())}},{key:"showLayer",value:function(i){this.layerManager.showLayer(i)}},{key:"hideLayer",value:function(i){this.layerManager.hideLayer(i)}},{key:"add",value:function(i){this.addLayer(i)}},{key:"remove",value:function(i){this.removeLayer(i)}},{key:"addLayer",value:function(i){this.layerManager.addLayer(i)}},{key:"removeLayer",value:function(i){this.layerManager.removeLayer(i)}},{key:"removeAllLayers",value:function(){this.layerManager.removeAllLayers()}},{key:"getAllLayers",value:function(){return this.layerManager.getAllLayers()}},{key:"getAllThreeLayers",value:function(){return this.layerManager.getAllThreeLayers()}}]),e}(),Zn=function(){function e(i){O(this,e),this._visible=!0,this.options=this.getCommonDefaultOptions(),this.options=K(this.options,this.getDefaultOptions()),this.autoUpdate=!1,this.options=K(this.options,i),this.options.data&&(this.data=this.options.data,delete this.options.data)}return I(e,[{key:"getCommonDefaultOptions",value:function(){return{}}},{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(i){}},{key:"destroy",value:function(){this.onDestroy&&this.onDestroy()}},{key:"show",value:function(){this._visible=!0}},{key:"hide",value:function(){this._visible=!1}},{key:"render",value:function(){}},{key:"clear",value:function(){this.setData([])}},{key:"setData",value:function(i,t){t=t||{},this.data=i,this.onDataChanged&&this.onDataChanged(this.getData()),this.onChanged&&this.onChanged(this.getOptions(),this.getData(),t),t.autoRender!==!1&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",value:function(i,t){i=i||{},t=t||{};var r=K({},this.getOptions());K(this.options,i),this.onOptionsChanged&&this.onOptionsChanged(this.getOptions(),r),this.onChanged&&this.onChanged(this.getOptions(),this.getData(),t),i.data?(this.setData(i.data,t),delete i.data):t.autoRender!==!1&&this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(i,t){}},{key:"onDataChanged",value:function(i){}},{key:"onChanged",value:function(i,t){}},{key:"onDestroy",value:function(){}},{key:"lnglatToMercator",value:function(i,t){}},{key:"setWebglLayer",value:function(i){this.webglLayer=i}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",value:function(){return this.autoUpdate}}]),e}(),rt=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.pickedColor=[-1,-1,-1],t}return Y(i,e),I(i,[{key:"getCommonDefaultOptions",value:function(){return{blend:"default",zIndex:0,zoomThreshold:[0,30],repeat:!1,enablePicked:!1,autoSelect:!1,selectedIndex:-1,selectedColor:"rgba(20, 20, 200, 1.0)"}}},{key:"commonInitialize",value:function(t){var r=this.getOptions();this.gl=t,r.enablePicked&&(this.pickBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}))}},{key:"getCommonAttributes",value:function(){var t=[];return this.getOptions().enablePicked&&t.push({name:"aPickColor",buffer:this.pickBuffer,size:3,type:"FLOAT",stride:12,offset:0}),t}},{key:"getProperty",value:function(t,r,a){return Object.prototype.toString.call(r)==="[object Function]"?r(a):(r=a[t]||r,"properties"in a&&t in a.properties&&(r=a.properties[t]),r)}},{key:"normizedColor",value:function(t){var r=t;return t instanceof Array||(r=mt(t).unitArray()),r[3]===void 0&&(r[3]=1),r}},{key:"normizedPoint",value:function(t){var r=this.getPointOffset();if(!t||!t[0]||!t[1])return[r[0],r[1],0];var a=Number(t[0]),n=Number(t[1]);-180<=a&&180>=a&&-90<=n&&90>=n&&(n=this.webglLayer.map.lnglatToMercator(a,n),a=n[0],n=n[1]);var s=Number(t[2])||0;return this.webglLayer&&this.webglLayer.options.mapType==="cesium"&&window.Cesium?(a=this.convertLngLat([a,n]),s=window.Cesium.Cartesian3.fromDegrees(a[0],a[1],s),a=s.x,n=s.y,s=s.z):this.webglLayer&&this.webglLayer.options.mapType==="bmapgl"&&this.webglLayer.map.map.mapType==="B_EARTH_MAP"&&(a=this.convertLngLat([a,n]),s=this.webglLayer.map.map.getEarth().scene.fromLatLngToXYZ({lng:a[0],lat:a[1]}),a=s.x,n=s.y,s=s.z),3<t.length?[a-r[0],n-r[1],s].concat(Q(t.slice(3))):[a-r[0],n-r[1],s]}},{key:"convertLngLat",value:function(t){return[t[0]/2003750834e-2*180,180/Math.PI*(2*Math.atan(Math.exp(t[1]/2003750834e-2*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){var t=[0,0],r=this.getOptions();return this.webglLayer&&this.webglLayer.options.pointOffset?t=this.webglLayer.options.pointOffset:r.pointOffset&&(t=r.pointOffset),t}},{key:"indexToRgb",value:function(t){t++;var r=Math.floor(t/65536);t-=65536*r;var a=Math.floor(t/256);return[t-256*a,a,r]}},{key:"rgbToIndex",value:function(t){return t[0]+256*t[1]+65536*t[2]-1}},{key:"getCommonUniforms",value:function(t){t=t.isPickRender;var r=this.getOptions(),a={};if(r.enablePicked){var n=0<=r.selectedIndex?r.selectedIndex:-1;n=r.autoSelect?this.pickedColor:this.indexToRgb(n),a=K(a,{uSelectedColor:this.normizedColor(r.selectedColor),uEnablePicked:r.enablePicked,uPickedColor:n.map(function(s){return s/255}),uIsPickRender:!!t})}return a}},{key:"pick",value:function(t,r){var a=this.gl,n=this.webglLayer._dpr;this.webglLayer.saveFramebuffer(),this.webglLayer.bindFramebuffer(this.webglLayer.pickFBO),this.webglLayer.clear(),this.render({gl:a,isPickRender:!0,matrix:this.webglLayer.matrix,projectionMatrix:this.webglLayer.projectionMatrix,viewMatrix:this.webglLayer.viewMatrix,orthoMatrix:this.webglLayer.orthoMatrix});var s=new Uint8Array(4);return a.readPixels(t*n,a.canvas.height-r*n,1,1,a.RGBA,a.UNSIGNED_BYTE,s),t=this.rgbToIndex(s),r=this.getData(),this.pickedColor=[s[0],s[1],s[2]],this.webglLayer.restoreFramebuffer(),{dataIndex:t,dataItem:r[t]}}},{key:"setGLState",value:function(t){this.webglLayer.stateManager.setState(t)}},{key:"addMultipleCoords",value:function(t,r,a){if(!this.options.repeat||!this.webglLayer||this.webglLayer.options.mapType!=="bmapgl"||this.webglLayer.map.map.mapType==="B_EARTH_MAP")return[t];var n=this.webglLayer.map.map;r=r||n.getZoom();var s=a?n.worldSize(r):4007545274461451e-8;if(r=function(d){return[[d[0]-s,d[1],d[2]||0],[d[0]+s,d[1],d[2]||0]]},t instanceof Array&&!(t[0]instanceof Array))return r=r(t),r=nt(r,2),[t,r[0],r[1]];if(t instanceof Array&&t[0]instanceof Array&&!(t[0][0]instanceof Array)){a=[],n=[];for(var o=0;o<t.length;o++){var u=r(t[o]);u=nt(u,2);var h=u[1];a.push(u[0]),n.push(h)}return[t,a,n]}for(a=[],n=[],o=0;o<t.length;o++){u=[],h=[];for(var v=0;v<t[o].length;v++){var l=r(t[o][v]);l=nt(l,2);var f=l[1];u.push(l[0]),h.push(f)}a.push(u),n.push(h)}return[t,a,n]}}]),i}(Zn),Sf=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.name="CircleLayer",t.bufferData=[],t.initializeTime=new Date,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!0,depthTest:!0,size:10,unit:"px",color:"blue",borderWidth:0,borderColor:"#000000",antialias:!0}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.program=new q(this.gl,{vertexShader:`attribute vec3 aPos;attribute float aSize;attribute float aIndex;attribute vec4 aColor;attribute float aBorderWidth;attribute vec4 aBorderColor;varying vec4 vColor;varying vec3 vPosition;varying vec3 vFragPosition;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vBorderWidth=aBorderWidth*uZoomUnits;vBorderColor=aBorderColor;float x=aPos.x;float y=aPos.y;float z=aPos.z*uZoomUnits;vSize=aSize*uZoomUnits+vBorderWidth;if(aIndex==1.0){x+=vSize;y-=vSize;}else if(aIndex==2.0){x-=vSize;y+=vSize;}else if(aIndex==3.0){x+=vSize;y+=vSize;}else{x-=vSize;y-=vSize;}vPosition=aPos;vFragPosition=vec3(x,y,z);gl_Position=uMatrix*vec4(vFragPosition,1.0);
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,fragmentShader:"varying vec3 vPosition;varying float vSize;varying vec3 vFragPosition;varying vec4 vColor;varying float vBorderWidth;varying vec4 vBorderColor;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float lineWidth;uniform float uAntiAliasing;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>vSize){discard;}vec4 color=vColor;float r=vSize-vBorderWidth;if(vBorderWidth>0.0){if(d>r){color=vBorderColor;}else if(uAntiAliasing==1.0&&d>0.95*r){color=vBorderColor;float st=1.0-smoothstep(0.95*r,r,d);color.r+=(vColor.r-vBorderColor.r)*st;color.g+=(vColor.g-vBorderColor.g)*st;color.b+=(vColor.b-vBorderColor.b)*st;color.a+=(vColor.a-vBorderColor.a)*st;}}if(uAntiAliasing==1.0&&d>0.95*vSize&&d<=vSize){color.a*=1.0-smoothstep(0.95*vSize,vSize,d);}gl_FragColor=color;}",defines:r.enablePicked?["PICK"]:[]},this),this.buffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=Float32Array.BYTES_PER_ELEMENT;var a=14*r;r=[{stride:a,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:a,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:3*r},{stride:a,name:"aIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:4*r},{stride:a,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:5*r},{stride:a,name:"aBorderWidth",buffer:this.buffer,size:1,type:"FLOAT",offset:9*r},{stride:a,name:"aBorderColor",buffer:this.buffer,size:4,type:"FLOAT",offset:10*r}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onChanged",value:function(t,r){this.gl&&r&&(this.uniforms={},this.data=r,this.processData(),t.enablePicked&&this.parsePickData(r))}},{key:"processData",value:function(){var t=this,r=[],a=[];this.data.forEach(function(n,s){var o=n.properties||{},u=function(c){return n[c]||o[c]||t.options[c]},h=u("color"),v=u("size"),l=u("borderWidth");u=u("borderColor"),h=t.normizedColor(h),u=t.normizedColor(u);for(var f=t.normizedPoint(n.geometry.coordinates),d=0;4>d;d++)r.push(f[0],f[1],f[2]||0,v,d),r.push(h[0],h[1],h[2],h[3]),r.push(l,u[0],u[1],u[2],u[3]);h=4*s,0<s&&a.push(h-1,h),a.push(h,h+1,h+2,h+3)}),this.bufferData=r,this.indexData=a,this.buffer.updateData(new Float32Array(r)),this.indexBuffer.updateData(new Uint32Array(a))}},{key:"parsePickData",value:function(t){var r=[];if(this.getOptions().enablePicked){for(var a=0;a<t.length;a++){var n=this.indexToRgb(a);r.push(n[0]/255,n[1]/255,n[2]/255),r.push(n[0]/255,n[1]/255,n[2]/255),r.push(n[0]/255,n[1]/255,n[2]/255),r.push(n[0]/255,n[1]/255,n[2]/255)}this.pickBuffer.updateData(new Float32Array(r))}}},{key:"render",value:function(t){var r=this.getOptions(),a=this.program,n=t.gl,s=t.matrix;this.setGLState({blend:!0,blendEquation:n.FUNC_ADD,blendFunc:se(n,r.blend||"lighter"),depthTest:r.depthTest,depthMask:r.depthWrite}),a.use(n),this.vertexArray.bind(),this.indexBuffer.bind(),r=this.map.getZoomUnits(),K(this.uniforms,this.getCommonUniforms(t),{uZoomUnits:this.options.unit==="px"?r:1,uMatrix:s,uAntiAliasing:this.options.antialias?1:0}),a.setUniforms(this.uniforms),n.drawElements(n.TRIANGLE_STRIP,this.indexData.length,n.UNSIGNED_INT,0)}}]),i}(rt),os={wave:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}vec4 color=vColor;float R=vRadius;float center=vSize;float time=vStartTime+uTime;float alpha=sin((R-d)/R*trail*2.0*3.14+time/duration);if(d<=center){if(uAntiAliasing==1.0&&d>0.9*center&&d<=center){if(alpha>=0.5){color.a=0.9;}else{color.a=1.0-smoothstep(0.9*center,center,d);}}}else{if(alpha>=0.5){color.a=0.9;if(uAntiAliasing==1.0){if(alpha>=0.5&&alpha<=0.6){color.a*=smoothstep(0.0,0.1,alpha-0.5);}if(d>=0.98*R&&d<=R){color.a*=1.0-smoothstep(0.98,1.0,d/R);}}}else{color.a=0.0;}}gl_FragColor=color;}",bubble:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}float time=vStartTime+uTime;float range=mod(time,(duration+trail));float percent=0.0;if(range<=duration){percent=range/duration;}else{percent=1.0;}float center=vSize;float R=vRadius;float r=R*percent;vec4 color=vColor;if(d<=center){if(uAntiAliasing==1.0&&d>0.9*center&&d<=center){color.a=1.0-smoothstep(0.9*center,center,d);}}else{if(d<r){color.a=smoothstep(0.1,0.9,pow(d/r,2.0)*0.9);if(uAntiAliasing==1.0&&d>=0.9*r&&d<=r){color.a*=1.0-smoothstep(0.9,1.0,d/r);}if(range>duration){color.a*=1.0-(range-duration)/trail;}}else{color.a=0.0;}}gl_FragColor=color;}",breath:"varying vec4 vPosition;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}vec4 color=vColor;if(uAntiAliasing==1.0&&d>0.9*vRadius&&d<=vRadius){color.a=1.0-smoothstep(0.9*vRadius,vRadius,d);}float time=vStartTime+uTime;float range=mod(time,(duration+trail));float percent=0.0;if(range<=duration){percent=range/duration;}else{percent=1.0;}color.a*=abs(1.0-percent*2.0)+0.2;gl_FragColor=color;}",radar:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}float time=vStartTime+uTime;float range=mod(time,duration);float percent=range/duration;float center=vSize;float startDeg=360.0*percent;vec4 color=vColor;float deltaX=vFragPosition.x-vPosition.x;float deltaY=vFragPosition.y-vPosition.y;float currDeg=degrees(atan(deltaX/deltaY));if(deltaX>=0.0&&deltaY<=0.0){currDeg=180.0+currDeg;}if(deltaX<=0.0&&deltaY<=0.0){currDeg=180.0+currDeg;}if(deltaX<=0.0&&deltaY>=0.0){currDeg=360.0+currDeg;}float maxDeg=trail;if(trail<0.0){currDeg=-currDeg;maxDeg=-trail;}float modDeg=mod((currDeg-startDeg),360.0);if(modDeg<maxDeg){color.a=modDeg/maxDeg;}else{color.a=0.0;}if(uAntiAliasing==1.0&&d>0.95*vRadius&&d<=vRadius){color.a=color.a-smoothstep(0.95*vRadius,vRadius,d);}gl_FragColor=color;}"},Pf=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.name="RippleCircleLayer",t.autoUpdate=!0,t.bufferData=[],t.initializeTime=new Date,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){var t=1;return this.options.type==="radar"&&(t=120),{depthWrite:!1,depthTest:!0,type:"bubble",size:10,duration:1,trail:t,unit:"px",random:!0,color:"blue",antialias:!0,radius:function(r){return 2*r}}}},{key:"initialize",value:function(t){this.gl=t,this.program=new q(this.gl,{vertexShader:`attribute vec3 aPos;attribute float aSize;attribute float aIndex;attribute vec4 aColor;attribute float aStartTime;attribute float aRadius;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vWidth;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vStartTime=aStartTime;vSize=aSize*uZoomUnits;vRadius=aRadius*uZoomUnits;float x=aPos.x;float y=aPos.y;float z=aPos.z*uZoomUnits;float R=vRadius;if(aIndex==1.0){x+=R;y-=R;}else if(aIndex==2.0){x-=R;y+=R;}else if(aIndex==3.0){x+=R;y+=R;}else{x-=R;y-=R;}vPosition=vec4(aPos.xy,z,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,fragmentShader:os[this.options.type]||"bubble",defines:this.options.enablePicked?["PICK"]:[]},this),this.buffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var r=[{stride:44,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:44,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:12},{stride:44,name:"aIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:16},{stride:44,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:20},{stride:44,name:"aRadius",buffer:this.buffer,size:1,type:"FLOAT",offset:36},{stride:44,name:"aStartTime",buffer:this.buffer,size:1,type:"FLOAT",offset:40}];r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onChanged",value:function(t,r){this.gl&&r&&(this.uniforms={duration:t.duration,trail:t.trail},this.data=r,this.processData(),t.enablePicked&&this.parsePickData(r))}},{key:"processData",value:function(){var t=this,r=[],a=[];this.data.forEach(function(n,s){var o=n.size||t.options.size,u=n.radius||t.options.radius||1.618*o;typeof u=="function"&&(u=u(o));var h=n.color||t.options.color;h=t.normizedColor(h),n=t.normizedPoint(n.geometry.coordinates);for(var v=t.options.random?Math.random()*t.data.length*9999:0,l=0;4>l;l++)r.push(n[0],n[1],n[2]||0,o,l),r.push(h[0],h[1],h[2],h[3]),r.push(u),r.push(v);o=4*s,0<s&&a.push(o-1,o),a.push(o,o+1,o+2,o+3)}),this.bufferData=r,this.indexData=a,this.buffer.updateData(new Float32Array(r)),this.indexBuffer.updateData(new Uint32Array(a))}},{key:"parsePickData",value:function(t){var r=[];if(this.getOptions().enablePicked){for(var a=0;a<t.length;a++){var n=this.indexToRgb(a);r.push(n[0]/255,n[1]/255,n[2]/255),r.push(n[0]/255,n[1]/255,n[2]/255),r.push(n[0]/255,n[1]/255,n[2]/255),r.push(n[0]/255,n[1]/255,n[2]/255)}this.pickBuffer.updateData(new Float32Array(r))}}},{key:"render",value:function(t){var r=this.getOptions(),a=this.program,n=t.gl,s=t.matrix;a.use(n);var o=this.map.getZoomUnits();K(this.uniforms,this.getCommonUniforms(t),{uTime:(new Date-this.initializeTime)/1e3,uZoomUnits:r.unit==="m"?1:o,uMatrix:s,uAntiAliasing:r.antialias?1:0}),a.setUniforms(this.uniforms),this.setGLState({blend:!0,blendEquation:n.FUNC_ADD,blendFunc:[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA],depthTest:r.depthTest,depthMask:r.depthWrite}),0<this.indexData.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),n.drawElements(n.TRIANGLE_STRIP,this.indexData.length,n.UNSIGNED_INT,0))}}]),i}(rt),Ef=yt(os),Rf=V(function(e,i){i.__esModule=!0;var t=_r&&_r.__esModule?_r:{default:_r},r=Rr&&Rr.__esModule?Rr:{default:Rr};i.default=function a(n,s,o){n===null&&(n=Function.prototype);var u=(0,r.default)(n,s);if(u===void 0){if(n=(0,t.default)(n),n!==null)return a(n,s,o)}else return"value"in u?u.value:(s=u.get,s===void 0?void 0:s.call(o))}}),ve=tt(Rf);jt.deviation=function(e,i,t,r){var a=i&&i.length,n=Math.abs(nn(e,0,a?i[0]*t:e.length,t));if(a){a=0;for(var s=i.length;a<s;a++)n-=Math.abs(nn(e,i[a]*t,a<s-1?i[a+1]*t:e.length,t))}for(a=i=0;a<r.length;a+=3){s=r[a]*t;var o=r[a+1]*t,u=r[a+2]*t;i+=Math.abs((e[s]-e[u])*(e[o+1]-e[s+1])-(e[s]-e[o])*(e[u+1]-e[s+1]))}return n===0&&i===0?0:Math.abs((i-n)/n)},jt.flatten=function(e){for(var i=e[0][0].length,t={vertices:[],holes:[],dimensions:i},r=0,a=0;a<e.length;a++){for(var n=0;n<e[a].length;n++)for(var s=0;s<i;s++)t.vertices.push(e[a][n][s]);0<a&&(r+=e[a-1].length,t.holes.push(r))}return t},jt.default=jt;var as=typeof na=="undefined"?"__target":na(),Lf=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,zi=window.URL||window.webkitURL,ar=window.Worker;if(ar){var ss=To("self.onmessage = function () {}"),us=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");var Vn=new ar(ss);Vn.postMessage(us,[us.buffer])}catch(e){ar=null}finally{zi.revokeObjectURL(ss),Vn&&Vn.terminate()}}var Ff=new function(e,i){return function(t){var r=this;if(i){if(ar&&!t)return t=(""+i).replace(/^function.+?{/,"").slice(0,-1),t=To(t),this[as]=new ar(t),zi.revokeObjectURL(t),this[as];var a={postMessage:function(n){r.onmessage&&setTimeout(function(){return r.onmessage({data:n,target:a})})}};i.call(a),this.postMessage=function(n){setTimeout(function(){return a.onmessage({data:n,target:r})})},this.isThisThread=!0}else return new ar(e)}}("./worker.js",function(e,i){}),ls={window:1,windowAnimation:2,gradual:3,ripple:4,water:6},Ii=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="ShapeLayer",t._isShow=!0,r=t.getOptions(),(r.style==="windowAnimation"||r.style==="ripple"||0<r.riseTime)&&(t.autoUpdate=!0),t.selectedColor=[-1,-1,-1],t.textureCache={},t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:"rgba(50, 50, 230, 1.0)",opacity:.8,height:0,isTextureFull:!1,topColor:"rgba(76, 76, 76, 0.8)",textureRotate:0,textureScale:1,useLight:!0,useTopColor:!1,riseTime:0,polygonOffset:[0,0],depthTest:!0,zIndex:0}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.dataMgr=new ze(this,this.gl),this.texture=null,this.isUseTexture=!1;var a=[];r.enablePicked&&a.push("PICK"),r.texture&&a.push("USE_TEXTURE"),this.program=new q(this.gl,{vertexShader:`precision highp float;uniform vec4 uSelectedColor;attribute vec4 a_pos;attribute vec3 a_normal;attribute vec4 a_color;attribute vec4 a_pre_color;attribute float a_height;attribute float a_pre_height;
#if defined(USE_TEXTURE)
attribute vec2 a_texture_coord;
#endif
uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float dataTime;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;uniform float u_zIndex;varying float v_height;varying vec4 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.8,0.8,0.8);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);float getTransitionValue(float pre_value,float to_value,float dataTime,float riseTime){float result=0.0;if(pre_value==to_value){result=to_value;}else{if(riseTime>0.0&&dataTime<riseTime){result=(pre_value+(to_value-pre_value)*(dataTime/riseTime));}else{result=to_value;}}return result;}void main(){vec4 pos=a_pos;pos.z=pos.z+pos.w*getTransitionValue(a_pre_height,a_height,dataTime,riseTime);v_position=pos.xyz;v_height=a_height;
#if defined(USE_TEXTURE)
if(u_use_texture){v_texture_coord=a_texture_coord;}
#endif
pos.z+=u_zIndex;vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos.xyz,1.0);gl_Position=position;vec4 icolor=a_color;
#if defined(PICK)
if(mapvIsPicked()){icolor=uSelectedColor;}
#endif
if(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));if(a_pre_color.r==a_color.r&&a_pre_color.g==a_color.g&&a_pre_color.b==a_color.b){}else{if(riseTime>0.0&&dataTime<riseTime){icolor.r=a_pre_color.r+(a_color.r-a_pre_color.r)*(dataTime/riseTime);icolor.g=a_pre_color.g+(a_color.g-a_pre_color.g)*(dataTime/riseTime);icolor.b=a_pre_color.b+(a_color.b-a_pre_color.b)*(dataTime/riseTime);}}v_color.rgb=icolor.rgb+icolor.rgb*light_color*lambert+icolor.rgb*light_color_2*lambert_2+icolor.rgb*point_color*lambert_point;v_color.a=icolor.a;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec4 vLightWeighting;vLightWeighting=vec4(uAmbientColor+uDirectionalColor*directionalLightWeighting,1.0);v_color=vLightWeighting;}}else{v_color=icolor;}}`,fragmentShader:"precision highp float;varying vec4 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec4 top_color;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;uniform bool u_use_top_color;void main(){vec4 color=vec4(v_color);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){if(style==6.0){float x=v_texture_coord.s;float y=v_texture_coord.t;vec2 cPos=-1.0+2.0*gl_FragCoord.xy/MAPV_resolution;float cLength=length(cPos);vec2 uv=gl_FragCoord.xy/MAPV_resolution+(cPos/cLength)*cos(cLength*12.0-time/1000.0*4.0)*0.03;textureColor=texture2D(u_sampler,uv/2.0+vec2(x,y));}else{textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));}if(u_use_lighting){color=vec4(textureColor*v_color*1.1);}else{color=textureColor;}}if(u_use_top_color&&v_position.z>=v_height){color=top_color;}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}else if(style==6.0){}gl_FragColor=color;}",defines:a},this),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.heightBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.textureBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),a=[{name:"a_pos",buffer:this.vertexBuffer,stride:28,size:4,type:"FLOAT",offset:0},{name:"a_normal",buffer:this.vertexBuffer,size:3,stride:28,type:"FLOAT",offset:16},{name:"a_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:0},{name:"a_pre_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:16},{name:"a_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:0},{name:"a_pre_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:4}],r.texture&&a.push({name:"a_texture_coord",buffer:this.textureBuffer,size:2,stride:8,type:"FLOAT",offset:0}),a=a.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:a}),this.initializeTime=new Date,this.normalMatrix=z.create()}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){var a=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){a.loadTexture(function(){a.dataMgr.parseData(r),a.dataTime=new Date,a.webglLayer.render()})},0))}},{key:"render",value:function(t){var r=t.gl,a=t.projectionMatrix,n=t.viewMatrix;if(this._isShow){var s=this.getData();if(s&&!(0>=s.length)){s=this.getOptions();var o=this.program;if(o.use(r),!s.texture||this.texture){var u=0;s.style&&ls[s.style]&&(u=ls[s.style]);var h=[r.ONE,r.ZERO];if(s.blend&&(h=se(r,s.blend)),(s.height===0||s.style==="gradual")&&(h=[r.ONE,r.ONE_MINUS_SRC_ALPHA]),this.setGLState({cullFace:!1,blend:!0,blendEquation:r.FUNC_ADD,blendFunc:h,polygonOffset:s.polygonOffset,depthTest:s.depthTest,depthMask:s.style!=="gradual"}),h=this.normizedColor(s.topColor),s.style==="ripple"&&s.rippleLayer&&s.rippleLayer.data&&s.rippleLayer.data[0]){var v=this.normizedPoint(s.rippleLayer.data[0].geometry.coordinates);o.setUniforms({u_ripple_center:[v[0],v[1],0],u_radius:s.rippleLayer.options.size*s.rippleLayer.currentScale})}v=j.fromValues(0,-1,2),s.lightDir&&(v=j.fromValues(s.lightDir[0],s.lightDir[1],s.lightDir[2]));var l=this.normalMatrix;z.invert(l,n),z.transpose(l,l),o.setUniforms(K(this.getCommonUniforms(t),{u_normal_matrix:l,u_sampler:this.texture,u_proj_matrix:a,u_mv_matrix:n,style:u,u_use_top_color:s.useTopColor,top_color:h,u_use_lighting:s.useLight,u_use_texture:this.isUseTexture,alpha:s.opacity===void 0?.8:parseFloat(s.opacity),time:new Date-this.initializeTime,dataTime:new Date-this.dataTime,riseTime:s.riseTime,u_side_light_dir:v,u_zIndex:s.zIndex})),t=this.dataMgr.getData(),0<t.vertex.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),r.drawElements(r.TRIANGLES,t.index.length,r.UNSIGNED_INT,0))}}}else this.webglLayer.clear()}},{key:"loadTexture",value:function(t){var r=this,a=this.getOptions();a.texture?(this.isUseTexture=!0,Pt(this.gl,a.texture,function(n,s){r.image=s,r.texture=n,t&&t(),r.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),i}(rt);ze.prototype.initData=function(){this.outBuilding3d={pickColorVertex:[],vertex:[],texture:[],color:[],height:[],index:[]}},ze.prototype.getData=function(){return this.outBuilding3d},ze.prototype.initWorker=function(){this.worker=new Ff,this.worker.onmessage=function(e){}},ze.prototype.parseData=function(e){var i=this;this.initData();for(var t=this.shapeLayer.getOptions(),r=0;r<e.length;r++){var a=e[r],n=a.height||t.height;"properties"in a&&"height"in a.properties&&(n=a.properties.height),n*=1;var s=a.color||t.color;"properties"in a&&"color"in a.properties&&(s=a.properties.color),"properties"in a&&"fillColor"in a.properties&&(s=a.properties.fillColor),Object.prototype.toString.call(s)==="[object Function]"&&(s=s(a)),s=this.shapeLayer.normizedColor(s);var o=this.shapeLayer.getProperty("angle",t.textureRotate,a),u=void 0;t.enablePicked&&(u=this.shapeLayer.indexToRgb(r));var h=void 0,v=void 0;if(t.riseTime&&(v=a.preColor,"properties"in a&&"preColor"in a.properties&&(v=a.properties.preColor),h=a.preHeight,"properties"in a&&"preHeight"in a.properties&&(h=a.properties.preHeight),h===void 0&&(h=0)),a.geometry.coordinates){if(a.geometry.type==="LineString"){var l=a.geometry.coordinates.map(function(g){return i.shapeLayer.normizedPoint(g)}),f=jt.flatten([l]);l=f.vertices,f=f.holes;for(var d=[],c=[],p=0;p<l.length;p+=3)d.push(l[p+0],l[p+1]),c.push(l[p+2]);this.parseBuilding3d(this.outBuilding3d,d,c,h,n,v,s,u,o,f)}if(a.geometry.type==="MultiPolygon"){for(l=a.geometry.coordinates,a=[],f=0;f<l.length;f++)a.push(l[f].map(function(g){return g.map(function(x){return i.shapeLayer.normizedPoint(x)})}));for(l=0;l<a.length;l++){f=[],d=[],p=jt.flatten(a[l]),c=p.vertices,p=p.holes;for(var m=0;m<c.length;m+=3)f.push(c[m+0],c[m+1]),d.push(c[m+2]);this.parseBuilding3d(this.outBuilding3d,f,d,h,n,v,s,u,o,p)}}else{for(l=[],f=0;f<a.geometry.coordinates.length;f++)l.push(a.geometry.coordinates[f].map(function(g){return i.shapeLayer.normizedPoint(g)}));for(l=jt.flatten(l),a=l.vertices,l=l.holes,f=[],d=[],c=0;c<a.length;c+=3)f.push(a[c+0],a[c+1]),d.push(a[c+2]);this.parseBuilding3d(this.outBuilding3d,f,d,h,n,v,s,u,o,l)}}}this.shapeLayer.vertexBuffer.updateData(new Float32Array(this.outBuilding3d.vertex)),this.shapeLayer.colorBuffer.updateData(new Float32Array(this.outBuilding3d.color)),this.shapeLayer.heightBuffer.updateData(new Float32Array(this.outBuilding3d.height)),this.shapeLayer.textureBuffer.updateData(new Float32Array(this.outBuilding3d.texture)),this.shapeLayer.indexBuffer.updateData(new Uint32Array(this.outBuilding3d.index)),t.enablePicked&&this.shapeLayer.pickBuffer.updateData(new Float32Array(this.outBuilding3d.pickColorVertex))},ze.prototype.getBounds=function(e,i){for(var t=e[0],r=e[1],a=e[0],n=e[1],s=0;s<e.length;s+=2)t=Math.min(e[s],t),r=Math.min(e[s+1],r),a=Math.max(e[s],a),n=Math.max(e[s+1],n);if(s=[(a-t)/2+t,(n-r)/2+r],i===0||!i)return{minX:t,minY:r,maxX:a,maxY:n,width:a-t,height:n-r,center:s};for(t=e.slice(0),r=0;r<t.length;r+=2)a=wo(e[r],e[r+1],s,i),t[r]=a[0],t[r+1]=a[1];return this.getBounds(t,0)},ze.prototype.parseBuilding3d=function(e,i,t,r,a,n,s,o,u,h){r===void 0&&(r=a);var v=this.shapeLayer.options,l=e.vertex,f=e.texture,d=e.color,c=e.height,p=e.pickColorVertex;e=e.index,n===void 0&&(n=s);var m=0,g=0;if(this.shapeLayer.image&&(m=this.shapeLayer.image.width*v.textureScale,g=this.shapeLayer.image.height*v.textureScale),v.style!=="gradual"){h=h&&h.length?jt(i,h,2):jt(i);var x=h[0],y=h[1],_=h[2];x=[i[2*x],i[2*x+1],1],y=[i[2*y],i[2*y+1],1];var A=[i[2*_],i[2*_+1],1];_=[],j.cross(_,[A[0]-y[0],A[1]-y[1],A[2]-y[2]],[x[0]-y[0],x[1]-y[1],x[2]-y[2]]),y=l.length/7;var T;v.texture&&(T=this.getBounds(i,u)),x=v.isTextureFull,A=0;for(var w=i.length;A<w;A+=2){if(l.push(i[A],i[A+1],t[A/2],1,_[0],_[1],_[2]),d.push(s[0],s[1],s[2],s[3],n[0],n[1],n[2],n[3]),c.push(a,r),v.texture){var C=wo(i[A],i[A+1],T.center,u),M=nt(C,2);C=M[0],M=M[1],x?(C=(C-T.minX)/T.width,M=(M-T.minY)/T.height):(C=(C-T.minX)/m,M=(M-T.minY)/g),f.push(C,M)}o&&p.push(o[0]/255,o[1]/255,o[2]/255)}for(u=0,T=h.length;u<T;u++)e.push(h[u]+y)}if(!(a===r&&0>=a))for(u=0,h=i.length;u<h;u+=2)T=l.length/7,w=i[u],C=i[u+1],_=[w,C,t[u/2],0],y=[w,C,t[u/2],1],A=u+2,M=u+3,u===h-2&&(A=0,M=1),A=i[A],M=i[M],w=Math.sqrt(Math.pow(A-w,2),Math.pow(M-C,2)),C=[A,M,t[u/2],0],A=[A,M,t[u/2],1],M=[],j.cross(M,[C[0]-_[0],C[1]-_[1],C[2]-_[2]],[y[0]-_[0],y[1]-_[1],y[2]-_[2]]),l.push(_[0],_[1],_[2],_[3]),l.push(M[0],M[1],M[2]),l.push(y[0],y[1],y[2],y[3]),l.push(M[0],M[1],M[2]),l.push(C[0],C[1],C[2],C[3]),l.push(M[0],M[1],M[2]),l.push(A[0],A[1],A[2],A[3]),l.push(M[0],M[1],M[2]),d.push(s[0],s[1],s[2],s[3]),d.push(n[0],n[1],n[2],n[3]),d.push(s[0],s[1],s[2],s[3]),d.push(n[0],n[1],n[2],n[3]),d.push(s[0],s[1],s[2],s[3]),d.push(n[0],n[1],n[2],n[3]),d.push(s[0],s[1],s[2],s[3]),d.push(n[0],n[1],n[2],n[3]),c.push(a),c.push(r),c.push(a),c.push(r),c.push(a),c.push(r),c.push(a),c.push(r),v.texture&&(x?(f.push(0,0),f.push(0,1),f.push(1,0),f.push(1,1)):(f.push(0,0),f.push(0,a/g),f.push(w/m,0),f.push(w/m,a/g))),o&&(p.push(o[0]/255,o[1]/255,o[2]/255),p.push(o[0]/255,o[1]/255,o[2]/255),p.push(o[0]/255,o[1]/255,o[2]/255),p.push(o[0]/255,o[1]/255,o[2]/255)),e.push(T,T+2,T+3,T,T+3,T+1)};var sr=V(function(e,i){(function(t,r){e.exports=r()})(Ro,function(){function t(g,x,y,_,A){for(;_>y;){if(600<_-y){var T=_-y+1,w=x-y+1,C=Math.log(T),M=.5*Math.exp(2*C/3);C=.5*Math.sqrt(C*M*(T-M)/T)*(0>w-T/2?-1:1),t(g,x,Math.max(y,Math.floor(x-w*M/T+C)),Math.min(_,Math.floor(x+(T-w)*M/T+C)),A)}for(T=g[x],w=y,M=_,r(g,y,x),0<A(g[_],T)&&r(g,y,_);w<M;){for(r(g,w,M),w++,M--;0>A(g[w],T);)w++;for(;0<A(g[M],T);)M--}A(g[y],T)===0?r(g,y,M):(M++,r(g,M,_)),M<=x&&(y=M+1),x<=M&&(_=M-1)}}function r(g,x,y){var _=g[x];g[x]=g[y],g[y]=_}function a(g,x){return g<x?-1:g>x?1:0}function n(g,x){s(g,0,g.children.length,x,g)}function s(g,x,y,_,A){for(A||(A=c(null)),A.minX=1/0,A.minY=1/0,A.maxX=-1/0,A.maxY=-1/0;x<y;x++){var T=g.children[x];o(A,g.leaf?_(T):T)}return A}function o(g,x){return g.minX=Math.min(g.minX,x.minX),g.minY=Math.min(g.minY,x.minY),g.maxX=Math.max(g.maxX,x.maxX),g.maxY=Math.max(g.maxY,x.maxY),g}function u(g,x){return g.minX-x.minX}function h(g,x){return g.minY-x.minY}function v(g){return(g.maxX-g.minX)*(g.maxY-g.minY)}function l(g){return g.maxX-g.minX+(g.maxY-g.minY)}function f(g,x){return g.minX<=x.minX&&g.minY<=x.minY&&x.maxX<=g.maxX&&x.maxY<=g.maxY}function d(g,x){return x.minX<=g.maxX&&x.minY<=g.maxY&&x.maxX>=g.minX&&x.maxY>=g.minY}function c(g){return{children:g,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function p(g,x,y,_,A){for(var T=[x,y];T.length;)if(y=T.pop(),x=T.pop(),!(y-x<=_)){var w=x+Math.ceil((y-x)/_/2)*_;t(g,w,x||0,y||g.length-1,A||a),T.push(x,w,w,y)}}var m=function(g){g===void 0&&(g=9),this._maxEntries=Math.max(4,g),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};return m.prototype.all=function(){return this._all(this.data,[])},m.prototype.search=function(g){var x=this.data,y=[];if(!d(g,x))return y;for(var _=this.toBBox,A=[];x;){for(var T=0;T<x.children.length;T++){var w=x.children[T],C=x.leaf?_(w):w;d(g,C)&&(x.leaf?y.push(w):f(g,C)?this._all(w,y):A.push(w))}x=A.pop()}return y},m.prototype.collides=function(g){var x=this.data;if(!d(g,x))return!1;for(var y=[];x;){for(var _=0;_<x.children.length;_++){var A=x.children[_],T=x.leaf?this.toBBox(A):A;if(d(g,T)){if(x.leaf||f(g,T))return!0;y.push(A)}}x=y.pop()}return!1},m.prototype.load=function(g){if(!g||!g.length)return this;if(g.length<this._minEntries){for(var x=0;x<g.length;x++)this.insert(g[x]);return this}return g=this._build(g.slice(),0,g.length-1,0),this.data.children.length?this.data.height===g.height?this._splitRoot(this.data,g):(this.data.height<g.height&&(x=this.data,this.data=g,g=x),this._insert(g,this.data.height-g.height-1,!0)):this.data=g,this},m.prototype.insert=function(g){return g&&this._insert(g,this.data.height-1),this},m.prototype.clear=function(){return this.data=c([]),this},m.prototype.remove=function(g,x){if(!g)return this;for(var y=this.data,_=this.toBBox(g),A=[],T=[],w,C,M;y||A.length;){if(y||(y=A.pop(),C=A[A.length-1],w=T.pop(),M=!0),y.leaf){t:{var E=g,P=y.children,L=x;if(L){for(var R=0;R<P.length;R++)if(L(E,P[R])){E=R;break t}E=-1}else E=P.indexOf(E)}if(E!==-1){y.children.splice(E,1),A.push(y),this._condense(A);break}}M||y.leaf||!f(y,_)?C?(w++,y=C.children[w],M=!1):y=null:(A.push(y),T.push(w),w=0,C=y,y=y.children[0])}return this},m.prototype.toBBox=function(g){return g},m.prototype.compareMinX=function(g,x){return g.minX-x.minX},m.prototype.compareMinY=function(g,x){return g.minY-x.minY},m.prototype.toJSON=function(){return this.data},m.prototype.fromJSON=function(g){return this.data=g,this},m.prototype._all=function(g,x){for(var y=[];g;)g.leaf?x.push.apply(x,g.children):y.push.apply(y,g.children),g=y.pop();return x},m.prototype._build=function(g,x,y,_){var A=y-x+1,T=this._maxEntries;if(A<=T){var w=c(g.slice(x,y+1));return n(w,this.toBBox),w}for(_||(_=Math.ceil(Math.log(A)/Math.log(T)),T=Math.ceil(A/Math.pow(T,_-1))),w=c([]),w.leaf=!1,w.height=_,A=Math.ceil(A/T),T=A*Math.ceil(Math.sqrt(T)),p(g,x,y,T,this.compareMinX);x<=y;x+=T){var C=Math.min(x+T-1,y);p(g,x,C,A,this.compareMinY);for(var M=x;M<=C;M+=A)w.children.push(this._build(g,M,Math.min(M+A-1,C),_-1))}return n(w,this.toBBox),w},m.prototype._chooseSubtree=function(g,x,y,_){for(;_.push(x),!(x.leaf||_.length-1===y);){for(var A=1/0,T=1/0,w=void 0,C=0;C<x.children.length;C++){var M=x.children[C],E=v(M),P=(Math.max(M.maxX,g.maxX)-Math.min(M.minX,g.minX))*(Math.max(M.maxY,g.maxY)-Math.min(M.minY,g.minY))-E;P<T?(T=P,A=E<A?E:A,w=M):P===T&&E<A&&(A=E,w=M)}x=w||x.children[0]}return x},m.prototype._insert=function(g,x,y){y=y?g:this.toBBox(g);var _=[],A=this._chooseSubtree(y,this.data,x,_);for(A.children.push(g),o(A,y);0<=x&&_[x].children.length>this._maxEntries;)this._split(_,x),x--;this._adjustParentBBoxes(y,_,x)},m.prototype._split=function(g,x){var y=g[x],_=y.children.length,A=this._minEntries;this._chooseSplitAxis(y,A,_),_=this._chooseSplitIndex(y,A,_),_=c(y.children.splice(_,y.children.length-_)),_.height=y.height,_.leaf=y.leaf,n(y,this.toBBox),n(_,this.toBBox),x?g[x-1].children.push(_):this._splitRoot(y,_)},m.prototype._splitRoot=function(g,x){this.data=c([g,x]),this.data.height=g.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},m.prototype._chooseSplitIndex=function(g,x,y){for(var _,A=1/0,T=1/0,w=x;w<=y-x;w++){var C=s(g,0,w,this.toBBox),M=s(g,w,y,this.toBBox),E=Math.max(0,Math.min(C.maxX,M.maxX)-Math.max(C.minX,M.minX))*Math.max(0,Math.min(C.maxY,M.maxY)-Math.max(C.minY,M.minY));C=v(C)+v(M),E<A?(A=E,_=w,T=C<T?C:T):E===A&&C<T&&(T=C,_=w)}return _||y-x},m.prototype._chooseSplitAxis=function(g,x,y){var _=g.leaf?this.compareMinX:u,A=g.leaf?this.compareMinY:h,T=this._allDistMargin(g,x,y,_);x=this._allDistMargin(g,x,y,A),T<x&&g.children.sort(_)},m.prototype._allDistMargin=function(g,x,y,_){g.children.sort(_),_=this.toBBox;for(var A=s(g,0,x,_),T=s(g,y-x,y,_),w=l(A)+l(T),C=x;C<y-x;C++){var M=g.children[C];o(A,g.leaf?_(M):M),w+=l(A)}for(y=y-x-1;y>=x;y--)A=g.children[y],o(T,g.leaf?_(A):A),w+=l(T);return w},m.prototype._adjustParentBBoxes=function(g,x,y){for(;0<=y;y--)o(x[y],g)},m.prototype._condense=function(g){for(var x=g.length-1,y;0<=x;x--)g[x].children.length===0?0<x?(y=g[x-1].children,y.splice(y.indexOf(g[x]),1)):this.clear():n(g[x],this.toBBox)},m})}),Yr=function(e){function i(t){O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.name="TextLayer";var r=t.canvas=document.createElement("canvas");return r=t.ctx=r.getContext("2d"),r.textAlign="start",r.textBaseline="top",t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,flat:!1,collides:!0,unit:"px",angle:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],shadow:{}}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new q(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)+size.x*sin(rotation);}else if(corner==2.0){x+=size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)-size.x*sin(rotation);}else if(corner==3.0){x+=size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)-size.x*sin(rotation);}else{x+=-size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)+size.x*sin(rotation);}return vec3(x,y,coord.z);}void main(){vTextCoord=aTextCoord;if(uFlat){vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}else{vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z+zIndex,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio*scale;vec3 current=transformCoord(screen,halfSize,corner);gl_Position=vec4(current,1.0);}}",fragmentShader:`precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:r.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){this.gl&&this.processCache(t,r)}},{key:"processCache",value:function(t,r){this.cachedData=[];for(var a=0;a<r.length;a++){var n=this.normizedPoint(r[a].geometry.coordinates),s=r[a].text;"properties"in r[a]&&"text"in r[a].properties&&(s=r[a].properties.text);var o=this.getProperty("angle",t.angle,r[a]),u=this.getProperty("color",t.color,r[a]);n&&s!==void 0&&this.cachedData.push({point:n,text:s,angle:o,color:u,index:a})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var r=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(r),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();s.setUniforms(K(this.getCommonUniforms(t),{matrix:a,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,uFlat:n.flat,offset:n.offset,zoomUnits:o,zIndex:n.zIndex,uUnitPx:n.unit==="px"})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,this.index.length,r.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var r=t.gl,a=t.matrix,n=this.getOptions();t=n.fontSize;var s=n.fontFamily,o=n.padding,u=n.margin,h=n.collides,v=n.enablePicked,l=n.shadow,f=r.canvas.width/window.devicePixelRatio,d=r.canvas.height/window.devicePixelRatio,c=this.canvas;r=this.ctx,r.save(),r.scale(window.devicePixelRatio,window.devicePixelRatio),r.textBaseline="top",r.font="20px "+s;var p=new sr;n=[];for(var m=0;m<this.cachedData.length;m++){var g=this.cachedData[m],x=g.point,y=g.text,_=g.angle,A=g.color;g=g.index;var T=nt(x,3);T=ht.clone([T[0],T[1],T[2],1]),ht.transformMat4(T,T,a),ht.scale(T,T,1/T[3]);var w=(T[0]+1)/2*f,C=(-T[1]+1)/2*d,M=r.measureText(y);T=M.width+2*o[0];var E=20;M.actualBoundingBoxAscent&&M.actualBoundingBoxDescent&&(E=M.actualBoundingBoxDescent-M.actualBoundingBoxAscent),E+=2*o[1];var P=T+u[0];if(M=E+u[1],w-=P/2,C-=M/2,P=w+P,M=C+M,!(0>P||0>M||w>f||C>d)){if(h){if(M={minX:w,maxX:P,minY:C,maxY:M},p.collides(M))continue;p.insert(M)}n.push({w:T,h:E,point:x,text:y,angle:_,color:A,dataIndex:g})}}for(r.restore(),u=ye(n),a=u.w,u=u.h,0>=a&&(a=1),0>=u&&(u=1),c.width=a*window.devicePixelRatio,c.height=u*window.devicePixelRatio,r.save(),r.scale(window.devicePixelRatio,window.devicePixelRatio),r.textBaseline="top",r.font="20px "+s,r.shadowColor=l&&l.color,r.shadowOffsetX=l&&l.offsetX,r.shadowOffsetY=l&&l.offsetY,r.shadowBlur=l&&l.blur,s=[],l=[],c=[],h=[],f=0,d=n.length;f<d;++f){for(p=n[f],r.fillStyle=p.color,r.fillText(p.text,p.x+o[0],p.y+o[1]),y=nt(p.point,3),m=y[0],x=y[1],y=y[2],_=0;4>_;_++)s.push(m,x,y),s.push(_),s.push(p.w,p.h),s.push(t/20,p.angle*Math.PI/180);m=p.x/a,x=(p.x+p.w)/a,y=(p.y+p.h)/u,_=p.y/u,l.push(m,y,m,_,x,_,x,y),m=4*f,c.push(m,m+2,m+1,m,m+3,m+2),v&&(p=this.indexToRgb(p.dataIndex),h.push(p[0]/255,p[1]/255,p[2]/255),h.push(p[0]/255,p[1]/255,p[2]/255),h.push(p[0]/255,p[1]/255,p[2]/255),h.push(p[0]/255,p[1]/255,p[2]/255))}r.restore(),this.loadTexture(),this.index=c,this.vertexBuffer.updateData(new Float32Array(s)),this.uvBuffer.updateData(new Float32Array(l)),this.indexBuffer.updateData(new Uint32Array(c)),v&&this.pickBuffer.updateData(new Float32Array(h))}},{key:"loadTexture",value:function(){var t=this;this.canvas?Pt(this.gl,this.canvas,function(r){t.texture=r},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),i}(rt),pe=function(e){function i(t){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t))}return Y(i,e),I(i,[{key:"initialize",value:function(t){var r=this;this.children&&this.children.forEach(function(a){a.map=r.map,a.setWebglLayer(r.getWebglLayer()),a.commonInitialize&&a.commonInitialize(t),a.initialize&&a.initialize(t),a.onOptionsChanged(a.getOptions()),a.onDataChanged(a.getData()),a.onChanged(a.getOptions(),a.getData())})}},{key:"isRequestAnimation",value:function(){if(this.autoUpdate!==void 0)return ve(i.prototype.__proto__||U(i.prototype),"isRequestAnimation",this).call(this);for(var t=!1,r=0;r<this.children.length;r++)if(this.children[r].isRequestAnimation()){t=!0;break}return t}},{key:"render",value:function(t){this.children&&this.children.forEach(function(r){r.render(t)})}},{key:"onDestroy",value:function(t){this.children&&this.children.forEach(function(r){r.onDestroy(t)})}}]),i}(Zn),Df=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.preHeightMapper={},t.preColorMapper={},t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return K(ve(i.prototype.__proto__||U(i.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gridGap:5,height:function(){return 1e3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(t,r){var a=r.gridSize,n=[],s={};r=t.length;for(var o=this.getPointOffset(),u=0;u<r;u++){var h=this.normizedPoint(t[u].geometry.coordinates);h=~~((h[0]+o[0])/a)+"_"+~~((h[1]+o[1])/a),s[h]===void 0&&(s[h]=0);var v=~~t[u].count||1;"properties"in t[u]&&"count"in t[u].properties&&(v=~~t[u].properties.count),s[h]+=v}return yt(s).forEach(function(l){var f=l.split("_");n.push([f[0]*a+a/2,f[1]*a+a/2,s[l]])}),n}},{key:"onChanged",value:function(t,r){r=this.processData(r),ve(i.prototype.__proto__||U(i.prototype),"onChanged",this).call(this,t,r)}},{key:"getGridDataRange",value:function(){var t=this.gridData,r=void 0,a=void 0;t[0]&&(r=t[0][2],a=t[0][2]);for(var n=t.length,s=0;s<n;s++){var o=t[s];r=Math.max(o[2],r),a=Math.min(o[2],a)}return{max:r/2,min:a}}},{key:"processData",value:function(t){var r=this.getOptions(),a=r.gridSize,n=[];if(r.style==="normal")for(var s=this.getPointOffset(),o=0;o<t.length;o++){var u=this.normizedPoint(t[o].geometry.coordinates),h=u[0]+s[0];u=u[1]+s[1];var v=~~t[o].count||1;"properties"in t[o]&&"count"in t[o].properties&&(v=~~t[o].properties.count);var l=t[o].color;"properties"in t[o]&&"color"in t[o].properties&&(l=~~t[o].properties.color),n.push([h,u,v,l])}else n=this.generateGrid(t,r);for(t=[],this._preHeightMapper={},this._preColorMapper={},s=0;s<n.length;s++)o=n[s],o[0]=o[0],o[1]=o[1],h=o[2],r.height&&(h=typeof r.height=="function"?r.height({count:o[2],coordinates:[o[0],o[1]]}):r.height),u=a/2-r.gridGap,v=o[3],r.color&&(v=typeof r.color=="function"?r.color({count:o[2],color:o[3]}):mt(v||r.color).unitArray()),l="p"+o[0]+o[1],t.push({geometry:{type:"Polygon",coordinates:[[[o[0]-u,o[1]-u],[o[0]-u,o[1]+u],[o[0]+u,o[1]+u],[o[0]+u,o[1]-u]]]},color:v,origin:o,count:o[2],preHeight:this.preHeightMapper[l],preColor:this.preColorMapper[l],height:h}),this._preHeightMapper[l]=h,this._preColorMapper[l]=v;return this.preHeightMapper=this._preHeightMapper,this.preColorMapper=this._preColorMapper,this.gridData=t}}]),i}(Ii),fs=function(e){function i(t){O(this,i);var r=W(this,(i.__proto__||U(i)).call(this,t));return r.gridLayer=new Df(t),r.options.textOptions=K({show:!1,flat:!0,unit:"m",fontSize:100,collides:!1},t.textOptions||{}),r.textLayer=new Yr(r.options.textOptions),r.children=[r.gridLayer,r.textLayer],r}return Y(i,e),I(i,[{key:"pick",value:function(t,r){return this.gridLayer.pick(t,r)}},{key:"setData",value:function(t){this.gridLayer.setData(t),this.options.textOptions.show&&this.setTextData()}},{key:"setTextData",value:function(){var t=this.gridLayer.gridData.map(function(r){return{geometry:{type:"Point",coordinates:[r.origin[0],r.origin[1],r.height+5]},properties:{text:r.count}}});this.textLayer.setData(t)}},{key:"setOptions",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},r=this.options.textOptions;K(this.options,t),this.gridLayer.setOptions(this.options),t.textOptions&&(this.options.textOptions.show&&this.setTextData(),this.options.textOptions=K(r||{},t.textOptions),this.textLayer.setOptions(this.options.textOptions))}},{key:"getData",value:function(){return this.gridLayer.getData()}},{key:"render",value:function(t){this.gridLayer.render(t),this.options.textOptions.show&&this.textLayer.render(t)}}]),i}(pe),Bf=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.gridLayer=new fs(t.getGridOptions()),t.children=[t.gridLayer],t.options.riseTime&&(t.autoUpdate=!0),t}return Y(i,e),I(i,[{key:"pick",value:function(t,r){return this.gridLayer.pick(t,r)}},{key:"onDataChanged",value:function(t){this.gridLayer.setData(t)}},{key:"getGridOptions",value:function(){var t=this.getOptions(),r=t.max,a=t.min;r===void 0&&(a=this.gridLayer.getGridDataRange(),r=a.max,a=a.min);var n=new St({max:r,min:a,gradient:t.gradient,maxSize:t.maxHeight,minSize:t.minHeight});return t.height=function(s){var o=n.getSize(s.count);return"properties"in s&&"count"in s.properties&&(o=n.getSize(s.properties.count)),o},t.color=function(s){var o=n.getImageData(s.count);return"properties"in s&&"count"in s.properties&&(o=n.getImageData(s.properties.count)),[o[0]/255,o[1]/255,o[2]/255,o[3]/255]},t}},{key:"onOptionsChanged",value:function(t){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,style:"grid",gridSize:500,maxHeight:8e3,minHeight:200,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]),i}(pe),hs=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="SimpleLineLayer",t.bufferData=[],t}return Y(i,e),I(i,[{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.program=new q(this.gl,{vertexShader:`uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;
#if defined(DASH)
varying vec3 vPos;
#endif
void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);
#if defined(DASH)
vPos=aPos;
#endif
}`,fragmentShader:`precision highp float;varying vec4 vColor;varying vec3 vPos;void main(){
#if defined(DASH)
if(mod(vPos.x,3.0)<1.5){discard;}
#endif
gl_FragColor=vColor;}`,defines:r.useDash?["DASH"]:""},this),this.buffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new at({gl:t,program:this.program,attributes:[{stride:28,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12}]})}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,r){var a=this;if(this.gl){var n=[],s=function(l,f){if(l)for(var d=0;d<l.length-1;d++){var c=a.normizedPoint(l[d]);n.push(c[0]),n.push(c[1]),n.push(c[2]),n.push(f[0],f[1],f[2],f[3]),c=a.normizedPoint(l[d+1]),n.push(c[0]),n.push(c[1]),n.push(c[2]),n.push(f[0],f[1],f[2],f[3])}};t=t.color;for(var o=0;o<r.length;o++){var u=this.getProperty("color",t,r[o]);u=this.normizedColor(u);var h=r[o].geometry,v=h.coordinates;if(h.type==="MultiPolygon"){if(v)for(h=0;h<v.length;h++)s(v[h][0],u)}else if(h.type==="Polygon")v&&s(v[0],u);else if(h.type==="MultiLineString"){if(v)for(h=0;h<v.length;h++)s(v[h],u)}else s(v,u)}this.bufferData=n,this.buffer.updateData(new Float32Array(n))}}},{key:"render",value:function(t){var r=t.gl;if(t=t.matrix,this.bufferData&&!(0>=this.bufferData.length)){var a=this.program;a.use(r),this.vertexArray.bind(),a.setUniforms({u_matrix:t}),t=this.getOptions(),this.setGLState({blend:!0,blendFunc:t.blend==="lighter"?[r.SRC_ALPHA,r.ONE]:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],blendEquation:r.FUNC_ADD}),r.drawArrays(r.LINES,0,this.bufferData.length/7)}}}]),i}(rt),Of=xi.f("species"),zf=V(function(e){e.exports={default:Of,__esModule:!0}});tt(zf);var cs=typeof ri!="undefined"?ri:typeof self!="undefined"?self:typeof window!="undefined"?window:{};cs.TYPED_ARRAY_SUPPORT!==void 0&&cs.TYPED_ARRAY_SUPPORT;var Gn={normal:null,road:Po()},If=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="LineLayer3D",t.initData(),t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",offset:0,blend:"normal",width:4,unit:"px",flat:!1,antialias:!1,style:"normal",dashArray:[0,0],dashOffset:0,polygonOffset:[0,0]}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[],uv:[]}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions(),a=[];r.enablePicked&&a.push("PICK"),Gn[r.style]&&(this.isUseTexture=!0,a.push("USE_TEXTURE")),this.program=new q(this.gl,{vertexShader:`precision highp float;uniform vec4 uSelectedColor;uniform mat4 uMatrix;uniform bool uFlat;uniform bool uUnitPx;uniform vec2 uDashArray;uniform float thickness;uniform float zoomUnits;uniform float devicePixelRatio;uniform float uOffset;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aDistance;attribute float aTotalDistance;
#if defined(USE_TEXTURE)
attribute vec2 uv;
#endif
varying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vTotalDistance;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}vec3 getNormalAndWidth(vec2 currentScreen,vec2 previousScreen,vec2 nextScreen,float thickness){vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){thickness=thickness/dot(miter,perp);}}vec2 normal=vec2(-dir.y,dir.x);return vec3(normal,thickness);}void main(){vColor=aColor;vCounter=aDistance/aTotalDistance;vDashArray=uDashArray/aTotalDistance;if(uUnitPx){vDashArray*=zoomUnits;}vTotalDistance=aTotalDistance;
#if defined(USE_TEXTURE)
vUV=uv;
#endif
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
if(uFlat){float width=thickness;if(uUnitPx){width*=zoomUnits;}vec3 nw=getNormalAndWidth(position.xy,previous.xy,next.xy,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;float offsetXy=uOffset;float offsetHeight=uOffset/100.0;if(uUnitPx){offsetXy/=zoomUnits;offsetHeight*=zoomUnits;}gl_Position=uMatrix*vec4(position.xy+normal*(direction+offsetXy),position.z+offsetHeight,1.0);}else{vec4 previousProjected=uMatrix*vec4(previous,1.0);vec4 currentProjected=uMatrix*vec4(position,1.0);vec4 nextProjected=uMatrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float width=thickness*devicePixelRatio;if(!uUnitPx){width/=zoomUnits;}vec3 nw=getNormalAndWidth(currentScreen,previousScreen,nextScreen,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;vec2 pos=currentScreen+normal*direction;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}}`,fragmentShader:`precision highp float;varying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vCounter;varying float vTotalDistance;uniform bool uAntialias;uniform float uDashOffset;uniform float zoomUnits;uniform float thickness;
#if defined(USE_TEXTURE)
uniform float uTextureMargin;uniform sampler2D textureImage;
#endif
void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.8,1.0,length(vNormal));color.a*=blur;}
#if defined(USE_TEXTURE)
float segLen=uTextureMargin*zoomUnits;float textureLen=thickness*zoomUnits;float deltaX=mod(vUV.x,segLen);float middle=segLen/2.0;if(deltaX>=middle&&deltaX<=middle+textureLen){float uvx=(deltaX-middle)/textureLen;vec4 texture=texture2D(textureImage,vec2(uvx,vUV.y));color=texture.a>=0.5 ? texture : color;}
#endif
if(vDashArray.y>0.0){float offset=uDashOffset*zoomUnits/vTotalDistance;color.a*=(1.0-step(vDashArray.x,mod(vCounter+offset,vDashArray.x+vDashArray.y)));}gl_FragColor=color;}`,defines:a},this),this.prevBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),a=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:8,name:"aDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0},{stride:8,name:"aTotalDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:4}],a=a.concat(this.getCommonAttributes()),Gn[r.style]&&(a.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),this.setOptions({texture:Gn[r.style]}),this.loadTexture()),this.vertexArray=new at({gl:t,program:this.program,attributes:a})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){var a=this;if(this.gl){this.initData();for(var n=t.color,s=[],o=0;o<r.length;o++){var u=[],h=r[o].geometry.coordinates;h&&0<h.length&&(u=r[o].geometry.type==="MultiPolygon"?h.reduce(function(f,d){return f.concat(d)})[0].map(function(f){return a.normizedPoint(f)}):r[o].geometry.type==="Polygon"||r[o].geometry.type==="MultiLineString"?h[0].map(function(f){return a.normizedPoint(f)}):h.map(function(f){return a.normizedPoint(f)})),h=this.getProperty("color",n,r[o]),h=this.getProperty("lineColor",n,r[o]),h=this.normizedColor(h);for(var v=this.addMultipleCoords(u),l=0;l<v.length;l++)this.processData(this.dataMgr,v[l],h);if(t.enablePicked)for(h=this.indexToRgb(o),v=0;v<u.length;v++)s.push(h[0]/255,h[1]/255,h[2]/255),s.push(h[0]/255,h[1]/255,h[2]/255),t.repeat&&(s.push(h[0]/255,h[1]/255,h[2]/255),s.push(h[0]/255,h[1]/255,h[2]/255),s.push(h[0]/255,h[1]/255,h[2]/255),s.push(h[0]/255,h[1]/255,h[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(this.dataMgr.uv)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(s))}}},{key:"processData",value:function(t,r,a){var n,s,o,u,h,v,l,f,d=r.length,c=t.position.length/6,p=Co(r),m=p.arr,g=p.total;p=Ht(m.map(function(T){return[T,g]})),m=m.map(function(T){return[T,0,T,1]});var x=Ht(r.map(function(T){return-1}),!0),y=Ht(r),_=Ht(r.map(si(-1))),A=Ht(r.map(si(1)));r=Ht(r.map(function(T){return a})),d=Mo(d,c),(n=t.uv).push.apply(n,Q($t(m))),(s=t.counter).push.apply(s,Q($t(p))),(o=t.position).push.apply(o,Q($t(y))),(u=t.prev).push.apply(u,Q($t(_))),(h=t.next).push.apply(h,Q($t(A))),(v=t.direction).push.apply(v,Q(x)),(l=t.color).push.apply(l,Q($t(r))),(f=t.index).push.apply(f,Q(d))}},{key:"render",value:function(t){var r=t.gl,a=t.matrix,n=this.dataMgr;if(n&&!(0>=n.index.length)&&this.map){var s=this.getOptions(),o=this.program;o.use(r),t=K(this.getCommonUniforms(t),{uMatrix:a,uFlat:s.flat,uUnitPx:s.unit==="px",zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio,thickness:s.width,uDashArray:s.dashArray,uDashOffset:s.dashOffset,uAntialias:s.antialias,uOffset:s.offset}),this.isUseTexture&&(t=K(t,{uTextureMargin:140,textureImage:this.texture})),o.setUniforms(t),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:s.blend==="lighter"?[r.SRC_ALPHA,r.ONE]:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],polygonOffset:s.polygonOffset}),this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,n.index.length,r.UNSIGNED_INT,0)}}},{key:"loadTexture",value:function(t){var r=this,a=this.getOptions();a.texture?Pt(this.gl,a.texture,function(n,s){r.image=s,r.texture=n,t&&t(),r.webglLayer.render()}):(this.image=this.texture=null,t&&t())}}]),i}(rt),bf=function(){function e(i){O(this,e),this.join=i.join||"miter",this.cap=i.cap||"butt",this.thickness=i.thickness||4,this.miterLimit=i.miterLimit||2*this.thickness,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],colors:[],uvs:[],startIndex:0,maxDistance:0},this._lastFlip=-1,this._started=!1,this._normal=null,this._totalDistance=0,this._colorFlag=!1,this._count=0}return I(e,[{key:"extrude",value:function(i,t,r,a){var n=this.complex;if(1>=i.length)return n;this._lastFlip=-1,this._started=!1,this._normal=null,this._totalDistance=0;for(var s=i.length,o=n.startIndex,u=null,h=1;h<s;h++){var v=u||i[h-1],l=i[h],f=h<s-1?i[h+1]:null;f&&l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]?u=v:(v=this._segment(n,o,v,l,f,t,r,a),v!==-1&&(o+=v,u=null))}return this.dash&&(n.maxDistance=Math.max(this._totalDistance,n.maxDistance)),n.startIndex=n.positions.length/7,n}},{key:"_segment",value:function(i,t,r,a,n,s,o,u){u[0]instanceof Array&&(this._colorFlag=!0);var h=0,v=J.create(),l=J.create(),f=J.create(),d=J.create(),c=i.indices,p=i.positions,m=i.normals,g=i.colors;i=i.uvs;var x=this.cap==="square",y=this.cap==="round",_=this.join==="bevel",A=this.join==="round",T=[a[0],a[1]],w=[r[0],r[1]];Eo(l,T,w);var C=0;if(this.dash&&(C=this._calcDistance(T,w),this._totalDistance+=C),this._normal||(this._normal=J.create(),ui(this._normal,l)),!this._started)if(this._started=!0,x){w=J.create();var M=J.create();J.add(w,this._normal,l),J.sub(M,this._normal,l),m.push(M[0],M[1],0),m.push(w[0],w[1],0),p.push(r[0],r[1],r[2],this._totalDistance-C,s,o,0),p.push(r[0],r[1],r[2],this._totalDistance-C,-s,o,0),i.push(this._totalDistance-C,0,this._totalDistance-C,1),this._colorFlag?(g.push(u[0][0],u[0][1],u[0][2],u[0][3]),g.push(u[0][0],u[0][1],u[0][2],u[0][3])):(g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]))}else if(y){w=J.fromValues(-l[0],-l[1]),M=J.create(),J.sub(M,this._normal,l),J.normalize(M,M);var E=J.create();J.add(E,this._normal,l),J.normalize(E,E);var P=J.fromValues(this._normal[0],this._normal[1]),L=J.fromValues(-this._normal[0],-this._normal[1]);for(m.push(w[0],w[1],0),m.push(M[0],M[1],0),m.push(-E[0],-E[1],0),m.push(P[0],P[1],0),m.push(L[0],L[1],0),w=0;5>w;w++)p.push(r[0],r[1],r[2],this._totalDistance-C,s,o,0),i.push(this._totalDistance-C,0),this._colorFlag?g.push(u[0][0],u[0][1],u[0][2],u[0][3]):g.push(u[0],u[1],u[2],u[3]);c.push(t+0,t+2,t+1,t+1,t+2,t+3,t+3,t+2,t+4),h+=3,t+=3}else this._extrusions(p,m,i,g,r,this._normal,s,this._totalDistance-C,o,u,0);if(c.push.apply(c,Q(this._lastFlip===-1?[t+0,t+1,t+2]:[t+1,t+0,t+2])),n)Eo(f,[n[0],n[1]],T),this._count++,J.create(),J.add(d,l,f),J.normalize(d,d),y=J.fromValues(-d[1],d[0]),l=J.fromValues(-l[1],l[0]),l=[s/J.dot(y,l),y],l=nt(l,2),y=l[0],l=l[1],d=0<J.dot(d,this._normal)?-1:1,_||this.join!=="miter"||Math.abs(y)>this.miterLimit&&(_=!0),_?(A=Math.min(2*s,Math.abs(y)),m.push(this._normal[0],this._normal[1],0),m.push(l[0],l[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),p.push(a[0],a[1],a[2],this._totalDistance,-A*d,o,0),c.push.apply(c,Q(this._lastFlip===-d?[t+2,t+1,t+3]:[t+0,t+2,t+3])),ui(v,f),J.copy(this._normal,v),m.push(this._normal[0],this._normal[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),c.push.apply(c,Q(d===1?[t+2,t+3,t+4]:[t+3,t+2,t+4])),this._flipedUV(i,this._totalDistance,d,!0),this._colorFlag?(g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3])):(g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3])),h+=3):A?(A=Math.min(2*s,Math.abs(y)),m.push(this._normal[0],this._normal[1],0),m.push(l[0],l[1],0),m.push(l[0],l[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),p.push(a[0],a[1],a[2],this._totalDistance,-A*d,o,0),c.push.apply(c,Q(this._lastFlip===-d?[t+2,t+1,t+4,t+2,t+4,t+3]:[t+0,t+2,t+4,t+2,t+3,t+4])),ui(v,f),J.copy(this._normal,v),m.push(this._normal[0],this._normal[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),c.push.apply(c,Q(d===1?[t+4,t+3,t+5]:[t+3,t+4,t+5])),this._flipedUV(i,this._totalDistance,d,!1),this._colorFlag?(g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3])):(g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3])),h+=4):(this._extrusions(p,m,i,g,a,l,y,this._totalDistance,o,u,this._count),c.push.apply(c,Q(this._lastFlip===-1?[t+2,t+1,t+3]:[t+2,t+0,t+3])),d=-1,J.copy(this._normal,l),h+=2),this._lastFlip=d;else if(ui(this._normal,l),v=u.length-1,x?(f=J.create(),A=J.create(),J.add(f,l,this._normal),J.sub(A,l,this._normal),m.push(f[0],f[1],0),m.push(A[0],A[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s,o,0),p.push(a[0],a[1],a[2],this._totalDistance,s,o,0),i.push(this._totalDistance,0,this._totalDistance,1),this._colorFlag?(g.push(u[v][0],u[v][1],u[v][2],u[v][3]),g.push(u[v][0],u[v][1],u[v][2],u[v][3])):(g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]))):this._extrusions(p,m,i,g,a,this._normal,s,this._totalDistance,o,u,v),c.push.apply(c,Q(this._lastFlip===-1?[t+2,t+1,t+3]:[t+2,t+0,t+3])),h+=2,y){for(f=J.create(),J.add(f,l,this._normal),J.normalize(f,f),A=J.create(),J.sub(A,l,this._normal),J.normalize(A,A),l=J.fromValues(l[0],l[1]),m.push(f[0],f[1],0),m.push(A[0],A[1],0),m.push(l[0],l[1],0),m=0;3>m;m++)p.push(a[0],a[1],a[2],this._totalDistance,s,o,0),i.push(this._totalDistance,0),this._colorFlag?g.push(u[v][0],u[v][1],u[v][2],u[v][3]):g.push(u[0],u[1],u[2],u[3]);c.push(t+2,t+3,t+4,t+4,t+3,t+5,t+4,t+5,t+6),h+=3}return h}},{key:"_extrusions",value:function(i,t,r,a,n,s,o,u,h,v,l){t.push(s[0],s[1],0),t.push(s[0],s[1],0),i.push(n[0],n[1],n[2],u,o,h,0),i.push(n[0],n[1],n[2],u,-o,h,0),r.push(u,0,u,1),this._colorFlag?(a.push(v[l][0],v[l][1],v[l][2],v[l][3]),a.push(v[l][0],v[l][1],v[l][2],v[l][3])):(a.push(v[0],v[1],v[2],v[3]),a.push(v[0],v[1],v[2],v[3]))}},{key:"_calcDistance",value:function(i,t){return Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2))}},{key:"_flipedUV",value:function(i,t,r,a){a?r===-1?i.push(t,0,t,1,t,0):i.push(t,1,t,0,t,1):r===-1?i.push(t,0,t,0,t,1,t,0):i.push(t,1,t,1,t,0,t,1)}}]),e}(),Kn={normal:null,road:Po,arrow:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},i=e.width;e=e.color;var t=So(),r=t.canvas;return t=t.ctx,t.save(),t.moveTo(5,0),t.lineTo(32,16),t.lineTo(5,32),t.strokeStyle=e||"#fff",t.lineWidth=i||8,t.stroke(),t.restore(),r}},Qn=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="LineLayer",t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{style:"normal",styleOptions:{},color:"rgba(25, 25, 250, 1)",blend:"default",lineJoin:"miter",lineCap:"butt",unit:"px",width:4,offset:0,antialias:!1,dashArray:[0,0],dashOffset:0,animation:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0],depthTest:!0,depthWrite:!0}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions(),a=[];r.enablePicked&&a.push("PICK"),Kn[r.style]&&(this.isUseTexture=!0,this.prevStyle=r.style,this.prevStyleOptions=r.styleOptions,a.push("USE_TEXTURE")),r.animation===!0&&(this.isAnimateLine=!0,this.date=new Date,this.autoUpdate=!0,a.push("USE_LINE_ANIMATION")),r.useDash===!0&&a.push("USE_SIMPLE_DASH"),this.program=new q(this.gl,{vertexShader:`precision highp float;uniform vec4 uSelectedColor;uniform mat4 u_matrix;uniform vec2 u_dash_array;uniform float u_zoom_units;uniform float u_zIndex;uniform bool u_unit_px;attribute vec4 a_color;attribute vec3 a_position;attribute vec3 a_normal;attribute float a_distance;attribute float a_total_distance;attribute float a_width;attribute float a_offset;
#if defined(USE_TEXTURE)
attribute vec2 uv;
#endif
varying vec4 v_color;varying vec2 v_normal;varying vec2 v_uv;varying vec2 v_dash_array;varying float v_total_distance;varying float v_counter;varying float v_width;
#if defined(USE_SIMPLE_DASH)
varying vec3 v_position;
#endif
void main(){v_width=a_width;v_color=a_color;v_counter=a_distance/a_total_distance;v_dash_array=u_dash_array/a_total_distance;if(u_unit_px){v_dash_array*=u_zoom_units;}v_total_distance=a_total_distance;v_normal=vec2(normalize(a_normal.xy)*sign(a_width));
#if defined(USE_TEXTURE)
v_uv=uv;
#endif
#if defined(PICK)
if(mapvIsPicked()){v_color=uSelectedColor;}
#endif
vec2 extrude=a_normal.xy*a_width/2.0;if(u_unit_px){extrude*=u_zoom_units;}vec2 offsetXY=a_normal.xy*-a_offset;float offsetZ=a_offset/100.0+u_zIndex;if(u_unit_px){offsetXY*=u_zoom_units;offsetZ*=u_zoom_units;}
#if defined(USE_SIMPLE_DASH)
v_position=a_position;
#endif
gl_Position=u_matrix*vec4(a_position.xy+extrude+offsetXY,a_position.z+offsetZ,1.0);}`,fragmentShader:`precision highp float;varying vec4 v_color;varying vec2 v_normal;varying vec2 v_uv;varying vec2 v_dash_array;varying float v_counter;varying float v_total_distance;varying float v_width;
#if defined(USE_SIMPLE_DASH)
varying vec3 v_position;
#endif
uniform bool u_antialias;uniform float u_dash_offset;uniform float u_zoom_units;
#if defined(USE_LINE_ANIMATION)
uniform bool u_animate;uniform float u_time;uniform float u_duration;uniform float u_interval;uniform float u_trail_length;
#endif
#if defined(USE_TEXTURE)
uniform float u_texture_width;uniform float u_texture_margin;uniform sampler2D u_sampler;
#endif
void main(){vec4 color=v_color;
#if defined(USE_SIMPLE_DASH)
if(mod(v_position.x,5.0)<3.0){discard;}
#endif
if(u_antialias){float blur=1.0;blur=1.0-smoothstep(0.9,1.0,length(v_normal));color.a*=blur;}
#if defined(USE_LINE_ANIMATION)
if(u_animate){float alpha=1.0-fract(mod(1.0-v_counter,u_interval)*(1.0/u_interval)+u_time/u_duration);alpha=(alpha+u_trail_length-1.0)/u_trail_length;color.a*=alpha;gl_FragColor=color;return;}
#endif
#if defined(USE_TEXTURE)
float margin_width=u_texture_margin*u_zoom_units;float margin_width_half=margin_width/2.0;float texture_width=u_texture_width*u_zoom_units;float delta=mod(v_uv.x,texture_width+margin_width);if(delta>=margin_width_half&&delta<=margin_width_half+texture_width){float uvx=(delta-margin_width_half)/texture_width;vec4 texture=texture2D(u_sampler,vec2(uvx,v_uv.y));color=texture.a>=0.5 ? texture : color;}
#endif
if(v_dash_array.y>0.0){float offset=u_dash_offset*u_zoom_units/v_total_distance;color.a*=(1.0-step(v_dash_array.x,mod(v_counter+offset,v_dash_array.x+v_dash_array.y)));}gl_FragColor=color;}`,defines:a},this),this.positionBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.normalBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),a=[{stride:28,name:"a_position",buffer:this.positionBuffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"a_distance",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:12},{stride:28,name:"a_width",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:16},{stride:28,name:"a_offset",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:20},{stride:28,name:"a_total_distance",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:24},{stride:12,name:"a_normal",buffer:this.normalBuffer,size:3,type:"FLOAT",offset:0},{stride:16,name:"a_color",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0}],a=a.concat(this.getCommonAttributes()),this.isUseTexture&&(this.uvBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),a.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),r=(0,Kn[r.style])(r.styleOptions),this.setOptions({texture:r}),this.loadTexture()),this.vertexArray=new at({gl:t,program:this.program,attributes:a})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){var a=this,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if(this.gl)if(!this.isUseTexture||this.prevStyle===t.style&&Er(this.prevStyleOptions)===Er(t.styleOptions))this.parseData(t,r,n);else{this.prevStyle=t.style,this.prevStyleOptions=t.styleOptions;var s=(0,Kn[t.style])(t.styleOptions);this.setOptions({texture:s}),this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){a.loadTexture(function(){a.parseData(t,r,n)})},0)}}},{key:"onParseProperties",value:function(t){return this.normizedColor(t)}},{key:"parseData",value:function(t,r,a){var n=this,s=t.dashArray,o=t.width,u=t.color,h=t.offset;s=!!this.isUseTexture||!!s[1]||!!this.isAnimateLine;for(var v=new bf({dash:s,cap:t.lineCap,join:t.lineJoin,miterLimit:t.miterLimit,thickness:o}),l=[],f=function(c){var p=r[c].geometry.coordinates;p&&0<p.length&&(r[c].geometry.type==="MultiPolygon"?p=p.reduce(function(A,T){return A.concat(T)}):r[c].geometry.type==="LineString"&&(p=[p]),p=p.map(function(A){return A=A.map(function(T){return n.normizedPoint(T)}),a.closePath===!0&&A[0].toString()!==A[A.length-1].toString()&&A.push(A[0]),A}));var m=n.getProperty("color",u,r[c]);m=n.onParseProperties(m,r[0].geometry.coordinates.length);var g=n.getProperty("width",o,r[c]);g=Number(g);var x=n.getProperty("offset",h,r[c]);x=Number(x);var y=v.complex.startIndex;p=n.addMultipleCoords(p);for(var _=0;_<p.length;_++)p[_].forEach(function(A){v.extrude(A,g,x,m)});if(t.enablePicked)for(c=n.indexToRgb(c),p=v.complex.startIndex;y<p;y++)l.push(c[0]/255,c[1]/255,c[2]/255),t.repeat&&(l.push(c[0]/255,c[1]/255,c[2]/255),l.push(c[0]/255,c[1]/255,c[2]/255))},d=0;d<r.length;d++)f(d);if(f=v.complex,s)for(d=0;d<f.positions.length/7;d++)f.positions[7*d+6]=f.maxDistance;this.lineData=f,this.positionBuffer.updateData(new Float32Array(f.positions)),this.normalBuffer.updateData(new Float32Array(f.normals)),this.colorBuffer.updateData(new Float32Array(f.colors)),this.indexBuffer.updateData(new Uint32Array(f.indices)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(f.uvs)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(l))}},{key:"render",value:function(t){var r=t.gl,a=t.matrix,n=this.lineData;if(n&&!(0>=n.indices.length)&&this.map){var s=this.getOptions(),o=this.program;o.use(r),t=K(this.getCommonUniforms(t),{u_matrix:a,u_zoom_units:this.map.getZoomUnits(),u_dash_array:s.dashArray,u_dash_offset:s.dashOffset,u_antialias:s.antialias,u_unit_px:s.unit==="px",u_zIndex:s.zIndex}),this.isUseTexture&&(t=K(t,{u_texture_width:s.width,u_texture_margin:140,u_sampler:this.texture})),this.isAnimateLine&&(a=this.map.getZoom(),t=K(t,{u_time:(new Date-this.date)/1e3,u_animate:!!(a>=s.minZoom&&a<=s.maxZoom&&this.autoUpdate),u_duration:s.duration,u_interval:s.interval,u_trail_length:s.trailLength})),o.setUniforms(t),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:se(r,s.blend),polygonOffset:s.polygonOffset,depthTest:s.depthTest,depthMask:s.depthWrite}),this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,n.indices.length,r.UNSIGNED_INT,0)}}},{key:"loadTexture",value:function(t){var r=this,a=this.getOptions();a.texture?Pt(this.gl,a.texture,function(n,s){r.image=s,r.texture=n,t&&t(),r.webglLayer.render()}):(this.image=this.texture=null,t&&t())}}]),i}(rt),kf=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="LineRainbowLayer",t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{style:"normal",styleOptions:{},color:"rgba(25, 25, 250, 1)",blend:"normal",lineJoin:"miter",lineCap:"butt",unit:"px",width:4,offset:0,antialias:!1,dashArray:[0,0],dashOffset:0,animation:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0],depthTest:!0,depthWrite:!0}}},{key:"onDestroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.options=this.data=this.indexBuffer=this.normalBuffer=this.colorBuffer=this.positionBuffer=this.program=this.vertexArray=null}},{key:"onParseProperties",value:function(t,r){var a=t.length;if(t instanceof Array){var n=[];if(a<r){var s=Math.floor(r/a);r%=a;for(var o=0,u=0;o<a;o++,u++)for(var h=u<r?s+1:s,v=0;v<h;v++)n.push(t[o]);t=n}for(a=[],s=0;s<t.length;s++)a.push(this.normizedColor(t[s]))}else a=this.normizedColor(t);return a}}]),i}(Qn),Uf=function(){function e(i,t){O(this,e),this.layer=i,this.gl=t,this.initData()}return I(e,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(i,t){this.initData();var r=i.color,a=i.height,n=i.gradient;i=this.gl;for(var s=0;s<t.length;s++){var o=t[s].geometry.coordinates,u=o.length;this.maxLength=u>this.maxLength?u:this.maxLength;for(var h=[],v=0;v<u;v++){var l=this.layer.normizedPoint(o[v]);h.push(l)}u=t[s].color||r,"properties"in t[s]&&"color"in t[s].properties&&(u=t[s].properties.color),n||Object.prototype.toString.call(u)!=="[object Function]"||(u=u(t[s])),o=this.layer.normizedColor(n?n[0]:u),u=this.layer.normizedColor(n?n[1]:u),v=t[s].height||a,"properties"in t[s]&&"height"in t[s].properties&&(v=t[s].properties.height),Object.prototype.toString.call(v)==="[object Function]"&&(v=v(t[s])),this.processData(this.outWall3d,h,o,u,v)}for(t=0;t<this.outWall3d.vertex.length;t++){for(r=[],a=this.outWall3d.vertex[t].length,n=0;n<a;n++)r.push.apply(r,Q(this.outWall3d.vertex[t][n]));a=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,new Float32Array(r),i.STATIC_DRAW),this.outWall3d.vertexBuffer[t]=a,i.bindBuffer(i.ARRAY_BUFFER,null),a=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[t]),i.STATIC_DRAW),this.outWall3d.indexBuffer[t]=a,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(i,t,r,a,n){var s=i.vertex[i.vertex.length-1],o=i.index[i.index.length-1],u=t.length;(!o||65536<=o.length+2*u+2)&&(s=[],o=[],i.vertex.push(s),i.index.push(o)),(i=s.length)&&o.push(i-1,i);for(var h=i=0;h<u;h++){var v=[],l=[],f=t[h];v.push(f[0],f[1]),v.push(f[2]?Number(f[2])+n:n),v.push(f[3]?Number(f[3]):h),v.push(i),v.push(r[0],r[1],r[2],r[3]),l.push(f[0],f[1]),l.push(f[2]?Number(f[2]):0),l.push(f[3]?Number(f[3]):h),l.push(i),l.push(a[0],a[1],a[2],a[3]),f=s.length,s.push(v,l),o.push(f,f+1),h<u-1&&(i+=this.getDistance(t[h],t[h+1]))}}},{key:"getDistance",value:function(i,t){return Math.sqrt(Math.pow(Math.abs(i[0]-t[0]),2)+Math.pow(Math.abs(i[1]-t[1]),2))}}]),e}(),Nf=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new Uf(this,this.gl),this.program=new q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},{key:"onChanged",value:function(t,r){this.gl&&(this.dataMgr.onLayerChange(t,r),t.endTime===void 0&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var r=t.gl,a=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),s=this.program;for(r.useProgram(s.program),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA]}),r.enableVertexAttribArray(s.attributes.aPos),r.enableVertexAttribArray(s.attributes.aDistance),r.enableVertexAttribArray(s.attributes.aColor),r.uniformMatrix4fv(s.uniforms.u_matrix,!1,a),r.uniform1f(s.uniforms.currentTime,this.time),r.uniform1f(s.uniforms.trailLength,n.trailLength),a=0;a<t.vertex.length;a++)if(!(0>=t.vertex[a].length)){var o=t.vertex[a],u=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=u*o[0].length,r.bindBuffer(r.ARRAY_BUFFER,t.vertexBuffer[a]),r.vertexAttribPointer(s.attributes.aPos,4,r.FLOAT,!1,o,0),r.vertexAttribPointer(s.attributes.aDistance,1,r.FLOAT,!1,o,4*u),r.vertexAttribPointer(s.attributes.aColor,4,r.FLOAT,!1,o,5*u),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer[a]),r.drawElements(r.TRIANGLE_STRIP,t.index[a].length,r.UNSIGNED_SHORT,0),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}this.time+=n.step,this.time>this.endTime&&(this.time=this.startTime)}}}]),i}(rt),bi=function(e,i,t,r){if(!(e instanceof i)||r!==void 0&&r in e)throw TypeError(t+": incorrect invocation!");return e},Ve=V(function(e){var i={},t={};e=e.exports=function(r,a,n,s,o){o=o?function(){return r}:Mn(r),n=At(n,s,a?2:1),s=0;var u,h;if(typeof o!="function")throw TypeError(r+" is not iterable!");if(o===void 0||ee.Array!==o&&la[ua]!==o){for(s=o.call(r);!(h=s.next()).done;)if(o=sa(s,n,h.value,a),o===i||o===t)return o}else for(u=fi(r.length);u>s;s++)if(o=a?n(Ft(h=r[s])[0],h[1]):n(r[s]),o===i||o===t)return o},e.BREAK=i,e.RETURN=t}),jf=_t("species"),ds=function(e,i){e=Ft(e).constructor;var t;return e===void 0||(t=Ft(e)[jf])==null?i:be(t)},Hf=function(e,i,t){var r=t===void 0;switch(i.length){case 0:return r?e():e.call(t);case 1:return r?e(i[0]):e.call(t,i[0]);case 2:return r?e(i[0],i[1]):e.call(t,i[0],i[1]);case 3:return r?e(i[0],i[1],i[2]):e.call(t,i[0],i[1],i[2]);case 4:return r?e(i[0],i[1],i[2],i[3]):e.call(t,i[0],i[1],i[2],i[3])}return e.apply(t,i)},vs=$.process,Jn=$.setImmediate,ps=$.clearImmediate,gs=$.MessageChannel,qn=$.Dispatch,$n=0,Zr={},Vr=function(){var e=+this;if(Zr.hasOwnProperty(e)){var i=Zr[e];delete Zr[e],i()}},ms=function(e){Vr.call(e.data)};if(!Jn||!ps)if(Jn=function(e){for(var i=[],t=1;arguments.length>t;)i.push(arguments[t++]);return Zr[++$n]=function(){Hf(typeof e=="function"?e:Function(e),i)},Gr($n),$n},ps=function(e){delete Zr[e]},Ie(vs)=="process")var Gr=function(e){vs.nextTick(At(Vr,e,1))};else if(qn&&qn.now)Gr=function(e){qn.now(At(Vr,e,1))};else if(gs){var xs=new gs,ys=xs.port2;xs.port1.onmessage=ms,Gr=At(ys.postMessage,ys,1)}else $.addEventListener&&typeof postMessage=="function"&&!$.importScripts?(Gr=function(e){$.postMessage(e+"","*")},$.addEventListener("message",ms,!1)):Gr="onreadystatechange"in(di?$e.createElement("script"):{})?function(e){fn.appendChild(di?$e.createElement("script"):{}).onreadystatechange=function(){fn.removeChild(this),Vr.call(e)}}:function(e){setTimeout(At(Vr,e,1),0)};var to=Jn,_s=$.MutationObserver||$.WebKitMutationObserver,eo=$.process,ro=$.Promise,As=Ie(eo)=="process",ki={f:function(e){return new nu(e)}},Ui=function(e){try{return{e:!1,v:e()}}catch(i){return{e:!0,v:i}}},Ts=$.navigator,Xf=Ts&&Ts.userAgent||"",io=function(e,i){if(Ft(e),Et(i)&&i.constructor===e)return i;e=ki.f(e);var t=e.resolve;return t(i),e.promise},no=function(e,i,t){for(var r in i)t&&e[r]?e[r]=i[r]:ue(e,r,i[r]);return e},ws=_t("species"),Ms=function(e){e=typeof it[e]=="function"?it[e]:$[e],Xt&&e&&!e[ws]&&kt.f(e,ws,{configurable:!0,get:function(){return this}})},Cs=function(){var e,i,t=function(){var o;for(As&&(o=eo.domain)&&o.exit();e;){var u=e.fn;e=e.next;try{u()}catch(h){throw e?r():i=void 0,h}}i=void 0,o&&o.enter()};if(As)var r=function(){eo.nextTick(t)};else if(!_s||$.navigator&&$.navigator.standalone)if(ro&&ro.resolve){var a=ro.resolve(void 0);r=function(){a.then(t)}}else r=function(){to.call($,t)};else{var n=!0,s=document.createTextNode("");new _s(t).observe(s,{characterData:!0}),r=function(){s.data=n=!n}}return function(o){o={fn:o,next:void 0},i&&(i.next=o),e||(e=o,r()),i=o}}(),Ss=$.TypeError,ur=$.process,Ps=ur&&ur.versions,Wf=Ps&&Ps.v8||"",ne=$.Promise,Kr=Mi(ur)=="process",Ni=function(){},Es,Qr=Es=ki.f,ji=!!function(){try{var e=ne.resolve(1),i=(e.constructor={})[_t("species")]=function(t){t(Ni,Ni)};return(Kr||typeof PromiseRejectionEvent=="function")&&e.then(Ni)instanceof i&&Wf.indexOf("6.6")!==0&&Xf.indexOf("Chrome/66")===-1}catch(t){}}(),Rs=function(e){var i;return Et(e)&&typeof(i=e.then)=="function"?i:!1},oo=function(e,i){if(!e._n){e._n=!0;var t=e._c;Cs(function(){for(var r=e._v,a=e._s==1,n=0;t.length>n;){var s=void 0,o=void 0,u=void 0,h=t[n++],v=a?h.ok:h.fail,l=h.resolve,f=h.reject,d=h.domain;try{v?(a||(e._h==2&&Zf(e),e._h=1),v===!0?u=r:(d&&d.enter(),u=v(r),d&&(d.exit(),s=!0)),u===h.promise?f(Ss("Promise-chain cycle")):(o=Rs(u))?o.call(u,l,f):l(u)):f(r)}catch(c){d&&!s&&d.exit(),f(c)}}e._c=[],e._n=!1,i&&!e._h&&Yf(e)})}},Yf=function(e){to.call($,function(){var i=e._v,t=e._h!==1&&(e._a||e._c).length===0,r,a;if(t){var n=Ui(function(){Kr?ur.emit("unhandledRejection",i,e):(r=$.onunhandledrejection)?r({promise:e,reason:i}):(a=$.console)&&a.error&&a.error("Unhandled promise rejection",i)});e._h=Kr||e._h!==1&&(e._a||e._c).length===0?2:1}if(e._a=void 0,t&&n.e)throw n.v})},Zf=function(e){to.call($,function(){var i;Kr?ur.emit("rejectionHandled",e):(i=$.onrejectionhandled)&&i({promise:e,reason:e._v})})},lr=function(e){var i=this;i._d||(i._d=!0,i=i._w||i,i._v=e,i._s=2,i._a||(i._a=i._c.slice()),oo(i,!0))},ao=function(e){var i=this,t;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw Ss("Promise can't be resolved itself");(t=Rs(e))?Cs(function(){var r={_w:i,_d:!1};try{t.call(e,At(ao,r,1),At(lr,r,1))}catch(a){lr.call(r,a)}}):(i._v=e,i._s=1,oo(i,!1))}catch(r){lr.call({_w:i,_d:!1},r)}}};if(!ji){ne=function(e){bi(this,ne,"Promise","_h"),be(e),so.call(this);try{e(At(ao,this,1),At(lr,this,1))}catch(i){lr.call(this,i)}};var so=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1};so.prototype=no(ne.prototype,{then:function(e,i){var t=Qr(ds(this,ne));return t.ok=typeof e=="function"?e:!0,t.fail=typeof i=="function"&&i,t.domain=Kr?ur.domain:void 0,this._c.push(t),this._a&&this._a.push(t),this._s&&oo(this,!1),t.promise},catch:function(e){return this.then(void 0,e)}});var Vf=function(){var e=new so;this.promise=e,this.resolve=At(ao,e,1),this.reject=At(lr,e,1)};ki.f=Qr=function(e){return e===ne||e===Ls?new Vf(e):Es(e)}}N(N.G+N.W+N.F*!ji,{Promise:ne}),ke(ne,"Promise"),Ms("Promise");var Ls=it.Promise;N(N.S+N.F*!ji,"Promise",{reject:function(e){var i=Qr(this),t=i.reject;return t(e),i.promise}}),N(N.S+1*N.F,"Promise",{resolve:function(e){return io(this===Ls?ne:this,e)}}),N(N.S+N.F*!(ji&&ha(function(e){ne.all(e).catch(Ni)})),"Promise",{all:function(e){var i=this,t=Qr(i),r=t.resolve,a=t.reject,n=Ui(function(){var s=[],o=0,u=1;Ve(e,!1,function(h){var v=o++,l=!1;s.push(void 0),u++,i.resolve(h).then(function(f){l||(l=!0,s[v]=f,--u||r(s))},a)}),--u||r(s)});return n.e&&a(n.v),t.promise},race:function(e){var i=this,t=Qr(i),r=t.reject,a=Ui(function(){Ve(e,!1,function(n){i.resolve(n).then(t.resolve,r)})});return a.e&&r(a.v),t.promise}}),N(N.P+N.R,"Promise",{finally:function(e){var i=ds(this,it.Promise||$.Promise),t=typeof e=="function";return this.then(t?function(r){return io(i,e()).then(function(){return r})}:e,t?function(r){return io(i,e()).then(function(){throw r})}:e)}}),N(N.S,"Promise",{try:function(e){var i=ki.f(this);return e=Ui(e),(e.e?i.reject:i.resolve)(e.v),i.promise}});var Gf=it.Promise,Kf=V(function(e){e.exports={default:Gf,__esModule:!0}}),De=tt(Kf),Be=function(e,i){if(!Et(e)||e._t!==i)throw TypeError("Incompatible receiver, "+i+" required!");return e},Qf=kt.f,Fs=yi.fastKey,Jr=Xt?"_s":"size",Hi=function(e,i){var t=Fs(i);if(t!=="F")return e._i[t];for(e=e._f;e;e=e.n)if(e.k==i)return e},uo={getConstructor:function(e,i,t,r){var a=e(function(n,s){bi(n,a,i,"_i"),n._t=i,n._i=we(null),n._f=void 0,n._l=void 0,n[Jr]=0,s!=null&&Ve(s,t,n[r],n)});return no(a.prototype,{clear:function(){for(var n=Be(this,i),s=n._i,o=n._f;o;o=o.n)o.r=!0,o.p&&(o.p=o.p.n=void 0),delete s[o.i];n._f=n._l=void 0,n[Jr]=0},delete:function(n){var s=Be(this,i);if(n=Hi(s,n)){var o=n.n,u=n.p;delete s._i[n.i],n.r=!0,u&&(u.n=o),o&&(o.p=u),s._f==n&&(s._f=o),s._l==n&&(s._l=u),s[Jr]--}return!!n},forEach:function(n){Be(this,i);for(var s=At(n,1<arguments.length?arguments[1]:void 0,3),o;o=o?o.n:this._f;)for(s(o.v,o.k,this);o&&o.r;)o=o.p},has:function(n){return!!Hi(Be(this,i),n)}}),Xt&&Qf(a.prototype,"size",{get:function(){return Be(this,i)[Jr]}}),a},def:function(e,i,t){var r=Hi(e,i),a;return r?r.v=t:(e._l=r={i:a=Fs(i,!0),k:i,v:t,p:i=e._l,n:void 0,r:!1},e._f||(e._f=r),i&&(i.n=r),e[Jr]++,a!=="F"&&(e._i[a]=r)),e},getEntry:Hi,setStrong:function(e,i,t){vn(e,i,function(r,a){this._t=Be(r,i),this._k=a,this._l=void 0},function(){for(var r=this._k,a=this._l;a&&a.r;)a=a.p;return this._t&&(this._l=a=a?a.n:this._t._f)?r=="keys"?Me(0,a.k):r=="values"?Me(0,a.v):Me(0,[a.k,a.v]):(this._t=void 0,Me(1))},t?"entries":"values",!t,!0),Ms(i)}},Jf=_t("species"),qf=function(e,i){if(yn(e)){var t=e.constructor;typeof t!="function"||t!==Array&&!yn(t.prototype)||(t=void 0),Et(t)&&(t=t[Jf],t===null&&(t=void 0))}return new(t===void 0?Array:t)(i)},$f=kt.f,th=function(e,i){var t=e==1,r=e==2,a=e==3,n=e==4,s=e==6,o=e==5||s,u=i||qf;return function(h,v,l){var f=Object(_e(h)),d=an(f);v=At(v,l,3),l=fi(d.length);var c=0;h=t?u(h,l):r?u(h,0):void 0;for(var p,m;l>c;c++)if((o||c in d)&&(p=d[c],m=v(p,c,f),e)){if(t)h[c]=m;else if(m)switch(e){case 3:return!0;case 5:return p;case 6:return c;case 2:h.push(p)}else if(n)return!1}return s?-1:a||n?n:h}}(0);(function(e,i,t,r,a,n){var s=$[e],o=s,u=a?"set":"add",h=o&&o.prototype,v={};return Xt&&typeof o=="function"&&(n||h.forEach&&!Ae(function(){new o().entries().next()}))?(o=i(function(l,f){bi(l,o,e,"_c"),l._c=new s,f!=null&&Ve(f,a,l[u],l)}),th("add clear delete forEach get has set keys values entries toJSON".split(" "),function(l){var f=l=="add"||l=="set";l in h&&(!n||l!="clear")&&ue(o.prototype,l,function(d,c){return bi(this,o,l),!f&&n&&!Et(d)?l=="get"?void 0:!1:(d=this._c[l](d===0?0:d,c),f?this:d)})}),n||$f(o.prototype,"size",{get:function(){return this._c.size}})):(o=r.getConstructor(i,e,a,u),no(o.prototype,t),yi.NEED=!0),ke(o,e),v[e]=o,N(N.G+N.W+N.F,v),n||r.setStrong(o,e,a),o})("Map",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{get:function(e){return(e=uo.getEntry(Be(this,"Map"),e))&&e.v},set:function(e,i){return uo.def(Be(this,"Map"),e===0?0:e,i)}},uo,!0),N(N.P+N.R,"Map",{toJSON:function(e){return function(){if(Mi(this)!=e)throw TypeError(e+"#toJSON isn't generic");var i=[];return Ve(this,!1,i.push,i,void 0),i}}("Map")}),function(e){N(N.S,e,{of:function(){for(var i=arguments.length,t=Array(i);i--;)t[i]=arguments[i];return new this(t)}})}("Map"),function(e){N(N.S,e,{from:function(i,t,r){var a;if(be(this),(a=t!==void 0)&&be(t),i==null)return new this;var n=[];if(a){var s=0,o=At(t,r,2);Ve(i,!1,function(u){n.push(o(u,s++))})}else Ve(i,!1,n.push,n);return new this(n)}})}("Map");var eh=it.Map,rh=V(function(e){e.exports={default:eh,__esModule:!0}}),Oe=tt(rh),qr,$r,ih=(qr={},It(qr,1,1),It(qr,2,1),It(qr,3,1),qr),nh=($r={},It($r,1,1),It($r,2,1),It($r,3,1),$r),Ge=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.vertCount=0,t.bufferMap={},t.bufferData=[],t.autoUpdate=!0,r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.iconHash=new Oe,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:[1,1,1,.8],speed:1,size:5,pointFade:!0,pointFadeBuffer:1,minLineLength:2,animationType:2,shapeType:2,depthTest:!1,delay:0,unit:"px",padding:0}}},{key:"initialize",value:function(t){this.gl=t,this.texture=null,this.isUseTexture=!1;var r=this.getOptions();this.updateUniformsFromOptions(r),this.program=new q(this.gl,{vertexShader:"precision highp float;attribute vec3 aPos;attribute vec3 aNextPos;attribute vec4 aColor;attribute float aIndex;attribute float aNextIndex;attribute float aLength;attribute float aSpeed;attribute float aDelay;attribute vec3 aUV;uniform float uSize;uniform mat4 u_matrix;uniform float uOriginSpeed;uniform float uElapsedSteps;uniform int uAnimationType;uniform int uPointFade;uniform float uPointFadeBuffer;uniform float uZoomUnits;varying float vAddOpacity;varying vec3 vUV;varying vec4 vColor;void main(){vColor=aColor;if(uAnimationType==1){if(abs(aIndex-mod(uElapsedSteps,aLength))>.1){gl_Position=vec4(-2.,-2.,0,1.0);return;}gl_Position=u_matrix*vec4(aPos.xyz,1.0);vAddOpacity=1.;}else if(uAnimationType==2){float lineLength=aLength-1.;float cIndex=mod(uElapsedSteps,lineLength);float rest=cIndex-aIndex;if(rest<1.&&rest>=0.){if(uPointFade==1){if(cIndex<uPointFadeBuffer){vAddOpacity=cIndex/uPointFadeBuffer;}else if(cIndex>lineLength-uPointFadeBuffer){vAddOpacity=(lineLength-cIndex)/uPointFadeBuffer;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}else if(uAnimationType==3){float speedRatio=aSpeed/uOriginSpeed;float percent=mod(mod(uElapsedSteps*aSpeed,aLength)/aLength-aDelay,1.0);if(percent<=aNextIndex&&percent>=aIndex){if(uPointFade==1){float fadePercent=uPointFadeBuffer*1000./aLength;if(percent<fadePercent){vAddOpacity=percent/fadePercent;}else if(percent>1.-fadePercent){vAddOpacity=(1.-percent)/fadePercent;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}float rest=(percent-aIndex)/(aNextIndex-aIndex);gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}vUV=aUV;gl_PointSize=uSize/uZoomUnits;}",fragmentShader:"precision highp float;uniform int ushapeType;uniform bool uUseTexture;uniform sampler2D uSampler;varying float vAddOpacity;varying vec4 vColor;varying vec3 vUV;void main(){if(ushapeType==2){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(vColor.rgb,vColor.a*vAddOpacity);}else if(ushapeType==3){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(vColor.rgb,vColor.a*smoothstep(1.0,0.0,d*2.)*vAddOpacity);}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vAddOpacity);}if(uUseTexture){float ratio=vUV.z;vec2 uv=vUV.xy;gl_FragColor=texture2D(uSampler,vec2(gl_PointCoord.x*ratio+uv.x,1.0-(uv.y+gl_PointCoord.y*ratio)));}}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"bindAttributeBufferData",value:function(t,r,a,n){var s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),a=new Float32Array(a),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),this.bufferMap[r]={buffer:s,data:a,elementSize:n}}},{key:"onChanged",value:function(t,r){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};this.gl&&(Array.isArray(r)||(r=[]),this.processCache(t,r,a))}},{key:"processCache",value:function(t,r,a){var n=this;this.cachedData=[];for(var s=t.icon,o=t.speed,u=t.color,h=0;h<r.length;h++){var v=r[h].geometry.coordinates,l=this.getProperty("color",u,r[h]);l=this.normizedColor(l);var f=this.getProperty("icon",s,r[h]),d=this.getProperty("speed",o,r[h]),c=this.getProperty("delay",0,r[h]);v&&(this.cachedData.push({coordinates:v,color:l,icon:f,speed:d,delay:c}),this.iconHash.get(f)||this.iconHash.set(f,f))}r=Ci(this.iconHash.entries()).filter(function(p){return typeof p[1]=="string"}).map(function(p){var m=nt(p,2)[0];return new De(function(g,x){n.url2canvas(m,function(y){n.iconHash.set(m,y),g()})})}),De.all(r).then(function(p){n.buildSprite(t),a.autoRender!==!1&&n.webglLayer&&n.webglLayer.render()})}},{key:"buildSprite",value:function(t){var r=t.padding,a=this.canvas,n=this.ctx,s=0,o=[],u=new Oe;if(t.icon){s=!0;var h=!1,v=void 0;try{for(var l=rr(this.iconHash),f;!(s=(f=l.next()).done);s=!0){var d=nt(f.value,2),c=d[1];if(typeof c!="string"){var p=c.width,m=p+r;o.push({w:m,h:m,width:p,key:d[0],icon:c})}}}catch(g){h=!0,v=g}finally{try{!s&&l.return&&l.return()}finally{if(h)throw v}}for(l=ye(o),f=0;f<o.length;f++)d=o[f],u.get(d.key)||u.set(d.key,d);for(s=Math.max(oe(l.w),oe(l.h)),a.width=s||1,a.height=s||1,n.save(),a=0;a<o.length;a++)l=o[a],n.drawImage(l.icon,l.x+r,l.y+r,l.width,l.width);n.restore()}this.loadTexture(),this.buildVertex(t,u,s)}},{key:"buildVertex",value:function(t,r,a){var n=this.gl;this.updateUniformsFromOptions(t);for(var s=[],o=[],u=[],h=[],v=[],l=[],f=[],d=[],c=[],p=t.minLineLength,m=0;m<this.cachedData.length;m++){var g=this.cachedData[m],x=g.coordinates,y=g.icon,_=g.speed,A=g.delay;g=g.color;var T=x.length,w=[];if(!(T<p)){for(t.icon&&(w=(w=r.get(y))?[w.x/a,w.y/a,w.w/a]:[0,0,0]),y=0;y<T;++y){var C=this.normizedPoint(x[y]);s.push(C[0]),s.push(C[1]),s.push(C[2]||0),o.push.apply(o,Q(g)),c.push.apply(c,Q(w)),this.animationType!==3&&(u.push(y),v.push(T))}if(this.animationType!==1){for(w=s.length-3*T+3,T=s.length,x=w;x<T;++x)l.push(s[x]);if(s.splice(T-3,3),c.splice(T-3,2),o.splice(T-3,4),this.animationType===2)u.pop(),v.pop();else if(this.animationType===3){for(w-=3,T=s.length-3,x=0,g=[],y=w;y<=T;y+=3)w=Math.sqrt(Math.pow(l[y]-s[y],2)+Math.pow(l[y+1]-s[y+1],2)+Math.pow(l[y+2]-s[y+2],2)),x+=w,g.push(w);for(u.push(0),f.push(_),A/=x/_,d.push(A),y=T=0,C=g.length-1;y<C;++y)T+=g[y],w=T/x,u.push(w),h.push(w),v.push(x),f.push(_),d.push(A);h.push(1),v.push(x)}}}}this.bindAttributeBufferData(n,"aPos",s,3),this.bindAttributeBufferData(n,"aIndex",u,1),this.bindAttributeBufferData(n,"aLength",v,1),this.bindAttributeBufferData(n,"aColor",o,4),this.animationType!==1&&(this.bindAttributeBufferData(n,"aNextPos",l,3),this.animationType===3&&(this.bindAttributeBufferData(n,"aNextIndex",h,1),this.bindAttributeBufferData(n,"aSpeed",f,1),this.bindAttributeBufferData(n,"aDelay",d,1))),t.icon&&this.bindAttributeBufferData(n,"aUV",c,3),this.vertCount=s.length/3}},{key:"updateUniformsFromOptions",value:function(t){this.startTime=new Date().getTime(),ih[t.animationType]||(t.animationType=2),nh[t.shapeType]||(t.shapeType=2),(isNaN(t.minLineLength)||2>t.minLineLength)&&(t.minLineLength=2),this.animationType=t.animationType}},{key:"renderAttributeArr",value:function(t,r,a){if(r.attributes[a]!==void 0){var n=this.bufferMap[a];n&&(t.bindBuffer(t.ARRAY_BUFFER,n.buffer),t.enableVertexAttribArray(r.attributes[a]),t.vertexAttribPointer(r.attributes[a],n.elementSize,t.FLOAT,!1,n.data.BYTES_PER_ELEMENT*n.elementSize,0))}}},{key:"render",value:function(t){var r=t.gl;if(t=t.matrix,!(0>=this.vertCount)){var a=this.getOptions(),n=this.program;r.useProgram(n.program),this.renderAttributeArr(r,n,"aPos"),this.renderAttributeArr(r,n,"aIndex"),this.renderAttributeArr(r,n,"aLength"),this.renderAttributeArr(r,n,"aColor"),this.animationType!==1&&(this.renderAttributeArr(r,n,"aNextPos"),this.animationType===3&&(this.renderAttributeArr(r,n,"aNextIndex"),this.renderAttributeArr(r,n,"aSpeed"),this.renderAttributeArr(r,n,"aDelay"))),a.icon&&this.texture&&(this.renderAttributeArr(r,n,"aUV"),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(n.uniforms.uSampler,0)),r.uniform1i(n.uniforms.uUseTexture,this.isUseTexture);var s=new Date().getTime()-this.startTime;s<this.options.delay?s=0:(s-=this.options.delay,s=this.animationType===1?Math.round(s/1e3*this.options.speed*20):this.animationType===3?s/1e3*this.options.speed*1e3:s/1e3*this.options.speed);var o=this.options.size;if(Array.isArray(o)){var u=this.map.map.getMaxZoom(),h=this.map.map.getMinZoom();o=o[0]+(this.map.getZoom()-h)/(u-h)*(o[1]-o[0])}r.uniformMatrix4fv(n.uniforms.u_matrix,!1,t),r.uniform1f(n.uniforms.uSize,o),r.uniform1f(n.uniforms.uElapsedSteps,s),r.uniform1f(n.uniforms.uOriginSpeed,this.options.speed),r.uniform1i(n.uniforms.uAnimationType,this.animationType),r.uniform1i(n.uniforms.ushapeType,this.options.shapeType),r.uniform1i(n.uniforms.uPointFade,this.options.pointFade?1:0),r.uniform1f(n.uniforms.uPointFadeBuffer,this.options.pointFadeBuffer),r.uniform1f(n.uniforms.uZoomUnits,this.options.unit==="m"?this.map.getZoomUnits():1),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:a.blend==="lighter"?[r.SRC_ALPHA,r.ONE]:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],depthTest:!!a.depthTest}),r.drawArrays(r.POINTS,0,this.vertCount)}}},{key:"url2canvas",value:function(t,r){if((typeof t=="undefined"?"undefined":Ut(t))==="object")r(t);else{var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var n=document.createElement("canvas");n.width=128,n.height=128,n.getContext("2d").drawImage(a,0,0,128,128),r(n)},a.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas&&this.getOptions().icon?Pt(this.gl,this.canvas,function(r){t.isUseTexture=!0,t.texture=r}):(this.isUseTexture=!1,this.texture=null)}}]),i}(rt);Ge.ANIMATION_TYPE_LEAP=1,Ge.ANIMATION_TYPE_SMOOTH=2,Ge.ANIMATION_TYPE_UNIFORM_SPEED=3,Ge.SHAPE_TYPE_SQUARE=1,Ge.SHAPE_TYPE_CIRCLE=2,Ge.SHAPE_TYPE_CIRCLE_GRADIENT=3;var oh=function(){function e(i,t){O(this,e),this.layer=i,this.gl=t,this.initData()}return I(e,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(i,t){this.initData();for(var r=i.color,a=i.height,n=i.gradient,s=i.enablePreciseMap,o=i.repeatMap,u=i.closePath,h=this.gl,v=0;v<t.length;v++){var l=t[v],f=l.color||r;"properties"in l&&"color"in l.properties&&(f=l.properties.color),n||Object.prototype.toString.call(f)!=="[object Function]"||(f=f(l));var d=this.layer.normizedColor(n?n[0]:f);f=this.layer.normizedColor(n?n[1]:f);var c=l.height||a;if("properties"in l&&"height"in l.properties&&(c=l.properties.height),Object.prototype.toString.call(c)==="[object Function]"&&(c=c(l)),l.geometry.type==="MultiLineString"||l.geometry.type==="Polygon")for(var p=0;p<l.geometry.coordinates.length;p++){var m=l.geometry.coordinates[p];u&&!Vi(m)&&m.push(m[0]);for(var g=[],x=[],y=0,_=0;_<m.length;_++){var A=this.layer.normizedPoint(m[_]);if(0<_&&(s||o)){var T=this.layer.normizedPoint(m[_-1]);y+=Math.sqrt(Math.pow(A[0]-T[0],2)+Math.pow(A[1]-T[1],2))}g.push(A),x.push(y)}this.processData(this.outWall3d,i,g,x,d,f,c)}else{for(l=l.geometry.coordinates,u&&!Vi(l)&&l.push(l[0]),p=[],m=[],x=g=0;x<l.length;x++)y=this.layer.normizedPoint(l[x]),0<x&&(s||o)&&(_=this.layer.normizedPoint(l[x-1]),g+=Math.sqrt(Math.pow(y[0]-_[0],2)+Math.pow(y[1]-_[1],2))),p.push(y),m.push(g);this.processData(this.outWall3d,i,p,m,d,f,c)}}for(i=0;i<this.outWall3d.vertex.length;i++){for(t=[],r=this.outWall3d.vertex[i].length,a=0;a<r;a++)t.push.apply(t,Q(this.outWall3d.vertex[i][a]));r=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,r),h.bufferData(h.ARRAY_BUFFER,new Float32Array(t),h.STATIC_DRAW),this.outWall3d.vertexBuffer[i]=r,h.bindBuffer(h.ARRAY_BUFFER,null),r=h.createBuffer(),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[i]),h.STATIC_DRAW),this.outWall3d.indexBuffer[i]=r,h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(i,t,r,a,n,s,o){var u=a[a.length-1],h=i.vertex[i.vertex.length-1],v=i.index[i.index.length-1],l=r.length;for((!v||65536<=v.length+2*l+2)&&(h=[],v=[],i.vertex.push(h),i.index.push(v)),(i=h.length)&&v.push(i-1,i),i=0;i<l;i++){var f=[],d=[],c=r[i];f.push(c[0],c[1],c[2]+o),f.push(n[0],n[1],n[2],n[3]),d.push(c[0],c[1],c[2]),d.push(s[0],s[1],s[2],s[3]),t.texture&&(c=a[i],t.enablePreciseMap||t.repeatMap?(f.push(c,1,u),d.push(c,0,u)):(f.push(i,1,l-1),d.push(i,0,l-1))),c=h.length,h.push(f,d),v.push(c,c+1)}}}]),e}(),ah=function(e){function i(t,r){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t,r))}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,repeatMap:0,height:100,closePath:!1,color:[1,1,1,1]}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new oh(this,this.gl),this.texture=null,this.isUseTexture=!1,this.vertexLength=10,this.program=new q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;attribute float aTotalDistance;varying vec2 vTextureCoords;varying float vTotalDistance;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;vTotalDistance=aTotalDistance;}gl_Position=u_matrix*vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform bool uUseTexture;uniform float uDistance;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying float vTotalDistance;varying vec4 vColor;void main(){if(uUseTexture){float uvx=vTextureCoords.x/vTotalDistance;if(uDistance>0.0){uvx=mod(vTextureCoords.x,uDistance)/uDistance;}gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vec2(uvx,vTextureCoords.y));}else{gl_FragColor=vColor;}}"}),this.loadTexture()}},{key:"onChanged",value:function(t,r){var a=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){a.loadTexture(function(){a.dataMgr.onLayerChange(t,r),a.webglLayer.render()})},0))}},{key:"render",value:function(t){var r=t.gl,a=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),s=this.program;if(r.useProgram(s.program),n.texture){if(!this.texture)return;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(s.uniforms.uSampler,0)}for(this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],depthMask:!!n.texture,depthFunc:n.texture?r.LESS:r.LEQUAL}),n.texture?r.enableVertexAttribArray(s.attributes.aTextureCoords):r.disableVertexAttribArray(s.attributes.aTextureCoords),r.enableVertexAttribArray(s.attributes.aPos),r.enableVertexAttribArray(s.attributes.aColor),r.uniformMatrix4fv(s.uniforms.u_matrix,!1,a),r.uniform1i(s.uniforms.uUseTexture,this.isUseTexture),r.uniform1f(s.uniforms.uDistance,n.repeatMap),a=0;a<t.vertex.length;a++)if(!(0>=t.vertex[a].length)){var o=t.vertex[a],u=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=u*o[0].length,r.bindBuffer(r.ARRAY_BUFFER,t.vertexBuffer[a]),r.vertexAttribPointer(s.attributes.aPos,3,r.FLOAT,!1,o,0),r.vertexAttribPointer(s.attributes.aColor,4,r.FLOAT,!1,o,3*u),n.texture&&(r.vertexAttribPointer(s.attributes.aTextureCoords,2,r.FLOAT,!1,o,7*u),r.vertexAttribPointer(s.attributes.aTotalDistance,1,r.FLOAT,!1,o,9*u)),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer[a]),r.drawElements(r.TRIANGLE_STRIP,t.index[a].length,r.UNSIGNED_SHORT,0),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}}}},{key:"loadTexture",value:function(t){var r=this,a=this.getOptions();a.texture?(this.isUseTexture=!0,Pt(this.gl,a.texture,function(n,s){r.image=s,r.texture=n,t&&t(),r.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),i}(rt),sh=function(){function e(i,t){O(this,e),this.layer=i,this.gl=t,this.initData()}return I(e,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(i,t){this.initData();var r=i.color,a=i.height,n=i.gradient;i=this.gl;for(var s=0;s<t.length;s++){var o=t[s].geometry.coordinates,u=o.length;this.maxLength=u>this.maxLength?u:this.maxLength;for(var h=[],v=0;v<u;v++){var l=this.layer.normizedPoint(o[v]);h.push(l)}u=t[s].color||r,"properties"in t[s]&&"color"in t[s].properties&&(u=t[s].properties.color),n||Object.prototype.toString.call(u)!=="[object Function]"||(u=u(t[s])),o=this.layer.normizedColor(n?n[0]:u),u=this.layer.normizedColor(n?n[1]:u),v=t[s].height||a,"properties"in t[s]&&"height"in t[s].properties&&(v=t[s].properties.height),Object.prototype.toString.call(v)==="[object Function]"&&(v=v(t[s])),this.processData(this.outWall3d,h,o,u,v)}for(t=0;t<this.outWall3d.vertex.length;t++){for(r=[],a=this.outWall3d.vertex[t].length,n=0;n<a;n++)r.push.apply(r,Q(this.outWall3d.vertex[t][n]));a=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,new Float32Array(r),i.STATIC_DRAW),this.outWall3d.vertexBuffer[t]=a,i.bindBuffer(i.ARRAY_BUFFER,null),a=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[t]),i.STATIC_DRAW),this.outWall3d.indexBuffer[t]=a,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(i,t,r,a,n){var s=i.vertex[i.vertex.length-1],o=i.index[i.index.length-1],u=t.length;for((!o||65536<=o.length+2*u+2)&&(s=[],o=[],i.vertex.push(s),i.index.push(o)),(i=s.length)&&o.push(i-1,i),i=0;i<u;i++){var h=[],v=[],l=t[i];h.push(l[0],l[1]),h.push(l[2]?Number(l[2])+n:n),h.push(l[3]?Number(l[3]):i),h.push(r[0],r[1],r[2],r[3]),v.push(l[0],l[1]),v.push(l[2]?Number(l[2]):0),v.push(l[3]?Number(l[3]):i),v.push(a[0],a[1],a[2],a[3]),l=s.length,s.push(h,v),o.push(l,l+1)}}}]),e}(),uh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new sh(this,this.gl),this.program=new q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},{key:"onChanged",value:function(t,r){this.gl&&(this.dataMgr.onLayerChange(t,r),t.endTime===void 0&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var r=t.gl,a=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),s=this.program;for(r.useProgram(s.program),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA]}),r.enableVertexAttribArray(s.attributes.aPos),r.enableVertexAttribArray(s.attributes.aColor),r.uniformMatrix4fv(s.uniforms.u_matrix,!1,a),r.uniform1f(s.uniforms.currentTime,this.time),r.uniform1f(s.uniforms.trailLength,n.trailLength),a=0;a<t.vertex.length;a++)if(!(0>=t.vertex[a].length)){var o=t.vertex[a],u=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=u*o[0].length,r.bindBuffer(r.ARRAY_BUFFER,t.vertexBuffer[a]),r.vertexAttribPointer(s.attributes.aPos,4,r.FLOAT,!1,o,0),r.vertexAttribPointer(s.attributes.aColor,4,r.FLOAT,!1,o,4*u),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer[a]),r.drawElements(r.TRIANGLE_STRIP,t.index[a].length,r.UNSIGNED_SHORT,0),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}this.time+=n.step,this.time>this.endTime&&(this.time=this.startTime)}}}]),i}(rt),lh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.simpleLineLayer=new hs(t.getHeatOptions()),t.children=[t.simpleLineLayer],t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(t){this.simpleLineLayer.setData(t)}},{key:"onOptionsChanged",value:function(t){this.simpleLineLayer.setOptions(this.getHeatOptions())}},{key:"getHeatOptions",value:function(){var t=this.getOptions(),r=t.max,a=t.min;r===void 0&&(a=this.getDataRange(),r=a.max,a=a.min);var n=new St({max:r,min:a,gradient:t.gradient});return t.color=function(s){var o=~~s.count||1;return"properties"in s&&"count"in s.properties&&(o=~~s.properties.count),s=n.getImageData(o),[s[0]/255,s[1]/255,s[2]/255,s[3]/255]},t}},{key:"getDataRange",value:function(){var t=this.getData(),r=0,a=0;t[0]&&(r=~~t[0].count||1,a=~~t[0].count||1),"properties"in t[0]&&"count"in t[0].properties&&(r=~~t[0].properties.count,a=~~t[0].properties.count);for(var n=t.length,s=0;s<n;s++){var o=~~t[s].count||1;"properties"in t[s]&&"count"in t[s].properties&&(o=~~t[s].properties.count),r=Math.max(o,r),a=Math.min(o,a)}return{max:r/2,min:a}}}]),i}(pe),Ds=V(function(e,i){(function(t,r){e.exports=r()})(Ro,function(){function t(x,y,_,A,T,w){if(!(T-A<=_)){var C=A+T>>1;r(x,y,C,A,T,w%2),t(x,y,_,A,C-1,w+1),t(x,y,_,C+1,T,w+1)}}function r(x,y,_,A,T,w){for(;T>A;){if(600<T-A){var C=T-A+1,M=_-A+1,E=Math.log(C),P=.5*Math.exp(2*E/3);E=.5*Math.sqrt(E*P*(C-P)/C)*(0>M-C/2?-1:1),r(x,y,_,Math.max(A,Math.floor(_-M*P/C+E)),Math.min(T,Math.floor(_+(C-M)*P/C+E)),w)}for(C=y[2*_+w],M=A,P=T,a(x,y,A,_),y[2*T+w]>C&&a(x,y,A,T);M<P;){for(a(x,y,M,P),M++,P--;y[2*M+w]<C;)M++;for(;y[2*P+w]>C;)P--}y[2*A+w]===C?a(x,y,A,P):(P++,a(x,y,P,T)),P<=_&&(A=P+1),_<=P&&(T=P-1)}}function a(x,y,_,A){n(x,_,A),n(y,2*_,2*A),n(y,2*_+1,2*A+1)}function n(x,y,_){var A=x[y];x[y]=x[_],x[_]=A}function s(x,y){return x=x.geometry.coordinates,{x:x[0]/360+.5,y:h(x[1]),zoom:1/0,index:y,parentId:-1}}function o(x){var y=x.id,_=u(x);return{type:"Feature",id:y,properties:_,geometry:{type:"Point",coordinates:[360*(x.x-.5),360*Math.atan(Math.exp((180-360*x.y)*Math.PI/180))/Math.PI-90]}}}function u(x){var y=x.numPoints,_=1e4<=y?Math.round(y/1e3)+"k":1e3<=y?Math.round(y/100)/10+"k":y;return v(v({},x.properties),{cluster:!0,cluster_id:x.id,point_count:y,point_count_abbreviated:_})}function h(x){return x=Math.sin(x*Math.PI/180),x=.5-.25*Math.log((1+x)/(1-x))/Math.PI,0>x?0:1<x?1:x}function v(x,y){for(var _ in y)x[_]=y[_];return x}function l(x){return x.x}function f(x){return x.y}var d=function(x){return x[0]},c=function(x){return x[1]},p=function(x,y,_,A,T){y===void 0&&(y=d),_===void 0&&(_=c),A===void 0&&(A=64),T===void 0&&(T=Float64Array),this.nodeSize=A,this.points=x;var w=this.ids=new(65536>x.length?Uint16Array:Uint32Array)(x.length);T=this.coords=new T(2*x.length);for(var C=0;C<x.length;C++)w[C]=C,T[2*C]=y(x[C]),T[2*C+1]=_(x[C]);t(w,T,A,0,w.length-1,0)};p.prototype.range=function(x,y,_,A){for(var T=this.ids,w=this.coords,C=this.nodeSize,M=[0,T.length-1,0],E=[],P,L;M.length;){var R=M.pop(),b=M.pop(),H=M.pop();if(b-H<=C)for(R=H;R<=b;R++)P=w[2*R],L=w[2*R+1],P>=x&&P<=_&&L>=y&&L<=A&&E.push(T[R]);else{var S=Math.floor((H+b)/2);P=w[2*S],L=w[2*S+1],P>=x&&P<=_&&L>=y&&L<=A&&E.push(T[S]);var D=(R+1)%2;(R===0?x<=P:y<=L)&&(M.push(H),M.push(S-1),M.push(D)),(R===0?_>=P:A>=L)&&(M.push(S+1),M.push(b),M.push(D))}}return E},p.prototype.within=function(x,y,_){for(var A=this.ids,T=this.coords,w=this.nodeSize,C=[0,A.length-1,0],M=[],E=_*_;C.length;){var P=C.pop(),L=C.pop(),R=C.pop();if(L-R<=w)for(P=R;P<=L;P++){R=T[2*P]-x;var b=T[2*P+1]-y;R*R+b*b<=E&&M.push(A[P])}else{b=Math.floor((R+L)/2);var H=T[2*b],S=T[2*b+1],D=H-x,Z=S-y;D*D+Z*Z<=E&&M.push(A[b]),D=(P+1)%2,(P===0?x-_<=H:y-_<=S)&&(C.push(R),C.push(b-1),C.push(D)),(P===0?x+_>=H:y+_>=S)&&(C.push(b+1),C.push(L),C.push(D))}}return M};var m={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(x){return x}},g=function(x){this.options=v(il(m),x),this.trees=Array(this.options.maxZoom+1)};return g.prototype.load=function(x){var y=this.options,_=y.minZoom,A=y.maxZoom;y=y.nodeSize,this.points=x;for(var T=[],w=0;w<x.length;w++)x[w].geometry&&T.push(s(x[w],w));for(this.trees[A+1]=new p(T,l,f,y,Float32Array),x=A;x>=_;x--)T=this._cluster(T,x),this.trees[x]=new p(T,l,f,y,Float32Array);return this},g.prototype.getClusters=function(x,y){var _=((x[0]+180)%360+360)%360-180,A=Math.max(-90,Math.min(90,x[1])),T=x[2]===180?180:((x[2]+180)%360+360)%360-180,w=Math.max(-90,Math.min(90,x[3]));if(360<=x[2]-x[0])_=-180,T=180;else if(_>T)return _=this.getClusters([_,A,180,w],y),A=this.getClusters([-180,A,T,w],y),_.concat(A);y=this.trees[this._limitZoom(y)],x=[];var C=0;for(A=y.range(_/360+.5,h(w),T/360+.5,h(A));C<A.length;C+=1)T=y.points[A[C]],x.push(T.numPoints?o(T):this.points[T.index]);return x},g.prototype.getChildren=function(x){var y=this._getOriginId(x),_=this._getOriginZoom(x),A=this.trees[_];if(!A)throw Error("No cluster with the specified id.");var T=A.points[y];if(!T)throw Error("No cluster with the specified id.");y=[];var w=0;for(_=A.within(T.x,T.y,this.options.radius/(this.options.extent*Math.pow(2,_-1)));w<_.length;w+=1)T=A.points[_[w]],T.parentId===x&&y.push(T.numPoints?o(T):this.points[T.index]);if(y.length===0)throw Error("No cluster with the specified id.");return y},g.prototype.getLeaves=function(x,y,_){var A=[];return this._appendLeaves(A,x,y||10,_||0,0),A},g.prototype.getTile=function(x,y,_){var A=this.trees[this._limitZoom(x)];x=Math.pow(2,x);var T=this.options;T=T.radius/T.extent;var w=(_-T)/x,C=(_+1+T)/x,M={features:[]};return this._addTileFeatures(A.range((y-T)/x,w,(y+1+T)/x,C),A.points,y,_,x,M),y===0&&this._addTileFeatures(A.range(1-T/x,w,1,C),A.points,x,_,x,M),y===x-1&&this._addTileFeatures(A.range(0,w,T/x,C),A.points,-1,_,x,M),M.features.length?M:null},g.prototype.getClusterExpansionZoom=function(x){for(var y=this._getOriginZoom(x)-1;y<=this.options.maxZoom&&(x=this.getChildren(x),y++,x.length===1);)x=x[0].properties.cluster_id;return y},g.prototype._appendLeaves=function(x,y,_,A,T){var w=0;for(y=this.getChildren(y);w<y.length;w+=1){var C=y[w],M=C.properties;if(M&&M.cluster?T=T+M.point_count<=A?T+M.point_count:this._appendLeaves(x,M.cluster_id,_,A,T):T<A?T++:x.push(C),x.length===_)break}return T},g.prototype._addTileFeatures=function(x,y,_,A,T,w){for(var C=0;C<x.length;C+=1){var M=y[x[C]],E=M.numPoints,P={type:1,geometry:[[Math.round(this.options.extent*(M.x*T-_)),Math.round(this.options.extent*(M.y*T-A))]],tags:E?u(M):this.points[M.index].properties},L=void 0;E?L=M.id:this.options.generateId?L=M.index:this.points[M.index].id&&(L=this.points[M.index].id),L!==void 0&&(P.id=L),w.features.push(P)}},g.prototype._limitZoom=function(x){return Math.max(this.options.minZoom,Math.min(+x,this.options.maxZoom+1))},g.prototype._cluster=function(x,y){var _=[],A=this.options,T=A.reduce,w=A.minPoints;A=A.radius/(A.extent*Math.pow(2,y));for(var C=0;C<x.length;C++){var M=x[C];if(!(M.zoom<=y)){M.zoom=y;for(var E=this.trees[y+1],P=E.within(M.x,M.y,A),L=M.numPoints||1,R=L,b=0,H=P;b<H.length;b+=1){var S=E.points[H[b]];S.zoom>y&&(R+=S.numPoints||1)}if(R>=w){b=M.x*L,H=M.y*L,L=T&&1<L?this._map(M,!0):null,S=(C<<5)+(y+1)+this.points.length;for(var D=0;D<P.length;D+=1){var Z=E.points[P[D]];if(!(Z.zoom<=y)){Z.zoom=y;var X=Z.numPoints||1;b+=Z.x*X,H+=Z.y*X,Z.parentId=S,T&&(L||(L=this._map(M,!0)),T(L,this._map(Z)))}}M.parentId=S,_.push({x:b/R,y:H/R,zoom:1/0,id:S,parentId:-1,numPoints:R,properties:L})}else if(_.push(M),1<R)for(M=0,R=P;M<R.length;M+=1)P=E.points[R[M]],P.zoom<=y||(P.zoom=y,_.push(P))}}return _},g.prototype._getOriginId=function(x){return x-this.points.length>>5},g.prototype._getOriginZoom=function(x){return(x-this.points.length)%32},g.prototype._map=function(x,y){if(x.numPoints)return y?v({},x.properties):x.properties;x=this.points[x.index].properties;var _=this.options.map(x);return y&&_===x?v({},_):_},g})}),fh=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.shapeLayer=new Ii(t.options),t.textLayer=new Yr(t.options.textOptions),t.children=[t.shapeLayer,t.textLayer],t.max=[],t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{size:50,height:0,maxZoom:19,minZoom:5,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},enableCluster:!1,showText:!0,textOptions:{fontSize:13,color:"white"}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},r=this.options.textOptions;t.textOptions&&K(r,t.textOptions);var a=t.minZoom,n=t.maxZoom,s=t.size;a=n&&n!==this.options.maxZoom||a&&a!==this.options.minZoom||s&&s!==this.options.size,K(this.options,t,{textOptions:r}),a?this.onChanged(this.options,this.data):this.refreshLayer(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,r){if(r&&r.length){this.zoom=Math.floor(this.map.getZoom());var a=t.maxZoom,n=t.minZoom,s=t.enableCluster;t=t.size,this.zoom>a?this.zoom=a:this.zoom<n&&(this.zoom=n),s&&(this.supercluster=new Ds({maxZoom:a,minZoom:n,radius:t/2}),this.supercluster.load(r)),this.refreshLayer()}}},{key:"refreshLayer",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.options,r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.data,a=this.map,n=this.zoom;if(t.enableCluster&&this.supercluster&&(r=this.getClusterData(t)),r&&r.length){var s=t.gradient,o=t.showText,u=t.textOptions,h=t.height,v=t.size;v*=Math.pow(2,18-n),r=au(r,v,function(d){var c=nt(d,2),p=c[0];return c=c[1],-180<=p&&180>=p&&-90<=c&&90>=c&&(c=a.lnglatToMercator(p,c),p=c[0],c=c[1]),d[0]=p,d[1]=c,d}),this.max[n]=Math.max(this.max[n]||0,r.max);var l=new St({max:this.max[n],min:0,maxSize:h*Math.pow(2,18-n),minSize:0,gradient:s});if(s=[],o){var f=u&&u.format;f=typeof f=="function"?f:null,s=r.map(function(d){return{geometry:{coordinates:[d.center.x,d.center.y,l.getSize(d.count)+u.fontSize/2*Math.pow(2,18-n)]},text:f?f(d.count):d.count}})}this.textLayer.setData(s),o=r.map(function(d){for(var c=d.center,p=r.r,m=[],g=0;6>g;g++)m.push(ou({x:c.x,y:c.y},p,g));return{geometry:{type:"Polygon",coordinates:[m]},properties:{height:l.getSize(d.count),color:l.getColor(d.count)}}}),this.shapeLayer.setData(o),t.enablePicked&&t.autoSelect&&this.pick(-1,-1)}}},{key:"getClusterData",value:function(){var t=this.map,r=t.getBounds(),a=r.ne;r=r.sw,this.ne=a,this.sw=r;var n=a,s=n.lng;n=n.lat;var o=[];return-180<=s&&180>=s&&-90<=n&&90>=n?o=[r.lng,r.lat,a.lng,a.lat]:(a=t.mercatorToLnglat(this.ne.lng,this.ne.lat),r=t.mercatorToLnglat(this.sw.lng,this.sw.lat),o=r.concat(a)),this.supercluster.getClusters(o,this.zoom).map(function(u){var h=0;return u.properties&&u.properties.point_count&&(h=u.properties.point_count),{geometry:u.geometry,count:h}})}},{key:"pick",value:function(t,r){return this.shapeLayer.pick(t,r)}},{key:"shouldUpdate",value:function(){if(!this.data)return!1;var t=this.map,r=Math.floor(t.getZoom()),a=this.options,n=a.maxZoom;if(a=a.minZoom,r>n?r=n:r<a&&(r=a),this.zoom!==r)return this.zoom=r,!0;if(!this.options.enableCluster||(r=t.getBounds(),t=r.ne,r=r.sw,!(t&&r&&this.ne&&this.sw)))return!1;if(this.ne.lng!==t.lng||this.ne.lat!==t.lat||this.sw.lng!==r.lng||this.sw.lat!==r.lat)return!0}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshLayer():ve(i.prototype.__proto__||U(i.prototype),"render",this).call(this,t)}}]),i}(pe),ti=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.name="PointLayer",t.bufferData=[],t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"default",shape:"circle",size:5,unit:"px",borderWidth:0,borderColor:[1,1,1,.9],polygonOffset:[0,0],depthTest:!0}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions(),a=[];r.enablePicked&&a.push("PICK"),r.shape&&r.shape==="circle"&&a.push("SHAPE_CIRCLE"),this.program=new q(this.gl,{vertexShader:`attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aBorderWidth;attribute vec4 aBorderColor;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;varying vec4 vColor;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float size=aSize*devicePixelRatio;float borderWidth=aBorderWidth*devicePixelRatio;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=uUnitPx ? size : size/zoomUnits;vSize=size;vBorderWidth=borderWidth;vBorderColor=aBorderColor;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,fragmentShader:`varying vec4 vColor;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;void main(void){vec4 color=vColor;
#if defined(SHAPE_CIRCLE)
float d=distance(gl_PointCoord,vec2(0.5,0.5));float ratio=1.0-vBorderWidth/vSize*2.0;if(d>0.5){discard;}if(d>ratio*0.5){color=vBorderColor;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;
#else
float ratio=vBorderWidth/vSize;if(gl_PointCoord.x<ratio||gl_PointCoord.x>1.0-ratio||gl_PointCoord.y<ratio||gl_PointCoord.y>1.0-ratio){color=vBorderColor;}
#endif
gl_FragColor=color;}`,defines:a},this),this.buffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{stride:52,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:52,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:52,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28},{stride:52,name:"aBorderWidth",buffer:this.buffer,size:1,type:"FLOAT",offset:32},{stride:52,name:"aBorderColor",buffer:this.buffer,size:4,type:"FLOAT",offset:36}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,r){if(this.gl){for(var a=[],n=t.color,s=t.size,o=t.borderWidth,u=t.borderColor,h=0;h<r.length;h++){var v=this.normizedPoint(r[h].geometry.coordinates),l=this.getProperty("color",n,r[h]);l=this.normizedColor(l);var f=this.getProperty("size",s,r[h]);f=Number(f);var d=this.getProperty("borderWidth",o,r[h]);d=Number(d);var c=this.getProperty("borderColor",u,r[h]);c=this.normizedColor(c),v=this.addMultipleCoords(v);for(var p=0;p<v.length;p++){var m=v[p];a.push(m[0],m[1],Number(m[2]||0)),a.push(l[0],l[1],l[2],l[3]),a.push(f),a.push(d,c[0],c[1],c[2],c[3])}}this.bufferData=a,this.buffer.updateData(new Float32Array(a)),t.enablePicked&&this.parsePickData(r)}}},{key:"parsePickData",value:function(t){var r=this.getOptions(),a=[];if(r.enablePicked)for(var n=0;n<t.length;n++){var s=this.indexToRgb(n);a.push(s[0]/255,s[1]/255,s[2]/255),r.repeat&&(a.push(s[0]/255,s[1]/255,s[2]/255),a.push(s[0]/255,s[1]/255,s[2]/255))}r.enablePicked&&this.pickBuffer.updateData(new Float32Array(a))}},{key:"render",value:function(t){var r=t.gl,a=t.matrix,n=t.isPickRender;if(!(0>=this.bufferData.length)){var s=this.getOptions(),o=this.program;o.use(r),t=this.getCommonUniforms(t),t=K(t,{uMatrix:a,uUnitPx:s.unit==="px",zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio}),o.setUniforms(t),this.setGLState({blend:!n,blendFunc:se(r,s.blend),blendEquation:r.FUNC_ADD,polygonOffset:s.polygonOffset,depthTest:s.depthTest}),this.vertexArray.bind(),r.drawArrays(r.POINTS,0,this.bufferData.length/13)}}}]),i}(rt),hh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="GroundRippleLayer",t.bufferDataArr=[],t.indexDataArr=[],t.vertexBuffer=[],t.indexBuffer=[],t.position=[],t.opacity=1,t.currentScale=1,t.autoUpdate=!0,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],size:5,segs:32,scale:2,unit:"m",step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new q(this.gl,{vertexShader:"uniform mat4 u_projectionMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_modelMatrix;uniform float u_opacity;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){vColor=aColor;vColor.a=u_opacity;gl_Position=u_projectionMatrix*u_modelViewMatrix*u_modelMatrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;void main(){if(vColor.a==0.0){discard;}gl_FragColor=vColor;}"})}},{key:"onDestroy",value:function(){this.bufferDataArr=[],this.indexDataArr=[],this.vertexBuffer=[],this.indexBuffer=[]}},{key:"onChanged",value:function(t,r){var a=this.gl;if(a&&(this.currentScale=this.opacity=1,(this.data=r)&&r.length)){var n=t.color,s=t.segs;t=t.size;for(var o=360/s,u=0;u<r.length;u++){var h=[],v=[],l=this.normizedPoint(r[u].geometry.coordinates),f=n;Object.prototype.toString.call(f)==="[object Function]"?f=f(r[u]):(f=r[u].color||n,"properties"in r[u]&&"color"in r[u].properties&&(f=r[u].properties.color)),f=this.normizedColor(f);var d=Object.prototype.toString.call(t)==="[object Function]"?t(r[u]):Number(t),c=l[0],p=l[1];h.push(0,0,-.5),h.push(f[0],f[1],f[2],0);for(var m=1,g=0;m<=s;m++,g+=o)h.push(l[0]-c+Math.cos(Math.PI/180*g)*d,l[1]-p+Math.sin(Math.PI/180*g)*d,-.5),h.push(f[0],f[1],f[2],this.opacity),m===s?v.push(0,0+m,1):v.push(0,0+m,0+m+1);f=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,f),a.bufferData(a.ARRAY_BUFFER,new Float32Array(h),a.STATIC_DRAW),this.vertexBuffer[u]=f,this.bufferDataArr[u]=h,a.bindBuffer(a.ARRAY_BUFFER,null),h=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,h),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(v),a.STATIC_DRAW),this.indexBuffer[u]=h,this.indexDataArr[u]=v,a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),this.position[u]=[l[0],l[1]]}this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var r=t.gl,a=t.projectionMatrix,n=t.viewMatrix;for(t=this.program,r.useProgram(t.program),r.uniformMatrix4fv(t.uniforms.u_projectionMatrix,!1,a),r.uniformMatrix4fv(t.uniforms.u_modelViewMatrix,!1,n),a=this.opacity,this.options.opacity!==void 0&&(a=this.options.opacity),r.uniform1f(t.uniforms.u_opacity,a),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:[r.SRC_ALPHA,r.DST_ALPHA]}),r.enableVertexAttribArray(t.attributes.aPos),r.enableVertexAttribArray(t.attributes.aColor),a=0;a<this.bufferDataArr.length;a++)if(!(0>=this.bufferDataArr[a].length)){n=new Float32Array(this.bufferDataArr[a]).BYTES_PER_ELEMENT,r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer[a]),r.vertexAttribPointer(t.attributes.aColor,4,r.FLOAT,!1,7*n,3*n),r.vertexAttribPointer(t.attributes.aPos,3,r.FLOAT,!1,7*n,0),n=this.position[a];var s=z.create(),o=[this.currentScale,this.currentScale,this.currentScale];this.options.unit==="px"&&this.map&&(o=this.map.getZoomUnits(),o=[this.currentScale*o,this.currentScale*o,this.currentScale]),z.identity(s),z.translate(s,s,[n[0],n[1],0]),z.scale(s,s,o),r.uniformMatrix4fv(t.uniforms.u_modelMatrix,!1,s),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer[a]),r.drawElements(r.TRIANGLES,this.indexDataArr[a].length,r.UNSIGNED_SHORT,0),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}t=this.getOptions(),r=t.scale,t=t.step,this.opacity-=t/10,this.currentScale+=r*t,0>this.opacity&&(this.currentScale=this.opacity=1)}}]),i}(rt),ch=function(e){function i(t){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.name="RippleLayer",t.bufferData=[],t.date=new Date,t.autoUpdate=!0,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{depthTest:!0,polygonOffset:[0,0],color:[.1,.1,.9,1],blend:"normal",size:20,unit:"px",duration:2}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.program=new q(this.gl,{vertexShader:`attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform float uTime;uniform float duration;uniform float zoomUnits;varying vec4 vColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float percent=mod(uTime,duration)/duration;vColor.a=1.-percent;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize/zoomUnits*percent;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,fragmentShader:"varying vec4 vColor;void main(void){vec4 color=vColor;float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}",defines:r.enablePicked?["PICK"]:[]},this),this.buffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,r){if(this.gl){for(var a=[],n=t.color,s=t.size,o=0;o<r.length;o++){var u=r[o].geometry.coordinates,h=n;Object.prototype.toString.call(h)==="[object Function]"?h=h(r[o]):(h=r[o].color||n,"properties"in r[o]&&"color"in r[o].properties&&(h=r[o].properties.color)),h=this.normizedColor(h),u=this.normizedPoint(u);var v=r[o].size||s;"properties"in r[o]&&"size"in r[o].properties&&(v=r[o].properties.size),v=Object.prototype.toString.call(v)==="[object Function]"?v(r[o]):Number(v),a.push(u[0],u[1],Number(u[2]||0)),a.push(h[0],h[1],h[2],h[3]),a.push(v*window.devicePixelRatio)}this.bufferData=a,this.buffer.updateData(new Float32Array(a)),t.enablePicked&&this.parsePickData(r)}}},{key:"parsePickData",value:function(t){var r=this.getOptions(),a=[];if(r.enablePicked)for(var n=0;n<t.length;n++){var s=this.indexToRgb(n);a.push(s[0]/255,s[1]/255,s[2]/255)}r.enablePicked&&this.pickBuffer.updateData(new Float32Array(a))}},{key:"render",value:function(t){var r=t.gl,a=t.matrix,n=t.isPickRender;if(!(0>=this.bufferData.length)){var s=this.getOptions(),o=this.program;o.use(r),this.vertexArray.bind(),t=this.getCommonUniforms(t);var u=1;s.unit==="m"&&this.map&&(u=this.map.getZoomUnits()),t=K(t,{zoomUnits:u,uTime:(new Date-this.date)/1e3,duration:s.duration,uMatrix:a}),o.setUniforms(t),this.setGLState({blend:!n,blendFunc:s.blend==="lighter"?[r.SRC_ALPHA,r.ONE]:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],blendEquation:r.FUNC_ADD,polygonOffset:s.polygonOffset,depthTest:s.depthTest}),r.drawArrays(r.POINTS,0,this.bufferData.length/8)}}}]),i}(rt),dh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="SparkLayer",t.bufferData=[],t.startTime=Number(t.options.startTime)||0,t.endTime=Number(t.options.endTime),t.time=t.startTime,t.segs=Number(t.options.segs)||10,t.autoUpdate=!0,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10,polygonOffset:[0,0]}}},{key:"setTime",value:function(t){this.time=t}},{key:"initialize",value:function(t){this.gl=t,this.program=new q(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,r){var a=this.gl;if(a){this.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.buffer);for(var n=[],s=t.height,o=0;o<r.length;o++)for(var u=r[o].geometry.coordinates,h=Object.prototype.toString.call(s)==="[object Function]"?s(r[o]):Number(s),v=0,l=0;l<this.segs;l++){var f=this.normizedPoint(u);n.push(f[0],f[1],v),u[2]===void 0?n.push(l):n.push(Number(u[2])),v+=h/this.segs,n.push(f[0],f[1],v),u[2]===void 0?n.push(l+1):n.push(Number(u[2]))}t.endTime===void 0&&(this.endTime=this.segs),this.bufferData=n,a.bufferData(a.ARRAY_BUFFER,new Float32Array(n),a.STATIC_DRAW),this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var r=t.gl,a=t.matrix;t=this.program,r.useProgram(t.program),r.uniformMatrix4fv(t.uniforms.u_matrix,!1,a),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.enableVertexAttribArray(t.attributes.aPos),r.vertexAttribPointer(t.attributes.aPos,4,r.FLOAT,!1,0,0),a=this.normizedColor(this.options.color),r.uniform3f(t.uniforms.uFragColor,a[0],a[1],a[2]),r.uniform1f(t.uniforms.currentTime,this.time),r.uniform1f(t.uniforms.trailLength,this.options.trailLength),this.setGLState({blend:!0,blendFunc:[r.SRC_ALPHA,r.ONE],blendEquation:r.FUNC_ADD,polygonOffset:this.options.polygonOffset}),r.drawArrays(r.LINES,0,this.bufferData.length/4),this.time+=Number(this.options.step),this.time>1.5*this.endTime&&(this.time=this.startTime)}}]),i}(rt),Bs=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="IconLayer",t.index=[],r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.iconHash=new Oe,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!0,depthTest:!0,blend:"default",flat:!1,unit:"px",scale:1,angle:0,opacity:1,offset:[0,0],padding:[0,0],polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.texture=null,this.program=new q(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform float devicePixelRatio;uniform float u_zoom_units;uniform float u_zIndex;uniform float u_scale;uniform bool u_unit_px;uniform bool u_flat;varying vec2 v_texture_coord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)+size.x*sin(a_rotation);}else if(corner==2.0){x+=size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)-size.x*sin(a_rotation);}else if(corner==3.0){x+=size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)-size.x*sin(a_rotation);}else{x+=-size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)+size.x*sin(a_rotation);}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;if(u_flat){vec2 offset=a_offset;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;offset*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=u_zIndex;gl_Position=u_matrix*vec4(current.x+offset[0],current.y-offset[1],current.z,1.0);}else{vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio*u_scale;vec2 offset=a_offset*2./MAPV_resolution*devicePixelRatio;if(!u_unit_px){halfSize/=u_zoom_units;offset/=u_zoom_units;}vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-offset;current.z+=u_zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:`precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform float u_opacity;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}textureColor.a*=u_opacity;gl_FragColor=textureColor;
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:r.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:36,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:32},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){this.gl&&this.processCache(t,r,2<arguments.length&&arguments[2]!==void 0?arguments[2]:{})}},{key:"processCache",value:function(t,r,a){var n=this;this.cachedData=[];for(var s=t.icon,o=t.width,u=t.height,h=t.offset,v=t.angle,l=0;l<r.length;l++){var f=this.normizedPoint(r[l].geometry.coordinates),d=this.getProperty("icon",s,r[l]),c=this.getProperty("width",o,r[l]),p=this.getProperty("height",u,r[l]),m=this.getProperty("offset",h,r[l]),g=this.getProperty("angle",v,r[l]);f&&d&&(this.cachedData.push({point:f,icon:d,width:c,height:p,offset:m,angle:g,index:l}),this.iconHash.get(d)||this.iconHash.set(d,d))}r=Ci(this.iconHash.entries()).filter(function(x){return typeof x[1]=="string"}).map(function(x){var y=nt(x,2)[0];return new De(function(_,A){n.url2canvas(y,function(T){n.iconHash.set(y,T),_()})})}),De.all(r).then(function(x){n.buildSprite(t),a.autoRender!==!1&&n.webglLayer&&n.webglLayer.render()})}},{key:"buildSprite",value:function(t){var r=t.padding,a=this.canvas,n=this.ctx,s=[],o=new Oe,u=!0,h=!1,v=void 0;try{for(var l=rr(this.iconHash),f;!(u=(f=l.next()).done);u=!0){var d=nt(f.value,2),c=d[1];if(typeof c!="string"){var p=c.width,m=c.height;s.push({w:p+r[0],h:m+r[0],width:p,height:m,key:d[0],icon:c})}}}catch(g){h=!0,v=g}finally{try{!u&&l.return&&l.return()}finally{if(h)throw v}}for(h=ye(s),u=0;u<s.length;u++)v=s[u],o.get(v.key)||o.set(v.key,v);for(u=oe(h.w),h=oe(h.h),a.width=u||1,a.height=h||1,n.save(),a=0;a<s.length;a++)v=s[a],n.drawImage(v.icon,v.x+r[0],v.y+r[1],v.width,v.height);n.restore(),this.loadTexture(),this.buildVertex(t,o,u,h)}},{key:"buildVertex",value:function(t,r,a,n){t=t.enablePicked;for(var s=[],o=[],u=[],h=[],v=0;v<this.cachedData.length;v++){var l=this.cachedData[v],f=l.point,d=l.width,c=l.height,p=l.offset,m=l.angle,g=l.index;if(l=r.get(l.icon)){d=d||l.icon.width,c=c||l.icon.height;var x=nt(f,3);f=x[0];var y=x[1];x=x[2];for(var _=0;4>_;_++)s.push(f,y,x),s.push(_),s.push(d,c),s.push.apply(s,Q(p)),s.push(m*Math.PI/180);d=l.x/a,c=(l.x+l.w)/a,p=(l.y+l.h)/n,l=l.y/n,o.push(d,p,d,l,c,l,c,p),l=4*v,u.push(l,l+2,l+1,l,l+3,l+2),t&&(g=this.indexToRgb(g),h.push(g[0]/255,g[1]/255,g[2]/255),h.push(g[0]/255,g[1]/255,g[2]/255),h.push(g[0]/255,g[1]/255,g[2]/255),h.push(g[0]/255,g[1]/255,g[2]/255))}}this.index=u,this.vertexBuffer.updateData(new Float32Array(s)),this.uvBuffer.updateData(new Float32Array(o)),this.indexBuffer.updateData(new Uint32Array(u)),t&&this.pickBuffer.updateData(new Float32Array(h))}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var r=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(r),this.setGLState({blend:!0,blendFunc:se(r,n.blend),polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite}),s.setUniforms(K(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:a,u_flat:n.flat,u_unit_px:n.unit==="px",u_zoom_units:this.map.getZoomUnits(),u_scale:n.scale,u_opacity:n.opacity,u_zIndex:n.zIndex,devicePixelRatio:window.devicePixelRatio})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,this.index.length,r.UNSIGNED_INT,0))}}},{key:"url2canvas",value:function(t,r){if((typeof t=="undefined"?"undefined":Ut(t))==="object")r(t);else{var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var n=a.width,s=a.height,o=document.createElement("canvas");o.width=n,o.height=s,o.getContext("2d").drawImage(a,0,0,n,s),r(o)},a.onerror=function(){var n=document.createElement("canvas");n.width=20,n.height=40;var s=n.getContext("2d");s.fillStyle="red",s.beginPath(),s.lineTo(0,0),s.lineTo(20,0),s.lineTo(10,40),s.closePath(),s.fill(),r(n)},a.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?Pt(this.gl,this.canvas,function(r){t.texture=r}):this.texture=null}}]),i}(rt),vh=function(e){function i(t){O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.pointLayer=new ti(t.options),t.options.textOptions=K({depthTest:!1},t.options.textOptions),t.textLayer=new Yr(t.options.textOptions);var r=K({},t.options,t.options.iconOptions);return t.iconLayer=new Bs(r),t.children=[t.pointLayer,t.textLayer,t.iconLayer],t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{minSize:25,maxSize:40,clusterRadius:200,minPoints:2,extent:400,showText:!0,maxZoom:19,minZoom:4,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},textOptions:{fontSize:12,color:"white"},iconOptions:{}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},r=this.options.textOptions;t.textOptions&&K(r,t.textOptions);var a=t.minZoom,n=t.maxZoom,s=t.clusterRadius;a=n&&n!==this.options.maxZoom||a&&a!==this.options.minZoom||s&&s!==this.options.clusterRadius,K(this.options,t,{textOptions:r}),a?this.onChanged(this.options,this.data):this.refreshCluster(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,r){var a=this;r&&r.length?(r.forEach(function(n){var s=nt(n.geometry.coordinates,2),o=s[0];s=s[1],-180<=o&&180>=o&&-90<=s&&90>=s||(o=a.map.mercatorToLnglat(o,s),n.geometry.coordinates[0]=o[0],n.geometry.coordinates[1]=o[1])}),this.supercluster=new Ds({maxZoom:t.maxZoom,minZoom:t.minZoom,radius:t.clusterRadius,minPoints:t.minPoints,extent:t.extent}),this.supercluster.load(r),this.supercluster.trees.forEach(function(n){var s=0,o=1/0;n.points.forEach(function(u){s=Math.max(u.numPoints||0,s),o=Math.min(u.numPoints||1/0,o)}),n.max=s,n.min=o}),this.refreshCluster()):(this.supercluster=null,this.pointLayer.setData([]),this.iconLayer.setData([]),this.textLayer.setData([]))}},{key:"refreshCluster",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.options;if(this.supercluster){var r=this.getClusterData(t);if(r&&r.length)if(typeof t.beforeRender=="function"&&t.beforeRender(r)===!1)this.pointLayer.setData([]),this.iconLayer.setData([]),this.textLayer.setData([]);else{var a=[],n=[],s=[];r.forEach(function(o){o.properties.text?(a.push(o),s.push({geometry:o.geometry,properties:{text:o.properties.text}})):o.properties.icon?n.push(o):a.push(o)}),this.pointLayer.setData(a),this.iconLayer.setData(n),this.textLayer.setData(t.showText?s:[]),t.enablePicked&&t.autoSelect&&this.pick(-1,-1)}}}},{key:"getClusterData",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.options,r=this.map.getBounds(),a=this.ne=r.getNorthEast();r=this.sw=r.getSouthWest();var n=a,s=n.lng;return n=n.lat,-180<=s&&180>=s&&-90<=n&&90>=n?r=[r.lng,r.lat,a.lng,a.lat]:(a=this.map.mercatorToLnglat(this.ne.lng,this.ne.lat),r=this.map.mercatorToLnglat(this.sw.lng,this.sw.lat),r=r.concat(a)),a=Math.floor(this.map.getZoom()),r=this.supercluster.getClusters(r,a),this.zoom!==a&&0<r.length&&(this.zoom=a,n=this.supercluster.trees,s=n[a]&&n[a].max||this.max,a=n[a]&&n[a].min||this.min,s!==a&&(this.max=s,this.min=a)),this.processData(r,t)}},{key:"processData",value:function(t,r){var a=r.defaultColor,n=r.defaultSize,s=r.gradient,o=r.minSize,u=r.textOptions,h=new St({max:this.max,min:~~this.min||1,minSize:o||8,maxSize:r.maxSize||30,gradient:s});a=a||s[0]||"black",n=n||.5*o||5;var v=u&&u.format;return v=typeof v=="function"?v:null,t.map(function(l){var f=n,d=a,c="";return l.properties&&l.properties.point_count&&(c=l.properties.point_count,f=h.getSize(c)||f,d=h.getColor(c),c=v?v(c):c),f=K({},l.properties,{text:c,size:f,color:d}),K({},l,{properties:f,children:l.id})})}},{key:"pick",value:function(t,r){var a=this.pointLayer.pick(t,r);return 0>a.dataIndex&&(a=this.iconLayer.pick(t,r)),(t=a.dataItem)&&typeof t.children=="number"&&(t.children=this.getClusterPoints(t.children)),a}},{key:"getClusterPoints",value:function(t){var r=this;return t?this.supercluster.getChildren(t).map(function(a){return a.type==="Feature"?r.getClusterPoints(a.id):a}).flat():[]}},{key:"shouldUpdate",value:function(){if(!this.data||!this.supercluster)return!1;if(this.zoom!==Math.floor(this.map.getZoom()))return!0;var t=this.map.getBounds(),r=t.getNorthEast();if(t=t.getSouthWest(),this.ne.lng!==r.lng||this.ne.lat!==r.lat||this.sw.lng!==t.lng||this.sw.lat!==t.lat)return!0}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshCluster():ve(i.prototype.__proto__||U(i.prototype),"render",this).call(this,t)}}]),i}(pe),ph=function(e){function i(t,r){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t,r))}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return K(ve(i.prototype.__proto__||U(i.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}})}},{key:"onChanged",value:function(t,r){this.gl&&(r=this.processData(r,t),ve(i.prototype.__proto__||U(i.prototype),"onChanged",this).call(this,t,r))}},{key:"generateGrid",value:function(t,r){var a=r.gridSize,n=[],s={};r=t.length;for(var o=this.getPointOffset(),u=0;u<r;u++){var h=this.normizedPoint(t[u].geometry.coordinates),v=h[2];h=~~((h[0]+o[0])/a)+"_"+~~((h[1]+o[1])/a),s[h]===void 0&&(s[h]={count:0,num:0,z:0});var l=~~t[u].count||1;"properties"in t[u]&&"count"in t[u].properties&&(l=~~t[u].properties.count),s[h].count+=l,s[h].num+=1,s[h].z+=v}return yt(s).forEach(function(f){var d=f.split("_");n.push([d[0]*a+a/2,d[1]*a+a/2,s[f].z/s[f].num,s[f].count])}),n}},{key:"processData",value:function(t,r){var a=[];if(r.style==="normal")for(var n=this.getPointOffset(),s=0;s<t.length;s++){var o=this.normizedPoint(t[s].geometry.coordinates),u=o[0]+n[0],h=o[1]+n[1];o=o[2];var v=~~t[s].count||1;"properties"in t[s]&&"count"in t[s].properties&&(v=~~t[s].properties.count),a.push([u,h,o,v])}else a=this.generateGrid(t,r);if(n=t=0,r.max!==void 0&&r.min!==void 0)t=r.max,n=r.min;else{for(a[0]&&(t=a[0][3],n=a[0][3]),s=a.length,u=0;u<s;u++)h=a[u],t=Math.max(h[3],t),n=Math.min(h[3],n);t/=2}for(r=new St({max:~~t,min:n,gradient:r.gradient}),t=[],n=0;n<a.length;n++)s=a[n],s[0]=s[0],s[1]=s[1],u=r.getImageData(s[3]),t.push({geometry:{type:"Point",coordinates:[s[0],s[1],s[2]]},color:[u[0]/255,u[1]/255,u[2]/255,u[3]/255]});return t}}]),i}(ti),gh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.bufferData=[],t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(t,r){var a=this;if(t=this.gl){this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer);for(var n=[],s=function(u){var h=5*u;for(u=0;u<r.length;u++)r[u].geometry.coordinates.forEach(function(v){for(var l=0;l<v.length-1;l++){var f=a.normizedPoint(v[l]);n.push(f[0]),n.push(f[1]),n.push(Number(h)),f=a.normizedPoint(v[l+1]),n.push(f[0]),n.push(f[1]),n.push(Number(h))}})},o=0;20>o;o++)s(o);t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW),this.bufferData=n,t.bindBuffer(t.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(t){this.gl=t,this.program=new q(t,{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(t){var r=t.gl;t=t.matrix;var a=this.program;r.useProgram(a.program);var n=this.normizedColor(this.options.color);r.uniform4f(a.uniforms.uFragColor,n[0],n[1],n[2],n[3]),r.uniformMatrix4fv(a.uniforms.uMatrix,!1,t),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),r.enableVertexAttribArray(a.attributes.aPos),r.vertexAttribPointer(a.attributes.aPos,3,r.FLOAT,!1,0,0),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:[r.ONE,r.ONE]}),r.drawArrays(r.LINES,0,this.bufferData.length/3)}}]),i}(rt),Os={circle:1,square:2},mh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Y(i,e),I(i,[{key:"initialize",value:function(t){this.gl=t,this.program=new q(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"}),this.f32BufferData=new Float32Array,this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(t,r){var a=this.gl;if(a){this.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.buffer);for(var n=[],s=t.color||[.1,.1,.9,1],o=t.size||5,u=0;u<r.length;u++){var h=r[u].geometry.coordinates,v=s;Object.prototype.toString.call(v)==="[object Function]"?v=v(r[u]):(v=r[u].color||s,"properties"in r[u]&&"color"in r[u].properties&&(v=r[u].properties.color)),v=this.normizedColor(v);var l=this.normizedPoint(h),f=o;f=Object.prototype.toString.call(f)==="[object Function]"?f(r[u]):Number(f);var d=r[u].time||u;"properties"in r[u]&&"time"in r[u].properties&&(d=r[u].properties.time),n.push(l[0],l[1],Number(h[2]||0),d),n.push(v[0],v[1],v[2],v[3]),n.push(f*window.devicePixelRatio)}t.endTime===void 0&&(this.endTime=r.length),this.bufferData=n,this.f32BufferData=new Float32Array(n),a.bufferData(a.ARRAY_BUFFER,this.f32BufferData,a.STATIC_DRAW)}}},{key:"render",value:function(t){var r=t.gl,a=t.matrix;0>=this.bufferData.length||(t=this.program,r.useProgram(t.program),r.uniformMatrix4fv(t.uniforms.u_matrix,!1,a),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),a=this.f32BufferData.BYTES_PER_ELEMENT,r.enableVertexAttribArray(t.attributes.aPos),r.vertexAttribPointer(t.attributes.aPos,4,r.FLOAT,!1,9*a,0),r.enableVertexAttribArray(t.attributes.aColor),r.vertexAttribPointer(t.attributes.aColor,4,r.FLOAT,!1,9*a,4*a),r.enableVertexAttribArray(t.attributes.aSize),r.vertexAttribPointer(t.attributes.aSize,1,r.FLOAT,!1,9*a,8*a),r.uniform1f(t.uniforms.currentTime,this.time),r.uniform1f(t.uniforms.trailLength,this.options.trailLength||3),a=1,this.options.shape&&Os[this.options.shape]&&(a=Os[this.options.shape]),r.uniform1i(t.uniforms.uShape,a),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:this.options.blend==="lighter"?[r.SRC_ALPHA,r.ONE]:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA]}),r.drawArrays(r.POINTS,0,this.bufferData.length/9),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]),i}(rt),xh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1,polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t,this.program=new q(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"},this),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(t){this.time=t}},{key:"onChanged",value:function(t,r){var a=this.gl;if(a){this.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.buffer);for(var n=[],s=0,o=this.options.color,u=0;u<r.length;u++){var h=r[u].geometry.coordinates;r[u].color&&(o=r[u].color),"properties"in r[u]&&"color"in r[u].properties&&(o=r[u].properties.color),Object.prototype.toString.call(o)==="[object Function]"&&(o=o(r[u])),o=this.normizedColor(o),h.length>s&&(s=h.length);for(var v=0;v<h.length-1;v++){var l=this.normizedPoint(h[v]);n.push(l[0]),n.push(l[1]),n.push(l[2]),h[v][3]===void 0?n.push(v):n.push(Number(h[v][3])),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(o[3]),l=this.normizedPoint(h[v+1]),n.push(l[0]),n.push(l[1]),n.push(l[2]),h[v+1][3]===void 0?n.push(v+1):n.push(Number(h[v+1][3])),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(o[3])}}t.endTime===void 0&&(this.endTime=s),this.bufferData=n,this.f32BufferData=new Float32Array(n),a.bufferData(a.ARRAY_BUFFER,this.f32BufferData,a.STATIC_DRAW)}}},{key:"render",value:function(t){var r=t.gl,a=t.matrix;t=this.getOptions();var n=this.program;n.use(r),r.uniformMatrix4fv(n.uniforms.u_matrix,!1,a),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),a=this.f32BufferData.BYTES_PER_ELEMENT,r.enableVertexAttribArray(n.attributes.aPos),r.vertexAttribPointer(n.attributes.aPos,4,r.FLOAT,!1,8*a,0),r.enableVertexAttribArray(n.attributes.aColor),r.vertexAttribPointer(n.attributes.aColor,4,r.FLOAT,!1,8*a,4*a),a=this.normizedColor(t.color),r.uniform3f(n.uniforms.uFragColor,a[0],a[1],a[2]),r.uniform1f(n.uniforms.currentTime,this.time),r.uniform1f(n.uniforms.trailLength,t.trailLength),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:t.blend==="lighter"?[r.ONE,r.ONE]:[r.SRC_ALPHA,r.ONE],polygonOffset:t.polygonOffset,depthMask:!1}),r.drawArrays(r.LINES,0,this.bufferData.length/8),this.time+=t.step,this.time>this.endTime&&(this.time=this.startTime)}}]),i}(rt),yh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="IconCollidesLayer",t.index=[],r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.iconHash=new Oe,t.boxHash=new Oe,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{flat:!1,unit:"px",scale:1,angle:0,offset:[0,0],padding:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new q(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform float devicePixelRatio;uniform float u_zoom_units;uniform float u_zIndex;uniform float u_scale;uniform bool u_unit_px;uniform bool u_flat;varying vec2 v_texture_coord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)+size.x*sin(a_rotation);}else if(corner==2.0){x+=size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)-size.x*sin(a_rotation);}else if(corner==3.0){x+=size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)-size.x*sin(a_rotation);}else{x+=-size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)+size.x*sin(a_rotation);}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;if(u_flat){vec2 offset=a_offset;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;offset*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=u_zIndex;gl_Position=u_matrix*vec4(current.x+offset[0],current.y-offset[1],current.z,1.0);}else{vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio*u_scale;vec2 offset=a_offset*2./MAPV_resolution*devicePixelRatio;if(!u_unit_px){halfSize/=u_zoom_units;offset/=u_zoom_units;}vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-offset;current.z+=u_zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:`precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}gl_FragColor=textureColor;
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:r.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:36,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:32},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};this.gl&&(this.cachedData=[],this.boxHash.clear(),this.processCache(t,r,a))}},{key:"processCache",value:function(t,r,a){for(var n=this,s=t.icon,o=t.width,u=t.height,h=t.offset,v=t.angle,l=0;l<r.length;l++){var f=this.normizedPoint(r[l].geometry.coordinates),d=this.getProperty("icon",s,r[l]),c=this.getProperty("width",o,r[l]),p=this.getProperty("height",u,r[l]),m=this.getProperty("offset",h,r[l]),g=this.getProperty("angle",v,r[l]);f&&d&&(this.cachedData.push({point:f,icon:d,width:c,height:p,offset:m,angle:g,dataIndex:l}),this.iconHash.get(d)||this.iconHash.set(d,d))}r=Ci(this.iconHash.entries()).filter(function(x){return typeof x[1]=="string"}).map(function(x){var y=nt(x,2)[0];return new De(function(_,A){n.url2canvas(y,function(T){n.iconHash.set(y,T),_()})})}),De.all(r).then(function(x){n.buildSprite(t),a.autoRender!==!1&&n.webglLayer&&n.webglLayer.render()})}},{key:"buildSprite",value:function(t){t=t.padding;var r=this.canvas,a=this.ctx,n=[],s=!0,o=!1,u=void 0;try{for(var h=rr(this.iconHash),v;!(s=(v=h.next()).done);s=!0){var l=nt(v.value,2),f=l[1];if(typeof f!="string"){var d=f.width,c=f.height;n.push({w:d+t[0],h:c+t[0],width:d,height:c,key:l[0],icon:f})}}}catch(p){o=!0,u=p}finally{try{!s&&h.return&&h.return()}finally{if(o)throw u}}for(h=ye(n),v=0;v<n.length;v++)l=n[v],this.boxHash.get(l.key)||this.boxHash.set(l.key,l);for(v=oe(h.w)||1,h=oe(h.h)||1,r.width=v,r.height=h,a.save(),r=0;r<n.length;r++)h=n[r],a.drawImage(h.icon,h.x+t[0],h.y+t[1],h.width,h.height);a.restore(),this.loadTexture()}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.texture){var r=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(r),this.throttleUpdate(t),this.setGLState({blend:!0,blendFunc:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA]}),s.setUniforms(K(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:a,u_flat:n.flat,u_unit_px:n.unit==="px",u_zoom_units:this.map.getZoomUnits(),u_scale:n.scale,u_zIndex:n.zIndex,devicePixelRatio:window.devicePixelRatio})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,this.index.length,r.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateIcon(t)}},{key:"updateIcon",value:function(t){if(this.iconHash.size&&this.boxHash.size){var r=this.getOptions(),a=t.gl;t=t.matrix,r=r.enablePicked;var n=[],s=[],o=[],u=[],h=this.canvas.width,v=this.canvas.height,l=a.canvas.width/window.devicePixelRatio;a=a.canvas.height/window.devicePixelRatio;for(var f=new sr,d=0,c=0;c<this.cachedData.length;c++){var p=this.cachedData[c],m=p.point,g=p.width,x=p.height,y=p.offset,_=p.angle,A=p.dataIndex;if(p=this.boxHash.get(p.icon)){g=g||p.icon.width,x=x||p.icon.height;var T=nt(m,3);m=T[0];var w=T[1];T=T[2];var C=ht.clone([m,w,T,1]);ht.transformMat4(C,C,t),ht.scale(C,C,1/C[3]);var M=(C[0]+1)/2*l-g/2;C=(-C[1]+1)/2*a-x/2;var E=M+g,P=C+x;if(!(0>E||0>P||M>l||C>a||(M={minX:M,maxX:E,minY:C,maxY:P},f.collides(M)))){for(f.insert(M),M=0;4>M;M++)n.push(m,w,T),n.push(M),n.push(g,x),n.push.apply(n,Q(y)),n.push(_*Math.PI/180);g=p.x/h,x=(p.x+p.w)/h,y=(p.y+p.h)/v,p=p.y/v,s.push(g,y,g,p,x,p,x,y),p=4*d,o.push(p,p+2,p+1,p,p+3,p+2),r&&(A=this.indexToRgb(A),u.push(A[0]/255,A[1]/255,A[2]/255),u.push(A[0]/255,A[1]/255,A[2]/255),u.push(A[0]/255,A[1]/255,A[2]/255),u.push(A[0]/255,A[1]/255,A[2]/255)),d+=1}}}this.index=o,this.vertexBuffer.updateData(new Float32Array(n)),this.uvBuffer.updateData(new Float32Array(s)),this.indexBuffer.updateData(new Uint32Array(o)),r&&this.pickBuffer.updateData(new Float32Array(u))}}},{key:"url2canvas",value:function(t,r){if((typeof t=="undefined"?"undefined":Ut(t))==="object")r(t);else{var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var n=a.width,s=a.height,o=document.createElement("canvas");o.width=n,o.height=s,o.getContext("2d").drawImage(a,0,0,n,s),r(o)},a.onerror=function(){var n=document.createElement("canvas");n.width=20,n.height=40;var s=n.getContext("2d");s.fillStyle="red",s.beginPath(),s.lineTo(0,0),s.lineTo(20,0),s.lineTo(10,40),s.closePath(),s.fill(),r(n)},a.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?Pt(this.gl,this.canvas,function(r){t.texture=r}):this.texture=null}}]),i}(rt),zs=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="LineFlowLayer",t.initData(),t.date=new Date,t.autoUpdate=!0,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:2,antialias:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0]}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[]}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.program=new q(this.gl,{vertexShader:`uniform mat4 u_matrix;uniform float thickness;uniform vec4 uSelectedColor;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aCounter;attribute vec2 uv;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}void main(){vColor=aColor;vCounter=aCounter;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
vec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float len=thickness;float orientation=direction;vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){len=thickness/dot(miter,perp);}}vec2 normal=vec2(-dir.y,dir.x);vNormal=normal*orientation;normal*=len/2.0;vec2 pos=currentScreen+normal*orientation;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}`,fragmentShader:"precision highp float;uniform bool uAntialias;uniform bool uAnimate;uniform float uTime;uniform float duration;uniform float interval;uniform float trailLength;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.98,1.0,length(vNormal));color.a*=blur;}if(uAnimate){float alpha=1.0-fract(mod(1.0-vCounter,interval)*(1.0/interval)+uTime/duration);alpha=(alpha+trailLength-1.0)/trailLength;color.a*=alpha;}gl_FragColor=color;}",defines:r.enablePicked?["PICK"]:[]},this),this.prevBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:4,name:"aCounter",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){var a=this;if(this.gl){this.initData();for(var n=1,s=[],o=0;o<r.length;o++){var u=[],h=r[o].geometry.coordinates;h&&0<h.length&&(u=r[o].geometry.type==="Polygon"?h[0].map(function(c){return a.normizedPoint(c)}):h.map(function(c){return a.normizedPoint(c)})),u=Co(u),h=u.total,s[o]=u.arr,n=Math.max(h,n)}for(o=[],u=t.color,h=0;h<r.length;h++){var v=[],l=r[h].geometry.coordinates;l&&0<l.length&&(v=r[h].geometry.type==="Polygon"?l[0].map(function(c){return a.normizedPoint(c)}):l.map(function(c){return a.normizedPoint(c)})),l=u,Object.prototype.toString.call(l)==="[object Function]"?l=l(r[h]):(l=r[h].color||u,"properties"in r[h]&&"color"in r[h].properties&&(l=r[h].properties.color)),l=this.normizedColor(l);for(var f=this.addMultipleCoords(v),d=0;d<f.length;d++)this.processData(this.dataMgr,f[d],s[h],n,l);if(t.enablePicked)for(l=this.indexToRgb(h),f=0;f<v.length;f++)o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),t.repeat&&(o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(o))}}},{key:"processData",value:function(t,r,a,n,s){var o,u,h,v,l,f,d,c=r.length,p=t.position.length/6;a=Ht(a.map(function(_){return _/n}));var m=Ht(r.map(function(_){return-1}),!0),g=Ht(r),x=Ht(r.map(si(-1))),y=Ht(r.map(si(1)));r=Ht(r.map(function(_){return s})),c=Mo(c,p),(o=t.counter).push.apply(o,Q(a)),(u=t.position).push.apply(u,Q($t(g))),(h=t.prev).push.apply(h,Q($t(x))),(v=t.next).push.apply(v,Q($t(y))),(l=t.direction).push.apply(l,Q(m)),(f=t.color).push.apply(f,Q($t(r))),(d=t.index).push.apply(d,Q(c))}},{key:"render",value:function(t){var r=t.gl,a=t.matrix,n=this.dataMgr;if(n&&!(0>=n.index.length)){var s=this.getOptions(),o=this.program;if(o.use(r),this.map){var u=this.map.getZoom();u=!!(u>=s.minZoom&&u<=s.maxZoom&&this.autoUpdate)}else u=!0;o.setUniforms(K(this.getCommonUniforms(t),{u_matrix:a,thickness:s.width,uAntialias:s.antialias,uTime:(new Date-this.date)/1e3,uAnimate:u,duration:s.duration,interval:s.interval,trailLength:s.trailLength})),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:s.blend==="lighter"?[r.SRC_ALPHA,r.ONE]:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],polygonOffset:s.polygonOffset}),this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,n.index.length,r.UNSIGNED_INT,0)}}}]),i}(rt),_h=function(e){function i(t,r){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t,r))}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.texture=null,this.program=new q(this.gl,{vertexShader:`precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform sampler2D uTerrain;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;
#if defined(TERRAIN)
vec4 terrainColor=texture2D(uTerrain,vec2(v_texture_coord.s,v_texture_coord.t));vec3 rgb=terrainColor.rgb*256.0;pos.z=-10000.0+((rgb.r*256.0*256.0+rgb.g*256.0+rgb.b)*0.1);pos.z=pos.z-60.0;
#endif
vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;}`,fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D uTile;uniform bool uUseFilter;uniform vec4 uFilterColor;void main(){vec4 textureColor=texture2D(uTile,vec2(v_texture_coord.s,v_texture_coord.t));if(uUseFilter){textureColor=textureColor*uFilterColor;}gl_FragColor=textureColor;}",defines:r.terrain?["TERRAIN"]:""},this),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new at({gl:t,program:this.program,attributes:[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(t,r){var a=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){a.loadTexture(function(){a.parseData(r),a.dataTime=new Date,a.webglLayer.render()})},0))}},{key:"render",value:function(t){var r=t.gl,a=t.projectionMatrix;t=t.viewMatrix;var n=this.getOptions(),s=this.program,o=s.uniforms;s.use(r),this.texture&&(r.activeTexture(r.TEXTURE0),r.uniform1i(o.uTile,0),r.bindTexture(r.TEXTURE_2D,this.texture),r.activeTexture(r.TEXTURE1),r.uniform1i(o.uTerrain,1),r.bindTexture(r.TEXTURE_2D,this.terrainSampler),this.setGLState({cullFace:!1}),s.setUniforms({u_proj_matrix:a,uUseFilter:!!n.filterColor,uFilterColor:this.normizedColor(n.filterColor||"rgba(0, 0, 100, 1.0)"),u_mv_matrix:t}),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,this.index.length,r.UNSIGNED_INT,0)))}},{key:"loadTexture",value:function(t){var r=this,a=this.getOptions();a.tile?a.terrain?Pt(this.gl,a.terrain,function(n,s){r.terrainSampler=n,Pt(r.gl,a.tile,function(o,u){r.texture=o,t&&t(),r.webglLayer.render()})},{TEXTURE_WRAP_S:"MIRRORED_REPEAT",TEXTURE_WRAP_T:"MIRRORED_REPEAT"}):Pt(this.gl,a.tile,function(n,s){r.texture=n,t&&t(),r.webglLayer.render()}):(this.texture=null,t&&t())}},{key:"parseData",value:function(t){var r=this,a=[],n=[];if(t&&t[0]){var s=t[0].geometry.coordinates[0];s=s.map(function(c){return r.normizedPoint(c)}),t=s[0][0];var o=s[0][1],u=s[0][2],h=(s[2][0]-t)/16;s=(s[2][1]-o)/16;for(var v=0;16>=v;v++)for(var l=0;16>=l;l++)if(a.push(t+h*l,o+s*v,u),a.push(l/16,v/16),16>l&&16>v){var f=17*v+l,d=17*(v+1)+l;n.push(f,d+1,f+1),n.push(f,d,d+1)}}this.index=n,this.vertexBuffer.updateData(new Float32Array(a)),this.indexBuffer.updateData(new Uint32Array(n))}}]),i}(rt),Ah=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="BoardLayer",t.index=[],r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.iconHash=new Oe,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{unit:"px",scale:1,angle:0,offsetZ:0,padding:[0,0],polygonOffset:[0,0],enableColorMix:!1,mixColor:"#fff",mixAmount:.5}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.texture=null,this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var a=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"a_offsetZ",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}];a=a.concat(this.getCommonAttributes());var n=[];r.enablePicked&&n.push("PICK"),this.options.enableColorMix&&(this.colorBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),a.push({stride:16,name:"a_color",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0}),n.push("USE_COLOR_MIX")),this.program=new q(this.gl,{vertexShader:`precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute float a_offsetZ;attribute vec2 a_size;attribute vec2 a_texture_coord;
#if defined(USE_COLOR_MIX)
attribute vec4 a_color;
#endif
uniform mat4 u_matrix;uniform vec2 u_size;uniform float u_zoom_units;uniform float u_scale;uniform bool u_unit_px;varying vec2 v_texture_coord;varying vec4 v_color;/***\u4E09\u7EF4\u7A7A\u95F4\u5185\uFF0C\u7ED5Z\u8F74\u65CB\u8F6C\u7684\u77E9\u9635\uFF0C\u53F3\u624B\u5750\u6807\u7CFB\u4E0B*[x'][cos0-sin0  0  0]*[y']=[sin0 cos0   0  0]*[z'][0     0     1  0]*[1][0     0     0  1]*/mat3 rotateZ(float angle){float cos0=cos(angle);float sin0=sin(angle);return mat3(cos0,sin0,0.,-sin0,cos0,0.,0.,0.,1.);}vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;float z=coord.z;mat3 mat=rotateZ(a_rotation);vec3 rotated=vec3(size[0],0.0,size[1]);if(corner==1.0){rotated=mat*vec3(-size[0],0.0,size[1]);}else if(corner==2.0){rotated=mat*vec3(size[0],0.0,size[1]);}else if(corner==3.0){rotated=mat*vec3(size[0],0.0,-size[1]);}else{rotated=mat*vec3(-size[0],0.0,-size[1]);}x+=rotated.x;y+=rotated.y;z+=rotated.z;return vec3(x,y,z);}void main(){
#if defined(USE_COLOR_MIX)
v_color=a_color;
#endif
v_texture_coord=a_texture_coord;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=a_offsetZ;gl_Position=u_matrix*vec4(current,1.0);}`,fragmentShader:`precision highp float;varying vec2 v_texture_coord;varying vec4 v_color;uniform sampler2D u_icon;uniform vec4 uSelectedColor;
#if defined(USE_COLOR_MIX)
uniform float u_mix_amount;
#endif
void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}gl_FragColor=textureColor;
#if defined(USE_COLOR_MIX)
gl_FragColor=mix(gl_FragColor,v_color,u_mix_amount);
#endif
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:n},this),this.vertexArray=new at({gl:t,program:this.program,attributes:a})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){this.gl&&this.processCache(t,r)}},{key:"forceUpdate",value:function(){this.gl&&this.processCache(this.options,this.data)}},{key:"processCache",value:function(t,r){var a=this;this.cachedData=[];for(var n=t.icon,s=t.width,o=t.height,u=t.offsetZ,h=t.angle,v=t.mixColor,l=0;l<r.length;l++){var f=this.normizedPoint(r[l].geometry.coordinates),d=this.getProperty("icon",n,r[l]),c=this.getProperty("width",s,r[l]),p=this.getProperty("height",o,r[l]),m=this.getProperty("angle",h,r[l]),g=this.getProperty("offsetZ",u,r[l]),x=this.normizedColor(this.getProperty("mixColor",v,r[l]));f&&d&&(this.cachedData.push({point:f,icon:d,width:c,height:p,offsetZ:g,angle:m,mixColor:x,index:l}),this.iconHash.get(d)||this.iconHash.set(d,d))}r=Ci(this.iconHash.entries()).filter(function(y){return typeof y[1]=="string"}).map(function(y){var _=nt(y,2)[0];return new De(function(A,T){a.url2canvas(_,function(w){a.iconHash.set(_,w),A()})})}),De.all(r).then(function(y){a.buildSprite(t),a.webglLayer.render()})}},{key:"buildSprite",value:function(t){var r=t.padding,a=this.canvas,n=this.ctx,s=[],o=new Oe,u=!0,h=!1,v=void 0;try{for(var l=rr(this.iconHash),f;!(u=(f=l.next()).done);u=!0){var d=nt(f.value,2),c=d[1];if(typeof c!="string"){var p=c.width,m=c.height;s.push({w:p+r[0],h:m+r[0],width:p,height:m,key:d[0],icon:c})}}}catch(g){h=!0,v=g}finally{try{!u&&l.return&&l.return()}finally{if(h)throw v}}for(h=ye(s),u=0;u<s.length;u++)v=s[u],o.get(v.key)||o.set(v.key,v);for(u=oe(h.w),h=oe(h.h),a.width=u||1,a.height=h||1,n.save(),a=0;a<s.length;a++)v=s[a],n.drawImage(v.icon,v.x+r[0],v.y+r[1],v.width,v.height);n.restore(),this.loadTexture(),this.buildVertex(t,o,u,h)}},{key:"buildVertex",value:function(t,r,a,n){var s=t.enablePicked;t=t.enableColorMix;for(var o=[],u=[],h=[],v=[],l=[],f=0;f<this.cachedData.length;f++){var d=this.cachedData[f],c=d.point,p=d.width,m=d.height,g=d.offsetZ,x=d.angle,y=d.mixColor,_=d.index;if(d=r.get(d.icon)){p=p||d.icon.width,m=m||d.icon.height;var A=nt(c,3);c=A[0];var T=A[1];A=A[2];for(var w=0;4>w;w++)o.push(c,T,A),o.push(w),o.push(p,m),o.push(g),o.push(x*Math.PI/180);p=d.x/a,m=(d.x+d.w)/a,g=(d.y+d.h)/n,d=d.y/n,u.push(p,g,p,d,m,d,m,g),d=4*f,h.push(d,d+2,d+1,d,d+3,d+2),s&&(_=this.indexToRgb(_),v.push(_[0]/255,_[1]/255,_[2]/255),v.push(_[0]/255,_[1]/255,_[2]/255),v.push(_[0]/255,_[1]/255,_[2]/255),v.push(_[0]/255,_[1]/255,_[2]/255)),t&&(l.push.apply(l,Q(y)),l.push.apply(l,Q(y)),l.push.apply(l,Q(y)),l.push.apply(l,Q(y)))}}this.index=h,this.vertexBuffer.updateData(new Float32Array(o)),this.uvBuffer.updateData(new Float32Array(u)),this.indexBuffer.updateData(new Uint32Array(h)),s&&this.pickBuffer.updateData(new Float32Array(v)),t&&this.colorBuffer.updateData(new Float32Array(l))}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var r=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(r),this.setGLState({blend:!0,blendFunc:se(r,n.blend),polygonOffset:n.polygonOffset}),t=K(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:a,u_unit_px:n.unit==="px",u_zoom_units:this.map.getZoomUnits(),u_scale:n.scale}),n.enableColorMix&&(t=K(t,{u_mix_amount:n.mixAmount})),s.setUniforms(t),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,this.index.length,r.UNSIGNED_INT,0))}}},{key:"url2canvas",value:function(t,r){if((typeof t=="undefined"?"undefined":Ut(t))==="object")r(t);else{var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var n=a.width,s=a.height,o=document.createElement("canvas");o.width=n,o.height=s,o.getContext("2d").drawImage(a,0,0,n,s),r(o)},a.onerror=function(){var n=document.createElement("canvas");n.width=20,n.height=40;var s=n.getContext("2d");s.fillStyle="red",s.beginPath(),s.lineTo(0,0),s.lineTo(20,0),s.lineTo(10,40),s.closePath(),s.fill(),r(n)},a.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?Pt(this.gl,this.canvas,function(r){t.texture=r}):this.texture=null}}]),i}(rt),Th=function(e){function i(t){O(this,i);var r=W(this,(i.__proto__||U(i)).call(this,t));return t=r.getOptions(),r.shapeLayer=new Ii({enablePicked:t.enablePicked}),r.lineLayer=new Qn,r.children=[r.shapeLayer,r.lineLayer],r}return Y(i,e),I(i,[{key:"pick",value:function(t,r){return this.shapeLayer.pick(t,r)}},{key:"onOptionsChanged",value:function(t){this.shapeLayer.setOptions({onClick:function(r){t.onClick&&t.onClick(r)},selectedIndex:t.selectedIndex,selectedColor:t.selectedColor,height:0,polygonOffset:[2,2],autoSelect:t.autoSelect,color:t.fillColor,opacity:t.fillOpacity,topColor:t.fillColor,useLight:!1}),this.lineLayer.setOptions({dashArray:t.dashArray,color:t.lineColor,width:t.lineWidth,lineJoin:t.lineJoin})}},{key:"onDataChanged",value:function(t){this.shapeLayer.setData(t),this.lineLayer.setData(t,{closePath:!0})}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,dashArray:[0,0],lineColor:"rgba(250, 250, 25, 1)",lineWidth:2,lineJoin:"miter",fillColor:"rgba(25, 25, 250, 1)",fillOpacity:1}}}]),i}(pe),lt=lt||{},Is=0,Jt=null,wh=lt.Scene=function(e,i){this.name=i.name!==void 0?i.name:null,this.nodes=Array(i.nodes.length);for(var t=0,r=i.nodes.length;t<r;t++)this.nodes[t]=e.nodes[i.nodes[t]];this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null,this.boundingBox=null},ge=lt.BoundingBox=function(e,i,t){e=e||j.fromValues(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=i||j.fromValues(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),t===void 0||t===!0?(this.min=j.clone(e),this.max=j.clone(i)):(this.min=e,this.max=i),this.transform=z.create()};ge.prototype.updateBoundingBox=function(e){j.min(this.min,this.min,e.min),j.max(this.max,this.max,e.max)},ge.prototype.calculateTransform=function(){this.transform[0]=this.max[0]-this.min[0],this.transform[5]=this.max[1]-this.min[1],this.transform[10]=this.max[2]-this.min[2],this.transform[12]=this.min[0],this.transform[13]=this.min[1],this.transform[14]=this.min[2]},ge.getAABBFromOBB=function(){var e=j.create(),i=j.create(),t=j.create(),r=j.create(),a=j.create();return function(n,s){j.set(e,s[0],s[1],s[2]),j.set(i,s[4],s[5],s[6]),j.set(t,s[8],s[9],s[10]),s=j.fromValues(s[12],s[13],s[14]);var o=j.clone(s);return j.scale(r,e,n.min[0]),j.scale(a,e,n.max[0]),j.min(e,r,a),j.add(s,s,e),j.max(e,r,a),j.add(o,o,e),j.scale(r,i,n.min[1]),j.scale(a,i,n.max[1]),j.min(i,r,a),j.add(s,s,i),j.max(i,r,a),j.add(o,o,i),j.scale(r,t,n.min[2]),j.scale(a,t,n.max[2]),j.min(t,r,a),j.add(s,s,t),j.max(t,r,a),j.add(o,o,t),n=new ge(s,o,!1),n.calculateTransform(),n}}();var bs=lt.Accessor=function(e,i){this.bufferView=i,this.componentType=e.componentType,this.byteOffset=e.byteOffset!==void 0?e.byteOffset:0,this.byteStride=i.byteStride,this.normalized=e.normalized!==void 0?e.normalized:!1,this.count=e.count,this.type=e.type,this.size=ho[this.type],this.min=e.min,this.max=e.max,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null};bs.prototype.prepareVertexAttrib=function(e,i){i.vertexAttribPointer(e,this.size,this.componentType,this.normalized,this.byteStride,this.byteOffset),i.enableVertexAttribArray(e)};var lo=lt.BufferView=function(e,i){this.byteLength=e.byteLength,this.byteOffset=e.byteOffset!==void 0?e.byteOffset:0,this.byteStride=e.byteStride!==void 0?e.byteStride:0,this.target=e.target!==void 0?e.target:null,this.data=i.slice(this.byteOffset,this.byteOffset+this.byteLength),this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null,this.buffer=null};lo.prototype.createBuffer=function(e){this.buffer=e.createBuffer()},lo.prototype.bindData=function(e){return this.target?(e.bindBuffer(this.target,this.buffer),e.bufferData(this.target,this.data,e.STATIC_DRAW),e.bindBuffer(this.target,null),!0):!1};var Mh=lt.Camera=function(e){this.name=e.name!==void 0?e.name:null,this.type=e.type,this.othographic=e.othographic===void 0?null:e.othographic,this.perspective=e.perspective===void 0?null:{yfov:e.perspective.yfov,znear:e.perspective.znear,zfar:e.perspective.zfar!==void 0?e.perspective.zfar:null,aspectRatio:e.perspective.aspectRatio!==void 0?e.perspective.aspectRatio:null},this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},fr=lt.Node=function(e,i){if(this.name=e.name!==void 0?e.name:null,this.nodeID=i,this.camera=e.camera!==void 0?e.camera:null,this.matrix=z.create(),e.hasOwnProperty("matrix")){for(i=0;16>i;++i)this.matrix[i]=e.matrix[i];this.translation=j.create(),z.getTranslation(this.translation,this.matrix),this.rotation=Oi.create(),z.getRotation(this.rotation,this.matrix),this.scale=j.create(),z.getScaling(this.scale,this.matrix)}else this.getTransformMatrixFromTRS(e.translation,e.rotation,e.scale);this.children=e.children||[],this.mesh=e.mesh!==void 0?Jt.glTF.meshes[e.mesh]:null,this.skin=e.skin!==void 0?e.skin:null,e.extensions!==void 0&&e.extensions.gl_avatar!==void 0&&Jt.enableGLAvatar===!0&&(this.skin=new Fh(Jt.glTF,Jt.skeletonGltf.skins[Jt.skeletonGltf.json.extensions.gl_avatar.skins[e.extensions.gl_avatar.skin.name]],e.extensions.gl_avatar.skin.inverseBindMatrices)),this.weights=e.weights!==void 0?e.weights:null,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null,this.aabb=null,this.bvh=new ge};fr.prototype.traverse=function(e,i){i(this,e),e=0;for(var t=this.children.length;e<t;e++)this.children[e].traverse(this,i)},fr.prototype.traversePostOrder=function(e,i){for(var t=0,r=this.children.length;t<r;t++)this.children[t].traversePostOrder(this,i);i(this,e)},fr.prototype.traverseTwoExecFun=function(e,i,t){i(this,e);for(var r=0,a=this.children.length;r<a;r++)this.children[r].traverseTwoExecFun(this,i,t);t(this,e)};var ks=z.create();fr.prototype.getTransformMatrixFromTRS=function(e,i,t){this.translation=e!==void 0?j.fromValues(e[0],e[1],e[2]):j.fromValues(0,0,0),this.rotation=i!==void 0?ht.fromValues(i[0],i[1],i[2],i[3]):ht.fromValues(0,0,0,1),this.scale=t!==void 0?j.fromValues(t[0],t[1],t[2]):j.fromValues(1,1,1),this.updateMatrixFromTRS()},fr.prototype.updateMatrixFromTRS=function(){z.fromRotationTranslation(ks,this.rotation,this.translation),z.scale(this.matrix,ks,this.scale)};var Ch=lt.Mesh=function(e,i){this.meshID=i,this.name=e.name!==void 0?e.name:null,this.primitives=[],this.boundingBox=null,i=0;for(var t=e.primitives.length;i<t;++i){var r=e.primitives[i];r=new Sh(Jt.glTF,r),this.primitives.push(r),r.boundingBox&&(this.boundingBox||(this.boundingBox=new ge),this.boundingBox.updateBoundingBox(r.boundingBox))}this.boundingBox&&this.boundingBox.calculateTransform(),this.weights=e.weights!==void 0?e.weights:null,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},Sh=lt.Primitive=function(e,i){this.attributes=i.attributes,this.indices=i.indices!==void 0?i.indices:null;var t;if(i.extensions!==void 0&&i.extensions.gl_avatar!==void 0&&Jt.enableGLAvatar===!0&&i.extensions.gl_avatar.attributes)for(t in i.extensions.gl_avatar.attributes)this.attributes[t]=i.extensions.gl_avatar.attributes[t];this.indices!==null?(this.indicesComponentType=e.json.accessors[this.indices].componentType,this.indicesLength=e.json.accessors[this.indices].count,this.indicesOffset=e.json.accessors[this.indices].byteOffset||0):(this.drawArraysCount=e.json.accessors[this.attributes.POSITION].count,this.drawArraysOffset=e.json.accessors[this.attributes.POSITION].byteOffset||0);for(t in this.attributes)this.attributes[t]=e.accessors[this.attributes[t]];this.material=i.material!==void 0?e.materials[i.material]:null,this.mode=i.mode!==void 0?i.mode:4,this.targets=i.targets,this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null,this.boundingBox=this.shader=this.indexBuffer=this.vertexBuffer=this.vertexArray=null,this.attributes.POSITION!==void 0&&(e=this.attributes.POSITION,e.max&&e.type==="VEC3"&&(this.boundingBox=new ge(j.fromValues(e.min[0],e.min[1],e.min[2]),j.fromValues(e.max[0],e.max[1],e.max[2]),!1),this.boundingBox.calculateTransform()))},Us=lt.Texture=function(e){this.name=e.name!==void 0?e.name:null,this.sampler=e.sampler!==void 0?Jt.glTF.samplers[e.sampler]:null,this.source=e.source!==void 0?Jt.glTF.images[e.source]:null,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null,this.texture=null};Us.prototype.createTexture=function(e){this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)};var Ns=lt.Sampler=function(e){this.name=e.name!==void 0?e.name:null,this.magFilter=e.magFilter!==void 0?e.magFilter:null,this.minFilter=e.minFilter!==void 0?e.minFilter:null,this.wrapS=e.wrapS!==void 0?e.wrapS:10497,this.wrapT=e.wrapT!==void 0?e.wrapT:10497,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null,this.sampler=null};Ns.prototype.createSampler=function(e){this.sampler=e.createSampler(),this.minFilter?e.samplerParameteri(this.sampler,e.TEXTURE_MIN_FILTER,this.minFilter):e.samplerParameteri(this.sampler,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_LINEAR),this.magFilter?e.samplerParameteri(this.sampler,e.TEXTURE_MAG_FILTER,this.magFilter):e.samplerParameteri(this.sampler,e.TEXTURE_MAG_FILTER,e.LINEAR),e.samplerParameteri(this.sampler,e.TEXTURE_WRAP_S,this.wrapS),e.samplerParameteri(this.sampler,e.TEXTURE_WRAP_T,this.wrapT)};var fo=lt.TextureInfo=function(e){this.index=e.index,this.texCoord=e.texCoord!==void 0?e.texCoord:0,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},js=lt.PbrMetallicRoughness=function(e){this.baseColorFactor=e.baseColorFactor!==void 0?e.baseColorFactor:[1,1,1,1],this.baseColorTexture=e.baseColorTexture!==void 0?new fo(e.baseColorTexture):null,this.metallicFactor=e.metallicFactor!==void 0?e.metallicFactor:1,this.roughnessFactor=e.roughnessFactor!==void 0?e.roughnessFactor:1,this.metallicRoughnessTexture=e.metallicRoughnessTexture!==void 0?new fo(e.metallicRoughnessTexture):null,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},Ph=lt.NormalTextureInfo=function(e){this.index=e.index,this.texCoord=e.texCoord!==void 0?e.texCoord:0,this.scale=e.scale!==void 0?e.scale:1,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},Eh=lt.OcclusionTextureInfo=function(e){this.index=e.index,this.texCoord=e.texCoord!==void 0?e.texCoord:0,this.strength=e.strength!==void 0?e.strength:1,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},Rh=lt.Material=function(e){this.name=e.name!==void 0?e.name:null,this.pbrMetallicRoughness=e.pbrMetallicRoughness!==void 0?new js(e.pbrMetallicRoughness):new js({baseColorFactor:[1,1,1,1],metallicFactor:1,metallicRoughnessTexture:1}),this.normalTexture=e.normalTexture!==void 0?new Ph(e.normalTexture):null,this.occlusionTexture=e.occlusionTexture!==void 0?new Eh(e.occlusionTexture):null,this.emissiveTexture=e.emissiveTexture!==void 0?new fo(e.emissiveTexture):null,this.emissiveFactor=e.emissiveFactor!==void 0?e.emissiveFactor:[0,0,0],this.alphaMode=e.alphaMode!==void 0?e.alphaMode:"OPAQUE",this.alphaCutoff=e.alphaCutoff!==void 0?e.alphaCutoff:.5,this.doubleSided=e.doubleSided||!1,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},Lh=lt.Skin=function(e,i,t){this.name=i.name!==void 0?i.name:null,this.skinID=t,this.joints=Array(i.joints.length);var r;for(t=0,r=this.joints.length;t<r;t++)this.joints[t]=e.nodes[i.joints[t]];if(this.skeleton=i.skeleton!==void 0?e.nodes[i.skeleton]:null,this.inverseBindMatrices=i.inverseBindMatrices!==void 0?e.accessors[i.inverseBindMatrices]:null,this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null,this.uniformBlockID=Is++,this.inverseBindMatrices)for(this.inverseBindMatricesData=li(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),t=0,r=this.inverseBindMatricesData.length;t<r;t+=16)this.inverseBindMatrix.push(z.fromValues(this.inverseBindMatricesData[t],this.inverseBindMatricesData[t+1],this.inverseBindMatricesData[t+2],this.inverseBindMatricesData[t+3],this.inverseBindMatricesData[t+4],this.inverseBindMatricesData[t+5],this.inverseBindMatricesData[t+6],this.inverseBindMatricesData[t+7],this.inverseBindMatricesData[t+8],this.inverseBindMatricesData[t+9],this.inverseBindMatricesData[t+10],this.inverseBindMatricesData[t+11],this.inverseBindMatricesData[t+12],this.inverseBindMatricesData[t+13],this.inverseBindMatricesData[t+14],this.inverseBindMatricesData[t+15]))},Fh=lt.SkinLink=function(e,i,t){if(this.isLink=!0,e.skins||(e.skins=[]),e.skins.push(this),this.name=i.name,this.skinID=e.skins.length-1,this.joints=i.joints,this.skeleton=i.skeleton,this.inverseBindMatrices=t!==void 0?e.accessors[t]:null,this.uniformBlockID=Is++,this.inverseBindMatrices)for(this.inverseBindMatricesData=li(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),e=0,i=this.inverseBindMatricesData.length;e<i;e+=16)this.inverseBindMatrix.push(z.fromValues(this.inverseBindMatricesData[e],this.inverseBindMatricesData[e+1],this.inverseBindMatricesData[e+2],this.inverseBindMatricesData[e+3],this.inverseBindMatricesData[e+4],this.inverseBindMatricesData[e+5],this.inverseBindMatricesData[e+6],this.inverseBindMatricesData[e+7],this.inverseBindMatricesData[e+8],this.inverseBindMatricesData[e+9],this.inverseBindMatricesData[e+10],this.inverseBindMatricesData[e+11],this.inverseBindMatricesData[e+12],this.inverseBindMatricesData[e+13],this.inverseBindMatricesData[e+14],this.inverseBindMatricesData[e+15]))},Dh=lt.Target=function(e){this.nodeID=e.node!==void 0?e.node:null,this.path=e.path,this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},Bh=lt.Channel=function(e,i){this.sampler=i.samplers[e.sampler],this.target=new Dh(e.target),this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},Hs=lt.AnimationSampler=function(e,i){this.input=e.accessors[i.input],this.output=e.accessors[i.output],this.inputTypedArray=li(this.input),this.outputTypedArray=li(this.output),this.interpolation=i.interpolation!==void 0?i.interpolation:"LINEAR",this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null,this.curIdx=0,this.curValue=ht.create(),this.endT=this.inputTypedArray[this.inputTypedArray.length-1],this.inputMax=this.endT-this.inputTypedArray[0]},Xs=ht.create(),Ws=ht.create();Hs.prototype.getValue=function(e){e>this.endT&&(e-=this.inputMax*Math.ceil((e-this.endT)/this.inputMax),this.curIdx=0);for(var i=this.inputTypedArray.length;this.curIdx<=i-2&&e>=this.inputTypedArray[this.curIdx+1];)this.curIdx++;this.curIdx>=i-1&&(e-=this.inputMax,this.curIdx=0),i=ho[this.output.type];var t=i===4?Oi.slerp:ht.lerp,r=this.curIdx,a=r*i,n=a+i;for(e=Math.max(0,e-this.inputTypedArray[r])/(this.inputTypedArray[r+1]-this.inputTypedArray[r]),r=0;r<i;r++)Xs[r]=this.outputTypedArray[a+r],Ws[r]=this.outputTypedArray[n+r];switch(this.interpolation){case"LINEAR":t(this.curValue,Xs,Ws,e)}};var Oh=lt.Animation=function(e,i){this.name=i.name!==void 0?i.name:null;var t;this.samplers=[];var r=0;for(t=i.samplers.length;r<t;r++)this.samplers[r]=new Hs(e,i.samplers[r]);for(this.channels=[],r=0,t=i.channels.length;r<t;r++)this.channels[r]=new Bh(i.channels[r],this);this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null},zh=lt.glTFModel=function(e){this.json=e,this.defaultScene=e.scene!==void 0?e.scene:0,this.version=Number(e.asset.version),e.accessors&&(this.accessors=Array(e.accessors.length)),e.bufferViews&&(this.bufferViews=Array(e.bufferViews.length)),e.scenes&&(this.scenes=Array(e.scenes.length)),e.nodes&&(this.nodes=Array(e.nodes.length)),e.meshes&&(this.meshes=Array(e.meshes.length)),e.materials&&(this.materials=Array(e.materials.length)),e.textures&&(this.textures=Array(e.textures.length)),e.samplers&&(this.samplers=Array(e.samplers.length)),e.images&&(this.images=Array(e.images.length)),e.skins&&(this.skins=Array(e.skins.length)),e.animations&&(this.animations=Array(e.animations.length)),e.cameras&&(this.cameras=Array(e.cameras.length)),this.extensions=e.extensions!==void 0?e.extensions:null,this.extras=e.extras!==void 0?e.extras:null},hr=lt.glTFLoader=function(e){this._init(),this.glTF=null,this.enableGLAvatar=!1,this.linkSkeletonGltf=null};hr.prototype._init=function(){this._loadDone=!1,this._bufferLoaded=this._bufferRequested=0,this._buffers=[],this._bufferTasks={},this._finishedPendingTasks=this._pendingTasks=this._imageLoaded=this._imageRequested=this._shaderLoaded=this._shaderRequested=0,this.onload=null,Jt=this},hr.prototype._checkComplete=function(){this._bufferRequested==this._bufferLoaded&&this._imageRequested==this._imageLoaded&&(this._loadDone=!0),this._loadDone&&this._pendingTasks==this._finishedPendingTasks&&(this._postprocess(),this.onload(this.glTF))},hr.prototype.loadGLTF_GL_Avatar_Skin=function(e,i,t){this.enableGLAvatar=!0,this.skeletonGltf=i,this.loadGLTF(e,t)},hr.prototype.loadGLTF=function(e,i){this._init(),this.onload=i||function(r){},this.baseUri=uu(e);var t=this;lu(e,function(r){r=JSON.parse(r),t.glTF=new zh(r);var a,n=function(u){if(t._buffers[a]=u,t._bufferLoaded++,t._bufferTasks[a]){var h,v=0;for(h=t._bufferTasks[a].length;v<h;++v)t._bufferTasks[a][v](u)}t._checkComplete()};if(r.buffers)for(a in r.buffers){t._bufferRequested++;var s=r.buffers[a].uri;s.indexOf("base64")===-1&&(s=t.baseUri+s),fu(s,n)}n=function(u,h){t._imageLoaded++,t.glTF.images[h]=u,t._checkComplete()};var o;if(r.images)for(o in r.images)t._imageRequested++,hu(t.baseUri+r.images[o].uri,o,n);t._checkComplete()})},hr.prototype._postprocess=function(){function e(v,l){var f=u[v.nodeID];l!==null?z.mul(f,u[l.nodeID],v.matrix):z.copy(f,v.matrix)}function i(v,l){var f=u[v.nodeID];l=l!==null?l.bvh:h.boundingBox,v.mesh&&(a=v.mesh,a.boundingBox&&(v.aabb=ge.getAABBFromOBB(a.boundingBox,f),v.children.length===0&&(j.copy(v.bvh.min,v.aabb.min),j.copy(v.bvh.max,v.aabb.max)))),j.min(l.min,l.min,v.bvh.min),j.max(l.max,l.max,v.bvh.max)}Jt=this;var t,r,a;if(this.glTF.cameras){var n=0;for(t=this.glTF.cameras.length;n<t;n++)this.glTF.cameras[n]=new Mh(this.glTF.json.cameras[n])}if(this.glTF.bufferViews)for(n=0,t=this.glTF.bufferViews.length;n<t;n++)this.glTF.bufferViews[n]=new lo(this.glTF.json.bufferViews[n],this._buffers[this.glTF.json.bufferViews[n].buffer]);if(this.glTF.accessors)for(n=0,t=this.glTF.accessors.length;n<t;n++)this.glTF.accessors[n]=new bs(this.glTF.json.accessors[n],this.glTF.bufferViews[this.glTF.json.accessors[n].bufferView]);if(this.glTF.materials)for(n=0,t=this.glTF.materials.length;n<t;n++)this.glTF.materials[n]=new Rh(this.glTF.json.materials[n]);if(this.glTF.samplers)for(n=0,t=this.glTF.samplers.length;n<t;n++)this.glTF.samplers[n]=new Ns(this.glTF.json.samplers[n]);if(this.glTF.textures)for(n=0,t=this.glTF.textures.length;n<t;n++)this.glTF.textures[n]=new Us(this.glTF.json.textures[n]);for(n=0,t=this.glTF.meshes.length;n<t;n++)this.glTF.meshes[n]=new Ch(this.glTF.json.meshes[n],n);for(n=0,t=this.glTF.nodes.length;n<t;n++)this.glTF.nodes[n]=new fr(this.glTF.json.nodes[n],n);for(n=0,t=this.glTF.nodes.length;n<t;n++){var s=this.glTF.nodes[n],o=0;for(r=s.children.length;o<r;o++)s.children[o]=this.glTF.nodes[s.children[o]]}var u=Array(this.glTF.nodes.length);for(n=0,t=u.length;n<t;n++)u[n]=z.create();for(n=0,t=this.glTF.scenes.length;n<t;n++){var h=this.glTF.scenes[n]=new wh(this.glTF,this.glTF.json.scenes[n]);for(h.boundingBox=new ge,o=0,r=h.nodes.length;o<r;o++)s=h.nodes[o],s.traverseTwoExecFun(null,e,i);h.boundingBox.calculateTransform()}for(o=0,r=this.glTF.nodes.length;o<r;o++)s=this.glTF.nodes[o],s.bvh!==null&&s.bvh.calculateTransform();if(this.glTF.animations)for(n=0,t=this.glTF.animations.length;n<t;n++)this.glTF.animations[n]=new Oh(this.glTF,this.glTF.json.animations[n]);if(this.glTF.json.skins)for(n=0,t=this.glTF.skins.length;n<t;n++)for(this.glTF.skins[n]=new Lh(this.glTF,this.glTF.json.skins[n],n),s=this.glTF.skins[n].joints,o=0,r=s.length;o<r;o++)s[o].jointID=o;for(n=0,t=this.glTF.nodes.length;n<t;n++)s=this.glTF.nodes[n],s.skin!==null&&typeof s.skin=="number"&&(s.skin=this.glTF.skins[s.skin])};var ho={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ys=function(e){function i(t,r){return O(this,i),W(this,(i.__proto__||U(i)).call(this,t,r))}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{scale:1}}},{key:"initialize",value:function(t){var r=this;this.gl=t;var a=this.getOptions();this.gltfObj=cu({gl:t,options:a}),new hr().loadGLTF(a.url,function(n){r.gltfObj.setupScene(n),r.webglLayer.render()})}},{key:"onChanged",value:function(t,r){}},{key:"render",value:function(t){var r=t.gl;t=t.matrix;var a=this.getData(),n=this.getOptions(),s=n.scale,o=[s,s,s];for(n.unit==="px"&&this.map&&(o=this.map.getZoomUnits(),o=[s*o,s*o,s*o]),s=0;s<a.length;s++){var u=a[s].geometry.coordinates;n=z.create();var h=z.create();u=this.normizedPoint(u),z.identity(n),z.translate(n,n,[u[0],u[1],u[2]]),z.rotateX(n,n,Math.PI/2),z.rotateY(n,n,(a[s].angle||0)*Math.PI/180),z.scale(n,n,o),z.mul(h,t,n),this.gltfObj.render({gl:r,matrix:h})}}}]),i}(rt),cr=cr||{};(function(){function e(t,r,a){return a=t.createShader(a),t.shaderSource(a,r),t.compileShader(a),a}cr.getShaderSource=function(t){return document.getElementById(t).textContent.replace(/^\s+|\s+$/g,"")},cr.createProgram=function(t,r,a){var n=t.createProgram();return r=e(t,r,t.VERTEX_SHADER),a=e(t,a,t.FRAGMENT_SHADER),t.attachShader(n,r),t.deleteShader(r),t.attachShader(n,a),t.deleteShader(a),t.linkProgram(n),t.getProgramInfoLog(n),t.getShaderInfoLog(r),t.getShaderInfoLog(a),n};var i=cr.loadImage=function(t,r){var a=new Image;return a.crossOrigin="Anonymous",a.src=t,a.onload=r,a};cr.loadImages=function(t,r){function a(){0>=--s&&r(n)}for(var n=[],s=t.length,o=0;o<s;++o)n.push(i(t[o],a))}})();var Ih=function(e){function i(t){O(this,i);var r=W(this,(i.__proto__||U(i)).call(this,t));return t=r.getOptions(),r.gltfLayer=new Ys({url:t.url,scale:t.scale}),r.children=[r.gltfLayer],r.autoUpdate=!0,r.index=[],r.newData=[],r.isStarted=t.autoPlay!==!1,r}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{url:"https://mapv-website.bj.bcebos.com/gl/examples/model/car.gltf",scale:1,step:1,defaultAngle:90}}},{key:"onOptionsChanged",value:function(t){this.gltfLayer.setOptions({})}},{key:"onDataChanged",value:function(t){var r=this;this.index=[],this.newData=[];for(var a=0;a<t.length;a++){this.index.push(0);var n=t[a].geometry.coordinates;t[a].geometry.type==="LineString"?this.newData.push(this._addPath(n)):n.forEach(function(s){r.newData.push(r._addPath(s))})}this.updatePoints()}},{key:"lnglatToMercator",value:function(t,r){return r=r*Math.PI/180,r=31890685e-1*Math.log((1+Math.sin(r))/(1-Math.sin(r))),[parseFloat((t*Math.PI/180*6378137).toFixed(2)),parseFloat(r.toFixed(2))]}},{key:"getDeg",value:function(t,r){-180<t[0]&&180>t[0]&&(t=this.lnglatToMercator(t[0],t[1]),r=this.lnglatToMercator(r[0],r[1]));var a=180*Math.atan((r[1]-t[1])/(r[0]-t[0]))/Math.PI;return r[0]>t[0]&&(a-=180),a}},{key:"getPoint",value:function(t,r,a){return[t[0]+(r[0]-t[0])*a,t[1]+(r[1]-t[1])*a,t[2]&&r[2]?t[2]+(r[2]-t[2])*a:0]}},{key:"updatePoints",value:function(){for(var t=this.getOptions(),r=this.newData,a=[],n=0;n<r.length;n++){for(var s=r[n],o=Math.floor(this.index[n]),u=o+1;s[u]&&s[u][0]===s[o][0]&&s[u][1]===s[o][1];)u++;u>=s.length-1&&(u=--o),u=this.getDeg(s[o],s[u]),a.push({geometry:{type:"Point",coordinates:this.getPoint(s[o],s[o+1],this.index[n]%1)},angle:u-t.defaultAngle})}this.pointData=a,this.gltfLayer.setData(a,{autoRender:!1})}},{key:"getCurrentPoint",value:function(){return this.pointData}},{key:"getDistance",value:function(t,r){var a=t[1]*Math.PI/180,n=r[1]*Math.PI/180;return t=2*Math.asin(Math.sqrt(Math.pow(Math.sin((a-n)/2),2)+Math.cos(a)*Math.cos(n)*Math.pow(Math.sin((t[0]*Math.PI/180-r[0]*Math.PI/180)/2),2))),t=Math.round(6378137e4*t)/1e4}},{key:"_addPath",value:function(t){for(var r=t.length,a=0,n=[],s=[],o=1;o<r;o++){var u=this.getDistance(t[o-1],t[o]);n.push(u),a+=u}for(u=[0],o=1;o<r;o++){var h=(n[o-1]/a).toFixed(2);u[o]=u[o-1]+parseFloat(h,10),s=s.concat(this._getPath(t[o-1],t[o],1e3*h))}return this._pathPercents=u,s}},{key:"_getPath",value:function(t,r,a){if(a===0)return[t];for(var n=[],s=0;s<=a;s++)n.push([(r[0]-t[0])/a*s+t[0],(r[1]-t[1])/a*s+t[1],r[2]&&t[2]?(r[2]-t[2])/a*s+t[2]:0]);return n}},{key:"start",value:function(){this.isStarted=!0}},{key:"stop",value:function(){this.isStarted=!1}},{key:"render",value:function(t){if(ve(i.prototype.__proto__||U(i.prototype),"render",this).call(this,t),t=this.getOptions(),this.isStarted)for(var r=this.newData,a=0;a<this.index.length;a++)this.index[a]+=t.step,this.index[a]>r[a].length-2&&(this.index[a]=0);this.updatePoints()}}]),i}(pe),bh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="BoardTextLayer",r=t.canvas=document.createElement("canvas"),r=t.ctx=r.getContext("2d"),r.textAlign="start",r.textBaseline="top",t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,collides:!0,unit:"px",angle:0,translateX:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],shadow:{},maxHeightLine:20,lineBreak:`
`}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new q(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uUnitPx;uniform float zoomUnits;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/mat3 rotateZ(float angle){float cos0=cos(angle);float sin0=sin(angle);return mat3(cos0,sin0,0.,-sin0,cos0,0.,0.,0.,1.);}vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;float z=coord.z;mat3 mat=rotateZ(rotation);vec3 rotated=vec3(size[0],0.0,size[1]);if(corner==1.0){rotated=mat*vec3(-size[0],0.0,size[1]);}else if(corner==2.0){rotated=mat*vec3(size[0],0.0,size[1]);}else if(corner==3.0){rotated=mat*vec3(size[0],0.0,-size[1]);}else{rotated=mat*vec3(-size[0],0.0,-size[1]);}x+=rotated.x;y+=rotated.y;z+=rotated.z;return vec3(x,y,z);}void main(){vTextCoord=aTextCoord;vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}",fragmentShader:`precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){vec4 textureColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));if(textureColor.a<=0.1&&uIsPickRender==false){discard;}gl_FragColor=textureColor;
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:r.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){this.gl&&this.processCache(t,r)}},{key:"processCache",value:function(t,r){this.cachedData=[];for(var a=0;a<r.length;a++){var n=this.normizedPoint(r[a].geometry.coordinates),s=r[a].text;"properties"in r[a]&&"text"in r[a].properties&&(s=r[a].properties.text);var o=this.getProperty("angle",t.angle,r[a]),u=this.getProperty("color",t.color,r[a]),h=this.getProperty("maxHeightLine",t.maxHeightLine,r[a]);n&&s!==void 0&&this.cachedData.push({point:n,text:s,angle:o,color:u,maxHeightLine:h,index:a})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var r=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(r),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:se(r,n.blend),polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();s.setUniforms(K(this.getCommonUniforms(t),{matrix:a,textureImage:this.texture,offset:n.offset,zoomUnits:o,zIndex:n.zIndex,uUnitPx:n.unit==="px"})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,this.index.length,r.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var r=t.gl,a=t.matrix,n=this.getOptions();t=n.fontSize;var s=n.fontFamily,o=n.translateX,u=n.padding,h=n.margin,v=n.collides,l=n.enablePicked,f=n.shadow;n=n.lineBreak;var d=r.canvas.width/window.devicePixelRatio,c=r.canvas.height/window.devicePixelRatio,p=this.canvas,m=this.ctx;m.save(),m.scale(window.devicePixelRatio,window.devicePixelRatio),m.textBaseline="top",m.font="normal bold 20px "+s;var g=new sr;r=[];for(var x=0;x<this.cachedData.length;x++){var y=this.cachedData[x],_=y.point,A=y.text,T=y.angle,w=y.index,C=y.color;y=y.maxHeightLine;var M=nt(_,3),E=ht.clone([M[0],M[1],M[2],1]);ht.transformMat4(E,E,a),ht.scale(E,E,1/E[3]),M=(E[0]+1)/2*d,E=(-E[1]+1)/2*c;var P=m.measureText(A),L=A.split(n),R=L.map(function(S){return m.measureText(S).width});R=Math.max.apply(Math,Q(R));for(var b=20,H=0;H<L.length-1;H++)b+=y;if(L=b,P=Math.min(P.width,R)+1,P+=2*u[0]+o,L+=2*u[1],b=P+h[0],R=L+h[1],M-=b/2,E-=R/2,b=M+b,R=E+R,!(0>b||0>R||M>d||E>c)){if(v){if(M={minX:M,maxX:b,minY:E,maxY:R},g.collides(M))continue;g.insert(M)}r.push({w:P,h:L,point:_,text:A,color:C,angle:T,maxHeightLine:y,dataIndex:w})}}for(m.restore(),a=[],h=[],v=[],d=[],g=ye(r),c=g.w,g=g.h,0>=c&&(c=1),0>=g&&(g=1),p.width=c*window.devicePixelRatio,p.height=g*window.devicePixelRatio,m.save(),m.scale(window.devicePixelRatio,window.devicePixelRatio),m.textBaseline="top",m.font="normal bold 20px "+s,m.shadowColor=f&&f.color,m.shadowOffsetX=f&&f.offsetX,m.shadowOffsetY=f&&f.offsetY,m.shadowBlur=f&&f.blur,s=0,f=r.length;s<f;++s){for(p=r[s],m.fillStyle=p.color,du(m,p.text,p.x+u[0]+o,p.y+u[1],p.maxHeightLine,n),A=nt(p.point,3),x=A[0],_=A[1],A=A[2],T=0;4>T;T++)a.push(x,_,A),a.push(T),a.push(p.w,p.h),a.push(t/20,p.angle*Math.PI/180);x=p.x/c,_=(p.x+p.w)/c,A=(p.y+p.h)/g,T=p.y/g,h.push(x,A,x,T,_,T,_,A),x=4*s,v.push(x,x+2,x+1,x,x+3,x+2),l&&(p=this.indexToRgb(p.dataIndex),d.push(p[0]/255,p[1]/255,p[2]/255),d.push(p[0]/255,p[1]/255,p[2]/255),d.push(p[0]/255,p[1]/255,p[2]/255),d.push(p[0]/255,p[1]/255,p[2]/255))}m.restore(),this.loadTexture(),this.index=v,this.vertexBuffer.updateData(new Float32Array(a)),this.uvBuffer.updateData(new Float32Array(h)),this.indexBuffer.updateData(new Uint32Array(v)),l&&this.pickBuffer.updateData(new Float32Array(d))}},{key:"loadTexture",value:function(){var t=this;this.canvas?Pt(this.gl,this.canvas,function(r){t.texture=r},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),i}(rt),kh=function(e){function i(t){O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.name="LabelLayer";var r=t.canvas=document.createElement("canvas");return t.ctx=r.getContext("2d"),t.arrowHeight=8,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,textColor:"#0f0",borderColor:"#f00",backgroundColor:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,lineHeight:20,textAlign:"left",collides:!1,offset:[0,0],padding:[2,2],polygonOffset:[0,0],borderRadius:5}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new q(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x;y+=size.y;}else if(corner==2.0){x+=size.x;y+=size.y;}else if(corner==3.0){x+=size.x;y+=-size.y;}else{x+=-size.x;y+=-size.y;}return vec3(x,y+size.y,coord.z);}void main(){vTextCoord=aTextCoord;vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z+zIndex,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio;vec3 current=transformCoord(screen,halfSize,corner);gl_Position=vec4(current,1.0);}",fragmentShader:`precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:r.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{name:"position",buffer:this.vertexBuffer,size:3,stride:24,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:24,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:24,type:"FLOAT",offset:16},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){this.gl&&this.processCache(t,r)}},{key:"processCache",value:function(t,r){for(this.cachedData=[],t=0;t<r.length;t++){var a=r[t],n=this.normizedPoint(a.geometry.coordinates);n&&this.cachedData.push({point:n,item:a,index:t})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var r=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(r),this.updateText(t),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();s.setUniforms(K(this.getCommonUniforms(t),{matrix:a,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,offset:n.offset,zoomUnits:o,zIndex:n.zIndex})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,this.index.length,r.UNSIGNED_INT,0))}}},{key:"updateText",value:function(t){var r=this,a=t.gl,n=t.matrix,s=this.getOptions().enablePicked;t=this.canvas;var o=this.ctx;a=this.createMapbox(o,a,n),n=ye(a);var u=n.w,h=n.h;0>=u&&(u=1),0>=h&&(h=1),t.width=u*window.devicePixelRatio,t.height=h*window.devicePixelRatio;var v=[],l=[],f=[],d=[];a.forEach(function(c,p){r.drawItem(o,c);var m=nt(c.point,3),g=m[0],x=m[1];m=m[2];for(var y=0;4>y;y++)v.push(g,x,m),v.push(y),v.push(c.w,c.h);g=c.x/u,x=(c.x+c.w)/u,m=(c.y+c.h)/h,y=c.y/h,l.push(g,m,g,y,x,y,x,m),p*=4,f.push(p,p+2,p+1,p,p+3,p+2),s&&(c=r.indexToRgb(c.dataIndex),d.push(c[0]/255,c[1]/255,c[2]/255),d.push(c[0]/255,c[1]/255,c[2]/255),d.push(c[0]/255,c[1]/255,c[2]/255),d.push(c[0]/255,c[1]/255,c[2]/255))}),this.loadTexture(),this.index=f,this.vertexBuffer.updateData(new Float32Array(v)),this.uvBuffer.updateData(new Float32Array(l)),this.indexBuffer.updateData(new Uint32Array(f)),s&&this.pickBuffer.updateData(new Float32Array(d))}},{key:"createMapbox",value:function(t,r,a){var n=this,s=this.getOptions(),o=s.padding,u=s.collides,h=s.fontSize,v=r.canvas.width/window.devicePixelRatio,l=r.canvas.height/window.devicePixelRatio,f=new sr,d=[];return this.cachedData.forEach(function(c){var p=c.point,m=c.item;c=c.index;var g=nt(p,3);g=ht.clone([g[0],g[1],g[2],1]),ht.transformMat4(g,g,a),ht.scale(g,g,1/g[3]);var x=(g[0]+1)/2*v,y=(-g[1]+1)/2*l;g=n.computeTextWH(m,t,o,h);var _=nt(g,2);g=_[0],_=_[1],x-=g/2,y-=_/2;var A=x+g,T=y+_;if(!(0>A||0>T||x>v||y>l)){if(u){if(x={minX:x,maxX:A,minY:y,maxY:T},f.collides(x))return;f.insert(x)}d.push({w:g,h:_+n.arrowHeight,point:p,item:m,dataIndex:c})}}),d}},{key:"computeTextWH",value:function(t,r){var a=this.getOptions(),n=a.padding,s=a.fontSize,o=a.borderRadius,u=a.fontFamily;return a=a.lineHeight,r.save(),r.scale(window.devicePixelRatio,window.devicePixelRatio),r.font=s+"px "+u,t=t.properties.text.split(`
`),s=t.reduce(function(h,v){return h.length<v.length?v:h},""),s=r.measureText(s),r.restore(),[s.width+2*(n[1]+o),2*(n[0]+o)+a*t.length]}},{key:"drawItem",value:function(t,r){var a=this.getOptions(),n=a.padding,s=a.backgroundColor,o=a.textColor,u=a.fontSize,h=a.borderColor,v=a.borderRadius,l=a.fontFamily,f=a.lineHeight;a=a.textAlign;var d=v-1,c=r.x,p=r.y,m=r.w,g=r.h;r=r.item;var x="";Ut(r.properties)==="object"&&(x=r.properties.text||"",o=r.properties.textColor||o,h=r.properties.borderColor||h,s=r.properties.backgroundColor||s),r=x.split(`
`),g-=this.arrowHeight,t.save(),t.scale(window.devicePixelRatio,window.devicePixelRatio),t.textBaseline="top",t.font=u+"px "+l,t.translate(c,p),t.fillStyle=s,t.strokeStyle=h,t.beginPath(),t.arc(v,v,d,Math.PI,1.5*Math.PI),t.lineTo(m-v,1),t.arc(m-v,v,d,1.5*Math.PI,0),t.lineTo(m-1,g-v),t.arc(m-v,g-v,d,0*Math.PI,.5*Math.PI),t.lineTo(v,g-1),t.arc(v,g-v,d,.5*Math.PI,1*Math.PI),t.lineTo(1,v),t.closePath(),t.fill(),t.stroke(),t.beginPath(),s=this.arrowHeight,l=m/2,d=s/2,t.moveTo(l-d,g-1),t.lineTo(l+d,g-1),t.lineTo(l,g+.8*s),t.fillStyle=h,t.fill(),t.fillStyle=o;var y=a==="center"?l:a==="right"?m-v-n[1]:v+n[1];t.textAlign=a,r.forEach(function(_,A){t.fillText(_,y,v+n[0]+(A+.5)*f-.5*u)}),t.restore()}},{key:"loadTexture",value:function(){var t=this;this.canvas?Pt(this.gl,this.canvas,function(r){t.texture=r},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),i}(rt);dt.prototype.parseColors=function(e){this.arrFeatureStyles=[[2,e[0]||"rgba(79,210,125,1)",2,2,0,[],0,0],[2,e[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,e[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,e[0]||"rgba(79,210,125,1)",5,2,0,[],0,0],[2,e[0]||"rgba(79,210,125,1)",6,2,0,[],0,0],[2,e[2]||"rgba(255,208,69,1)",2,2,0,[],0,0],[2,e[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,e[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,e[2]||"rgba(255,208,69,1)",5,2,0,[],0,0],[2,e[2]||"rgba(255,208,69,1)",6,2,0,[],0,0],[2,e[1]||"rgba(232,14,14,1)",2,2,0,[],0,0],[2,e[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,e[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,e[1]||"rgba(232,14,14,1)",5,2,0,[],0,0],[2,e[1]||"rgba(232,14,14,1)",6,2,0,[],0,0],[2,e[3]||"rgba(181,0,0,1)",2,2,0,[],0,0],[2,e[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,e[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,e[3]||"rgba(181,0,0,1)",5,2,0,[],0,0],[2,e[3]||"rgba(181,0,0,1)",6,2,0,[],0,0],[2,"rgba(255,255,255,1)",4,0,0,[],0,0],[2,"rgba(255,255,255,1)",5.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",7,0,0,[],0,0],[2,"rgba(255,255,255,1)",8.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",10,0,0,[],0,0]]},dt.prototype.setColors=function(e){this.parseColors(e)},dt.prototype.initialize=function(e){this._initialize||(this._initialize=!0)},dt.prototype.clearCache=function(e){this.cache={}},dt.prototype.setMap=function(e){e?(this.map=e,this._initialize?this.canvaslayer.show():this.initialize(e)):this.canvaslayer.hide()},dt.prototype.draw=function(e){e=e||{},e.clearCache&&this.clearCache(),this.canvaslayer.draw()},dt.prototype.clear=function(){},dt.prototype.update=function(){var e=this.map,i=this.getDataZoom(),t=Math.pow(2,18-i),r=256*t,a=Lt.convertLL2MC(e.getCenter()),n=Math.ceil(a.lng/r),s=Math.ceil(a.lat/r),o=this.tileSize,u=i-Math.round(e.getZoom());for(0<u&&(o/=Math.pow(2,u)),r=[n,s,(a.lng-n*r)/r*o,(a.lat-s*r)/r*o],n=e.getBounds(),a=n.getNorthEast(),n=n.getSouthWest(),e.getSize(),e.getSize(),e=(a.lng-n.lng)/t,t=(a.lat-n.lat)/t,a=r[1]-Math.ceil((t/2-r[3])/o),n=r[0]+Math.ceil((e/2+r[2])/o),s=r[1]+Math.ceil((t/2+r[3])/o),t=[],o=r[0]-Math.ceil((e/2-r[2])/o);o<n;o++)for(r=a;r<s;r++)t.push([o,r,i]);for(this.tilesOrder=t,this._loadCount={},o=0;o<t.length;o++)r=t[o][0],e=t[o][1],this._loadCount[r+"_"+e+"_"+t[o][2]]=!1;for(o=0;o<t.length;o++)r=t[o][0],e=t[o][1],this.showTile(r,e,i)},dt.prototype.showTile=function(e,i,t){this._parseDataAndDraw(e,i,t)},dt.prototype.drawCurrentData=function(){this.clear();for(var e=[],i=0;i<this.tilesOrder.length;i++){var t=this.tilesOrder[i][0],r=this.tilesOrder[i][1],a=this.tilesOrder[i][2],n=this.cache[this.getCacheKey(t,r,a)];if(n)for(t=this._drawFeatures(n,t,r,a),r=0;r<t.length;r++)e.push(t[r])}this.lineLayer.setData(e)},dt.prototype.isAllLoaded=function(){var e=!0,i;for(i in this._loadCount)if(!this._loadCount[i]){e=!1;break}return e},dt.prototype.getCacheKey=function(e,i,t){return e+"_"+i+"_"+t},dt.prototype.getDataZoom=function(){var e=Math.round(this.map.getZoom());return 19<e&&(e=19),e},dt.prototype._parseDataAndDraw=function(e,i,t){var r=this,a=r.map,n=a.getCenter(),s=Math.round(a.getZoom()),o=this.getCacheKey(e,i,t),u="_cbk"+(1e5*Math.random()).toFixed(0),h=this.getTileUrl(e,i,t,"BMapGL."+u);BMapGL[u]=function(v){r._loadCount[e+"_"+i+"_"+t]=!0;var l=a.getCenter(),f=Math.round(a.getZoom());l.equals(n)&&f===s?(l=v.content&&v.content.tf,v.data&&(l=v.data),r.cache[o]=l?{traffic:l,precision:v.precision}:null,r.drawTogether&&r.isAllLoaded()&&r.drawCurrentData()):f!==s&&r.clear(),delete BMapGL[u]},r.cache[o]!==void 0?(r._loadCount[e+"_"+i+"_"+t]=!0,r.drawTogether&&r.isAllLoaded()&&r.drawCurrentData()):this.request(h)},dt.prototype.getTileUrl=function(e,i,t,r){return"https://sp3.baidu.com/7_AZsjOpB1gCo2Kml5_Y_DAcsMJiwa/traffic/?qt=vtraffic&x="+e+"&y="+i+"&z="+t+"&fn="+r+"&t="+new Date().getTime()},dt.prototype._drawFeatures=function(e,i,t,r){var a=10;r=Math.pow(2,18-r),this.map.getCenter();var n=this.tileSize;if(i=[i*n*r,(t+1)*n*r],t=[],e&&e.traffic){a*=e.precision,e=e.traffic,n=0;for(var s=e.length;n<s;n++){var o=e[n],u=o[1];o=this.arrFeatureStyles[o[3]];var h=u[0]/a,v=-u[1]/a,l=[];l.push([i[0]+h*r,i[1]+v*r,1]);for(var f=2,d=u.length;f<d;f+=2)h+=u[f]/a,v-=u[f+1]/a,l.push([i[0]+h*r,i[1]+v*r,1]);t.push({color:o[1],geometry:{type:"LineString",coordinates:l}})}}return t},dt.prototype.request=function(e,i){if(i){var t=(1e5*Math.random()).toFixed(0);BMapGL._rd["_cbk"+t]=function(a){i&&i(a),delete BMapGL._rd["_cbk"+t]},e+="&callback=BMapGL._rd._cbk"+t}var r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",r.src=e,r.addEventListener?r.addEventListener("load",function(a){a=a.target,a.parentNode.removeChild(a)},!1):r.attachEvent&&r.attachEvent("onreadystatechange",function(a){a=window.event.srcElement,!a||a.readyState!=="loaded"&&a.readyState!=="complete"||a.parentNode.removeChild(a)}),setTimeout(function(){document.getElementsByTagName("head")[0].appendChild(r),r=null},1)},dt.prototype.getRGBA=function(e){return e>>>=0,"rgba("+(e>>24&255)+","+(e>>16&255)+","+(e>>8&255)+","+(e&255)/256+")"},dt.prototype.getLineCap=function(e){return["butt","square","round"][e]},dt.prototype.getLineJoin=function(e){return["miter","bevel","round"][e]};var Uh=function(e){function i(t){O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t)),t.autoUpdate=!0,t.getOptions();var r=new zs({color:"rgba(257, 254, 47, 0.9)",minZoom:18,duration:.8,interval:.2,trailLength:.4});return t.lineLayer=r,t.children=[r],t}return Y(i,e),I(i,[{key:"initialize",value:function(t){ve(i.prototype.__proto__||U(i.prototype),"initialize",this).call(this,t),t=this.map.map;var r=new dt({});r.lineLayer=this.lineLayer,this.trafficTileManager=r,r.setMap(t),r.update(),t.addEventListener("moveend",function(){r.update()}),t.addEventListener("zoomend",function(){r.update()}),t.addEventListener("ondraw",function(){})}},{key:"onOptionsChanged",value:function(t){}},{key:"onDataChanged",value:function(t){}},{key:"getDefaultOptions",value:function(){return{}}}]),i}(pe),Nh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="HeatmapLayer",t.bufferData=[],t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{size:13,unit:"px",height:0,max:100,min:0,opacity:1}}},{key:"initialize",value:function(t){var r=this;this.gl=t;var a=this.getOptions();this.inverseMatrix=z.create(Float64Array),this.frameBuffer=new wt(t),this.webglLayer.map.onResize(function(){r.frameBuffer=new wt(t)}),this.circle=vu(64),this.circleTexture=Qe(t,this.circle,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}),this.intensity=new St({gradient:a.gradient}),this.paletteTexture=Qe(t,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}),this.offlineProgram=new q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform mat4 pointToPixelMatrix;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform int unit;uniform float size;uniform float max;uniform float min;attribute vec3 aPos;attribute vec2 aOffset;attribute float aCount;varying vec2 vOffset;varying float vCount;varying vec3 vPosition;void main(){vOffset=aOffset;vCount=(aCount-min)/(max-min);if(unit==1){vec2 pos=(pointToPixelMatrix*vec4(aPos.xy,0.0,1.0)).xy+aOffset.xy*size/2.0;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pos,0.0,1.0);}else{vec2 pos=aPos.xy+aOffset.xy*size;gl_Position=u_matrix*vec4(pos,0.0,1.0);}vPosition=vec3(gl_Position.z/gl_Position.w);}",fragmentShader:"varying vec2 vOffset;varying float vCount;varying vec3 vPosition;uniform sampler2D uCircle;void main(){vec4 circle=texture2D(uCircle,(vOffset+1.0)/2.0);float intensity=circle.a*vCount;if(intensity<=0.0){discard;}gl_FragColor=vec4(vPosition,intensity);}"},this),this.offlineBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineIndexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineVertexArray=new at({gl:t,program:this.offlineProgram,attributes:[{stride:24,name:"aPos",buffer:this.offlineBuffer,size:3,type:"FLOAT",offset:0},{stride:24,name:"aOffset",buffer:this.offlineBuffer,size:2,type:"FLOAT",offset:12},{stride:24,name:"aCount",buffer:this.offlineBuffer,size:1,type:"FLOAT",offset:20}]}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.program=new q(this.gl,{vertexShader:"attribute vec2 aPos;varying vec2 vPos;uniform float uHeight;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform sampler2D u_sampler;uniform mat4 inverseMatrix;void main(){vPos=aPos;if(uHeight<=0.0){gl_Position=vec4(aPos,0.0,1.0);}else{vec4 gray=texture2D(u_sampler,(aPos+1.0)/2.0);vec4 m0=inverseMatrix*vec4(aPos.xy,0.0,1.0);vec4 m1=inverseMatrix*vec4(aPos.xy,1.0,1.0);m0/=m0.w;m1/=m1.w;vec4 pixel=m0+(-m0.z/(m1.z-m0.z))*(m1-m0);pixel.z=uHeight*gray.a;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pixel.xyz,1.0);}}",fragmentShader:"uniform sampler2D u_sampler;uniform sampler2D u_samplerPalette;uniform float uHeight;uniform float opacity;varying vec2 vPos;void main(){vec4 gray=texture2D(u_sampler,(vPos+1.0)/2.0);float grayAlpha=gray.a;if(grayAlpha<=0.0){discard;}gl_FragColor=texture2D(u_samplerPalette,vec2(grayAlpha,1.0));float addAlpha=1.0;if(gray.a<0.3){addAlpha=gray.a*3.3;}gl_FragColor.a*=addAlpha;gl_FragColor.a*=opacity;}"},this),this.buffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new at({gl:t,program:this.program,attributes:[{stride:8,name:"aPos",buffer:this.buffer,size:2,type:"FLOAT",offset:0}]}),a=[];for(var n=[],s=Math.floor(t.canvas.width/4),o=Math.floor(t.canvas.height/4),u=s+1,h=0;h<=o;h++)for(var v=0;v<=s;v++)if(a.push(2*v/s-1,2*h/o-1),v<s&&h<o){var l=u*h+v,f=u*(h+1)+v;n.push(l,l+1,f+1),n.push(l,f+1,f)}this.bufferData=a,this.buffer.updateData(new Float32Array(a)),this.indexData=n,this.indexBuffer.updateData(new Uint32Array(n))}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onOptionsChanged",value:function(t,r){var a=this.gl;a&&t.gradient!==r.gradient&&(this.intensity=new St({gradient:t.gradient}),this.paletteTexture=Qe(a,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}))}},{key:"onDataChanged",value:function(t){if(this.gl){var r=[],a=[];this.getOptions();for(var n=0;n<t.length;n++){var s=t[n],o=this.normizedPoint(t[n].geometry.coordinates),u=s.count===void 0?1:s.count;"properties"in s&&"count"in s.properties&&(u=s.properties.count),r.push(o[0],o[1],o[2]),r.push(-1,-1),r.push(u),r.push(o[0],o[1],o[2]),r.push(-1,1),r.push(u),r.push(o[0],o[1],o[2]),r.push(1,1),r.push(u),r.push(o[0],o[1],o[2]),r.push(1,-1),r.push(u),s=4*n,a.push(s+0,s+2,s+1),a.push(s+0,s+3,s+2)}this.offlineBufferData=r,this.offlineIndexData=a,this.offlineBuffer.updateData(new Float32Array(r)),this.offlineIndexBuffer.updateData(new Uint32Array(a))}}},{key:"render",value:function(t){var r=t.gl,a=t.matrix,n=t.pointToPixelMatrix,s=t.pixelToViewMatrix;if(t=t.projectionMatrix,this.offlineBufferData&&!(0>=this.offlineBufferData.length)){var o=this.getOptions();this.setGLState({blend:!0,blendFunc:[r.ONE,r.ONE],depthTest:!1}),r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer.framebuffer),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.offlineProgram.use(r),this.offlineProgram.setUniforms({u_matrix:a,uCircle:this.circleTexture,pointToPixelMatrix:n,pixelToViewMatrix:s,projectionMatrix:t,unit:o.unit==="px"?1:0,size:o.size,max:o.max,min:o.min}),this.offlineVertexArray.bind(),this.offlineIndexBuffer.bind(),r.drawElements(r.TRIANGLES,this.offlineIndexData.length,r.UNSIGNED_INT,0),r.bindFramebuffer(r.FRAMEBUFFER,null),this.program.use(r),this.vertexArray.bind(),a=this.inverseMatrix,z.identity(a),z.multiply(a,t,s),z.invert(a,a),this.setGLState({blend:!0,blendFunc:[r.SRC_ALPHA,r.ONE],depthTest:!!o.height}),this.program.setUniforms({u_sampler:this.frameBuffer.framebuffer.texture,u_samplerPalette:this.paletteTexture,uHeight:o.height,opacity:o.opacity,pixelToViewMatrix:s,inverseMatrix:a,projectionMatrix:t}),this.indexBuffer.bind(),r.drawElements(r.TRIANGLES,this.indexData.length,r.UNSIGNED_INT,0)}}}]),i}(rt),jh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="BarLayer",t.selectedColor=[-1,-1,-1],t.textureCache={},t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{color:"rgba(0, 180, 0, 1.0)",edgeCount:4,unit:"m",height:1e5,type:"normal",size:5e4}}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions(),a={normal:[`attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aEdgeIndex;attribute float aPointIndex;attribute float aEdgeCount;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vEdgeIndex=aEdgeIndex;vEdgeCount=aEdgeCount;vPointIndex=aPointIndex;float z=aPos.z*uZoomUnits;float x=aPos.x;float y=aPos.y;vSize=aSize*uZoomUnits;float a=radians(360.0/aEdgeCount);float b=a/2.0;float r=vSize/cos(b);if(aEdgeIndex<0.0){float index=aPointIndex;float angle=0.0;if(mod(index,2.0)==0.0){angle=a*(index/2.0)-b;}else{angle=-a*((index-1.0)/2.0)-b;}y=y+r*sin(angle);x=x+r*cos(angle);}else{float i=aEdgeIndex-1.0;float j=aPointIndex;float angle=a*i+b;y=y+r*sin(angle);x=x+r*cos(angle);}vPosition=vec4(aPos,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;if(aEdgeIndex==1.0&&aPointIndex==1.0){gl_PointSize=20.0;}else{gl_PointSize=10.0;}
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,"varying vec4 vColor;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;varying vec4 vPosition;varying vec4 vFragPosition;uniform mat4 uMatrix;void main(){vec4 color=vColor;if(vEdgeIndex<0.0){color.r+=0.2;color.g+=0.2;color.b+=0.2;}else{float i=ceil(vEdgeIndex);;float d=i/vEdgeCount*0.5;if(i<=vEdgeCount/2.0){d=0.2*(i/vEdgeCount*0.5)-0.1;}else{d=0.2*(vEdgeCount-i)/vEdgeCount*0.5-0.1;}color.r+=d;color.g+=d;color.b+=d;}gl_FragColor=color;}"],light:[`attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aEdgeIndex;attribute float aPointIndex;attribute float aEdgeCount;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vEdgeIndex=aEdgeIndex;vEdgeCount=aEdgeCount;vPointIndex=aPointIndex;float z=aPos.z*uZoomUnits;float x=aPos.x;float y=aPos.y;vSize=aSize*uZoomUnits;float a=radians(360.0/aEdgeCount);float b=a/2.0;float i=aEdgeIndex;float j=aPointIndex;float angle=a*(i-1.0)+b;float r=vSize/cos(b);y=y+r*sin(angle);x=x+r*cos(angle);if(j==1.0){z=0.0;}vPosition=vec4(aPos.xyz,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,"varying vec4 vColor;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;varying vec4 vPosition;varying vec4 vFragPosition;uniform mat4 uMatrix;void main(){vec4 color=vColor;color.a=1.0-vFragPosition.z/vPosition.z;gl_FragColor=color;}"]};a=a[r.type]||a.normal,this.program=new q(this.gl,{vertexShader:a[0],fragmentShader:a[1],defines:r.enablePicked?["PICK"]:[]},this),this.buffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{stride:44,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:44,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:12},{stride:44,name:"aEdgeIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:16},{stride:44,name:"aPointIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:20},{stride:44,name:"aEdgeCount",buffer:this.buffer,size:1,type:"FLOAT",offset:24},{stride:44,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:28}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onChanged",value:function(t,r){this.gl&&r&&(this.uniforms={},this.data=r,this.options=t,this.processData(),t.enablePicked&&this.parsePickData(r))}},{key:"processData",value:function(){var t=[],r=[];this.options.type==="light"?this.createLightBuffer(this.data,t,r):this.createNormalBuffer(this.data,t,r),this.bufferData=t,this.indexData=r,this.buffer.updateData(new Float32Array(t)),this.indexBuffer.updateData(new Uint32Array(r))}},{key:"createNormalBuffer",value:function(t,r,a){var n=this,s=parseInt(this.options.edgeCount,10)||4;t.forEach(function(o,u){var h=o.color||n.options.color,v=o.size||n.options.size,l=Array.isArray(o.value)?o.value:typeof o.value=="number"?[o.value]:[1],f=n.normizedPoint(o.geometry.coordinates),d=o.height||n.options.height,c=l.reduce(function(g,x){return Number(g)+Number(x)}),p=0,m="blue";for(l.forEach(function(g,x){m=n.normizedColor(typeof h=="function"?h(g,x,l):Array.isArray(h)?h[x]:h),g=typeof d=="function"?d(g,x,l):Array.isArray(d)?d[x]:d/c*g;var y=a[a.length-1],_=r.length/11;for(0<_&&(s%2===1&&x===0?a.push(y,y,_):a.push(y,_)),x=1;x<=2*s;x++)x%2===0?r.push.apply(r,[f[0],f[1],p,v,x/2,2,s].concat(Q(m))):r.push.apply(r,[f[0],f[1],p+g,v,(x+1)/2,1,s].concat(Q(m))),a.push(_+x-1),x===2*s&&(r.push.apply(r,[f[0],f[1],p+g,v,x/2+1,1,s].concat(Q(m))),r.push.apply(r,[f[0],f[1],p,v,x/2+1,2,s].concat(Q(m))),a.push(_+x,_+x+1));p+=g}),u=a[a.length-1],o=r.length/11,0<o&&a.push(u,o),u=1;u<=s;u++)r.push.apply(r,[f[0],f[1],p,v,-1,u,s].concat(Q(m))),a.push(o+u-1)})}},{key:"createLightBuffer",value:function(t,r,a){var n=this,s=parseInt(this.options.edgeCount,10)||4;t.forEach(function(o,u){u=o.color||n.options.color,u=n.normizedColor(typeof u=="function"?u(o.value):typeof u=="string"?u:"blue");var h=o.size||n.options.size,v=n.normizedPoint(o.geometry.coordinates),l=o.height||n.options.height;for(l=typeof l=="function"?l(o.value):l,o=1;o<=s;o++){var f=a[a.length-1],d=r.length/11;for(0<d&&a.push(f,d),f=1;f<=2*s;f++)f%2===0?r.push.apply(r,[v[0],v[1],l,h,f/2,1,s].concat(Q(u))):r.push.apply(r,[v[0],v[1],l,h,(f+1)/2,2,s].concat(Q(u))),a.push(d+f-1),f===2*s&&a.push(d,d+1)}})}},{key:"render",value:function(t){var r=this.program,a=t.gl,n=t.matrix;this.setGLState({cullFace:this.options.type==="normal"}),r.use(a),this.vertexArray.bind(),this.indexBuffer.bind();var s=this.map.getZoomUnits();K(this.uniforms,this.getCommonUniforms(t),{uZoomUnits:this.options.unit==="px"?s:1,uMatrix:n}),r.setUniforms(this.uniforms),a.drawElements(a.TRIANGLE_STRIP,this.indexData.length,a.UNSIGNED_INT,0)}}]),i}(rt),Hh=function(e){function i(t){O(this,i);var r=W(this,(i.__proto__||U(i)).call(this,t));return t=r.getOptions(),r.fillPoint=new ti({enablePicked:t.enablePicked,autoSelect:t.autoSelect}),r.shadowPoint=new ti,r.textPoint=new Yr,r.children=[r.shadowPoint,r.fillPoint,r.textPoint],r}return Y(i,e),I(i,[{key:"pick",value:function(t,r){return this.fillPoint.pick(t,r)}},{key:"onOptionsChanged",value:function(t){this.shadowPoint.setOptions({depthTest:!1,polygonOffset:[1,1],color:t.shadowColor,size:t.shadowSize,borderWidth:t.shadowBorderWidth,borderColor:t.shadowBorderColor}),this.fillPoint.setOptions({onClick:function(r){t.onClick&&t.onClick(r)},selectedIndex:t.selectedIndex,selectedColor:t.selectedColor,depthTest:!1,color:t.fillColor,size:t.fillSize,borderWidth:t.fillBorderWidth,borderColor:t.fillBorderColor}),this.textPoint.setOptions({collides:!1,polygonOffset:[-1,-1],color:t.fontColor,fontFamily:t.fontFamily,fontSize:t.fontSize})}},{key:"onDataChanged",value:function(t){var r=this,a=this.getOptions(),n=JSON.parse(Er(t)).map(function(o){return o.properties.size=r.getProperty("shadowSize",a.shadowSize,o),o.properties.color=r.getProperty("shadowColor",a.shadowColor,o),o.properties.borderColor=r.getProperty("shadowBorderColor",a.shadowBorderColor,o),o.properties.borderWidth=r.getProperty("shadowBorderWidth",a.shadowBorderWidth,o),o}),s=JSON.parse(Er(t)).map(function(o){return o.properties.size=r.getProperty("fillSize",a.fillSize,o),o.properties.color=r.getProperty("fillColor",a.fillColor,o),o.properties.borderColor=r.getProperty("fillBorderColor",a.fillBorderColor,o),o.properties.borderWidth=r.getProperty("fillBorderWidth",a.fillBorderWidth,o),o});this.shadowPoint.setData(n),this.fillPoint.setData(s),this.textPoint.setData(t)}},{key:"getProperty",value:function(t,r,a){return Object.prototype.toString.call(r)==="[object Function]"?r(a):(r=a[t]||r,"properties"in a&&t in a.properties&&(r=a.properties[t]),r)}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ffff00",autoSelect:!0,fillColor:"rgba(255, 50, 10, 1)",fillSize:20,fillBorderColor:"#ffffff",fillBorderWidth:1.2,shadowColor:"rgba(255, 80, 110, 0.7)",shadowSize:40,shadowBorderColor:"rgba(255, 80, 110, 1)",shadowBorderWidth:1.2,fontSize:12,fontFamily:"Microsoft Yahei",fontColor:"#ffffff"}}}]),i}(pe),Xh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="MaskLayer",t.bufferData=[],t.indices=[],t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{blend:"deeper",color:"rgba(100, 100, 100, 0.6)",height:0,polygonOffset:[0,0],depthTest:!1,depthWrite:!1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new q(this.gl,{vertexShader:"precision highp float;attribute vec2 a_position;uniform mat4 u_matrix;uniform float u_height;void main(){vec4 position=u_matrix*vec4(a_position.xy,u_height,1.0);gl_Position=position;}",fragmentShader:"precision highp float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}",defines:[]},this),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var r=[{stride:8,name:"a_position",buffer:this.vertexBuffer,size:2,type:"FLOAT",offset:0}];r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){this.bufferData=[],this.index=[]}},{key:"onChanged",value:function(t,r){var a=this;if(this.gl){t=[];for(var n=[],s=0;s<r.length;s++)if(r[s].geometry.coordinates){var o=[[this.normizedPoint([-180,-90]),this.normizedPoint([180,-90]),this.normizedPoint([180,90]),this.normizedPoint([-180,90])]],u=[];if(r[s].geometry.type==="LineString"&&(u=[r[s].geometry.coordinates.map(function(l){return a.normizedPoint(l)})]),r[s].geometry.type==="MultiPolygon")for(var h=r[s].geometry.coordinates,v=0;v<h.length;v++)u=u.concat(h[v].map(function(l){return l.map(function(f){return a.normizedPoint(f)})}));else for(h=0;h<r[s].geometry.coordinates.length;h++)u.push(r[s].geometry.coordinates[h].map(function(l){return a.normizedPoint(l)}));for(u=jt.flatten(o.concat(u)),o=u.vertices,u=u.holes,h=[],v=0;v<o.length;v+=3)h.push(o[v+0],o[v+1]);this.parseBufferData(t,n,h,u)}this.bufferData=t,this.index=n,this.vertexBuffer.updateData(new Float32Array(t)),this.indexBuffer.updateData(new Uint32Array(n))}}},{key:"parseBufferData",value:function(t,r,a,n){var s=t.length/2;for(n=n&&n.length?jt(a,n,2):jt(a),t.push.apply(t,Q(a)),t=0;t<n.length;t++)r.push(n[t]+s)}},{key:"render",value:function(t){if(this.index&&this.index.length){var r=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(r),t=K(this.getCommonUniforms(t),{u_matrix:a,u_height:n.height,u_color:this.normizedColor(n.color)}),s.setUniforms(t),this.setGLState({blend:!0,blendFunc:se(r,n.blend),polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite}),this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,this.index.length,r.UNSIGNED_INT,0)}}}]),i}(rt),Wh=function(e){function i(){return O(this,i),W(this,(i.__proto__||U(i)).apply(this,arguments))}return Y(i,e),I(i,[{key:"toBBox",value:function(t){var r=nt(t.item.geometry.coordinates,2);return t=r[0],r=r[1],{minX:t,minY:r,maxX:t,maxY:r}}},{key:"compareMinX",value:function(t,r){return t.item.geometry.coordinates[0]-r.item.geometry.coordinates[0]}},{key:"compareMinY",value:function(t,r){return t.item.geometry.coordinates[1]-r.item.geometry.coordinates[1]}}]),i}(sr),Yh=function(e){function i(t,r){return O(this,i),t=W(this,(i.__proto__||U(i)).call(this,t,r)),t.name="PointCanvasCustomLayer",r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.geoRBush=new Wh,t}return Y(i,e),I(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,flat:!1,collides:!0,unit:"px",angle:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],itemDimension:[20,20],renderItem:this.defaultOptionRenderItem}}},{key:"defaultOptionRenderItem",value:function(t,r,a){a.fillStyle="red",a.fillRect(r.x,r.y,r.w,r.h)}},{key:"initialize",value:function(t){this.gl=t;var r=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new q(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)+size.x*sin(rotation);}else if(corner==2.0){x+=size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)-size.x*sin(rotation);}else if(corner==3.0){x+=size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)-size.x*sin(rotation);}else{x+=-size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)+size.x*sin(rotation);}return vec3(x,y,coord.z);}void main(){vTextCoord=aTextCoord;if(uFlat){vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}else{vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio*scale;vec3 current=transformCoord(screen,halfSize,corner);current.z+=zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:`precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:r.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new k({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new k({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],r=r.concat(this.getCommonAttributes()),this.vertexArray=new at({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,r){this.gl&&this.processCache(t,r)}},{key:"processCache",value:function(t,r){for(this.cachedData=[],this.geoRBush.clear(),t=0;t<r.length;t++){var a=r[t],n=this.normizedPoint(a.geometry.coordinates);n&&this.cachedData.push({point:n,item:a,extra:{},index:t})}this.geoRBush.load(this.cachedData)}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var r=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(r),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:r.FUNC_ADD,blendFunc:[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();s.setUniforms(K(this.getCommonUniforms(t),{matrix:a,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,uFlat:n.flat,offset:n.offset,zoomUnits:o,zIndex:n.zIndex,uUnitPx:n.unit==="px"})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),r.drawElements(r.TRIANGLES,this.index.length,r.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var r=t.gl,a=t.matrix,n=this.getOptions(),s=n.padding,o=n.margin,u=n.collides;t=n.enablePicked;var h=n.itemDimension,v=n.beforeRenderAll,l=n.beforeComputeDimension;n=n.renderItem;var f=this.map.getBounds(),d=r.canvas.width/window.devicePixelRatio,c=r.canvas.height/window.devicePixelRatio,p=this.canvas;r=this.ctx,r.save(),r.scale(window.devicePixelRatio,window.devicePixelRatio),l&&l(r),f=this.geoRBush.search({minX:f.sw.lng,minY:f.sw.lat,maxX:f.ne.lng,maxY:f.ne.lat});var m=new sr;l=[];for(var g=0;g<f.length;g++){var x=f[g],y=x.point,_=x.item,A=x.extra;x=x.index;var T=nt(y,3);T=ht.clone([T[0],T[1],T[2],1]),ht.transformMat4(T,T,a),ht.scale(T,T,1/T[3]);var w=(T[0]+1)/2*d,C=(-T[1]+1)/2*c,M=Array.isArray(h)?h:h(_,r,A);T=M[0]+2*s[0],M=M[1]+2*s[1];var E=T+o[0],P=M+o[1];if(w-=E/2,C-=P/2,E=w+E,P=C+P,!(0>E||0>P||w>d||C>c)){if(u){if(P={minX:w,maxX:E,minY:C,maxY:P},m.collides(P))continue;m.insert(P)}l.push({w:T,h:M,point:y,item:_,extra:A,dataIndex:x})}}for(r.restore(),s=ye(l),a=s.w,s=s.h,0>=a&&(a=1),0>=s&&(s=1),p.width=a*window.devicePixelRatio,p.height=s*window.devicePixelRatio,r.save(),r.scale(window.devicePixelRatio,window.devicePixelRatio),v&&v(r),v=[],p=[],o=[],u=[],h=0,d=l.length;h<d;++h){for(c=l[h],n(c.item,c,r,c.extra),g=nt(c.point,3),f=g[0],m=g[1],g=g[2],y=0;4>y;y++)v.push(f,m,g),v.push(y),v.push(c.w,c.h),v.push(1,0);f=c.x/a,m=(c.x+c.w)/a,g=(c.y+c.h)/s,y=c.y/s,p.push(f,g,f,y,m,y,m,g),f=4*h,o.push(f,f+2,f+1,f,f+3,f+2),t&&(c=this.indexToRgb(c.dataIndex),u.push(c[0]/255,c[1]/255,c[2]/255),u.push(c[0]/255,c[1]/255,c[2]/255),u.push(c[0]/255,c[1]/255,c[2]/255),u.push(c[0]/255,c[1]/255,c[2]/255))}r.restore(),this.loadTexture(),this.index=o,this.vertexBuffer.updateData(new Float32Array(v)),this.uvBuffer.updateData(new Float32Array(p)),this.indexBuffer.updateData(new Uint32Array(o)),t&&this.pickBuffer.updateData(new Float32Array(u))}},{key:"loadTexture",value:function(){var t=this;this.canvas?Pt(this.gl,this.canvas,function(r){t.texture=r},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),i}(rt);window._hmt=window._hmt||[],function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e8002ef3d9e0d8274b5b74cc4a027d08";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}(),F.View=Yn,F.CanvasLayer=Dt,F.CircleLayer=function e(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return O(this,e),Ef.includes(i.type)?new Pf(i):new Sf(i)},F.GridLayer=fs,F.HeatGridLayer=Bf,F.ShapeLayer=Ii,F.SimpleLineLayer=hs,F.LineLayer3D=If,F.LineLayer=Qn,F.LineRainbowLayer=kf,F.WallSpriteLayer=Nf,F.LinePointLayer=Ge,F.WallLayer=ah,F.WallTripLayer=uh,F.HeatLineLayer=lh,F.HoneycombLayer=fh,F.WebglLayer=ns,F.PointLayer=ti,F.GroundRippleLayer=hh,F.RippleLayer=ch,F.SparkLayer=dh,F.ClusterLayer=vh,F.HeatPointLayer=ph,F.ShapeLineLayer=gh,F.PointTripLayer=mh,F.LineTripLayer=xh,F.IconCollidesLayer=yh,F.LineFlowLayer=zs,F.TileLayer=_h,F.IconLayer=Bs,F.BoardLayer=Ah,F.PolygonLayer=Th,F.CarLineLayer=Ih,F.Layer=rt,F.TextLayer=Yr,F.BoardTextLayer=bh,F.LabelLayer=kh,F.TrafficLayer=Uh,F.GltfLayer=Ys,F.HeatmapLayer=Nh,F.BarLayer=jh,F.MarkerListLayer=Hh,F.MaskLayer=Xh,F.PointCanvasCustomLayer=Yh,F.FXAA=vf,F.SMAA=pf,F.BlurEffect=gf,F.BloomEffect=mf,F.BrightEffect=xf,F.DepthEffect=yf,F.EffectManager=is,F.getContext=mo,F.createTexture=Qe,F.loadTextureImage=Pt,F.getBlend=se,F.FrameBufferObject=wt,F.Program=q,F.StateManager=rs,F.Buffer=k,F.VertexArray=at,F.CommonLayer=Zn,F.MercatorProjection=Lt,F.Canvas=Ki,F.Intensity=St,F.BezierCurve=ae,F.GeodesicCurve=me,F.OdCurve=wl,F.utilCity={getProvinceNameByCityName:function(e){for(var i=0;i<je.length;i++)for(var t=je[i].n,r=je[i].cities,a=0;a<r.length;a++)if(r[a].n==e)return t;return null},getCenterByCityName:function(e){e=e.replace("\u5E02","");for(var i=0;i<En.length;i++)if(En[i].n==e)return ii(En[i].g);for(i=0;i<Rn.length;i++)if(Rn[i].n==e)return ii(Rn[i].g);for(i=0;i<je.length;i++){if(je[i].n==e)return ii(je[i].g);for(var t=je[i].cities,r=0;r<t.length;r++)if(t[r].n==e)return ii(t[r].g)}return null}},F.isMobile=pa,F.Encryptor={encode:function(e){e=Ja.deflateRaw(e);for(var i=[],t=0;t<e.length;t++)i.push(e[t]^23);return new Uint8Array(i)},decode:function(e){e=new Uint8Array(e);for(var i=[],t=0;t<e.length;t++)i.push(e[t]^23);e=new Uint8Array(i);try{var r=window.flate.deflate_decode_raw(e);return new TextDecoder("utf-8").decode(r)}catch(a){return console.warn("inflate by pako!"),Ja.inflateRaw(e,{to:"string"})}},download:function(e,i){var t=new Blob([e],{type:"application/octet-binary"});e=document.createElement("a"),t=window.URL.createObjectURL(t),e.href=t,e.download=i||"mapvgl_download",e.click()}},F.createFusionView=function(e,i){var t=void 0,r=!1;e.addEventListener("glmoduleloaded",function(a){r||(r=!0,setTimeout(function(){t=new Yn({cameraNear:10,cameraFar:4e3,gl:e._webglPainter.gl,canvas:e._webglPainter.gl.canvas,autoUpdate:!1,map:e}),t.webglLayer.canvas.style.zIndex=1;var n=t.webglLayer.stateManager;e.insertRender=function(){n.setState({blend:!0,depthTest:!1}),t.render()},i&&i(t)},3e3))}),setTimeout(function(){if(!r&&e._webglMapScene&&e._webglPainter&&e._webglPainter.gl&&e._webglPainter.gl.canvas){r=!0,t=new Yn({cameraNear:10,cameraFar:4e3,gl:e._webglPainter.gl,canvas:e._webglPainter.gl.canvas,autoUpdate:!1,map:e}),t.webglLayer.canvas.style.zIndex=1;var a=t.webglLayer.stateManager;e.insertRender=function(){a.setState({blend:!0,depthTest:!1}),t.render()},i&&i(t)}},4e3)},F.toRadian=Mt,F.toAngle=Wi,F.ceilPowerOfTwo=oe,F.floorPowerOfTwo=Yi,F.approximatelyEqual=Zi,F.isClosed=Vi,F.__moduleExports=Yt,F.vec4=ht,F.vec3=j,F.vec2=J,F.quat2=sf,F.quat=Oi,F.mat4=z,F.mat3=uf,F.mat2d=lf,F.mat2=ff,F.glMatrix=hf,Object.defineProperty(F,"__esModule",{value:!0})})})(Zs,Zs.exports);export{Zs as m};
