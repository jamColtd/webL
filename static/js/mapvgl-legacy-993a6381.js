System.register(["./@babel-legacy-55346a6e.js"],(function(t){"use strict";var e;return{setters:[function(t){e=t.o}],execute:function(){var r=t("m",{exports:{}});!function(t,r){!function(t){function r(t){this.options=t||{},this.paneName=this.options.paneName||"labelPane",this.zIndex=this.options.zIndex||1,this._map=t.map,this._lastDrawTime=null,this.show()}function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}function a(t,e){return function(r){return e(t(r))}}function o(t){var e=function(e){return null==e?e:(1<arguments.length&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function s(t){var e=function(e){if(null==e)return e;1<arguments.length&&(e=Array.prototype.slice.call(arguments));var r=t(e);if("object"===(void 0===r?"undefined":gi(r)))for(var i=r.length,n=0;n<i;n++)r[n]=Math.round(r[n]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}function u(t,e){if(!(this instanceof u))return new u(t,e);if(e&&e in vn&&(e=null),e&&!(e in cn))throw Error("Unknown model: "+e);if(void 0===t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof u)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){if(null===(e=un.get(t)))throw Error("Unable to parse color from string: "+t);this.model=e.model;var r=cn[this.model].channels;this.color=e.value.slice(0,r),this.valpha="number"==typeof e.value[r]?e.value[r]:1}else if(t.length)this.model=e||"rgb",r=cn[this.model].channels,e=dn.call(t,0,r),this.color=c(e,r),this.valpha="number"==typeof t[r]?t[r]:1;else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{if(this.valpha=1,e=Le(t),"alpha"in t&&(e.splice(e.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0),!((e=e.sort().join(""))in pn))throw Error("Unable to parse color from object: "+$i(t));this.model=pn[e],r=cn[this.model].labels;var i=[];for(e=0;e<r.length;e++)i.push(t[r[e]]);this.color=c(i)}if(gn[this.model])for(r=cn[this.model].channels,e=0;e<r;e++)(t=gn[this.model][e])&&(this.color[e]=t(this.color[e]));this.valpha=Math.max(0,Math.min(1,this.valpha)),Ki&&Ki(this)}function l(t){return function(e){return Number(e.toFixed(t))}}function h(t,e,r){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(gn[t]||(gn[t]=[]))[e]=r})),t=t[0],function(i){if(arguments.length){r&&(i=r(i));var n=this[t]();return n.color[e]=i,n}return n=this[t]().color[e],r&&(n=r(n)),n}}function f(t){return function(e){return Math.max(0,Math.min(t,e))}}function c(t,e){for(var r=0;r<e;r++)"number"!=typeof t[r]&&(t[r]=0);return t}function d(t){return t*Math.PI/180}function v(t){return t/Math.PI*180}function p(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function g(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function m(t,e){return 1e-8>Math.abs(t-e)}function x(t){var e=t[0],r=t[t.length-1];return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2)+Math.pow((e[2]||0)-(r[2]||0),2))<(1<arguments.length&&void 0!==arguments[1]?arguments[1]:2e-7)}function y(){}function b(t,e){for(var r in e)t[r]=e[r]}function _(t,e){this.lng=t,this.lat=e}function A(t,e){this.x=t,this.y=e}function T(t,e){var r=document.createElement("canvas");return t&&(r.width=t),e&&(r.height=e),r}function w(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=void 0===t.maxSize?35:t.maxSize,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}function M(t){this.options=t||{},this._initialize()}function C(t,e,r,i,n){var a=1-t,o=1-t;return a*a*a*e+3*o*o*t*r+3*(1-t)*t*t*i+t*t*t*n}function R(t){this.WORLD_SIZE_MC_HALF=20037726.372307256,this.WORLD_SIZE_MC=2*this.WORLD_SIZE_MC_HALF,this.options=t||{},this._initialize()}function S(t,e){return t&&e?Math.round(Math.sqrt(Math.pow(t.lng-e.lng,2)+Math.pow(t.lat-e.lat,2))):0}function P(t){return(t=t.split("|"))[0]=t[0].split(","),{lng:parseFloat(t[0][0]),lat:parseFloat(t[0][1])}}function E(t){for(var e=t.length;0<=--e;)t[e]=0}function L(t,e,r,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}function F(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function D(t,e,r,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=i,this.func=n}function B(){this.strm=null,this.status=0,this.pending_buf=null,this.wrap=this.pending=this.pending_out=this.pending_buf_size=0,this.gzhead=null,this.gzindex=0,this.method=_a,this.last_flush=-1,this.w_mask=this.w_bits=this.w_size=0,this.window=null,this.window_size=0,this.head=this.prev=null,this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ta(this.dyn_ltree),Ta(this.dyn_dtree),Ta(this.bl_tree),this.bl_desc=this.d_desc=this.l_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ta(this.heap),this.heap_max=this.heap_len=0,this.depth=new Uint16Array(573),Ta(this.depth),this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function O(t){(t=this.options=Na.assign({level:$a,method:eo,chunkSize:16384,windowBits:15,memLevel:8,strategy:to},t||{})).raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&16>t.windowBits&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ya,this.strm.avail_out=0;var e=Ua.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Qa)throw Error(ea[e]);if(t.header&&Ua.deflateSetHeader(this.strm,t.header),t.dictionary){if(t="string"==typeof t.dictionary?Wa.string2buf(t.dictionary):"[object ArrayBuffer]"===Za.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(e=Ua.deflateSetDictionary(this.strm,t))!==Qa)throw Error(ea[e]);this._dict_set=!0}}function k(t,e){if((e=new O(e)).push(t,!0),e.err)throw e.msg||ea[e.err];return e.result}function z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.total=this.check=this.dmax=this.flags=0,this.head=null,this.wnext=this.whave=this.wsize=this.wbits=0,this.window=null,this.extra=this.offset=this.length=this.bits=this.hold=0,this.distcode=this.lencode=null,this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.distdyn=this.lendyn=null,this.was=this.back=this.sane=0}function I(t){var e=this.options=Na.assign({chunkSize:65536,windowBits:15,to:""},t||{});if(e.raw&&0<=e.windowBits&&16>e.windowBits&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&16>e.windowBits)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&48>e.windowBits&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ya,this.strm.avail_out=0,(t=So.inflateInit2(this.strm,e.windowBits))!==Do)throw Error(ea[t]);if(this.header=new Po,So.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Wa.string2buf(e.dictionary):"[object ArrayBuffer]"===Eo.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=So.inflateSetDictionary(this.strm,e.dictionary))!==Do))throw Error(ea[t])}function U(t,e){if((e=new I(e)).push(t),e.err)throw e.msg||ea[e.err];return e.result}function N(t,e){for(var r=["webgl2","experimental-webgl2","webgl","experimental-webgl"],i=void 0,n=0;n<r.length;n++)try{if(i=t.getContext(r[n],{alpha:!0,premultipliedAlpha:!1,antialias:e.antialias||!0,preserveDrawingBuffer:e.preserveDrawingBuffer||!1}))break}catch(fl){}return i}function H(t,e,r){r=ze({TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"REPEAT",TEXTURE_WRAP_T:"REPEAT"},r);var i=t.createTexture();for(var n in t.bindTexture(t.TEXTURE_2D,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),r)t.texParameteri(t.TEXTURE_2D,t[n],t[r[n]]);return t.bindTexture(t.TEXTURE_2D,null),i}function j(t,e,r,i){if("object"===(void 0===e?"undefined":gi(e)))e=H(t,e,i),r(e,null);else{var n=new Image;n.crossOrigin="anonymous",n.onload=function(){var e=g(n.width),a=g(n.height),o=document.createElement("canvas");o.width=e,o.height=a,o.getContext("2d").drawImage(n,0,0,e,a),e=H(t,n=o,i),r(e,n)},n.src=e}}function X(t,e){if(e instanceof Array){var r,i=(r={zero:t.ZERO,one:t.ONE,src_color:t.SRC_COLOR,one_minus_src_color:t.ONE_MINUS_SRC_COLOR,dst_color:t.DST_COLOR,one_minus_dst_color:t.ONE_MINUS_DST_COLOR,src_alpha:t.SRC_ALPHA},ss(r,"one_minus_src_color",t.ONE_MINUS_SRC_ALPHA),ss(r,"dst_alpha",t.DST_ALPHA),ss(r,"one_minus_dst_alpha",t.ONE_MINUS_DST_ALPHA),ss(r,"constant_color",t.CONSTANT_COLOR),ss(r,"one_minus_constant_color",t.ONE_MINUS_CONSTANT_COLOR),ss(r,"constant_alpha",t.CONSTANT_ALPHA),ss(r,"one_minus_constant_color",t.ONE_MINUS_CONSTANT_ALPHA),ss(r,"src_alpha_saturate",t.SRC_ALPHA_SATURATE),r);return e.map((function(t){return i[t]}))}switch(e){case"default":default:return[t.ONE,t.ZERO];case"deeper":return[t.ONE,t.ONE_MINUS_SRC_ALPHA];case"normal":return[t.SRC_ALPHA,t.ONE];case"lighter":return[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA]}}function W(t,e,r){r=r||2;var i,n=e&&e.length,a=n?e[0]*r:t.length,o=Y(t,0,a,r,!0),s=[];if(!o||o.next===o.prev)return s;if(n){var u,l=r;n=[];var h=0;for(u=e.length;h<u;h++){var f=e[h]*l;(f=Y(t,f,h<u-1?e[h+1]*l:t.length,l,!1))===f.next&&(f.steiner=!0),n.push(J(f))}for(n.sort(q),h=0;h<n.length;h++)(e=K(l=n[h],e=o))&&(l=ot(e,l),Z(e,e.next),Z(l,l.next)),o=Z(o,o.next)}if(t.length>80*r){var c=i=t[0],d=n=t[1];for(l=r;l<a;l+=r)(h=t[l])<c&&(c=h),(e=t[l+1])<d&&(d=e),h>i&&(i=h),e>n&&(n=e);i=0!==(i=Math.max(i-c,n-d))?1/i:0}return V(o,s,r,c,d,i),s}function Y(t,e,r,i,n){if(n===0<ht(t,e,r,i))for(n=e;n<r;n+=i)var a=st(n,t[n],t[n+1],a);else for(n=r-i;n>=e;n-=i)a=st(n,t[n],t[n+1],a);return a&&et(a,a.next)&&(ut(a),a=a.next),a}function Z(t,e){if(!t)return t;e||(e=t);do{var r=!1;if(t.steiner||!et(t,t.next)&&0!==tt(t.prev,t,t.next))t=t.next;else{if(ut(t),(t=e=t.prev)===t.next)break;r=!0}}while(r||t!==e);return e}function V(t,e,r,i,n,a,o){if(t){if(!o&&a){var s=t,u=s;do{null===u.z&&(u.z=Q(u.x,u.y,i,n,a)),u.prevZ=u.prev,u=u.nextZ=u.next}while(u!==s);u.prevZ.nextZ=null,u.prevZ=null,s=u;var l,h,f,c,d=1;do{u=s;var v=s=null;for(h=0;u;){h++;var p=u;for(l=f=0;l<d&&(f++,p=p.nextZ);l++);for(c=d;0<f||0<c&&p;)0!==f&&(0===c||!p||u.z<=p.z)?(l=u,u=u.nextZ,f--):(l=p,p=p.nextZ,c--),v?v.nextZ=l:s=l,l.prevZ=v,v=l;u=p}v.nextZ=null,d*=2}while(1<h)}for(s=t;t.prev!==t.next;){if(u=t.prev,p=t.next,a)v=G(t,i,n,a);else t:if(v=t,h=v.prev,f=v,d=v.next,0<=tt(h,f,d))v=!1;else{for(l=v.next.next;l!==v.prev;){if($(h.x,h.y,f.x,f.y,d.x,d.y,l.x,l.y)&&0<=tt(l.prev,l,l.next)){v=!1;break t}l=l.next}v=!0}if(v)e.push(u.i/r),e.push(t.i/r),e.push(p.i/r),ut(t),s=t=p.next;else if((t=p)===s){if(o){if(1===o){o=e,s=r,u=t=Z(t);do{!et(p=u.prev,v=u.next.next)&&rt(p,u,u.next,v)&&at(p,v)&&at(v,p)&&(o.push(p.i/s),o.push(u.i/s),o.push(v.i/s),ut(u),ut(u.next),u=t=v),u=u.next}while(u!==t);V(t=Z(u),e,r,i,n,a,2)}else if(2===o)t:{o=t;do{for(s=o.next.next;s!==o.prev;){if(u=o.i!==s.i){if(p=s,v=(u=o).next.i!==p.i&&u.prev.i!==p.i){e:{v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==p.i&&v.next.i!==p.i&&rt(v,v.next,u,p)){v=!0;break e}v=v.next}while(v!==u);v=!1}v=!v}if(v){if(v=at(u,p)&&at(p,u)){v=u,h=!1,f=(u.x+p.x)/2,d=(u.y+p.y)/2;do{v.y>d!=v.next.y>d&&v.next.y!==v.y&&f<(v.next.x-v.x)*(d-v.y)/(v.next.y-v.y)+v.x&&(h=!h),v=v.next}while(v!==u);v=h}v=v&&(tt(u.prev,u,p.prev)||tt(u,p.prev,p))||et(u,p)&&0<tt(u.prev,u,u.next)&&0<tt(p.prev,p,p.next)}u=v}if(u){t=ot(o,s),o=Z(o,o.next),t=Z(t,t.next),V(o,e,r,i,n,a),V(t,e,r,i,n,a);break t}s=s.next}o=o.next}while(o!==t)}}else V(Z(t),e,r,i,n,a,1);break}}}}function G(t,e,r,i){var n=t.prev,a=t.next;if(0<=tt(n,t,a))return!1;var o=n.x>t.x?n.x>a.x?n.x:a.x:t.x>a.x?t.x:a.x,s=n.y>t.y?n.y>a.y?n.y:a.y:t.y>a.y?t.y:a.y,u=Q(n.x<t.x?n.x<a.x?n.x:a.x:t.x<a.x?t.x:a.x,n.y<t.y?n.y<a.y?n.y:a.y:t.y<a.y?t.y:a.y,e,r,i);for(e=Q(o,s,e,r,i),r=t.prevZ,i=t.nextZ;r&&r.z>=u&&i&&i.z<=e;){if(r!==t.prev&&r!==t.next&&$(n.x,n.y,t.x,t.y,a.x,a.y,r.x,r.y)&&0<=tt(r.prev,r,r.next))return!1;if(r=r.prevZ,i!==t.prev&&i!==t.next&&$(n.x,n.y,t.x,t.y,a.x,a.y,i.x,i.y)&&0<=tt(i.prev,i,i.next))return!1;i=i.nextZ}for(;r&&r.z>=u;){if(r!==t.prev&&r!==t.next&&$(n.x,n.y,t.x,t.y,a.x,a.y,r.x,r.y)&&0<=tt(r.prev,r,r.next))return!1;r=r.prevZ}for(;i&&i.z<=e;){if(i!==t.prev&&i!==t.next&&$(n.x,n.y,t.x,t.y,a.x,a.y,i.x,i.y)&&0<=tt(i.prev,i,i.next))return!1;i=i.nextZ}return!0}function q(t,e){return t.x-e.x}function K(t,e){var r=e,i=t.x,n=t.y,a=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=i&&o>a){if(a=o,o===i){if(n===r.y)return r;if(n===r.next.y)return r.next}var s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!s)return null;if(i===a)return s;e=s,o=s.x;var u=s.y,l=1/0;r=s;do{if(i>=r.x&&r.x>=o&&i!==r.x&&$(n<u?i:a,n,o,u,n<u?a:i,n,r.x,r.y)){var h,f=Math.abs(n-r.y)/(i-r.x);if((h=at(r,t))&&!(h=f<l)&&(h=f===l)&&!(h=r.x>s.x)&&(h=r.x===s.x)){var c=r;h=0>tt((h=s).prev,h,c.prev)&&0>tt(c.next,h,h.next)}h&&(s=r,l=f)}r=r.next}while(r!==e);return s}function Q(t,e,r,i,n){return 1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1)|(1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function J(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function $(t,e,r,i,n,a,o,s){return 0<=(n-o)*(e-s)-(t-o)*(a-s)&&0<=(t-o)*(i-s)-(r-o)*(e-s)&&0<=(r-o)*(a-s)-(n-o)*(i-s)}function tt(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function et(t,e){return t.x===e.x&&t.y===e.y}function rt(t,e,r,i){var n=nt(tt(t,e,r)),a=nt(tt(t,e,i)),o=nt(tt(r,i,t)),s=nt(tt(r,i,e));return!!(n!==a&&o!==s||0===n&&it(t,r,e)||0===a&&it(t,i,e)||0===o&&it(r,t,i)||0===s&&it(r,e,i))}function it(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function nt(t){return 0<t?1:0>t?-1:0}function at(t,e){return 0>tt(t.prev,t,t.next)?0<=tt(t,e,t.next)&&0<=tt(t,t.prev,e):0>tt(t,e,t.prev)||0>tt(t,t.next,e)}function ot(t,e){var r=new lt(t.i,t.x,t.y),i=new lt(e.i,e.x,e.y),n=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function st(t,e,r,i){return t=new lt(t,e,r),i?(t.next=i.next,t.prev=i,i.next.prev=t,i.next=t):(t.prev=t,t.next=t),t}function ut(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function lt(t,e,r){this.i=t,this.x=e,this.y=r,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function ht(t,e,r,i){for(var n=0,a=r-i;e<r;e+=i)n+=(t[a]-t[e])*(t[e+1]+t[a+1]),a=e;return n}function ft(t){try{return Hs.createObjectURL(new Blob([t],{type:"application/javascript"}))}catch(r){var e=new Ns;return e.append(t),Hs.createObjectURL(e.getBlob(type))}}function ct(t,e){this.shapeLayer=t,this.gl=e,this.initData()}function dt(t,e,r,i){var n=[];return i=i*Math.PI/180,n[0]=(t-r[0])*Math.cos(i)-(e-r[1])*Math.sin(i)+r[0],n[1]=(t-r[0])*Math.sin(i)+(e-r[1])*Math.cos(i)+r[1],n}function vt(t){var e=0,r=0,i=!0,n=!1,a=void 0;try{for(var o,s=ki(t);!(i=(o=s.next()).done);i=!0){var u=o.value;e+=u.w*u.h,r=Math.max(r,u.w)}}catch(p){n=!0,a=p}finally{try{!i&&s.return&&s.return()}finally{if(n)throw a}}t.sort((function(t,e){return e.h-t.h})),r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],n=i=0,a=!0,s=!1,o=void 0;try{for(var l,h=ki(t);!(a=(l=h.next()).done);a=!0)for(var f=l.value,c=r.length-1;0<=c;c--){var d=r[c];if(!(f.w>d.w||f.h>d.h)){if(f.x=d.x,f.y=d.y,n=Math.max(n,f.y+f.h),i=Math.max(i,f.x+f.w),f.w===d.w&&f.h===d.h){var v=r.pop();c<r.length&&(r[c]=v)}else f.h===d.h?(d.x+=f.w,d.w-=f.w):(f.w!==d.w&&r.push({x:d.x+f.w,y:d.y,w:d.w-f.w,h:f.h}),d.y+=f.h,d.h-=f.h);break}}}catch(p){s=!0,o=p}finally{try{!a&&h.return&&h.return()}finally{if(s)throw o}}return{w:i,h:n,fill:e/(i*n)||0}}function pt(t,e){var r=[];return t.forEach((function(t){r.push(e?-t:t,t)})),r}function gt(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=[],i=0;i<t-1;i++){var n=2*(i+e);r.push(n,n+1,n+2),r.push(n+2,n+1,n+3)}return r}function mt(t){return function(e,r,i){return e=r+t,i[0<(r=i.length-1)?0>e?0:e>r?r:e:e<r?r:0<e?0:e]}}function xt(t){if(!t[0]||!t[0].length)return t;for(var e=t[0].length,r=[],i=0,n=0;n<t.length;n++)for(var a=0;a<e;a++)r[i++]=t[n][a];return r}function yt(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=[],r=0,i=0;i<t.length;i++){var n=t[i];if(0<i){var a=t[i-1];r+=Math.sqrt(Math.pow(n[0]-a[0],2)+Math.pow(n[1]-a[1],2))}e.push(r)}return{arr:e,total:r}}function bt(){var t=document.createElement("canvas");t.width=t.height=32;var e=t.getContext("2d");return{canvas:t,ctx:e}}function _t(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).color,e=bt(),r=e.canvas;return(e=e.ctx).save(),e.moveTo(0,0),e.lineTo(20,0),e.lineTo(32,16),e.lineTo(20,32),e.lineTo(0,32),e.lineTo(10,16),e.fillStyle=t||"#fff",e.fill(),e.restore(),r}function At(t,e){return $o.set(t,-e[1],e[0])}function Tt(t,e,r){return $o.sub(t,e,r),$o.normalize(t,t),t}function wt(t){var e,r;this.promise=new t((function(t,i){if(void 0!==e||void 0!==r)throw TypeError("Bad Promise constructor");e=t,r=i})),this.resolve=de(e),this.reject=de(r)}function Mt(t,e,r){return r=Math.PI/180*(60*r+30),[t.x+e*Math.cos(r),t.y+e*Math.sin(r)]}function Ct(t,e,r){for(var i={},n=[],a=t.length,o=e/2/Math.sin(Math.PI/3),s=1.5*o,u=1,l=0;l<a;++l){var h=t[l].geometry.coordinates;r&&(h=r(h));var f=+h[0],c=+h[1];if(!isNaN(f)&&!isNaN(c)){h=Math.round(c/=s);var d=Math.round(f=f/e-(1&h)/2),v=c-h;if(1<3*Math.abs(v)){var p=f-d,g=d+(f<d?-1:1)/2,m=h+(c<h?-1:1);p*p+v*v>(f-=g)*f+(c-=m)*c&&(d=g+(1&h?1:-1)/2,h=m)}(p=i[v=d+"-"+h])?(p.count+=t[l].count||1,u=Math.max(u,p.count)):(i[v]={center:{x:(d+(1&h)/2)*e,y:h*s},count:t[l].count||1},n.push(i[v]))}}return n.max=u,n.r=o,n}function Rt(t,e,r,i){switch(i){case 5122:return new Int16Array(t,e,r);case 5123:return new Uint16Array(t,e,r);case 5124:return new Int32Array(t,e,r);case 5125:return new Uint32Array(t,e,r);case 5126:return new Float32Array(t,e,r);default:return null}}function St(t){return Rt(t.bufferView.data,t.byteOffset,t.count*Dh[t.type],t.componentType)}function Pt(t){var e="",r=t.lastIndexOf("/");return-1!==r&&(e=t.substring(0,r+1)),e}function Et(t,e){var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",t,!0),r.onreadystatechange=function(){4==r.readyState&&"200"==r.status&&e(r.responseText,this)},r.send(null)}function Lt(t,e){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.open("GET",t,!0),r.onreadystatechange=function(){if(4==r.readyState&&"200"==r.status){var t=r.response;t&&e&&e(t)}},r.send(null)}function Ft(t,e,r){var i=new Image;i.crossOrigin="Anonymous",i.src=t,i.onload=function(){r(i,e)}}function Dt(t){function e(t,e){r.uniform1i(t,e.index),r.activeTexture(r.TEXTURE0+e.index),t=A.glTF.textures[e.index],r.bindTexture(r.TEXTURE_2D,t.texture),r.bindSampler(e.index,t.sampler?t.sampler.sampler:o)}var r=t.gl,i=0,n=[];t=r.canvas;var a=function(t,e,r){for(this.glTFScene=t,this.glTF=e,this.id=r,this.rootTransform=rs.create(),this.nodeMatrix=Array(e.nodes.length),t=0,e=this.nodeMatrix.length;t<e;t++)this.nodeMatrix[t]=rs.create()},o=r.createSampler();r.samplerParameteri(o,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),r.samplerParameteri(o,r.TEXTURE_MAG_FILTER,r.LINEAR),r.samplerParameteri(o,r.TEXTURE_WRAP_S,r.REPEAT),r.samplerParameteri(o,r.TEXTURE_WRAP_T,r.REPEAT),r.bindVertexArray(null),r.bindVertexArray(null);var s={HAS_SKIN:1,SKIN_VEC8:2,HAS_BASECOLORMAP:4,HAS_NORMALMAP:8,HAS_METALROUGHNESSMAP:16,HAS_OCCLUSIONMAP:32,HAS_EMISSIVEMAP:64},u={},l=function(){this.flags=0,this.programObject=null};l.prototype.hasSkin=function(){return this.flags&s.HAS_SKIN},l.prototype.hasBaseColorMap=function(){return this.flags&s.HAS_BASECOLORMAP},l.prototype.hasNormalMap=function(){return this.flags&s.HAS_NORMALMAP},l.prototype.hasMetalRoughnessMap=function(){return this.flags&s.HAS_METALROUGHNESSMAP},l.prototype.hasOcclusionMap=function(){return this.flags&s.HAS_OCCLUSIONMAP},l.prototype.hasEmissiveMap=function(){return this.flags&s.HAS_EMISSIVEMAP},l.prototype.defineMacro=function(t){void 0!==s[t]&&(this.flags|=s[t])},l.prototype.compile=function(){var t=u[this.flags];if(t)this.programObject=t;else{var e=t="";this.flags&s.HAS_SKIN&&(t+="#define HAS_SKIN\n"),this.flags&s.SKIN_VEC8&&(t+="#define SKIN_VEC8\n"),this.flags&s.HAS_BASECOLORMAP&&(e+="#define HAS_BASECOLORMAP\n"),this.flags&s.HAS_NORMALMAP&&(e+="#define HAS_NORMALMAP\n"),this.flags&s.HAS_METALROUGHNESSMAP&&(e+="#define HAS_METALROUGHNESSMAP\n"),this.flags&s.HAS_OCCLUSIONMAP&&(e+="#define HAS_OCCLUSIONMAP\n"),this.flags&s.HAS_EMISSIVEMAP&&(e+="#define HAS_EMISSIVEMAP\n"),t=Oh.createProgram(r,"#version 300 es\n"+t+"#define POSITION_LOCATION 0\n#define NORMAL_LOCATION 1\n#define TEXCOORD_0_LOCATION 2\n#define JOINTS_0_LOCATION 3\n#define JOINTS_1_LOCATION 5\n#define WEIGHTS_0_LOCATION 4\n#define WEIGHTS_1_LOCATION 6\n#define TANGENT_LOCATION 7\nprecision highp float;precision highp int;uniform mat4 u_MVP;uniform mat4 u_MV;uniform mat4 u_MVNormal;\n#ifdef HAS_SKIN\nuniform JointMatrix{mat4 matrix[65];}u_jointMatrix;\n#endif\nlayout(location=POSITION_LOCATION)in vec3 position;layout(location=NORMAL_LOCATION)in vec3 normal;layout(location=TEXCOORD_0_LOCATION)in vec2 uv;\n#ifdef HAS_SKIN\nlayout(location=JOINTS_0_LOCATION)in vec4 joint0;layout(location=WEIGHTS_0_LOCATION)in vec4 weight0;\n#ifdef SKIN_VEC8\nlayout(location=JOINTS_1_LOCATION)in vec4 joint1;layout(location=WEIGHTS_1_LOCATION)in vec4 weight1;\n#endif\n#endif\nout vec3 v_position;out vec3 v_normal;out vec2 v_uv;void main(){\n#ifdef HAS_SKIN\nmat4 skinMatrix=weight0.x*u_jointMatrix.matrix[int(joint0.x)]+weight0.y*u_jointMatrix.matrix[int(joint0.y)]+weight0.z*u_jointMatrix.matrix[int(joint0.z)]+weight0.w*u_jointMatrix.matrix[int(joint0.w)];\n#ifdef SKIN_VEC8\nskinMatrix+=weight1.x*u_jointMatrix.matrix[int(joint1.x)]+weight1.y*u_jointMatrix.matrix[int(joint1.y)]+weight1.z*u_jointMatrix.matrix[int(joint1.z)]+weight1.w*u_jointMatrix.matrix[int(joint1.w)];\n#endif\n#endif\nv_uv=uv;\n#ifdef HAS_SKIN\nv_normal=normalize((u_MVNormal*transpose(inverse(skinMatrix))*vec4(normal,0)).xyz);vec4 pos=u_MV*skinMatrix*vec4(position,1.0);gl_Position=u_MVP*skinMatrix*vec4(position,1.0);\n#else\nv_normal=normalize((u_MVNormal*vec4(normal,0)).xyz);vec4 pos=u_MV*vec4(position,1.0);gl_Position=u_MVP*vec4(position,1.0);\n#endif\nv_position=vec3(pos.xyz)/pos.w;}","#version 300 es\n"+e+"#define FRAG_COLOR_LOCATION 0\nprecision highp float;precision highp int;uniform sampler2D u_brdfLUT;uniform vec4 u_baseColorFactor;\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_baseColorTexture;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_normalTexture;uniform float u_normalTextureScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_emissiveTexture;uniform vec3 u_emissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\nuniform float u_metallicFactor;uniform float u_roughnessFactor;\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_occlusionTexture;uniform float u_occlusionStrength;\n#endif\nin vec3 v_position;in vec3 v_normal;in vec2 v_uv;layout(location=FRAG_COLOR_LOCATION)out vec4 frag_color;struct PBRInfo{float NdotL;float NdotV;float NdotH;float LdotH;float VdotH;float perceptualRoughness;float metalness;vec3 reflectance0;vec3 reflectance90;float alphaRoughness;vec3 diffuseColor;vec3 specularColor;};const float M_PI=3.141592653589793;const float c_MinRoughness=0.04;vec3 getNormal(){vec3 pos_dx=dFdx(v_position);vec3 pos_dy=dFdy(v_position);vec3 tex_dx=dFdx(vec3(v_uv,0.0));vec3 tex_dy=dFdy(vec3(v_uv,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=v_normal;t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));mat3 tbn=mat3(t,b,ng);\n#ifdef HAS_NORMALMAP\nvec3 n=texture(u_normalTexture,v_uv).rgb;n=normalize(tbn*((2.0*n-1.0)*vec3(u_normalTextureScale,u_normalTextureScale,1.0)));\n#else\nvec3 n=tbn[2].xyz;\n#endif\nreturn n;}vec3 getIBLContribution(PBRInfo pbrInputs,vec3 n,vec3 reflection){float mipCount=10.0;float lod=(pbrInputs.perceptualRoughness*mipCount);vec3 brdf=texture(u_brdfLUT,vec2(pbrInputs.NdotV,1.0-pbrInputs.perceptualRoughness)).rgb;vec3 diffuseLight=vec3(0.6,0.6,0.6);vec3 specularLight=vec3(0.6,0.6,0.6);vec3 diffuse=diffuseLight*pbrInputs.diffuseColor;vec3 specular=specularLight*(pbrInputs.specularColor*brdf.x+brdf.y);return diffuse+specular;}vec3 diffuse(PBRInfo pbrInputs){return pbrInputs.diffuseColor/M_PI;}vec3 specularReflection(PBRInfo pbrInputs){return pbrInputs.reflectance0+(pbrInputs.reflectance90-pbrInputs.reflectance0)*pow(clamp(1.0-pbrInputs.VdotH,0.0,1.0),5.0);}float geometricOcclusion(PBRInfo pbrInputs){float NdotL=pbrInputs.NdotL;float NdotV=pbrInputs.NdotV;float r=pbrInputs.alphaRoughness;float attenuationL=2.0*NdotL/(NdotL+sqrt(r*r+(1.0-r*r)*(NdotL*NdotL)));float attenuationV=2.0*NdotV/(NdotV+sqrt(r*r+(1.0-r*r)*(NdotV*NdotV)));return attenuationL*attenuationV;}float microfacetDistribution(PBRInfo pbrInputs){float roughnessSq=pbrInputs.alphaRoughness*pbrInputs.alphaRoughness;float f=(pbrInputs.NdotH*roughnessSq-pbrInputs.NdotH)*pbrInputs.NdotH+1.0;return roughnessSq/(M_PI*f*f);}void main(){float perceptualRoughness=u_roughnessFactor;float metallic=u_metallicFactor;\n#ifdef HAS_METALROUGHNESSMAP\nvec4 mrSample=texture(u_metallicRoughnessTexture,v_uv);perceptualRoughness=mrSample.g*perceptualRoughness;metallic=mrSample.b*metallic;\n#endif\nperceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;\n#ifdef HAS_BASECOLORMAP\nvec4 baseColor=texture(u_baseColorTexture,v_uv)*u_baseColorFactor;\n#else\nvec4 baseColor=u_baseColorFactor;\n#endif\nvec3 f0=vec3(0.04);vec3 diffuseColor=baseColor.rgb*(vec3(1.0)-f0);diffuseColor*=1.0-metallic;vec3 specularColor=mix(f0,baseColor.rgb,metallic);float reflectance=max(max(specularColor.r,specularColor.g),specularColor.b);float reflectance90=clamp(reflectance*25.0,0.0,1.0);vec3 specularEnvironmentR0=specularColor.rgb;vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;vec3 n=getNormal();vec3 v=normalize(-v_position);vec3 l=normalize(vec3(1.0,1.0,1.0));vec3 h=normalize(l+v);vec3 reflection=-normalize(reflect(v,n));float NdotL=clamp(dot(n,l),0.001,1.0);float NdotV=abs(dot(n,v))+0.001;float NdotH=clamp(dot(n,h),0.0,1.0);float LdotH=clamp(dot(l,h),0.0,1.0);float VdotH=clamp(dot(v,h),0.0,1.0);PBRInfo pbrInputs=PBRInfo(NdotL,NdotV,NdotH,LdotH,VdotH,perceptualRoughness,metallic,specularEnvironmentR0,specularEnvironmentR90,alphaRoughness,diffuseColor,specularColor);vec3 F=specularReflection(pbrInputs);float G=geometricOcclusion(pbrInputs);float D=microfacetDistribution(pbrInputs);vec3 diffuseContrib=(1.0-F)*diffuse(pbrInputs);vec3 specContrib=max(vec3(0.0),F*G*D/(4.0*NdotL*NdotV));vec3 color=NdotL*(diffuseContrib+specContrib);color+=getIBLContribution(pbrInputs,n,reflection);\n#ifdef HAS_OCCLUSIONMAP\nfloat ao=texture(u_occlusionTexture,v_uv).r;color=mix(color,color*ao,u_occlusionStrength);\n#endif\n#ifdef HAS_EMISSIVEMAP\nvec3 emissive=texture(u_emissiveTexture,v_uv).rgb*u_emissiveFactor;color+=emissive;\n#endif\nfrag_color=vec4(color,baseColor.a);}"),this.programObject={program:t,uniformLocations:{},uniformBlockIndices:{}},this.flags&s.HAS_SKIN&&(this.programObject.uniformBlockIndices.JointMatrix=r.getUniformBlockIndex(t,"JointMatrix")),(e=this.programObject.uniformLocations).MVP=r.getUniformLocation(t,"u_MVP"),e.MVNormal=r.getUniformLocation(t,"u_MVNormal"),e.MV=r.getUniformLocation(t,"u_MV"),e.baseColorFactor=r.getUniformLocation(t,"u_baseColorFactor"),e.metallicFactor=r.getUniformLocation(t,"u_metallicFactor"),e.roughnessFactor=r.getUniformLocation(t,"u_roughnessFactor"),this.flags&s.HAS_BASECOLORMAP&&(e.baseColorTexture=r.getUniformLocation(t,"u_baseColorTexture")),this.flags&s.HAS_NORMALMAP&&(e.normalTexture=r.getUniformLocation(t,"u_normalTexture"),e.normalTextureScale=r.getUniformLocation(t,"u_normalTextureScale")),this.flags&s.HAS_METALROUGHNESSMAP&&(e.metallicRoughnessTexture=r.getUniformLocation(t,"u_metallicRoughnessTexture")),this.flags&s.HAS_OCCLUSIONMAP&&(e.occlusionTexture=r.getUniformLocation(t,"u_occlusionTexture"),e.occlusionStrength=r.getUniformLocation(t,"u_occlusionStrength")),this.flags&s.HAS_EMISSIVEMAP&&(e.emissiveTexture=r.getUniformLocation(t,"u_emissiveTexture"),e.emissiveFactor=r.getUniformLocation(t,"u_emissiveFactor")),r.useProgram(null),u[this.flags]=this.programObject}};var h=1,f=Jo.create(),c=rs.create();es.create();var d=[];r.enable(r.CULL_FACE),r.cullFace(r.BACK),r.frontFace(r.CCW);var v=!0;r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL);var p=p||{},g=null;Jo.create();var m=rs.create();rs.perspective(m,.785,t.width/t.height,.01,100),rs.create();var x=rs.create(),y=rs.create(),b=rs.create();rs.create();var _,A,T,w=[1,1,1,1],M=p.drawPrimitive=function(t,i){if(T){y=x=T.matrix,rs.invert(b,x),rs.transpose(b,b),i=w;var n=t.shader,a=t.material;if(null!==a){var o=a.pbrMetallicRoughness;i=o.baseColorFactor,t.material.doubleSided===v&&((v=!t.material.doubleSided)?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE))}g!=t.shader.programObject&&(g=t.shader.programObject,r.useProgram(g.program)),a&&(n.hasBaseColorMap()&&e(g.uniformLocations.baseColorTexture,o.baseColorTexture),n.hasNormalMap()&&(e(g.uniformLocations.normalTexture,a.normalTexture),r.uniform1f(g.uniformLocations.normalTextureScale,a.normalTexture.scale)),n.hasMetalRoughnessMap()&&e(g.uniformLocations.metallicRoughnessTexture,o.metallicRoughnessTexture),r.uniform1f(g.uniformLocations.metallicFactor,o.metallicFactor),r.uniform1f(g.uniformLocations.roughnessFactor,o.roughnessFactor),n.hasOcclusionMap()&&(e(g.uniformLocations.occlusionTexture,a.occlusionTexture),r.uniform1f(g.uniformLocations.occlusionStrength,a.occlusionTexture.strength)),n.hasEmissiveMap()&&(e(g.uniformLocations.emissiveTexture,a.emissiveTexture),r.uniform3fv(g.uniformLocations.emissiveFactor,a.emissiveFactor))),n.hasSkin()&&r.uniformBlockBinding(g.program,g.uniformBlockIndices.JointMatrix,_),r.activeTexture(r.TEXTURE0+29),r.bindTexture(r.TEXTURE_2D,null),r.uniform4fv(g.uniformLocations.baseColorFactor,i),r.uniformMatrix4fv(g.uniformLocations.MV,!1,x),r.uniformMatrix4fv(g.uniformLocations.MVP,!1,y),r.uniformMatrix4fv(g.uniformLocations.MVNormal,!1,b),r.bindVertexArray(t.vertexArray),null!==t.indices?r.drawElements(t.mode,t.indicesLength,t.indicesComponentType,t.indicesOffset):r.drawArrays(t.mode,t.drawArraysOffset,t.drawArraysCount),r.bindVertexArray(null)}},C=rs.create(),R=rs.create(),S=p.drawNode=function(t,e,i,n){if(e=i[e],void 0!==n?rs.mul(e,n,t.matrix):rs.copy(e,t.matrix),null!==t.skin){var a=t.skin;_=a.uniformBlockID;var o=t.skin.joints;for(rs.invert(R,e),n=0,u=o.length;n<u;n++){var s=o[n];rs.mul(C,i[s.nodeID],a.inverseBindMatrix[n]),rs.mul(C,R,C),a.jointMatrixUnidormBufferData.set(C,16*n)}r.bindBuffer(r.UNIFORM_BUFFER,a.jointMatrixUniformBuffer),r.bufferSubData(r.UNIFORM_BUFFER,0,a.jointMatrixUnidormBufferData,0,a.jointMatrixUnidormBufferData.length)}var u;if(null!==t.mesh)for(n=0,u=(a=t.mesh).primitives.length;n<u;n++)M(a.primitives[n],e);for(null!==t.skin&&r.bindBuffer(r.UNIFORM_BUFFER,null),n=0,u=t.children.length;n<u;n++)S(t.children[n],t.children[n].nodeID,i,e)},P=p.drawScene=function(t){var e=t.glTF;if(e.animations){var r,n=e.animations[i],a=0;for(r=n.samplers.length;a<r;a++)n.samplers[a].getValue(L);for(a=0,r=n.channels.length;a<r;a++){var o=n.channels[a],s=o.sampler,u=e.nodes[o.target.nodeID];switch(o.target.path){case"rotation":Qo.copy(u.rotation,s.curValue);break;case"translation":Jo.copy(u.translation,s.curValue);break;case"scale":Jo.copy(u.scale,s.curValue)}u.updateMatrixFromTRS()}}for(n=0,e=t.glTFScene.nodes.length;n<e;n++)S(t.glTFScene.nodes[n],t.glTFScene.nodes[n].nodeID,t.nodeMatrix,t.rootTransform)},E=performance.now(),L=0;return{setupScene:function(t,e){function o(t,e){if(void 0!==t){var i=t.bufferView;return null===i.target?(r.bindBuffer(r.ARRAY_BUFFER,i.buffer),r.bufferData(r.ARRAY_BUFFER,i.data,r.STATIC_DRAW)):r.bindBuffer(i.target,i.buffer),t.prepareVertexAttrib(e,r),!0}return!1}var s,u;if(t.animations){var v=0;for(s=t.animations.length;v<s;v++)n.add(t.animations[v].name||v)}for(i=0,v=t.scenes[t.defaultScene],Jo.fromValues(1.2*v.boundingBox.transform[0],0,0),Jo.create(),e?e=d[e.id]=new a(v,t,e.id):(e=new a(v,t,d.length),d.push(e)),1===d.length&&(rs.identity(c),h=1/Math.max(v.boundingBox.transform[0],Math.max(v.boundingBox.transform[5],v.boundingBox.transform[10])),rs.getTranslation(f,v.boundingBox.transform),Jo.scale(f,f,-1),f[0]+=-.5*v.boundingBox.transform[0],f[1]+=-.5*v.boundingBox.transform[5],f[2]+=-.5*v.boundingBox.transform[10],h*=.5,c[0]=h,c[5]=h,c[10]=h,rs.translate(c,c,f),Jo.set(f,0,0,-1.5),h=1),v=0,s=t.bufferViews.length;v<s;v++){var p=t.bufferViews[v];p.createBuffer(r),p.bindData(r)}if(t.textures)for(v=0,s=t.textures.length;v<s;v++){var g=t.textures[v];g.createTexture(r)}if(t.samplers)for(v=0,s=t.samplers.length;v<s;v++)(g=t.samplers[v]).createSampler(r);if(t.skins)for(v=0,s=t.skins.length;v<s;v++)(g=t.skins[v]).jointMatrixUniformBuffer=r.createBuffer(),r.bindBufferBase(r.UNIFORM_BUFFER,g.uniformBlockID,g.jointMatrixUniformBuffer),r.bindBuffer(r.UNIFORM_BUFFER,g.jointMatrixUniformBuffer),r.bufferData(r.UNIFORM_BUFFER,g.jointMatrixUnidormBufferData,r.DYNAMIC_DRAW),r.bufferSubData(r.UNIFORM_BUFFER,0,g.jointMatrixUnidormBufferData),r.bindBuffer(r.UNIFORM_BUFFER,null);var m=0;for(u=t.meshes.length;m<u;m++)for(v=0,s=(g=t.meshes[m]).primitives.length;v<s;++v){var x=g.primitives[v];x.shader=new l,x.vertexArray=p=r.createVertexArray(),r.bindVertexArray(p),o(x.attributes.POSITION,0),o(x.attributes.NORMAL,1),o(x.attributes.TEXCOORD_0,2),o(x.attributes.JOINTS_0,3)&&o(x.attributes.WEIGHTS_0,4)&&x.shader.defineMacro("HAS_SKIN"),o(x.attributes.JOINTS_1,5)&&o(x.attributes.WEIGHTS_1,6)&&x.shader.defineMacro("SKIN_VEC8"),null!==x.indices&&(null===(p=(p=t.accessors[x.indices]).bufferView).target?(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,p.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,p.data,r.STATIC_DRAW)):r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,p.buffer)),r.bindVertexArray(null),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),(p=x.material)&&(p.pbrMetallicRoughness.baseColorTexture&&x.shader.defineMacro("HAS_BASECOLORMAP"),p.pbrMetallicRoughness.metallicRoughnessTexture&&x.shader.defineMacro("HAS_METALROUGHNESSMAP"),p.normalTexture&&x.shader.defineMacro("HAS_NORMALMAP"),p.occlusionTexture&&x.shader.defineMacro("HAS_OCCLUSIONMAP"),p.emissiveTexture&&x.shader.defineMacro("HAS_EMISSIVEMAP")),x.shader.compile()}return e},render:p.render=function(t){var e;T=t,t=(new Date).getTime();var r=0;for(e=d.length;r<e;r++)A=d[r],P(d[r]);g=null,L=.001*(t-E)}}}function Bt(t,e,r,i,n,a){if("string"==typeof e&&"number"==typeof r&&"number"==typeof i)for(e=e.split(a),a=0;a<e.length;a++)t.fillText(e[a],r,i),i+=n}function Ot(t){this.options=t=t||{},t.colors=t.colors||["rgba(0,192,73,0.99609375)","rgba(242,48,48,0.99609375)","rgba(255,159,25,0.99609375)"];var e=t.colors;this.drawTogether=!0,this.parseColors(e),this.tileSize=256,this.ratio=window.devicePixelRatio,this.cache={},t.getTileUrl&&(this.getTileUrl=t.getTileUrl),this._loadCount={}}function kt(t){var e=t/2,r=t+e,i=new T(2*r,2*r),n=i.getContext("2d");return n.shadowBlur=e,n.shadowColor="black",n.shadowOffsetX=n.shadowOffsetY=1e4,n.beginPath(),n.arc(r-1e4,r-1e4,t,0,2*Math.PI,!0),n.closePath(),n.fill(),i}var zt=window.BMapGL||window.BMap;zt&&zt.Overlay&&(r.prototype=new zt.Overlay),r.prototype.initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas"),r=this.ctx=this.canvas.getContext("2d");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";",this.adjustSize(),this.adjustRatio(r),t.getContainer().appendChild(e);var i=this;return t.addEventListener("resize",(function(){i.adjustSize(),i._draw()})),this.canvas},r.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas;e.width=t.width,e.height=t.height,e.style.width=e.width+"px",e.style.height=e.height+"px"},r.prototype.adjustRatio=function(t){var e=(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1),r=t.canvas.width,i=t.canvas.height;t.canvas.width=r*e,t.canvas.height=i*e,t.canvas.style.width=r+"px",t.canvas.style.height=i+"px",t.scale(e,e)},r.prototype.draw=function(){this._draw.apply(this,arguments)},r.prototype._draw=function(){this.dispatchEvent("draw"),this.options.update&&this.options.update.apply(this,arguments)},r.prototype.getContainer=function(){return this.canvas},r.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},r.prototype.hide=function(){this.canvas.style.display="none"},r.prototype.setZIndex=function(t){this.canvas.style.zIndex=t},r.prototype.getZIndex=function(){return this.zIndex},"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e||"undefined"!=typeof self&&self;var It,Ut=i(n((function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}}))),Nt=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},Ht={}.hasOwnProperty,jt=function(t,e){return Ht.call(t,e)},Xt={}.toString,Wt=function(t){return Xt.call(t).slice(8,-1)},Yt=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==Wt(t)?t.split(""):Object(t)},Zt=function(t){return Yt(Nt(t))},Vt=Math.ceil,Gt=Math.floor,qt=function(t){return isNaN(t=+t)?0:(0<t?Gt:Vt)(t)},Kt=Math.min,Qt=function(t){return 0<t?Kt(qt(t),9007199254740991):0},Jt=Math.max,$t=Math.min,te=n((function(t){t=t.exports={version:"2.6.5"},"number"==typeof __e&&(__e=t)})),ee=n((function(t){t=t.exports="undefined"!=typeof window&&Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),"number"==typeof __g&&(__g=t)})),re=n((function(t){var e=ee["__core-js_shared__"]||(ee["__core-js_shared__"]={});(t.exports=function(t,r){return e[t]||(e[t]=void 0!==r?r:{})})("versions",[]).push({version:te.version,mode:"pure",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),ie=0,ne=Math.random(),ae=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++ie+ne).toString(36))},oe=re("keys"),se=function(t){return oe[t]||(oe[t]=ae(t))},ue=(It=!1,function(t,e,r){t=Zt(t);var i=Qt(t.length);if(r=0>(r=qt(r))?Jt(r+i,0):$t(r,i),It&&e!=e){for(;i>r;)if((e=t[r++])!=e)return!0}else for(;i>r;r++)if((It||r in t)&&t[r]===e)return It||r||0;return!It&&-1}),le=se("IE_PROTO"),he=function(t,e){t=Zt(t);var r,i=0,n=[];for(r in t)r!=le&&jt(t,r)&&n.push(r);for(;e.length>i;)jt(t,r=e[i++])&&(~ue(n,r)||n.push(r));return n},fe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),ce=Object.keys||function(t){return he(t,fe)},de=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},ve=function(t,e,r){if(de(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,i){return t.call(e,r,i)};case 3:return function(r,i,n){return t.call(e,r,i,n)}}return function(){return t.apply(e,arguments)}},pe=function(t){return"object"==typeof t?null!==t:"function"==typeof t},ge=function(t){if(!pe(t))throw TypeError(t+" is not an object!");return t},me=function(t){try{return!!t()}catch(ul){return!0}},xe=!me((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),ye=ee.document,be=pe(ye)&&pe(ye.createElement),_e=!xe&&!me((function(){return 7!=Object.defineProperty(be?ye.createElement("div"):{},"a",{get:function(){return 7}}).a})),Ae=function(t,e){if(!pe(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!pe(i=r.call(t))||"function"==typeof(r=t.valueOf)&&!pe(i=r.call(t))||!e&&"function"==typeof(r=t.toString)&&!pe(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")},Te=Object.defineProperty,we={f:xe?Object.defineProperty:function(t,e,r){if(ge(t),e=Ae(e,!0),ge(r),_e)try{return Te(t,e,r)}catch(ll){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},Me=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Ce=xe?function(t,e,r){return we.f(t,e,Me(1,r))}:function(t,e,r){return t[e]=r,t},Re=function(t,e,r){var i,n=t&Re.F,a=t&Re.G,o=t&Re.S,s=t&Re.P,u=t&Re.B,l=t&Re.W,h=a?te:te[e]||(te[e]={}),f=h.prototype;for(i in o=a?ee:o?ee[e]:(ee[e]||{}).prototype,a&&(r=e),r)if(!(e=!n&&o&&void 0!==o[i])||!jt(h,i)){var c=e?o[i]:r[i];h[i]=a&&"function"!=typeof o[i]?r[i]:u&&e?ve(c,ee):l&&o[i]==c?function(t){var e=function(e,r,i){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,r)}return new t(e,r,i)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(c):s&&"function"==typeof c?ve(Function.call,c):c,s&&((h.virtual||(h.virtual={}))[i]=c,t&Re.R&&f&&!f[i]&&Ce(f,i,c))}};Re.F=1,Re.G=2,Re.S=4,Re.P=8,Re.B=16,Re.W=32,Re.U=64,Re.R=128;var Se=Re,Pe=function(t,e){var r=(te.Object||{})[t]||Object[t],i={};i[t]=e(r),Se(Se.S+Se.F*me((function(){r(1)})),"Object",i)};Pe("keys",(function(){return function(t){return ce(Object(Nt(t)))}}));var Ee=te.Object.keys,Le=i(n((function(t){t.exports={default:Ee,__esModule:!0}}))),Fe=Object.getOwnPropertySymbols,De={}.propertyIsEnumerable,Be=Object.assign,Oe=!Be||me((function(){var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=Be({},t)[r]||"abcdefghijklmnopqrst"!=Object.keys(Be({},e)).join("")}))?function(t,e){for(var r=Object(Nt(t)),i=arguments.length,n=1,a=Fe,o=De;i>n;)for(var s,u=Yt(arguments[n++]),l=a?ce(u).concat(a(u)):ce(u),h=l.length,f=0;h>f;)o.call(u,s=l[f++])&&(r[s]=u[s]);return r}:Be;Se(Se.S+Se.F,"Object",{assign:Oe});var ke=te.Object.assign,ze=i(n((function(t){t.exports={default:ke,__esModule:!0}}))),Ie=se("IE_PROTO"),Ue=Object.prototype,Ne=Object.getPrototypeOf||function(t){return t=Object(Nt(t)),jt(t,Ie)?t[Ie]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ue:null};Pe("getPrototypeOf",(function(){return function(t){return Ne(Object(Nt(t)))}}));var He=te.Object.getPrototypeOf,je=n((function(t){t.exports={default:He,__esModule:!0}})),Xe=i(je);Se(Se.S+Se.F*!xe,"Object",{defineProperty:we.f});var We=te.Object,Ye=function(t,e,r){return We.defineProperty(t,e,r)},Ze=n((function(t){t.exports={default:Ye,__esModule:!0}})),Ve=i(Ze),Ge=i(n((function(t,e){e.__esModule=!0;var r=Ze&&Ze.__esModule?Ze:{default:Ze};e.default=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,r.default)(t,n.key,n)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}()}))),qe={},Ke=xe?Object.defineProperties:function(t,e){ge(t);for(var r,i=ce(e),n=i.length,a=0;n>a;)we.f(t,r=i[a++],e[r]);return t},Qe=ee.document,Je=Qe&&Qe.documentElement,$e=se("IE_PROTO"),tr=function(){},er=function(){var t=be?ye.createElement("iframe"):{},e=fe.length;for(t.style.display="none",Je.appendChild(t),t.src="javascript:",(t=t.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),er=t.F;e--;)delete er.prototype[fe[e]];return er()},rr=Object.create||function(t,e){if(null!==t){tr.prototype=ge(t);var r=new tr;tr.prototype=null,r[$e]=t}else r=er();return void 0===e?r:Ke(r,e)},ir=n((function(t){var e=re("wks"),r=ee.Symbol,i="function"==typeof r;(t.exports=function(t){return e[t]||(e[t]=i&&r[t]||(i?r:ae)("Symbol."+t))}).store=e})),nr=we.f,ar=ir("toStringTag"),or=function(t,e,r){t&&!jt(t=r?t:t.prototype,ar)&&nr(t,ar,{configurable:!0,value:e})},sr={};Ce(sr,ir("iterator"),(function(){return this}));var ur=function(t,e,r){t.prototype=rr(sr,{next:Me(1,r)}),or(t,e+" Iterator")},lr=ir("iterator"),hr=!([].keys&&"next"in[].keys()),fr=function(){return this},cr=function(t,e,r,i,n,a,o){ur(r,e,i),i=function(t){return!hr&&t in f?f[t]:function(){return new r(this,t)}};var s,u=e+" Iterator",l="values"==n,h=!1,f=t.prototype,c=f[lr]||f["@@iterator"]||n&&f[n],d=c||i(n),v=n?l?i("entries"):d:void 0,p="Array"==e&&f.entries||c;if(p&&(t=Ne(p.call(new t)))!==Object.prototype&&t.next&&or(t,u,!0),l&&c&&"values"!==c.name&&(h=!0,d=function(){return c.call(this)}),o&&(hr||h||!f[lr])&&Ce(f,lr,d),qe[e]=d,qe[u]=fr,n){var g={values:l?d:i("values"),keys:a?d:i("keys"),entries:v};if(o)for(s in g)s in f||Ce(f,s,g[s]);else Se(Se.P+Se.F*(hr||h),e,g)}return g},dr=function(t){return function(e,r){e=String(Nt(e)),r=qt(r);var i,n=e.length;if(0>r||r>=n)return t?"":void 0;var a=e.charCodeAt(r);return 55296>a||56319<a||r+1===n||56320>(i=e.charCodeAt(r+1))||57343<i?t?e.charAt(r):a:t?e.slice(r,r+2):i-56320+(a-55296<<10)+65536}}(!0);cr(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t=this._t,e=this._i;return e>=t.length?{value:void 0,done:!0}:(t=dr(t,e),this._i+=t.length,{value:t,done:!1})}));var vr=function(t,e){return{value:e,done:!!t}};cr(Array,"Array",(function(t,e){this._t=Zt(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,vr(1)):vr(0,"keys"==e?r:"values"==e?t[r]:[r,t[r]])}),"values"),qe.Arguments=qe.Array;for(var pr=ir("toStringTag"),gr="CSSRuleList CSSStyleDeclaration CSSValueList ClientRectList DOMRectList DOMStringList DOMTokenList DataTransferItemList FileList HTMLAllCollection HTMLCollection HTMLFormElement HTMLSelectElement MediaList MimeTypeArray NamedNodeMap NodeList PaintRequestList Plugin PluginArray SVGLengthList SVGNumberList SVGPathSegList SVGPointList SVGStringList SVGTransformList SourceBufferList StyleSheetList TextTrackCueList TextTrackList TouchList".split(" "),mr=0;mr<gr.length;mr++){var xr=gr[mr],yr=ee[xr],br=yr&&yr.prototype;br&&!br[pr]&&Ce(br,pr,xr),qe[xr]=qe.Array}var _r={f:ir},Ar=_r.f("iterator"),Tr=n((function(t){t.exports={default:Ar,__esModule:!0}}));i(Tr);var wr=n((function(t){var e=ae("meta"),r=we.f,i=0,n=Object.isExtensible||function(){return!0},a=!me((function(){return n(Object.preventExtensions({}))})),o=function(t){r(t,e,{value:{i:"O"+ ++i,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,r){if(!pe(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!jt(t,e)){if(!n(t))return"F";if(!r)return"E";o(t)}return t[e].i},getWeak:function(t,r){if(!jt(t,e)){if(!n(t))return!0;if(!r)return!1;o(t)}return t[e].w},onFreeze:function(t){return a&&s.NEED&&n(t)&&!jt(t,e)&&o(t),t}}})),Mr=we.f,Cr=function(t){var e=te.Symbol||(te.Symbol={});"_"==t.charAt(0)||t in e||Mr(e,t,{value:_r.f(t)})},Rr=Array.isArray||function(t){return"Array"==Wt(t)},Sr=fe.concat("length","prototype"),Pr=Object.getOwnPropertyNames||function(t){return he(t,Sr)},Er=Pr,Lr={}.toString,Fr="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Dr=function(t){if(Fr&&"[object Window]"==Lr.call(t))try{var e=Er(t)}catch(r){e=Fr.slice()}else e=Er(Zt(t));return e},Br=Object.getOwnPropertyDescriptor,Or={f:xe?Br:function(t,e){if(t=Zt(t),e=Ae(e,!0),_e)try{return Br(t,e)}catch(r){}if(jt(t,e))return Me(!De.call(t,e),t[e])}},kr=wr.KEY,zr=Or.f,Ir=we.f,Ur=Dr,Nr=ee.Symbol,Hr=ee.JSON,jr=Hr&&Hr.stringify,Xr=ir("_hidden"),Wr=ir("toPrimitive"),Yr={}.propertyIsEnumerable,Zr=re("symbol-registry"),Vr=re("symbols"),Gr=re("op-symbols"),qr=Object.prototype,Kr="function"==typeof Nr,Qr=ee.QObject,Jr=!Qr||!Qr.prototype||!Qr.prototype.findChild,$r=xe&&me((function(){return 7!=rr(Ir({},"a",{get:function(){return Ir(this,"a",{value:7}).a}})).a}))?function(t,e,r){var i=zr(qr,e);i&&delete qr[e],Ir(t,e,r),i&&t!==qr&&Ir(qr,e,i)}:Ir,ti=function(t){var e=Vr[t]=rr(Nr.prototype);return e._k=t,e},ei=Kr&&"symbol"==typeof Nr.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof Nr},ri=function(t,e,r){return t===qr&&ri(Gr,e,r),ge(t),e=Ae(e,!0),ge(r),jt(Vr,e)?(r.enumerable?(jt(t,Xr)&&t[Xr][e]&&(t[Xr][e]=!1),r=rr(r,{enumerable:Me(0,!1)})):(jt(t,Xr)||Ir(t,Xr,Me(1,{})),t[Xr][e]=!0),$r(t,e,r)):Ir(t,e,r)},ii=function(t,e){ge(t);var r,i=e=Zt(e),n=ce(i),a=Fe;if(a){a=a(i);for(var o,s=De,u=0;a.length>u;)s.call(i,o=a[u++])&&n.push(o)}for(i=0,o=n.length;o>i;)ri(t,r=n[i++],e[r]);return t},ni=function(t){var e=Yr.call(this,t=Ae(t,!0));return!(this===qr&&jt(Vr,t)&&!jt(Gr,t))&&(!(e||!jt(this,t)||!jt(Vr,t)||jt(this,Xr)&&this[Xr][t])||e)},ai=function(t,e){if(t=Zt(t),e=Ae(e,!0),t!==qr||!jt(Vr,e)||jt(Gr,e)){var r=zr(t,e);return!r||!jt(Vr,e)||jt(t,Xr)&&t[Xr][e]||(r.enumerable=!0),r}},oi=function(t){t=Ur(Zt(t));for(var e,r=[],i=0;t.length>i;)jt(Vr,e=t[i++])||e==Xr||e==kr||r.push(e);return r},si=function(t){var e=t===qr;t=Ur(e?Gr:Zt(t));for(var r,i=[],n=0;t.length>n;)jt(Vr,r=t[n++])&&(!e||jt(qr,r))&&i.push(Vr[r]);return i};Kr||(Nr=function(){if(this instanceof Nr)throw TypeError("Symbol is not a constructor!");var t=ae(0<arguments.length?arguments[0]:void 0),e=function(r){this===qr&&e.call(Gr,r),jt(this,Xr)&&jt(this[Xr],t)&&(this[Xr][t]=!1),$r(this,t,Me(1,r))};return xe&&Jr&&$r(qr,t,{configurable:!0,set:e}),ti(t)},Ce(Nr.prototype,"toString",(function(){return this._k})),Or.f=ai,we.f=ri,Pr=Dr=oi,De=ni,Fe=si,_r.f=function(t){return ti(ir(t))}),Se(Se.G+Se.W+Se.F*!Kr,{Symbol:Nr});for(var ui="hasInstance isConcatSpreadable iterator match replace search species split toPrimitive toStringTag unscopables".split(" "),li=0;ui.length>li;)ir(ui[li++]);for(var hi=ce(ir.store),fi=0;hi.length>fi;)Cr(hi[fi++]);Se(Se.S+Se.F*!Kr,"Symbol",{for:function(t){return jt(Zr,t+="")?Zr[t]:Zr[t]=Nr(t)},keyFor:function(t){if(!ei(t))throw TypeError(t+" is not a symbol!");for(var e in Zr)if(Zr[e]===t)return e},useSetter:function(){Jr=!0},useSimple:function(){Jr=!1}}),Se(Se.S+Se.F*!Kr,"Object",{create:function(t,e){return void 0===e?rr(t):ii(rr(t),e)},defineProperty:ri,defineProperties:ii,getOwnPropertyDescriptor:ai,getOwnPropertyNames:oi,getOwnPropertySymbols:si}),Hr&&Se(Se.S+Se.F*(!Kr||me((function(){var t=Nr();return"[null]"!=jr([t])||"{}"!=jr({a:t})||"{}"!=jr(Object(t))}))),"JSON",{stringify:function(t){for(var e,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(e=i=r[1],(pe(i)||void 0!==t)&&!ei(t))return Rr(i)||(i=function(t,r){if("function"==typeof e&&(r=e.call(this,t,r)),!ei(r))return r}),r[1]=i,jr.apply(Hr,r)}}),Nr.prototype[Wr]||Ce(Nr.prototype,Wr,Nr.prototype.valueOf),or(Nr,"Symbol"),or(Math,"Math",!0),or(ee.JSON,"JSON",!0),Cr("asyncIterator"),Cr("observable");var ci=te.Symbol,di=n((function(t){t.exports={default:ci,__esModule:!0}})),vi=i(di),pi=n((function(t,e){e.__esModule=!0,t=Tr&&Tr.__esModule?Tr:{default:Tr};var r=di&&di.__esModule?di:{default:di},i="function"==typeof r.default&&"symbol"==typeof t.default?function(t){return typeof t}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":typeof t};e.default="function"==typeof r.default&&"symbol"===i(t.default)?function(t){return void 0===t?"undefined":i(t)}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":void 0===t?"undefined":i(t)}})),gi=i(pi),mi=i(n((function(t,e){e.__esModule=!0;var r=pi&&pi.__esModule?pi:{default:pi};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,r.default)(e))&&"function"!=typeof e?t:e}}))),xi=Object.setPrototypeOf||("__proto__"in{}?function(t,e,r){try{(r=ve(Function.call,Or.f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(ll){e=!0}return function(t,i){if(ge(t),!pe(i)&&null!==i)throw TypeError(i+": can't set as prototype!");return e?t.__proto__=i:r(t,i),t}}({},!1):void 0);Se(Se.S,"Object",{setPrototypeOf:xi});var yi=te.Object.setPrototypeOf,bi=n((function(t){t.exports={default:yi,__esModule:!0}}));i(bi),Se(Se.S,"Object",{create:rr});var _i=te.Object,Ai=function(t,e){return _i.create(t,e)},Ti=n((function(t){t.exports={default:Ai,__esModule:!0}})),wi=i(Ti),Mi=i(n((function(t,e){function r(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var i=r(bi),n=r(Ti),a=r(pi);e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,a.default)(e)));t.prototype=(0,n.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(i.default?(0,i.default)(t,e):t.__proto__=e)}}))),Ci=ir("toStringTag"),Ri="Arguments"==Wt(function(){return arguments}()),Si=function(t){var e;if(void 0===t)var r="Undefined";else{if(null===t)var i="Null";else{t:{var n=t=Object(t);try{i=n[Ci];break t}catch(fl){}i=void 0}i="string"==typeof(r=i)?r:Ri?Wt(t):"Object"==(e=Wt(t))&&"function"==typeof t.callee?"Arguments":e}r=i}return r},Pi=ir("iterator"),Ei=te.isIterable=function(t){return void 0!==(t=Object(t))[Pi]||"@@iterator"in t||qe.hasOwnProperty(Si(t))},Li=n((function(t){t.exports={default:Ei,__esModule:!0}}));i(Li);var Fi=ir("iterator"),Di=te.getIteratorMethod=function(t){if(null!=t)return t[Fi]||t["@@iterator"]||qe[Si(t)]},Bi=te.getIterator=function(t){var e=Di(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return ge(e.call(t))},Oi=n((function(t){t.exports={default:Bi,__esModule:!0}})),ki=i(Oi),zi=i(n((function(t,e){e.__esModule=!0;var r=Li&&Li.__esModule?Li:{default:Li},i=Oi&&Oi.__esModule?Oi:{default:Oi};e.default=function(t,e){if(Array.isArray(t))return t;if((0,r.default)(Object(t))){var n=[],a=!0,o=!1,s=void 0;try{for(var u,l=(0,i.default)(t);!(a=(u=l.next()).done)&&(n.push(u.value),!e||n.length!==e);a=!0);}catch(h){o=!0,s=h}finally{try{!a&&l.return&&l.return()}finally{if(o)throw s}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")}}))),Ii=function(t,e,r,i){try{return i?e(ge(r)[0],r[1]):e(r)}catch(hl){throw void 0!==(e=t.return)&&ge(e.call(t)),hl}},Ui=ir("iterator"),Ni=Array.prototype,Hi=ir("iterator"),ji=!1;try{[7][Hi]().return=function(){ji=!0}}catch(It){}var Xi=function(t,e){if(!e&&!ji)return!1;var r=!1;try{var i=(e=[7])[Hi]();i.next=function(){return{done:r=!0}},e[Hi]=function(){return i},t(e)}catch(hl){}return r};Se(Se.S+Se.F*!Xi((function(t){})),"Array",{from:function(t){var e,r=Object(Nt(t)),i="function"==typeof this?this:Array,n=arguments.length,a=1<n?arguments[1]:void 0,o=void 0!==a,s=0,u=Di(r);if(o&&(a=ve(a,2<n?arguments[2]:void 0,2)),null!=u&&(i!=Array||void 0===u||qe.Array!==u&&Ni[Ui]!==u))for(r=u.call(r),i=new i;!(e=r.next()).done;s++)n=i,u=s,e=o?Ii(r,a,[e.value,s],!0):e.value,u in n?we.f(n,u,Me(0,e)):n[u]=e;else for(i=new i(n=Qt(r.length));n>s;s++){u=i,e=s;var l=o?a(r[s],s):r[s];e in u?we.f(u,e,Me(0,l)):u[e]=l}return i.length=s,i}});var Wi=te.Array.from,Yi=n((function(t){t.exports={default:Wi,__esModule:!0}})),Zi=i(Yi),Vi=i(n((function(t,e){e.__esModule=!0;var r=Yi&&Yi.__esModule?Yi:{default:Yi};e.default=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return(0,r.default)(t)}}))),Gi=wr.onFreeze;Pe("freeze",(function(t){return function(e){return t&&pe(e)?t(Gi(e)):e}}));var qi=te.Object.freeze,Ki=i(n((function(t){t.exports={default:qi,__esModule:!0}}))),Qi=te.JSON||(te.JSON={stringify:JSON.stringify}),Ji=function(t){return Qi.stringify.apply(Qi,arguments)},$i=i(n((function(t){t.exports={default:Ji,__esModule:!0}}))),tn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},en=Or.f;Pe("getOwnPropertyDescriptor",(function(){return function(t,e){return en(Zt(t),e)}}));var rn=te.Object,nn=function(t,e){return rn.getOwnPropertyDescriptor(t,e)},an=n((function(t){t.exports={default:nn,__esModule:!0}})),on=i(an),sn=n((function(t){var e=Array.prototype.concat,r=Array.prototype.slice,i=t.exports=function(t){for(var i=[],n=0,a=t.length;n<a;n++){var o=t[n],s=!(!(s=o)||"string"==typeof s)&&(s instanceof Array||Array.isArray(s)||0<=s.length&&(s.splice instanceof Function||on(s,s.length-1)&&"String"!==s.constructor.name));s?i=e.call(i,r.call(o)):i.push(o)}return i};i.wrap=function(t){return function(){return t(i(arguments))}}})),un=n((function(t){function e(t,e,r){return Math.min(Math.max(e,t),r)}function r(t){return 2>(t=t.toString(16).toUpperCase()).length?"0"+t:t}var i,n={};for(i in tn)tn.hasOwnProperty(i)&&(n[tn[i]]=i);var a=t.exports={to:{},get:{}};a.get=function(t){switch(t.substring(0,3).toLowerCase()){case"hsl":t=a.get.hsl(t);var e="hsl";break;case"hwb":t=a.get.hwb(t),e="hwb";break;default:t=a.get.rgb(t),e="rgb"}return t?{model:e,value:t}:null},a.get.rgb=function(t){if(!t)return null;var r,i=/^#([a-f0-9]{3,4})$/i,n=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,a=/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,o=/(\D+)/,s=[0,0,0,1];if(r=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=r[2],r=r[1],t=0;3>t;t++)n=2*t,s[t]=parseInt(r.slice(n,n+2),16);i&&(s[3]=Math.round(parseInt(i,16)/255*100)/100)}else if(r=t.match(i)){for(i=(r=r[1])[3],t=0;3>t;t++)s[t]=parseInt(r[t]+r[t],16);i&&(s[3]=Math.round(parseInt(i+i,16)/255*100)/100)}else if(r=t.match(n)){for(t=0;3>t;t++)s[t]=parseInt(r[t+1],0);r[4]&&(s[3]=parseFloat(r[4]))}else{if(!(r=t.match(a)))return(r=t.match(o))?"transparent"===r[1]?[0,0,0,0]:(s=tn[r[1]])?(s[3]=1,s):null:null;for(t=0;3>t;t++)s[t]=Math.round(2.55*parseFloat(r[t+1]));r[4]&&(s[3]=parseFloat(r[4]))}for(t=0;3>t;t++)s[t]=e(s[t],0,255);return s[3]=e(s[3],0,1),s},a.get.hsl=function(t){if(!t)return null;var r=t.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(r){var i=parseFloat(r[4]);return[t=(parseFloat(r[1])+360)%360,e(parseFloat(r[2]),0,100),r=e(parseFloat(r[3]),0,100),i=e(isNaN(i)?1:i,0,1)]}return null},a.get.hwb=function(t){if(!t)return null;var r=t.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(r){var i=parseFloat(r[4]);return[t=(parseFloat(r[1])%360+360)%360,e(parseFloat(r[2]),0,100),r=e(parseFloat(r[3]),0,100),i=e(isNaN(i)?1:i,0,1)]}return null},a.to.hex=function(){var t=sn(arguments);return"#"+r(t[0])+r(t[1])+r(t[2])+(1>t[3]?r(Math.round(255*t[3])):"")},a.to.rgb=function(){var t=sn(arguments);return 4>t.length||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},a.to.rgb.percent=function(){var t=sn(arguments),e=Math.round(t[0]/255*100),r=Math.round(t[1]/255*100),i=Math.round(t[2]/255*100);return 4>t.length||1===t[3]?"rgb("+e+"%, "+r+"%, "+i+"%)":"rgba("+e+"%, "+r+"%, "+i+"%, "+t[3]+")"},a.to.hsl=function(){var t=sn(arguments);return 4>t.length||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},a.to.hwb=function(){var t=sn(arguments),e="";return 4<=t.length&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},a.to.keyword=function(t){return n[t.slice(0,3)]}})),ln=n((function(t){var e={};for(n in tn)tn.hasOwnProperty(n)&&(e[tn[n]]=n);var r,i=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(r in i)if(i.hasOwnProperty(r)){if(!("channels"in i[r]))throw Error("missing channels property: "+r);if(!("labels"in i[r]))throw Error("missing channel labels property: "+r);if(i[r].labels.length!==i[r].channels)throw Error("channel and label counts mismatch: "+r);t=i[r].channels;var n=i[r].labels;delete i[r].channels,delete i[r].labels,Object.defineProperty(i[r],"channels",{value:t}),Object.defineProperty(i[r],"labels",{value:n})}i.rgb.hsl=function(t){var e=t[0]/255,r=t[1]/255,i=t[2]/255;t=Math.min(e,r,i);var n,a=Math.max(e,r,i),o=a-t;return a===t?n=0:e===a?n=(r-i)/o:r===a?n=2+(i-e)/o:i===a&&(n=4+(e-r)/o),0>(n=Math.min(60*n,360))&&(n+=360),e=(t+a)/2,[n,100*(a===t?0:.5>=e?o/(a+t):o/(2-a-t)),100*e]},i.rgb.hsv=function(t){var e,r=t[0]/255,i=t[1]/255,n=t[2]/255,a=Math.max(r,i,n),o=a-Math.min(r,i,n);if(0===o)var s=e=0;else{e=o/a,t=(a-r)/6/o+.5;var u=(a-i)/6/o+.5;o=(a-n)/6/o+.5,r===a?s=o-u:i===a?s=1/3+t-o:n===a&&(s=2/3+u-t),0>s?s+=1:1<s&&--s}return[360*s,100*e,100*a]},i.rgb.hwb=function(t){var e=t[0],r=t[1],n=t[2];return[t=i.rgb.hsl(t)[0],1/255*Math.min(e,Math.min(r,n))*100,100*(n=1-1/255*Math.max(e,Math.max(r,n)))]},i.rgb.cmyk=function(t){var e=t[0]/255,r=t[1]/255;t=t[2]/255;var i=Math.min(1-e,1-r,1-t);return[100*((1-e-i)/(1-i)||0),100*((1-r-i)/(1-i)||0),100*((1-t-i)/(1-i)||0),100*i]},i.rgb.keyword=function(t){var r,i=e[t];if(i)return i;for(r in i=1/0,tn)if(tn.hasOwnProperty(r)){var n=tn[r];if((n=Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)+Math.pow(t[2]-n[2],2))<i){i=n;var a=r}}return a},i.keyword.rgb=function(t){return tn[t]},i.rgb.xyz=function(t){var e=t[0]/255,r=t[1]/255;return t=t[2]/255,[100*(.4124*(e=.04045<e?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(r=.04045<r?Math.pow((r+.055)/1.055,2.4):r/12.92)+.1805*(t=.04045<t?Math.pow((t+.055)/1.055,2.4):t/12.92)),100*(.2126*e+.7152*r+.0722*t),100*(.0193*e+.1192*r+.9505*t)]},i.rgb.lab=function(t){var e=i.rgb.xyz(t);t=e[0];var r=e[1];return e=e[2],r/=100,e/=108.883,t=.008856<(t/=95.047)?Math.pow(t,1/3):7.787*t+16/116,[116*(r=.008856<r?Math.pow(r,1/3):7.787*r+16/116)-16,500*(t-r),200*(r-(e=.008856<e?Math.pow(e,1/3):7.787*e+16/116))]},i.hsl.rgb=function(t){var e=t[0]/360,r=t[1]/100;if(t=t[2]/100,0===r){var i=255*t;return[i,i,i]}t=2*t-(r=.5>t?t*(1+r):t+r-t*r);for(var n=[0,0,0],a=0;3>a;a++)0>(i=e+1/3*-(a-1))&&i++,1<i&&i--,i=1>6*i?t+6*(r-t)*i:1>2*i?r:2>3*i?t+(r-t)*(2/3-i)*6:t,n[a]=255*i;return n},i.hsl.hsv=function(t){var e=t[0],r=t[1]/100;t=t[2]/100;var i=r,n=Math.max(t,.01);return r*=1>=(t*=2)?t:2-t,i*=1>=n?n:2-n,[e,100*(0===t?2*i/(n+i):2*r/(t+r)),(t+r)/2*100]},i.hsv.rgb=function(t){var e=t[0]/60,r=t[1]/100;t=t[2]/100;var i=Math.floor(e)%6,n=e-Math.floor(e);e=255*t*(1-r);var a=255*t*(1-r*n);switch(r=255*t*(1-r*(1-n)),t*=255,i){case 0:return[t,r,e];case 1:return[a,t,e];case 2:return[e,t,r];case 3:return[e,a,t];case 4:return[r,e,t];case 5:return[t,e,a]}},i.hsv.hsl=function(t){var e=t[0],r=t[1]/100;t=t[2]/100;var i=Math.max(t,.01),n=(2-r)*i;return[e,100*(i=r*i/(1>=n?n:2-n)||0),(2-r)*t/2*100]},i.hwb.rgb=function(t){var e=t[0]/360,r=t[1]/100,i=r+(t=t[2]/100);switch(1<i&&(r/=i,t/=i),e=6*e-(i=Math.floor(6*e)),0!=(1&i)&&(e=1-e),e=r+e*((t=1-t)-r),i){default:case 6:case 0:i=t;var n=e;break;case 1:i=e,n=t;break;case 2:i=r,n=t,r=e;break;case 3:i=r,n=e,r=t;break;case 4:i=e,n=r,r=t;break;case 5:i=t,n=r,r=e}return[255*i,255*n,255*r]},i.cmyk.rgb=function(t){var e=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-e)+e)),255*(1-Math.min(1,t[1]/100*(1-e)+e)),255*(1-Math.min(1,t[2]/100*(1-e)+e))]},i.xyz.rgb=function(t){var e=t[0]/100,r=t[1]/100,i=t[2]/100;t=3.2406*e+-1.5372*r+-.4986*i;var n=-.9689*e+1.8758*r+.0415*i;return e=.0557*e+-.204*r+1.057*i,t=.0031308<t?1.055*Math.pow(t,1/2.4)-.055:12.92*t,n=.0031308<n?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=.0031308<e?1.055*Math.pow(e,1/2.4)-.055:12.92*e,[255*(t=Math.min(Math.max(0,t),1)),255*(n=Math.min(Math.max(0,n),1)),255*(e=Math.min(Math.max(0,e),1))]},i.xyz.lab=function(t){var e=t[0],r=t[1];return t=t[2],r/=100,t/=108.883,e=.008856<(e/=95.047)?Math.pow(e,1/3):7.787*e+16/116,[116*(r=.008856<r?Math.pow(r,1/3):7.787*r+16/116)-16,500*(e-r),200*(r-(t=.008856<t?Math.pow(t,1/3):7.787*t+16/116))]},i.lab.xyz=function(t){var e=t[1],r=t[2];e=e/500+(t=(t[0]+16)/116),r=t-r/200;var i=Math.pow(t,3),n=Math.pow(e,3),a=Math.pow(r,3);return[95.047*(.008856<n?n:(e-16/116)/7.787),100*(.008856<i?i:(t-16/116)/7.787),108.883*(.008856<a?a:(r-16/116)/7.787)]},i.lab.lch=function(t){var e=t[0],r=t[1];t=t[2];var i=360*Math.atan2(t,r)/2/Math.PI;return 0>i&&(i+=360),[e,Math.sqrt(r*r+t*t),i]},i.lch.lab=function(t){var e=t[0],r=t[1];return t=t[2]/360*2*Math.PI,[e,r*Math.cos(t),r*Math.sin(t)]},i.rgb.ansi16=function(t){var e=t[0],r=t[1],n=t[2],a=1 in arguments?arguments[1]:i.rgb.hsv(t)[2];return 0===(a=Math.round(a/50))?30:(e=30+(Math.round(n/255)<<2|Math.round(r/255)<<1|Math.round(e/255)),2===a&&(e+=60),e)},i.hsv.ansi16=function(t){return i.rgb.ansi16(i.hsv.rgb(t),t[2])},i.rgb.ansi256=function(t){var e=t[0],r=t[1];return t=t[2],e===r&&r===t?8>e?16:248<e?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(t/255*5)},i.ansi16.rgb=function(t){var e=t%10;return 0===e||7===e?(50<t&&(e+=3.5),[e=e/10.5*255,e,e]):[(1&e)*(t=.5*(1+~~(50<t)))*255,(e>>1&1)*t*255,(e>>2&1)*t*255]},i.ansi256.rgb=function(t){if(232<=t){var e=10*(t-232)+8;return[e,e,e]}return t-=16,[e=Math.floor(t/36)/5*255,Math.floor((t%=36)/6)/5*255,t%6/5*255]},i.rgb.hex=function(t){return t=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase(),"000000".substring(t.length)+t},i.hex.rgb=function(t){if(!(t=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i)))return[0,0,0];var e=t[0];return 3===t[0].length&&(e=e.split("").map((function(t){return t+t})).join("")),[(t=parseInt(e,16))>>16&255,t>>8&255,255&t]},i.rgb.hcg=function(t){var e=t[0]/255,r=t[1]/255;t=t[2]/255;var i=Math.max(Math.max(e,r),t),n=Math.min(Math.min(e,r),t),a=i-n;return[(0>=a?0:i===e?(r-t)/a%6:i===r?2+(t-e)/a:(e-r)/a+8)/6%1*360,100*a,100*(1>a?n/(1-a):0)]},i.hsl.hcg=function(t){var e=t[1]/100,r=t[2]/100,i=0;return 1>(e=.5>r?2*e*r:2*e*(1-r))&&(i=(r-.5*e)/(1-e)),[t[0],100*e,100*i]},i.hsv.hcg=function(t){var e=t[2]/100,r=t[1]/100*e,i=0;return 1>r&&(i=(e-r)/(1-r)),[t[0],100*r,100*i]},i.hcg.rgb=function(t){var e=t[1]/100,r=t[2]/100;if(0===e)return[255*r,255*r,255*r];var i=[0,0,0],n=(t=t[0]/360%1*6)%1,a=1-n;switch(Math.floor(t)){case 0:i[0]=1,i[1]=n,i[2]=0;break;case 1:i[0]=a,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=n;break;case 3:i[0]=0,i[1]=a,i[2]=1;break;case 4:i[0]=n,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=a}return r*=1-e,[255*(e*i[0]+r),255*(e*i[1]+r),255*(e*i[2]+r)]},i.hcg.hsv=function(t){var e=t[1]/100,r=e+t[2]/100*(1-e),i=0;return 0<r&&(i=e/r),[t[0],100*i,100*r]},i.hcg.hsl=function(t){var e=t[1]/100,r=t[2]/100*(1-e)+.5*e,i=0;return 0<r&&.5>r?i=e/(2*r):.5<=r&&1>r&&(i=e/(2*(1-r))),[t[0],100*i,100*r]},i.hcg.hwb=function(t){var e=t[1]/100,r=e+t[2]/100*(1-e);return[t[0],100*(r-e),100*(1-r)]},i.hwb.hcg=function(t){var e=1-t[2]/100,r=e-t[1]/100,i=0;return 1>r&&(i=(e-r)/(1-r)),[t[0],100*r,100*i]},i.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},i.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},i.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},i.gray.hsl=i.gray.hsv=function(t){return[0,0,t[0]]},i.gray.hwb=function(t){return[0,100,t[0]]},i.gray.cmyk=function(t){return[0,0,0,t[0]]},i.gray.lab=function(t){return[t[0],0,0]},i.gray.hex=function(t){return t=(((t=255&Math.round(t[0]/100*255))<<16)+(t<<8)+t).toString(16).toUpperCase(),"000000".substring(t.length)+t},i.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}})),hn=function(t){for(var e={},r=Le(ln),i=r.length,n=0;n<i;n++)e[r[n]]={distance:-1,parent:null};for(r=[t],e[t].distance=0;r.length;){t=r.pop(),n=(i=Le(ln[t])).length;for(var o=0;o<n;o++){var s=i[o],u=e[s];-1===u.distance&&(u.distance=e[t].distance+1,u.parent=t,r.unshift(s))}}for(r={},i=(t=Le(e)).length,n=0;n<i;n++){var l=t[n];if(null!==e[l].parent){o=l,u=[(s=e)[l].parent,l];var h=ln[s[l].parent][l];for(l=s[l].parent;s[l].parent;)u.unshift(s[l].parent),h=a(ln[s[l].parent][l],h),l=s[l].parent;h.conversion=u,r[o]=h}}return r},fn={};Le(ln).forEach((function(t){fn[t]={},Object.defineProperty(fn[t],"channels",{value:ln[t].channels}),Object.defineProperty(fn[t],"labels",{value:ln[t].labels});var e=hn(t);Le(e).forEach((function(r){var i=e[r];fn[t][r]=s(i),fn[t][r].raw=o(i)}))}));var cn=fn,dn=[].slice,vn=["keyword","gray","hex"],pn={};Le(cn).forEach((function(t){pn[dn.call(cn[t].labels).sort().join("")]=t}));var gn={};u.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in un.to?this:this.rgb();return t=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha),un.to[e.model](t)},percentString:function(t){return t=1===(t=this.rgb().round("number"==typeof t?t:1)).valpha?t.color:t.color.concat(this.valpha),un.to.rgb.percent(t)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=cn[this.model].channels,r=cn[this.model].labels,i=0;i<e;i++)t[r[i]]=this.color[i];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new u(this.color.map(l(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new u(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:h("rgb",0,f(255)),green:h("rgb",1,f(255)),blue:h("rgb",2,f(255)),hue:h(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:h("hsl",1,f(100)),lightness:h("hsl",2,f(100)),saturationv:h("hsv",1,f(100)),value:h("hsv",2,f(100)),chroma:h("hcg",1,f(100)),gray:h("hcg",2,f(100)),white:h("hwb",1,f(100)),wblack:h("hwb",2,f(100)),cyan:h("cmyk",0,f(100)),magenta:h("cmyk",1,f(100)),yellow:h("cmyk",2,f(100)),black:h("cmyk",3,f(100)),x:h("xyz",0,f(100)),y:h("xyz",1,f(100)),z:h("xyz",2,f(100)),l:h("lab",0,f(100)),a:h("lab",1),b:h("lab",2),keyword:function(t){return arguments.length?new u(t):cn[this.model].keyword(this.color)},hex:function(t){return arguments.length?new u(t):un.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],r=0;r<t.length;r++){var i=t[r]/255;e[r]=.03928>=i?i/12.92:Math.pow((i+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity();return e>(t=t.luminosity())?(e+.05)/(t+.05):(t+.05)/(e+.05)},level:function(t){return 7.1<=(t=this.contrast(t))?"AAA":4.5<=t?"AA":""},isDark:function(){var t=this.rgb().color;return 128>(299*t[0]+587*t[1]+114*t[2])/1e3},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;3>e;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color;return t=.3*t[0]+.59*t[1]+.11*t[2],u.rgb(t,t,t)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),r=e.color[0];return r=(r+t)%360,e.color[0]=0>r?360+r:r,e},mix:function(t,e){if(!t||!t.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+(void 0===t?"undefined":gi(t)));t=t.rgb();var r=this.rgb(),i=2*(e=void 0===e?.5:e)-1,n=t.alpha()-r.alpha();return n=1-(i=((-1==i*n?i:(i+n)/(1+i*n))+1)/2),u.rgb(i*t.red()+n*r.red(),i*t.green()+n*r.green(),i*t.blue()+n*r.blue(),t.alpha()*e+r.alpha()*(1-e))}},Le(cn).forEach((function(t){if(-1===vn.indexOf(t)){var e=cn[t].channels;u.prototype[t]=function(){if(this.model===t)return new u(this);if(arguments.length)return new u(arguments,t);var r="number"==typeof arguments[e]?e:this.valpha,i=cn[this.model][t].raw(this.color);return new u((i=Array.isArray(i)?i:[i]).concat(r),t)},u[t]=function(r){return"number"==typeof r&&(r=c(dn.call(arguments),e)),new u(r,t)}}})),b(_.prototype,{equals:function(t){return this.lat===t.lat&&this.lng===t.lng},clone:function(){return new _(this.lat,this.lng)},getLngSpan:function(t){return 180<(t=Math.abs(t-this.lng))&&(t=360-t),t},sub:function(t){return new _(this.lat-t.lat,this.lng-t.lng)},toString:function(){return"Point"}}),b(y,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(t,e){if(!t||!e)return 0;if(!(t=this.convertMC2LL(t)))return 0;var r=this.toRadians(t.lng);if(t=this.toRadians(t.lat),!(e=this.convertMC2LL(e)))return 0;var i=this.toRadians(e.lng);return e=this.toRadians(e.lat),this.getDistance(r,i,t,e)},getDistanceByLL:function(t,e){if(!t||!e)return 0;t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-74,74),e.lng=this.getLoop(e.lng,-180,180),e.lat=this.getRange(e.lat,-74,74);var r=this.toRadians(t.lng),i=this.toRadians(t.lat);return t=this.toRadians(e.lng),e=this.toRadians(e.lat),this.getDistance(r,t,i,e)},convertMC2LL:function(t){if(null==t)return new _(0,0);if(180>t.lng&&-180<t.lng&&90>t.lat&&-90<t.lat)return t;for(var e=new _(Math.abs(t.lng),Math.abs(t.lat)),r=0;r<this.MCBAND.length;r++)if(e.lat>=this.MCBAND[r]){var i=this.MC2LL[r];break}return new _((t=this.convertor(t,i)).lng.toFixed(6),t.lat.toFixed(6))},convertLL2MC:function(t){if(null==t)return new _(0,0);if(180<t.lng||-180>t.lng||90<t.lat||-90>t.lat)return t;t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-74,74);for(var e=new _(t.lng,t.lat),r=0;r<this.LLBAND.length;r++)if(e.lat>=this.LLBAND[r]){var i=this.LL2MC[r];break}if(!i)for(r=0;r<this.LLBAND.length;r++)if(e.lat<=-this.LLBAND[r]){i=this.LL2MC[r];break}return t=this.convertor(t,i),new _(Number(t.lng.toFixed(2)),Number(t.lat.toFixed(2)))},convertor:function(t,e){if(t&&e){var r=e[0]+e[1]*Math.abs(t.lng),i=Math.abs(t.lat)/e[9];return e=e[2]+e[3]*i+e[4]*i*i+e[5]*i*i*i+e[6]*i*i*i*i+e[7]*i*i*i*i*i+e[8]*i*i*i*i*i*i,new _(r*=0>t.lng?-1:1,e*=0>t.lat?-1:1)}},getDistance:function(t,e,r,i){return this.EARTHRADIUS*Math.acos(Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos(e-t))},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,r){return null!=e&&(t=Math.max(t,e)),null!=r&&(t=Math.min(t,r)),t},getLoop:function(t,e,r){for(;t>r;)t-=r-e;for(;t<e;)t+=r-e;return t}}),b(y.prototype,{lngLatToMercator:function(t){return y.convertLL2MC(t)},lngLatToPoint:function(t){return new A((t=y.convertLL2MC(t)).lng,t.lat)},mercatorToLngLat:function(t){return y.convertMC2LL(t)},pointToLngLat:function(t){return t=new _(t.x,t.y),y.convertMC2LL(t)},pointToPixel:function(t,e,r,i,n){if(t)return t=this.lngLatToMercator(t,n),e=this.getZoomUnits(e),new A(Math.round((t.lng-r.lng)/e+i.width/2),Math.round((r.lat-t.lat)/e+i.height/2))},pixelToPoint:function(t,e,r,i,n){if(t)return e=this.getZoomUnits(e),t=new _(r.lng+e*(t.x-i.width/2),r.lat-e*(t.y-i.height/2)),this.mercatorToLngLat(t,n)},getZoomUnits:function(t){return Math.pow(2,18-t)}}),w.prototype.setMax=function(t){this.max=t||100},w.prototype.setMin=function(t){this.min=t||0},w.prototype.setMaxSize=function(t){this.maxSize=t||35},w.prototype.setMinSize=function(t){this.minSize=t||0},w.prototype.initPalette=function(){var t=this.gradient,e=this.paletteCtx=new T(256,1).getContext("2d"),r=e.createLinearGradient(0,0,256,1);Le(t).forEach((function(e){r.addColorStop(parseFloat(e),t[e])})),e.fillStyle=r,e.fillRect(0,0,256,1),e.imageData=e.getImageData(0,0,256,1).data},w.prototype.getColor=function(t){return"rgba("+(t=this.getImageData(t))[0]+", "+t[1]+", "+t[2]+", "+t[3]/256+")"},w.prototype.getImageData=function(t){var e=this.paletteCtx.imageData;if(void 0===t)return e;var r=this.max,i=this.min;return t>r&&(t=r),t<i&&(t=i),[e[t=4*Math.floor((t-i)/(r-i)*255)],e[t+1],e[t+2],e[t+3]]},w.prototype.getSize=function(t){var e=this.max,r=this.min,i=this.maxSize,n=this.minSize;return t>e&&(t=e),t<r&&(t=r),n+(t-r)/(e-r)*(i-n)},M.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start),this.v3=this._normalizaCoord(this.options.end),this.v1=this._getControlPoint(this.v0,this.v3,4),this.v2=this._getControlPoint(this.v3,this.v0,5),this.v0[2]||(this.v0[2]=0),this.v3[2]||(this.v3[2]=0)},M.prototype.setOptions=function(t){this.options=t||{},this._initialize()},M.prototype.getPoints=function(t){void 0===t&&(t=20);for(var e=[],r=0;r<=t;r++)e.push(this._getPoint(r/t));return e},M.prototype._normalizaCoord=function(t){return t?[(t=y.convertLL2MC({lng:Number(t[0]),lat:Number(t[1])})).lng,t.lat]:[]},M.prototype._getControlPoint=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return[].concat(Vi(this._getQuarter(t,e)),[this._getDistance(t,e)/r])},M.prototype._getQuarter=function(t,e){return[(3*t[0]+e[0])/4,(3*t[1]+e[1])/4]},M.prototype._getDistance=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},M.prototype._getPoint=function(t){var e=[],r=this.v0,i=this.v1,n=this.v2,a=this.v3;return e.push(C(t,r[0],i[0],n[0],a[0]),C(t,r[1],i[1],n[1],a[1]),C(t,r[2],i[2],n[2],a[2])),e},R.prototype._initialize=function(){this.points=this.options.points||this.options.point||[],this.greatCirclePoints=[];for(var t=[],e=0;e<this.points.length;e++){var r=this._normalizaCoord(this.points[e]);r&&t.push(r)}this.points=t},R.prototype.setOptions=function(t){this.options=t||{},this._initialize()},R.prototype.getPoints=function(){if(0===this.greatCirclePoints.length)for(var t=0;t<this.points.length-1;t++)this._calcGreatCirclePoints(this.points[t],this.points[t+1]);return this.greatCirclePoints},R.prototype._normalizaCoord=function(t){if(!t)return null;t instanceof Array&&(t={lng:Number(t[0]),lat:Number(t[1])});var e=y.convertLL2MC(t);return t=y.convertMC2LL(t),e.latLng=t,e},R.prototype._calcGreatCirclePoints=function(t,e){var r=t.latLng,i=e.latLng;if(!m(r.lng,i.lng)||!m(r.lat,i.lat)){var n=y.getDistance(d(r.lng),d(r.lat),d(i.lng),d(i.lat));if(!(25e4>n)){n=Math.round(n/15e4);var a=this._calcAngularDistance(r,i);this.greatCirclePoints.push([t.lng,t.lat]);for(var o=0;o<n;o++){var s=this._calcMiddlePoint(r,i,o/n,a),u=S(s=y.convertLL2MC(s),t);30037726<u&&(s.lng=s.lng<t.lng?s.lng+this.WORLD_SIZE_MC:s.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([s.lng,s.lat]),t=s}30037726<(u=S(e,t))&&(e.lng=e.lng<t.lng?e.lng+this.WORLD_SIZE_MC:e.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([e.lng,e.lat])}}},R.prototype._calcAngularDistance=function(t,e){var r=d(t.lat),i=d(e.lat);return t=d(t.lng),e=d(e.lng),Math.acos(Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos(Math.abs(e-t)))},R.prototype._calcMiddlePoint=function(t,e,r,i){var n=e.lat,a=t.lng;e=e.lng,t=d(t.lat),n=d(n),a=d(a);var o=d(e);return e=Math.sin((1-r)*i)/Math.sin(i),i=Math.sin(r*i)/Math.sin(i),r=e*Math.cos(t)*Math.cos(a)+i*Math.cos(n)*Math.cos(o),a=e*Math.cos(t)*Math.sin(a)+i*Math.cos(n)*Math.sin(o),t=Math.atan2(e*Math.sin(t)+i*Math.sin(n),Math.sqrt(Math.pow(r,2)+Math.pow(a,2))),new _(v(Math.atan2(a,r)),v(t))};var mn=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Ut(this,t),this.options=e,this._initialize()}return Ge(t,[{key:"_initialize",value:function(){this.points=this.options.points}},{key:"_normalizaCoord",value:function(t){return t?(t instanceof Array&&(t={lng:Number(t[0]),lat:Number(t[1])}),y.convertLL2MC(t)):null}},{key:"setOptions",value:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this._initialize()}},{key:"getPoints",value:function(t){for(var e=[],r=this.points,i=0;i<r.length-1;i++){var n=this.getCurveByTwoPoints(this._normalizaCoord(r[i]),this._normalizaCoord(r[i+1]),t);n&&0<n.length&&(e=e.concat(n))}return e}},{key:"getCurveByTwoPoints",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:20;if(!t||!e)return null;var i=[],n=0;if(void 0!==(void 0===e?"undefined":gi(e))){var a=parseFloat(t.lat),o=parseFloat(e.lat),s=parseFloat(t.lng),u=parseFloat(e.lng);u>s&&180<parseFloat(u-s)&&0>s&&(s=parseFloat(360+s),u=parseFloat(360+u));var l=0;if(o===a)var h=0,f=s-u;else u===s?(h=Math.PI/2,f=a-o):(h=Math.atan((o-a)/(u-s)),f=(o-a)/Math.sin(h));for(0===l&&(l=h+Math.PI/5),h=(f/=2)*Math.cos(l)+s,l=f*Math.sin(l)+a,f=0;f<r+1;f++){var c=s*(1-2*n+n*n)+h*(2*n-2*n*n)+u*n*n,d=e.lng;i.push([0>t.lng&&0<d?c-360:c,a*(1-2*n+n*n)+l*(2*n-2*n*n)+o*n*n]),n+=1/r}return i}void 0===i||gi(i)}}]),t}(),xn=[{n:"北京",g:"116.395645,39.929986|12"},{n:"上海",g:"121.487899,31.249162|12"},{n:"天津",g:"117.210813,39.14393|12"},{n:"重庆",g:"106.530635,29.544606|12"}],yn=[{n:"安徽",g:"117.216005,31.859252|8",cities:[{n:"合肥",g:"117.282699,31.866942|12"},{n:"安庆",g:"117.058739,30.537898|13"},{n:"蚌埠",g:"117.35708,32.929499|13"},{n:"亳州",g:"115.787928,33.871211|13"},{n:"巢湖",g:"117.88049,31.608733|13"},{n:"池州",g:"117.494477,30.660019|14"},{n:"滁州",g:"118.32457,32.317351|13"},{n:"阜阳",g:"115.820932,32.901211|13"},{n:"淮北",g:"116.791447,33.960023|13"},{n:"淮南",g:"117.018639,32.642812|13"},{n:"黄山",g:"118.29357,29.734435|13"},{n:"六安",g:"116.505253,31.755558|13"},{n:"马鞍山",g:"118.515882,31.688528|13"},{n:"宿州",g:"116.988692,33.636772|13"},{n:"铜陵",g:"117.819429,30.94093|14"},{n:"芜湖",g:"118.384108,31.36602|12"},{n:"宣城",g:"118.752096,30.951642|13"}]},{n:"福建",g:"117.984943,26.050118|8",cities:[{n:"福州",g:"119.330221,26.047125|12"},{n:"龙岩",g:"117.017997,25.078685|13"},{n:"南平",g:"118.181883,26.643626|13"},{n:"宁德",g:"119.542082,26.656527|14"},{n:"莆田",g:"119.077731,25.44845|13"},{n:"泉州",g:"118.600362,24.901652|12"},{n:"三明",g:"117.642194,26.270835|14"},{n:"厦门",g:"118.103886,24.489231|12"},{n:"漳州",g:"117.676205,24.517065|12"}]},{n:"甘肃",g:"102.457625,38.103267|6",cities:[{n:"兰州",g:"103.823305,36.064226|12"},{n:"白银",g:"104.171241,36.546682|13"},{n:"定西",g:"104.626638,35.586056|13"},{n:"甘南州",g:"102.917442,34.992211|14"},{n:"嘉峪关",g:"98.281635,39.802397|13"},{n:"金昌",g:"102.208126,38.516072|13"},{n:"酒泉",g:"98.508415,39.741474|13"},{n:"临夏州",g:"103.215249,35.598514|13"},{n:"陇南",g:"104.934573,33.39448|14"},{n:"平凉",g:"106.688911,35.55011|13"},{n:"庆阳",g:"107.644227,35.726801|13"},{n:"天水",g:"105.736932,34.584319|13"},{n:"武威",g:"102.640147,37.933172|13"},{n:"张掖",g:"100.459892,38.93932|13"}]},{n:"广东",g:"113.394818,23.408004|8",cities:[{n:"广州",g:"113.30765,23.120049|12"},{n:"潮州",g:"116.630076,23.661812|13"},{n:"东莞",g:"113.763434,23.043024|12"},{n:"佛山",g:"113.134026,23.035095|13"},{n:"河源",g:"114.713721,23.757251|12"},{n:"惠州",g:"114.410658,23.11354|12"},{n:"江门",g:"113.078125,22.575117|13"},{n:"揭阳",g:"116.379501,23.547999|13"},{n:"茂名",g:"110.931245,21.668226|13"},{n:"梅州",g:"116.126403,24.304571|13"},{n:"清远",g:"113.040773,23.698469|13"},{n:"汕头",g:"116.72865,23.383908|13"},{n:"汕尾",g:"115.372924,22.778731|14"},{n:"韶关",g:"113.594461,24.80296|13"},{n:"深圳",g:"114.025974,22.546054|12"},{n:"阳江",g:"111.97701,21.871517|14"},{n:"云浮",g:"112.050946,22.937976|13"},{n:"湛江",g:"110.365067,21.257463|13"},{n:"肇庆",g:"112.479653,23.078663|13"},{n:"中山",g:"113.42206,22.545178|12"},{n:"珠海",g:"113.562447,22.256915|13"}]},{n:"广西",g:"108.924274,23.552255|7",cities:[{n:"南宁",g:"108.297234,22.806493|12"},{n:"百色",g:"106.631821,23.901512|13"},{n:"北海",g:"109.122628,21.472718|13"},{n:"崇左",g:"107.357322,22.415455|14"},{n:"防城港",g:"108.351791,21.617398|15"},{n:"桂林",g:"110.26092,25.262901|12"},{n:"贵港",g:"109.613708,23.103373|13"},{n:"河池",g:"108.069948,24.699521|14"},{n:"贺州",g:"111.552594,24.411054|14"},{n:"来宾",g:"109.231817,23.741166|14"},{n:"柳州",g:"109.422402,24.329053|12"},{n:"钦州",g:"108.638798,21.97335|13"},{n:"梧州",g:"111.305472,23.485395|13"},{n:"玉林",g:"110.151676,22.643974|14"}]},{n:"贵州",g:"106.734996,26.902826|8",cities:[{n:"贵阳",g:"106.709177,26.629907|12"},{n:"安顺",g:"105.92827,26.228595|13"},{n:"毕节地区",g:"105.300492,27.302612|14"},{n:"六盘水",g:"104.852087,26.591866|13"},{n:"铜仁地区",g:"109.196161,27.726271|14"},{n:"遵义",g:"106.93126,27.699961|13"},{n:"黔西南州",g:"104.900558,25.095148|11"},{n:"黔东南州",g:"107.985353,26.583992|11"},{n:"黔南州",g:"107.523205,26.264536|11"}]},{n:"海南",g:"109.733755,19.180501|9",cities:[{n:"海口",g:"110.330802,20.022071|13"},{n:"白沙",g:"109.358586,19.216056|12"},{n:"保亭",g:"109.656113,18.597592|12"},{n:"昌江",g:"109.0113,19.222483|12"},{n:"儋州",g:"109.413973,19.571153|13"},{n:"澄迈",g:"109.996736,19.693135|13"},{n:"东方",g:"108.85101,18.998161|13"},{n:"定安",g:"110.32009,19.490991|13"},{n:"琼海",g:"110.414359,19.21483|13"},{n:"琼中",g:"109.861849,19.039771|12"},{n:"乐东",g:"109.062698,18.658614|12"},{n:"临高",g:"109.724101,19.805922|13"},{n:"陵水",g:"109.948661,18.575985|12"},{n:"三亚",g:"109.522771,18.257776|12"},{n:"屯昌",g:"110.063364,19.347749|13"},{n:"万宁",g:"110.292505,18.839886|13"},{n:"文昌",g:"110.780909,19.750947|13"},{n:"五指山",g:"109.51775,18.831306|13"}]},{n:"河北",g:"115.661434,38.61384|7",cities:[{n:"石家庄",g:"114.522082,38.048958|12"},{n:"保定",g:"115.49481,38.886565|13"},{n:"沧州",g:"116.863806,38.297615|13"},{n:"承德",g:"117.933822,40.992521|14"},{n:"邯郸",g:"114.482694,36.609308|13"},{n:"衡水",g:"115.686229,37.746929|13"},{n:"廊坊",g:"116.703602,39.518611|13"},{n:"秦皇岛",g:"119.604368,39.945462|12"},{n:"唐山",g:"118.183451,39.650531|13"},{n:"邢台",g:"114.520487,37.069531|13"},{n:"张家口",g:"114.893782,40.811188|13"}]},{n:"河南",g:"113.486804,34.157184|7",cities:[{n:"郑州",g:"113.649644,34.75661|12"},{n:"安阳",g:"114.351807,36.110267|12"},{n:"鹤壁",g:"114.29777,35.755426|13"},{n:"焦作",g:"113.211836,35.234608|13"},{n:"开封",g:"114.351642,34.801854|13"},{n:"洛阳",g:"112.447525,34.657368|12"},{n:"漯河",g:"114.046061,33.576279|13"},{n:"南阳",g:"112.542842,33.01142|13"},{n:"平顶山",g:"113.300849,33.745301|13"},{n:"濮阳",g:"115.026627,35.753298|12"},{n:"三门峡",g:"111.181262,34.78332|13"},{n:"商丘",g:"115.641886,34.438589|13"},{n:"新乡",g:"113.91269,35.307258|13"},{n:"信阳",g:"114.085491,32.128582|13"},{n:"许昌",g:"113.835312,34.02674|13"},{n:"周口",g:"114.654102,33.623741|13"},{n:"驻马店",g:"114.049154,32.983158|13"}]},{n:"黑龙江",g:"128.047414,47.356592|6",cities:[{n:"哈尔滨",g:"126.657717,45.773225|12"},{n:"大庆",g:"125.02184,46.596709|12"},{n:"大兴安岭地区",g:"124.196104,51.991789|10"},{n:"鹤岗",g:"130.292472,47.338666|13"},{n:"黑河",g:"127.50083,50.25069|14"},{n:"鸡西",g:"130.941767,45.32154|13"},{n:"佳木斯",g:"130.284735,46.81378|12"},{n:"牡丹江",g:"129.608035,44.588521|13"},{n:"七台河",g:"131.019048,45.775005|14"},{n:"齐齐哈尔",g:"123.987289,47.3477|13"},{n:"双鸭山",g:"131.171402,46.655102|13"},{n:"绥化",g:"126.989095,46.646064|13"},{n:"伊春",g:"128.910766,47.734685|14"}]},{n:"湖北",g:"112.410562,31.209316|8",cities:[{n:"武汉",g:"114.3162,30.581084|12"},{n:"鄂州",g:"114.895594,30.384439|14"},{n:"恩施",g:"109.517433,30.308978|14"},{n:"黄冈",g:"114.906618,30.446109|14"},{n:"黄石",g:"115.050683,30.216127|13"},{n:"荆门",g:"112.21733,31.042611|13"},{n:"荆州",g:"112.241866,30.332591|12"},{n:"潜江",g:"112.768768,30.343116|13"},{n:"神农架林区",g:"110.487231,31.595768|13"},{n:"十堰",g:"110.801229,32.636994|13"},{n:"随州",g:"113.379358,31.717858|13"},{n:"天门",g:"113.12623,30.649047|13"},{n:"仙桃",g:"113.387448,30.293966|13"},{n:"咸宁",g:"114.300061,29.880657|13"},{n:"襄阳",g:"112.176326,32.094934|12"},{n:"孝感",g:"113.935734,30.927955|13"},{n:"宜昌",g:"111.310981,30.732758|13"}]},{n:"湖南",g:"111.720664,27.695864|7",cities:[{n:"长沙",g:"112.979353,28.213478|12"},{n:"常德",g:"111.653718,29.012149|12"},{n:"郴州",g:"113.037704,25.782264|13"},{n:"衡阳",g:"112.583819,26.898164|13"},{n:"怀化",g:"109.986959,27.557483|13"},{n:"娄底",g:"111.996396,27.741073|13"},{n:"邵阳",g:"111.461525,27.236811|13"},{n:"湘潭",g:"112.935556,27.835095|13"},{n:"湘西州",g:"109.745746,28.317951|14"},{n:"益阳",g:"112.366547,28.588088|13"},{n:"永州",g:"111.614648,26.435972|13"},{n:"岳阳",g:"113.146196,29.378007|13"},{n:"张家界",g:"110.48162,29.124889|13"},{n:"株洲",g:"113.131695,27.827433|13"}]},{n:"江苏",g:"119.368489,33.013797|8",cities:[{n:"南京",g:"118.778074,32.057236|12"},{n:"常州",g:"119.981861,31.771397|12"},{n:"淮安",g:"119.030186,33.606513|12"},{n:"连云港",g:"119.173872,34.601549|12"},{n:"南通",g:"120.873801,32.014665|12"},{n:"苏州",g:"120.619907,31.317987|12"},{n:"宿迁",g:"118.296893,33.95205|13"},{n:"泰州",g:"119.919606,32.476053|13"},{n:"无锡",g:"120.305456,31.570037|12"},{n:"徐州",g:"117.188107,34.271553|12"},{n:"盐城",g:"120.148872,33.379862|12"},{n:"扬州",g:"119.427778,32.408505|13"},{n:"镇江",g:"119.455835,32.204409|13"}]},{n:"江西",g:"115.676082,27.757258|7",cities:[{n:"南昌",g:"115.893528,28.689578|12"},{n:"抚州",g:"116.360919,27.954545|13"},{n:"赣州",g:"114.935909,25.845296|13"},{n:"吉安",g:"114.992039,27.113848|13"},{n:"景德镇",g:"117.186523,29.303563|12"},{n:"九江",g:"115.999848,29.71964|13"},{n:"萍乡",g:"113.859917,27.639544|13"},{n:"上饶",g:"117.955464,28.457623|13"},{n:"新余",g:"114.947117,27.822322|13"},{n:"宜春",g:"114.400039,27.81113|13"},{n:"鹰潭",g:"117.03545,28.24131|13"}]},{n:"吉林",g:"126.262876,43.678846|7",cities:[{n:"长春",g:"125.313642,43.898338|12"},{n:"白城",g:"122.840777,45.621086|13"},{n:"白山",g:"126.435798,41.945859|13"},{n:"吉林",g:"126.564544,43.871988|12"},{n:"辽源",g:"125.133686,42.923303|13"},{n:"四平",g:"124.391382,43.175525|12"},{n:"松原",g:"124.832995,45.136049|13"},{n:"通化",g:"125.94265,41.736397|13"},{n:"延边",g:"129.485902,42.896414|13"}]},{n:"辽宁",g:"122.753592,41.6216|8",cities:[{n:"沈阳",g:"123.432791,41.808645|12"},{n:"鞍山",g:"123.007763,41.118744|13"},{n:"本溪",g:"123.778062,41.325838|12"},{n:"朝阳",g:"120.446163,41.571828|13"},{n:"大连",g:"121.593478,38.94871|12"},{n:"丹东",g:"124.338543,40.129023|12"},{n:"抚顺",g:"123.92982,41.877304|12"},{n:"阜新",g:"121.660822,42.01925|14"},{n:"葫芦岛",g:"120.860758,40.74303|13"},{n:"锦州",g:"121.147749,41.130879|13"},{n:"辽阳",g:"123.172451,41.273339|14"},{n:"盘锦",g:"122.073228,41.141248|13"},{n:"铁岭",g:"123.85485,42.299757|13"},{n:"营口",g:"122.233391,40.668651|13"}]},{n:"内蒙古",g:"114.415868,43.468238|5",cities:[{n:"呼和浩特",g:"111.660351,40.828319|12"},{n:"阿拉善盟",g:"105.695683,38.843075|14"},{n:"包头",g:"109.846239,40.647119|12"},{n:"巴彦淖尔",g:"107.423807,40.76918|12"},{n:"赤峰",g:"118.930761,42.297112|12"},{n:"鄂尔多斯",g:"109.993706,39.81649|12"},{n:"呼伦贝尔",g:"119.760822,49.201636|12"},{n:"通辽",g:"122.260363,43.633756|12"},{n:"乌海",g:"106.831999,39.683177|13"},{n:"乌兰察布",g:"113.112846,41.022363|12"},{n:"锡林郭勒盟",g:"116.02734,43.939705|11"},{n:"兴安盟",g:"122.048167,46.083757|11"}]},{n:"宁夏",g:"106.155481,37.321323|8",cities:[{n:"银川",g:"106.206479,38.502621|12"},{n:"固原",g:"106.285268,36.021523|13"},{n:"石嘴山",g:"106.379337,39.020223|13"},{n:"吴忠",g:"106.208254,37.993561|14"},{n:"中卫",g:"105.196754,37.521124|14"}]},{n:"青海",g:"96.202544,35.499761|7",cities:[{n:"西宁",g:"101.767921,36.640739|12"},{n:"果洛州",g:"100.223723,34.480485|11"},{n:"海东地区",g:"102.085207,36.51761|11"},{n:"海北州",g:"100.879802,36.960654|11"},{n:"海南州",g:"100.624066,36.284364|11"},{n:"海西州",g:"97.342625,37.373799|11"},{n:"黄南州",g:"102.0076,35.522852|11"},{n:"玉树州",g:"97.013316,33.00624|14"}]},{n:"山东",g:"118.527663,36.09929|8",cities:[{n:"济南",g:"117.024967,36.682785|12"},{n:"滨州",g:"117.968292,37.405314|12"},{n:"东营",g:"118.583926,37.487121|12"},{n:"德州",g:"116.328161,37.460826|12"},{n:"菏泽",g:"115.46336,35.26244|13"},{n:"济宁",g:"116.600798,35.402122|13"},{n:"莱芜",g:"117.684667,36.233654|13"},{n:"聊城",g:"115.986869,36.455829|12"},{n:"临沂",g:"118.340768,35.072409|12"},{n:"青岛",g:"120.384428,36.105215|12"},{n:"日照",g:"119.50718,35.420225|12"},{n:"泰安",g:"117.089415,36.188078|13"},{n:"威海",g:"122.093958,37.528787|13"},{n:"潍坊",g:"119.142634,36.716115|12"},{n:"烟台",g:"121.309555,37.536562|12"},{n:"枣庄",g:"117.279305,34.807883|13"},{n:"淄博",g:"118.059134,36.804685|12"}]},{n:"山西",g:"112.515496,37.866566|7",cities:[{n:"太原",g:"112.550864,37.890277|12"},{n:"长治",g:"113.120292,36.201664|12"},{n:"大同",g:"113.290509,40.113744|12"},{n:"晋城",g:"112.867333,35.499834|13"},{n:"晋中",g:"112.738514,37.693362|13"},{n:"临汾",g:"111.538788,36.099745|13"},{n:"吕梁",g:"111.143157,37.527316|14"},{n:"朔州",g:"112.479928,39.337672|13"},{n:"忻州",g:"112.727939,38.461031|12"},{n:"阳泉",g:"113.569238,37.869529|13"},{n:"运城",g:"111.006854,35.038859|13"}]},{n:"陕西",g:"109.503789,35.860026|7",cities:[{n:"西安",g:"108.953098,34.2778|12"},{n:"安康",g:"109.038045,32.70437|13"},{n:"宝鸡",g:"107.170645,34.364081|12"},{n:"汉中",g:"107.045478,33.081569|13"},{n:"商洛",g:"109.934208,33.873907|13"},{n:"铜川",g:"108.968067,34.908368|13"},{n:"渭南",g:"109.483933,34.502358|13"},{n:"咸阳",g:"108.707509,34.345373|13"},{n:"延安",g:"109.50051,36.60332|13"},{n:"榆林",g:"109.745926,38.279439|12"}]},{n:"四川",g:"102.89916,30.367481|7",cities:[{n:"成都",g:"104.067923,30.679943|12"},{n:"阿坝州",g:"102.228565,31.905763|15"},{n:"巴中",g:"106.757916,31.869189|14"},{n:"达州",g:"107.494973,31.214199|14"},{n:"德阳",g:"104.402398,31.13114|13"},{n:"甘孜州",g:"101.969232,30.055144|15"},{n:"广安",g:"106.63572,30.463984|13"},{n:"广元",g:"105.819687,32.44104|13"},{n:"乐山",g:"103.760824,29.600958|13"},{n:"凉山州",g:"102.259591,27.892393|14"},{n:"泸州",g:"105.44397,28.89593|14"},{n:"南充",g:"106.105554,30.800965|13"},{n:"眉山",g:"103.84143,30.061115|13"},{n:"绵阳",g:"104.705519,31.504701|12"},{n:"内江",g:"105.073056,29.599462|13"},{n:"攀枝花",g:"101.722423,26.587571|14"},{n:"遂宁",g:"105.564888,30.557491|12"},{n:"雅安",g:"103.009356,29.999716|13"},{n:"宜宾",g:"104.633019,28.769675|13"},{n:"资阳",g:"104.63593,30.132191|13"},{n:"自贡",g:"104.776071,29.359157|13"}]},{n:"西藏",g:"89.137982,31.367315|6",cities:[{n:"拉萨",g:"91.111891,29.662557|13"},{n:"阿里地区",g:"81.107669,30.404557|11"},{n:"昌都地区",g:"97.185582,31.140576|15"},{n:"林芝地区",g:"94.349985,29.666941|11"},{n:"那曲地区",g:"92.067018,31.48068|14"},{n:"日喀则地区",g:"88.891486,29.269023|14"},{n:"山南地区",g:"91.750644,29.229027|11"}]},{n:"新疆",g:"85.614899,42.127001|6",cities:[{n:"乌鲁木齐",g:"87.564988,43.84038|12"},{n:"阿拉尔",g:"81.291737,40.61568|13"},{n:"阿克苏地区",g:"80.269846,41.171731|12"},{n:"阿勒泰地区",g:"88.137915,47.839744|13"},{n:"巴音郭楞",g:"86.121688,41.771362|12"},{n:"博尔塔拉州",g:"82.052436,44.913651|11"},{n:"昌吉州",g:"87.296038,44.007058|13"},{n:"哈密地区",g:"93.528355,42.858596|13"},{n:"和田地区",g:"79.930239,37.116774|13"},{n:"喀什地区",g:"75.992973,39.470627|12"},{n:"克拉玛依",g:"84.88118,45.594331|13"},{n:"克孜勒苏州",g:"76.137564,39.750346|11"},{n:"石河子",g:"86.041865,44.308259|13"},{n:"塔城地区",g:"82.974881,46.758684|12"},{n:"图木舒克",g:"79.198155,39.889223|13"},{n:"吐鲁番地区",g:"89.181595,42.96047|13"},{n:"五家渠",g:"87.565449,44.368899|13"},{n:"伊犁州",g:"81.297854,43.922248|11"}]},{n:"云南",g:"101.592952,24.864213|7",cities:[{n:"昆明",g:"102.714601,25.049153|12"},{n:"保山",g:"99.177996,25.120489|13"},{n:"楚雄州",g:"101.529382,25.066356|13"},{n:"大理州",g:"100.223675,25.5969|14"},{n:"德宏州",g:"98.589434,24.44124|14"},{n:"迪庆州",g:"99.713682,27.831029|14"},{n:"红河州",g:"103.384065,23.367718|11"},{n:"丽江",g:"100.229628,26.875351|13"},{n:"临沧",g:"100.092613,23.887806|14"},{n:"怒江州",g:"98.859932,25.860677|14"},{n:"普洱",g:"100.980058,22.788778|14"},{n:"曲靖",g:"103.782539,25.520758|12"},{n:"昭通",g:"103.725021,27.340633|13"},{n:"文山",g:"104.089112,23.401781|14"},{n:"西双版纳",g:"100.803038,22.009433|13"},{n:"玉溪",g:"102.545068,24.370447|13"}]},{n:"浙江",g:"119.957202,29.159494|8",cities:[{n:"杭州",g:"120.219375,30.259244|12"},{n:"湖州",g:"120.137243,30.877925|12"},{n:"嘉兴",g:"120.760428,30.773992|13"},{n:"金华",g:"119.652576,29.102899|12"},{n:"丽水",g:"119.929576,28.4563|13"},{n:"宁波",g:"121.579006,29.885259|12"},{n:"衢州",g:"118.875842,28.95691|12"},{n:"绍兴",g:"120.592467,30.002365|13"},{n:"台州",g:"121.440613,28.668283|13"},{n:"温州",g:"120.690635,28.002838|12"},{n:"舟山",g:"122.169872,30.03601|13"}]}],bn=[{n:"香港",g:"114.186124,22.293586|11"},{n:"澳门",g:"113.557519,22.204118|13"},{n:"台湾",g:"120.961454,23.80406|8"}],_n=void 0,An=function(){if(void 0!==_n)return _n;var t=navigator.userAgent,e="Android;iPhone;SymbianOS;Windows Phone;iPad;iPod".split(";");_n=!1;for(var r=0;r<e.length;r++)if(0<t.indexOf(e[r])){_n=!0;break}return _n}(),Tn=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),wn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Mn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Cn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rn=Array(576);E(Rn);var Sn=Array(60);E(Sn);var Pn=Array(512);E(Pn);var En=Array(256);E(En);var Ln=Array(29);E(Ln);var Fn=Array(30);E(Fn);var Dn=void 0,Bn=void 0,On=void 0,kn=function(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},zn=function(t,e,r){t.bi_valid>16-r?(t.bi_buf|=e<<t.bi_valid&65535,kn(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},In=function(t,e,r){zn(t,r[2*e],r[2*e+1])},Un=function(t,e){var r=0;do{r|=1&t,t>>>=1,r<<=1}while(0<--e);return r>>>1},Nn=function(t,e,r){var i,n=Array(16),a=0;for(i=1;15>=i;i++)n[i]=a=a+r[i-1]<<1;for(r=0;r<=e;r++)0!==(a=t[2*r+1])&&(t[2*r]=Un(n[a]++,a))},Hn=function(t){var e;for(e=0;286>e;e++)t.dyn_ltree[2*e]=0;for(e=0;30>e;e++)t.dyn_dtree[2*e]=0;for(e=0;19>e;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},jn=function(t){8<t.bi_valid?kn(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Xn=function(t,e,r,i){var n=2*e,a=2*r;return t[n]<t[a]||t[n]===t[a]&&i[e]<=i[r]},Wn=function(t,e,r){for(var i=t.heap[r],n=r<<1;n<=t.heap_len&&(n<t.heap_len&&Xn(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!Xn(e,i,t.heap[n],t.depth));)t.heap[r]=t.heap[n],r=n,n<<=1;t.heap[r]=i},Yn=function(t,e,r){var i=0;if(0!==t.last_lit)do{var n=t.pending_buf[t.d_buf+2*i]<<8|t.pending_buf[t.d_buf+2*i+1],a=t.pending_buf[t.l_buf+i];if(i++,0===n)In(t,a,e);else{var o=En[a];In(t,o+256+1,e);var s=Tn[o];0!==s&&(a-=Ln[o],zn(t,a,s)),o=256>--n?Pn[n]:Pn[256+(n>>>7)],In(t,o,r),0!==(s=wn[o])&&(n-=Fn[o],zn(t,n,s))}}while(i<t.last_lit);In(t,256,e)},Zn=function(t,e){var r,i=e.dyn_tree,n=e.stat_desc.static_tree,a=e.stat_desc.has_stree,o=e.stat_desc.elems,s=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<o;r++)0!==i[2*r]?(t.heap[++t.heap_len]=s=r,t.depth[r]=0):i[2*r+1]=0;for(;2>t.heap_len;){var u=t.heap[++t.heap_len]=2>s?++s:0;i[2*u]=1,t.depth[u]=0,t.opt_len--,a&&(t.static_len-=n[2*u+1])}for(e.max_code=s,r=t.heap_len>>1;1<=r;r--)Wn(t,i,r);u=o;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Wn(t,i,1),n=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=n,i[2*u]=i[2*r]+i[2*n],t.depth[u]=(t.depth[r]>=t.depth[n]?t.depth[r]:t.depth[n])+1,i[2*r+1]=i[2*n+1]=u,t.heap[1]=u++,Wn(t,i,1)}while(2<=t.heap_len);t.heap[--t.heap_max]=t.heap[1],r=e.dyn_tree,u=e.max_code,n=e.stat_desc.static_tree,a=e.stat_desc.has_stree,o=e.stat_desc.extra_bits;var l,h=e.stat_desc.extra_base,f=e.stat_desc.max_length,c=0;for(l=0;15>=l;l++)t.bl_count[l]=0;for(r[2*t.heap[t.heap_max]+1]=0,e=t.heap_max+1;573>e;e++){var d=t.heap[e];if((l=r[2*r[2*d+1]+1]+1)>f&&(l=f,c++),r[2*d+1]=l,!(d>u)){t.bl_count[l]++;var v=0;d>=h&&(v=o[d-h]);var p=r[2*d];t.opt_len+=p*(l+v),a&&(t.static_len+=p*(n[2*d+1]+v))}}if(0!==c){do{for(l=f-1;0===t.bl_count[l];)l--;t.bl_count[l]--,t.bl_count[l+1]+=2,t.bl_count[f]--,c-=2}while(0<c);for(l=f;0!==l;l--)for(d=t.bl_count[l];0!==d;)(n=t.heap[--e])>u||(r[2*n+1]!==l&&(t.opt_len+=(l-r[2*n+1])*r[2*n],r[2*n+1]=l),d--)}Nn(i,s,t.bl_count)},Vn=function(t,e,r){var i,n=-1,a=e[1],o=0,s=7,u=4;for(0===a&&(s=138,u=3),e[2*(r+1)+1]=65535,i=0;i<=r;i++){var l=a;a=e[2*(i+1)+1],++o<s&&l===a||(o<u?t.bl_tree[2*l]+=o:0!==l?(l!==n&&t.bl_tree[2*l]++,t.bl_tree[32]++):10>=o?t.bl_tree[34]++:t.bl_tree[36]++,o=0,n=l,0===a?(s=138,u=3):l===a?(s=6,u=3):(s=7,u=4))}},Gn=function(t,e,r){var i,n=-1,a=e[1],o=0,s=7,u=4;for(0===a&&(s=138,u=3),i=0;i<=r;i++){var l=a;if(a=e[2*(i+1)+1],!(++o<s&&l===a)){if(o<u)do{In(t,l,t.bl_tree)}while(0!=--o);else 0!==l?(l!==n&&(In(t,l,t.bl_tree),o--),In(t,16,t.bl_tree),zn(t,o-3,2)):10>=o?(In(t,17,t.bl_tree),zn(t,o-3,3)):(In(t,18,t.bl_tree),zn(t,o-11,7));o=0,n=l,0===a?(s=138,u=3):l===a?(s=6,u=3):(s=7,u=4)}}},qn=function(t){var e,r=4093624447;for(e=0;31>=e;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;256>e;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0},Kn=!1,Qn=function(t,e,r,i){zn(t,i?1:0,3),jn(t),kn(t,r),kn(t,~r),t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},Jn=function(t,e,r,i){var n,a=65535&t|0;for(t=t>>>16&65535|0;0!==r;){r-=n=2e3<r?2e3:r;do{t=t+(a=a+e[i++]|0)|0}while(--n);a%=65521,t%=65521}return a|t<<16|0},$n=new Uint32Array(function(){for(var t,e=[],r=0;256>r;r++){t=r;for(var i=0;8>i;i++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}()),ta=function(t,e,r,i){for(r=i+r,t^=-1;i<r;i++)t=t>>>8^$n[255&(t^e[i])];return-1^t},ea={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ra={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},ia=function(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(En[r]+256+1)]++,t.dyn_dtree[2*(256>e?Pn[e]:Pn[256+(e>>>7)])]++),t.last_lit===t.lit_bufsize-1},na=ra.Z_NO_FLUSH,aa=ra.Z_PARTIAL_FLUSH,oa=ra.Z_FULL_FLUSH,sa=ra.Z_FINISH,ua=ra.Z_BLOCK,la=ra.Z_OK,ha=ra.Z_STREAM_END,fa=ra.Z_STREAM_ERROR,ca=ra.Z_DATA_ERROR,da=ra.Z_BUF_ERROR,va=ra.Z_DEFAULT_COMPRESSION,pa=ra.Z_FILTERED,ga=ra.Z_HUFFMAN_ONLY,ma=ra.Z_RLE,xa=ra.Z_FIXED,ya=ra.Z_DEFAULT_STRATEGY,ba=ra.Z_UNKNOWN,_a=ra.Z_DEFLATED,Aa=function(t,e){return t.msg=ea[e],e},Ta=function(t){for(var e=t.length;0<=--e;)t[e]=0},wa=function(t,e,r){return(e<<t.hash_shift^r)&t.hash_mask},Ma=function(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))},Ca=function(t,e){var r=0<=t.block_start?t.block_start:-1,i=t.strstart-t.block_start,n=0;if(0<t.level){for(2===t.strm.data_type&&(t.strm.data_type=qn(t)),Zn(t,t.l_desc),Zn(t,t.d_desc),Vn(t,t.dyn_ltree,t.l_desc.max_code),Vn(t,t.dyn_dtree,t.d_desc.max_code),Zn(t,t.bl_desc),n=18;3<=n&&0===t.bl_tree[2*Cn[n]+1];n--);t.opt_len+=3*(n+1)+14;var a=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3;o<=a&&(a=o)}else a=o=i+5;if(i+4<=a&&-1!==r)Qn(t,r,i,e);else if(4===t.strategy||o===a)zn(t,2+(e?1:0),3),Yn(t,Rn,Sn);else{for(zn(t,4+(e?1:0),3),r=t.l_desc.max_code+1,i=t.d_desc.max_code+1,n+=1,zn(t,r-257,5),zn(t,i-1,5),zn(t,n-4,4),a=0;a<n;a++)zn(t,t.bl_tree[2*Cn[a]+1],3);Gn(t,t.dyn_ltree,r-1),Gn(t,t.dyn_dtree,i-1),Yn(t,t.dyn_ltree,t.dyn_dtree)}Hn(t),e&&jn(t),t.block_start=t.strstart,Ma(t.strm)},Ra=function(t,e){t.pending_buf[t.pending++]=e},Sa=function(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Pa=function(t,e){var r=t.max_chain_length,i=t.strstart,n=t.prev_length,a=t.nice_match,o=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,s=t.window,u=t.w_mask,l=t.prev,h=t.strstart+258,f=s[i+n-1],c=s[i+n];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do{var d=e;if(s[d+n]===c&&s[d+n-1]===f&&s[d]===s[i]&&s[++d]===s[i+1]){for(i+=2,d++;s[++i]===s[++d]&&s[++i]===s[++d]&&s[++i]===s[++d]&&s[++i]===s[++d]&&s[++i]===s[++d]&&s[++i]===s[++d]&&s[++i]===s[++d]&&s[++i]===s[++d]&&i<h;);if(d=258-(h-i),i=h-258,d>n){if(t.match_start=e,n=d,d>=a)break;f=s[i+n-1],c=s[i+n]}}}while((e=l[e&u])>o&&0!=--r);return n<=t.lookahead?n:t.lookahead},Ea=function(t){var e,r=t.w_size;do{var i=t.window_size-t.lookahead-t.strstart;if(t.strstart>=r+(r-262)){t.window.set(t.window.subarray(r,r+r),0),t.match_start-=r,t.strstart-=r,t.block_start-=r;var n=e=t.hash_size;do{var a=t.head[--n];t.head[n]=a>=r?a-r:0}while(--e);n=e=r;do{a=t.prev[--n],t.prev[n]=a>=r?a-r:0}while(--e);i+=r}if(0===t.strm.avail_in)break;n=t.strm,e=t.window,a=t.strstart+t.lookahead;var o=n.avail_in;if(o>i&&(o=i),0===o?e=0:(n.avail_in-=o,e.set(n.input.subarray(n.next_in,n.next_in+o),a),1===n.state.wrap?n.adler=Jn(n.adler,e,o,a):2===n.state.wrap&&(n.adler=ta(n.adler,e,o,a)),n.next_in+=o,n.total_in+=o,e=o),t.lookahead+=e,3<=t.lookahead+t.insert)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=wa(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=wa(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(3>t.lookahead+t.insert)););}while(262>t.lookahead&&0!==t.strm.avail_in)},La=function(t,e){for(var r;;){if(262>t.lookahead){if(Ea(t),262>t.lookahead&&e===na)return 1;if(0===t.lookahead)break}if(r=0,3<=t.lookahead&&(t.ins_h=wa(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-262&&(t.match_length=Pa(t,r)),3<=t.match_length)if(r=ia(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&3<=t.lookahead){t.match_length--;do{t.strstart++,t.ins_h=wa(t,t.ins_h,t.window[t.strstart+3-1]),t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=wa(t,t.ins_h,t.window[t.strstart+1]);else r=ia(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Ca(t,!1),0===t.strm.avail_out))return 1}return t.insert=2>t.strstart?t.strstart:2,e===sa?(Ca(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ca(t,!1),0===t.strm.avail_out)?1:2},Fa=function(t,e){for(var r,i;;){if(262>t.lookahead){if(Ea(t),262>t.lookahead&&e===na)return 1;if(0===t.lookahead)break}if(r=0,3<=t.lookahead&&(t.ins_h=wa(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-262&&(t.match_length=Pa(t,r),5>=t.match_length&&(t.strategy===pa||3===t.match_length&&4096<t.strstart-t.match_start)&&(t.match_length=2)),3<=t.prev_length&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=ia(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=wa(t,t.ins_h,t.window[t.strstart+3-1]),t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(Ca(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((r=ia(t,0,t.window[t.strstart-1]))&&Ca(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(ia(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=2>t.strstart?t.strstart:2,e===sa?(Ca(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ca(t,!1),0===t.strm.avail_out)?1:2},Da=function(t,e){for(var r,i,n,a=t.window;;){if(258>=t.lookahead){if(Ea(t),258>=t.lookahead&&e===na)return 1;if(0===t.lookahead)break}if(t.match_length=0,3<=t.lookahead&&0<t.strstart&&(r=a[i=t.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i]){for(n=t.strstart+258;r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<n;);t.match_length=258-(n-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(3<=t.match_length?(r=ia(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=ia(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(Ca(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===sa?(Ca(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ca(t,!1),0===t.strm.avail_out)?1:2},Ba=function(t,e){for(var r;;){if(0===t.lookahead&&(Ea(t),0===t.lookahead)){if(e===na)return 1;break}if(t.match_length=0,r=ia(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(Ca(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===sa?(Ca(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ca(t,!1),0===t.strm.avail_out)?1:2},Oa=[new D(0,0,0,0,(function(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(1>=t.lookahead){if(Ea(t),0===t.lookahead&&e===na)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+r;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,Ca(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(Ca(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===sa?(Ca(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&Ca(t,!1),1)})),new D(4,4,8,4,La),new D(4,5,16,8,La),new D(4,6,32,32,La),new D(4,4,16,16,Fa),new D(8,16,32,32,Fa),new D(8,16,128,128,Fa),new D(8,32,128,256,Fa),new D(32,128,258,1024,Fa),new D(32,258,258,4096,Fa)],ka=function(t){if(!t||!t.state)return Aa(t,fa);t.total_in=t.total_out=0,t.data_type=ba;var e=t.state;if(e.pending=0,e.pending_out=0,0>e.wrap&&(e.wrap=-e.wrap),e.status=e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=na,!Kn){var r,i,n;for(t=Array(16),n=i=0;28>n;n++)for(Ln[n]=i,r=0;r<1<<Tn[n];r++)En[i++]=n;for(En[i-1]=n,n=i=0;16>n;n++)for(Fn[n]=i,r=0;r<1<<wn[n];r++)Pn[i++]=n;for(i>>=7;30>n;n++)for(Fn[n]=i<<7,r=0;r<1<<wn[n]-7;r++)Pn[256+i++]=n;for(r=0;15>=r;r++)t[r]=0;for(r=0;143>=r;)Rn[2*r+1]=8,r++,t[8]++;for(;255>=r;)Rn[2*r+1]=9,r++,t[9]++;for(;279>=r;)Rn[2*r+1]=7,r++,t[7]++;for(;287>=r;)Rn[2*r+1]=8,r++,t[8]++;for(Nn(Rn,287,t),r=0;30>r;r++)Sn[2*r+1]=5,Sn[2*r]=Un(r,5);Dn=new L(Rn,Tn,257,286,15),Bn=new L(Sn,wn,0,30,15),On=new L([],Mn,0,19,7),Kn=!0}return e.l_desc=new F(e.dyn_ltree,Dn),e.d_desc=new F(e.dyn_dtree,Bn),e.bl_desc=new F(e.bl_tree,On),e.bi_buf=0,e.bi_valid=0,Hn(e),la},za=function(t){var e=ka(t);return e===la&&((t=t.state).window_size=2*t.w_size,Ta(t.head),t.max_lazy_match=Oa[t.level].max_lazy,t.good_match=Oa[t.level].good_length,t.nice_match=Oa[t.level].nice_length,t.max_chain_length=Oa[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),e},Ia=function(t,e,r,i,n,a){if(!t)return fa;var o=1;if(e===va&&(e=6),0>i?(o=0,i=-i):15<i&&(o=2,i-=16),1>n||9<n||r!==_a||8>i||15<i||0>e||9<e||0>a||a>xa)return Aa(t,fa);8===i&&(i=9);var s=new B;return t.state=s,s.strm=t,s.wrap=o,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=e,s.strategy=a,s.method=r,za(t)},Ua={deflateInit:function(t,e){return Ia(t,e,_a,15,8,ya)},deflateInit2:Ia,deflateReset:za,deflateResetKeep:ka,deflateSetHeader:function(t,e){return t&&t.state&&2===t.state.wrap?(t.state.gzhead=e,la):fa},deflate:function(t,e){if(!t||!t.state||e>ua||0>e)return t?Aa(t,fa):fa;var r=t.state;if(!t.output||!t.input&&0!==t.avail_in||666===r.status&&e!==sa)return Aa(t,0===t.avail_out?da:fa);r.strm=t;var i=r.last_flush;if(r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,Ra(r,31),Ra(r,139),Ra(r,8),r.gzhead?(Ra(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Ra(r,255&r.gzhead.time),Ra(r,r.gzhead.time>>8&255),Ra(r,r.gzhead.time>>16&255),Ra(r,r.gzhead.time>>24&255),Ra(r,9===r.level?2:r.strategy>=ga||2>r.level?4:0),Ra(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Ra(r,255&r.gzhead.extra.length),Ra(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=ta(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Ra(r,0),Ra(r,0),Ra(r,0),Ra(r,0),Ra(r,0),Ra(r,9===r.level?2:r.strategy>=ga||2>r.level?4:0),Ra(r,3),r.status=113);else{var n=_a+(r.w_bits-8<<4)<<8;n|=(r.strategy>=ga||2>r.level?0:6>r.level?1:6===r.level?2:3)<<6,0!==r.strstart&&(n|=32),r.status=113,Sa(r,n+(31-n%31)),0!==r.strstart&&(Sa(r,t.adler>>>16),Sa(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(t.adler=ta(t.adler,r.pending_buf,r.pending-n,n)),Ma(t),n=r.pending,r.pending!==r.pending_buf_size));)Ra(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(t.adler=ta(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=ta(t.adler,r.pending_buf,r.pending-n,n)),Ma(t),n=r.pending,r.pending===r.pending_buf_size)){var a=1;break}a=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Ra(r,a)}while(0!==a);r.gzhead.hcrc&&r.pending>n&&(t.adler=ta(t.adler,r.pending_buf,r.pending-n,n)),0===a&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=ta(t.adler,r.pending_buf,r.pending-n,n)),Ma(t),n=r.pending,r.pending===r.pending_buf_size)){a=1;break}a=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Ra(r,a)}while(0!==a);r.gzhead.hcrc&&r.pending>n&&(t.adler=ta(t.adler,r.pending_buf,r.pending-n,n)),0===a&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Ma(t),r.pending+2<=r.pending_buf_size&&(Ra(r,255&t.adler),Ra(r,t.adler>>8&255),t.adler=0,r.status=113)):r.status=113),0!==r.pending){if(Ma(t),0===t.avail_out)return r.last_flush=-1,la}else if(0===t.avail_in&&(e<<1)-(4<e?9:0)<=(i<<1)-(4<i?9:0)&&e!==sa)return Aa(t,da);if(666===r.status&&0!==t.avail_in)return Aa(t,da);if(0!==t.avail_in||0!==r.lookahead||e!==na&&666!==r.status){if(3!==(i=r.strategy===ga?Ba(r,e):r.strategy===ma?Da(r,e):Oa[r.level].func(r,e))&&4!==i||(r.status=666),1===i||3===i)return 0===t.avail_out&&(r.last_flush=-1),la;if(2===i&&(e===aa?(zn(r,2,3),In(r,256,Rn),16===r.bi_valid?(kn(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):8<=r.bi_valid&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)):e!==ua&&(Qn(r,0,0,!1),e===oa&&(Ta(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Ma(t),0===t.avail_out))return r.last_flush=-1,la}return e!==sa?la:0>=r.wrap?ha:(2===r.wrap?(Ra(r,255&t.adler),Ra(r,t.adler>>8&255),Ra(r,t.adler>>16&255),Ra(r,t.adler>>24&255),Ra(r,255&t.total_in),Ra(r,t.total_in>>8&255),Ra(r,t.total_in>>16&255),Ra(r,t.total_in>>24&255)):(Sa(r,t.adler>>>16),Sa(r,65535&t.adler)),Ma(t),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?la:ha)},deflateEnd:function(t){if(!t||!t.state)return fa;var e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&103!==e&&113!==e&&666!==e?Aa(t,fa):(t.state=null,113===e?Aa(t,ca):la)},deflateSetDictionary:function(t,e){var r=e.length;if(!t||!t.state)return fa;var i=t.state,n=i.wrap;if(2===n||1===n&&42!==i.status||i.lookahead)return fa;if(1===n&&(t.adler=Jn(t.adler,e,r,0)),i.wrap=0,r>=i.w_size){0===n&&(Ta(i.head),i.strstart=0,i.block_start=0,i.insert=0);var a=new Uint8Array(i.w_size);a.set(e.subarray(r-i.w_size,r),0),e=a,r=i.w_size}a=t.avail_in;var o=t.next_in,s=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Ea(i);3<=i.lookahead;){e=i.strstart,r=i.lookahead-2;do{i.ins_h=wa(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--r);i.strstart=e,i.lookahead=2,Ea(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=o,t.input=s,t.avail_in=a,i.wrap=n,la},deflateInfo:"pako deflate (from Nodeca project)"},Na={assign:function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!==(void 0===r?"undefined":gi(r)))throw new TypeError(r+"must be non-object");for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}}return t},flattenChunks:function(t){for(var e=0,r=0,i=t.length;r<i;r++)e+=t[r].length;e=new Uint8Array(e),i=r=0;for(var n=t.length;r<n;r++){var a=t[r];e.set(a,i),i+=a.length}return e}},Ha=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(It){Ha=!1}for(var ja=new Uint8Array(256),Xa=0;256>Xa;Xa++)ja[Xa]=252<=Xa?6:248<=Xa?5:240<=Xa?4:224<=Xa?3:192<=Xa?2:1;ja[254]=ja[254]=1;var Wa={string2buf:function(t){var e,r,i=t.length,n=0;for(e=0;e<i;e++){var a=t.charCodeAt(e);if(55296==(64512&a)&&e+1<i){var o=t.charCodeAt(e+1);56320==(64512&o)&&(a=65536+(a-55296<<10)+(o-56320),e++)}n+=128>a?1:2048>a?2:65536>a?3:4}var s=new Uint8Array(n);for(e=r=0;r<n;e++)55296==(64512&(a=t.charCodeAt(e)))&&e+1<i&&56320==(64512&(o=t.charCodeAt(e+1)))&&(a=65536+(a-55296<<10)+(o-56320),e++),128>a?s[r++]=a:(2048>a?s[r++]=192|a>>>6:(65536>a?s[r++]=224|a>>>12:(s[r++]=240|a>>>18,s[r++]=128|a>>>12&63),s[r++]=128|a>>>6&63),s[r++]=128|63&a);return s},buf2string:function(t,e){var r,i,n=e||t.length;for(e=Array(2*n),r=i=0;r<n;){var a=t[r++];if(128>a)e[i++]=a;else{var o=ja[a];if(4<o)e[i++]=65533,r+=o-1;else{for(a&=2===o?31:3===o?15:7;1<o&&r<n;)a=a<<6|63&t[r++],o--;1<o?e[i++]=65533:65536>a?e[i++]=a:(a-=65536,e[i++]=55296|a>>10&1023,e[i++]=56320|1023&a)}}}if(65534>(t=i)&&e.subarray&&Ha)e=String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));else{for(r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);e=r}return e},utf8border:function(t,e){(e=e||t.length)>t.length&&(e=t.length);for(var r=e-1;0<=r&&128==(192&t[r]);)r--;return 0>r||0===r?e:r+ja[t[r]]>e?r:e}},Ya=function(){this.input=null,this.total_in=this.avail_in=this.next_in=0,this.output=null,this.total_out=this.avail_out=this.next_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Za=Object.prototype.toString,Va=ra.Z_NO_FLUSH,Ga=ra.Z_SYNC_FLUSH,qa=ra.Z_FULL_FLUSH,Ka=ra.Z_FINISH,Qa=ra.Z_OK,Ja=ra.Z_STREAM_END,$a=ra.Z_DEFAULT_COMPRESSION,to=ra.Z_DEFAULT_STRATEGY,eo=ra.Z_DEFLATED;O.prototype.push=function(t,e){var r=this.strm,i=this.options.chunkSize;if(this.ended)return!1;for(e=e===~~e?e:!0===e?Ka:Va,"string"==typeof t?r.input=Wa.string2buf(t):"[object ArrayBuffer]"===Za.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(e===Ga||e===qa)&&6>=r.avail_out)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if((t=Ua.deflate(r,e))===Ja)return 0<r.next_out&&this.onData(r.output.subarray(0,r.next_out)),t=Ua.deflateEnd(this.strm),this.onEnd(t),this.ended=!0,t===Qa;if(0===r.avail_out)this.onData(r.output);else if(0<e&&0<r.next_out)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}return!0},O.prototype.onData=function(t){this.chunks.push(t)},O.prototype.onEnd=function(t){t===Qa&&(this.result=Na.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var ro=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),io=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),no=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ao=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),oo=function(t,e,r,i,n,a,o,s){var u,l,h,f,c,d,v,p=s.bits,g=0,m=new Uint16Array(16),x=new Uint16Array(16),y=0;for(u=0;15>=u;u++)m[u]=0;for(l=0;l<i;l++)m[e[r+l]]++;var b=p;for(h=15;1<=h&&0===m[h];h--);if(b>h&&(b=h),0===h)return n[a++]=20971520,n[a++]=20971520,s.bits=1,0;for(p=1;p<h&&0===m[p];p++);for(b<p&&(b=p),u=f=1;15>=u;u++)if(f<<=1,0>(f-=m[u]))return-1;if(0<f&&(0===t||1!==h))return-1;for(x[1]=0,u=1;15>u;u++)x[u+1]=x[u]+m[u];for(l=0;l<i;l++)0!==e[r+l]&&(o[x[e[r+l]]++]=l);if(0===t)var _=v=o,A=19;else 1===t?(_=ro,g-=257,v=io,y-=257,A=256):(_=no,v=ao,A=-1);l=c=0,u=p;var T=a;i=b,x=0;var w=-1,M=1<<b,C=M-1;if(1===t&&852<M||2===t&&592<M)return 1;for(;;){var R=u-x;if(o[l]<A)var S=0,P=o[l];else o[l]>A?(S=v[y+o[l]],P=_[g+o[l]]):(S=96,P=0);f=1<<u-x,p=d=1<<i;do{n[T+(c>>x)+(d-=f)]=R<<24|S<<16|P|0}while(0!==d);for(f=1<<u-1;c&f;)f>>=1;if(0!==f?(c&=f-1,c+=f):c=0,l++,0==--m[u]){if(u===h)break;u=e[r+o[l]]}if(u>b&&(c&C)!==w){for(0===x&&(x=b),T+=p,f=1<<(i=u-x);i+x<h&&!(0>=(f-=m[i+x]));)i++,f<<=1;if(M+=1<<i,1===t&&852<M||2===t&&592<M)return 1;n[w=c&C]=b<<24|i<<16|T-a|0}}return 0!==c&&(n[T+c]=u-x<<24|4194304),s.bits=b,0},so=ra.Z_FINISH,uo=ra.Z_BLOCK,lo=ra.Z_TREES,ho=ra.Z_OK,fo=ra.Z_STREAM_END,co=ra.Z_NEED_DICT,vo=ra.Z_STREAM_ERROR,po=ra.Z_DATA_ERROR,go=ra.Z_MEM_ERROR,mo=ra.Z_BUF_ERROR,xo=ra.Z_DEFLATED,yo=function(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)},bo=function(t){if(!t||!t.state)return vo;var e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,ho},_o=function(t){if(!t||!t.state)return vo;var e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,bo(t)},Ao=function(t,e){if(!t||!t.state)return vo;var r=t.state;if(0>e){var i=0;e=-e}else i=1+(e>>4),48>e&&(e&=15);return e&&(8>e||15<e)?vo:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=i,r.wbits=e,_o(t))},To=function(t,e){if(!t)return vo;var r=new z;return t.state=r,r.window=null,(e=Ao(t,e))!==ho&&(t.state=null),e},wo=!0,Mo=void 0,Co=void 0,Ro=function(t,e,r,i){var n=t.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),i>=n.wsize?(n.window.set(e.subarray(r-n.wsize,r),0),n.wnext=0,n.whave=n.wsize):((t=n.wsize-n.wnext)>i&&(t=i),n.window.set(e.subarray(r-i,r-i+t),n.wnext),(i-=t)?(n.window.set(e.subarray(r-i,r),0),n.wnext=i,n.whave=n.wsize):(n.wnext+=t,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=t))),0},So={inflateReset:_o,inflateReset2:Ao,inflateResetKeep:bo,inflateInit:function(t){return To(t,15)},inflateInit2:To,inflate:function(t,e){var r=new Uint8Array(4),i=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return vo;var n=t.state;12===n.mode&&(n.mode=13);var a=t.next_out,o=t.output,s=t.avail_out,u=t.next_in,l=t.input,h=t.avail_in,f=n.hold,c=n.bits,d=h,v=s,p=ho;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(2&n.wrap&&35615===f){n.check=0,r[0]=255&f,r[1]=f>>>8&255,n.check=ta(n.check,r,2,0),c=f=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){t.msg="incorrect header check",n.mode=30;break}if((15&f)!==xo){t.msg="unknown compression method",n.mode=30;break}c-=4;var g=8+(15&(f>>>=4));if(0===n.wbits)n.wbits=g;else if(g>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<n.wbits,t.adler=n.check=1,n.mode=512&f?10:12,c=f=0;break;case 2:for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(n.flags=f,(255&n.flags)!==xo){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=f>>8&1),512&n.flags&&(r[0]=255&f,r[1]=f>>>8&255,n.check=ta(n.check,r,2,0)),c=f=0,n.mode=3;case 3:for(;32>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}n.head&&(n.head.time=f),512&n.flags&&(r[0]=255&f,r[1]=f>>>8&255,r[2]=f>>>16&255,r[3]=f>>>24&255,n.check=ta(n.check,r,4,0)),c=f=0,n.mode=4;case 4:for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&n.flags&&(r[0]=255&f,r[1]=f>>>8&255,n.check=ta(n.check,r,2,0)),c=f=0,n.mode=5;case 5:if(1024&n.flags){for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}n.length=f,n.head&&(n.head.extra_len=f),512&n.flags&&(r[0]=255&f,r[1]=f>>>8&255,n.check=ta(n.check,r,2,0)),c=f=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags){var m=n.length;if(m>h&&(m=h),m&&(n.head&&(g=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(l.subarray(u,u+m),g)),512&n.flags&&(n.check=ta(n.check,l,m,u)),h-=m,u+=m,n.length-=m),n.length)break t}n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===h)break t;m=0;do{g=l[u+m++],n.head&&g&&65536>n.length&&(n.head.name+=String.fromCharCode(g))}while(g&&m<h);if(512&n.flags&&(n.check=ta(n.check,l,m,u)),h-=m,u+=m,g)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===h)break t;m=0;do{g=l[u+m++],n.head&&g&&65536>n.length&&(n.head.comment+=String.fromCharCode(g))}while(g&&m<h);if(512&n.flags&&(n.check=ta(n.check,l,m,u)),h-=m,u+=m,g)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;16>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(f!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}c=f=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;32>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}t.adler=n.check=yo(f),c=f=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=a,t.avail_out=s,t.next_in=u,t.avail_in=h,n.hold=f,n.bits=c,co;t.adler=n.check=1,n.mode=12;case 12:if(e===uo||e===lo)break t;case 13:if(n.last){f>>>=7&c,c-=7&c,n.mode=27;break}for(;3>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}switch(n.last=1&f,--c,3&(f>>>=1)){case 0:n.mode=14;break;case 1:if(m=n,wo){for(Mo=new Int32Array(512),Co=new Int32Array(32),g=0;144>g;)m.lens[g++]=8;for(;256>g;)m.lens[g++]=9;for(;280>g;)m.lens[g++]=7;for(;288>g;)m.lens[g++]=8;for(oo(1,m.lens,0,288,Mo,0,m.work,{bits:9}),g=0;32>g;)m.lens[g++]=5;oo(2,m.lens,0,32,Co,0,m.work,{bits:5}),wo=!1}if(m.lencode=Mo,m.lenbits=9,m.distcode=Co,m.distbits=5,n.mode=20,e===lo){f>>>=2,c-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}f>>>=2,c-=2;break;case 14:for(f>>>=7&c,c-=7&c;32>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if((65535&f)!=(f>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&f,c=f=0,n.mode=15,e===lo)break t;case 15:n.mode=16;case 16:if(m=n.length){if(m>h&&(m=h),m>s&&(m=s),0===m)break t;o.set(l.subarray(u,u+m),a),h-=m,u+=m,s-=m,a+=m,n.length-=m;break}n.mode=12;break;case 17:for(;14>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(n.nlen=257+(31&f),f>>>=5,c-=5,n.ndist=1+(31&f),f>>>=5,c-=5,n.ncode=4+(15&f),f>>>=4,c-=4,286<n.nlen||30<n.ndist){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;3>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}n.lens[i[n.have++]]=7&f,f>>>=3,c-=3}for(;19>n.have;)n.lens[i[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,m={bits:n.lenbits},p=oo(0,n.lens,0,19,n.lencode,0,n.work,m),n.lenbits=m.bits,p){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;;){var x=n.lencode[f&(1<<n.lenbits)-1];if(m=x>>>24,x&=65535,m<=c)break;if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(16>x)f>>>=m,c-=m,n.lens[n.have++]=x;else{if(16===x){for(g=m+2;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(f>>>=m,c-=m,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}g=n.lens[n.have-1],m=3+(3&f),f>>>=2,c-=2}else if(17===x){for(g=m+3;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}c-=m,g=0,m=3+(7&(f>>>=m)),f>>>=3,c-=3}else{for(g=m+7;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}c-=m,g=0,m=11+(127&(f>>>=m)),f>>>=7,c-=7}if(n.have+m>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;m--;)n.lens[n.have++]=g}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,m={bits:n.lenbits},p=oo(1,n.lens,0,n.nlen,n.lencode,0,n.work,m),n.lenbits=m.bits,p){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,m={bits:n.distbits},p=oo(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,m),n.distbits=m.bits,p){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,e===lo)break t;case 20:n.mode=21;case 21:if(6<=h&&258<=s){t.next_out=a,t.avail_out=s,t.next_in=u,t.avail_in=h,n.hold=f,n.bits=c;var y=(l=t).state;o=l.next_in;var b=l.input;u=o+(l.avail_in-5),a=l.next_out;var _=l.output;h=a-(v-l.avail_out),s=a+(l.avail_out-257),f=y.dmax,c=y.wsize,m=y.whave,g=y.wnext;var A=y.window,T=y.hold,w=y.bits;x=y.lencode;var M=y.distcode,C=(1<<y.lenbits)-1,R=(1<<y.distbits)-1;e:do{15>w&&(T+=b[o++]<<w,w+=8,T+=b[o++]<<w,w+=8);var S=x[T&C];r:for(;;){var P=S>>>24;if(T>>>=P,w-=P,0==(P=S>>>16&255))_[a++]=65535&S;else{if(!(16&P)){if(0==(64&P)){S=x[(65535&S)+(T&(1<<P)-1)];continue r}32&P?y.mode=12:(l.msg="invalid literal/length code",y.mode=30);break e}var E=65535&S;(P&=15)&&(w<P&&(T+=b[o++]<<w,w+=8),E+=T&(1<<P)-1,T>>>=P,w-=P),15>w&&(T+=b[o++]<<w,w+=8,T+=b[o++]<<w,w+=8),S=M[T&R];i:for(;;){if(T>>>=P=S>>>24,w-=P,!(16&(P=S>>>16&255))){if(0==(64&P)){S=M[(65535&S)+(T&(1<<P)-1)];continue i}l.msg="invalid distance code",y.mode=30;break e}if(S&=65535,w<(P&=15)&&(T+=b[o++]<<w,(w+=8)<P&&(T+=b[o++]<<w,w+=8)),(S+=T&(1<<P)-1)>f){l.msg="invalid distance too far back",y.mode=30;break e}if(T>>>=P,w-=P,S>(P=a-h)){if((P=S-P)>m&&y.sane){l.msg="invalid distance too far back",y.mode=30;break e}var L=0,F=A;if(0===g){if(L+=c-P,P<E){E-=P;do{_[a++]=A[L++]}while(--P);L=a-S,F=_}}else if(g<P){if(L+=c+g-P,(P-=g)<E){E-=P;do{_[a++]=A[L++]}while(--P);if(L=0,g<E){E-=P=g;do{_[a++]=A[L++]}while(--P);L=a-S,F=_}}}else if(L+=g-P,P<E){E-=P;do{_[a++]=A[L++]}while(--P);L=a-S,F=_}for(;2<E;)_[a++]=F[L++],_[a++]=F[L++],_[a++]=F[L++],E-=3;E&&(_[a++]=F[L++],1<E&&(_[a++]=F[L++]))}else{L=a-S;do{_[a++]=_[L++],_[a++]=_[L++],_[a++]=_[L++],E-=3}while(2<E);E&&(_[a++]=_[L++],1<E&&(_[a++]=_[L++]))}break}}break}}while(o<u&&a<s);o-=E=w>>3,w-=E<<3,l.next_in=o,l.next_out=a,l.avail_in=o<u?u-o+5:5-(o-u),l.avail_out=a<s?s-a+257:257-(a-s),y.hold=T&(1<<w)-1,y.bits=w,a=t.next_out,o=t.output,s=t.avail_out,u=t.next_in,l=t.input,h=t.avail_in,f=n.hold,c=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;m=(x=n.lencode[f&(1<<n.lenbits)-1])>>>24,g=x>>>16&255,x&=65535,!(m<=c);){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(g&&0==(240&g)){for(A=m,T=g,w=x;m=(x=n.lencode[w+((f&(1<<A+T)-1)>>A)])>>>24,g=x>>>16&255,x&=65535,!(A+m<=c);){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}f>>>=A,c-=A,n.back+=A}if(f>>>=m,c-=m,n.back+=m,n.length=x,0===g){n.mode=26;break}if(32&g){n.back=-1,n.mode=12;break}if(64&g){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&g,n.mode=22;case 22:if(n.extra){for(g=n.extra;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;m=(x=n.distcode[f&(1<<n.distbits)-1])>>>24,g=x>>>16&255,x&=65535,!(m<=c);){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(0==(240&g)){for(A=m,T=g,w=x;m=(x=n.distcode[w+((f&(1<<A+T)-1)>>A)])>>>24,g=x>>>16&255,x&=65535,!(A+m<=c);){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}f>>>=A,c-=A,n.back+=A}if(f>>>=m,c-=m,n.back+=m,64&g){t.msg="invalid distance code",n.mode=30;break}n.offset=x,n.extra=15&g,n.mode=24;case 24:if(n.extra){for(g=n.extra;c<g;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===s)break t;if(m=v-s,n.offset>m){if((m=n.offset-m)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}m>n.wnext?(m-=n.wnext,g=n.wsize-m):g=n.wnext-m,m>n.length&&(m=n.length),A=n.window}else A=o,g=a-n.offset,m=n.length;m>s&&(m=s),s-=m,n.length-=m;do{o[a++]=A[g++]}while(--m);0===n.length&&(n.mode=21);break;case 26:if(0===s)break t;o[a++]=n.length,s--,n.mode=21;break;case 27:if(n.wrap){for(;32>c;){if(0===h)break t;h--,f|=l[u++]<<c,c+=8}if(v-=s,t.total_out+=v,n.total+=v,v&&(t.adler=n.check=n.flags?ta(n.check,o,v,a-v):Jn(n.check,o,v,a-v)),v=s,(n.flags?f:yo(f))!==n.check){t.msg="incorrect data check",n.mode=30;break}c=f=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;32>c;){if(0===h)break t;h--,f+=l[u++]<<c,c+=8}if(f!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}c=f=0}n.mode=29;case 29:p=fo;break t;case 30:p=po;break t;case 31:return go;default:return vo}return t.next_out=a,t.avail_out=s,t.next_in=u,t.avail_in=h,n.hold=f,n.bits=c,(n.wsize||v!==t.avail_out&&30>n.mode&&(27>n.mode||e!==so))&&Ro(t,t.output,t.next_out,v-t.avail_out),d-=t.avail_in,v-=t.avail_out,t.total_in+=d,t.total_out+=v,n.total+=v,n.wrap&&v&&(t.adler=n.check=n.flags?ta(n.check,o,v,t.next_out-v):Jn(n.check,o,v,t.next_out-v)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===v||e===so)&&p===ho&&(p=mo),p},inflateEnd:function(t){if(!t||!t.state)return vo;var e=t.state;return e.window&&(e.window=null),t.state=null,ho},inflateGetHeader:function(t,e){return t&&t.state?0==(2&(t=t.state).wrap)?vo:(t.head=e,e.done=!1,ho):vo},inflateSetDictionary:function(t,e){var r=e.length;if(!t||!t.state)return vo;var i=t.state;return 0!==i.wrap&&11!==i.mode?vo:11===i.mode&&Jn(1,e,r,0)!==i.check?po:(Ro(t,e,r,r),i.havedict=1,ho)},inflateInfo:"pako inflate (from Nodeca project)"},Po=function(){this.os=this.xflags=this.time=this.text=0,this.extra=null,this.extra_len=0,this.comment=this.name="",this.hcrc=0,this.done=!1},Eo=Object.prototype.toString,Lo=ra.Z_NO_FLUSH,Fo=ra.Z_FINISH,Do=ra.Z_OK,Bo=ra.Z_STREAM_END,Oo=ra.Z_NEED_DICT,ko=ra.Z_STREAM_ERROR,zo=ra.Z_DATA_ERROR,Io=ra.Z_MEM_ERROR;I.prototype.push=function(t,e){var r=this.strm,i=this.options.chunkSize,n=this.options.dictionary;if(this.ended)return!1;var a=e===~~e?e:!0===e?Fo:Lo;for("[object ArrayBuffer]"===Eo.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(e=So.inflate(r,a))===Oo&&n&&((e=So.inflateSetDictionary(r,n))===Do?e=So.inflate(r,a):e===zo&&(e=Oo));0<r.avail_in&&e===Bo&&0<r.state.wrap&&0!==t[r.next_in];)So.inflateReset(r),e=So.inflate(r,a);switch(e){case ko:case zo:case Oo:case Io:return this.onEnd(e),this.ended=!0,!1}var o=r.avail_out;if(r.next_out&&(0===r.avail_out||e===Bo))if("string"===this.options.to){var s=Wa.utf8border(r.output,r.next_out),u=r.next_out-s,l=Wa.buf2string(r.output,s);r.next_out=u,r.avail_out=i-u,u&&r.output.set(r.output.subarray(s,s+u),0),this.onData(l)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(e!==Do||0!==o){if(e===Bo){e=So.inflateEnd(this.strm),this.onEnd(e),this.ended=!0;break}if(0===r.avail_in)break}}return!0},I.prototype.onData=function(t){this.chunks.push(t)},I.prototype.onEnd=function(t){t===Do&&(this.result="string"===this.options.to?this.chunks.join(""):Na.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Uo={Deflate:O,deflate:k,deflateRaw:function(t,e){return(e=e||{}).raw=!0,k(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,k(t,e)},Inflate:I,inflate:U,inflateRaw:function(t,e){return(e=e||{}).raw=!0,U(t,e)},ungzip:U,constants:ra},No=n((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=function(t){e.ARRAY_TYPE=i=t},e.toRadian=function(t){return t*n},e.equals=function(t,e){return Math.abs(t-e)<=r*Math.max(1,Math.abs(t),Math.abs(e))},e.RANDOM=e.ARRAY_TYPE=e.EPSILON=void 0;var r=1e-6;e.EPSILON=r;var i="undefined"!=typeof Float32Array?Float32Array:Array;e.ARRAY_TYPE=i,e.RANDOM=Math.random;var n=Math.PI/180}));i(No);var Ho=n((function(t,e){function r(t,e,r){var i=e[0],n=e[1],a=e[2];e=e[3];var o=r[0],s=r[1],u=r[2];return r=r[3],t[0]=i*o+a*s,t[1]=n*o+e*s,t[2]=i*u+a*r,t[3]=n*u+e*r,t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},e.fromValues=function(t,e,r,i){var a=new n.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=i,a},e.set=function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},e.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},e.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=r*(e=e[3])-n*i;return a?(a=1/a,t[0]=e*a,t[1]=-i*a,t[2]=-n*a,t[3]=r*a,t):null},e.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},e.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},e.multiply=r,e.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2];e=e[3];var o=Math.sin(r);return r=Math.cos(r),t[0]=i*r+a*o,t[1]=n*r+e*o,t[2]=i*-o+a*r,t[3]=n*-o+e*r,t},e.scale=function(t,e,r){var i=e[1],n=e[2],a=e[3],o=r[0];return r=r[1],t[0]=e[0]*o,t[1]=i*o,t[2]=n*r,t[3]=a*r,t},e.fromRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=r,t[2]=-r,t[3]=e,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},e.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},e.LDU=function(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},e.subtract=i,e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var r=t[0],i=t[1],a=t[2];t=t[3];var o=e[0],s=e[1],u=e[2];return e=e[3],Math.abs(r-o)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-u)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},e.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},e.sub=e.mul=void 0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}(No);e.mul=r,e.sub=i}));i(Ho);var jo=n((function(t,e){function r(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4];e=e[5];var u=r[0],l=r[1],h=r[2],f=r[3],c=r[4];return r=r[5],t[0]=i*u+a*l,t[1]=n*u+o*l,t[2]=i*h+a*f,t[3]=n*h+o*f,t[4]=i*c+a*r+s,t[5]=n*c+o*r+e,t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new n.ARRAY_TYPE(6);return n.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new n.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},e.fromValues=function(t,e,r,i,a,o){var s=new n.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s[4]=a,s[5]=o,s},e.set=function(t,e,r,i,n,a,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=o,t},e.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4];e=e[5];var s=r*a-i*n;return s?(s=1/s,t[0]=a*s,t[1]=-i*s,t[2]=-n*s,t[3]=r*s,t[4]=(n*e-a*o)*s,t[5]=(i*o-r*e)*s,t):null},e.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},e.multiply=r,e.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4];e=e[5];var u=Math.sin(r);return r=Math.cos(r),t[0]=i*r+a*u,t[1]=n*r+o*u,t[2]=i*-u+a*r,t[3]=n*-u+o*r,t[4]=s,t[5]=e,t},e.scale=function(t,e,r){var i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=r[0];return r=r[1],t[0]=e[0]*u,t[1]=i*u,t[2]=n*r,t[3]=a*r,t[4]=o,t[5]=s,t},e.translate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4];e=e[5];var u=r[0];return r=r[1],t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=i*u+a*r+s,t[5]=n*u+o*r+e,t},e.fromRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=r,t[2]=-r,t[3]=e,t[4]=0,t[5]=0,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},e.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},e.subtract=i,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},e.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},e.equals=function(t,e){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4];t=t[5];var u=e[0],l=e[1],h=e[2],f=e[3],c=e[4];return e=e[5],Math.abs(r-u)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-l)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-h)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-f)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-c)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}(No);e.mul=r,e.sub=i}));i(jo);var Xo=n((function(t,e){function r(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var f=r[0],c=r[1],d=r[2],v=r[3],p=r[4],g=r[5],m=r[6],x=r[7];return r=r[8],t[0]=f*i+c*o+d*l,t[1]=f*n+c*s+d*h,t[2]=f*a+c*u+d*e,t[3]=v*i+p*o+g*l,t[4]=v*n+p*s+g*h,t[5]=v*a+p*u+g*e,t[6]=m*i+x*o+r*l,t[7]=m*n+x*s+r*h,t[8]=m*a+x*u+r*e,t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},e.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},e.clone=function(t){var e=new n.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromValues=function(t,e,r,i,a,o,s,u,l){var h=new n.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=r,h[3]=i,h[4]=a,h[5]=o,h[6]=s,h[7]=u,h[8]=l,h},e.set=function(t,e,r,i,n,a,o,s,u,l){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=l,t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},e.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=(e=e[8])*o-s*l,f=-e*a+s*u,c=l*a-o*u,d=r*h+i*f+n*c;return d?(d=1/d,t[0]=h*d,t[1]=(-e*i+n*l)*d,t[2]=(s*i-n*o)*d,t[3]=f*d,t[4]=(e*r-n*u)*d,t[5]=(-s*r+n*a)*d,t[6]=c*d,t[7]=(-l*r+i*u)*d,t[8]=(o*r-i*a)*d,t):null},e.adjoint=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7];return e=e[8],t[0]=o*e-s*l,t[1]=n*l-i*e,t[2]=i*s-n*o,t[3]=s*u-a*e,t[4]=r*e-n*u,t[5]=n*a-r*s,t[6]=a*l-o*u,t[7]=i*u-r*l,t[8]=r*o-i*a,t},e.determinant=function(t){var e=t[3],r=t[4],i=t[5],n=t[6],a=t[7],o=t[8];return t[0]*(o*r-i*a)+t[1]*(-o*e+i*n)+t[2]*(a*e-r*n)},e.multiply=r,e.translate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var f=r[0];return r=r[1],t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=f*i+r*o+l,t[7]=f*n+r*s+h,t[8]=f*a+r*u+e,t},e.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7];e=e[8];var f=Math.sin(r);return r=Math.cos(r),t[0]=r*i+f*o,t[1]=r*n+f*s,t[2]=r*a+f*u,t[3]=r*o-f*i,t[4]=r*s-f*n,t[5]=r*u-f*a,t[6]=l,t[7]=h,t[8]=e,t},e.scale=function(t,e,r){var i=r[0];return r=r[1],t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},e.fromRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=r,t[2]=0,t[3]=-r,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},e.fromQuat=function(t,e){var r=e[0],i=e[1],n=e[2],a=r+r,o=i+i,s=n+n;r*=a;var u=i*a;i*=o;var l=n*a,h=n*o;return n*=s,a*=e=e[3],o*=e,e*=s,t[0]=1-i-n,t[3]=u-e,t[6]=l+o,t[1]=u+e,t[4]=1-r-n,t[7]=h-a,t[2]=l-o,t[5]=h+a,t[8]=1-r-i,t},e.normalFromMat4=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],f=e[9],c=e[10],d=e[11],v=e[12],p=e[13],g=e[14],m=r*s-i*o,x=r*u-n*o,y=r*l-a*o,b=i*u-n*s,_=i*l-a*s,A=n*l-a*u,T=h*p-f*v,w=h*g-c*v,M=f*g-c*p;return(d=m*(c=c*(e=e[15])-d*g)-x*(f=f*e-d*p)+y*M+b*(h=h*e-d*v)-_*w+A*T)?(d=1/d,t[0]=(s*c-u*f+l*M)*d,t[1]=(u*h-o*c-l*w)*d,t[2]=(o*f-s*h+l*T)*d,t[3]=(n*f-i*c-a*M)*d,t[4]=(r*c-n*h+a*w)*d,t[5]=(i*h-r*f-a*T)*d,t[6]=(p*A-g*_+e*b)*d,t[7]=(g*y-v*A-e*x)*d,t[8]=(v*_-p*y+e*m)*d,t):null},e.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},e.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},e.subtract=i,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},e.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},e.equals=function(t,e){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],h=t[7];t=t[8];var f=e[0],c=e[1],d=e[2],v=e[3],p=e[4],g=e[5],m=e[6],x=e[7];return e=e[8],Math.abs(r-f)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-c)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-d)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-v)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-p)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-g)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(l-m)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-x)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}(No);e.mul=r,e.sub=i}));i(Xo);var Wo=n((function(t,e){function r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],h=e[7],f=e[8],c=e[9],d=e[10],v=e[11],p=e[12],g=e[13],m=e[14];e=e[15];var x=r[0],y=r[1],b=r[2],_=r[3];return t[0]=x*i+y*s+b*f+_*p,t[1]=x*n+y*u+b*c+_*g,t[2]=x*a+y*l+b*d+_*m,t[3]=x*o+y*h+b*v+_*e,x=r[4],y=r[5],b=r[6],_=r[7],t[4]=x*i+y*s+b*f+_*p,t[5]=x*n+y*u+b*c+_*g,t[6]=x*a+y*l+b*d+_*m,t[7]=x*o+y*h+b*v+_*e,x=r[8],y=r[9],b=r[10],_=r[11],t[8]=x*i+y*s+b*f+_*p,t[9]=x*n+y*u+b*c+_*g,t[10]=x*a+y*l+b*d+_*m,t[11]=x*o+y*h+b*v+_*e,x=r[12],y=r[13],b=r[14],_=r[15],t[12]=x*i+y*s+b*f+_*p,t[13]=x*n+y*u+b*c+_*g,t[14]=x*a+y*l+b*d+_*m,t[15]=x*o+y*h+b*v+_*e,t}function n(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=i+i,u=n+n,l=a+a;e=i*s;var h=i*u;i*=l;var f=n*u;return n*=l,a*=l,s*=o,u*=o,o*=l,t[0]=1-(f+a),t[1]=h+o,t[2]=i-u,t[3]=0,t[4]=h-o,t[5]=1-(e+a),t[6]=n+s,t[7]=0,t[8]=i+u,t[9]=n-s,t[10]=1-(e+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function a(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new o.ARRAY_TYPE(16);return o.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},e.clone=function(t){var e=new o.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.fromValues=function(t,e,r,i,n,a,s,u,l,h,f,c,d,v,p,g){var m=new o.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=i,m[4]=n,m[5]=a,m[6]=s,m[7]=u,m[8]=l,m[9]=h,m[10]=f,m[11]=c,m[12]=d,m[13]=v,m[14]=p,m[15]=g,m},e.set=function(t,e,r,i,n,a,o,s,u,l,h,f,c,d,v,p,g){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=l,t[9]=h,t[10]=f,t[11]=c,t[12]=d,t[13]=v,t[14]=p,t[15]=g,t},e.identity=r,e.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},e.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],f=e[9],c=e[10],d=e[11],v=e[12],p=e[13],g=e[14],m=r*s-i*o,x=r*u-n*o,y=r*l-a*o,b=i*u-n*s,_=i*l-a*s,A=n*l-a*u,T=h*p-f*v,w=h*g-c*v,M=h*(e=e[15])-d*v,C=f*g-c*p,R=f*e-d*p,S=c*e-d*g,P=m*S-x*R+y*C+b*M-_*w+A*T;return P?(P=1/P,t[0]=(s*S-u*R+l*C)*P,t[1]=(n*R-i*S-a*C)*P,t[2]=(p*A-g*_+e*b)*P,t[3]=(c*_-f*A-d*b)*P,t[4]=(u*M-o*S-l*w)*P,t[5]=(r*S-n*M+a*w)*P,t[6]=(g*y-v*A-e*x)*P,t[7]=(h*A-c*y+d*x)*P,t[8]=(o*R-s*M+l*T)*P,t[9]=(i*M-r*R-a*T)*P,t[10]=(v*_-p*y+e*m)*P,t[11]=(f*y-h*_-d*m)*P,t[12]=(s*w-o*C-u*T)*P,t[13]=(r*C-i*w+n*T)*P,t[14]=(p*x-v*b-g*m)*P,t[15]=(h*b-f*x+c*m)*P,t):null},e.adjoint=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],h=e[8],f=e[9],c=e[10],d=e[11],v=e[12],p=e[13],g=e[14];return e=e[15],t[0]=s*(c*e-d*g)-f*(u*e-l*g)+p*(u*d-l*c),t[1]=-(i*(c*e-d*g)-f*(n*e-a*g)+p*(n*d-a*c)),t[2]=i*(u*e-l*g)-s*(n*e-a*g)+p*(n*l-a*u),t[3]=-(i*(u*d-l*c)-s*(n*d-a*c)+f*(n*l-a*u)),t[4]=-(o*(c*e-d*g)-h*(u*e-l*g)+v*(u*d-l*c)),t[5]=r*(c*e-d*g)-h*(n*e-a*g)+v*(n*d-a*c),t[6]=-(r*(u*e-l*g)-o*(n*e-a*g)+v*(n*l-a*u)),t[7]=r*(u*d-l*c)-o*(n*d-a*c)+h*(n*l-a*u),t[8]=o*(f*e-d*p)-h*(s*e-l*p)+v*(s*d-l*f),t[9]=-(r*(f*e-d*p)-h*(i*e-a*p)+v*(i*d-a*f)),t[10]=r*(s*e-l*p)-o*(i*e-a*p)+v*(i*l-a*s),t[11]=-(r*(s*d-l*f)-o*(i*d-a*f)+h*(i*l-a*s)),t[12]=-(o*(f*g-c*p)-h*(s*g-u*p)+v*(s*c-u*f)),t[13]=r*(f*g-c*p)-h*(i*g-n*p)+v*(i*c-n*f),t[14]=-(r*(s*g-u*p)-o*(i*g-n*p)+v*(i*u-n*s)),t[15]=r*(s*c-u*f)-o*(i*c-n*f)+h*(i*u-n*s),t},e.determinant=function(t){var e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],h=t[9],f=t[10],c=t[11],d=t[12],v=t[13],p=t[14];return(e*o-r*a)*(f*(t=t[15])-c*p)-(e*s-i*a)*(h*t-c*v)+(e*u-n*a)*(h*p-f*v)+(r*s-i*o)*(l*t-c*d)-(r*u-n*o)*(l*p-f*d)+(i*u-n*s)*(l*v-h*d)},e.multiply=i,e.translate=function(t,e,r){var i=r[0],n=r[1];if(r=r[2],e===t)t[12]=e[0]*i+e[4]*n+e[8]*r+e[12],t[13]=e[1]*i+e[5]*n+e[9]*r+e[13],t[14]=e[2]*i+e[6]*n+e[10]*r+e[14],t[15]=e[3]*i+e[7]*n+e[11]*r+e[15];else{var a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],h=e[5],f=e[6],c=e[7],d=e[8],v=e[9],p=e[10],g=e[11];t[0]=a,t[1]=o,t[2]=s,t[3]=u,t[4]=l,t[5]=h,t[6]=f,t[7]=c,t[8]=d,t[9]=v,t[10]=p,t[11]=g,t[12]=a*i+l*n+d*r+e[12],t[13]=o*i+h*n+v*r+e[13],t[14]=s*i+f*n+p*r+e[14],t[15]=u*i+c*n+g*r+e[15]}return t},e.scale=function(t,e,r){var i=r[0],n=r[1];return r=r[2],t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.rotate=function(t,e,r,i){var n=i[0],a=i[1];i=i[2];var s=Math.sqrt(n*n+a*a+i*i);if(s<o.EPSILON)return null;n*=s=1/s,a*=s,i*=s;var u=Math.sin(r),l=Math.cos(r),h=1-l;r=e[0],s=e[1];var f=e[2],c=e[3],d=e[4],v=e[5],p=e[6],g=e[7],m=e[8],x=e[9],y=e[10],b=e[11],_=n*n*h+l,A=a*n*h+i*u,T=i*n*h-a*u,w=n*a*h-i*u,M=a*a*h+l,C=i*a*h+n*u,R=n*i*h+a*u;return n=a*i*h-n*u,a=i*i*h+l,t[0]=r*_+d*A+m*T,t[1]=s*_+v*A+x*T,t[2]=f*_+p*A+y*T,t[3]=c*_+g*A+b*T,t[4]=r*w+d*M+m*C,t[5]=s*w+v*M+x*C,t[6]=f*w+p*M+y*C,t[7]=c*w+g*M+b*C,t[8]=r*R+d*n+m*a,t[9]=s*R+v*n+x*a,t[10]=f*R+p*n+y*a,t[11]=c*R+g*n+b*a,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},e.rotateX=function(t,e,r){var i=Math.sin(r);r=Math.cos(r);var n=e[4],a=e[5],o=e[6],s=e[7],u=e[8],l=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*r+u*i,t[5]=a*r+l*i,t[6]=o*r+h*i,t[7]=s*r+f*i,t[8]=u*r-n*i,t[9]=l*r-a*i,t[10]=h*r-o*i,t[11]=f*r-s*i,t},e.rotateY=function(t,e,r){var i=Math.sin(r);r=Math.cos(r);var n=e[0],a=e[1],o=e[2],s=e[3],u=e[8],l=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r-u*i,t[1]=a*r-l*i,t[2]=o*r-h*i,t[3]=s*r-f*i,t[8]=n*i+u*r,t[9]=a*i+l*r,t[10]=o*i+h*r,t[11]=s*i+f*r,t},e.rotateZ=function(t,e,r){var i=Math.sin(r);r=Math.cos(r);var n=e[0],a=e[1],o=e[2],s=e[3],u=e[4],l=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r+u*i,t[1]=a*r+l*i,t[2]=o*r+h*i,t[3]=s*r+f*i,t[4]=u*r-n*i,t[5]=l*r-a*i,t[6]=h*r-o*i,t[7]=f*r-s*i,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotation=function(t,e,r){var i=r[0],n=r[1];r=r[2];var a=Math.sqrt(i*i+n*n+r*r);if(a<o.EPSILON)return null;i*=a=1/a,n*=a,r*=a,a=Math.sin(e);var s=1-(e=Math.cos(e));return t[0]=i*i*s+e,t[1]=n*i*s+r*a,t[2]=r*i*s-n*a,t[3]=0,t[4]=i*n*s-r*a,t[5]=n*n*s+e,t[6]=r*n*s+i*a,t[7]=0,t[8]=i*r*s+n*a,t[9]=n*r*s-i*a,t[10]=r*r*s+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromXRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromYRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromZRotation=function(t,e){var r=Math.sin(e);return e=Math.cos(e),t[0]=e,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotationTranslation=n,e.fromQuat2=function(t,e){var r=new o.ARRAY_TYPE(3),i=-e[0],a=-e[1],s=-e[2],u=e[3],l=e[4],h=e[5],f=e[6],c=e[7],d=i*i+a*a+s*s+u*u;return 0<d?(r[0]=2*(l*u+c*i+h*s-f*a)/d,r[1]=2*(h*u+c*a+f*i-l*s)/d,r[2]=2*(f*u+c*s+l*a-h*i)/d):(r[0]=2*(l*u+c*i+h*s-f*a),r[1]=2*(h*u+c*a+f*i-l*s),r[2]=2*(f*u+c*s+l*a-h*i)),n(t,e,r),t},e.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},e.getScaling=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[4],o=e[5],s=e[6],u=e[8],l=e[9];return e=e[10],t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(a*a+o*o+s*s),t[2]=Math.sqrt(u*u+l*l+e*e),t},e.getRotation=function(t,e){var r=e[0]+e[5]+e[10];return 0<r?(r=2*Math.sqrt(r+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t},e.fromRotationTranslationScale=function(t,e,r,i){var n=e[0],a=e[1],o=e[2],s=e[3],u=n+n,l=a+a,h=o+o;e=n*u;var f=n*l;n*=h;var c=a*l;a*=h,o*=h,u*=s,l*=s,s*=h,h=i[0];var d=i[1];return i=i[2],t[0]=(1-(c+o))*h,t[1]=(f+s)*h,t[2]=(n-l)*h,t[3]=0,t[4]=(f-s)*d,t[5]=(1-(e+o))*d,t[6]=(a+u)*d,t[7]=0,t[8]=(n+l)*i,t[9]=(a-u)*i,t[10]=(1-(e+c))*i,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},e.fromRotationTranslationScaleOrigin=function(t,e,r,i,n){var a=e[0],o=e[1],s=e[2],u=e[3],l=a+a,h=o+o,f=s+s;e=a*l;var c=a*h,d=a*f;a=o*h,o*=f;var v=s*f;s=u*l,h*=u;var p=u*f,g=i[0],m=i[1];f=i[2],i=n[0],u=n[1],n=n[2],l=(1-(a+v))*g;var x=(c+p)*g;return g*=d-h,c=(c-p)*m,v=(1-(e+v))*m,m*=o+s,d=(d+h)*f,o=(o-s)*f,e=(1-(e+a))*f,t[0]=l,t[1]=x,t[2]=g,t[3]=0,t[4]=c,t[5]=v,t[6]=m,t[7]=0,t[8]=d,t[9]=o,t[10]=e,t[11]=0,t[12]=r[0]+i-(l*i+c*u+d*n),t[13]=r[1]+u-(x*i+v*u+o*n),t[14]=r[2]+n-(g*i+m*u+e*n),t[15]=1,t},e.fromQuat=function(t,e){var r=e[0],i=e[1],n=e[2],a=r+r,o=i+i,s=n+n;r*=a;var u=i*a;i*=o;var l=n*a,h=n*o;return n*=s,a*=e=e[3],o*=e,e*=s,t[0]=1-i-n,t[1]=u+e,t[2]=l-o,t[3]=0,t[4]=u-e,t[5]=1-r-n,t[6]=h+a,t[7]=0,t[8]=l+o,t[9]=h-a,t[10]=1-r-i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.frustum=function(t,e,r,i,n,a,o){var s=1/(r-e),u=1/(n-i),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(n+i)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t},e.perspective=function(t,e,r,i,n){return e=1/Math.tan(e/2),t[0]=e/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&1/0!==n?(r=1/(i-n),t[10]=(n+i)*r,t[14]=2*n*i*r):(t[10]=-1,t[14]=-2*i),t},e.perspectiveFromFieldOfView=function(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=2/(o+(e=Math.tan(e.rightDegrees*Math.PI/180))),u=2/(n+a);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(o-e)*s*.5,t[9]=(n-a)*u*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t},e.ortho=function(t,e,r,i,n,a,o){var s=1/(e-r),u=1/(i-n),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(n+i)*u,t[14]=(o+a)*l,t[15]=1,t},e.lookAt=function(t,e,i,n){var a=e[0],s=e[1];e=e[2];var u=n[0],l=n[1],h=n[2],f=i[0];n=i[1];var c=i[2];if(Math.abs(a-f)<o.EPSILON&&Math.abs(s-n)<o.EPSILON&&Math.abs(e-c)<o.EPSILON)return r(t);i=a-f,n=s-n,f=e-c;var d=1/Math.sqrt(i*i+n*n+f*f);c=l*(f*=d)-h*(n*=d),h=h*(i*=d)-u*f,u=u*n-l*i,(d=Math.sqrt(c*c+h*h+u*u))?(c*=d=1/d,h*=d,u*=d):u=h=c=0,l=n*u-f*h;var v=f*c-i*u,p=i*h-n*c;return(d=Math.sqrt(l*l+v*v+p*p))?(l*=d=1/d,v*=d,p*=d):p=v=l=0,t[0]=c,t[1]=l,t[2]=i,t[3]=0,t[4]=h,t[5]=v,t[6]=n,t[7]=0,t[8]=u,t[9]=p,t[10]=f,t[11]=0,t[12]=-(c*a+h*s+u*e),t[13]=-(l*a+v*s+p*e),t[14]=-(i*a+n*s+f*e),t[15]=1,t},e.targetTo=function(t,e,r,i){var n=e[0],a=e[1];e=e[2];var o=i[0],s=i[1],u=i[2];i=n-r[0];var l=a-r[1],h=i*i+l*l+(r=e-r[2])*r;0<h&&(i*=h=1/Math.sqrt(h),l*=h,r*=h);var f=s*r-u*l;return 0<(h=f*f+(u=u*i-o*r)*u+(o=o*l-s*i)*o)&&(f*=h=1/Math.sqrt(h),u*=h,o*=h),t[0]=f,t[1]=u,t[2]=o,t[3]=0,t[4]=l*o-r*u,t[5]=r*f-i*o,t[6]=i*u-l*f,t[7]=0,t[8]=i,t[9]=l,t[10]=r,t[11]=0,t[12]=n,t[13]=a,t[14]=e,t[15]=1,t},e.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},e.subtract=a,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},e.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},e.equals=function(t,e){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],u=t[5],l=t[6],h=t[7],f=t[8],c=t[9],d=t[10],v=t[11],p=t[12],g=t[13],m=t[14];t=t[15];var x=e[0],y=e[1],b=e[2],_=e[3],A=e[4],T=e[5],w=e[6],M=e[7],C=e[8],R=e[9],S=e[10],P=e[11],E=e[12],L=e[13],F=e[14];return e=e[15],Math.abs(r-x)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-y)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-b)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(a-_)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-A)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-T)<=o.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(l-w)<=o.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(h-M)<=o.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(f-C)<=o.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(c-R)<=o.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(d-S)<=o.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(v-P)<=o.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(p-E)<=o.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(g-L)<=o.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(m-F)<=o.EPSILON*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(t-e)<=o.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sub=e.mul=void 0;var o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}(No);e.mul=i,e.sub=a}));i(Wo);var Yo=n((function(t,e){function r(){var t=new d.ARRAY_TYPE(3);return d.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function i(t){var e=t[0],r=t[1];return t=t[2],Math.sqrt(e*e+r*r+t*t)}function n(t,e,r){var i=new d.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=r,i}function a(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function o(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function s(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function u(t,e){var r=e[0]-t[0],i=e[1]-t[1];return t=e[2]-t[2],Math.sqrt(r*r+i*i+t*t)}function l(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i+(t=e[2]-t[2])*t}function h(t){var e=t[0],r=t[1];return e*e+r*r+(t=t[2])*t}function f(t,e){var r=e[0],i=e[1],n=e[2];return 0<(r=r*r+i*i+n*n)&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function c(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Object.defineProperty(e,"__esModule",{value:!0}),e.create=r,e.clone=function(t){var e=new d.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.length=i,e.fromValues=n,e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.set=function(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},e.subtract=a,e.multiply=o,e.divide=s,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},e.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t},e.distance=u,e.squaredDistance=l,e.squaredLength=h,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},e.normalize=f,e.dot=c,e.cross=function(t,e,r){var i=e[0],n=e[1];e=e[2];var a=r[0],o=r[1];return r=r[2],t[0]=n*r-e*o,t[1]=e*a-i*r,t[2]=i*o-n*a,t},e.lerp=function(t,e,r,i){var n=e[0],a=e[1];return e=e[2],t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=e+i*(r[2]-e),t},e.hermite=function(t,e,r,i,n,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1);return a=o*(3-2*a),t[0]=e[0]*s+r[0]*u+i[0]*l+n[0]*a,t[1]=e[1]*s+r[1]*u+i[1]*l+n[1]*a,t[2]=e[2]*s+r[2]*u+i[2]*l+n[2]*a,t},e.bezier=function(t,e,r,i,n,a){var o=1-a,s=o*o,u=a*a,l=s*o;return s*=3*a,o*=3*u,a*=u,t[0]=e[0]*l+r[0]*s+i[0]*o+n[0]*a,t[1]=e[1]*l+r[1]*s+i[1]*o+n[1]*a,t[2]=e[2]*l+r[2]*s+i[2]*o+n[2]*a,t},e.random=function(t,e){e=e||1;var r=2*d.RANDOM()*Math.PI,i=2*d.RANDOM()-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t},e.transformMat4=function(t,e,r){var i=e[0],n=e[1];e=e[2];var a=r[3]*i+r[7]*n+r[11]*e+r[15];return a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*e+r[12])/a,t[1]=(r[1]*i+r[5]*n+r[9]*e+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*e+r[14])/a,t},e.transformMat3=function(t,e,r){var i=e[0],n=e[1];return e=e[2],t[0]=i*r[0]+n*r[3]+e*r[6],t[1]=i*r[1]+n*r[4]+e*r[7],t[2]=i*r[2]+n*r[5]+e*r[8],t},e.transformQuat=function(t,e,r){var i=r[0],n=r[1],a=r[2],o=e[0],s=e[1],u=n*(e=e[2])-a*s,l=a*o-i*e,h=i*s-n*o;return r=2*r[3],t[0]=o+u*r+2*(n*h-a*l),t[1]=s+l*r+2*(a*u-i*h),t[2]=e+h*r+2*(i*l-n*u),t},e.rotateX=function(t,e,r,i){var n=[],a=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},e.rotateY=function(t,e,r,i){var n=[],a=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},e.rotateZ=function(t,e,r,i){var n=[],a=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},e.angle=function(t,e){return t=n(t[0],t[1],t[2]),e=n(e[0],e[1],e[2]),f(t,t),f(e,e),1<(e=c(t,e))?0:-1>e?Math.PI:Math.acos(e)},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},e.equals=function(t,e){var r=t[0],i=t[1];t=t[2];var n=e[0],a=e[1];return e=e[2],Math.abs(r-n)<=d.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-a)<=d.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(t-e)<=d.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var d=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}(No);e.sub=a,e.mul=o,e.div=s,e.dist=u,e.sqrDist=l,e.len=i,e.sqrLen=h,t=function(){var t=r();return function(e,r,i,n,a,o){for(r||(r=3),i||(i=0),n=n?Math.min(n*r+i,e.length):e.length;i<n;i+=r)t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],a(t,t,o),e[i]=t[0],e[i+1]=t[1],e[i+2]=t[2];return e}}(),e.forEach=t}));i(Yo);var Zo=n((function(t,e){function r(){var t=new h.ARRAY_TYPE(4);return h.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function n(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function a(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function o(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return t=e[3]-t[3],Math.sqrt(r*r+i*i+n*n+t*t)}function s(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n+(t=e[3]-t[3])*t}function u(t){var e=t[0],r=t[1],i=t[2];return t=t[3],Math.sqrt(e*e+r*r+i*i+t*t)}function l(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i+(t=t[3])*t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=r,e.clone=function(t){var e=new h.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.fromValues=function(t,e,r,i){var n=new h.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.set=function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},e.subtract=i,e.multiply=n,e.divide=a,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},e.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},e.distance=o,e.squaredDistance=s,e.length=u,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},e.normalize=function(t,e){var r=e[0],i=e[1],n=e[2],a=r*r+i*i+n*n+(e=e[3])*e;return 0<a&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=e*a,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},e.cross=function(t,e,r,i){var n=r[0]*i[1]-r[1]*i[0],a=r[0]*i[2]-r[2]*i[0],o=r[0]*i[3]-r[3]*i[0],s=r[1]*i[2]-r[2]*i[1],u=r[1]*i[3]-r[3]*i[1];r=r[2]*i[3]-r[3]*i[2],i=e[0];var l=e[1],h=e[2];return e=e[3],t[0]=l*r-h*u+e*s,t[1]=-i*r+h*o-e*a,t[2]=i*u-l*o+e*n,t[3]=-i*s+l*a-h*n,t},e.lerp=function(t,e,r,i){var n=e[0],a=e[1],o=e[2];return e=e[3],t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=o+i*(r[2]-o),t[3]=e+i*(r[3]-e),t},e.random=function(t,e){e=e||1;do{var r=2*h.RANDOM()-1,i=2*h.RANDOM()-1,n=r*r+i*i}while(1<=n);do{var a=2*h.RANDOM()-1,o=2*h.RANDOM()-1,s=a*a+o*o}while(1<=s);return n=Math.sqrt((1-n)/s),t[0]=e*r,t[1]=e*i,t[2]=e*a*n,t[3]=e*o*n,t},e.transformMat4=function(t,e,r){var i=e[0],n=e[1],a=e[2];return e=e[3],t[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*e,t[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*e,t[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*e,t[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*e,t},e.transformQuat=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[0],s=r[1],u=r[2],l=(r=r[3])*i+s*a-u*n,h=r*n+u*i-o*a,f=r*a+o*n-s*i;return i=-o*i-s*n-u*a,t[0]=l*r+i*-o+h*-u-f*-s,t[1]=h*r+i*-s+f*-o-l*-u,t[2]=f*r+i*-u+l*-s-h*-o,t[3]=e[3],t},e.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},e.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var r=t[0],i=t[1],n=t[2];t=t[3];var a=e[0],o=e[1],s=e[2];return e=e[3],Math.abs(r-a)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(t-e)<=h.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0;var h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}(No);e.sub=i,e.mul=n,e.div=a,e.dist=o,e.sqrDist=s,e.len=u,e.sqrLen=l,t=function(){var t=r();return function(e,r,i,n,a,o){for(r||(r=4),i||(i=0),n=n?Math.min(n*r+i,e.length):e.length;i<n;i+=r)t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],a(t,t,o),e[i]=t[0],e[i+1]=t[1],e[i+2]=t[2],e[i+3]=t[3];return e}}(),e.forEach=t}));i(Zo);var Vo=n((function(t,e){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}function i(){var t=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function n(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function a(t,e,r){var i=e[0],n=e[1],a=e[2];e=e[3];var o=r[0],s=r[1],u=r[2];return r=r[3],t[0]=i*r+e*o+n*u-a*s,t[1]=n*r+e*s+a*o-i*u,t[2]=a*r+e*u+i*s-n*o,t[3]=e*r-i*o-n*s-a*u,t}function o(t,e,r,i){var n=e[0],a=e[1],o=e[2];e=e[3];var s=r[0],l=r[1],h=r[2],f=n*s+a*l+o*h+e*(r=r[3]);if(0>f&&(f=-f,s=-s,l=-l,h=-h,r=-r),1-f>u.EPSILON){var c=Math.acos(f),d=Math.sin(c);f=Math.sin((1-i)*c)/d,i=Math.sin(i*c)/d}else f=1-i;return t[0]=f*n+i*s,t[1]=f*a+i*l,t[2]=f*o+i*h,t[3]=f*e+i*r,t}function s(t,e){var r=e[0]+e[4]+e[8];if(0<r)r=Math.sqrt(r+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var n=(i+1)%3,a=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*a+a]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*n+a]-e[3*a+n])*r,t[n]=(e[3*n+i]+e[3*i+n])*r,t[a]=(e[3*a+i]+e[3*i+a])*r}return t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=i,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},e.setAxisAngle=n,e.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>u.EPSILON?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r},e.multiply=a,e.rotateX=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2];e=e[3];var o=Math.sin(r);return r=Math.cos(r),t[0]=i*r+e*o,t[1]=n*r+a*o,t[2]=a*r-n*o,t[3]=e*r-i*o,t},e.rotateY=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2];e=e[3];var o=Math.sin(r);return r=Math.cos(r),t[0]=i*r-a*o,t[1]=n*r+e*o,t[2]=a*r+i*o,t[3]=e*r-n*o,t},e.rotateZ=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2];e=e[3];var o=Math.sin(r);return r=Math.cos(r),t[0]=i*r+n*o,t[1]=n*r-i*o,t[2]=a*r+e*o,t[3]=e*r-a*o,t},e.calculateW=function(t,e){var r=e[0],i=e[1];return e=e[2],t[0]=r,t[1]=i,t[2]=e,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-e*e)),t},e.slerp=o,e.random=function(t){var e=u.RANDOM(),r=u.RANDOM(),i=u.RANDOM(),n=Math.sqrt(1-e);return e=Math.sqrt(e),t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=e*Math.sin(2*Math.PI*i),t[3]=e*Math.cos(2*Math.PI*i),t},e.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=r*r+i*i+n*n+(e=e[3])*e;return a=a?1/a:0,t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=e*a,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},e.fromMat3=s,e.fromEuler=function(t,e,r,i){var n=.5*Math.PI/180;e*=n,r*=n,i*=n,n=Math.sin(e),e=Math.cos(e);var a=Math.sin(r);r=Math.cos(r);var o=Math.sin(i);return i=Math.cos(i),t[0]=n*r*i-e*a*o,t[1]=e*a*i+n*r*o,t[2]=e*r*o-n*a*i,t[3]=e*r*i+n*a*o,t},e.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0;var u=r(No),l=r(Xo),h=r(Yo);t=r(Zo),e.clone=t.clone,e.fromValues=t.fromValues,e.copy=t.copy,e.set=t.set,e.add=t.add,e.mul=a,e.scale=t.scale,e.dot=t.dot,e.lerp=t.lerp;var f=t.length;e.length=f,e.len=f,f=t.squaredLength,e.squaredLength=f,e.sqrLen=f;var c=t.normalize;e.normalize=c,e.exactEquals=t.exactEquals,e.equals=t.equals,t=function(){var t=h.create(),e=h.fromValues(1,0,0),r=h.fromValues(0,1,0);return function(i,a,o){var s=h.dot(a,o);return-.999999>s?(h.cross(t,e,a),1e-6>h.len(t)&&h.cross(t,r,a),h.normalize(t,t),n(i,t,Math.PI),i):.999999<s?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(h.cross(t,a,o),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+s,c(i,i))}}(),e.rotationTo=t,t=function(){var t=i(),e=i();return function(r,i,n,a,s,u){return o(t,i,s,u),o(e,n,a,u),o(r,t,e,2*u*(1-u)),r}}(),e.sqlerp=t,t=function(){var t=l.create();return function(e,r,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],c(e,s(e,t))}}(),e.setAxes=t}));i(Vo);var Go=n((function(t,e){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}function i(t,e,r){var i=.5*r[0],n=.5*r[1];r=.5*r[2];var a=e[0],o=e[1],s=e[2];return e=e[3],t[0]=a,t[1]=o,t[2]=s,t[3]=e,t[4]=i*e+n*s-r*o,t[5]=n*e+r*a-i*s,t[6]=r*e+i*o-n*a,t[7]=-i*a-n*o-r*s,t}function n(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function a(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=r[4],u=r[5],l=r[6],h=r[7],f=e[4],c=e[5],d=e[6];e=e[7];var v=r[0],p=r[1],g=r[2];return r=r[3],t[0]=i*r+o*v+n*g-a*p,t[1]=n*r+o*p+a*v-i*g,t[2]=a*r+o*g+i*p-n*v,t[3]=o*r-i*v-n*p-a*g,t[4]=i*h+o*s+n*l-a*u+f*r+e*v+c*g-d*p,t[5]=n*h+o*u+a*s-i*l+c*r+e*p+d*v-f*g,t[6]=a*h+o*l+i*u-n*s+d*r+e*g+f*p-c*v,t[7]=o*h-i*s-n*u-a*l+e*r-f*v-c*p-d*g,t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=function(){var t=new o.ARRAY_TYPE(8);return o.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},e.clone=function(t){var e=new o.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},e.fromValues=function(t,e,r,i,n,a,s,u){var l=new o.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=r,l[3]=i,l[4]=n,l[5]=a,l[6]=s,l[7]=u,l},e.fromRotationTranslationValues=function(t,e,r,i,n,a,s){var u=new o.ARRAY_TYPE(8);return u[0]=t,u[1]=e,u[2]=r,u[3]=i,n*=.5,a*=.5,s*=.5,u[4]=n*i+a*r-s*e,u[5]=a*i+s*t-n*r,u[6]=s*i+n*e-a*t,u[7]=-n*t-a*e-s*r,u},e.fromRotationTranslation=i,e.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},e.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.fromMat4=function(t,e){var r=s.create();u.getRotation(r,e);var n=new o.ARRAY_TYPE(3);return u.getTranslation(n,e),i(t,r,n),t},e.copy=n,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.set=function(t,e,r,i,n,a,o,s,u){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t},e.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},e.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},e.getTranslation=function(t,e){var r=e[4],i=e[5],n=e[6],a=e[7],o=-e[0],s=-e[1],u=-e[2];return e=e[3],t[0]=2*(r*e+a*o+i*u-n*s),t[1]=2*(i*e+a*s+n*o-r*u),t[2]=2*(n*e+a*u+r*s-i*o),t},e.translate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=.5*r[0],u=.5*r[1];r=.5*r[2];var l=e[4],h=e[5],f=e[6];return e=e[7],t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=o*s+n*r-a*u+l,t[5]=o*u+a*s-i*r+h,t[6]=o*r+i*u-n*s+f,t[7]=-i*s-n*u-a*r+e,t},e.rotateX=function(t,e,r){var i=-e[0],n=-e[1],a=-e[2],o=e[3],u=e[4],l=e[5],h=e[6],f=e[7],c=u*o+f*i+l*a-h*n,d=l*o+f*n+h*i-u*a,v=h*o+f*a+u*n-l*i;return u=f*o-u*i-l*n-h*a,s.rotateX(t,e,r),i=t[0],n=t[1],a=t[2],o=t[3],t[4]=c*o+u*i+d*a-v*n,t[5]=d*o+u*n+v*i-c*a,t[6]=v*o+u*a+c*n-d*i,t[7]=u*o-c*i-d*n-v*a,t},e.rotateY=function(t,e,r){var i=-e[0],n=-e[1],a=-e[2],o=e[3],u=e[4],l=e[5],h=e[6],f=e[7],c=u*o+f*i+l*a-h*n,d=l*o+f*n+h*i-u*a,v=h*o+f*a+u*n-l*i;return u=f*o-u*i-l*n-h*a,s.rotateY(t,e,r),i=t[0],n=t[1],a=t[2],o=t[3],t[4]=c*o+u*i+d*a-v*n,t[5]=d*o+u*n+v*i-c*a,t[6]=v*o+u*a+c*n-d*i,t[7]=u*o-c*i-d*n-v*a,t},e.rotateZ=function(t,e,r){var i=-e[0],n=-e[1],a=-e[2],o=e[3],u=e[4],l=e[5],h=e[6],f=e[7],c=u*o+f*i+l*a-h*n,d=l*o+f*n+h*i-u*a,v=h*o+f*a+u*n-l*i;return u=f*o-u*i-l*n-h*a,s.rotateZ(t,e,r),i=t[0],n=t[1],a=t[2],o=t[3],t[4]=c*o+u*i+d*a-v*n,t[5]=d*o+u*n+v*i-c*a,t[6]=v*o+u*a+c*n-d*i,t[7]=u*o-c*i-d*n-v*a,t},e.rotateByQuatAppend=function(t,e,r){var i=r[0],n=r[1],a=r[2];r=r[3];var o=e[0],s=e[1],u=e[2],l=e[3];return t[0]=o*r+l*i+s*a-u*n,t[1]=s*r+l*n+u*i-o*a,t[2]=u*r+l*a+o*n-s*i,t[3]=l*r-o*i-s*n-u*a,o=e[4],s=e[5],u=e[6],l=e[7],t[4]=o*r+l*i+s*a-u*n,t[5]=s*r+l*n+u*i-o*a,t[6]=u*r+l*a+o*n-s*i,t[7]=l*r-o*i-s*n-u*a,t},e.rotateByQuatPrepend=function(t,e,r){var i=e[0],n=e[1],a=e[2];e=e[3];var o=r[0],s=r[1],u=r[2],l=r[3];return t[0]=i*l+e*o+n*u-a*s,t[1]=n*l+e*s+a*o-i*u,t[2]=a*l+e*u+i*s-n*o,t[3]=e*l-i*o-n*s-a*u,o=r[4],s=r[5],u=r[6],l=r[7],t[4]=i*l+e*o+n*u-a*s,t[5]=n*l+e*s+a*o-i*u,t[6]=a*l+e*u+i*s-n*o,t[7]=e*l-i*o-n*s-a*u,t},e.rotateAroundAxis=function(t,e,r,i){if(Math.abs(i)<o.EPSILON)return n(t,e);var a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i*=.5;var s=Math.sin(i),u=s*r[0]/a,l=s*r[1]/a;r=s*r[2]/a,i=Math.cos(i),a=e[0],s=e[1];var h=e[2],f=e[3];return t[0]=a*i+f*u+s*r-h*l,t[1]=s*i+f*l+h*u-a*r,t[2]=h*i+f*r+a*l-s*u,t[3]=f*i-a*u-s*l-h*r,a=e[4],s=e[5],h=e[6],e=e[7],t[4]=a*i+e*u+s*r-h*l,t[5]=s*i+e*l+h*u-a*r,t[6]=h*i+e*r+a*l-s*u,t[7]=e*i-a*u-s*l-h*r,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},e.multiply=a,e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},e.lerp=function(t,e,r,i){var n=1-i;return 0>l(e,r)&&(i=-i),t[0]=e[0]*n+r[0]*i,t[1]=e[1]*n+r[1]*i,t[2]=e[2]*n+r[2]*i,t[3]=e[3]*n+r[3]*i,t[4]=e[4]*n+r[4]*i,t[5]=e[5]*n+r[5]*i,t[6]=e[6]*n+r[6]*i,t[7]=e[7]*n+r[7]*i,t},e.invert=function(t,e){var r=h(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},e.normalize=function(t,e){var r=h(e);if(0<r){r=Math.sqrt(r);var i=e[0]/r,n=e[1]/r,a=e[2]/r,o=e[3]/r,s=e[4],u=e[5],l=e[6],f=i*s+n*u+a*l+o*(e=e[7]);t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=(s-i*f)/r,t[5]=(u-n*f)/r,t[6]=(l-a*f)/r,t[7]=(e-o*f)/r}return t},e.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},e.equals=function(t,e){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],u=t[5],l=t[6];t=t[7];var h=e[0],f=e[1],c=e[2],d=e[3],v=e[4],p=e[5],g=e[6];return e=e[7],Math.abs(r-h)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-f)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-c)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-d)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-v)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-p)<=o.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))&&Math.abs(l-g)<=o.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(t-e)<=o.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.sqrLen=e.squaredLength=e.len=e.length=e.dot=e.mul=e.setReal=e.getReal=void 0;var o=r(No),s=r(Vo),u=r(Wo);e.getReal=s.copy,e.setReal=s.copy,e.mul=a;var l=s.dot;e.dot=l,t=s.length,e.length=t,e.len=t;var h=s.squaredLength;e.squaredLength=h,e.sqrLen=h}));i(Go);var qo=n((function(t,e){function r(){var t=new h.ARRAY_TYPE(2);return h.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function i(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function n(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function a(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function o(t,e){var r=e[0]-t[0];return t=e[1]-t[1],Math.sqrt(r*r+t*t)}function s(t,e){var r=e[0]-t[0];return r*r+(t=e[1]-t[1])*t}function u(t){var e=t[0];return t=t[1],Math.sqrt(e*e+t*t)}function l(t){var e=t[0];return e*e+(t=t[1])*t}Object.defineProperty(e,"__esModule",{value:!0}),e.create=r,e.clone=function(t){var e=new h.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var r=new h.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,r){return t[0]=e,t[1]=r,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},e.subtract=i,e.multiply=n,e.divide=a,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},e.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t},e.distance=o,e.squaredDistance=s,e.length=u,e.squaredLength=l,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},e.normalize=function(t,e){var r=e[0],i=e[1];return 0<(r=r*r+i*i)&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,r){return e=e[0]*r[1]-e[1]*r[0],t[0]=t[1]=0,t[2]=e,t},e.lerp=function(t,e,r,i){var n=e[0];return e=e[1],t[0]=n+i*(r[0]-n),t[1]=e+i*(r[1]-e),t},e.random=function(t,e){e=e||1;var r=2*h.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},e.transformMat2=function(t,e,r){var i=e[0];return e=e[1],t[0]=r[0]*i+r[2]*e,t[1]=r[1]*i+r[3]*e,t},e.transformMat2d=function(t,e,r){var i=e[0];return e=e[1],t[0]=r[0]*i+r[2]*e+r[4],t[1]=r[1]*i+r[3]*e+r[5],t},e.transformMat3=function(t,e,r){var i=e[0];return e=e[1],t[0]=r[0]*i+r[3]*e+r[6],t[1]=r[1]*i+r[4]*e+r[7],t},e.transformMat4=function(t,e,r){var i=e[0];return e=e[1],t[0]=r[0]*i+r[4]*e+r[12],t[1]=r[1]*i+r[5]*e+r[13],t},e.rotate=function(t,e,r,i){var n=e[0]-r[0];e=e[1]-r[1];var a=Math.sin(i);return i=Math.cos(i),t[0]=n*i-e*a+r[0],t[1]=n*a+e*i+r[1],t},e.angle=function(t,e){var r=t[0];t=t[1];var i=e[0];e=e[1];var n=r*r+t*t;0<n&&(n=1/Math.sqrt(n));var a=i*i+e*e;return 0<a&&(a=1/Math.sqrt(a)),1<(r=(r*i+t*e)*n*a)?0:-1>r?Math.PI:Math.acos(r)},e.zero=function(t){return t[0]=0,t[1]=0,t},e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},e.equals=function(t,e){var r=t[0];t=t[1];var i=e[0];return e=e[1],Math.abs(r-i)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(t-e)<=h.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.forEach=e.sqrLen=e.sqrDist=e.dist=e.div=e.mul=e.sub=e.len=void 0;var h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}(No);e.len=u,e.sub=i,e.mul=n,e.div=a,e.dist=o,e.sqrDist=s,e.sqrLen=l,t=function(){var t=r();return function(e,r,i,n,a,o){for(r||(r=2),i||(i=0),n=n?Math.min(n*r+i,e.length):e.length;i<n;i+=r)t[0]=e[i],t[1]=e[i+1],a(t,t,o),e[i]=t[0],e[i+1]=t[1];return e}}(),e.forEach=t}));i(qo);var Ko=n((function(t,e){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Ve&&on?on(t,r):{};i.get||i.set?Ve(e,r,i):e[r]=t[r]}return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0,t=r(No),e.glMatrix=t,t=r(Ho),e.mat2=t,t=r(jo),e.mat2d=t,t=r(Xo),e.mat3=t,t=r(Wo),e.mat4=t,t=r(Vo),e.quat=t,t=r(Go),e.quat2=t,t=r(qo),e.vec2=t,t=r(Yo),e.vec3=t,t=r(Zo),e.vec4=t}));i(Ko);var Qo=Ko.vec4,Jo=Ko.vec3,$o=Ko.vec2,ts=Ko.quat2,es=Ko.quat,rs=Ko.mat4,is=Ko.mat3,ns=Ko.mat2d,as=Ko.mat2,os=Ko.glMatrix,ss=i(n((function(t,e){e.__esModule=!0;var r=Ze&&Ze.__esModule?Ze:{default:Ze};e.default=function(t,e,i){return e in t?(0,r.default)(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}}))),us=function(){function t(e,r,i){Ut(this,t),this.options=r,this.gl=e,i&&(this.map=i.map),i=this.getVertexShader(r.vertexShader);var n=this.getFragmentShader(r.fragmentShader);r=e.createShader(e.VERTEX_SHADER),e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?(i=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?(n=e.createProgram(),e.attachShader(n,r),e.attachShader(n,i),e.deleteShader(r),e.deleteShader(i),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)?r=n:(r="Shader program failed to link.  The error log is:"+e.getProgramInfoLog(n),r=-1)):(r="Fragment shader failed to compile.  The error log is:"+e.getShaderInfoLog(i),r=-1)):(r="Vertex shader failed to compile.  The error log is:"+e.getShaderInfoLog(r),r=-1),r=this.program=r,i={},n=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(var a=0;a<n;a++){var o=e.getActiveAttrib(r,a);i[o.name]=e.getAttribLocation(r,o.name)}a={},o={};for(var s=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),u=0;u<s;u++){var l=e.getActiveUniform(r,u);a[l.name]=e.getUniformLocation(r,l.name),o[l.name]=l.type}this.parameter=e={attributes:i,numAttributes:n,uniformsType:o,uniforms:a},this.attributes=e.attributes,this.uniforms=e.uniforms,this.parameter=e}return Ge(t,[{key:"getVertexShader",value:function(t){var e="";return this.map&&"cesium"===this.map.type&&(e="#define LOG_DEPTH\n"),e+="#ifdef LOG_DEPTH\nuniform float currentFrustumX;varying float v_depthFromNearPlusOne;\n#endif\nuniform vec2 MAPV_resolution;\n#if defined(PICK)\nuniform bool uIsPickRender;attribute vec3 aPickColor;uniform vec3 uPickedColor;varying vec4 vPickColor;uniform bool uEnablePicked;bool mapvIsPicked(){return uEnablePicked&&aPickColor==uPickedColor;}\n#endif\nvoid afterMain(){\n#if defined(LOG_DEPTH)\nv_depthFromNearPlusOne=(gl_Position.w-currentFrustumX)+1.0;gl_Position.z=clamp(gl_Position.z/gl_Position.w,-1.0,1.0)*gl_Position.w;\n#endif\n#if defined(PICK)\nvPickColor=vec4(aPickColor,0.0);if(mapvIsPicked()){vPickColor.a=1.0;}\n#endif\n}",(t=(t=this.getDefines()+e+t).replace("void main","void originMain"))+"void main() {originMain(); afterMain();}"}},{key:"getFragmentShader",value:function(t){var e="";return this.map&&"cesium"===this.map.type&&(e="#define LOG_DEPTH\n"),e+="#if defined(LOG_DEPTH)\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;uniform vec2 MAPV_resolution;uniform bool uIsPickRender;\n#if defined(PICK)\nvarying vec4 vPickColor;bool mapvIsPicked(){return vPickColor.a==1.0;}\n#endif\n#if defined(LOG_DEPTH)\nuniform float oneOverLog2FarDepthFromNearPlusOne;uniform float farDepthFromNearPlusOne;varying float v_depthFromNearPlusOne;void writeLogDepth(float depth){if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}gl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;}\n#endif\nvoid afterMain(){\n#if defined(PICK)\nif(uIsPickRender){gl_FragColor=vec4(vPickColor.rgb,1.0);return;}\n#endif\n#if defined(LOG_DEPTH)\nwriteLogDepth(v_depthFromNearPlusOne);\n#endif\n}",(t=(t=this.getDefines()+e+t).replace("void main","void originMain"))+"void main() {originMain(); afterMain();}"}},{key:"getDefines",value:function(){var t="",e=this.options.defines;if(e)for(var r=0;r<e.length;r++)t+="#define "+e[r]+"\n";return t}},{key:"use",value:function(t,e){this.gl=t,t.useProgram(this.program),this.map&&"cesium"===this.map.type&&this.setUniforms({currentFrustumX:this.map.map.scene.camera.frustum.near,oneOverLog2FarDepthFromNearPlusOne:this.map.map.scene.context.uniformState.oneOverLog2FarDepthFromNearPlusOne,farDepthFromNearPlusOne:this.map.map.scene.context.uniformState.farDepthFromNearPlusOne}),this.uniforms.MAPV_resolution&&this.setUniforms({MAPV_resolution:[t.canvas.width,t.canvas.height]})}},{key:"setUniform",value:function(t,e){var r=this.gl,i=this.uniforms[t];if(i)switch(this.parameter.uniformsType[t]){case r.FLOAT:r.uniform1f(i,e);break;case r.FLOAT_VEC2:r.uniform2f(i,e[0],e[1]);break;case r.FLOAT_VEC3:r.uniform3f(i,e[0],e[1],e[2]);break;case r.FLOAT_VEC4:r.uniform4f(i,e[0],e[1],e[2],e[3]);break;case r.SAMPLER_2D:case r.SAMPLER_CUBE:r.activeTexture(r["TEXTURE"+this.textureIndex]),r.uniform1i(i,this.textureIndex),r.bindTexture(r.TEXTURE_2D,e),this.textureIndex++;break;case r.INT:case r.BOOL:r.uniform1i(i,e);break;case r.INT_VEC2:case r.BOOL_VEC2:r.uniform2i(i,e[0],e[1]);break;case r.INT_VEC3:case r.BOOL_VEC3:r.uniform3i(i,e[0],e[1],e[2]);break;case r.INT_VEC4:case r.BOOL_VEC4:r.uniform4i(i,e[0],e[1],e[2],e[3]);break;case r.FLOAT_MAT2:r.uniformMatrix2fv(i,!1,e);break;case r.FLOAT_MAT3:r.uniformMatrix3fv(i,!1,e);break;case r.FLOAT_MAT4:r.uniformMatrix4fv(i,!1,e)}}},{key:"setUniforms",value:function(t){for(var e in this.textureIndex=0,t)this.setUniform(e,t[e])}}]),t}(),ls=function(t,e,r,i){var n=r?r.call(i,t,e):void 0;if(void 0!==n)return!!n;if(t===e)return!0;if("object"!==(void 0===t?"undefined":gi(t))||!t||"object"!==(void 0===e?"undefined":gi(e))||!e)return!1;var a=Le(t),o=Le(e);if(a.length!==o.length)return!1;o=Object.prototype.hasOwnProperty.bind(e);for(var s=0;s<a.length;s++){if(!o(n=a[s]))return!1;var u=t[n],l=e[n];if(!1===(n=r?r.call(i,u,l,n):void 0)||void 0===n&&u!==l)return!1}return!0},hs=function(){function t(e){Ut(this,t),this.options=e,this.gl=e.gl,this.savedState=[],this.currentState=this.getDefaultState()}return Ge(t,[{key:"setDefaultState",value:function(){this.setState()}},{key:"getDefaultState",value:function(){var t=this.gl;return{blend:!1,blendEquation:t.FUNC_ADD,blendFunc:[t.ONE,t.ZERO],depthMask:!0,depthTest:!0,depthFunc:t.LEQUAL,polygonOffset:[0,0],cullFace:!1,stencilTest:!1}}},{key:"getRealState",value:function(){var t=this.gl;return{blend:t.getParameter(t.BLEND),blendEquation:t.getParameter(t.BLEND_EQUATION),depthMask:t.getParameter(t.DEPTH_WRITEMASK),depthTest:t.getParameter(t.DEPTH_TEST),depthFunc:t.getParameter(t.DEPTH_FUNC),polygonOffset:[t.getParameter(t.POLYGON_OFFSET_FACTOR),t.getParameter(t.POLYGON_OFFSET_UNITS)],cullFace:t.getParameter(t.CULL_FACE),stencilTest:t.getParameter(t.STENCIL_TEST)}}},{key:"getCurrentState",value:function(){return this.currentState}},{key:"save",value:function(){this.savedState.push(this.getCurrentState())}},{key:"restore",value:function(){var t=this.savedState.pop();this.setState(t,{force:!0})}},{key:"setState",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};t=ze(this.getDefaultState(),t),this.setBlend(t,e),this.setDepth(t,e),this.setCullFace(t,e),this.setPolygonOffset(t,e),this.setStencil(t,e),this.currentState=t}},{key:"setBlend",value:function(t,e){var r=this.gl,i=this.getCurrentState();!(e=e.force)&&ls(t.blend,i.blend)||(t.blend?r.enable(r.BLEND):r.disable(r.BLEND)),!e&&ls(t.blendEquation,i.blendEquation)||r.blendEquation(t.blendEquation),!e&&ls(t.blendFunc,i.blendFunc)||r.blendFunc(t.blendFunc[0],t.blendFunc[1])}},{key:"setDepth",value:function(t,e){var r=this.gl,i=this.getCurrentState();!(e=e.force)&&ls(t.depthTest,i.depthTest)||(t.depthTest?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST)),!e&&ls(t.depthMask,i.depthMask)||(t.depthMask?r.depthMask(!0):r.depthMask(!1)),!e&&ls(t.depthFunc,i.depthFunc)||r.depthFunc(t.depthFunc)}},{key:"setPolygonOffset",value:function(t,e){var r=this.gl,i=this.getCurrentState();!e.force&&ls(t.polygonOffset,i.polygonOffset)||(0!==t.polygonOffset[0]&&0!==t.polygonOffset[1]?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.polygonOffset(t.polygonOffset[0],t.polygonOffset[1]))}},{key:"setCullFace",value:function(t,e){var r=this.gl,i=this.getCurrentState();!e.force&&ls(t.cullFace,i.cullFace)||(t.cullFace?(r.enable(r.CULL_FACE),r.cullFace(r.BACK)):r.disable(r.CULL_FACE))}},{key:"setStencil",value:function(t,e){var r=this.gl,i=this.getCurrentState();!e.force&&ls(t.stencilTest,i.stencilTest)||(t.stencilTest?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST))}}]),t}(),fs=function(){function t(e){Ut(this,t),this.options=e,this.gl=e.gl,this.buffer=this.gl.createBuffer(),e.data&&this.updateData(e.data)}return Ge(t,[{key:"updateData",value:function(t){var e=this.options,r=this.gl;this.bind(),r.bufferData(r[e.target],t,r[e.usage])}},{key:"bind",value:function(t){(t=t||this.gl).bindBuffer(t[this.options.target],this.buffer)}},{key:"unBind",value:function(t){(t=t||this.gl).bindBuffer(t[this.options.target],null)}},{key:"destroy",value:function(){this.buffer=null}}]),t}(),cs={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FLOAT:4},ds=function(){function t(e){for(Ut(this,t),this.options=e,this.attributes=e.attributes,this.gl=e.gl,this.program=e.program,e=this.stride=0;e<this.attributes.length;e++)this.stride+=cs[this.attributes[e].type]*this.attributes[e].size}return Ge(t,[{key:"setVertexAttribPointers",value:function(){for(var t=this.gl,e=this.program,r=0;r<this.attributes.length;r++){var i=this.attributes[r],n=e.attributes[i.name];void 0!==n&&(i.buffer.bind(t),t.vertexAttribPointer(n,i.size,t[i.type],i.normalize||!1,void 0!==i.stride?i.stride:this.stride,i.offset),t.enableVertexAttribArray(n))}}},{key:"bind",value:function(){this.setVertexAttribPointers()}},{key:"destroy",value:function(){}}]),t}(),vs=function t(e,r,i){Ut(this,t),r=r||e.canvas.width,i=i||e.canvas.height;var n=e.createFramebuffer(),a=e.createTexture();e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n.texture=a;var o=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,o),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r,i),n.depthBuffer=o,e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,o),r=e.checkFramebufferStatus(e.FRAMEBUFFER),e.FRAMEBUFFER_COMPLETE===r&&(e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),this.framebuffer=n)},ps=function(){function t(e){Ut(this,t),this.options={},ze(this.options,e),this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0],this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}return Ge(t,[{key:"getOptions",value:function(){return this.options}},{key:"onResize",value:function(t){}},{key:"render",value:function(t){var e=t.gl;t=t.texture;var r=this.programSample;e.useProgram(r.program);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);var n=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aPos),e.vertexAttribPointer(r.attributes.aPos,3,e.FLOAT,!1,0,0),i=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aTextureCoord),e.vertexAttribPointer(r.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(r.uniforms.uSampler,0),e.drawArrays(e.TRIANGLES,0,n.length/3)}}]),t}(),gs=function(t){function e(t){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t))}return Mi(e,t),Ge(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new us(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(void){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;vec4 fxaa_2_0(sampler2D tex,vec2 fragCoord,vec2 resolution,vec2 v_rgbNW,vec2 v_rgbNE,vec2 v_rgbSW,vec2 v_rgbSE,vec2 v_rgbM){vec4 color;mediump vec2 inverseVP=vec2(1.0/resolution.x,1.0/resolution.y);vec3 rgbNW=texture2D(tex,v_rgbNW).xyz;vec3 rgbNE=texture2D(tex,v_rgbNE).xyz;vec3 rgbSW=texture2D(tex,v_rgbSW).xyz;vec3 rgbSE=texture2D(tex,v_rgbSE).xyz;vec4 texColor=texture2D(tex,v_rgbM);vec3 rgbM=texColor.xyz;vec3 luma=vec3(0.299,0.587,0.114);float lumaNW=dot(rgbNW,luma);float lumaNE=dot(rgbNE,luma);float lumaSW=dot(rgbSW,luma);float lumaSE=dot(rgbSE,luma);float lumaM=dot(rgbM,luma);float lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));float lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));mediump vec2 dir;dir.x=-((lumaNW+lumaNE)-(lumaSW+lumaSE));dir.y=((lumaNW+lumaSW)-(lumaNE+lumaSE));float dirReduce=max((lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*1.0/8.0),1.0/128.0);float rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);dir=min(vec2(8.0,8.0),max(vec2(-8.0,-8.0),dir*rcpDirMin))*inverseVP;vec3 rgbA=0.5*(texture2D(tex,fragCoord*inverseVP+dir*(1.0/3.0-0.5)).xyz+texture2D(tex,fragCoord*inverseVP+dir*(2.0/3.0-0.5)).xyz);vec3 rgbB=rgbA*0.5+0.25*(texture2D(tex,fragCoord*inverseVP+dir*-0.5).xyz+texture2D(tex,fragCoord*inverseVP+dir*0.5).xyz);float lumaB=dot(rgbB,luma);if((lumaB<lumaMin)||(lumaB>lumaMax)){color=vec4(rgbA,texColor.a);}else{color=vec4(rgbB,texColor.a);}return color;}void texcoords_3_1(vec2 fragCoord,vec2 resolution,out vec2 v_rgbNW,out vec2 v_rgbNE,out vec2 v_rgbSW,out vec2 v_rgbSE,out vec2 v_rgbM){vec2 inverseVP=1.0/resolution.xy;v_rgbNW=(fragCoord+vec2(-1.0,-1.0))*inverseVP;v_rgbNE=(fragCoord+vec2(1.0,-1.0))*inverseVP;v_rgbSW=(fragCoord+vec2(-1.0,1.0))*inverseVP;v_rgbSE=(fragCoord+vec2(1.0,1.0))*inverseVP;v_rgbM=vec2(fragCoord*inverseVP);}vec4 apply_1_2(sampler2D tex,vec2 fragCoord,vec2 resolution){mediump vec2 v_rgbNW;mediump vec2 v_rgbNE;mediump vec2 v_rgbSW;mediump vec2 v_rgbSE;mediump vec2 v_rgbM;texcoords_3_1(fragCoord,resolution,v_rgbNW,v_rgbNE,v_rgbSW,v_rgbSE,v_rgbM);return fxaa_2_0(tex,fragCoord,resolution,v_rgbNW,v_rgbNE,v_rgbSW,v_rgbSE,v_rgbM);}void main(void){vec2 fragCoord=vTextureCoord*canvasSize;gl_FragColor=apply_1_2(uSampler,fragCoord,canvasSize);}"})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture,this.getOptions(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var r=this.getProgram(e);e.useProgram(r.program);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aPos),e.vertexAttribPointer(r.attributes.aPos,3,e.FLOAT,!1,0,0),i=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aTextureCoord),e.vertexAttribPointer(r.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(r.uniforms.uSampler,1),e.uniform2fv(r.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(ps),ms=function(t){function e(t){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t))}return Mi(e,t),Ge(e,[{key:"getProgram",value:function(t){if(this.program1||(this.program1=new us(t,{vertexShader:"attribute vec3 position;attribute vec2 uv;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];void SMAAEdgeDetectionVS(vec2 texcoord){vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-1.0,0.0,0.0,1.0);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(1.0,0.0,0.0,-1.0);vOffset[2]=texcoord.xyxy+resolution.xyxy*vec4(-2.0,0.0,0.0,2.0);}void main(){vUv=uv;SMAAEdgeDetectionVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:"precision highp float;\n#define SMAA_THRESHOLD 0.1\nuniform sampler2D tDiffuse;varying vec2 vUv;varying vec4 vOffset[3];vec4 SMAAColorEdgeDetectionPS(vec2 texcoord,vec4 offset[3],sampler2D colorTex){vec2 threshold=vec2(SMAA_THRESHOLD,SMAA_THRESHOLD);vec4 delta;vec3 C=texture2D(colorTex,texcoord).rgb;vec3 Cleft=texture2D(colorTex,offset[0].xy).rgb;vec3 t=abs(C-Cleft);delta.x=max(max(t.r,t.g),t.b);vec3 Ctop=texture2D(colorTex,offset[0].zw).rgb;t=abs(C-Ctop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0,1.0))==0.0)discard;vec3 Cright=texture2D(colorTex,offset[1].xy).rgb;t=abs(C-Cright);delta.z=max(max(t.r,t.g),t.b);vec3 Cbottom=texture2D(colorTex,offset[1].zw).rgb;t=abs(C-Cbottom);delta.w=max(max(t.r,t.g),t.b);float maxDelta=max(max(max(delta.x,delta.y),delta.z),delta.w);vec3 Cleftleft=texture2D(colorTex,offset[2].xy).rgb;t=abs(C-Cleftleft);delta.z=max(max(t.r,t.g),t.b);vec3 Ctoptop=texture2D(colorTex,offset[2].zw).rgb;t=abs(C-Ctoptop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(max(maxDelta,delta.z),delta.w);edges.xy*=step(0.5*maxDelta,delta.xy);return vec4(edges,0.0,0.0);}void main(){gl_FragColor=SMAAColorEdgeDetectionPS(vUv,vOffset,tDiffuse);}"})),this.program2||(this.program2=new us(t,{vertexShader:"precision highp float;\n#define SMAA_MAX_SEARCH_STEPS 8\n#define SMAA_AREATEX_MAX_DISTANCE 16\n#define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )\n#define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )\nattribute vec3 position;attribute vec2 uv;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixcoord;void SMAABlendingWeightCalculationVS(vec2 texcoord){vPixcoord=texcoord/resolution;vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-0.25,0.125,1.25,0.125);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(-0.125,0.25,-0.125,-1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*resolution.xxyy*float(SMAA_MAX_SEARCH_STEPS);}void main(){vUv=uv;SMAABlendingWeightCalculationVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:"precision highp float;\n#define SMAA_MAX_SEARCH_STEPS 8\n#define SMAA_AREATEX_MAX_DISTANCE 16\n#define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )\n#define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )\n#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )\nuniform sampler2D tDiffuse;uniform sampler2D tArea;uniform sampler2D tSearch;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixcoord;vec2 round(vec2 x){return sign(x)*floor(abs(x)+0.5);}float SMAASearchLength(sampler2D searchTex,vec2 e,float bias,float scale){e.r=bias+e.r*scale;return 255.0*texture2D(searchTex,e,0.0).r;}float SMAASearchXLeft(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){/***@PSEUDO_GATHER4*This texcoord has been offset by(-0.25,-0.125)in the vertex shader to*sample between edge,thus fetching four edges in a row.*Sampling with different offsets in each direction allows to disambiguate*which edges are active from the four fetched ones.*/vec2 e=vec2(0.0,1.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord-=vec2(2.0,0.0)*resolution;if(!(texcoord.x>end&&e.g>0.8281&&e.r==0.0))break;}texcoord.x+=0.25*resolution.x;texcoord.x+=resolution.x;texcoord.x+=2.0*resolution.x;texcoord.x-=resolution.x*SMAASearchLength(searchTex,e,0.0,0.5);return texcoord.x;}float SMAASearchXRight(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord+=vec2(2.0,0.0)*resolution;if(!(texcoord.x<end&&e.g>0.8281&&e.r==0.0))break;}texcoord.x-=0.25*resolution.x;texcoord.x-=resolution.x;texcoord.x-=2.0*resolution.x;texcoord.x+=resolution.x*SMAASearchLength(searchTex,e,0.5,0.5);return texcoord.x;}float SMAASearchYUp(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord+=vec2(0.0,2.0)*resolution;if(!(texcoord.y>end&&e.r>0.8281&&e.g==0.0))break;}texcoord.y-=0.25*resolution.y;texcoord.y-=resolution.y;texcoord.y-=2.0*resolution.y;texcoord.y+=resolution.y*SMAASearchLength(searchTex,e.gr,0.0,0.5);return texcoord.y;}float SMAASearchYDown(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord-=vec2(0.0,2.0)*resolution;if(!(texcoord.y<end&&e.r>0.8281&&e.g==0.0))break;}texcoord.y+=0.25*resolution.y;texcoord.y+=resolution.y;texcoord.y+=2.0*resolution.y;texcoord.y-=resolution.y*SMAASearchLength(searchTex,e.gr,0.5,0.5);return texcoord.y;}vec2 SMAAArea(sampler2D areaTex,vec2 dist,float e1,float e2,float offset){vec2 texcoord=float(SMAA_AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texcoord=SMAA_AREATEX_PIXEL_SIZE*texcoord+(0.5*SMAA_AREATEX_PIXEL_SIZE);texcoord.y+=SMAA_AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTex,texcoord,0.0).rg;}vec4 SMAABlendingWeightCalculationPS(vec2 texcoord,vec2 pixcoord,vec4 offset[3],sampler2D edgesTex,sampler2D areaTex,sampler2D searchTex,ivec4 subsampleIndices){vec4 weights=vec4(0.0,0.0,0.0,0.0);vec2 e=texture2D(edgesTex,texcoord).rg;if(e.g>0.0){vec2 d;vec2 coords;coords.x=SMAASearchXLeft(edgesTex,searchTex,offset[0].xy,offset[2].x);coords.y=offset[1].y;d.x=coords.x;float e1=texture2D(edgesTex,coords,0.0).r;coords.x=SMAASearchXRight(edgesTex,searchTex,offset[0].zw,offset[2].y);d.y=coords.x;d=d/resolution.x-pixcoord.x;vec2 sqrt_d=sqrt(abs(d));coords.y-=1.0*resolution.y;float e2=SMAASampleLevelZeroOffset(edgesTex,coords,ivec2(1,0)).r;weights.rg=SMAAArea(areaTex,sqrt_d,e1,e2,float(subsampleIndices.y));}if(e.r>0.0){vec2 d;vec2 coords;coords.y=SMAASearchYUp(edgesTex,searchTex,offset[1].xy,offset[2].z);coords.x=offset[0].x;d.x=coords.y;float e1=texture2D(edgesTex,coords,0.0).g;coords.y=SMAASearchYDown(edgesTex,searchTex,offset[1].zw,offset[2].w);d.y=coords.y;d=d/resolution.y-pixcoord.y;vec2 sqrt_d=sqrt(abs(d));coords.y-=1.0*resolution.y;float e2=SMAASampleLevelZeroOffset(edgesTex,coords,ivec2(0,1)).g;weights.ba=SMAAArea(areaTex,sqrt_d,e1,e2,float(subsampleIndices.x));}return weights;}void main(){gl_FragColor=SMAABlendingWeightCalculationPS(vUv,vPixcoord,vOffset,tDiffuse,tArea,tSearch,ivec4(0.0));}"})),this.program3||(this.program3=new us(t,{vertexShader:"precision highp float;uniform vec2 resolution;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;varying vec4 vOffset[2];void SMAANeighborhoodBlendingVS(vec2 texcoord){vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-1.0,0.0,0.0,1.0);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(1.0,0.0,0.0,-1.0);}void main(){vUv=uv;SMAANeighborhoodBlendingVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:"precision highp float;uniform sampler2D tDiffuse;uniform sampler2D tColor;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[2];vec4 SMAANeighborhoodBlendingPS(vec2 texcoord,vec4 offset[2],sampler2D colorTex,sampler2D blendTex){vec4 a;a.xz=texture2D(blendTex,texcoord).xz;a.y=texture2D(blendTex,offset[1].zw).g;a.w=texture2D(blendTex,offset[1].xy).a;if(dot(a,vec4(1.0,1.0,1.0,1.0))<1e-5){return texture2D(colorTex,texcoord,0.0);}else{vec2 offset;offset.x=a.a>a.b ? a.a :-a.b;offset.y=a.g>a.r ?-a.g : a.r;if(abs(offset.x)>abs(offset.y)){offset.y=0.0;}else{offset.x=0.0;}vec4 C=texture2D(colorTex,texcoord,0.0);texcoord+=sign(offset)*resolution;vec4 Cop=texture2D(colorTex,texcoord,0.0);float s=abs(offset.x)>abs(offset.y)? abs(offset.x): abs(offset.y);C.xyz=pow(C.xyz,vec3(2.2));Cop.xyz=pow(Cop.xyz,vec3(2.2));vec4 mixed=mix(C,Cop,s);mixed.xyz=pow(mixed.xyz,vec3(1.0/2.2));return mixed;}}void main(){gl_FragColor=SMAANeighborhoodBlendingPS(vUv,vOffset,tColor,tDiffuse);}"})),!this.vertexBuffer||!this.sampleBuffer){this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord));var e=[{stride:12,name:"position",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"uv",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}];this.vertexArray1=new ds({gl:t,program:this.program1,attributes:e}),this.vertexArray2=new ds({gl:t,program:this.program2,attributes:e}),this.vertexArray3=new ds({gl:t,program:this.program3,attributes:e})}return{program1:this.program1,program2:this.program2,program3:this.program3}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new vs(t),this.bloomBuffer=new vs(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new vs(t)),this.bloomBuffer||(this.bloomBuffer=new vs(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,r=t.texture;t=t.fbo,this.getOptions(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var i=this.getProgram(e),n=i.program1,a=i.program2;i=i.program3;var o=this.getExtraFbo(e),s=o.collectBrightBuffer;o=o.bloomBuffer;var u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(n.attributes.position),e.vertexAttribPointer(n.attributes.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.position),e.vertexAttribPointer(a.attributes.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(i.attributes.position),e.vertexAttribPointer(i.attributes.position,3,e.FLOAT,!1,0,0),u=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(n.attributes.uv),e.vertexAttribPointer(n.attributes.uv,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.uv),e.vertexAttribPointer(a.attributes.uv,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(i.attributes.uv),e.vertexAttribPointer(i.attributes.uv,2,e.FLOAT,!1,0,0),e.useProgram(n.program),e.bindFramebuffer(e.FRAMEBUFFER,s),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(n.uniforms.tDiffuse,2),e.uniform2fv(n.uniforms.resolution,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,o),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,s.texture),e.uniform1i(a.uniforms.uSampler,2),e.uniform2fv(a.uniforms.resolution,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(i.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(i.uniforms.tDiffuse,2),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,o.texture),e.uniform1i(i.uniforms.tColor,3),e.uniform2fv(i.uniforms.resolution,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}},{key:"getAreaTexture",value:function(){return"data:image/png;base64,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"}},{key:"getSearchTexture",value:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAIAAADiVupLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFZJREFUeNrs00EKgAAIRNEZ739mTQoiwmhRi4L/FiKiu9ERISkzbXdTVV3H4WhfOG6ehl1rNR7qDSF8hwkVcJXt+3A//I0Nv0GoCBUAAAAAAMA/LAIMAB+Dcg2OE2zsAAAAAElFTkSuQmCC"}}]),e}(ps),xs=function(t){function e(t){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t))}return Mi(e,t),Ge(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new us(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord)),this.vertexArray=new ds({gl:t,program:this.programSample,attributes:[{stride:12,name:"aPos",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"aTextureCoord",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}]})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture,e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var r=this.getProgram(e);r.use(e),this.vertexArray.bind(),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(r.uniforms.uSampler,1),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),e}(ps),ys=function(t){function e(t){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t))}return Mi(e,t),Ge(e,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new us(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-(1.0-threshold)/5.0));float brightness=dot(color.rgb,vec3(0.2126,0.7152,0.0722));if(brightness>threshold){color=lightColor;}else{color=vec4(0.0);}gl_FragColor=color;}"})),this.programBloom||(this.programBloom=new us(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new us(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord);vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new vs(t),this.bloomBuffer=new vs(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new vs(t)),this.bloomBuffer||(this.bloomBuffer=new vs(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,r=t.texture;t=t.fbo;var i=this.getOptions();e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var n=this.getProgram(e),a=n.programBright,o=n.programBloom;n=n.programResult;var s=this.getExtraFbo(e),u=s.collectBrightBuffer;s=s.bloomBuffer;var l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n.attributes.aPos),e.vertexAttribPointer(n.attributes.aPos,3,e.FLOAT,!1,0,0),l=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n.attributes.aTextureCoord),e.vertexAttribPointer(n.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(a.uniforms.uSampler,1),e.uniform1f(a.uniforms.threshold,i.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,s),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(o.uniforms.uSampler,1),e.uniform1i(o.uniforms.isVertical,!0),e.uniform1f(o.uniforms.blurSize,i.blurSize||2),e.uniform1f(o.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(o.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,s.texture),e.uniform1i(o.uniforms.uSampler,1),e.uniform1i(o.uniforms.isVertical,!1),e.uniform1f(o.uniforms.blurSize,i.blurSize||2),e.uniform1f(o.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(o.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(n.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(n.uniforms.originalTexture,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(n.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(ps),bs=function(t){function e(t){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t))}return Mi(e,t),Ge(e,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new us(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-threshold));gl_FragColor=lightColor;}"})),this.programBloom||(this.programBloom=new us(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new us(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;uniform float toneScale;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord)*toneScale;vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new vs(t),this.bloomBuffer=new vs(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new vs(t)),this.bloomBuffer||(this.bloomBuffer=new vs(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,r=t.texture;t=t.fbo;var i=this.getOptions(),n="clarity"in i?i.clarity:1;n=Math.max(0,n),n=Math.min(1,n),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var a=this.getProgram(e),o=a.programBright,s=a.programBloom;a=a.programResult;var u=this.getExtraFbo(e),l=u.collectBrightBuffer;u=u.bloomBuffer;var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aPos),e.vertexAttribPointer(s.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),h=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aTextureCoord),e.vertexAttribPointer(s.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(o.uniforms.uSampler,1),e.uniform1f(o.uniforms.threshold,i.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(s.uniforms.uSampler,1),e.uniform1i(s.uniforms.isVertical,!0),e.uniform1f(s.uniforms.blurSize,i.blurSize||2),e.uniform1f(s.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(s.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(s.uniforms.uSampler,1),e.uniform1i(s.uniforms.isVertical,!1),e.uniform1f(s.uniforms.blurSize,i.blurSize||2),e.uniform1f(s.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(s.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(a.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(a.uniforms.originalTexture,1),e.uniform1f(a.uniforms.toneScale,n),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(a.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(ps),_s=function(t){function e(t){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t))}return Mi(e,t),Ge(e,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new us(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture;var r=this.getProgram(e);e.useProgram(r.program);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aPos),e.vertexAttribPointer(r.attributes.aPos,3,e.FLOAT,!1,0,0),i=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(r.attributes.aTextureCoord),e.vertexAttribPointer(r.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(r.uniforms.uSampler,1),e.uniform2fv(r.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),e}(ps),As=function(){function t(e){Ut(this,t),this.gl=e,this.effects=[],this.initFbo()}return Ge(t,[{key:"addEffect",value:function(t){this.effects.push(t)}},{key:"removeEffect",value:function(t){}},{key:"setEffects",value:function(t){this.effects=t}},{key:"onResize",value:function(){this.initFbo();var t=this.gl,e=this.effects;if(e&&1<e.length)for(var r=1;r<e.length;r++){var i=e[r];i.onResize&&i.onResize(t)}}},{key:"initFbo",value:function(){var t=this.gl;t&&(this.fbo=[new vs(t),new vs(t)])}},{key:"destroy",value:function(){this.effects=[],this.fbo=[],this.gl=null}},{key:"render",value:function(){var t=this.gl,e=this.effects;if(e&&0<e.length)for(var r={},i=0;i<e.length;i++){var n=this.fbo[i%2].framebuffer;i===e.length-1&&(n=null),t.bindFramebuffer(t.FRAMEBUFFER,n);var a=[0,0,0,0];t.clearColor(a[0],a[1],a[2],a[3]),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e[i].render({isPickRender:!1,gl:t,texture:r.texture,fbo:n}),r=n}}}]),t}(),Ts=function(){function t(e,r){Ut(this,t),this.map=e,this.options=r||{},this.eventMap={}}return Ge(t,[{key:"onResize",value:function(t){}},{key:"onUpdate",value:function(t){throw"未实现onUpdate方法"}},{key:"getContainer",value:function(){throw"未实现getContainer方法"}},{key:"getSize",value:function(){throw"未实现getSize方法"}},{key:"getTilt",value:function(){throw"未实现getTilt方法"}},{key:"getHeading",value:function(){throw"未实现getHeading方法"}},{key:"getZoomUnits",value:function(){throw"未实现getZoomUnits方法"}},{key:"getCenter",value:function(){throw"未实现getCenter方法"}},{key:"getMapType",value:function(){throw"未实现getMapType方法"}},{key:"lnglatToMercator",value:function(t,e){return"gcj02"===this.options.coordinateSystem?(e=e*Math.PI/180,e=3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e))),[parseFloat((t*Math.PI/180*6378137).toFixed(2)),parseFloat(e.toFixed(2))]):[(t=y.convertLL2MC({lng:t,lat:e})).lng,t.lat]}}]),t}(),ws=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).eventMap={},t}return Mi(e,t),Ge(e,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onMousemove",value:function(t){t=this.extendCallback(t),this.map.addEventListener("mousemove",t),this.eventMap.mousemove=t}},{key:"onClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("click",t),this.eventMap.click=t}},{key:"onDblClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("dblclick",t),this.eventMap.dblclick=t}},{key:"onRightClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("rightclick",t),this.eventMap.rightclick=t}},{key:"onUpdate",value:function(t){this.map.addEventListener("update",t),this.map.addEventListener("onearthstatuschange",t),this.eventMap.update=t,this.eventMap.onearthstatuschange=t}},{key:"extendCallback",value:function(t){return function(e){t(ze(e,{x:e.x,y:e.y}))}}},{key:"unbind",value:function(t){var e=this;this.eventMap[t]?(this.map.removeEventListener(t,this.eventMap[t]),delete this.eventMap[t]):(Le(this.eventMap).forEach((function(t){e.map.removeEventListener(t,e.eventMap[t])})),this.eventMap={})}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getBounds",value:function(){return this.map.getBounds()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},{key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var t=this.map.getCenter();return-180<=t.lng&&180>=t.lng&&(t={lng:(t=this.map.lnglatToMercator(t.lng,t.lat))[0],lat:t[1]}),t}},{key:"getMapType",value:function(){return this.map.getMapType()}},{key:"lnglatToMercator",value:function(t,e){return this.map.lnglatToMercator(t,e)}},{key:"mercatorToLnglat",value:function(t,e){return this.map.mercatorToLnglat(t,e)}}]),e}(Ts),Ms=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).div=document.createElement("div"),t.div.style.position="absolute",t.div.style.userSelect="none",t.map.getPanes().mapPane.appendChild(t.div),t.eventMap={},t}return Mi(e,t),Ge(e,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onMousemove",value:function(t){t=this.extendCallback(t),this.map.addEventListener("mousemove",t),this.eventMap.mousemove=t}},{key:"onClick",value:function(t){t=this.extendCallback(t),An?(this.map.addEventListener("touchend",t),this.eventMap.touchend=t):(this.map.addEventListener("click",t),this.eventMap.click=t)}},{key:"onDblClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("dblclick",t),this.eventMap.dblclick=t}},{key:"onRightClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("rightclick",t),this.eventMap.rightclick=t}},{key:"changeCanvas",value:function(){var t=this.map,e=t.getSize(),r=t.getCenter();t=t.pointToOverlayPixel(r),this.div.style.left=t.x-e.width/2+"px",this.div.style.top=t.y-e.height/2+"px"}},{key:"onUpdate",value:function(t){var e=this,r=function(){e.changeCanvas(),t()};this.map.addEventListener("moveend",r),this.map.addEventListener("moving",r),this.map.addEventListener("zoomend",r),this.eventMap.moveend=r,this.eventMap.moving=r,this.eventMap.zoomend=r}},{key:"extendCallback",value:function(t){return function(e){t(ze(e,{x:e.pixel.x,y:e.pixel.y}))}}},{key:"unbind",value:function(){var t=this;Le(this.eventMap).forEach((function(e){t.map.removeEventListener(e,t.eventMap[e])})),this.eventMap={}}},{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getBounds",value:function(){return this.map.getBounds()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",value:function(){return 0}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getZoomUnits",value:function(){var t=this.getZoom();return this.map.getMapType().getZoomUnits?this.map.getMapType().getZoomUnits(t):Math.pow(2,18-t)}},{key:"getCenter",value:function(){var t=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:t.x,lat:t.y}}},{key:"lnglatToMercator",value:function(t,e){return[(t=this.map.getMapType().getProjection().lngLatToPoint({lng:t,lat:e})).x,t.y]}},{key:"mercatorToLnglat",value:function(t,e){return[(t=this.map.getMapType().getProjection().pointToLngLat({lng:t,lat:e})).lng,t.lat]}}]),e}(Ts),Cs=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).eventMap={},t}return Mi(e,t),Ge(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;Le(this.eventMap).forEach((function(e){window.removeEventListener(e,t.eventMap[e])})),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},{key:"getSize",value:function(){var t=this.map;return{width:t.canvas.clientWidth,height:t.canvas.clientHeight}}},{key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/Math.PI}},{key:"getZoomUnits",value:function(){var t=this.map;return 6.8*t.scene.globe.ellipsoid.cartesianToCartographic(t.camera.position).height/6500}},{key:"getZoom",value:function(){return 10}},{key:"getCenter",value:function(){var t=this.map;return t=t.camera.pickEllipsoid(new Cesium.Cartesian2(t.canvas.clientWidth/2,t.canvas.clientHeight/2)),t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),{lng:(t=this.getMercator([180*t.longitude/Math.PI,180*t.latitude/Math.PI]))[0],lat:t[1]}}},{key:"getMercator",value:function(t){var e=[];return e[0]=t[0]*Math.PI/180*6378137,t=t[1]*Math.PI/180,e[1]=3189068.5*Math.log((1+Math.sin(t))/(1-Math.sin(t))),e}}]),e}(Ts),Rs=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).eventMap={},t}return Mi(e,t),Ge(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;Le(this.eventMap).forEach((function(e){window.removeEventListener(e,t.eventMap[e])})),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getZoom",value:function(){return this.map.zoom}},{key:"getCenter",value:function(){return this.map.center}}]),e}(Ts),Ss=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).eventMap={},t}return Mi(e,t),Ge(e,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;Le(this.eventMap).forEach((function(e){window.removeEventListener(e,t.eventMap[e])})),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]),e}(Ts),Ps=function(){function t(e,r){var i=this;Ut(this,t),"bmap"===(r=r||{}).mapType?this.map=new Ms(e,r):"blank"===r.mapType?this.map=new Rs(e,r):"cesium"===r.mapType?this.map=new Cs(e,r):"three"===r.mapType?this.map=new Ss(e,r):(r.mapType="bmapgl",this.map=new ws(e,r)),this.map.type=r.mapType,this._dpr=window.devicePixelRatio,"bmapgl"===r.mapType&&(this._dpr=this.map.map.config.ratio),this.options=r||{},this.renderArr=[],(e=r.canvas)||(e=document.createElement("canvas")),this.canvas=e,this.gl=r.gl?r.gl:N(e,r),["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"].forEach((function(t){i.gl.getExtension(t)})),this.changeSize(),this.projectionMatrix=rs.create(Float64Array),this.orthoMatrix=rs.create(Float64Array),this.matrix=rs.create(Float64Array),this.viewMatrix=rs.create(Float64Array),this.pointToPixelMatrix=rs.create(Float64Array),this.pixelToViewMatrix=rs.create(Float64Array),this.fovy=35,this.fps=Math.min(r.fps,60)||60,this.renderTime=(new Date).valueOf(),this._animation=this.animation.bind(this),this._update=this.update.bind(this),this.onInitialize(this.options.onInitialize),this.options.onRender&&this.renderArr.push(this.options.onRender),this.stateManager=new hs({gl:this.gl}),this.pickFBO=new vs(this.gl),this.transferOptions={},this.bind()}return Ge(t,[{key:"bind",value:function(){var t=this,e=this.map;e.onResize((function(){t.changeSize(),t.render()})),e.onUpdate(this._update),e.onClick&&e.onClick((function(e){t.onClick&&t.onClick(e)})),e.onDblClick&&e.onDblClick((function(e){t.onDblClick&&t.onDblClick(e)})),e.onRightClick&&e.onRightClick((function(e){t.onRightClick&&t.onRightClick(e)})),e.onMousemove&&e.onMousemove((function(e){t.onMousemove&&t.onMousemove(e)})),this.options.canvas||e.getContainer().appendChild(this.canvas)}},{key:"unbind",value:function(){var t=this.map;t.unbind&&t.unbind()}},{key:"setOptions",value:function(t){this.options=t}},{key:"onInitialize",value:function(t){t&&(this.transferOptions=t.bind(this)(this.gl)||{})}},{key:"bindFramebuffer",value:function(t){var e=this.gl;t?e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer):e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"saveFramebuffer",value:function(){var t=this.gl;this.preFramebuffer=t.getParameter(t.FRAMEBUFFER_BINDING)}},{key:"restoreFramebuffer",value:function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.preFramebuffer)}},{key:"onRender",value:function(t){this.renderArr.push(t)}},{key:"changeSize",value:function(){var t=this.canvas,e=this.options;if(t){var r=t.style,i=this.map.getSize(),n=this._dpr;t.width=i.width*n,t.height=i.height*n,r.cssText="position: absolute;left:0;top:0;width:"+i.width+"px;height:"+i.height+"px;z-index:2;","cesium"!==e.mapType||e.canvas||(r.pointerEvents="none"),this.gl.viewport(0,0,t.width,t.height)}}},{key:"update",value:function(){!1===this.options.autoUpdate||this.isAnimation&&60<=this.fps||this.render()}},{key:"render",value:function(){if(this.map&&this.gl){var t=this.options,e=this.projectionMatrix,r=this.viewMatrix;if("three"===t.mapType)e=(r=this.map.map.camera).projectionMatrix.elements,r=r.matrixWorldInverse.elements;else if("cesium"===t.mapType){var i=(r=this.map.map).camera.frustum.projectionMatrix;e=new Float32Array([i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15]]),i=r.camera.viewMatrix,r=new Float32Array([i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15]])}else"B_EARTH_MAP"===this.map.map.mapType?(e=this.map.map.getEarth().scene._camera.getProjectionMatrix(),r=this.map.map.getEarth().scene._camera.getModelViewMatrix()):(this.updateProjectionMatrix(),this.updateModelViewMatrix());for(i=rs.multiply(this.matrix,e,r),ze(this.transferOptions,{gl:this.gl,matrix:i,pointToPixelMatrix:this.pointToPixelMatrix,pixelToViewMatrix:this.pixelToViewMatrix,projectionMatrix:e,orthoMatrix:this.orthoMatrix,viewMatrix:r,stateManager:this.stateManager}),"three"!==t.mapType&&"cesium"!==t.mapType&&!1!==t.autoUpdate&&this.clear(),t=0;t<this.renderArr.length;t++)this.renderArr[t]&&this.renderArr[t].bind(this)(this.transferOptions)}}},{key:"clear",value:function(t){var e=this.gl,r=this.options.clearColor||[0,0,0,0];e.clearColor(r[0],r[1],r[2],r[3]),t&&(t instanceof Array||(t=u(t).unitArray()),e.clearColor(t[0],t[1],t[2],t[3])),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var t=this.gl.canvas.width/this.gl.canvas.height,e=this.options.cameraNear||1,r=this.options.cameraFar||4e3;rs.perspective(this.projectionMatrix,d(this.fovy),t,e,r),t=this.map.getSize(),rs.ortho(this.orthoMatrix,-t.width/2,t.width/2,-t.height/2,t.height/2,e,r)}},{key:"updateModelViewMatrix",value:function(){var t=this.map,e=this.viewMatrix,r=this.pointToPixelMatrix,i=this.pixelToViewMatrix;rs.identity(e),rs.identity(r),rs.identity(i);var n=t.getSize();n=Math.round(-n.height/(2*Math.tan(d(this.fovy)/2))),rs.translate(i,i,[0,0,n]),rs.rotate(i,i,d(t.getTilt()),[-1,0,0]),rs.rotate(i,i,d(t.getHeading()),[0,0,-1]),n=t.getCenter();var a=this.options.pointOffset||[0,0];t=t.getZoomUnits(),rs.translate(r,r,[(a[0]-n.lng)/t,(a[1]-n.lat)/t,0]),t=1/t,rs.scale(r,r,[t,t,t]),rs.multiply(e,i,r)}},{key:"destroy",value:function(){this.stopAnimation(),this.unbind();var t=this.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this.map.getContainer().removeChild(this.canvas),this.gl=this.canvas=null}},{key:"animation",value:function(){if(this.isAnimation){if(60<=this.fps)this.render();else{var t=(new Date).valueOf(),e=Math.floor(1e3/this.fps),r=t-this.renderTime;r>e&&(this.render(),this.renderTime=t-r%e)}window.requestAnimationFrame(this._animation)}}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",value:function(){this.isAnimation=!1}}]),t}(),Es=function(){function t(e){Ut(this,t),this.layers=[],this.options=e,this.webglLayer=e.webglLayer}return Ge(t,[{key:"addLayer",value:function(t){for(var e=!1,r=0;r<this.layers.length;r++)if(this.layers[r]===t){e=!0;break}e||(t.map=this.webglLayer.map,"threeLayer"===t.layerType?(t.setWebglLayer(this.webglLayer),e=t.getThreeLayer(),this.addLayer(e),t.initialize&&t.initialize(e)):(t.setWebglLayer(this.webglLayer),t.commonInitialize&&t.commonInitialize(this.webglLayer.gl),t.initialize&&t.initialize(this.webglLayer.gl),t.onOptionsChanged(t.getOptions(),{}),t.onDataChanged(t.getData()),t.onChanged(t.getOptions(),t.getData())),this.putInLayer(t)),this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"putInLayer",value:function(t){void 0===t.options.renderOrder&&(t.options.renderOrder=this.layers.length),this.layers.push(t),this.layers=this.layers.sort((function(t,e){return t.options.renderOrder-e.options.renderOrder}))}},{key:"removeLayer",value:function(t){for(var e=0;e<this.layers.length;e++)this.layers[e]===t&&this.layers.splice(e,1);this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"showLayer",value:function(t){for(var e=0;e<this.layers.length;e++)this.layers[e]===t&&t.show();this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"hideLayer",value:function(t){for(var e=0;e<this.layers.length;e++)this.layers[e]===t&&t.hide();this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"removeAllLayers",value:function(){this.layers=[],this.webglLayer.stopAnimation(),this.webglLayer.render()}},{key:"destroyAllLayers",value:function(){for(var t=0;t<this.layers.length;t++){var e=this.layers[t];e.destroy&&e.destroy()}}},{key:"getAllLayers",value:function(){return this.layers}},{key:"getAllThreeLayers",value:function(){for(var t=[],e=0;e<this.layers.length;e++){var r=this.layers[e];"ThreeLayer"===r.layerType&&t.push(r)}return t}},{key:"isRequestAnimation",value:function(){for(var t=!1,e=0;e<this.layers.length;e++)if(this.layers[e].isRequestAnimation()){t=!0;break}return t}},{key:"beforeRender",value:function(t){t.gl&&this.webglLayer.stateManager.setDefaultState()}},{key:"afterRender",value:function(t){(t=t.gl)&&(t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.useProgram(null))}},{key:"renderGLLayers",value:function(t){this.webglLayer.stateManager.save();for(var e=0;e<this.layers.length;e++){var r=this.layers[e];if(!0===r._visible&&"threeLayer"!==r.layerType&&"ThreeLayer"!==r.layerType){var i=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(i<n[0]||i>=n[1])||(this.beforeRender(t),r.render(t),this.afterRender(t))}}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayer",value:function(t){this.webglLayer.stateManager.save(),this.webglLayer.stateManager.setState({blendFunc:[t.gl.SRC_ALPHA,t.gl.ONE],depthMask:!1,depthTest:!0,depthFunc:t.gl.LESS,cullFace:!1});for(var e=0;e<this.layers.length;e++){var r=this.layers[e];if(!0===r._visible&&"ThreeLayer"===r.layerType){var i=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(i<n[0]||i>=n[1])||r.render(t)}}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayers",value:function(t){this.webglLayer.stateManager.save(),this.webglLayer.stateManager.setState({blendFunc:[t.gl.SRC_ALPHA,t.gl.ONE],depthMask:!1,depthTest:!0,depthFunc:t.gl.LESS,cullFace:!1});for(var e=0;e<this.layers.length;e++){var r=this.layers[e];if(!0===r._visible&&"threeLayer"===r.layerType){var i=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(i<n[0]||i>=n[1])||r.render(t)}}this.webglLayer.stateManager.restore()}},{key:"onClick",value:function(t){for(var e=0;e<this.layers.length;e++){var r=this.layers[e];if(!0===r._visible&&"threeLayer"!==r.layerType&&"ThreeLayer"!==r.layerType){var i=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(i<=n[0]||i>=n[1])||!r.options.enablePicked||!r.options.onClick||!r.pick||(i=r.pick(t.x,t.y),r.options.onClick(i,t),r.options.autoSelect&&this.webglLayer.render())}}}},{key:"onDblClick",value:function(t){for(var e=0;e<this.layers.length;e++){var r=this.layers[e];if(!0===r._visible&&"threeLayer"!==r.layerType&&"ThreeLayer"!==r.layerType){var i=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(i<=n[0]||i>=n[1])||!r.options.enablePicked||!r.options.onDblClick||!r.pick||(i=r.pick(t.x,t.y),r.options.onDblClick(i,t),r.options.autoSelect&&this.webglLayer.render())}}}},{key:"onRightClick",value:function(t){for(var e=0;e<this.layers.length;e++){var r=this.layers[e];if(!0===r._visible&&"threeLayer"!==r.layerType&&"ThreeLayer"!==r.layerType){var i=r.map.getZoom(),n=r.getOptions().zoomThreshold;n&&(i<=n[0]||i>=n[1])||!r.options.enablePicked||!r.options.onRightClick||!r.pick||(i=r.pick(t.x,t.y),r.options.onRightClick(i,t),r.options.autoSelect&&this.webglLayer.render())}}}},{key:"onMousemove",value:function(t){for(var e=!1,r=0;r<this.layers.length;r++){var i=this.layers[r];if(!0===i._visible&&"threeLayer"!==i.layerType&&"ThreeLayer"!==i.layerType){var n=i.map.getZoom(),a=i.getOptions().zoomThreshold;a&&(n<=a[0]||n>=a[1])||!i.options.enablePicked||!i.pick||!i.options.onMousemove&&!i.options.autoSelect||(n=i.pick(t.x,t.y),this.webglLayer.map.map.platform.style.cursor=-1===n.dataIndex?"default":"pointer",i.options.onMousemove&&i.options.onMousemove(n,t),i.options.autoSelect&&(e=!0))}}e&&(this.webglLayer.isAnimation||this.webglLayer.render())}},{key:"destroy",value:function(){this.destroyAllLayers(),this.removeAllLayers()}}]),t}(),Ls=function(){function t(e){var r=this;Ut(this,t),this.options={autoUpdate:!0},this._visible=!0,ze(this.options,e);var i=e.pointOffset;this.webglLayer=e.webglLayer||new Ps(e.map,this.options),this.layerManager=new Es({autoUpdate:this.options.autoUpdate,webglLayer:this.webglLayer}),this.effectManager=new As(this.webglLayer.gl),this.webglRender={render:function(){}},this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects)),this.webglLayer.onRender((function(t){r._render(t)})),this.webglLayer.onClick=function(t){r._visible&&r.layerManager.onClick(t)},this.webglLayer.onDblClick=function(t){r._visible&&r.layerManager.onDblClick(t)},this.webglLayer.onRightClick=function(t){r._visible&&r.layerManager.onRightClick(t)},this.webglLayer.onMousemove=function(t){r._visible&&r.layerManager.onMousemove(t)},i||"cesium"===this.webglLayer.options.mapType||(i=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[i.lng,i.lat]),this.webglLayer.map.onResize((function(){r.effectManager.onResize()})),(this.postProcessing=e.postProcessing)&&(this.postProcessing.setWebglLayer(this.webglLayer),e=this.postProcessing.getThreeLayer(),this.addLayer(e),this.postProcessing.initialize(e),e.postProcessing=this.postProcessing)}return Ge(t,[{key:"renderCanvas",value:function(t){var e=this;this.postProcessing?this.postProcessing.addRender((function(){e.layerManager.renderGLLayers(t)})):this.layerManager.renderGLLayers(t),this.layerManager.renderThreeLayers(t),this.layerManager.renderThreeLayer(t)}},{key:"render",value:function(){this.webglLayer&&this.webglLayer.render()}},{key:"_render",value:function(t){var e=this;if(this._visible){var r=this.options.effects;r&&0<r.length?(this.webglRender.render=function(){e.renderCanvas(t)},this.effectManager.render()):(this.webglLayer.saveFramebuffer(),this.renderCanvas(t),this.webglLayer.restoreFramebuffer())}}},{key:"onRender",value:function(t){this.webglLayer.onRender(t)}},{key:"destroy",value:function(){this.stopAnimation(),this.layerManager.destroy(),this.effectManager.destroy(),this.webglLayer.destroy()}},{key:"isRequestAnimation",value:function(){return this.layerManager.isRequestAnimation()}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}},{key:"show",value:function(){!0!==this._visible&&(this._visible=!0,this.webglLayer.render(),this.isRequestAnimation()&&this.startAnimation())}},{key:"hide",value:function(){!1!==this._visible&&(this._visible=!1,this.stopAnimation(),this.webglLayer.clear())}},{key:"showLayer",value:function(t){this.layerManager.showLayer(t)}},{key:"hideLayer",value:function(t){this.layerManager.hideLayer(t)}},{key:"add",value:function(t){this.addLayer(t)}},{key:"remove",value:function(t){this.removeLayer(t)}},{key:"addLayer",value:function(t){this.layerManager.addLayer(t)}},{key:"removeLayer",value:function(t){this.layerManager.removeLayer(t)}},{key:"removeAllLayers",value:function(){this.layerManager.removeAllLayers()}},{key:"getAllLayers",value:function(){return this.layerManager.getAllLayers()}},{key:"getAllThreeLayers",value:function(){return this.layerManager.getAllThreeLayers()}}]),t}(),Fs=function(){function t(e){Ut(this,t),this._visible=!0,this.options=this.getCommonDefaultOptions(),this.options=ze(this.options,this.getDefaultOptions()),this.autoUpdate=!1,this.options=ze(this.options,e),this.options.data&&(this.data=this.options.data,delete this.options.data)}return Ge(t,[{key:"getCommonDefaultOptions",value:function(){return{}}},{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){}},{key:"destroy",value:function(){this.onDestroy&&this.onDestroy()}},{key:"show",value:function(){this._visible=!0}},{key:"hide",value:function(){this._visible=!1}},{key:"render",value:function(){}},{key:"clear",value:function(){this.setData([])}},{key:"setData",value:function(t,e){e=e||{},this.data=t,this.onDataChanged&&this.onDataChanged(this.getData()),this.onChanged&&this.onChanged(this.getOptions(),this.getData(),e),!1!==e.autoRender&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",value:function(t,e){t=t||{},e=e||{};var r=ze({},this.getOptions());ze(this.options,t),this.onOptionsChanged&&this.onOptionsChanged(this.getOptions(),r),this.onChanged&&this.onChanged(this.getOptions(),this.getData(),e),t.data?(this.setData(t.data,e),delete t.data):!1!==e.autoRender&&this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(t,e){}},{key:"onDataChanged",value:function(t){}},{key:"onChanged",value:function(t,e){}},{key:"onDestroy",value:function(){}},{key:"lnglatToMercator",value:function(t,e){}},{key:"setWebglLayer",value:function(t){this.webglLayer=t}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",value:function(){return this.autoUpdate}}]),t}(),Ds=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).pickedColor=[-1,-1,-1],t}return Mi(e,t),Ge(e,[{key:"getCommonDefaultOptions",value:function(){return{blend:"default",zIndex:0,zoomThreshold:[0,30],repeat:!1,enablePicked:!1,autoSelect:!1,selectedIndex:-1,selectedColor:"rgba(20, 20, 200, 1.0)"}}},{key:"commonInitialize",value:function(t){var e=this.getOptions();this.gl=t,e.enablePicked&&(this.pickBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}))}},{key:"getCommonAttributes",value:function(){var t=[];return this.getOptions().enablePicked&&t.push({name:"aPickColor",buffer:this.pickBuffer,size:3,type:"FLOAT",stride:12,offset:0}),t}},{key:"getProperty",value:function(t,e,r){return"[object Function]"===Object.prototype.toString.call(e)?e(r):(e=r[t]||e,"properties"in r&&t in r.properties&&(e=r.properties[t]),e)}},{key:"normizedColor",value:function(t){var e=t;return t instanceof Array||(e=u(t).unitArray()),void 0===e[3]&&(e[3]=1),e}},{key:"normizedPoint",value:function(t){var e=this.getPointOffset();if(!t||!t[0]||!t[1])return[e[0],e[1],0];var r=Number(t[0]),i=Number(t[1]);-180<=r&&180>=r&&-90<=i&&90>=i&&(r=(i=this.webglLayer.map.lnglatToMercator(r,i))[0],i=i[1]);var n=Number(t[2])||0;return this.webglLayer&&"cesium"===this.webglLayer.options.mapType&&window.Cesium?(r=this.convertLngLat([r,i]),r=(n=window.Cesium.Cartesian3.fromDegrees(r[0],r[1],n)).x,i=n.y,n=n.z):this.webglLayer&&"bmapgl"===this.webglLayer.options.mapType&&"B_EARTH_MAP"===this.webglLayer.map.map.mapType&&(r=this.convertLngLat([r,i]),r=(n=this.webglLayer.map.map.getEarth().scene.fromLatLngToXYZ({lng:r[0],lat:r[1]})).x,i=n.y,n=n.z),3<t.length?[r-e[0],i-e[1],n].concat(Vi(t.slice(3))):[r-e[0],i-e[1],n]}},{key:"convertLngLat",value:function(t){return[t[0]/20037508.34*180,180/Math.PI*(2*Math.atan(Math.exp(t[1]/20037508.34*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){var t=[0,0],e=this.getOptions();return this.webglLayer&&this.webglLayer.options.pointOffset?t=this.webglLayer.options.pointOffset:e.pointOffset&&(t=e.pointOffset),t}},{key:"indexToRgb",value:function(t){t++;var e=Math.floor(t/65536);t-=65536*e;var r=Math.floor(t/256);return[t-256*r,r,e]}},{key:"rgbToIndex",value:function(t){return t[0]+256*t[1]+65536*t[2]-1}},{key:"getCommonUniforms",value:function(t){t=t.isPickRender;var e=this.getOptions(),r={};if(e.enablePicked){var i=0<=e.selectedIndex?e.selectedIndex:-1;i=e.autoSelect?this.pickedColor:this.indexToRgb(i),r=ze(r,{uSelectedColor:this.normizedColor(e.selectedColor),uEnablePicked:e.enablePicked,uPickedColor:i.map((function(t){return t/255})),uIsPickRender:!!t})}return r}},{key:"pick",value:function(t,e){var r=this.gl,i=this.webglLayer._dpr;this.webglLayer.saveFramebuffer(),this.webglLayer.bindFramebuffer(this.webglLayer.pickFBO),this.webglLayer.clear(),this.render({gl:r,isPickRender:!0,matrix:this.webglLayer.matrix,projectionMatrix:this.webglLayer.projectionMatrix,viewMatrix:this.webglLayer.viewMatrix,orthoMatrix:this.webglLayer.orthoMatrix});var n=new Uint8Array(4);return r.readPixels(t*i,r.canvas.height-e*i,1,1,r.RGBA,r.UNSIGNED_BYTE,n),t=this.rgbToIndex(n),e=this.getData(),this.pickedColor=[n[0],n[1],n[2]],this.webglLayer.restoreFramebuffer(),{dataIndex:t,dataItem:e[t]}}},{key:"setGLState",value:function(t){this.webglLayer.stateManager.setState(t)}},{key:"addMultipleCoords",value:function(t,e,r){if(!this.options.repeat||!this.webglLayer||"bmapgl"!==this.webglLayer.options.mapType||"B_EARTH_MAP"===this.webglLayer.map.map.mapType)return[t];var i=this.webglLayer.map.map;e=e||i.getZoom();var n=r?i.worldSize(e):40075452.74461451;if(e=function(t){return[[t[0]-n,t[1],t[2]||0],[t[0]+n,t[1],t[2]||0]]},t instanceof Array&&!(t[0]instanceof Array))return e=e(t),[t,(e=zi(e,2))[0],e[1]];if(t instanceof Array&&t[0]instanceof Array&&!(t[0][0]instanceof Array)){r=[],i=[];for(var a=0;a<t.length;a++){var o=e(t[a]),s=(o=zi(o,2))[1];r.push(o[0]),i.push(s)}return[t,r,i]}for(r=[],i=[],a=0;a<t.length;a++){o=[],s=[];for(var u=0;u<t[a].length;u++){var l=e(t[a][u]),h=(l=zi(l,2))[1];o.push(l[0]),s.push(h)}r.push(o),i.push(s)}return[t,r,i]}}]),e}(Fs),Bs=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).name="CircleLayer",t.bufferData=[],t.initializeTime=new Date,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{depthWrite:!0,depthTest:!0,size:10,unit:"px",color:"blue",borderWidth:0,borderColor:"#000000",antialias:!0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new us(this.gl,{vertexShader:"attribute vec3 aPos;attribute float aSize;attribute float aIndex;attribute vec4 aColor;attribute float aBorderWidth;attribute vec4 aBorderColor;varying vec4 vColor;varying vec3 vPosition;varying vec3 vFragPosition;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vBorderWidth=aBorderWidth*uZoomUnits;vBorderColor=aBorderColor;float x=aPos.x;float y=aPos.y;float z=aPos.z*uZoomUnits;vSize=aSize*uZoomUnits+vBorderWidth;if(aIndex==1.0){x+=vSize;y-=vSize;}else if(aIndex==2.0){x-=vSize;y+=vSize;}else if(aIndex==3.0){x+=vSize;y+=vSize;}else{x-=vSize;y-=vSize;}vPosition=aPos;vFragPosition=vec3(x,y,z);gl_Position=uMatrix*vec4(vFragPosition,1.0);\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:"varying vec3 vPosition;varying float vSize;varying vec3 vFragPosition;varying vec4 vColor;varying float vBorderWidth;varying vec4 vBorderColor;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float lineWidth;uniform float uAntiAliasing;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>vSize){discard;}vec4 color=vColor;float r=vSize-vBorderWidth;if(vBorderWidth>0.0){if(d>r){color=vBorderColor;}else if(uAntiAliasing==1.0&&d>0.95*r){color=vBorderColor;float st=1.0-smoothstep(0.95*r,r,d);color.r+=(vColor.r-vBorderColor.r)*st;color.g+=(vColor.g-vBorderColor.g)*st;color.b+=(vColor.b-vBorderColor.b)*st;color.a+=(vColor.a-vBorderColor.a)*st;}}if(uAntiAliasing==1.0&&d>0.95*vSize&&d<=vSize){color.a*=1.0-smoothstep(0.95*vSize,vSize,d);}gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var r=14*(e=Float32Array.BYTES_PER_ELEMENT);e=(e=[{stride:r,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:r,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:3*e},{stride:r,name:"aIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:4*e},{stride:r,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:5*e},{stride:r,name:"aBorderWidth",buffer:this.buffer,size:1,type:"FLOAT",offset:9*e},{stride:r,name:"aBorderColor",buffer:this.buffer,size:4,type:"FLOAT",offset:10*e}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&e&&(this.uniforms={},this.data=e,this.processData(),t.enablePicked&&this.parsePickData(e))}},{key:"processData",value:function(){var t=this,e=[],r=[];this.data.forEach((function(i,n){var a=i.properties||{},o=function(e){return i[e]||a[e]||t.options[e]},s=o("color"),u=o("size"),l=o("borderWidth");o=o("borderColor"),s=t.normizedColor(s),o=t.normizedColor(o);for(var h=t.normizedPoint(i.geometry.coordinates),f=0;4>f;f++)e.push(h[0],h[1],h[2]||0,u,f),e.push(s[0],s[1],s[2],s[3]),e.push(l,o[0],o[1],o[2],o[3]);s=4*n,0<n&&r.push(s-1,s),r.push(s,s+1,s+2,s+3)})),this.bufferData=e,this.indexData=r,this.buffer.updateData(new Float32Array(e)),this.indexBuffer.updateData(new Uint32Array(r))}},{key:"parsePickData",value:function(t){var e=[];if(this.getOptions().enablePicked){for(var r=0;r<t.length;r++){var i=this.indexToRgb(r);e.push(i[0]/255,i[1]/255,i[2]/255),e.push(i[0]/255,i[1]/255,i[2]/255),e.push(i[0]/255,i[1]/255,i[2]/255),e.push(i[0]/255,i[1]/255,i[2]/255)}this.pickBuffer.updateData(new Float32Array(e))}}},{key:"render",value:function(t){var e=this.getOptions(),r=this.program,i=t.gl,n=t.matrix;this.setGLState({blend:!0,blendEquation:i.FUNC_ADD,blendFunc:X(i,e.blend||"lighter"),depthTest:e.depthTest,depthMask:e.depthWrite}),r.use(i),this.vertexArray.bind(),this.indexBuffer.bind(),e=this.map.getZoomUnits(),ze(this.uniforms,this.getCommonUniforms(t),{uZoomUnits:"px"===this.options.unit?e:1,uMatrix:n,uAntiAliasing:this.options.antialias?1:0}),r.setUniforms(this.uniforms),i.drawElements(i.TRIANGLE_STRIP,this.indexData.length,i.UNSIGNED_INT,0)}}]),e}(Ds),Os={wave:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}vec4 color=vColor;float R=vRadius;float center=vSize;float time=vStartTime+uTime;float alpha=sin((R-d)/R*trail*2.0*3.14+time/duration);if(d<=center){if(uAntiAliasing==1.0&&d>0.9*center&&d<=center){if(alpha>=0.5){color.a=0.9;}else{color.a=1.0-smoothstep(0.9*center,center,d);}}}else{if(alpha>=0.5){color.a=0.9;if(uAntiAliasing==1.0){if(alpha>=0.5&&alpha<=0.6){color.a*=smoothstep(0.0,0.1,alpha-0.5);}if(d>=0.98*R&&d<=R){color.a*=1.0-smoothstep(0.98,1.0,d/R);}}}else{color.a=0.0;}}gl_FragColor=color;}",bubble:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}float time=vStartTime+uTime;float range=mod(time,(duration+trail));float percent=0.0;if(range<=duration){percent=range/duration;}else{percent=1.0;}float center=vSize;float R=vRadius;float r=R*percent;vec4 color=vColor;if(d<=center){if(uAntiAliasing==1.0&&d>0.9*center&&d<=center){color.a=1.0-smoothstep(0.9*center,center,d);}}else{if(d<r){color.a=smoothstep(0.1,0.9,pow(d/r,2.0)*0.9);if(uAntiAliasing==1.0&&d>=0.9*r&&d<=r){color.a*=1.0-smoothstep(0.9,1.0,d/r);}if(range>duration){color.a*=1.0-(range-duration)/trail;}}else{color.a=0.0;}}gl_FragColor=color;}",breath:"varying vec4 vPosition;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}vec4 color=vColor;if(uAntiAliasing==1.0&&d>0.9*vRadius&&d<=vRadius){color.a=1.0-smoothstep(0.9*vRadius,vRadius,d);}float time=vStartTime+uTime;float range=mod(time,(duration+trail));float percent=0.0;if(range<=duration){percent=range/duration;}else{percent=1.0;}color.a*=abs(1.0-percent*2.0)+0.2;gl_FragColor=color;}",radar:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}float time=vStartTime+uTime;float range=mod(time,duration);float percent=range/duration;float center=vSize;float startDeg=360.0*percent;vec4 color=vColor;float deltaX=vFragPosition.x-vPosition.x;float deltaY=vFragPosition.y-vPosition.y;float currDeg=degrees(atan(deltaX/deltaY));if(deltaX>=0.0&&deltaY<=0.0){currDeg=180.0+currDeg;}if(deltaX<=0.0&&deltaY<=0.0){currDeg=180.0+currDeg;}if(deltaX<=0.0&&deltaY>=0.0){currDeg=360.0+currDeg;}float maxDeg=trail;if(trail<0.0){currDeg=-currDeg;maxDeg=-trail;}float modDeg=mod((currDeg-startDeg),360.0);if(modDeg<maxDeg){color.a=modDeg/maxDeg;}else{color.a=0.0;}if(uAntiAliasing==1.0&&d>0.95*vRadius&&d<=vRadius){color.a=color.a-smoothstep(0.95*vRadius,vRadius,d);}gl_FragColor=color;}"},ks=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).name="RippleCircleLayer",t.autoUpdate=!0,t.bufferData=[],t.initializeTime=new Date,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){var t=1;return"radar"===this.options.type&&(t=120),{depthWrite:!1,depthTest:!0,type:"bubble",size:10,duration:1,trail:t,unit:"px",random:!0,color:"blue",antialias:!0,radius:function(t){return 2*t}}}},{key:"initialize",value:function(t){this.gl=t,this.program=new us(this.gl,{vertexShader:"attribute vec3 aPos;attribute float aSize;attribute float aIndex;attribute vec4 aColor;attribute float aStartTime;attribute float aRadius;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vWidth;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vStartTime=aStartTime;vSize=aSize*uZoomUnits;vRadius=aRadius*uZoomUnits;float x=aPos.x;float y=aPos.y;float z=aPos.z*uZoomUnits;float R=vRadius;if(aIndex==1.0){x+=R;y-=R;}else if(aIndex==2.0){x-=R;y+=R;}else if(aIndex==3.0){x+=R;y+=R;}else{x-=R;y-=R;}vPosition=vec4(aPos.xy,z,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:Os[this.options.type]||"bubble",defines:this.options.enablePicked?["PICK"]:[]},this),this.buffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var e=[{stride:44,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:44,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:12},{stride:44,name:"aIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:16},{stride:44,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:20},{stride:44,name:"aRadius",buffer:this.buffer,size:1,type:"FLOAT",offset:36},{stride:44,name:"aStartTime",buffer:this.buffer,size:1,type:"FLOAT",offset:40}];e=e.concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&e&&(this.uniforms={duration:t.duration,trail:t.trail},this.data=e,this.processData(),t.enablePicked&&this.parsePickData(e))}},{key:"processData",value:function(){var t=this,e=[],r=[];this.data.forEach((function(i,n){var a=i.size||t.options.size,o=i.radius||t.options.radius||1.618*a;"function"==typeof o&&(o=o(a));var s=i.color||t.options.color;s=t.normizedColor(s),i=t.normizedPoint(i.geometry.coordinates);for(var u=t.options.random?Math.random()*t.data.length*9999:0,l=0;4>l;l++)e.push(i[0],i[1],i[2]||0,a,l),e.push(s[0],s[1],s[2],s[3]),e.push(o),e.push(u);a=4*n,0<n&&r.push(a-1,a),r.push(a,a+1,a+2,a+3)})),this.bufferData=e,this.indexData=r,this.buffer.updateData(new Float32Array(e)),this.indexBuffer.updateData(new Uint32Array(r))}},{key:"parsePickData",value:function(t){var e=[];if(this.getOptions().enablePicked){for(var r=0;r<t.length;r++){var i=this.indexToRgb(r);e.push(i[0]/255,i[1]/255,i[2]/255),e.push(i[0]/255,i[1]/255,i[2]/255),e.push(i[0]/255,i[1]/255,i[2]/255),e.push(i[0]/255,i[1]/255,i[2]/255)}this.pickBuffer.updateData(new Float32Array(e))}}},{key:"render",value:function(t){var e=this.getOptions(),r=this.program,i=t.gl,n=t.matrix;r.use(i);var a=this.map.getZoomUnits();ze(this.uniforms,this.getCommonUniforms(t),{uTime:(new Date-this.initializeTime)/1e3,uZoomUnits:"m"===e.unit?1:a,uMatrix:n,uAntiAliasing:e.antialias?1:0}),r.setUniforms(this.uniforms),this.setGLState({blend:!0,blendEquation:i.FUNC_ADD,blendFunc:[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA],depthTest:e.depthTest,depthMask:e.depthWrite}),0<this.indexData.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),i.drawElements(i.TRIANGLE_STRIP,this.indexData.length,i.UNSIGNED_INT,0))}}]),e}(Ds),zs=Le(Os),Is=i(n((function(t,e){e.__esModule=!0;var r=je&&je.__esModule?je:{default:je},i=an&&an.__esModule?an:{default:an};e.default=function t(e,n,a){null===e&&(e=Function.prototype);var o=(0,i.default)(e,n);return void 0!==o?"value"in o?o.value:void 0===(n=o.get)?void 0:n.call(a):null!==(e=(0,r.default)(e))?t(e,n,a):void 0}})));W.deviation=function(t,e,r,i){var n=e&&e.length,a=Math.abs(ht(t,0,n?e[0]*r:t.length,r));if(n){n=0;for(var o=e.length;n<o;n++)a-=Math.abs(ht(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r))}for(n=e=0;n<i.length;n+=3){o=i[n]*r;var s=i[n+1]*r,u=i[n+2]*r;e+=Math.abs((t[o]-t[u])*(t[s+1]-t[o+1])-(t[o]-t[s])*(t[u+1]-t[o+1]))}return 0===a&&0===e?0:Math.abs((e-a)/a)},W.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var a=0;a<t[n].length;a++)for(var o=0;o<e;o++)r.vertices.push(t[n][a][o]);0<n&&(i+=t[n-1].length,r.holes.push(i))}return r},W.default=W;var Us=void 0===vi?"__target":vi(),Ns=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Hs=window.URL||window.webkitURL,js=window.Worker;if(js){var Xs=ft("self.onmessage = function () {}"),Ws=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");var Ys=new js(Xs);Ys.postMessage(Ws,[Ws.buffer])}catch(ul){js=null}finally{Hs.revokeObjectURL(Xs),Ys&&Ys.terminate()}}var Zs=new function(t,e){return function(r){var i=this;if(!e)return new js(t);if(js&&!r)return r=ft(r=(""+e).replace(/^function.+?{/,"").slice(0,-1)),this[Us]=new js(r),Hs.revokeObjectURL(r),this[Us];var n={postMessage:function(t){i.onmessage&&setTimeout((function(){return i.onmessage({data:t,target:n})}))}};e.call(n),this.postMessage=function(t){setTimeout((function(){return n.onmessage({data:t,target:i})}))},this.isThisThread=!0}}("./worker.js",(function(t,e){})),Vs={window:1,windowAnimation:2,gradual:3,ripple:4,water:6},Gs=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="ShapeLayer",t._isShow=!0,("windowAnimation"===(r=t.getOptions()).style||"ripple"===r.style||0<r.riseTime)&&(t.autoUpdate=!0),t.selectedColor=[-1,-1,-1],t.textureCache={},t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(50, 50, 230, 1.0)",opacity:.8,height:0,isTextureFull:!1,topColor:"rgba(76, 76, 76, 0.8)",textureRotate:0,textureScale:1,useLight:!0,useTopColor:!1,riseTime:0,polygonOffset:[0,0],depthTest:!0,zIndex:0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.dataMgr=new ct(this,this.gl),this.texture=null,this.isUseTexture=!1;var r=[];e.enablePicked&&r.push("PICK"),e.texture&&r.push("USE_TEXTURE"),this.program=new us(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;attribute vec4 a_pos;attribute vec3 a_normal;attribute vec4 a_color;attribute vec4 a_pre_color;attribute float a_height;attribute float a_pre_height;\n#if defined(USE_TEXTURE)\nattribute vec2 a_texture_coord;\n#endif\nuniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float dataTime;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;uniform float u_zIndex;varying float v_height;varying vec4 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.8,0.8,0.8);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);float getTransitionValue(float pre_value,float to_value,float dataTime,float riseTime){float result=0.0;if(pre_value==to_value){result=to_value;}else{if(riseTime>0.0&&dataTime<riseTime){result=(pre_value+(to_value-pre_value)*(dataTime/riseTime));}else{result=to_value;}}return result;}void main(){vec4 pos=a_pos;pos.z=pos.z+pos.w*getTransitionValue(a_pre_height,a_height,dataTime,riseTime);v_position=pos.xyz;v_height=a_height;\n#if defined(USE_TEXTURE)\nif(u_use_texture){v_texture_coord=a_texture_coord;}\n#endif\npos.z+=u_zIndex;vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos.xyz,1.0);gl_Position=position;vec4 icolor=a_color;\n#if defined(PICK)\nif(mapvIsPicked()){icolor=uSelectedColor;}\n#endif\nif(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));if(a_pre_color.r==a_color.r&&a_pre_color.g==a_color.g&&a_pre_color.b==a_color.b){}else{if(riseTime>0.0&&dataTime<riseTime){icolor.r=a_pre_color.r+(a_color.r-a_pre_color.r)*(dataTime/riseTime);icolor.g=a_pre_color.g+(a_color.g-a_pre_color.g)*(dataTime/riseTime);icolor.b=a_pre_color.b+(a_color.b-a_pre_color.b)*(dataTime/riseTime);}}v_color.rgb=icolor.rgb+icolor.rgb*light_color*lambert+icolor.rgb*light_color_2*lambert_2+icolor.rgb*point_color*lambert_point;v_color.a=icolor.a;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec4 vLightWeighting;vLightWeighting=vec4(uAmbientColor+uDirectionalColor*directionalLightWeighting,1.0);v_color=vLightWeighting;}}else{v_color=icolor;}}",fragmentShader:"precision highp float;varying vec4 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec4 top_color;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;uniform bool u_use_top_color;void main(){vec4 color=vec4(v_color);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){if(style==6.0){float x=v_texture_coord.s;float y=v_texture_coord.t;vec2 cPos=-1.0+2.0*gl_FragCoord.xy/MAPV_resolution;float cLength=length(cPos);vec2 uv=gl_FragCoord.xy/MAPV_resolution+(cPos/cLength)*cos(cLength*12.0-time/1000.0*4.0)*0.03;textureColor=texture2D(u_sampler,uv/2.0+vec2(x,y));}else{textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));}if(u_use_lighting){color=vec4(textureColor*v_color*1.1);}else{color=textureColor;}}if(u_use_top_color&&v_position.z>=v_height){color=top_color;}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}else if(style==6.0){}gl_FragColor=color;}",defines:r},this),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.heightBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.textureBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=[{name:"a_pos",buffer:this.vertexBuffer,stride:28,size:4,type:"FLOAT",offset:0},{name:"a_normal",buffer:this.vertexBuffer,size:3,stride:28,type:"FLOAT",offset:16},{name:"a_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:0},{name:"a_pre_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:16},{name:"a_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:0},{name:"a_pre_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:4}],e.texture&&r.push({name:"a_texture_coord",buffer:this.textureBuffer,size:2,stride:8,type:"FLOAT",offset:0}),r=r.concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:r}),this.initializeTime=new Date,this.normalMatrix=rs.create()}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var r=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){r.loadTexture((function(){r.dataMgr.parseData(e),r.dataTime=new Date,r.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,r=t.projectionMatrix,i=t.viewMatrix;if(this._isShow){var n=this.getData();if(n&&!(0>=n.length)){n=this.getOptions();var a=this.program;if(a.use(e),!n.texture||this.texture){var o=0;n.style&&Vs[n.style]&&(o=Vs[n.style]);var s=[e.ONE,e.ZERO];if(n.blend&&(s=X(e,n.blend)),0!==n.height&&"gradual"!==n.style||(s=[e.ONE,e.ONE_MINUS_SRC_ALPHA]),this.setGLState({cullFace:!1,blend:!0,blendEquation:e.FUNC_ADD,blendFunc:s,polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:"gradual"!==n.style}),s=this.normizedColor(n.topColor),"ripple"===n.style&&n.rippleLayer&&n.rippleLayer.data&&n.rippleLayer.data[0]){var u=this.normizedPoint(n.rippleLayer.data[0].geometry.coordinates);a.setUniforms({u_ripple_center:[u[0],u[1],0],u_radius:n.rippleLayer.options.size*n.rippleLayer.currentScale})}u=Jo.fromValues(0,-1,2),n.lightDir&&(u=Jo.fromValues(n.lightDir[0],n.lightDir[1],n.lightDir[2]));var l=this.normalMatrix;rs.invert(l,i),rs.transpose(l,l),a.setUniforms(ze(this.getCommonUniforms(t),{u_normal_matrix:l,u_sampler:this.texture,u_proj_matrix:r,u_mv_matrix:i,style:o,u_use_top_color:n.useTopColor,top_color:s,u_use_lighting:n.useLight,u_use_texture:this.isUseTexture,alpha:void 0===n.opacity?.8:parseFloat(n.opacity),time:new Date-this.initializeTime,dataTime:new Date-this.dataTime,riseTime:n.riseTime,u_side_light_dir:u,u_zIndex:n.zIndex})),0<(t=this.dataMgr.getData()).vertex.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),e.drawElements(e.TRIANGLES,t.index.length,e.UNSIGNED_INT,0))}}}else this.webglLayer.clear()}},{key:"loadTexture",value:function(t){var e=this,r=this.getOptions();r.texture?(this.isUseTexture=!0,j(this.gl,r.texture,(function(r,i){e.image=i,e.texture=r,t&&t(),e.webglLayer.render()}))):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),e}(Ds);ct.prototype.initData=function(){this.outBuilding3d={pickColorVertex:[],vertex:[],texture:[],color:[],height:[],index:[]}},ct.prototype.getData=function(){return this.outBuilding3d},ct.prototype.initWorker=function(){this.worker=new Zs,this.worker.onmessage=function(t){}},ct.prototype.parseData=function(t){var e=this;this.initData();for(var r=this.shapeLayer.getOptions(),i=0;i<t.length;i++){var n=t[i],a=n.height||r.height;"properties"in n&&"height"in n.properties&&(a=n.properties.height),a*=1;var o=n.color||r.color;"properties"in n&&"color"in n.properties&&(o=n.properties.color),"properties"in n&&"fillColor"in n.properties&&(o=n.properties.fillColor),"[object Function]"===Object.prototype.toString.call(o)&&(o=o(n)),o=this.shapeLayer.normizedColor(o);var s=this.shapeLayer.getProperty("angle",r.textureRotate,n),u=void 0;r.enablePicked&&(u=this.shapeLayer.indexToRgb(i));var l=void 0,h=void 0;if(r.riseTime&&(h=n.preColor,"properties"in n&&"preColor"in n.properties&&(h=n.properties.preColor),l=n.preHeight,"properties"in n&&"preHeight"in n.properties&&(l=n.properties.preHeight),void 0===l&&(l=0)),n.geometry.coordinates){if("LineString"===n.geometry.type){var f=n.geometry.coordinates.map((function(t){return e.shapeLayer.normizedPoint(t)})),c=W.flatten([f]);f=c.vertices,c=c.holes;for(var d=[],v=[],p=0;p<f.length;p+=3)d.push(f[p+0],f[p+1]),v.push(f[p+2]);this.parseBuilding3d(this.outBuilding3d,d,v,l,a,h,o,u,s,c)}if("MultiPolygon"===n.geometry.type){for(f=n.geometry.coordinates,n=[],c=0;c<f.length;c++)n.push(f[c].map((function(t){return t.map((function(t){return e.shapeLayer.normizedPoint(t)}))})));for(f=0;f<n.length;f++){c=[],d=[],v=(p=W.flatten(n[f])).vertices,p=p.holes;for(var g=0;g<v.length;g+=3)c.push(v[g+0],v[g+1]),d.push(v[g+2]);this.parseBuilding3d(this.outBuilding3d,c,d,l,a,h,o,u,s,p)}}else{for(f=[],c=0;c<n.geometry.coordinates.length;c++)f.push(n.geometry.coordinates[c].map((function(t){return e.shapeLayer.normizedPoint(t)})));for(n=(f=W.flatten(f)).vertices,f=f.holes,c=[],d=[],v=0;v<n.length;v+=3)c.push(n[v+0],n[v+1]),d.push(n[v+2]);this.parseBuilding3d(this.outBuilding3d,c,d,l,a,h,o,u,s,f)}}}this.shapeLayer.vertexBuffer.updateData(new Float32Array(this.outBuilding3d.vertex)),this.shapeLayer.colorBuffer.updateData(new Float32Array(this.outBuilding3d.color)),this.shapeLayer.heightBuffer.updateData(new Float32Array(this.outBuilding3d.height)),this.shapeLayer.textureBuffer.updateData(new Float32Array(this.outBuilding3d.texture)),this.shapeLayer.indexBuffer.updateData(new Uint32Array(this.outBuilding3d.index)),r.enablePicked&&this.shapeLayer.pickBuffer.updateData(new Float32Array(this.outBuilding3d.pickColorVertex))},ct.prototype.getBounds=function(t,e){for(var r=t[0],i=t[1],n=t[0],a=t[1],o=0;o<t.length;o+=2)r=Math.min(t[o],r),i=Math.min(t[o+1],i),n=Math.max(t[o],n),a=Math.max(t[o+1],a);if(o=[(n-r)/2+r,(a-i)/2+i],0===e||!e)return{minX:r,minY:i,maxX:n,maxY:a,width:n-r,height:a-i,center:o};for(r=t.slice(0),i=0;i<r.length;i+=2)n=dt(t[i],t[i+1],o,e),r[i]=n[0],r[i+1]=n[1];return this.getBounds(r,0)},ct.prototype.parseBuilding3d=function(t,e,r,i,n,a,o,s,u,l){void 0===i&&(i=n);var h=this.shapeLayer.options,f=t.vertex,c=t.texture,d=t.color,v=t.height,p=t.pickColorVertex;t=t.index,void 0===a&&(a=o);var g=0,m=0;if(this.shapeLayer.image&&(g=this.shapeLayer.image.width*h.textureScale,m=this.shapeLayer.image.height*h.textureScale),"gradual"!==h.style){var x=(l=l&&l.length?W(e,l,2):W(e))[0],y=l[1],b=l[2];x=[e[2*x],e[2*x+1],1],y=[e[2*y],e[2*y+1],1];var _,A=[e[2*b],e[2*b+1],1];b=[],Jo.cross(b,[A[0]-y[0],A[1]-y[1],A[2]-y[2]],[x[0]-y[0],x[1]-y[1],x[2]-y[2]]),y=f.length/7,h.texture&&(_=this.getBounds(e,u)),x=h.isTextureFull,A=0;for(var T=e.length;A<T;A+=2){if(f.push(e[A],e[A+1],r[A/2],1,b[0],b[1],b[2]),d.push(o[0],o[1],o[2],o[3],a[0],a[1],a[2],a[3]),v.push(n,i),h.texture){var w=dt(e[A],e[A+1],_.center,u),M=zi(w,2);w=M[0],M=M[1],x?(w=(w-_.minX)/_.width,M=(M-_.minY)/_.height):(w=(w-_.minX)/g,M=(M-_.minY)/m),c.push(w,M)}s&&p.push(s[0]/255,s[1]/255,s[2]/255)}for(u=0,_=l.length;u<_;u++)t.push(l[u]+y)}if(!(n===i&&0>=n))for(u=0,l=e.length;u<l;u+=2)_=f.length/7,b=[T=e[u],w=e[u+1],r[u/2],0],y=[T,w,r[u/2],1],A=u+2,M=u+3,u===l-2&&(A=0,M=1),A=e[A],M=e[M],T=Math.sqrt(Math.pow(A-T,2),Math.pow(M-w,2)),w=[A,M,r[u/2],0],A=[A,M,r[u/2],1],M=[],Jo.cross(M,[w[0]-b[0],w[1]-b[1],w[2]-b[2]],[y[0]-b[0],y[1]-b[1],y[2]-b[2]]),f.push(b[0],b[1],b[2],b[3]),f.push(M[0],M[1],M[2]),f.push(y[0],y[1],y[2],y[3]),f.push(M[0],M[1],M[2]),f.push(w[0],w[1],w[2],w[3]),f.push(M[0],M[1],M[2]),f.push(A[0],A[1],A[2],A[3]),f.push(M[0],M[1],M[2]),d.push(o[0],o[1],o[2],o[3]),d.push(a[0],a[1],a[2],a[3]),d.push(o[0],o[1],o[2],o[3]),d.push(a[0],a[1],a[2],a[3]),d.push(o[0],o[1],o[2],o[3]),d.push(a[0],a[1],a[2],a[3]),d.push(o[0],o[1],o[2],o[3]),d.push(a[0],a[1],a[2],a[3]),v.push(n),v.push(i),v.push(n),v.push(i),v.push(n),v.push(i),v.push(n),v.push(i),h.texture&&(x?(c.push(0,0),c.push(0,1),c.push(1,0),c.push(1,1)):(c.push(0,0),c.push(0,n/m),c.push(T/g,0),c.push(T/g,n/m))),s&&(p.push(s[0]/255,s[1]/255,s[2]/255),p.push(s[0]/255,s[1]/255,s[2]/255),p.push(s[0]/255,s[1]/255,s[2]/255),p.push(s[0]/255,s[1]/255,s[2]/255)),t.push(_,_+2,_+3,_,_+3,_+1)};var qs=n((function(t,e){var r;r=function(){function t(r,i,n,a,o){for(;a>n;){if(600<a-n){var s=a-n+1,u=i-n+1,l=Math.log(s),h=.5*Math.exp(2*l/3);l=.5*Math.sqrt(l*h*(s-h)/s)*(0>u-s/2?-1:1),t(r,i,Math.max(n,Math.floor(i-u*h/s+l)),Math.min(a,Math.floor(i+(s-u)*h/s+l)),o)}for(s=r[i],u=n,h=a,e(r,n,i),0<o(r[a],s)&&e(r,n,a);u<h;){for(e(r,u,h),u++,h--;0>o(r[u],s);)u++;for(;0<o(r[h],s);)h--}0===o(r[n],s)?e(r,n,h):e(r,++h,a),h<=i&&(n=h+1),i<=h&&(a=h-1)}}function e(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function r(t,e){return t<e?-1:t>e?1:0}function i(t,e){n(t,0,t.children.length,e,t)}function n(t,e,r,i,n){for(n||(n=c(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;e<r;e++){var o=t.children[e];a(n,t.leaf?i(o):o)}return n}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function o(t,e){return t.minX-e.minX}function s(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function l(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function c(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(e,i,n,a,o){for(var s=[i,n];s.length;)if(!((n=s.pop())-(i=s.pop())<=a)){var u=i+Math.ceil((n-i)/a/2)*a;t(e,u,i||0,n||e.length-1,o||r),s.push(i,u,u,n)}}var v=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};return v.prototype.all=function(){return this._all(this.data,[])},v.prototype.search=function(t){var e=this.data,r=[];if(!f(t,e))return r;for(var i=this.toBBox,n=[];e;){for(var a=0;a<e.children.length;a++){var o=e.children[a],s=e.leaf?i(o):o;f(t,s)&&(e.leaf?r.push(o):h(t,s)?this._all(o,r):n.push(o))}e=n.pop()}return r},v.prototype.collides=function(t){var e=this.data;if(!f(t,e))return!1;for(var r=[];e;){for(var i=0;i<e.children.length;i++){var n=e.children[i],a=e.leaf?this.toBBox(n):n;if(f(t,a)){if(e.leaf||h(t,a))return!0;r.push(n)}}e=r.pop()}return!1},v.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}return t=this._build(t.slice(),0,t.length-1,0),this.data.children.length?this.data.height===t.height?this._splitRoot(this.data,t):(this.data.height<t.height&&(e=this.data,this.data=t,t=e),this._insert(t,this.data.height-t.height-1,!0)):this.data=t,this},v.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},v.prototype.clear=function(){return this.data=c([]),this},v.prototype.remove=function(t,e){if(!t)return this;for(var r,i,n,a=this.data,o=this.toBBox(t),s=[],u=[];a||s.length;){if(a||(a=s.pop(),i=s[s.length-1],r=u.pop(),n=!0),a.leaf){t:{var l=t,f=a.children,c=e;if(c){for(var d=0;d<f.length;d++)if(c(l,f[d])){l=d;break t}l=-1}else l=f.indexOf(l)}if(-1!==l){a.children.splice(l,1),s.push(a),this._condense(s);break}}n||a.leaf||!h(a,o)?i?(r++,a=i.children[r],n=!1):a=null:(s.push(a),u.push(r),r=0,i=a,a=a.children[0])}return this},v.prototype.toBBox=function(t){return t},v.prototype.compareMinX=function(t,e){return t.minX-e.minX},v.prototype.compareMinY=function(t,e){return t.minY-e.minY},v.prototype.toJSON=function(){return this.data},v.prototype.fromJSON=function(t){return this.data=t,this},v.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},v.prototype._build=function(t,e,r,n){var a=r-e+1,o=this._maxEntries;if(a<=o){var s=c(t.slice(e,r+1));return i(s,this.toBBox),s}for(n||(n=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,n-1))),(s=c([])).leaf=!1,s.height=n,d(t,e,r,o=(a=Math.ceil(a/o))*Math.ceil(Math.sqrt(o)),this.compareMinX);e<=r;e+=o){var u=Math.min(e+o-1,r);d(t,e,u,a,this.compareMinY);for(var l=e;l<=u;l+=a)s.children.push(this._build(t,l,Math.min(l+a-1,u),n-1))}return i(s,this.toBBox),s},v.prototype._chooseSubtree=function(t,e,r,i){for(;i.push(e),!e.leaf&&i.length-1!==r;){for(var n=1/0,a=1/0,o=void 0,s=0;s<e.children.length;s++){var l=e.children[s],h=u(l),f=(Math.max(l.maxX,t.maxX)-Math.min(l.minX,t.minX))*(Math.max(l.maxY,t.maxY)-Math.min(l.minY,t.minY))-h;f<a?(a=f,n=h<n?h:n,o=l):f===a&&h<n&&(n=h,o=l)}e=o||e.children[0]}return e},v.prototype._insert=function(t,e,r){r=r?t:this.toBBox(t);var i=[],n=this._chooseSubtree(r,this.data,e,i);for(n.children.push(t),a(n,r);0<=e&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(r,i,e)},v.prototype._split=function(t,e){var r=t[e],n=r.children.length,a=this._minEntries;this._chooseSplitAxis(r,a,n),n=this._chooseSplitIndex(r,a,n),(n=c(r.children.splice(n,r.children.length-n))).height=r.height,n.leaf=r.leaf,i(r,this.toBBox),i(n,this.toBBox),e?t[e-1].children.push(n):this._splitRoot(r,n)},v.prototype._splitRoot=function(t,e){this.data=c([t,e]),this.data.height=t.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},v.prototype._chooseSplitIndex=function(t,e,r){for(var i,a=1/0,o=1/0,s=e;s<=r-e;s++){var l=n(t,0,s,this.toBBox),h=n(t,s,r,this.toBBox),f=Math.max(0,Math.min(l.maxX,h.maxX)-Math.max(l.minX,h.minX))*Math.max(0,Math.min(l.maxY,h.maxY)-Math.max(l.minY,h.minY));l=u(l)+u(h),f<a?(a=f,i=s,o=l<o?l:o):f===a&&l<o&&(o=l,i=s)}return i||r-e},v.prototype._chooseSplitAxis=function(t,e,r){var i=t.leaf?this.compareMinX:o,n=t.leaf?this.compareMinY:s;this._allDistMargin(t,e,r,i)<(e=this._allDistMargin(t,e,r,n))&&t.children.sort(i)},v.prototype._allDistMargin=function(t,e,r,i){t.children.sort(i);for(var o=n(t,0,e,i=this.toBBox),s=n(t,r-e,r,i),u=l(o)+l(s),h=e;h<r-e;h++){var f=t.children[h];a(o,t.leaf?i(f):f),u+=l(o)}for(r=r-e-1;r>=e;r--)o=t.children[r],a(s,t.leaf?i(o):o),u+=l(s);return u},v.prototype._adjustParentBBoxes=function(t,e,r){for(;0<=r;r--)a(e[r],t)},v.prototype._condense=function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():i(t[r],this.toBBox)},v},t.exports=r()})),Ks=function(t){function e(t){Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).name="TextLayer";var r=t.canvas=document.createElement("canvas");return(r=t.ctx=r.getContext("2d")).textAlign="start",r.textBaseline="top",t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,flat:!1,collides:!0,unit:"px",angle:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],shadow:{}}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new us(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***点A(x,y)，绕原点顺时针旋转角度a新坐标的计算公式*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)+size.x*sin(rotation);}else if(corner==2.0){x+=size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)-size.x*sin(rotation);}else if(corner==3.0){x+=size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)-size.x*sin(rotation);}else{x+=-size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)+size.x*sin(rotation);}return vec3(x,y,coord.z);}void main(){vTextCoord=aTextCoord;if(uFlat){vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}else{vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z+zIndex,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio*scale;vec3 current=transformCoord(screen,halfSize,corner);gl_Position=vec4(current,1.0);}}",fragmentShader:"precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){this.cachedData=[];for(var r=0;r<e.length;r++){var i=this.normizedPoint(e[r].geometry.coordinates),n=e[r].text;"properties"in e[r]&&"text"in e[r].properties&&(n=e[r].properties.text);var a=this.getProperty("angle",t.angle,e[r]),o=this.getProperty("color",t.color,e[r]);i&&void 0!==n&&this.cachedData.push({point:i,text:n,angle:a,color:o,index:r})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,r=t.matrix,i=this.getOptions(),n=this.program;n.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:i.polygonOffset,depthTest:i.depthTest,depthMask:i.depthWrite});var a=this.map.getZoomUnits();n.setUniforms(ze(this.getCommonUniforms(t),{matrix:r,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,uFlat:i.flat,offset:i.offset,zoomUnits:a,zIndex:i.zIndex,uUnitPx:"px"===i.unit})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var e=t.gl,r=t.matrix,i=this.getOptions();t=i.fontSize;var n=i.fontFamily,a=i.padding,o=i.margin,s=i.collides,u=i.enablePicked,l=i.shadow,h=e.canvas.width/window.devicePixelRatio,f=e.canvas.height/window.devicePixelRatio,c=this.canvas;(e=this.ctx).save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.textBaseline="top",e.font="20px "+n;var d=new qs;i=[];for(var v=0;v<this.cachedData.length;v++){var p=this.cachedData[v],g=p.point,m=p.text,x=p.angle,y=p.color;p=p.index;var b=zi(g,3);b=Qo.clone([b[0],b[1],b[2],1]),Qo.transformMat4(b,b,r),Qo.scale(b,b,1/b[3]);var _=(b[0]+1)/2*h,A=(1-b[1])/2*f,T=e.measureText(m);b=T.width+2*a[0];var w=20;T.actualBoundingBoxAscent&&T.actualBoundingBoxDescent&&(w=T.actualBoundingBoxDescent-T.actualBoundingBoxAscent),w+=2*a[1];var M=b+o[0];if(T=(A-=(T=w+o[1])/2)+T,!(0>(M=(_-=M/2)+M)||0>T||_>h||A>f)){if(s){if(T={minX:_,maxX:M,minY:A,maxY:T},d.collides(T))continue;d.insert(T)}i.push({w:b,h:w,point:g,text:m,angle:x,color:y,dataIndex:p})}}for(e.restore(),0>=(r=(o=vt(i)).w)&&(r=1),0>=(o=o.h)&&(o=1),c.width=r*window.devicePixelRatio,c.height=o*window.devicePixelRatio,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.textBaseline="top",e.font="20px "+n,e.shadowColor=l&&l.color,e.shadowOffsetX=l&&l.offsetX,e.shadowOffsetY=l&&l.offsetY,e.shadowBlur=l&&l.blur,n=[],l=[],c=[],s=[],h=0,f=i.length;h<f;++h){for(d=i[h],e.fillStyle=d.color,e.fillText(d.text,d.x+a[0],d.y+a[1]),v=(m=zi(d.point,3))[0],g=m[1],m=m[2],x=0;4>x;x++)n.push(v,g,m),n.push(x),n.push(d.w,d.h),n.push(t/20,d.angle*Math.PI/180);v=d.x/r,g=(d.x+d.w)/r,m=(d.y+d.h)/o,x=d.y/o,l.push(v,m,v,x,g,x,g,m),v=4*h,c.push(v,v+2,v+1,v,v+3,v+2),u&&(d=this.indexToRgb(d.dataIndex),s.push(d[0]/255,d[1]/255,d[2]/255),s.push(d[0]/255,d[1]/255,d[2]/255),s.push(d[0]/255,d[1]/255,d[2]/255),s.push(d[0]/255,d[1]/255,d[2]/255))}e.restore(),this.loadTexture(),this.index=c,this.vertexBuffer.updateData(new Float32Array(n)),this.uvBuffer.updateData(new Float32Array(l)),this.indexBuffer.updateData(new Uint32Array(c)),u&&this.pickBuffer.updateData(new Float32Array(s))}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e}),{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),e}(Ds),Qs=function(t){function e(t){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t))}return Mi(e,t),Ge(e,[{key:"initialize",value:function(t){var e=this;this.children&&this.children.forEach((function(r){r.map=e.map,r.setWebglLayer(e.getWebglLayer()),r.commonInitialize&&r.commonInitialize(t),r.initialize&&r.initialize(t),r.onOptionsChanged(r.getOptions()),r.onDataChanged(r.getData()),r.onChanged(r.getOptions(),r.getData())}))}},{key:"isRequestAnimation",value:function(){if(void 0!==this.autoUpdate)return Is(e.prototype.__proto__||Xe(e.prototype),"isRequestAnimation",this).call(this);for(var t=!1,r=0;r<this.children.length;r++)if(this.children[r].isRequestAnimation()){t=!0;break}return t}},{key:"render",value:function(t){this.children&&this.children.forEach((function(e){e.render(t)}))}},{key:"onDestroy",value:function(t){this.children&&this.children.forEach((function(e){e.onDestroy(t)}))}}]),e}(Fs),Js=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).preHeightMapper={},t.preColorMapper={},t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return ze(Is(e.prototype.__proto__||Xe(e.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gridGap:5,height:function(){return 1e3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(t,e){var r=e.gridSize,i=[],n={};e=t.length;for(var a=this.getPointOffset(),o=0;o<e;o++){var s=this.normizedPoint(t[o].geometry.coordinates);s=~~((s[0]+a[0])/r)+"_"+~~((s[1]+a[1])/r),void 0===n[s]&&(n[s]=0);var u=~~t[o].count||1;"properties"in t[o]&&"count"in t[o].properties&&(u=~~t[o].properties.count),n[s]+=u}return Le(n).forEach((function(t){var e=t.split("_");i.push([e[0]*r+r/2,e[1]*r+r/2,n[t]])})),i}},{key:"onChanged",value:function(t,r){r=this.processData(r),Is(e.prototype.__proto__||Xe(e.prototype),"onChanged",this).call(this,t,r)}},{key:"getGridDataRange",value:function(){var t=this.gridData,e=void 0,r=void 0;t[0]&&(e=t[0][2],r=t[0][2]);for(var i=t.length,n=0;n<i;n++){var a=t[n];e=Math.max(a[2],e),r=Math.min(a[2],r)}return{max:e/2,min:r}}},{key:"processData",value:function(t){var e=this.getOptions(),r=e.gridSize,i=[];if("normal"===e.style)for(var n=this.getPointOffset(),a=0;a<t.length;a++){var o=this.normizedPoint(t[a].geometry.coordinates),s=o[0]+n[0];o=o[1]+n[1];var l=~~t[a].count||1;"properties"in t[a]&&"count"in t[a].properties&&(l=~~t[a].properties.count);var h=t[a].color;"properties"in t[a]&&"color"in t[a].properties&&(h=~~t[a].properties.color),i.push([s,o,l,h])}else i=this.generateGrid(t,e);for(t=[],this._preHeightMapper={},this._preColorMapper={},n=0;n<i.length;n++)(a=i[n])[0]=a[0],a[1]=a[1],s=a[2],e.height&&(s="function"==typeof e.height?e.height({count:a[2],coordinates:[a[0],a[1]]}):e.height),o=r/2-e.gridGap,l=a[3],e.color&&(l="function"==typeof e.color?e.color({count:a[2],color:a[3]}):u(l||e.color).unitArray()),h="p"+a[0]+a[1],t.push({geometry:{type:"Polygon",coordinates:[[[a[0]-o,a[1]-o],[a[0]-o,a[1]+o],[a[0]+o,a[1]+o],[a[0]+o,a[1]-o]]]},color:l,origin:a,count:a[2],preHeight:this.preHeightMapper[h],preColor:this.preColorMapper[h],height:s}),this._preHeightMapper[h]=s,this._preColorMapper[h]=l;return this.preHeightMapper=this._preHeightMapper,this.preColorMapper=this._preColorMapper,this.gridData=t}}]),e}(Gs),$s=function(t){function e(t){Ut(this,e);var r=mi(this,(e.__proto__||Xe(e)).call(this,t));return r.gridLayer=new Js(t),r.options.textOptions=ze({show:!1,flat:!0,unit:"m",fontSize:100,collides:!1},t.textOptions||{}),r.textLayer=new Ks(r.options.textOptions),r.children=[r.gridLayer,r.textLayer],r}return Mi(e,t),Ge(e,[{key:"pick",value:function(t,e){return this.gridLayer.pick(t,e)}},{key:"setData",value:function(t){this.gridLayer.setData(t),this.options.textOptions.show&&this.setTextData()}},{key:"setTextData",value:function(){var t=this.gridLayer.gridData.map((function(t){return{geometry:{type:"Point",coordinates:[t.origin[0],t.origin[1],t.height+5]},properties:{text:t.count}}}));this.textLayer.setData(t)}},{key:"setOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.options.textOptions;ze(this.options,t),this.gridLayer.setOptions(this.options),t.textOptions&&(this.options.textOptions.show&&this.setTextData(),this.options.textOptions=ze(e||{},t.textOptions),this.textLayer.setOptions(this.options.textOptions))}},{key:"getData",value:function(){return this.gridLayer.getData()}},{key:"render",value:function(t){this.gridLayer.render(t),this.options.textOptions.show&&this.textLayer.render(t)}}]),e}(Qs),tu=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).gridLayer=new $s(t.getGridOptions()),t.children=[t.gridLayer],t.options.riseTime&&(t.autoUpdate=!0),t}return Mi(e,t),Ge(e,[{key:"pick",value:function(t,e){return this.gridLayer.pick(t,e)}},{key:"onDataChanged",value:function(t){this.gridLayer.setData(t)}},{key:"getGridOptions",value:function(){var t=this.getOptions(),e=t.max,r=t.min;void 0===e&&(e=(r=this.gridLayer.getGridDataRange()).max,r=r.min);var i=new w({max:e,min:r,gradient:t.gradient,maxSize:t.maxHeight,minSize:t.minHeight});return t.height=function(t){var e=i.getSize(t.count);return"properties"in t&&"count"in t.properties&&(e=i.getSize(t.properties.count)),e},t.color=function(t){var e=i.getImageData(t.count);return"properties"in t&&"count"in t.properties&&(e=i.getImageData(t.properties.count)),[e[0]/255,e[1]/255,e[2]/255,e[3]/255]},t}},{key:"onOptionsChanged",value:function(t){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,style:"grid",gridSize:500,maxHeight:8e3,minHeight:200,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]),e}(Qs),eu=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="SimpleLineLayer",t.bufferData=[],t}return Mi(e,t),Ge(e,[{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new us(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;\n#if defined(DASH)\nvarying vec3 vPos;\n#endif\nvoid main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);\n#if defined(DASH)\nvPos=aPos;\n#endif\n}",fragmentShader:"precision highp float;varying vec4 vColor;varying vec3 vPos;void main(){\n#if defined(DASH)\nif(mod(vPos.x,3.0)<1.5){discard;}\n#endif\ngl_FragColor=vColor;}",defines:e.useDash?["DASH"]:""},this),this.buffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new ds({gl:t,program:this.program,attributes:[{stride:28,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12}]})}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,e){var r=this;if(this.gl){var i=[],n=function(t,e){if(t)for(var n=0;n<t.length-1;n++){var a=r.normizedPoint(t[n]);i.push(a[0]),i.push(a[1]),i.push(a[2]),i.push(e[0],e[1],e[2],e[3]),a=r.normizedPoint(t[n+1]),i.push(a[0]),i.push(a[1]),i.push(a[2]),i.push(e[0],e[1],e[2],e[3])}};t=t.color;for(var a=0;a<e.length;a++){var o=this.getProperty("color",t,e[a]);o=this.normizedColor(o);var s=e[a].geometry,u=s.coordinates;if("MultiPolygon"===s.type){if(u)for(s=0;s<u.length;s++)n(u[s][0],o)}else if("Polygon"===s.type)u&&n(u[0],o);else if("MultiLineString"===s.type){if(u)for(s=0;s<u.length;s++)n(u[s],o)}else n(u,o)}this.bufferData=i,this.buffer.updateData(new Float32Array(i))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,this.bufferData&&!(0>=this.bufferData.length)){var r=this.program;r.use(e),this.vertexArray.bind(),r.setUniforms({u_matrix:t}),t=this.getOptions(),this.setGLState({blend:!0,blendFunc:"lighter"===t.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEquation:e.FUNC_ADD}),e.drawArrays(e.LINES,0,this.bufferData.length/7)}}}]),e}(Ds),ru=_r.f("species");i(n((function(t){t.exports={default:ru,__esModule:!0}})));var iu=void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};void 0===iu.TYPED_ARRAY_SUPPORT||iu.TYPED_ARRAY_SUPPORT;var nu={normal:null,road:_t()},au=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="LineLayer3D",t.initData(),t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",offset:0,blend:"normal",width:4,unit:"px",flat:!1,antialias:!1,style:"normal",dashArray:[0,0],dashOffset:0,polygonOffset:[0,0]}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[],uv:[]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),r=[];e.enablePicked&&r.push("PICK"),nu[e.style]&&(this.isUseTexture=!0,r.push("USE_TEXTURE")),this.program=new us(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;uniform mat4 uMatrix;uniform bool uFlat;uniform bool uUnitPx;uniform vec2 uDashArray;uniform float thickness;uniform float zoomUnits;uniform float devicePixelRatio;uniform float uOffset;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aDistance;attribute float aTotalDistance;\n#if defined(USE_TEXTURE)\nattribute vec2 uv;\n#endif\nvarying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vTotalDistance;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}vec3 getNormalAndWidth(vec2 currentScreen,vec2 previousScreen,vec2 nextScreen,float thickness){vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){thickness=thickness/dot(miter,perp);}}vec2 normal=vec2(-dir.y,dir.x);return vec3(normal,thickness);}void main(){vColor=aColor;vCounter=aDistance/aTotalDistance;vDashArray=uDashArray/aTotalDistance;if(uUnitPx){vDashArray*=zoomUnits;}vTotalDistance=aTotalDistance;\n#if defined(USE_TEXTURE)\nvUV=uv;\n#endif\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nif(uFlat){float width=thickness;if(uUnitPx){width*=zoomUnits;}vec3 nw=getNormalAndWidth(position.xy,previous.xy,next.xy,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;float offsetXy=uOffset;float offsetHeight=uOffset/100.0;if(uUnitPx){offsetXy/=zoomUnits;offsetHeight*=zoomUnits;}gl_Position=uMatrix*vec4(position.xy+normal*(direction+offsetXy),position.z+offsetHeight,1.0);}else{vec4 previousProjected=uMatrix*vec4(previous,1.0);vec4 currentProjected=uMatrix*vec4(position,1.0);vec4 nextProjected=uMatrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float width=thickness*devicePixelRatio;if(!uUnitPx){width/=zoomUnits;}vec3 nw=getNormalAndWidth(currentScreen,previousScreen,nextScreen,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;vec2 pos=currentScreen+normal*direction;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}}",fragmentShader:"precision highp float;varying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vCounter;varying float vTotalDistance;uniform bool uAntialias;uniform float uDashOffset;uniform float zoomUnits;uniform float thickness;\n#if defined(USE_TEXTURE)\nuniform float uTextureMargin;uniform sampler2D textureImage;\n#endif\nvoid main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.8,1.0,length(vNormal));color.a*=blur;}\n#if defined(USE_TEXTURE)\nfloat segLen=uTextureMargin*zoomUnits;float textureLen=thickness*zoomUnits;float deltaX=mod(vUV.x,segLen);float middle=segLen/2.0;if(deltaX>=middle&&deltaX<=middle+textureLen){float uvx=(deltaX-middle)/textureLen;vec4 texture=texture2D(textureImage,vec2(uvx,vUV.y));color=texture.a>=0.5 ? texture : color;}\n#endif\nif(vDashArray.y>0.0){float offset=uDashOffset*zoomUnits/vTotalDistance;color.a*=(1.0-step(vDashArray.x,mod(vCounter+offset,vDashArray.x+vDashArray.y)));}gl_FragColor=color;}",defines:r},this),this.prevBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=(r=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:8,name:"aDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0},{stride:8,name:"aTotalDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:4}]).concat(this.getCommonAttributes()),nu[e.style]&&(r.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),this.setOptions({texture:nu[e.style]}),this.loadTexture()),this.vertexArray=new ds({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var r=this;if(this.gl){this.initData();for(var i=t.color,n=[],a=0;a<e.length;a++){var o=[],s=e[a].geometry.coordinates;s&&0<s.length&&(o="MultiPolygon"===e[a].geometry.type?s.reduce((function(t,e){return t.concat(e)}))[0].map((function(t){return r.normizedPoint(t)})):"Polygon"===e[a].geometry.type||"MultiLineString"===e[a].geometry.type?s[0].map((function(t){return r.normizedPoint(t)})):s.map((function(t){return r.normizedPoint(t)}))),s=this.getProperty("color",i,e[a]),s=this.getProperty("lineColor",i,e[a]),s=this.normizedColor(s);for(var u=this.addMultipleCoords(o),l=0;l<u.length;l++)this.processData(this.dataMgr,u[l],s);if(t.enablePicked)for(s=this.indexToRgb(a),u=0;u<o.length;u++)n.push(s[0]/255,s[1]/255,s[2]/255),n.push(s[0]/255,s[1]/255,s[2]/255),t.repeat&&(n.push(s[0]/255,s[1]/255,s[2]/255),n.push(s[0]/255,s[1]/255,s[2]/255),n.push(s[0]/255,s[1]/255,s[2]/255),n.push(s[0]/255,s[1]/255,s[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(this.dataMgr.uv)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(n))}}},{key:"processData",value:function(t,e,r){var i,n,a,o,s,u,l,h,f=e.length,c=t.position.length/6,d=yt(e),v=d.arr,p=d.total;d=pt(v.map((function(t){return[t,p]}))),v=v.map((function(t){return[t,0,t,1]}));var g=pt(e.map((function(t){return-1})),!0),m=pt(e),x=pt(e.map(mt(-1))),y=pt(e.map(mt(1)));e=pt(e.map((function(t){return r}))),f=gt(f,c),(i=t.uv).push.apply(i,Vi(xt(v))),(n=t.counter).push.apply(n,Vi(xt(d))),(a=t.position).push.apply(a,Vi(xt(m))),(o=t.prev).push.apply(o,Vi(xt(x))),(s=t.next).push.apply(s,Vi(xt(y))),(u=t.direction).push.apply(u,Vi(g)),(l=t.color).push.apply(l,Vi(xt(e))),(h=t.index).push.apply(h,Vi(f))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix,i=this.dataMgr;if(i&&!(0>=i.index.length)&&this.map){var n=this.getOptions(),a=this.program;a.use(e),t=ze(this.getCommonUniforms(t),{uMatrix:r,uFlat:n.flat,uUnitPx:"px"===n.unit,zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio,thickness:n.width,uDashArray:n.dashArray,uDashOffset:n.dashOffset,uAntialias:n.antialias,uOffset:n.offset}),this.isUseTexture&&(t=ze(t,{uTextureMargin:140,textureImage:this.texture})),a.setUniforms(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===n.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,i.index.length,e.UNSIGNED_INT,0)}}},{key:"loadTexture",value:function(t){var e=this,r=this.getOptions();r.texture?j(this.gl,r.texture,(function(r,i){e.image=i,e.texture=r,t&&t(),e.webglLayer.render()})):(this.image=this.texture=null,t&&t())}}]),e}(Ds),ou=function(){function t(e){Ut(this,t),this.join=e.join||"miter",this.cap=e.cap||"butt",this.thickness=e.thickness||4,this.miterLimit=e.miterLimit||2*this.thickness,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],colors:[],uvs:[],startIndex:0,maxDistance:0},this._lastFlip=-1,this._started=!1,this._normal=null,this._totalDistance=0,this._colorFlag=!1,this._count=0}return Ge(t,[{key:"extrude",value:function(t,e,r,i){var n=this.complex;if(1>=t.length)return n;this._lastFlip=-1,this._started=!1,this._normal=null,this._totalDistance=0;for(var a=t.length,o=n.startIndex,s=null,u=1;u<a;u++){var l=s||t[u-1],h=t[u],f=u<a-1?t[u+1]:null;f&&h[0]===f[0]&&h[1]===f[1]&&h[2]===f[2]?s=l:-1!==(l=this._segment(n,o,l,h,f,e,r,i))&&(o+=l,s=null)}return this.dash&&(n.maxDistance=Math.max(this._totalDistance,n.maxDistance)),n.startIndex=n.positions.length/7,n}},{key:"_segment",value:function(t,e,r,i,n,a,o,s){s[0]instanceof Array&&(this._colorFlag=!0);var u=0,l=$o.create(),h=$o.create(),f=$o.create(),c=$o.create(),d=t.indices,v=t.positions,p=t.normals,g=t.colors;t=t.uvs;var m="square"===this.cap,x="round"===this.cap,y="bevel"===this.join,b="round"===this.join,_=[i[0],i[1]],A=[r[0],r[1]];Tt(h,_,A);var T=0;if(this.dash&&(T=this._calcDistance(_,A),this._totalDistance+=T),this._normal||(this._normal=$o.create(),At(this._normal,h)),!this._started)if(this._started=!0,m){A=$o.create();var w=$o.create();$o.add(A,this._normal,h),$o.sub(w,this._normal,h),p.push(w[0],w[1],0),p.push(A[0],A[1],0),v.push(r[0],r[1],r[2],this._totalDistance-T,a,o,0),v.push(r[0],r[1],r[2],this._totalDistance-T,-a,o,0),t.push(this._totalDistance-T,0,this._totalDistance-T,1),this._colorFlag?(g.push(s[0][0],s[0][1],s[0][2],s[0][3]),g.push(s[0][0],s[0][1],s[0][2],s[0][3])):(g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]))}else if(x){A=$o.fromValues(-h[0],-h[1]),w=$o.create(),$o.sub(w,this._normal,h),$o.normalize(w,w);var M=$o.create();$o.add(M,this._normal,h),$o.normalize(M,M);var C=$o.fromValues(this._normal[0],this._normal[1]),R=$o.fromValues(-this._normal[0],-this._normal[1]);for(p.push(A[0],A[1],0),p.push(w[0],w[1],0),p.push(-M[0],-M[1],0),p.push(C[0],C[1],0),p.push(R[0],R[1],0),A=0;5>A;A++)v.push(r[0],r[1],r[2],this._totalDistance-T,a,o,0),t.push(this._totalDistance-T,0),this._colorFlag?g.push(s[0][0],s[0][1],s[0][2],s[0][3]):g.push(s[0],s[1],s[2],s[3]);d.push(e+0,e+2,e+1,e+1,e+2,e+3,e+3,e+2,e+4),u+=3,e+=3}else this._extrusions(v,p,t,g,r,this._normal,a,this._totalDistance-T,o,s,0);if(d.push.apply(d,Vi(-1===this._lastFlip?[e+0,e+1,e+2]:[e+1,e+0,e+2])),n)Tt(f,[n[0],n[1]],_),this._count++,$o.create(),$o.add(c,h,f),$o.normalize(c,c),x=$o.fromValues(-c[1],c[0]),h=$o.fromValues(-h[1],h[0]),h=[a/$o.dot(x,h),x],x=(h=zi(h,2))[0],h=h[1],c=0<$o.dot(c,this._normal)?-1:1,y||"miter"!==this.join||Math.abs(x)>this.miterLimit&&(y=!0),y?(b=Math.min(2*a,Math.abs(x)),p.push(this._normal[0],this._normal[1],0),p.push(h[0],h[1],0),v.push(i[0],i[1],i[2],this._totalDistance,a*c,o,0),v.push(i[0],i[1],i[2],this._totalDistance,-b*c,o,0),d.push.apply(d,Vi(this._lastFlip===-c?[e+2,e+1,e+3]:[e+0,e+2,e+3])),At(l,f),$o.copy(this._normal,l),p.push(this._normal[0],this._normal[1],0),v.push(i[0],i[1],i[2],this._totalDistance,a*c,o,0),d.push.apply(d,Vi(1===c?[e+2,e+3,e+4]:[e+3,e+2,e+4])),this._flipedUV(t,this._totalDistance,c,!0),this._colorFlag?(g.push(s[this._count][0],s[this._count][1],s[this._count][2],s[this._count][3]),g.push(s[this._count][0],s[this._count][1],s[this._count][2],s[this._count][3]),g.push(s[this._count][0],s[this._count][1],s[this._count][2],s[this._count][3])):(g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3])),u+=3):b?(b=Math.min(2*a,Math.abs(x)),p.push(this._normal[0],this._normal[1],0),p.push(h[0],h[1],0),p.push(h[0],h[1],0),v.push(i[0],i[1],i[2],this._totalDistance,a*c,o,0),v.push(i[0],i[1],i[2],this._totalDistance,a*c,o,0),v.push(i[0],i[1],i[2],this._totalDistance,-b*c,o,0),d.push.apply(d,Vi(this._lastFlip===-c?[e+2,e+1,e+4,e+2,e+4,e+3]:[e+0,e+2,e+4,e+2,e+3,e+4])),At(l,f),$o.copy(this._normal,l),p.push(this._normal[0],this._normal[1],0),v.push(i[0],i[1],i[2],this._totalDistance,a*c,o,0),d.push.apply(d,Vi(1===c?[e+4,e+3,e+5]:[e+3,e+4,e+5])),this._flipedUV(t,this._totalDistance,c,!1),this._colorFlag?(g.push(s[this._count][0],s[this._count][1],s[this._count][2],s[this._count][3]),g.push(s[this._count][0],s[this._count][1],s[this._count][2],s[this._count][3]),g.push(s[this._count][0],s[this._count][1],s[this._count][2],s[this._count][3]),g.push(s[this._count][0],s[this._count][1],s[this._count][2],s[this._count][3])):(g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3])),u+=4):(this._extrusions(v,p,t,g,i,h,x,this._totalDistance,o,s,this._count),d.push.apply(d,Vi(-1===this._lastFlip?[e+2,e+1,e+3]:[e+2,e+0,e+3])),c=-1,$o.copy(this._normal,h),u+=2),this._lastFlip=c;else if(At(this._normal,h),l=s.length-1,m?(f=$o.create(),b=$o.create(),$o.add(f,h,this._normal),$o.sub(b,h,this._normal),p.push(f[0],f[1],0),p.push(b[0],b[1],0),v.push(i[0],i[1],i[2],this._totalDistance,a,o,0),v.push(i[0],i[1],i[2],this._totalDistance,a,o,0),t.push(this._totalDistance,0,this._totalDistance,1),this._colorFlag?(g.push(s[l][0],s[l][1],s[l][2],s[l][3]),g.push(s[l][0],s[l][1],s[l][2],s[l][3])):(g.push(s[0],s[1],s[2],s[3]),g.push(s[0],s[1],s[2],s[3]))):this._extrusions(v,p,t,g,i,this._normal,a,this._totalDistance,o,s,l),d.push.apply(d,Vi(-1===this._lastFlip?[e+2,e+1,e+3]:[e+2,e+0,e+3])),u+=2,x){for(f=$o.create(),$o.add(f,h,this._normal),$o.normalize(f,f),b=$o.create(),$o.sub(b,h,this._normal),$o.normalize(b,b),h=$o.fromValues(h[0],h[1]),p.push(f[0],f[1],0),p.push(b[0],b[1],0),p.push(h[0],h[1],0),p=0;3>p;p++)v.push(i[0],i[1],i[2],this._totalDistance,a,o,0),t.push(this._totalDistance,0),this._colorFlag?g.push(s[l][0],s[l][1],s[l][2],s[l][3]):g.push(s[0],s[1],s[2],s[3]);d.push(e+2,e+3,e+4,e+4,e+3,e+5,e+4,e+5,e+6),u+=3}return u}},{key:"_extrusions",value:function(t,e,r,i,n,a,o,s,u,l,h){e.push(a[0],a[1],0),e.push(a[0],a[1],0),t.push(n[0],n[1],n[2],s,o,u,0),t.push(n[0],n[1],n[2],s,-o,u,0),r.push(s,0,s,1),this._colorFlag?(i.push(l[h][0],l[h][1],l[h][2],l[h][3]),i.push(l[h][0],l[h][1],l[h][2],l[h][3])):(i.push(l[0],l[1],l[2],l[3]),i.push(l[0],l[1],l[2],l[3]))}},{key:"_calcDistance",value:function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}},{key:"_flipedUV",value:function(t,e,r,i){i?-1===r?t.push(e,0,e,1,e,0):t.push(e,1,e,0,e,1):-1===r?t.push(e,0,e,0,e,1,e,0):t.push(e,1,e,1,e,0,e,1)}}]),t}(),su={normal:null,road:_t,arrow:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.width;t=t.color;var r=bt(),i=r.canvas;return(r=r.ctx).save(),r.moveTo(5,0),r.lineTo(32,16),r.lineTo(5,32),r.strokeStyle=t||"#fff",r.lineWidth=e||8,r.stroke(),r.restore(),i}},uu=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="LineLayer",t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{style:"normal",styleOptions:{},color:"rgba(25, 25, 250, 1)",blend:"default",lineJoin:"miter",lineCap:"butt",unit:"px",width:4,offset:0,antialias:!1,dashArray:[0,0],dashOffset:0,animation:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0],depthTest:!0,depthWrite:!0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),r=[];e.enablePicked&&r.push("PICK"),su[e.style]&&(this.isUseTexture=!0,this.prevStyle=e.style,this.prevStyleOptions=e.styleOptions,r.push("USE_TEXTURE")),!0===e.animation&&(this.isAnimateLine=!0,this.date=new Date,this.autoUpdate=!0,r.push("USE_LINE_ANIMATION")),!0===e.useDash&&r.push("USE_SIMPLE_DASH"),this.program=new us(this.gl,{vertexShader:"precision highp float;uniform vec4 uSelectedColor;uniform mat4 u_matrix;uniform vec2 u_dash_array;uniform float u_zoom_units;uniform float u_zIndex;uniform bool u_unit_px;attribute vec4 a_color;attribute vec3 a_position;attribute vec3 a_normal;attribute float a_distance;attribute float a_total_distance;attribute float a_width;attribute float a_offset;\n#if defined(USE_TEXTURE)\nattribute vec2 uv;\n#endif\nvarying vec4 v_color;varying vec2 v_normal;varying vec2 v_uv;varying vec2 v_dash_array;varying float v_total_distance;varying float v_counter;varying float v_width;\n#if defined(USE_SIMPLE_DASH)\nvarying vec3 v_position;\n#endif\nvoid main(){v_width=a_width;v_color=a_color;v_counter=a_distance/a_total_distance;v_dash_array=u_dash_array/a_total_distance;if(u_unit_px){v_dash_array*=u_zoom_units;}v_total_distance=a_total_distance;v_normal=vec2(normalize(a_normal.xy)*sign(a_width));\n#if defined(USE_TEXTURE)\nv_uv=uv;\n#endif\n#if defined(PICK)\nif(mapvIsPicked()){v_color=uSelectedColor;}\n#endif\nvec2 extrude=a_normal.xy*a_width/2.0;if(u_unit_px){extrude*=u_zoom_units;}vec2 offsetXY=a_normal.xy*-a_offset;float offsetZ=a_offset/100.0+u_zIndex;if(u_unit_px){offsetXY*=u_zoom_units;offsetZ*=u_zoom_units;}\n#if defined(USE_SIMPLE_DASH)\nv_position=a_position;\n#endif\ngl_Position=u_matrix*vec4(a_position.xy+extrude+offsetXY,a_position.z+offsetZ,1.0);}",fragmentShader:"precision highp float;varying vec4 v_color;varying vec2 v_normal;varying vec2 v_uv;varying vec2 v_dash_array;varying float v_counter;varying float v_total_distance;varying float v_width;\n#if defined(USE_SIMPLE_DASH)\nvarying vec3 v_position;\n#endif\nuniform bool u_antialias;uniform float u_dash_offset;uniform float u_zoom_units;\n#if defined(USE_LINE_ANIMATION)\nuniform bool u_animate;uniform float u_time;uniform float u_duration;uniform float u_interval;uniform float u_trail_length;\n#endif\n#if defined(USE_TEXTURE)\nuniform float u_texture_width;uniform float u_texture_margin;uniform sampler2D u_sampler;\n#endif\nvoid main(){vec4 color=v_color;\n#if defined(USE_SIMPLE_DASH)\nif(mod(v_position.x,5.0)<3.0){discard;}\n#endif\nif(u_antialias){float blur=1.0;blur=1.0-smoothstep(0.9,1.0,length(v_normal));color.a*=blur;}\n#if defined(USE_LINE_ANIMATION)\nif(u_animate){float alpha=1.0-fract(mod(1.0-v_counter,u_interval)*(1.0/u_interval)+u_time/u_duration);alpha=(alpha+u_trail_length-1.0)/u_trail_length;color.a*=alpha;gl_FragColor=color;return;}\n#endif\n#if defined(USE_TEXTURE)\nfloat margin_width=u_texture_margin*u_zoom_units;float margin_width_half=margin_width/2.0;float texture_width=u_texture_width*u_zoom_units;float delta=mod(v_uv.x,texture_width+margin_width);if(delta>=margin_width_half&&delta<=margin_width_half+texture_width){float uvx=(delta-margin_width_half)/texture_width;vec4 texture=texture2D(u_sampler,vec2(uvx,v_uv.y));color=texture.a>=0.5 ? texture : color;}\n#endif\nif(v_dash_array.y>0.0){float offset=u_dash_offset*u_zoom_units/v_total_distance;color.a*=(1.0-step(v_dash_array.x,mod(v_counter+offset,v_dash_array.x+v_dash_array.y)));}gl_FragColor=color;}",defines:r},this),this.positionBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.normalBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),r=(r=[{stride:28,name:"a_position",buffer:this.positionBuffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"a_distance",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:12},{stride:28,name:"a_width",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:16},{stride:28,name:"a_offset",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:20},{stride:28,name:"a_total_distance",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:24},{stride:12,name:"a_normal",buffer:this.normalBuffer,size:3,type:"FLOAT",offset:0},{stride:16,name:"a_color",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0}]).concat(this.getCommonAttributes()),this.isUseTexture&&(this.uvBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),r.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),e=(0,su[e.style])(e.styleOptions),this.setOptions({texture:e}),this.loadTexture()),this.vertexArray=new ds({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var r=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.gl)if(!this.isUseTexture||this.prevStyle===t.style&&$i(this.prevStyleOptions)===$i(t.styleOptions))this.parseData(t,e,i);else{this.prevStyle=t.style,this.prevStyleOptions=t.styleOptions;var n=(0,su[t.style])(t.styleOptions);this.setOptions({texture:n}),this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){r.loadTexture((function(){r.parseData(t,e,i)}))}),0)}}},{key:"onParseProperties",value:function(t){return this.normizedColor(t)}},{key:"parseData",value:function(t,e,r){var i=this,n=t.dashArray,a=t.width,o=t.color,s=t.offset;n=!!this.isUseTexture||!!n[1]||!!this.isAnimateLine;for(var u=new ou({dash:n,cap:t.lineCap,join:t.lineJoin,miterLimit:t.miterLimit,thickness:a}),l=[],h=function(n){var h=e[n].geometry.coordinates;h&&0<h.length&&("MultiPolygon"===e[n].geometry.type?h=h.reduce((function(t,e){return t.concat(e)})):"LineString"===e[n].geometry.type&&(h=[h]),h=h.map((function(t){return t=t.map((function(t){return i.normizedPoint(t)})),!0===r.closePath&&t[0].toString()!==t[t.length-1].toString()&&t.push(t[0]),t})));var f=i.getProperty("color",o,e[n]);f=i.onParseProperties(f,e[0].geometry.coordinates.length);var c=i.getProperty("width",a,e[n]);c=Number(c);var d=i.getProperty("offset",s,e[n]);d=Number(d);var v=u.complex.startIndex;h=i.addMultipleCoords(h);for(var p=0;p<h.length;p++)h[p].forEach((function(t){u.extrude(t,c,d,f)}));if(t.enablePicked)for(n=i.indexToRgb(n),h=u.complex.startIndex;v<h;v++)l.push(n[0]/255,n[1]/255,n[2]/255),t.repeat&&(l.push(n[0]/255,n[1]/255,n[2]/255),l.push(n[0]/255,n[1]/255,n[2]/255))},f=0;f<e.length;f++)h(f);if(h=u.complex,n)for(f=0;f<h.positions.length/7;f++)h.positions[7*f+6]=h.maxDistance;this.lineData=h,this.positionBuffer.updateData(new Float32Array(h.positions)),this.normalBuffer.updateData(new Float32Array(h.normals)),this.colorBuffer.updateData(new Float32Array(h.colors)),this.indexBuffer.updateData(new Uint32Array(h.indices)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(h.uvs)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(l))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix,i=this.lineData;if(i&&!(0>=i.indices.length)&&this.map){var n=this.getOptions(),a=this.program;a.use(e),t=ze(this.getCommonUniforms(t),{u_matrix:r,u_zoom_units:this.map.getZoomUnits(),u_dash_array:n.dashArray,u_dash_offset:n.dashOffset,u_antialias:n.antialias,u_unit_px:"px"===n.unit,u_zIndex:n.zIndex}),this.isUseTexture&&(t=ze(t,{u_texture_width:n.width,u_texture_margin:140,u_sampler:this.texture})),this.isAnimateLine&&(r=this.map.getZoom(),t=ze(t,{u_time:(new Date-this.date)/1e3,u_animate:!!(r>=n.minZoom&&r<=n.maxZoom&&this.autoUpdate),u_duration:n.duration,u_interval:n.interval,u_trail_length:n.trailLength})),a.setUniforms(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:X(e,n.blend),polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,i.indices.length,e.UNSIGNED_INT,0)}}},{key:"loadTexture",value:function(t){var e=this,r=this.getOptions();r.texture?j(this.gl,r.texture,(function(r,i){e.image=i,e.texture=r,t&&t(),e.webglLayer.render()})):(this.image=this.texture=null,t&&t())}}]),e}(Ds),lu=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="LineRainbowLayer",t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{style:"normal",styleOptions:{},color:"rgba(25, 25, 250, 1)",blend:"normal",lineJoin:"miter",lineCap:"butt",unit:"px",width:4,offset:0,antialias:!1,dashArray:[0,0],dashOffset:0,animation:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0],depthTest:!0,depthWrite:!0}}},{key:"onDestroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.options=this.data=this.indexBuffer=this.normalBuffer=this.colorBuffer=this.positionBuffer=this.program=this.vertexArray=null}},{key:"onParseProperties",value:function(t,e){var r=t.length;if(t instanceof Array){var i=[];if(r<e){var n=Math.floor(e/r);e%=r;for(var a=0,o=0;a<r;a++,o++)for(var s=o<e?n+1:n,u=0;u<s;u++)i.push(t[a]);t=i}for(r=[],n=0;n<t.length;n++)r.push(this.normizedColor(t[n]))}else r=this.normizedColor(t);return r}}]),e}(uu),hu=function(){function t(e,r){Ut(this,t),this.layer=e,this.gl=r,this.initData()}return Ge(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(t,e){this.initData();var r=t.color,i=t.height,n=t.gradient;t=this.gl;for(var a=0;a<e.length;a++){var o=e[a].geometry.coordinates,s=o.length;this.maxLength=s>this.maxLength?s:this.maxLength;for(var u=[],l=0;l<s;l++){var h=this.layer.normizedPoint(o[l]);u.push(h)}s=e[a].color||r,"properties"in e[a]&&"color"in e[a].properties&&(s=e[a].properties.color),n||"[object Function]"!==Object.prototype.toString.call(s)||(s=s(e[a])),o=this.layer.normizedColor(n?n[0]:s),s=this.layer.normizedColor(n?n[1]:s),l=e[a].height||i,"properties"in e[a]&&"height"in e[a].properties&&(l=e[a].properties.height),"[object Function]"===Object.prototype.toString.call(l)&&(l=l(e[a])),this.processData(this.outWall3d,u,o,s,l)}for(e=0;e<this.outWall3d.vertex.length;e++){for(r=[],i=this.outWall3d.vertex[e].length,n=0;n<i;n++)r.push.apply(r,Vi(this.outWall3d.vertex[e][n]));i=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),this.outWall3d.vertexBuffer[e]=i,t.bindBuffer(t.ARRAY_BUFFER,null),i=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[e]),t.STATIC_DRAW),this.outWall3d.indexBuffer[e]=i,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,r,i,n){var a=t.vertex[t.vertex.length-1],o=t.index[t.index.length-1],s=e.length;(!o||65536<=o.length+2*s+2)&&(a=[],o=[],t.vertex.push(a),t.index.push(o)),(t=a.length)&&o.push(t-1,t);for(var u=t=0;u<s;u++){var l=[],h=[],f=e[u];l.push(f[0],f[1]),l.push(f[2]?Number(f[2])+n:n),l.push(f[3]?Number(f[3]):u),l.push(t),l.push(r[0],r[1],r[2],r[3]),h.push(f[0],f[1]),h.push(f[2]?Number(f[2]):0),h.push(f[3]?Number(f[3]):u),h.push(t),h.push(i[0],i[1],i[2],i[3]),f=a.length,a.push(l,h),o.push(f,f+1),u<s-1&&(t+=this.getDistance(e[u],e[u+1]))}}},{key:"getDistance",value:function(t,e){return Math.sqrt(Math.pow(Math.abs(t[0]-e[0]),2)+Math.pow(Math.abs(t[1]-e[1]),2))}}]),t}(),fu=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new hu(this,this.gl),this.program=new us(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),void 0===t.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var i=this.getOptions(),n=this.program;for(e.useProgram(n.program),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),e.enableVertexAttribArray(n.attributes.aPos),e.enableVertexAttribArray(n.attributes.aDistance),e.enableVertexAttribArray(n.attributes.aColor),e.uniformMatrix4fv(n.uniforms.u_matrix,!1,r),e.uniform1f(n.uniforms.currentTime,this.time),e.uniform1f(n.uniforms.trailLength,i.trailLength),r=0;r<t.vertex.length;r++)if(!(0>=t.vertex[r].length)){var a=t.vertex[r],o=new Float32Array(a[0]).BYTES_PER_ELEMENT;a=o*a[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[r]),e.vertexAttribPointer(n.attributes.aPos,4,e.FLOAT,!1,a,0),e.vertexAttribPointer(n.attributes.aDistance,1,e.FLOAT,!1,a,4*o),e.vertexAttribPointer(n.attributes.aColor,4,e.FLOAT,!1,a,5*o),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[r]),e.drawElements(e.TRIANGLE_STRIP,t.index[r].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}this.time+=i.step,this.time>this.endTime&&(this.time=this.startTime)}}}]),e}(Ds),cu=function(t,e,r,i){if(!(t instanceof e)||void 0!==i&&i in t)throw TypeError(r+": incorrect invocation!");return t},du=n((function(t){var e={},r={};(t=t.exports=function(t,i,n,a,o){var s,u;if(o=o?function(){return t}:Di(t),n=ve(n,a,i?2:1),a=0,"function"!=typeof o)throw TypeError(t+" is not iterable!");if(void 0===o||qe.Array!==o&&Ni[Ui]!==o){for(a=o.call(t);!(u=a.next()).done;)if((o=Ii(a,n,u.value,i))===e||o===r)return o}else for(s=Qt(t.length);s>a;a++)if((o=i?n(ge(u=t[a])[0],u[1]):n(t[a]))===e||o===r)return o}).BREAK=e,t.RETURN=r})),vu=ir("species"),pu=function(t,e){var r;return void 0===(t=ge(t).constructor)||null==(r=ge(t)[vu])?e:de(r)},gu=function(t,e,r){var i=void 0===r;switch(e.length){case 0:return i?t():t.call(r);case 1:return i?t(e[0]):t.call(r,e[0]);case 2:return i?t(e[0],e[1]):t.call(r,e[0],e[1]);case 3:return i?t(e[0],e[1],e[2]):t.call(r,e[0],e[1],e[2]);case 4:return i?t(e[0],e[1],e[2],e[3]):t.call(r,e[0],e[1],e[2],e[3])}return t.apply(r,e)},mu=ee.process,xu=ee.setImmediate,yu=ee.clearImmediate,bu=ee.MessageChannel,_u=ee.Dispatch,Au=0,Tu={},wu=function(){var t=+this;if(Tu.hasOwnProperty(t)){var e=Tu[t];delete Tu[t],e()}},Mu=function(t){wu.call(t.data)};if(!xu||!yu)if(xu=function(t){for(var e=[],r=1;arguments.length>r;)e.push(arguments[r++]);return Tu[++Au]=function(){gu("function"==typeof t?t:Function(t),e)},Cu(Au),Au},yu=function(t){delete Tu[t]},"process"==Wt(mu))var Cu=function(t){mu.nextTick(ve(wu,t,1))};else if(_u&&_u.now)Cu=function(t){_u.now(ve(wu,t,1))};else if(bu){var Ru=new bu,Su=Ru.port2;Ru.port1.onmessage=Mu,Cu=ve(Su.postMessage,Su,1)}else ee.addEventListener&&"function"==typeof postMessage&&!ee.importScripts?(Cu=function(t){ee.postMessage(t+"","*")},ee.addEventListener("message",Mu,!1)):Cu="onreadystatechange"in(be?ye.createElement("script"):{})?function(t){Je.appendChild(be?ye.createElement("script"):{}).onreadystatechange=function(){Je.removeChild(this),wu.call(t)}}:function(t){setTimeout(ve(wu,t,1),0)};var Pu,Eu=xu,Lu=ee.MutationObserver||ee.WebKitMutationObserver,Fu=ee.process,Du=ee.Promise,Bu="process"==Wt(Fu),Ou={f:function(t){return new wt(t)}},ku=function(t){try{return{e:!1,v:t()}}catch(e){return{e:!0,v:e}}},zu=ee.navigator,Iu=zu&&zu.userAgent||"",Uu=function(t,e){return ge(t),pe(e)&&e.constructor===t?e:((0,(t=Ou.f(t)).resolve)(e),t.promise)},Nu=function(t,e,r){for(var i in e)r&&t[i]?t[i]=e[i]:Ce(t,i,e[i]);return t},Hu=ir("species"),ju=function(t){t="function"==typeof te[t]?te[t]:ee[t],xe&&t&&!t[Hu]&&we.f(t,Hu,{configurable:!0,get:function(){return this}})},Xu=function(){var t,e,r=function(){var r;for(Bu&&(r=Fu.domain)&&r.exit();t;){var n=t.fn;t=t.next;try{n()}catch(a){throw t?i():e=void 0,a}}e=void 0,r&&r.enter()};if(Bu)var i=function(){Fu.nextTick(r)};else if(!Lu||ee.navigator&&ee.navigator.standalone)if(Du&&Du.resolve){var n=Du.resolve(void 0);i=function(){n.then(r)}}else i=function(){Eu.call(ee,r)};else{var a=!0,o=document.createTextNode("");new Lu(r).observe(o,{characterData:!0}),i=function(){o.data=a=!a}}return function(r){r={fn:r,next:void 0},e&&(e.next=r),t||(t=r,i()),e=r}}(),Wu=ee.TypeError,Yu=ee.process,Zu=Yu&&Yu.versions,Vu=Zu&&Zu.v8||"",Gu=ee.Promise,qu="process"==Si(Yu),Ku=function(){},Qu=Pu=Ou.f,Ju=!!function(){try{var t=Gu.resolve(1),e=(t.constructor={})[ir("species")]=function(t){t(Ku,Ku)};return(qu||"function"==typeof PromiseRejectionEvent)&&t.then(Ku)instanceof e&&0!==Vu.indexOf("6.6")&&-1===Iu.indexOf("Chrome/66")}catch(ll){}}(),$u=function(t){var e;return!(!pe(t)||"function"!=typeof(e=t.then))&&e},tl=function(t,e){if(!t._n){t._n=!0;var r=t._c;Xu((function(){for(var i=t._v,n=1==t._s,a=0;r.length>a;){var o=void 0,s=void 0,u=void 0,l=r[a++],h=n?l.ok:l.fail,f=l.resolve,c=l.reject,d=l.domain;try{h?(n||(2==t._h&&rl(t),t._h=1),!0===h?u=i:(d&&d.enter(),u=h(i),d&&(d.exit(),o=!0)),u===l.promise?c(Wu("Promise-chain cycle")):(s=$u(u))?s.call(u,f,c):f(u)):c(i)}catch(v){d&&!o&&d.exit(),c(v)}}t._c=[],t._n=!1,e&&!t._h&&el(t)}))}},el=function(t){Eu.call(ee,(function(){var e,r,i=t._v,n=1!==t._h&&0===(t._a||t._c).length;if(n){var a=ku((function(){qu?Yu.emit("unhandledRejection",i,t):(e=ee.onunhandledrejection)?e({promise:t,reason:i}):(r=ee.console)&&r.error&&r.error("Unhandled promise rejection",i)}));t._h=qu||1!==t._h&&0===(t._a||t._c).length?2:1}if(t._a=void 0,n&&a.e)throw a.v}))},rl=function(t){Eu.call(ee,(function(){var e;qu?Yu.emit("rejectionHandled",t):(e=ee.onrejectionhandled)&&e({promise:t,reason:t._v})}))},il=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),tl(e,!0))},nl=function(t){var e,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw Wu("Promise can't be resolved itself");(e=$u(t))?Xu((function(){var i={_w:r,_d:!1};try{e.call(t,ve(nl,i,1),ve(il,i,1))}catch(fl){il.call(i,fl)}})):(r._v=t,r._s=1,tl(r,!1))}catch(hl){il.call({_w:r,_d:!1},hl)}}};if(!Ju){Gu=function(t){cu(this,Gu,"Promise","_h"),de(t),al.call(this);try{t(ve(nl,this,1),ve(il,this,1))}catch(e){il.call(this,e)}};var al=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1};al.prototype=Nu(Gu.prototype,{then:function(t,e){var r=Qu(pu(this,Gu));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=qu?Yu.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&tl(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}});var ol=function(){var t=new al;this.promise=t,this.resolve=ve(nl,t,1),this.reject=ve(il,t,1)};Ou.f=Qu=function(t){return t===Gu||t===sl?new ol(t):Pu(t)}}Se(Se.G+Se.W+Se.F*!Ju,{Promise:Gu}),or(Gu,"Promise"),ju("Promise");var sl=te.Promise;Se(Se.S+Se.F*!Ju,"Promise",{reject:function(t){var e=Qu(this);return(0,e.reject)(t),e.promise}}),Se(Se.S+1*Se.F,"Promise",{resolve:function(t){return Uu(this===sl?Gu:this,t)}}),Se(Se.S+Se.F*!(Ju&&Xi((function(t){Gu.all(t).catch(Ku)}))),"Promise",{all:function(t){var e=this,r=Qu(e),i=r.resolve,n=r.reject,a=ku((function(){var r=[],a=0,o=1;du(t,!1,(function(t){var s=a++,u=!1;r.push(void 0),o++,e.resolve(t).then((function(t){u||(u=!0,r[s]=t,--o||i(r))}),n)})),--o||i(r)}));return a.e&&n(a.v),r.promise},race:function(t){var e=this,r=Qu(e),i=r.reject,n=ku((function(){du(t,!1,(function(t){e.resolve(t).then(r.resolve,i)}))}));return n.e&&i(n.v),r.promise}}),Se(Se.P+Se.R,"Promise",{finally:function(t){var e=pu(this,te.Promise||ee.Promise),r="function"==typeof t;return this.then(r?function(r){return Uu(e,t()).then((function(){return r}))}:t,r?function(r){return Uu(e,t()).then((function(){throw r}))}:t)}}),Se(Se.S,"Promise",{try:function(t){var e=Ou.f(this);return((t=ku(t)).e?e.reject:e.resolve)(t.v),e.promise}});var ul,ll,hl,fl,cl,dl,vl,pl,gl=te.Promise,ml=i(n((function(t){t.exports={default:gl,__esModule:!0}}))),xl=function(t,e){if(!pe(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t},yl=we.f,bl=wr.fastKey,_l=xe?"_s":"size",Al=function(t,e){var r=bl(e);if("F"!==r)return t._i[r];for(t=t._f;t;t=t.n)if(t.k==e)return t},Tl={getConstructor:function(t,e,r,i){var n=t((function(t,a){cu(t,n,e,"_i"),t._t=e,t._i=rr(null),t._f=void 0,t._l=void 0,t[_l]=0,null!=a&&du(a,r,t[i],t)}));return Nu(n.prototype,{clear:function(){for(var t=xl(this,e),r=t._i,i=t._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete r[i.i];t._f=t._l=void 0,t[_l]=0},delete:function(t){var r=xl(this,e);if(t=Al(r,t)){var i=t.n,n=t.p;delete r._i[t.i],t.r=!0,n&&(n.n=i),i&&(i.p=n),r._f==t&&(r._f=i),r._l==t&&(r._l=n),r[_l]--}return!!t},forEach:function(t){xl(this,e);for(var r,i=ve(t,1<arguments.length?arguments[1]:void 0,3);r=r?r.n:this._f;)for(i(r.v,r.k,this);r&&r.r;)r=r.p},has:function(t){return!!Al(xl(this,e),t)}}),xe&&yl(n.prototype,"size",{get:function(){return xl(this,e)[_l]}}),n},def:function(t,e,r){var i,n=Al(t,e);return n?n.v=r:(t._l=n={i:i=bl(e,!0),k:e,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=n),e&&(e.n=n),t[_l]++,"F"!==i&&(t._i[i]=n)),t},getEntry:Al,setStrong:function(t,e,r){cr(t,e,(function(t,r){this._t=xl(t,e),this._k=r,this._l=void 0}),(function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?vr(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,vr(1))}),r?"entries":"values",!r,!0),ju(e)}},wl=ir("species"),Ml=function(t,e){if(Rr(t)){var r=t.constructor;"function"!=typeof r||r!==Array&&!Rr(r.prototype)||(r=void 0),pe(r)&&null===(r=r[wl])&&(r=void 0)}return new(void 0===r?Array:r)(e)},Cl=we.f,Rl=(ll=1==(ul=0),hl=2==ul,fl=3==ul,cl=4==ul,dl=6==ul,vl=5==ul||dl,pl=Ml,function(t,e,r){var i=Object(Nt(t)),n=Yt(i);e=ve(e,r,3),r=Qt(n.length);var a,o,s=0;for(t=ll?pl(t,r):hl?pl(t,0):void 0;r>s;s++)if((vl||s in n)&&(o=e(a=n[s],s,i),ul))if(ll)t[s]=o;else if(o)switch(ul){case 3:return!0;case 5:return a;case 6:return s;case 2:t.push(a)}else if(cl)return!1;return dl?-1:fl||cl?cl:t});(function(t,e,r,i,n,a){var o=ee[t],s=o,u=n?"set":"add",l=s&&s.prototype,h={};xe&&"function"==typeof s&&(a||l.forEach&&!me((function(){(new s).entries().next()})))?(s=e((function(e,r){cu(e,s,t,"_c"),e._c=new o,null!=r&&du(r,n,e[u],e)})),Rl("add clear delete forEach get has set keys values entries toJSON".split(" "),(function(t){var e="add"==t||"set"==t;t in l&&(!a||"clear"!=t)&&Ce(s.prototype,t,(function(r,i){return cu(this,s,t),e||!a||pe(r)?(r=this._c[t](0===r?0:r,i),e?this:r):"get"==t&&void 0}))})),a||Cl(s.prototype,"size",{get:function(){return this._c.size}})):(s=i.getConstructor(e,t,n,u),Nu(s.prototype,r),wr.NEED=!0),or(s,t),h[t]=s,Se(Se.G+Se.W+Se.F,h),a||i.setStrong(s,t,n)})("Map",(function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}}),{get:function(t){return(t=Tl.getEntry(xl(this,"Map"),t))&&t.v},set:function(t,e){return Tl.def(xl(this,"Map"),0===t?0:t,e)}},Tl,!0),Se(Se.P+Se.R,"Map",{toJSON:function(t){return function(){if(Si(this)!=t)throw TypeError(t+"#toJSON isn't generic");var e=[];return du(this,!1,e.push,e,void 0),e}}("Map")}),function(t){Se(Se.S,t,{of:function(){for(var t=arguments.length,e=Array(t);t--;)e[t]=arguments[t];return new this(e)}})}("Map"),function(t){Se(Se.S,t,{from:function(t,e,r){var i;if(de(this),(i=void 0!==e)&&de(e),null==t)return new this;var n=[];if(i){var a=0,o=ve(e,r,2);du(t,!1,(function(t){n.push(o(t,a++))}))}else du(t,!1,n.push,n);return new this(n)}})}("Map");var Sl,Pl,El=te.Map,Ll=i(n((function(t){t.exports={default:El,__esModule:!0}}))),Fl=(ss(Sl={},1,1),ss(Sl,2,1),ss(Sl,3,1),Sl),Dl=(ss(Pl={},1,1),ss(Pl,2,1),ss(Pl,3,1),Pl),Bl=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).vertCount=0,t.bufferMap={},t.bufferData=[],t.autoUpdate=!0,r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.iconHash=new Ll,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:[1,1,1,.8],speed:1,size:5,pointFade:!0,pointFadeBuffer:1,minLineLength:2,animationType:2,shapeType:2,depthTest:!1,delay:0,unit:"px",padding:0}}},{key:"initialize",value:function(t){this.gl=t,this.texture=null,this.isUseTexture=!1;var e=this.getOptions();this.updateUniformsFromOptions(e),this.program=new us(this.gl,{vertexShader:"precision highp float;attribute vec3 aPos;attribute vec3 aNextPos;attribute vec4 aColor;attribute float aIndex;attribute float aNextIndex;attribute float aLength;attribute float aSpeed;attribute float aDelay;attribute vec3 aUV;uniform float uSize;uniform mat4 u_matrix;uniform float uOriginSpeed;uniform float uElapsedSteps;uniform int uAnimationType;uniform int uPointFade;uniform float uPointFadeBuffer;uniform float uZoomUnits;varying float vAddOpacity;varying vec3 vUV;varying vec4 vColor;void main(){vColor=aColor;if(uAnimationType==1){if(abs(aIndex-mod(uElapsedSteps,aLength))>.1){gl_Position=vec4(-2.,-2.,0,1.0);return;}gl_Position=u_matrix*vec4(aPos.xyz,1.0);vAddOpacity=1.;}else if(uAnimationType==2){float lineLength=aLength-1.;float cIndex=mod(uElapsedSteps,lineLength);float rest=cIndex-aIndex;if(rest<1.&&rest>=0.){if(uPointFade==1){if(cIndex<uPointFadeBuffer){vAddOpacity=cIndex/uPointFadeBuffer;}else if(cIndex>lineLength-uPointFadeBuffer){vAddOpacity=(lineLength-cIndex)/uPointFadeBuffer;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}else if(uAnimationType==3){float speedRatio=aSpeed/uOriginSpeed;float percent=mod(mod(uElapsedSteps*aSpeed,aLength)/aLength-aDelay,1.0);if(percent<=aNextIndex&&percent>=aIndex){if(uPointFade==1){float fadePercent=uPointFadeBuffer*1000./aLength;if(percent<fadePercent){vAddOpacity=percent/fadePercent;}else if(percent>1.-fadePercent){vAddOpacity=(1.-percent)/fadePercent;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}float rest=(percent-aIndex)/(aNextIndex-aIndex);gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}vUV=aUV;gl_PointSize=uSize/uZoomUnits;}",fragmentShader:"precision highp float;uniform int ushapeType;uniform bool uUseTexture;uniform sampler2D uSampler;varying float vAddOpacity;varying vec4 vColor;varying vec3 vUV;void main(){if(ushapeType==2){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(vColor.rgb,vColor.a*vAddOpacity);}else if(ushapeType==3){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(vColor.rgb,vColor.a*smoothstep(1.0,0.0,d*2.)*vAddOpacity);}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vAddOpacity);}if(uUseTexture){float ratio=vUV.z;vec2 uv=vUV.xy;gl_FragColor=texture2D(uSampler,vec2(gl_PointCoord.x*ratio+uv.x,1.0-(uv.y+gl_PointCoord.y*ratio)));}}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"bindAttributeBufferData",value:function(t,e,r,i){var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),r=new Float32Array(r),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),this.bufferMap[e]={buffer:n,data:r,elementSize:i}}},{key:"onChanged",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.gl&&(Array.isArray(e)||(e=[]),this.processCache(t,e,r))}},{key:"processCache",value:function(t,e,r){var i=this;this.cachedData=[];for(var n=t.icon,a=t.speed,o=t.color,s=0;s<e.length;s++){var u=e[s].geometry.coordinates,l=this.getProperty("color",o,e[s]);l=this.normizedColor(l);var h=this.getProperty("icon",n,e[s]),f=this.getProperty("speed",a,e[s]),c=this.getProperty("delay",0,e[s]);u&&(this.cachedData.push({coordinates:u,color:l,icon:h,speed:f,delay:c}),this.iconHash.get(h)||this.iconHash.set(h,h))}e=Zi(this.iconHash.entries()).filter((function(t){return"string"==typeof t[1]})).map((function(t){var e=zi(t,2)[0];return new ml((function(t,r){i.url2canvas(e,(function(r){i.iconHash.set(e,r),t()}))}))})),ml.all(e).then((function(e){i.buildSprite(t),!1!==r.autoRender&&i.webglLayer&&i.webglLayer.render()}))}},{key:"buildSprite",value:function(t){var e=t.padding,r=this.canvas,i=this.ctx,n=0,a=[],o=new Ll;if(t.icon){n=!0;var s=!1,u=void 0;try{for(var l,h=ki(this.iconHash);!(n=(l=h.next()).done);n=!0){var f=zi(l.value,2),c=f[1];if("string"!=typeof c){var d=c.width,v=d+e;a.push({w:v,h:v,width:d,key:f[0],icon:c})}}}catch(g){s=!0,u=g}finally{try{!n&&h.return&&h.return()}finally{if(s)throw u}}for(h=vt(a),l=0;l<a.length;l++)f=a[l],o.get(f.key)||o.set(f.key,f);for(n=Math.max(p(h.w),p(h.h)),r.width=n||1,r.height=n||1,i.save(),r=0;r<a.length;r++)h=a[r],i.drawImage(h.icon,h.x+e,h.y+e,h.width,h.width);i.restore()}this.loadTexture(),this.buildVertex(t,o,n)}},{key:"buildVertex",value:function(t,e,r){var i=this.gl;this.updateUniformsFromOptions(t);for(var n=[],a=[],o=[],s=[],u=[],l=[],h=[],f=[],c=[],d=t.minLineLength,v=0;v<this.cachedData.length;v++){var p=this.cachedData[v],g=p.coordinates,m=p.icon,x=p.speed,y=p.delay;p=p.color;var b=g.length,_=[];if(!(b<d)){for(t.icon&&(_=(_=e.get(m))?[_.x/r,_.y/r,_.w/r]:[0,0,0]),m=0;m<b;++m){var A=this.normizedPoint(g[m]);n.push(A[0]),n.push(A[1]),n.push(A[2]||0),a.push.apply(a,Vi(p)),c.push.apply(c,Vi(_)),3!==this.animationType&&(o.push(m),u.push(b))}if(1!==this.animationType){for(_=n.length-3*b+3,b=n.length,g=_;g<b;++g)l.push(n[g]);if(n.splice(b-3,3),c.splice(b-3,2),a.splice(b-3,4),2===this.animationType)o.pop(),u.pop();else if(3===this.animationType){for(_-=3,b=n.length-3,g=0,p=[],m=_;m<=b;m+=3)g+=_=Math.sqrt(Math.pow(l[m]-n[m],2)+Math.pow(l[m+1]-n[m+1],2)+Math.pow(l[m+2]-n[m+2],2)),p.push(_);for(o.push(0),h.push(x),y/=g/x,f.push(y),m=b=0,A=p.length-1;m<A;++m)_=(b+=p[m])/g,o.push(_),s.push(_),u.push(g),h.push(x),f.push(y);s.push(1),u.push(g)}}}}this.bindAttributeBufferData(i,"aPos",n,3),this.bindAttributeBufferData(i,"aIndex",o,1),this.bindAttributeBufferData(i,"aLength",u,1),this.bindAttributeBufferData(i,"aColor",a,4),1!==this.animationType&&(this.bindAttributeBufferData(i,"aNextPos",l,3),3===this.animationType&&(this.bindAttributeBufferData(i,"aNextIndex",s,1),this.bindAttributeBufferData(i,"aSpeed",h,1),this.bindAttributeBufferData(i,"aDelay",f,1))),t.icon&&this.bindAttributeBufferData(i,"aUV",c,3),this.vertCount=n.length/3}},{key:"updateUniformsFromOptions",value:function(t){this.startTime=(new Date).getTime(),Fl[t.animationType]||(t.animationType=2),Dl[t.shapeType]||(t.shapeType=2),(isNaN(t.minLineLength)||2>t.minLineLength)&&(t.minLineLength=2),this.animationType=t.animationType}},{key:"renderAttributeArr",value:function(t,e,r){if(void 0!==e.attributes[r]){var i=this.bufferMap[r];i&&(t.bindBuffer(t.ARRAY_BUFFER,i.buffer),t.enableVertexAttribArray(e.attributes[r]),t.vertexAttribPointer(e.attributes[r],i.elementSize,t.FLOAT,!1,i.data.BYTES_PER_ELEMENT*i.elementSize,0))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,!(0>=this.vertCount)){var r=this.getOptions(),i=this.program;e.useProgram(i.program),this.renderAttributeArr(e,i,"aPos"),this.renderAttributeArr(e,i,"aIndex"),this.renderAttributeArr(e,i,"aLength"),this.renderAttributeArr(e,i,"aColor"),1!==this.animationType&&(this.renderAttributeArr(e,i,"aNextPos"),3===this.animationType&&(this.renderAttributeArr(e,i,"aNextIndex"),this.renderAttributeArr(e,i,"aSpeed"),this.renderAttributeArr(e,i,"aDelay"))),r.icon&&this.texture&&(this.renderAttributeArr(e,i,"aUV"),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(i.uniforms.uSampler,0)),e.uniform1i(i.uniforms.uUseTexture,this.isUseTexture);var n=(new Date).getTime()-this.startTime;n<this.options.delay?n=0:(n-=this.options.delay,n=1===this.animationType?Math.round(n/1e3*this.options.speed*20):3===this.animationType?n/1e3*this.options.speed*1e3:n/1e3*this.options.speed);var a=this.options.size;if(Array.isArray(a)){var o=this.map.map.getMaxZoom(),s=this.map.map.getMinZoom();a=a[0]+(this.map.getZoom()-s)/(o-s)*(a[1]-a[0])}e.uniformMatrix4fv(i.uniforms.u_matrix,!1,t),e.uniform1f(i.uniforms.uSize,a),e.uniform1f(i.uniforms.uElapsedSteps,n),e.uniform1f(i.uniforms.uOriginSpeed,this.options.speed),e.uniform1i(i.uniforms.uAnimationType,this.animationType),e.uniform1i(i.uniforms.ushapeType,this.options.shapeType),e.uniform1i(i.uniforms.uPointFade,this.options.pointFade?1:0),e.uniform1f(i.uniforms.uPointFadeBuffer,this.options.pointFadeBuffer),e.uniform1f(i.uniforms.uZoomUnits,"m"===this.options.unit?this.map.getZoomUnits():1),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===r.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],depthTest:!!r.depthTest}),e.drawArrays(e.POINTS,0,this.vertCount)}}},{key:"url2canvas",value:function(t,e){if("object"===(void 0===t?"undefined":gi(t)))e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var t=document.createElement("canvas");t.width=128,t.height=128,t.getContext("2d").drawImage(r,0,0,128,128),e(t)},r.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas&&this.getOptions().icon?j(this.gl,this.canvas,(function(e){t.isUseTexture=!0,t.texture=e})):(this.isUseTexture=!1,this.texture=null)}}]),e}(Ds);Bl.ANIMATION_TYPE_LEAP=1,Bl.ANIMATION_TYPE_SMOOTH=2,Bl.ANIMATION_TYPE_UNIFORM_SPEED=3,Bl.SHAPE_TYPE_SQUARE=1,Bl.SHAPE_TYPE_CIRCLE=2,Bl.SHAPE_TYPE_CIRCLE_GRADIENT=3;var Ol=function(){function t(e,r){Ut(this,t),this.layer=e,this.gl=r,this.initData()}return Ge(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(t,e){this.initData();for(var r=t.color,i=t.height,n=t.gradient,a=t.enablePreciseMap,o=t.repeatMap,s=t.closePath,u=this.gl,l=0;l<e.length;l++){var h=e[l],f=h.color||r;"properties"in h&&"color"in h.properties&&(f=h.properties.color),n||"[object Function]"!==Object.prototype.toString.call(f)||(f=f(h));var c=this.layer.normizedColor(n?n[0]:f);f=this.layer.normizedColor(n?n[1]:f);var d=h.height||i;if("properties"in h&&"height"in h.properties&&(d=h.properties.height),"[object Function]"===Object.prototype.toString.call(d)&&(d=d(h)),"MultiLineString"===h.geometry.type||"Polygon"===h.geometry.type)for(var v=0;v<h.geometry.coordinates.length;v++){var p=h.geometry.coordinates[v];s&&!x(p)&&p.push(p[0]);for(var g=[],m=[],y=0,b=0;b<p.length;b++){var _=this.layer.normizedPoint(p[b]);if(0<b&&(a||o)){var A=this.layer.normizedPoint(p[b-1]);y+=Math.sqrt(Math.pow(_[0]-A[0],2)+Math.pow(_[1]-A[1],2))}g.push(_),m.push(y)}this.processData(this.outWall3d,t,g,m,c,f,d)}else{for(h=h.geometry.coordinates,s&&!x(h)&&h.push(h[0]),v=[],p=[],m=g=0;m<h.length;m++)y=this.layer.normizedPoint(h[m]),0<m&&(a||o)&&(b=this.layer.normizedPoint(h[m-1]),g+=Math.sqrt(Math.pow(y[0]-b[0],2)+Math.pow(y[1]-b[1],2))),v.push(y),p.push(g);this.processData(this.outWall3d,t,v,p,c,f,d)}}for(t=0;t<this.outWall3d.vertex.length;t++){for(e=[],r=this.outWall3d.vertex[t].length,i=0;i<r;i++)e.push.apply(e,Vi(this.outWall3d.vertex[t][i]));r=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,r),u.bufferData(u.ARRAY_BUFFER,new Float32Array(e),u.STATIC_DRAW),this.outWall3d.vertexBuffer[t]=r,u.bindBuffer(u.ARRAY_BUFFER,null),r=u.createBuffer(),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[t]),u.STATIC_DRAW),this.outWall3d.indexBuffer[t]=r,u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,r,i,n,a,o){var s=i[i.length-1],u=t.vertex[t.vertex.length-1],l=t.index[t.index.length-1],h=r.length;for((!l||65536<=l.length+2*h+2)&&(u=[],l=[],t.vertex.push(u),t.index.push(l)),(t=u.length)&&l.push(t-1,t),t=0;t<h;t++){var f=[],c=[],d=r[t];f.push(d[0],d[1],d[2]+o),f.push(n[0],n[1],n[2],n[3]),c.push(d[0],d[1],d[2]),c.push(a[0],a[1],a[2],a[3]),e.texture&&(d=i[t],e.enablePreciseMap||e.repeatMap?(f.push(d,1,s),c.push(d,0,s)):(f.push(t,1,h-1),c.push(t,0,h-1))),d=u.length,u.push(f,c),l.push(d,d+1)}}}]),t}(),kl=function(t){function e(t,r){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t,r))}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,repeatMap:0,height:100,closePath:!1,color:[1,1,1,1]}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new Ol(this,this.gl),this.texture=null,this.isUseTexture=!1,this.vertexLength=10,this.program=new us(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;attribute float aTotalDistance;varying vec2 vTextureCoords;varying float vTotalDistance;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;vTotalDistance=aTotalDistance;}gl_Position=u_matrix*vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform bool uUseTexture;uniform float uDistance;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying float vTotalDistance;varying vec4 vColor;void main(){if(uUseTexture){float uvx=vTextureCoords.x/vTotalDistance;if(uDistance>0.0){uvx=mod(vTextureCoords.x,uDistance)/uDistance;}gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vec2(uvx,vTextureCoords.y));}else{gl_FragColor=vColor;}}"}),this.loadTexture()}},{key:"onChanged",value:function(t,e){var r=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){r.loadTexture((function(){r.dataMgr.onLayerChange(t,e),r.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var i=this.getOptions(),n=this.program;if(e.useProgram(n.program),i.texture){if(!this.texture)return;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(n.uniforms.uSampler,0)}for(this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],depthMask:!!i.texture,depthFunc:i.texture?e.LESS:e.LEQUAL}),i.texture?e.enableVertexAttribArray(n.attributes.aTextureCoords):e.disableVertexAttribArray(n.attributes.aTextureCoords),e.enableVertexAttribArray(n.attributes.aPos),e.enableVertexAttribArray(n.attributes.aColor),e.uniformMatrix4fv(n.uniforms.u_matrix,!1,r),e.uniform1i(n.uniforms.uUseTexture,this.isUseTexture),e.uniform1f(n.uniforms.uDistance,i.repeatMap),r=0;r<t.vertex.length;r++)if(!(0>=t.vertex[r].length)){var a=t.vertex[r],o=new Float32Array(a[0]).BYTES_PER_ELEMENT;a=o*a[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[r]),e.vertexAttribPointer(n.attributes.aPos,3,e.FLOAT,!1,a,0),e.vertexAttribPointer(n.attributes.aColor,4,e.FLOAT,!1,a,3*o),i.texture&&(e.vertexAttribPointer(n.attributes.aTextureCoords,2,e.FLOAT,!1,a,7*o),e.vertexAttribPointer(n.attributes.aTotalDistance,1,e.FLOAT,!1,a,9*o)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[r]),e.drawElements(e.TRIANGLE_STRIP,t.index[r].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}}},{key:"loadTexture",value:function(t){var e=this,r=this.getOptions();r.texture?(this.isUseTexture=!0,j(this.gl,r.texture,(function(r,i){e.image=i,e.texture=r,t&&t(),e.webglLayer.render()}))):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),e}(Ds),zl=function(){function t(e,r){Ut(this,t),this.layer=e,this.gl=r,this.initData()}return Ge(t,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(t,e){this.initData();var r=t.color,i=t.height,n=t.gradient;t=this.gl;for(var a=0;a<e.length;a++){var o=e[a].geometry.coordinates,s=o.length;this.maxLength=s>this.maxLength?s:this.maxLength;for(var u=[],l=0;l<s;l++){var h=this.layer.normizedPoint(o[l]);u.push(h)}s=e[a].color||r,"properties"in e[a]&&"color"in e[a].properties&&(s=e[a].properties.color),n||"[object Function]"!==Object.prototype.toString.call(s)||(s=s(e[a])),o=this.layer.normizedColor(n?n[0]:s),s=this.layer.normizedColor(n?n[1]:s),l=e[a].height||i,"properties"in e[a]&&"height"in e[a].properties&&(l=e[a].properties.height),"[object Function]"===Object.prototype.toString.call(l)&&(l=l(e[a])),this.processData(this.outWall3d,u,o,s,l)}for(e=0;e<this.outWall3d.vertex.length;e++){for(r=[],i=this.outWall3d.vertex[e].length,n=0;n<i;n++)r.push.apply(r,Vi(this.outWall3d.vertex[e][n]));i=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),this.outWall3d.vertexBuffer[e]=i,t.bindBuffer(t.ARRAY_BUFFER,null),i=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[e]),t.STATIC_DRAW),this.outWall3d.indexBuffer[e]=i,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(t,e,r,i,n){var a=t.vertex[t.vertex.length-1],o=t.index[t.index.length-1],s=e.length;for((!o||65536<=o.length+2*s+2)&&(a=[],o=[],t.vertex.push(a),t.index.push(o)),(t=a.length)&&o.push(t-1,t),t=0;t<s;t++){var u=[],l=[],h=e[t];u.push(h[0],h[1]),u.push(h[2]?Number(h[2])+n:n),u.push(h[3]?Number(h[3]):t),u.push(r[0],r[1],r[2],r[3]),l.push(h[0],h[1]),l.push(h[2]?Number(h[2]):0),l.push(h[3]?Number(h[3]):t),l.push(i[0],i[1],i[2],i[3]),h=a.length,a.push(u,l),o.push(h,h+1)}}}]),t}(),Il=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new zl(this,this.gl),this.program=new us(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),void 0===t.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var i=this.getOptions(),n=this.program;for(e.useProgram(n.program),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),e.enableVertexAttribArray(n.attributes.aPos),e.enableVertexAttribArray(n.attributes.aColor),e.uniformMatrix4fv(n.uniforms.u_matrix,!1,r),e.uniform1f(n.uniforms.currentTime,this.time),e.uniform1f(n.uniforms.trailLength,i.trailLength),r=0;r<t.vertex.length;r++)if(!(0>=t.vertex[r].length)){var a=t.vertex[r],o=new Float32Array(a[0]).BYTES_PER_ELEMENT;a=o*a[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[r]),e.vertexAttribPointer(n.attributes.aPos,4,e.FLOAT,!1,a,0),e.vertexAttribPointer(n.attributes.aColor,4,e.FLOAT,!1,a,4*o),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[r]),e.drawElements(e.TRIANGLE_STRIP,t.index[r].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}this.time+=i.step,this.time>this.endTime&&(this.time=this.startTime)}}}]),e}(Ds),Ul=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).simpleLineLayer=new eu(t.getHeatOptions()),t.children=[t.simpleLineLayer],t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(t){this.simpleLineLayer.setData(t)}},{key:"onOptionsChanged",value:function(t){this.simpleLineLayer.setOptions(this.getHeatOptions())}},{key:"getHeatOptions",value:function(){var t=this.getOptions(),e=t.max,r=t.min;void 0===e&&(e=(r=this.getDataRange()).max,r=r.min);var i=new w({max:e,min:r,gradient:t.gradient});return t.color=function(t){var e=~~t.count||1;return"properties"in t&&"count"in t.properties&&(e=~~t.properties.count),[(t=i.getImageData(e))[0]/255,t[1]/255,t[2]/255,t[3]/255]},t}},{key:"getDataRange",value:function(){var t=this.getData(),e=0,r=0;t[0]&&(e=~~t[0].count||1,r=~~t[0].count||1),"properties"in t[0]&&"count"in t[0].properties&&(e=~~t[0].properties.count,r=~~t[0].properties.count);for(var i=t.length,n=0;n<i;n++){var a=~~t[n].count||1;"properties"in t[n]&&"count"in t[n].properties&&(a=~~t[n].properties.count),e=Math.max(a,e),r=Math.min(a,r)}return{max:e/2,min:r}}}]),e}(Qs),Nl=n((function(t,e){!function(e,r){t.exports=r()}(0,(function(){function t(r,i,n,a,o,s){if(!(o-a<=n)){var u=a+o>>1;e(r,i,u,a,o,s%2),t(r,i,n,a,u-1,s+1),t(r,i,n,u+1,o,s+1)}}function e(t,i,n,a,o,s){for(;o>a;){if(600<o-a){var u=o-a+1,l=n-a+1,h=Math.log(u),f=.5*Math.exp(2*h/3);h=.5*Math.sqrt(h*f*(u-f)/u)*(0>l-u/2?-1:1),e(t,i,n,Math.max(a,Math.floor(n-l*f/u+h)),Math.min(o,Math.floor(n+(u-l)*f/u+h)),s)}for(u=i[2*n+s],l=a,f=o,r(t,i,a,n),i[2*o+s]>u&&r(t,i,a,o);l<f;){for(r(t,i,l,f),l++,f--;i[2*l+s]<u;)l++;for(;i[2*f+s]>u;)f--}i[2*a+s]===u?r(t,i,a,f):r(t,i,++f,o),f<=n&&(a=f+1),n<=f&&(o=f-1)}}function r(t,e,r,n){i(t,r,n),i(e,2*r,2*n),i(e,2*r+1,2*n+1)}function i(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function n(t,e){return{x:(t=t.geometry.coordinates)[0]/360+.5,y:s(t[1]),zoom:1/0,index:e,parentId:-1}}function a(t){return{type:"Feature",id:t.id,properties:o(t),geometry:{type:"Point",coordinates:[360*(t.x-.5),360*Math.atan(Math.exp((180-360*t.y)*Math.PI/180))/Math.PI-90]}}}function o(t){var e=t.numPoints,r=1e4<=e?Math.round(e/1e3)+"k":1e3<=e?Math.round(e/100)/10+"k":e;return u(u({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function s(t){return t=Math.sin(t*Math.PI/180),0>(t=.5-.25*Math.log((1+t)/(1-t))/Math.PI)?0:1<t?1:t}function u(t,e){for(var r in e)t[r]=e[r];return t}function l(t){return t.x}function h(t){return t.y}var f=function(t){return t[0]},c=function(t){return t[1]},d=function(e,r,i,n,a){void 0===r&&(r=f),void 0===i&&(i=c),void 0===n&&(n=64),void 0===a&&(a=Float64Array),this.nodeSize=n,this.points=e;var o=this.ids=new(65536>e.length?Uint16Array:Uint32Array)(e.length);a=this.coords=new a(2*e.length);for(var s=0;s<e.length;s++)o[s]=s,a[2*s]=r(e[s]),a[2*s+1]=i(e[s]);t(o,a,n,0,o.length-1,0)};d.prototype.range=function(t,e,r,i){for(var n,a,o=this.ids,s=this.coords,u=this.nodeSize,l=[0,o.length-1,0],h=[];l.length;){var f=l.pop(),c=l.pop(),d=l.pop();if(c-d<=u)for(f=d;f<=c;f++)n=s[2*f],a=s[2*f+1],n>=t&&n<=r&&a>=e&&a<=i&&h.push(o[f]);else{var v=Math.floor((d+c)/2);n=s[2*v],a=s[2*v+1],n>=t&&n<=r&&a>=e&&a<=i&&h.push(o[v]);var p=(f+1)%2;(0===f?t<=n:e<=a)&&(l.push(d),l.push(v-1),l.push(p)),(0===f?r>=n:i>=a)&&(l.push(v+1),l.push(c),l.push(p))}}return h},d.prototype.within=function(t,e,r){for(var i=this.ids,n=this.coords,a=this.nodeSize,o=[0,i.length-1,0],s=[],u=r*r;o.length;){var l=o.pop(),h=o.pop(),f=o.pop();if(h-f<=a)for(l=f;l<=h;l++){f=n[2*l]-t;var c=n[2*l+1]-e;f*f+c*c<=u&&s.push(i[l])}else{var d=n[2*(c=Math.floor((f+h)/2))],v=n[2*c+1],p=d-t,g=v-e;p*p+g*g<=u&&s.push(i[c]),p=(l+1)%2,(0===l?t-r<=d:e-r<=v)&&(o.push(f),o.push(c-1),o.push(p)),(0===l?t+r>=d:e+r>=v)&&(o.push(c+1),o.push(h),o.push(p))}}return s};var v={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},p=function(t){this.options=u(wi(v),t),this.trees=Array(this.options.maxZoom+1)};return p.prototype.load=function(t){var e=this.options,r=e.minZoom,i=e.maxZoom;e=e.nodeSize,this.points=t;for(var a=[],o=0;o<t.length;o++)t[o].geometry&&a.push(n(t[o],o));for(this.trees[i+1]=new d(a,l,h,e,Float32Array),t=i;t>=r;t--)a=this._cluster(a,t),this.trees[t]=new d(a,l,h,e,Float32Array);return this},p.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),n=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(360<=t[2]-t[0])r=-180,n=180;else if(r>n)return r=this.getClusters([r,i,180,o],e),i=this.getClusters([-180,i,n,o],e),r.concat(i);t=[];var u=0;for(i=(e=this.trees[this._limitZoom(e)]).range(r/360+.5,s(o),n/360+.5,s(i));u<i.length;u+=1)n=e.points[i[u]],t.push(n.numPoints?a(n):this.points[n.index]);return t},p.prototype.getChildren=function(t){var e=this._getOriginId(t),r=this._getOriginZoom(t),i=this.trees[r];if(!i)throw Error("No cluster with the specified id.");var n=i.points[e];if(!n)throw Error("No cluster with the specified id.");e=[];var o=0;for(r=i.within(n.x,n.y,this.options.radius/(this.options.extent*Math.pow(2,r-1)));o<r.length;o+=1)(n=i.points[r[o]]).parentId===t&&e.push(n.numPoints?a(n):this.points[n.index]);if(0===e.length)throw Error("No cluster with the specified id.");return e},p.prototype.getLeaves=function(t,e,r){var i=[];return this._appendLeaves(i,t,e||10,r||0,0),i},p.prototype.getTile=function(t,e,r){var i=this.trees[this._limitZoom(t)];t=Math.pow(2,t);var n=this.options,a=(r-(n=n.radius/n.extent))/t,o=(r+1+n)/t,s={features:[]};return this._addTileFeatures(i.range((e-n)/t,a,(e+1+n)/t,o),i.points,e,r,t,s),0===e&&this._addTileFeatures(i.range(1-n/t,a,1,o),i.points,t,r,t,s),e===t-1&&this._addTileFeatures(i.range(0,a,n/t,o),i.points,-1,r,t,s),s.features.length?s:null},p.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom&&(e++,1===(t=this.getChildren(t)).length);)t=t[0].properties.cluster_id;return e},p.prototype._appendLeaves=function(t,e,r,i,n){var a=0;for(e=this.getChildren(e);a<e.length;a+=1){var o=e[a],s=o.properties;if(s&&s.cluster?n=n+s.point_count<=i?n+s.point_count:this._appendLeaves(t,s.cluster_id,r,i,n):n<i?n++:t.push(o),t.length===r)break}return n},p.prototype._addTileFeatures=function(t,e,r,i,n,a){for(var s=0;s<t.length;s+=1){var u=e[t[s]],l=u.numPoints,h={type:1,geometry:[[Math.round(this.options.extent*(u.x*n-r)),Math.round(this.options.extent*(u.y*n-i))]],tags:l?o(u):this.points[u.index].properties},f=void 0;l?f=u.id:this.options.generateId?f=u.index:this.points[u.index].id&&(f=this.points[u.index].id),void 0!==f&&(h.id=f),a.features.push(h)}},p.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},p.prototype._cluster=function(t,e){var r=[],i=this.options,n=i.reduce,a=i.minPoints;i=i.radius/(i.extent*Math.pow(2,e));for(var o=0;o<t.length;o++){var s=t[o];if(!(s.zoom<=e)){s.zoom=e;for(var u=this.trees[e+1],l=u.within(s.x,s.y,i),h=s.numPoints||1,f=h,c=0,d=l;c<d.length;c+=1){var v=u.points[d[c]];v.zoom>e&&(f+=v.numPoints||1)}if(f>=a){c=s.x*h,d=s.y*h,h=n&&1<h?this._map(s,!0):null,v=(o<<5)+(e+1)+this.points.length;for(var p=0;p<l.length;p+=1){var g=u.points[l[p]];if(!(g.zoom<=e)){g.zoom=e;var m=g.numPoints||1;c+=g.x*m,d+=g.y*m,g.parentId=v,n&&(h||(h=this._map(s,!0)),n(h,this._map(g)))}}s.parentId=v,r.push({x:c/f,y:d/f,zoom:1/0,id:v,parentId:-1,numPoints:f,properties:h})}else if(r.push(s),1<f)for(s=0,f=l;s<f.length;s+=1)(l=u.points[f[s]]).zoom<=e||(l.zoom=e,r.push(l))}}return r},p.prototype._getOriginId=function(t){return t-this.points.length>>5},p.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},p.prototype._map=function(t,e){if(t.numPoints)return e?u({},t.properties):t.properties;t=this.points[t.index].properties;var r=this.options.map(t);return e&&r===t?u({},r):r},p}))})),Hl=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).shapeLayer=new Gs(t.options),t.textLayer=new Ks(t.options.textOptions),t.children=[t.shapeLayer,t.textLayer],t.max=[],t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{size:50,height:0,maxZoom:19,minZoom:5,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},enableCluster:!1,showText:!0,textOptions:{fontSize:13,color:"white"}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.options.textOptions;t.textOptions&&ze(e,t.textOptions);var r=t.minZoom,i=t.maxZoom,n=t.size;r=i&&i!==this.options.maxZoom||r&&r!==this.options.minZoom||n&&n!==this.options.size,ze(this.options,t,{textOptions:e}),r?this.onChanged(this.options,this.data):this.refreshLayer(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,e){if(e&&e.length){this.zoom=Math.floor(this.map.getZoom());var r=t.maxZoom,i=t.minZoom,n=t.enableCluster;t=t.size,this.zoom>r?this.zoom=r:this.zoom<i&&(this.zoom=i),n&&(this.supercluster=new Nl({maxZoom:r,minZoom:i,radius:t/2}),this.supercluster.load(e)),this.refreshLayer()}}},{key:"refreshLayer",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.data,r=this.map,i=this.zoom;if(t.enableCluster&&this.supercluster&&(e=this.getClusterData(t)),e&&e.length){var n=t.gradient,a=t.showText,o=t.textOptions,s=t.height,u=t.size;u*=Math.pow(2,18-i),e=Ct(e,u,(function(t){var e=zi(t,2),i=e[0];return e=e[1],-180<=i&&180>=i&&-90<=e&&90>=e&&(i=(e=r.lnglatToMercator(i,e))[0],e=e[1]),t[0]=i,t[1]=e,t})),this.max[i]=Math.max(this.max[i]||0,e.max);var l=new w({max:this.max[i],min:0,maxSize:s*Math.pow(2,18-i),minSize:0,gradient:n});if(n=[],a){var h=o&&o.format;h="function"==typeof h?h:null,n=e.map((function(t){return{geometry:{coordinates:[t.center.x,t.center.y,l.getSize(t.count)+o.fontSize/2*Math.pow(2,18-i)]},text:h?h(t.count):t.count}}))}this.textLayer.setData(n),a=e.map((function(t){for(var r=t.center,i=e.r,n=[],a=0;6>a;a++)n.push(Mt({x:r.x,y:r.y},i,a));return{geometry:{type:"Polygon",coordinates:[n]},properties:{height:l.getSize(t.count),color:l.getColor(t.count)}}})),this.shapeLayer.setData(a),t.enablePicked&&t.autoSelect&&this.pick(-1,-1)}}},{key:"getClusterData",value:function(){var t=this.map,e=t.getBounds(),r=e.ne;e=e.sw,this.ne=r,this.sw=e;var i=r,n=i.lng;i=i.lat;var a=[];return-180<=n&&180>=n&&-90<=i&&90>=i?a=[e.lng,e.lat,r.lng,r.lat]:(r=t.mercatorToLnglat(this.ne.lng,this.ne.lat),a=(e=t.mercatorToLnglat(this.sw.lng,this.sw.lat)).concat(r)),this.supercluster.getClusters(a,this.zoom).map((function(t){var e=0;return t.properties&&t.properties.point_count&&(e=t.properties.point_count),{geometry:t.geometry,count:e}}))}},{key:"pick",value:function(t,e){return this.shapeLayer.pick(t,e)}},{key:"shouldUpdate",value:function(){if(!this.data)return!1;var t=this.map,e=Math.floor(t.getZoom()),r=this.options,i=r.maxZoom;return r=r.minZoom,e>i?e=i:e<r&&(e=r),this.zoom!==e?(this.zoom=e,!0):!!this.options.enableCluster&&(e=t.getBounds(),t=e.ne,e=e.sw,!!(t&&e&&this.ne&&this.sw)&&(this.ne.lng!==t.lng||this.ne.lat!==t.lat||this.sw.lng!==e.lng||this.sw.lat!==e.lat||void 0))}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshLayer():Is(e.prototype.__proto__||Xe(e.prototype),"render",this).call(this,t)}}]),e}(Qs),jl=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).name="PointLayer",t.bufferData=[],t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"default",shape:"circle",size:5,unit:"px",borderWidth:0,borderColor:[1,1,1,.9],polygonOffset:[0,0],depthTest:!0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),r=[];e.enablePicked&&r.push("PICK"),e.shape&&"circle"===e.shape&&r.push("SHAPE_CIRCLE"),this.program=new us(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aBorderWidth;attribute vec4 aBorderColor;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;varying vec4 vColor;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float size=aSize*devicePixelRatio;float borderWidth=aBorderWidth*devicePixelRatio;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=uUnitPx ? size : size/zoomUnits;vSize=size;vBorderWidth=borderWidth;vBorderColor=aBorderColor;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:"varying vec4 vColor;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;void main(void){vec4 color=vColor;\n#if defined(SHAPE_CIRCLE)\nfloat d=distance(gl_PointCoord,vec2(0.5,0.5));float ratio=1.0-vBorderWidth/vSize*2.0;if(d>0.5){discard;}if(d>ratio*0.5){color=vBorderColor;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;\n#else\nfloat ratio=vBorderWidth/vSize;if(gl_PointCoord.x<ratio||gl_PointCoord.x>1.0-ratio||gl_PointCoord.y<ratio||gl_PointCoord.y>1.0-ratio){color=vBorderColor;}\n#endif\ngl_FragColor=color;}",defines:r},this),this.buffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{stride:52,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:52,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:52,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28},{stride:52,name:"aBorderWidth",buffer:this.buffer,size:1,type:"FLOAT",offset:32},{stride:52,name:"aBorderColor",buffer:this.buffer,size:4,type:"FLOAT",offset:36}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,e){if(this.gl){for(var r=[],i=t.color,n=t.size,a=t.borderWidth,o=t.borderColor,s=0;s<e.length;s++){var u=this.normizedPoint(e[s].geometry.coordinates),l=this.getProperty("color",i,e[s]);l=this.normizedColor(l);var h=this.getProperty("size",n,e[s]);h=Number(h);var f=this.getProperty("borderWidth",a,e[s]);f=Number(f);var c=this.getProperty("borderColor",o,e[s]);c=this.normizedColor(c),u=this.addMultipleCoords(u);for(var d=0;d<u.length;d++){var v=u[d];r.push(v[0],v[1],Number(v[2]||0)),r.push(l[0],l[1],l[2],l[3]),r.push(h),r.push(f,c[0],c[1],c[2],c[3])}}this.bufferData=r,this.buffer.updateData(new Float32Array(r)),t.enablePicked&&this.parsePickData(e)}}},{key:"parsePickData",value:function(t){var e=this.getOptions(),r=[];if(e.enablePicked)for(var i=0;i<t.length;i++){var n=this.indexToRgb(i);r.push(n[0]/255,n[1]/255,n[2]/255),e.repeat&&(r.push(n[0]/255,n[1]/255,n[2]/255),r.push(n[0]/255,n[1]/255,n[2]/255))}e.enablePicked&&this.pickBuffer.updateData(new Float32Array(r))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix,i=t.isPickRender;if(!(0>=this.bufferData.length)){var n=this.getOptions(),a=this.program;a.use(e),t=this.getCommonUniforms(t),t=ze(t,{uMatrix:r,uUnitPx:"px"===n.unit,zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio}),a.setUniforms(t),this.setGLState({blend:!i,blendFunc:X(e,n.blend),blendEquation:e.FUNC_ADD,polygonOffset:n.polygonOffset,depthTest:n.depthTest}),this.vertexArray.bind(),e.drawArrays(e.POINTS,0,this.bufferData.length/13)}}}]),e}(Ds),Xl=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="GroundRippleLayer",t.bufferDataArr=[],t.indexDataArr=[],t.vertexBuffer=[],t.indexBuffer=[],t.position=[],t.opacity=1,t.currentScale=1,t.autoUpdate=!0,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],size:5,segs:32,scale:2,unit:"m",step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new us(this.gl,{vertexShader:"uniform mat4 u_projectionMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_modelMatrix;uniform float u_opacity;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){vColor=aColor;vColor.a=u_opacity;gl_Position=u_projectionMatrix*u_modelViewMatrix*u_modelMatrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;void main(){if(vColor.a==0.0){discard;}gl_FragColor=vColor;}"})}},{key:"onDestroy",value:function(){this.bufferDataArr=[],this.indexDataArr=[],this.vertexBuffer=[],this.indexBuffer=[]}},{key:"onChanged",value:function(t,e){var r=this.gl;if(r&&(this.currentScale=this.opacity=1,(this.data=e)&&e.length)){var i=t.color,n=t.segs;t=t.size;for(var a=360/n,o=0;o<e.length;o++){var s=[],u=[],l=this.normizedPoint(e[o].geometry.coordinates),h=i;"[object Function]"===Object.prototype.toString.call(h)?h=h(e[o]):(h=e[o].color||i,"properties"in e[o]&&"color"in e[o].properties&&(h=e[o].properties.color)),h=this.normizedColor(h);var f="[object Function]"===Object.prototype.toString.call(t)?t(e[o]):Number(t),c=l[0],d=l[1];s.push(0,0,-.5),s.push(h[0],h[1],h[2],0);for(var v=1,p=0;v<=n;v++,p+=a)s.push(l[0]-c+Math.cos(Math.PI/180*p)*f,l[1]-d+Math.sin(Math.PI/180*p)*f,-.5),s.push(h[0],h[1],h[2],this.opacity),v===n?u.push(0,0+v,1):u.push(0,0+v,0+v+1);h=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,h),r.bufferData(r.ARRAY_BUFFER,new Float32Array(s),r.STATIC_DRAW),this.vertexBuffer[o]=h,this.bufferDataArr[o]=s,r.bindBuffer(r.ARRAY_BUFFER,null),s=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),r.STATIC_DRAW),this.indexBuffer[o]=s,this.indexDataArr[o]=u,r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),this.position[o]=[l[0],l[1]]}this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,r=t.projectionMatrix,i=t.viewMatrix;for(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_projectionMatrix,!1,r),e.uniformMatrix4fv(t.uniforms.u_modelViewMatrix,!1,i),r=this.opacity,void 0!==this.options.opacity&&(r=this.options.opacity),e.uniform1f(t.uniforms.u_opacity,r),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.DST_ALPHA]}),e.enableVertexAttribArray(t.attributes.aPos),e.enableVertexAttribArray(t.attributes.aColor),r=0;r<this.bufferDataArr.length;r++)if(!(0>=this.bufferDataArr[r].length)){i=new Float32Array(this.bufferDataArr[r]).BYTES_PER_ELEMENT,e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer[r]),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,7*i,3*i),e.vertexAttribPointer(t.attributes.aPos,3,e.FLOAT,!1,7*i,0),i=this.position[r];var n=rs.create(),a=[this.currentScale,this.currentScale,this.currentScale];"px"===this.options.unit&&this.map&&(a=this.map.getZoomUnits(),a=[this.currentScale*a,this.currentScale*a,this.currentScale]),rs.identity(n),rs.translate(n,n,[i[0],i[1],0]),rs.scale(n,n,a),e.uniformMatrix4fv(t.uniforms.u_modelMatrix,!1,n),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer[r]),e.drawElements(e.TRIANGLES,this.indexDataArr[r].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}e=(t=this.getOptions()).scale,t=t.step,this.opacity-=t/10,this.currentScale+=e*t,0>this.opacity&&(this.currentScale=this.opacity=1)}}]),e}(Ds),Wl=function(t){function e(t){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).name="RippleLayer",t.bufferData=[],t.date=new Date,t.autoUpdate=!0,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{depthTest:!0,polygonOffset:[0,0],color:[.1,.1,.9,1],blend:"normal",size:20,unit:"px",duration:2}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new us(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform float uTime;uniform float duration;uniform float zoomUnits;varying vec4 vColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float percent=mod(uTime,duration)/duration;vColor.a=1.-percent;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize/zoomUnits*percent;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}",fragmentShader:"varying vec4 vColor;void main(void){vec4 color=vColor;float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,e){if(this.gl){for(var r=[],i=t.color,n=t.size,a=0;a<e.length;a++){var o=e[a].geometry.coordinates,s=i;"[object Function]"===Object.prototype.toString.call(s)?s=s(e[a]):(s=e[a].color||i,"properties"in e[a]&&"color"in e[a].properties&&(s=e[a].properties.color)),s=this.normizedColor(s),o=this.normizedPoint(o);var u=e[a].size||n;"properties"in e[a]&&"size"in e[a].properties&&(u=e[a].properties.size),u="[object Function]"===Object.prototype.toString.call(u)?u(e[a]):Number(u),r.push(o[0],o[1],Number(o[2]||0)),r.push(s[0],s[1],s[2],s[3]),r.push(u*window.devicePixelRatio)}this.bufferData=r,this.buffer.updateData(new Float32Array(r)),t.enablePicked&&this.parsePickData(e)}}},{key:"parsePickData",value:function(t){var e=this.getOptions(),r=[];if(e.enablePicked)for(var i=0;i<t.length;i++){var n=this.indexToRgb(i);r.push(n[0]/255,n[1]/255,n[2]/255)}e.enablePicked&&this.pickBuffer.updateData(new Float32Array(r))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix,i=t.isPickRender;if(!(0>=this.bufferData.length)){var n=this.getOptions(),a=this.program;a.use(e),this.vertexArray.bind(),t=this.getCommonUniforms(t);var o=1;"m"===n.unit&&this.map&&(o=this.map.getZoomUnits()),t=ze(t,{zoomUnits:o,uTime:(new Date-this.date)/1e3,duration:n.duration,uMatrix:r}),a.setUniforms(t),this.setGLState({blend:!i,blendFunc:"lighter"===n.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEquation:e.FUNC_ADD,polygonOffset:n.polygonOffset,depthTest:n.depthTest}),e.drawArrays(e.POINTS,0,this.bufferData.length/8)}}}]),e}(Ds),Yl=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="SparkLayer",t.bufferData=[],t.startTime=Number(t.options.startTime)||0,t.endTime=Number(t.options.endTime),t.time=t.startTime,t.segs=Number(t.options.segs)||10,t.autoUpdate=!0,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10,polygonOffset:[0,0]}}},{key:"setTime",value:function(t){this.time=t}},{key:"initialize",value:function(t){this.gl=t,this.program=new us(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,e){var r=this.gl;if(r){this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.buffer);for(var i=[],n=t.height,a=0;a<e.length;a++)for(var o=e[a].geometry.coordinates,s="[object Function]"===Object.prototype.toString.call(n)?n(e[a]):Number(n),u=0,l=0;l<this.segs;l++){var h=this.normizedPoint(o);i.push(h[0],h[1],u),void 0===o[2]?i.push(l):i.push(Number(o[2])),u+=s/this.segs,i.push(h[0],h[1],u),void 0===o[2]?i.push(l+1):i.push(Number(o[2]))}void 0===t.endTime&&(this.endTime=this.segs),this.bufferData=i,r.bufferData(r.ARRAY_BUFFER,new Float32Array(i),r.STATIC_DRAW),this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,r),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,0,0),r=this.normizedColor(this.options.color),e.uniform3f(t.uniforms.uFragColor,r[0],r[1],r[2]),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength),this.setGLState({blend:!0,blendFunc:[e.SRC_ALPHA,e.ONE],blendEquation:e.FUNC_ADD,polygonOffset:this.options.polygonOffset}),e.drawArrays(e.LINES,0,this.bufferData.length/4),this.time+=Number(this.options.step),this.time>1.5*this.endTime&&(this.time=this.startTime)}}]),e}(Ds),Zl=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="IconLayer",t.index=[],r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.iconHash=new Ll,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{depthWrite:!0,depthTest:!0,blend:"default",flat:!1,unit:"px",scale:1,angle:0,opacity:1,offset:[0,0],padding:[0,0],polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new us(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform float devicePixelRatio;uniform float u_zoom_units;uniform float u_zIndex;uniform float u_scale;uniform bool u_unit_px;uniform bool u_flat;varying vec2 v_texture_coord;/***点A(x,y)，绕原点顺时针旋转角度a新坐标的计算公式*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)+size.x*sin(a_rotation);}else if(corner==2.0){x+=size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)-size.x*sin(a_rotation);}else if(corner==3.0){x+=size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)-size.x*sin(a_rotation);}else{x+=-size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)+size.x*sin(a_rotation);}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;if(u_flat){vec2 offset=a_offset;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;offset*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=u_zIndex;gl_Position=u_matrix*vec4(current.x+offset[0],current.y-offset[1],current.z,1.0);}else{vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio*u_scale;vec2 offset=a_offset*2./MAPV_resolution*devicePixelRatio;if(!u_unit_px){halfSize/=u_zoom_units;offset/=u_zoom_units;}vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-offset;current.z+=u_zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform float u_opacity;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}textureColor.a*=u_opacity;gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:36,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:32},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:{})}},{key:"processCache",value:function(t,e,r){var i=this;this.cachedData=[];for(var n=t.icon,a=t.width,o=t.height,s=t.offset,u=t.angle,l=0;l<e.length;l++){var h=this.normizedPoint(e[l].geometry.coordinates),f=this.getProperty("icon",n,e[l]),c=this.getProperty("width",a,e[l]),d=this.getProperty("height",o,e[l]),v=this.getProperty("offset",s,e[l]),p=this.getProperty("angle",u,e[l]);h&&f&&(this.cachedData.push({point:h,icon:f,width:c,height:d,offset:v,angle:p,index:l}),this.iconHash.get(f)||this.iconHash.set(f,f))}e=Zi(this.iconHash.entries()).filter((function(t){return"string"==typeof t[1]})).map((function(t){var e=zi(t,2)[0];return new ml((function(t,r){i.url2canvas(e,(function(r){i.iconHash.set(e,r),t()}))}))})),ml.all(e).then((function(e){i.buildSprite(t),!1!==r.autoRender&&i.webglLayer&&i.webglLayer.render()}))}},{key:"buildSprite",value:function(t){var e=t.padding,r=this.canvas,i=this.ctx,n=[],a=new Ll,o=!0,s=!1,u=void 0;try{for(var l,h=ki(this.iconHash);!(o=(l=h.next()).done);o=!0){var f=zi(l.value,2),c=f[1];if("string"!=typeof c){var d=c.width,v=c.height;n.push({w:d+e[0],h:v+e[0],width:d,height:v,key:f[0],icon:c})}}}catch(g){s=!0,u=g}finally{try{!o&&h.return&&h.return()}finally{if(s)throw u}}for(s=vt(n),o=0;o<n.length;o++)u=n[o],a.get(u.key)||a.set(u.key,u);for(o=p(s.w),s=p(s.h),r.width=o||1,r.height=s||1,i.save(),r=0;r<n.length;r++)u=n[r],i.drawImage(u.icon,u.x+e[0],u.y+e[1],u.width,u.height);i.restore(),this.loadTexture(),this.buildVertex(t,a,o,s)}},{key:"buildVertex",value:function(t,e,r,i){t=t.enablePicked;for(var n=[],a=[],o=[],s=[],u=0;u<this.cachedData.length;u++){var l=this.cachedData[u],h=l.point,f=l.width,c=l.height,d=l.offset,v=l.angle,p=l.index;if(l=e.get(l.icon)){f=f||l.icon.width,c=c||l.icon.height;var g=zi(h,3);h=g[0];var m=g[1];g=g[2];for(var x=0;4>x;x++)n.push(h,m,g),n.push(x),n.push(f,c),n.push.apply(n,Vi(d)),n.push(v*Math.PI/180);f=l.x/r,c=(l.x+l.w)/r,d=(l.y+l.h)/i,l=l.y/i,a.push(f,d,f,l,c,l,c,d),l=4*u,o.push(l,l+2,l+1,l,l+3,l+2),t&&(p=this.indexToRgb(p),s.push(p[0]/255,p[1]/255,p[2]/255),s.push(p[0]/255,p[1]/255,p[2]/255),s.push(p[0]/255,p[1]/255,p[2]/255),s.push(p[0]/255,p[1]/255,p[2]/255))}}this.index=o,this.vertexBuffer.updateData(new Float32Array(n)),this.uvBuffer.updateData(new Float32Array(a)),this.indexBuffer.updateData(new Uint32Array(o)),t&&this.pickBuffer.updateData(new Float32Array(s))}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var e=t.gl,r=t.matrix,i=this.getOptions(),n=this.program;n.use(e),this.setGLState({blend:!0,blendFunc:X(e,i.blend),polygonOffset:i.polygonOffset,depthTest:i.depthTest,depthMask:i.depthWrite}),n.setUniforms(ze(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:r,u_flat:i.flat,u_unit_px:"px"===i.unit,u_zoom_units:this.map.getZoomUnits(),u_scale:i.scale,u_opacity:i.opacity,u_zIndex:i.zIndex,devicePixelRatio:window.devicePixelRatio})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"url2canvas",value:function(t,e){if("object"===(void 0===t?"undefined":gi(t)))e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var t=r.width,i=r.height,n=document.createElement("canvas");n.width=t,n.height=i,n.getContext("2d").drawImage(r,0,0,t,i),e(n)},r.onerror=function(){var t=document.createElement("canvas");t.width=20,t.height=40;var r=t.getContext("2d");r.fillStyle="red",r.beginPath(),r.lineTo(0,0),r.lineTo(20,0),r.lineTo(10,40),r.closePath(),r.fill(),e(t)},r.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e})):this.texture=null}}]),e}(Ds),Vl=function(t){function e(t){Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).pointLayer=new jl(t.options),t.options.textOptions=ze({depthTest:!1},t.options.textOptions),t.textLayer=new Ks(t.options.textOptions);var r=ze({},t.options,t.options.iconOptions);return t.iconLayer=new Zl(r),t.children=[t.pointLayer,t.textLayer,t.iconLayer],t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{minSize:25,maxSize:40,clusterRadius:200,minPoints:2,extent:400,showText:!0,maxZoom:19,minZoom:4,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},textOptions:{fontSize:12,color:"white"},iconOptions:{}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.options.textOptions;t.textOptions&&ze(e,t.textOptions);var r=t.minZoom,i=t.maxZoom,n=t.clusterRadius;r=i&&i!==this.options.maxZoom||r&&r!==this.options.minZoom||n&&n!==this.options.clusterRadius,ze(this.options,t,{textOptions:e}),r?this.onChanged(this.options,this.data):this.refreshCluster(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,e){var r=this;e&&e.length?(e.forEach((function(t){var e=zi(t.geometry.coordinates,2),i=e[0];e=e[1],-180<=i&&180>=i&&-90<=e&&90>=e||(i=r.map.mercatorToLnglat(i,e),t.geometry.coordinates[0]=i[0],t.geometry.coordinates[1]=i[1])})),this.supercluster=new Nl({maxZoom:t.maxZoom,minZoom:t.minZoom,radius:t.clusterRadius,minPoints:t.minPoints,extent:t.extent}),this.supercluster.load(e),this.supercluster.trees.forEach((function(t){var e=0,r=1/0;t.points.forEach((function(t){e=Math.max(t.numPoints||0,e),r=Math.min(t.numPoints||1/0,r)})),t.max=e,t.min=r})),this.refreshCluster()):(this.supercluster=null,this.pointLayer.setData([]),this.iconLayer.setData([]),this.textLayer.setData([]))}},{key:"refreshCluster",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options;if(this.supercluster){var e=this.getClusterData(t);if(e&&e.length)if("function"==typeof t.beforeRender&&!1===t.beforeRender(e))this.pointLayer.setData([]),this.iconLayer.setData([]),this.textLayer.setData([]);else{var r=[],i=[],n=[];e.forEach((function(t){t.properties.text?(r.push(t),n.push({geometry:t.geometry,properties:{text:t.properties.text}})):t.properties.icon?i.push(t):r.push(t)})),this.pointLayer.setData(r),this.iconLayer.setData(i),this.textLayer.setData(t.showText?n:[]),t.enablePicked&&t.autoSelect&&this.pick(-1,-1)}}}},{key:"getClusterData",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options,e=this.map.getBounds(),r=this.ne=e.getNorthEast();e=this.sw=e.getSouthWest();var i=r,n=i.lng;return i=i.lat,-180<=n&&180>=n&&-90<=i&&90>=i?e=[e.lng,e.lat,r.lng,r.lat]:(r=this.map.mercatorToLnglat(this.ne.lng,this.ne.lat),e=(e=this.map.mercatorToLnglat(this.sw.lng,this.sw.lat)).concat(r)),r=Math.floor(this.map.getZoom()),e=this.supercluster.getClusters(e,r),this.zoom!==r&&0<e.length&&(this.zoom=r,(n=(i=this.supercluster.trees)[r]&&i[r].max||this.max)!==(r=i[r]&&i[r].min||this.min)&&(this.max=n,this.min=r)),this.processData(e,t)}},{key:"processData",value:function(t,e){var r=e.defaultColor,i=e.defaultSize,n=e.gradient,a=e.minSize,o=e.textOptions,s=new w({max:this.max,min:~~this.min||1,minSize:a||8,maxSize:e.maxSize||30,gradient:n});r=r||n[0]||"black",i=i||.5*a||5;var u=o&&o.format;return u="function"==typeof u?u:null,t.map((function(t){var e=i,n=r,a="";return t.properties&&t.properties.point_count&&(a=t.properties.point_count,e=s.getSize(a)||e,n=s.getColor(a),a=u?u(a):a),e=ze({},t.properties,{text:a,size:e,color:n}),ze({},t,{properties:e,children:t.id})}))}},{key:"pick",value:function(t,e){var r=this.pointLayer.pick(t,e);return 0>r.dataIndex&&(r=this.iconLayer.pick(t,e)),(t=r.dataItem)&&"number"==typeof t.children&&(t.children=this.getClusterPoints(t.children)),r}},{key:"getClusterPoints",value:function(t){var e=this;return t?this.supercluster.getChildren(t).map((function(t){return"Feature"===t.type?e.getClusterPoints(t.id):t})).flat():[]}},{key:"shouldUpdate",value:function(){if(!this.data||!this.supercluster)return!1;if(this.zoom!==Math.floor(this.map.getZoom()))return!0;var t=this.map.getBounds(),e=t.getNorthEast();return t=t.getSouthWest(),this.ne.lng!==e.lng||this.ne.lat!==e.lat||this.sw.lng!==t.lng||this.sw.lat!==t.lat||void 0}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshCluster():Is(e.prototype.__proto__||Xe(e.prototype),"render",this).call(this,t)}}]),e}(Qs),Gl=function(t){function e(t,r){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t,r))}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return ze(Is(e.prototype.__proto__||Xe(e.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)",.1:"rgb(50, 250, 56)",.5:"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}})}},{key:"onChanged",value:function(t,r){this.gl&&(r=this.processData(r,t),Is(e.prototype.__proto__||Xe(e.prototype),"onChanged",this).call(this,t,r))}},{key:"generateGrid",value:function(t,e){var r=e.gridSize,i=[],n={};e=t.length;for(var a=this.getPointOffset(),o=0;o<e;o++){var s=this.normizedPoint(t[o].geometry.coordinates),u=s[2];s=~~((s[0]+a[0])/r)+"_"+~~((s[1]+a[1])/r),void 0===n[s]&&(n[s]={count:0,num:0,z:0});var l=~~t[o].count||1;"properties"in t[o]&&"count"in t[o].properties&&(l=~~t[o].properties.count),n[s].count+=l,n[s].num+=1,n[s].z+=u}return Le(n).forEach((function(t){var e=t.split("_");i.push([e[0]*r+r/2,e[1]*r+r/2,n[t].z/n[t].num,n[t].count])})),i}},{key:"processData",value:function(t,e){var r=[];if("normal"===e.style)for(var i=this.getPointOffset(),n=0;n<t.length;n++){var a=this.normizedPoint(t[n].geometry.coordinates),o=a[0]+i[0],s=a[1]+i[1];a=a[2];var u=~~t[n].count||1;"properties"in t[n]&&"count"in t[n].properties&&(u=~~t[n].properties.count),r.push([o,s,a,u])}else r=this.generateGrid(t,e);if(i=t=0,void 0!==e.max&&void 0!==e.min)t=e.max,i=e.min;else{for(r[0]&&(t=r[0][3],i=r[0][3]),n=r.length,o=0;o<n;o++)s=r[o],t=Math.max(s[3],t),i=Math.min(s[3],i);t/=2}for(e=new w({max:~~t,min:i,gradient:e.gradient}),t=[],i=0;i<r.length;i++)(n=r[i])[0]=n[0],n[1]=n[1],o=e.getImageData(n[3]),t.push({geometry:{type:"Point",coordinates:[n[0],n[1],n[2]]},color:[o[0]/255,o[1]/255,o[2]/255,o[3]/255]});return t}}]),e}(jl),ql=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).bufferData=[],t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(t,e){var r=this;if(t=this.gl){this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer);for(var i=[],n=function(t){var n=5*t;for(t=0;t<e.length;t++)e[t].geometry.coordinates.forEach((function(t){for(var e=0;e<t.length-1;e++){var a=r.normizedPoint(t[e]);i.push(a[0]),i.push(a[1]),i.push(Number(n)),a=r.normizedPoint(t[e+1]),i.push(a[0]),i.push(a[1]),i.push(Number(n))}}))},a=0;20>a;a++)n(a);t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),this.bufferData=i,t.bindBuffer(t.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(t){this.gl=t,this.program=new us(t,{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var r=this.program;e.useProgram(r.program);var i=this.normizedColor(this.options.color);e.uniform4f(r.uniforms.uFragColor,i[0],i[1],i[2],i[3]),e.uniformMatrix4fv(r.uniforms.uMatrix,!1,t),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(r.attributes.aPos),e.vertexAttribPointer(r.attributes.aPos,3,e.FLOAT,!1,0,0),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.ONE,e.ONE]}),e.drawArrays(e.LINES,0,this.bufferData.length/3)}}]),e}(Ds),Kl={circle:1,square:2},Ql=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Mi(e,t),Ge(e,[{key:"initialize",value:function(t){this.gl=t,this.program=new us(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"}),this.f32BufferData=new Float32Array,this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(t,e){var r=this.gl;if(r){this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.buffer);for(var i=[],n=t.color||[.1,.1,.9,1],a=t.size||5,o=0;o<e.length;o++){var s=e[o].geometry.coordinates,u=n;"[object Function]"===Object.prototype.toString.call(u)?u=u(e[o]):(u=e[o].color||n,"properties"in e[o]&&"color"in e[o].properties&&(u=e[o].properties.color)),u=this.normizedColor(u);var l=this.normizedPoint(s),h=a;h="[object Function]"===Object.prototype.toString.call(h)?h(e[o]):Number(h);var f=e[o].time||o;"properties"in e[o]&&"time"in e[o].properties&&(f=e[o].properties.time),i.push(l[0],l[1],Number(s[2]||0),f),i.push(u[0],u[1],u[2],u[3]),i.push(h*window.devicePixelRatio)}void 0===t.endTime&&(this.endTime=e.length),this.bufferData=i,this.f32BufferData=new Float32Array(i),r.bufferData(r.ARRAY_BUFFER,this.f32BufferData,r.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;0>=this.bufferData.length||(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,r),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),r=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,9*r,0),e.enableVertexAttribArray(t.attributes.aColor),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,9*r,4*r),e.enableVertexAttribArray(t.attributes.aSize),e.vertexAttribPointer(t.attributes.aSize,1,e.FLOAT,!1,9*r,8*r),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength||3),r=1,this.options.shape&&Kl[this.options.shape]&&(r=Kl[this.options.shape]),e.uniform1i(t.uniforms.uShape,r),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===this.options.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),e.drawArrays(e.POINTS,0,this.bufferData.length/9),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]),e}(Ds),Jl=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1,polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t,this.program=new us(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"},this),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(t){this.time=t}},{key:"onChanged",value:function(t,e){var r=this.gl;if(r){this.buffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.buffer);for(var i=[],n=0,a=this.options.color,o=0;o<e.length;o++){var s=e[o].geometry.coordinates;e[o].color&&(a=e[o].color),"properties"in e[o]&&"color"in e[o].properties&&(a=e[o].properties.color),"[object Function]"===Object.prototype.toString.call(a)&&(a=a(e[o])),a=this.normizedColor(a),s.length>n&&(n=s.length);for(var u=0;u<s.length-1;u++){var l=this.normizedPoint(s[u]);i.push(l[0]),i.push(l[1]),i.push(l[2]),void 0===s[u][3]?i.push(u):i.push(Number(s[u][3])),i.push(a[0]),i.push(a[1]),i.push(a[2]),i.push(a[3]),l=this.normizedPoint(s[u+1]),i.push(l[0]),i.push(l[1]),i.push(l[2]),void 0===s[u+1][3]?i.push(u+1):i.push(Number(s[u+1][3])),i.push(a[0]),i.push(a[1]),i.push(a[2]),i.push(a[3])}}void 0===t.endTime&&(this.endTime=n),this.bufferData=i,this.f32BufferData=new Float32Array(i),r.bufferData(r.ARRAY_BUFFER,this.f32BufferData,r.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,r=t.matrix;t=this.getOptions();var i=this.program;i.use(e),e.uniformMatrix4fv(i.uniforms.u_matrix,!1,r),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),r=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(i.attributes.aPos),e.vertexAttribPointer(i.attributes.aPos,4,e.FLOAT,!1,8*r,0),e.enableVertexAttribArray(i.attributes.aColor),e.vertexAttribPointer(i.attributes.aColor,4,e.FLOAT,!1,8*r,4*r),r=this.normizedColor(t.color),e.uniform3f(i.uniforms.uFragColor,r[0],r[1],r[2]),e.uniform1f(i.uniforms.currentTime,this.time),e.uniform1f(i.uniforms.trailLength,t.trailLength),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===t.blend?[e.ONE,e.ONE]:[e.SRC_ALPHA,e.ONE],polygonOffset:t.polygonOffset,depthMask:!1}),e.drawArrays(e.LINES,0,this.bufferData.length/8),this.time+=t.step,this.time>this.endTime&&(this.time=this.startTime)}}]),e}(Ds),$l=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="IconCollidesLayer",t.index=[],r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.iconHash=new Ll,t.boxHash=new Ll,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{flat:!1,unit:"px",scale:1,angle:0,offset:[0,0],padding:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new us(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform float devicePixelRatio;uniform float u_zoom_units;uniform float u_zIndex;uniform float u_scale;uniform bool u_unit_px;uniform bool u_flat;varying vec2 v_texture_coord;/***点A(x,y)，绕原点顺时针旋转角度a新坐标的计算公式*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)+size.x*sin(a_rotation);}else if(corner==2.0){x+=size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)-size.x*sin(a_rotation);}else if(corner==3.0){x+=size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)-size.x*sin(a_rotation);}else{x+=-size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)+size.x*sin(a_rotation);}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;if(u_flat){vec2 offset=a_offset;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;offset*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=u_zIndex;gl_Position=u_matrix*vec4(current.x+offset[0],current.y-offset[1],current.z,1.0);}else{vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio*u_scale;vec2 offset=a_offset*2./MAPV_resolution*devicePixelRatio;if(!u_unit_px){halfSize/=u_zoom_units;offset/=u_zoom_units;}vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-offset;current.z+=u_zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:36,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:32},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.gl&&(this.cachedData=[],this.boxHash.clear(),this.processCache(t,e,r))}},{key:"processCache",value:function(t,e,r){for(var i=this,n=t.icon,a=t.width,o=t.height,s=t.offset,u=t.angle,l=0;l<e.length;l++){var h=this.normizedPoint(e[l].geometry.coordinates),f=this.getProperty("icon",n,e[l]),c=this.getProperty("width",a,e[l]),d=this.getProperty("height",o,e[l]),v=this.getProperty("offset",s,e[l]),p=this.getProperty("angle",u,e[l]);h&&f&&(this.cachedData.push({point:h,icon:f,width:c,height:d,offset:v,angle:p,dataIndex:l}),this.iconHash.get(f)||this.iconHash.set(f,f))}e=Zi(this.iconHash.entries()).filter((function(t){return"string"==typeof t[1]})).map((function(t){var e=zi(t,2)[0];return new ml((function(t,r){i.url2canvas(e,(function(r){i.iconHash.set(e,r),t()}))}))})),ml.all(e).then((function(e){i.buildSprite(t),!1!==r.autoRender&&i.webglLayer&&i.webglLayer.render()}))}},{key:"buildSprite",value:function(t){t=t.padding;var e=this.canvas,r=this.ctx,i=[],n=!0,a=!1,o=void 0;try{for(var s,u=ki(this.iconHash);!(n=(s=u.next()).done);n=!0){var l=zi(s.value,2),h=l[1];if("string"!=typeof h){var f=h.width,c=h.height;i.push({w:f+t[0],h:c+t[0],width:f,height:c,key:l[0],icon:h})}}}catch(d){a=!0,o=d}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}for(u=vt(i),s=0;s<i.length;s++)l=i[s],this.boxHash.get(l.key)||this.boxHash.set(l.key,l);for(s=p(u.w)||1,u=p(u.h)||1,e.width=s,e.height=u,r.save(),e=0;e<i.length;e++)u=i[e],r.drawImage(u.icon,u.x+t[0],u.y+t[1],u.width,u.height);r.restore(),this.loadTexture()}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.texture){var e=t.gl,r=t.matrix,i=this.getOptions(),n=this.program;n.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),n.setUniforms(ze(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:r,u_flat:i.flat,u_unit_px:"px"===i.unit,u_zoom_units:this.map.getZoomUnits(),u_scale:i.scale,u_zIndex:i.zIndex,devicePixelRatio:window.devicePixelRatio})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateIcon(t)}},{key:"updateIcon",value:function(t){if(this.iconHash.size&&this.boxHash.size){var e=this.getOptions(),r=t.gl;t=t.matrix,e=e.enablePicked;var i=[],n=[],a=[],o=[],s=this.canvas.width,u=this.canvas.height,l=r.canvas.width/window.devicePixelRatio;r=r.canvas.height/window.devicePixelRatio;for(var h=new qs,f=0,c=0;c<this.cachedData.length;c++){var d=this.cachedData[c],v=d.point,p=d.width,g=d.height,m=d.offset,x=d.angle,y=d.dataIndex;if(d=this.boxHash.get(d.icon)){p=p||d.icon.width,g=g||d.icon.height;var b=zi(v,3);v=b[0];var _=b[1];b=b[2];var A=Qo.clone([v,_,b,1]);Qo.transformMat4(A,A,t),Qo.scale(A,A,1/A[3]);var T=(A[0]+1)/2*l-p/2,w=T+p,M=(A=(1-A[1])/2*r-g/2)+g;if(!(0>w||0>M||T>l||A>r||(T={minX:T,maxX:w,minY:A,maxY:M},h.collides(T)))){for(h.insert(T),T=0;4>T;T++)i.push(v,_,b),i.push(T),i.push(p,g),i.push.apply(i,Vi(m)),i.push(x*Math.PI/180);p=d.x/s,g=(d.x+d.w)/s,m=(d.y+d.h)/u,d=d.y/u,n.push(p,m,p,d,g,d,g,m),d=4*f,a.push(d,d+2,d+1,d,d+3,d+2),e&&(y=this.indexToRgb(y),o.push(y[0]/255,y[1]/255,y[2]/255),o.push(y[0]/255,y[1]/255,y[2]/255),o.push(y[0]/255,y[1]/255,y[2]/255),o.push(y[0]/255,y[1]/255,y[2]/255)),f+=1}}}this.index=a,this.vertexBuffer.updateData(new Float32Array(i)),this.uvBuffer.updateData(new Float32Array(n)),this.indexBuffer.updateData(new Uint32Array(a)),e&&this.pickBuffer.updateData(new Float32Array(o))}}},{key:"url2canvas",value:function(t,e){if("object"===(void 0===t?"undefined":gi(t)))e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var t=r.width,i=r.height,n=document.createElement("canvas");n.width=t,n.height=i,n.getContext("2d").drawImage(r,0,0,t,i),e(n)},r.onerror=function(){var t=document.createElement("canvas");t.width=20,t.height=40;var r=t.getContext("2d");r.fillStyle="red",r.beginPath(),r.lineTo(0,0),r.lineTo(20,0),r.lineTo(10,40),r.closePath(),r.fill(),e(t)},r.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e})):this.texture=null}}]),e}(Ds),th=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="LineFlowLayer",t.initData(),t.date=new Date,t.autoUpdate=!0,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:2,antialias:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0]}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new us(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float thickness;uniform vec4 uSelectedColor;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aCounter;attribute vec2 uv;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}void main(){vColor=aColor;vCounter=aCounter;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\nvec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float len=thickness;float orientation=direction;vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){len=thickness/dot(miter,perp);}}vec2 normal=vec2(-dir.y,dir.x);vNormal=normal*orientation;normal*=len/2.0;vec2 pos=currentScreen+normal*orientation;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}",fragmentShader:"precision highp float;uniform bool uAntialias;uniform bool uAnimate;uniform float uTime;uniform float duration;uniform float interval;uniform float trailLength;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.98,1.0,length(vNormal));color.a*=blur;}if(uAnimate){float alpha=1.0-fract(mod(1.0-vCounter,interval)*(1.0/interval)+uTime/duration);alpha=(alpha+trailLength-1.0)/trailLength;color.a*=alpha;}gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.prevBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:4,name:"aCounter",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var r=this;if(this.gl){this.initData();for(var i=1,n=[],a=0;a<e.length;a++){var o=[],s=e[a].geometry.coordinates;s&&0<s.length&&(o="Polygon"===e[a].geometry.type?s[0].map((function(t){return r.normizedPoint(t)})):s.map((function(t){return r.normizedPoint(t)}))),s=(o=yt(o)).total,n[a]=o.arr,i=Math.max(s,i)}for(a=[],o=t.color,s=0;s<e.length;s++){var u=[],l=e[s].geometry.coordinates;l&&0<l.length&&(u="Polygon"===e[s].geometry.type?l[0].map((function(t){return r.normizedPoint(t)})):l.map((function(t){return r.normizedPoint(t)}))),l=o,"[object Function]"===Object.prototype.toString.call(l)?l=l(e[s]):(l=e[s].color||o,"properties"in e[s]&&"color"in e[s].properties&&(l=e[s].properties.color)),l=this.normizedColor(l);for(var h=this.addMultipleCoords(u),f=0;f<h.length;f++)this.processData(this.dataMgr,h[f],n[s],i,l);if(t.enablePicked)for(l=this.indexToRgb(s),h=0;h<u.length;h++)a.push(l[0]/255,l[1]/255,l[2]/255),a.push(l[0]/255,l[1]/255,l[2]/255),t.repeat&&(a.push(l[0]/255,l[1]/255,l[2]/255),a.push(l[0]/255,l[1]/255,l[2]/255),a.push(l[0]/255,l[1]/255,l[2]/255),a.push(l[0]/255,l[1]/255,l[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(a))}}},{key:"processData",value:function(t,e,r,i,n){var a,o,s,u,l,h,f,c=e.length,d=t.position.length/6;r=pt(r.map((function(t){return t/i})));var v=pt(e.map((function(t){return-1})),!0),p=pt(e),g=pt(e.map(mt(-1))),m=pt(e.map(mt(1)));e=pt(e.map((function(t){return n}))),c=gt(c,d),(a=t.counter).push.apply(a,Vi(r)),(o=t.position).push.apply(o,Vi(xt(p))),(s=t.prev).push.apply(s,Vi(xt(g))),(u=t.next).push.apply(u,Vi(xt(m))),(l=t.direction).push.apply(l,Vi(v)),(h=t.color).push.apply(h,Vi(xt(e))),(f=t.index).push.apply(f,Vi(c))}},{key:"render",value:function(t){var e=t.gl,r=t.matrix,i=this.dataMgr;if(i&&!(0>=i.index.length)){var n=this.getOptions(),a=this.program;if(a.use(e),this.map){var o=this.map.getZoom();o=!!(o>=n.minZoom&&o<=n.maxZoom&&this.autoUpdate)}else o=!0;a.setUniforms(ze(this.getCommonUniforms(t),{u_matrix:r,thickness:n.width,uAntialias:n.antialias,uTime:(new Date-this.date)/1e3,uAnimate:o,duration:n.duration,interval:n.interval,trailLength:n.trailLength})),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:"lighter"===n.blend?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,i.index.length,e.UNSIGNED_INT,0)}}}]),e}(Ds),eh=function(t){function e(t,r){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t,r))}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new us(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform sampler2D uTerrain;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;\n#if defined(TERRAIN)\nvec4 terrainColor=texture2D(uTerrain,vec2(v_texture_coord.s,v_texture_coord.t));vec3 rgb=terrainColor.rgb*256.0;pos.z=-10000.0+((rgb.r*256.0*256.0+rgb.g*256.0+rgb.b)*0.1);pos.z=pos.z-60.0;\n#endif\nvec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D uTile;uniform bool uUseFilter;uniform vec4 uFilterColor;void main(){vec4 textureColor=texture2D(uTile,vec2(v_texture_coord.s,v_texture_coord.t));if(uUseFilter){textureColor=textureColor*uFilterColor;}gl_FragColor=textureColor;}",defines:e.terrain?["TERRAIN"]:""},this),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new ds({gl:t,program:this.program,attributes:[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(t,e){var r=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout((function(){r.loadTexture((function(){r.parseData(e),r.dataTime=new Date,r.webglLayer.render()}))}),0))}},{key:"render",value:function(t){var e=t.gl,r=t.projectionMatrix;t=t.viewMatrix;var i=this.getOptions(),n=this.program,a=n.uniforms;n.use(e),this.texture&&(e.activeTexture(e.TEXTURE0),e.uniform1i(a.uTile,0),e.bindTexture(e.TEXTURE_2D,this.texture),e.activeTexture(e.TEXTURE1),e.uniform1i(a.uTerrain,1),e.bindTexture(e.TEXTURE_2D,this.terrainSampler),this.setGLState({cullFace:!1}),n.setUniforms({u_proj_matrix:r,uUseFilter:!!i.filterColor,uFilterColor:this.normizedColor(i.filterColor||"rgba(0, 0, 100, 1.0)"),u_mv_matrix:t}),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)))}},{key:"loadTexture",value:function(t){var e=this,r=this.getOptions();r.tile?r.terrain?j(this.gl,r.terrain,(function(i,n){e.terrainSampler=i,j(e.gl,r.tile,(function(r,i){e.texture=r,t&&t(),e.webglLayer.render()}))}),{TEXTURE_WRAP_S:"MIRRORED_REPEAT",TEXTURE_WRAP_T:"MIRRORED_REPEAT"}):j(this.gl,r.tile,(function(r,i){e.texture=r,t&&t(),e.webglLayer.render()})):(this.texture=null,t&&t())}},{key:"parseData",value:function(t){var e=this,r=[],i=[];if(t&&t[0]){var n=t[0].geometry.coordinates[0];n=n.map((function(t){return e.normizedPoint(t)})),t=n[0][0];var a=n[0][1],o=n[0][2],s=(n[2][0]-t)/16;n=(n[2][1]-a)/16;for(var u=0;16>=u;u++)for(var l=0;16>=l;l++)if(r.push(t+s*l,a+n*u,o),r.push(l/16,u/16),16>l&&16>u){var h=17*u+l,f=17*(u+1)+l;i.push(h,f+1,h+1),i.push(h,f,f+1)}}this.index=i,this.vertexBuffer.updateData(new Float32Array(r)),this.indexBuffer.updateData(new Uint32Array(i))}}]),e}(Ds),rh=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="BoardLayer",t.index=[],r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.iconHash=new Ll,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{unit:"px",scale:1,angle:0,offsetZ:0,padding:[0,0],polygonOffset:[0,0],enableColorMix:!1,mixColor:"#fff",mixAmount:.5}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var r=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"a_offsetZ",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}];r=r.concat(this.getCommonAttributes());var i=[];e.enablePicked&&i.push("PICK"),this.options.enableColorMix&&(this.colorBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),r.push({stride:16,name:"a_color",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0}),i.push("USE_COLOR_MIX")),this.program=new us(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute float a_offsetZ;attribute vec2 a_size;attribute vec2 a_texture_coord;\n#if defined(USE_COLOR_MIX)\nattribute vec4 a_color;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_size;uniform float u_zoom_units;uniform float u_scale;uniform bool u_unit_px;varying vec2 v_texture_coord;varying vec4 v_color;/***三维空间内，绕Z轴旋转的矩阵，右手坐标系下*[x'][cos0-sin0  0  0]*[y']=[sin0 cos0   0  0]*[z'][0     0     1  0]*[1][0     0     0  1]*/mat3 rotateZ(float angle){float cos0=cos(angle);float sin0=sin(angle);return mat3(cos0,sin0,0.,-sin0,cos0,0.,0.,0.,1.);}vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;float z=coord.z;mat3 mat=rotateZ(a_rotation);vec3 rotated=vec3(size[0],0.0,size[1]);if(corner==1.0){rotated=mat*vec3(-size[0],0.0,size[1]);}else if(corner==2.0){rotated=mat*vec3(size[0],0.0,size[1]);}else if(corner==3.0){rotated=mat*vec3(size[0],0.0,-size[1]);}else{rotated=mat*vec3(-size[0],0.0,-size[1]);}x+=rotated.x;y+=rotated.y;z+=rotated.z;return vec3(x,y,z);}void main(){\n#if defined(USE_COLOR_MIX)\nv_color=a_color;\n#endif\nv_texture_coord=a_texture_coord;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=a_offsetZ;gl_Position=u_matrix*vec4(current,1.0);}",fragmentShader:"precision highp float;varying vec2 v_texture_coord;varying vec4 v_color;uniform sampler2D u_icon;uniform vec4 uSelectedColor;\n#if defined(USE_COLOR_MIX)\nuniform float u_mix_amount;\n#endif\nvoid main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}gl_FragColor=textureColor;\n#if defined(USE_COLOR_MIX)\ngl_FragColor=mix(gl_FragColor,v_color,u_mix_amount);\n#endif\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:i},this),this.vertexArray=new ds({gl:t,program:this.program,attributes:r})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"forceUpdate",value:function(){this.gl&&this.processCache(this.options,this.data)}},{key:"processCache",value:function(t,e){var r=this;this.cachedData=[];for(var i=t.icon,n=t.width,a=t.height,o=t.offsetZ,s=t.angle,u=t.mixColor,l=0;l<e.length;l++){var h=this.normizedPoint(e[l].geometry.coordinates),f=this.getProperty("icon",i,e[l]),c=this.getProperty("width",n,e[l]),d=this.getProperty("height",a,e[l]),v=this.getProperty("angle",s,e[l]),p=this.getProperty("offsetZ",o,e[l]),g=this.normizedColor(this.getProperty("mixColor",u,e[l]));h&&f&&(this.cachedData.push({point:h,icon:f,width:c,height:d,offsetZ:p,angle:v,mixColor:g,index:l}),this.iconHash.get(f)||this.iconHash.set(f,f))}e=Zi(this.iconHash.entries()).filter((function(t){return"string"==typeof t[1]})).map((function(t){var e=zi(t,2)[0];return new ml((function(t,i){r.url2canvas(e,(function(i){r.iconHash.set(e,i),t()}))}))})),ml.all(e).then((function(e){r.buildSprite(t),r.webglLayer.render()}))}},{key:"buildSprite",value:function(t){var e=t.padding,r=this.canvas,i=this.ctx,n=[],a=new Ll,o=!0,s=!1,u=void 0;try{for(var l,h=ki(this.iconHash);!(o=(l=h.next()).done);o=!0){var f=zi(l.value,2),c=f[1];if("string"!=typeof c){var d=c.width,v=c.height;n.push({w:d+e[0],h:v+e[0],width:d,height:v,key:f[0],icon:c})}}}catch(g){s=!0,u=g}finally{try{!o&&h.return&&h.return()}finally{if(s)throw u}}for(s=vt(n),o=0;o<n.length;o++)u=n[o],a.get(u.key)||a.set(u.key,u);for(o=p(s.w),s=p(s.h),r.width=o||1,r.height=s||1,i.save(),r=0;r<n.length;r++)u=n[r],i.drawImage(u.icon,u.x+e[0],u.y+e[1],u.width,u.height);i.restore(),this.loadTexture(),this.buildVertex(t,a,o,s)}},{key:"buildVertex",value:function(t,e,r,i){var n=t.enablePicked;t=t.enableColorMix;for(var a=[],o=[],s=[],u=[],l=[],h=0;h<this.cachedData.length;h++){var f=this.cachedData[h],c=f.point,d=f.width,v=f.height,p=f.offsetZ,g=f.angle,m=f.mixColor,x=f.index;if(f=e.get(f.icon)){d=d||f.icon.width,v=v||f.icon.height;var y=zi(c,3);c=y[0];var b=y[1];y=y[2];for(var _=0;4>_;_++)a.push(c,b,y),a.push(_),a.push(d,v),a.push(p),a.push(g*Math.PI/180);d=f.x/r,v=(f.x+f.w)/r,p=(f.y+f.h)/i,f=f.y/i,o.push(d,p,d,f,v,f,v,p),f=4*h,s.push(f,f+2,f+1,f,f+3,f+2),n&&(x=this.indexToRgb(x),u.push(x[0]/255,x[1]/255,x[2]/255),u.push(x[0]/255,x[1]/255,x[2]/255),u.push(x[0]/255,x[1]/255,x[2]/255),u.push(x[0]/255,x[1]/255,x[2]/255)),t&&(l.push.apply(l,Vi(m)),l.push.apply(l,Vi(m)),l.push.apply(l,Vi(m)),l.push.apply(l,Vi(m)))}}this.index=s,this.vertexBuffer.updateData(new Float32Array(a)),this.uvBuffer.updateData(new Float32Array(o)),this.indexBuffer.updateData(new Uint32Array(s)),n&&this.pickBuffer.updateData(new Float32Array(u)),t&&this.colorBuffer.updateData(new Float32Array(l))}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var e=t.gl,r=t.matrix,i=this.getOptions(),n=this.program;n.use(e),this.setGLState({blend:!0,blendFunc:X(e,i.blend),polygonOffset:i.polygonOffset}),t=ze(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:r,u_unit_px:"px"===i.unit,u_zoom_units:this.map.getZoomUnits(),u_scale:i.scale}),i.enableColorMix&&(t=ze(t,{u_mix_amount:i.mixAmount})),n.setUniforms(t),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"url2canvas",value:function(t,e){if("object"===(void 0===t?"undefined":gi(t)))e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var t=r.width,i=r.height,n=document.createElement("canvas");n.width=t,n.height=i,n.getContext("2d").drawImage(r,0,0,t,i),e(n)},r.onerror=function(){var t=document.createElement("canvas");t.width=20,t.height=40;var r=t.getContext("2d");r.fillStyle="red",r.beginPath(),r.lineTo(0,0),r.lineTo(20,0),r.lineTo(10,40),r.closePath(),r.fill(),e(t)},r.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e})):this.texture=null}}]),e}(Ds),ih=function(t){function e(t){Ut(this,e);var r=mi(this,(e.__proto__||Xe(e)).call(this,t));return t=r.getOptions(),r.shapeLayer=new Gs({enablePicked:t.enablePicked}),r.lineLayer=new uu,r.children=[r.shapeLayer,r.lineLayer],r}return Mi(e,t),Ge(e,[{key:"pick",value:function(t,e){return this.shapeLayer.pick(t,e)}},{key:"onOptionsChanged",value:function(t){this.shapeLayer.setOptions({onClick:function(e){t.onClick&&t.onClick(e)},selectedIndex:t.selectedIndex,selectedColor:t.selectedColor,height:0,polygonOffset:[2,2],autoSelect:t.autoSelect,color:t.fillColor,opacity:t.fillOpacity,topColor:t.fillColor,useLight:!1}),this.lineLayer.setOptions({dashArray:t.dashArray,color:t.lineColor,width:t.lineWidth,lineJoin:t.lineJoin})}},{key:"onDataChanged",value:function(t){this.shapeLayer.setData(t),this.lineLayer.setData(t,{closePath:!0})}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,dashArray:[0,0],lineColor:"rgba(250, 250, 25, 1)",lineWidth:2,lineJoin:"miter",fillColor:"rgba(25, 25, 250, 1)",fillOpacity:1}}}]),e}(Qs),nh=nh||{},ah=0,oh=null,sh=nh.Scene=function(t,e){this.name=void 0!==e.name?e.name:null,this.nodes=Array(e.nodes.length);for(var r=0,i=e.nodes.length;r<i;r++)this.nodes[r]=t.nodes[e.nodes[r]];this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.boundingBox=null},uh=nh.BoundingBox=function(t,e,r){t=t||Jo.fromValues(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),e=e||Jo.fromValues(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),void 0===r||!0===r?(this.min=Jo.clone(t),this.max=Jo.clone(e)):(this.min=t,this.max=e),this.transform=rs.create()};uh.prototype.updateBoundingBox=function(t){Jo.min(this.min,this.min,t.min),Jo.max(this.max,this.max,t.max)},uh.prototype.calculateTransform=function(){this.transform[0]=this.max[0]-this.min[0],this.transform[5]=this.max[1]-this.min[1],this.transform[10]=this.max[2]-this.min[2],this.transform[12]=this.min[0],this.transform[13]=this.min[1],this.transform[14]=this.min[2]},uh.getAABBFromOBB=function(){var t=Jo.create(),e=Jo.create(),r=Jo.create(),i=Jo.create(),n=Jo.create();return function(a,o){Jo.set(t,o[0],o[1],o[2]),Jo.set(e,o[4],o[5],o[6]),Jo.set(r,o[8],o[9],o[10]),o=Jo.fromValues(o[12],o[13],o[14]);var s=Jo.clone(o);return Jo.scale(i,t,a.min[0]),Jo.scale(n,t,a.max[0]),Jo.min(t,i,n),Jo.add(o,o,t),Jo.max(t,i,n),Jo.add(s,s,t),Jo.scale(i,e,a.min[1]),Jo.scale(n,e,a.max[1]),Jo.min(e,i,n),Jo.add(o,o,e),Jo.max(e,i,n),Jo.add(s,s,e),Jo.scale(i,r,a.min[2]),Jo.scale(n,r,a.max[2]),Jo.min(r,i,n),Jo.add(o,o,r),Jo.max(r,i,n),Jo.add(s,s,r),(a=new uh(o,s,!1)).calculateTransform(),a}}();var lh=nh.Accessor=function(t,e){this.bufferView=e,this.componentType=t.componentType,this.byteOffset=void 0!==t.byteOffset?t.byteOffset:0,this.byteStride=e.byteStride,this.normalized=void 0!==t.normalized&&t.normalized,this.count=t.count,this.type=t.type,this.size=Dh[this.type],this.min=t.min,this.max=t.max,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null};lh.prototype.prepareVertexAttrib=function(t,e){e.vertexAttribPointer(t,this.size,this.componentType,this.normalized,this.byteStride,this.byteOffset),e.enableVertexAttribArray(t)};var hh=nh.BufferView=function(t,e){this.byteLength=t.byteLength,this.byteOffset=void 0!==t.byteOffset?t.byteOffset:0,this.byteStride=void 0!==t.byteStride?t.byteStride:0,this.target=void 0!==t.target?t.target:null,this.data=e.slice(this.byteOffset,this.byteOffset+this.byteLength),this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.buffer=null};hh.prototype.createBuffer=function(t){this.buffer=t.createBuffer()},hh.prototype.bindData=function(t){return!!this.target&&(t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,this.data,t.STATIC_DRAW),t.bindBuffer(this.target,null),!0)};var fh=nh.Camera=function(t){this.name=void 0!==t.name?t.name:null,this.type=t.type,this.othographic=void 0===t.othographic?null:t.othographic,this.perspective=void 0===t.perspective?null:{yfov:t.perspective.yfov,znear:t.perspective.znear,zfar:void 0!==t.perspective.zfar?t.perspective.zfar:null,aspectRatio:void 0!==t.perspective.aspectRatio?t.perspective.aspectRatio:null},this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},ch=nh.Node=function(t,e){if(this.name=void 0!==t.name?t.name:null,this.nodeID=e,this.camera=void 0!==t.camera?t.camera:null,this.matrix=rs.create(),t.hasOwnProperty("matrix")){for(e=0;16>e;++e)this.matrix[e]=t.matrix[e];this.translation=Jo.create(),rs.getTranslation(this.translation,this.matrix),this.rotation=es.create(),rs.getRotation(this.rotation,this.matrix),this.scale=Jo.create(),rs.getScaling(this.scale,this.matrix)}else this.getTransformMatrixFromTRS(t.translation,t.rotation,t.scale);this.children=t.children||[],this.mesh=void 0!==t.mesh?oh.glTF.meshes[t.mesh]:null,this.skin=void 0!==t.skin?t.skin:null,void 0!==t.extensions&&void 0!==t.extensions.gl_avatar&&!0===oh.enableGLAvatar&&(this.skin=new wh(oh.glTF,oh.skeletonGltf.skins[oh.skeletonGltf.json.extensions.gl_avatar.skins[t.extensions.gl_avatar.skin.name]],t.extensions.gl_avatar.skin.inverseBindMatrices)),this.weights=void 0!==t.weights?t.weights:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.aabb=null,this.bvh=new uh};ch.prototype.traverse=function(t,e){e(this,t),t=0;for(var r=this.children.length;t<r;t++)this.children[t].traverse(this,e)},ch.prototype.traversePostOrder=function(t,e){for(var r=0,i=this.children.length;r<i;r++)this.children[r].traversePostOrder(this,e);e(this,t)},ch.prototype.traverseTwoExecFun=function(t,e,r){e(this,t);for(var i=0,n=this.children.length;i<n;i++)this.children[i].traverseTwoExecFun(this,e,r);r(this,t)};var dh=rs.create();ch.prototype.getTransformMatrixFromTRS=function(t,e,r){this.translation=void 0!==t?Jo.fromValues(t[0],t[1],t[2]):Jo.fromValues(0,0,0),this.rotation=void 0!==e?Qo.fromValues(e[0],e[1],e[2],e[3]):Qo.fromValues(0,0,0,1),this.scale=void 0!==r?Jo.fromValues(r[0],r[1],r[2]):Jo.fromValues(1,1,1),this.updateMatrixFromTRS()},ch.prototype.updateMatrixFromTRS=function(){rs.fromRotationTranslation(dh,this.rotation,this.translation),rs.scale(this.matrix,dh,this.scale)};var vh=nh.Mesh=function(t,e){this.meshID=e,this.name=void 0!==t.name?t.name:null,this.primitives=[],this.boundingBox=null,e=0;for(var r=t.primitives.length;e<r;++e){var i=t.primitives[e];i=new ph(oh.glTF,i),this.primitives.push(i),i.boundingBox&&(this.boundingBox||(this.boundingBox=new uh),this.boundingBox.updateBoundingBox(i.boundingBox))}this.boundingBox&&this.boundingBox.calculateTransform(),this.weights=void 0!==t.weights?t.weights:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},ph=nh.Primitive=function(t,e){var r;if(this.attributes=e.attributes,this.indices=void 0!==e.indices?e.indices:null,void 0!==e.extensions&&void 0!==e.extensions.gl_avatar&&!0===oh.enableGLAvatar&&e.extensions.gl_avatar.attributes)for(r in e.extensions.gl_avatar.attributes)this.attributes[r]=e.extensions.gl_avatar.attributes[r];for(r in null!==this.indices?(this.indicesComponentType=t.json.accessors[this.indices].componentType,this.indicesLength=t.json.accessors[this.indices].count,this.indicesOffset=t.json.accessors[this.indices].byteOffset||0):(this.drawArraysCount=t.json.accessors[this.attributes.POSITION].count,this.drawArraysOffset=t.json.accessors[this.attributes.POSITION].byteOffset||0),this.attributes)this.attributes[r]=t.accessors[this.attributes[r]];this.material=void 0!==e.material?t.materials[e.material]:null,this.mode=void 0!==e.mode?e.mode:4,this.targets=e.targets,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.boundingBox=this.shader=this.indexBuffer=this.vertexBuffer=this.vertexArray=null,void 0!==this.attributes.POSITION&&(t=this.attributes.POSITION).max&&"VEC3"===t.type&&(this.boundingBox=new uh(Jo.fromValues(t.min[0],t.min[1],t.min[2]),Jo.fromValues(t.max[0],t.max[1],t.max[2]),!1),this.boundingBox.calculateTransform())},gh=nh.Texture=function(t){this.name=void 0!==t.name?t.name:null,this.sampler=void 0!==t.sampler?oh.glTF.samplers[t.sampler]:null,this.source=void 0!==t.source?oh.glTF.images[t.source]:null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.texture=null};gh.prototype.createTexture=function(t){this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.source),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)};var mh=nh.Sampler=function(t){this.name=void 0!==t.name?t.name:null,this.magFilter=void 0!==t.magFilter?t.magFilter:null,this.minFilter=void 0!==t.minFilter?t.minFilter:null,this.wrapS=void 0!==t.wrapS?t.wrapS:10497,this.wrapT=void 0!==t.wrapT?t.wrapT:10497,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null,this.sampler=null};mh.prototype.createSampler=function(t){this.sampler=t.createSampler(),this.minFilter?t.samplerParameteri(this.sampler,t.TEXTURE_MIN_FILTER,this.minFilter):t.samplerParameteri(this.sampler,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_LINEAR),this.magFilter?t.samplerParameteri(this.sampler,t.TEXTURE_MAG_FILTER,this.magFilter):t.samplerParameteri(this.sampler,t.TEXTURE_MAG_FILTER,t.LINEAR),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_S,this.wrapS),t.samplerParameteri(this.sampler,t.TEXTURE_WRAP_T,this.wrapT)};var xh=nh.TextureInfo=function(t){this.index=t.index,this.texCoord=void 0!==t.texCoord?t.texCoord:0,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},yh=nh.PbrMetallicRoughness=function(t){this.baseColorFactor=void 0!==t.baseColorFactor?t.baseColorFactor:[1,1,1,1],this.baseColorTexture=void 0!==t.baseColorTexture?new xh(t.baseColorTexture):null,this.metallicFactor=void 0!==t.metallicFactor?t.metallicFactor:1,this.roughnessFactor=void 0!==t.roughnessFactor?t.roughnessFactor:1,this.metallicRoughnessTexture=void 0!==t.metallicRoughnessTexture?new xh(t.metallicRoughnessTexture):null,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},bh=nh.NormalTextureInfo=function(t){this.index=t.index,this.texCoord=void 0!==t.texCoord?t.texCoord:0,this.scale=void 0!==t.scale?t.scale:1,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},_h=nh.OcclusionTextureInfo=function(t){this.index=t.index,this.texCoord=void 0!==t.texCoord?t.texCoord:0,this.strength=void 0!==t.strength?t.strength:1,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},Ah=nh.Material=function(t){this.name=void 0!==t.name?t.name:null,this.pbrMetallicRoughness=void 0!==t.pbrMetallicRoughness?new yh(t.pbrMetallicRoughness):new yh({baseColorFactor:[1,1,1,1],metallicFactor:1,metallicRoughnessTexture:1}),this.normalTexture=void 0!==t.normalTexture?new bh(t.normalTexture):null,this.occlusionTexture=void 0!==t.occlusionTexture?new _h(t.occlusionTexture):null,this.emissiveTexture=void 0!==t.emissiveTexture?new xh(t.emissiveTexture):null,this.emissiveFactor=void 0!==t.emissiveFactor?t.emissiveFactor:[0,0,0],this.alphaMode=void 0!==t.alphaMode?t.alphaMode:"OPAQUE",this.alphaCutoff=void 0!==t.alphaCutoff?t.alphaCutoff:.5,this.doubleSided=t.doubleSided||!1,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},Th=nh.Skin=function(t,e,r){var i;for(this.name=void 0!==e.name?e.name:null,this.skinID=r,this.joints=Array(e.joints.length),r=0,i=this.joints.length;r<i;r++)this.joints[r]=t.nodes[e.joints[r]];if(this.skeleton=void 0!==e.skeleton?t.nodes[e.skeleton]:null,this.inverseBindMatrices=void 0!==e.inverseBindMatrices?t.accessors[e.inverseBindMatrices]:null,this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.uniformBlockID=ah++,this.inverseBindMatrices)for(this.inverseBindMatricesData=St(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),r=0,i=this.inverseBindMatricesData.length;r<i;r+=16)this.inverseBindMatrix.push(rs.fromValues(this.inverseBindMatricesData[r],this.inverseBindMatricesData[r+1],this.inverseBindMatricesData[r+2],this.inverseBindMatricesData[r+3],this.inverseBindMatricesData[r+4],this.inverseBindMatricesData[r+5],this.inverseBindMatricesData[r+6],this.inverseBindMatricesData[r+7],this.inverseBindMatricesData[r+8],this.inverseBindMatricesData[r+9],this.inverseBindMatricesData[r+10],this.inverseBindMatricesData[r+11],this.inverseBindMatricesData[r+12],this.inverseBindMatricesData[r+13],this.inverseBindMatricesData[r+14],this.inverseBindMatricesData[r+15]))},wh=nh.SkinLink=function(t,e,r){if(this.isLink=!0,t.skins||(t.skins=[]),t.skins.push(this),this.name=e.name,this.skinID=t.skins.length-1,this.joints=e.joints,this.skeleton=e.skeleton,this.inverseBindMatrices=void 0!==r?t.accessors[r]:null,this.uniformBlockID=ah++,this.inverseBindMatrices)for(this.inverseBindMatricesData=St(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),t=0,e=this.inverseBindMatricesData.length;t<e;t+=16)this.inverseBindMatrix.push(rs.fromValues(this.inverseBindMatricesData[t],this.inverseBindMatricesData[t+1],this.inverseBindMatricesData[t+2],this.inverseBindMatricesData[t+3],this.inverseBindMatricesData[t+4],this.inverseBindMatricesData[t+5],this.inverseBindMatricesData[t+6],this.inverseBindMatricesData[t+7],this.inverseBindMatricesData[t+8],this.inverseBindMatricesData[t+9],this.inverseBindMatricesData[t+10],this.inverseBindMatricesData[t+11],this.inverseBindMatricesData[t+12],this.inverseBindMatricesData[t+13],this.inverseBindMatricesData[t+14],this.inverseBindMatricesData[t+15]))},Mh=nh.Target=function(t){this.nodeID=void 0!==t.node?t.node:null,this.path=t.path,this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},Ch=nh.Channel=function(t,e){this.sampler=e.samplers[t.sampler],this.target=new Mh(t.target),this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},Rh=nh.AnimationSampler=function(t,e){this.input=t.accessors[e.input],this.output=t.accessors[e.output],this.inputTypedArray=St(this.input),this.outputTypedArray=St(this.output),this.interpolation=void 0!==e.interpolation?e.interpolation:"LINEAR",this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null,this.curIdx=0,this.curValue=Qo.create(),this.endT=this.inputTypedArray[this.inputTypedArray.length-1],this.inputMax=this.endT-this.inputTypedArray[0]},Sh=Qo.create(),Ph=Qo.create();Rh.prototype.getValue=function(t){t>this.endT&&(t-=this.inputMax*Math.ceil((t-this.endT)/this.inputMax),this.curIdx=0);for(var e=this.inputTypedArray.length;this.curIdx<=e-2&&t>=this.inputTypedArray[this.curIdx+1];)this.curIdx++;this.curIdx>=e-1&&(t-=this.inputMax,this.curIdx=0);var r=4===(e=Dh[this.output.type])?es.slerp:Qo.lerp,i=this.curIdx,n=i*e,a=n+e;for(t=Math.max(0,t-this.inputTypedArray[i])/(this.inputTypedArray[i+1]-this.inputTypedArray[i]),i=0;i<e;i++)Sh[i]=this.outputTypedArray[n+i],Ph[i]=this.outputTypedArray[a+i];"LINEAR"===this.interpolation&&r(this.curValue,Sh,Ph,t)};var Eh=nh.Animation=function(t,e){var r;this.name=void 0!==e.name?e.name:null,this.samplers=[];var i=0;for(r=e.samplers.length;i<r;i++)this.samplers[i]=new Rh(t,e.samplers[i]);for(this.channels=[],i=0,r=e.channels.length;i<r;i++)this.channels[i]=new Ch(e.channels[i],this);this.extensions=void 0!==e.extensions?e.extensions:null,this.extras=void 0!==e.extras?e.extras:null},Lh=nh.glTFModel=function(t){this.json=t,this.defaultScene=void 0!==t.scene?t.scene:0,this.version=Number(t.asset.version),t.accessors&&(this.accessors=Array(t.accessors.length)),t.bufferViews&&(this.bufferViews=Array(t.bufferViews.length)),t.scenes&&(this.scenes=Array(t.scenes.length)),t.nodes&&(this.nodes=Array(t.nodes.length)),t.meshes&&(this.meshes=Array(t.meshes.length)),t.materials&&(this.materials=Array(t.materials.length)),t.textures&&(this.textures=Array(t.textures.length)),t.samplers&&(this.samplers=Array(t.samplers.length)),t.images&&(this.images=Array(t.images.length)),t.skins&&(this.skins=Array(t.skins.length)),t.animations&&(this.animations=Array(t.animations.length)),t.cameras&&(this.cameras=Array(t.cameras.length)),this.extensions=void 0!==t.extensions?t.extensions:null,this.extras=void 0!==t.extras?t.extras:null},Fh=nh.glTFLoader=function(t){this._init(),this.glTF=null,this.enableGLAvatar=!1,this.linkSkeletonGltf=null};Fh.prototype._init=function(){this._loadDone=!1,this._bufferLoaded=this._bufferRequested=0,this._buffers=[],this._bufferTasks={},this._finishedPendingTasks=this._pendingTasks=this._imageLoaded=this._imageRequested=this._shaderLoaded=this._shaderRequested=0,this.onload=null,oh=this},Fh.prototype._checkComplete=function(){this._bufferRequested==this._bufferLoaded&&this._imageRequested==this._imageLoaded&&(this._loadDone=!0),this._loadDone&&this._pendingTasks==this._finishedPendingTasks&&(this._postprocess(),this.onload(this.glTF))},Fh.prototype.loadGLTF_GL_Avatar_Skin=function(t,e,r){this.enableGLAvatar=!0,this.skeletonGltf=e,this.loadGLTF(t,r)},Fh.prototype.loadGLTF=function(t,e){this._init(),this.onload=e||function(t){},this.baseUri=Pt(t);var r=this;Et(t,(function(t){t=JSON.parse(t),r.glTF=new Lh(t);var e,i,n=function(t){if(r._buffers[e]=t,r._bufferLoaded++,r._bufferTasks[e]){var i,n=0;for(i=r._bufferTasks[e].length;n<i;++n)r._bufferTasks[e][n](t)}r._checkComplete()};if(t.buffers)for(e in t.buffers){r._bufferRequested++;var a=t.buffers[e].uri;-1===a.indexOf("base64")&&(a=r.baseUri+a),Lt(a,n)}if(n=function(t,e){r._imageLoaded++,r.glTF.images[e]=t,r._checkComplete()},t.images)for(i in t.images)r._imageRequested++,Ft(r.baseUri+t.images[i].uri,i,n);r._checkComplete()}))},Fh.prototype._postprocess=function(){function t(t,e){var r=u[t.nodeID];null!==e?rs.mul(r,u[e.nodeID],t.matrix):rs.copy(r,t.matrix)}function e(t,e){var r=u[t.nodeID];e=null!==e?e.bvh:l.boundingBox,t.mesh&&(n=t.mesh).boundingBox&&(t.aabb=uh.getAABBFromOBB(n.boundingBox,r),0===t.children.length&&(Jo.copy(t.bvh.min,t.aabb.min),Jo.copy(t.bvh.max,t.aabb.max))),Jo.min(e.min,e.min,t.bvh.min),Jo.max(e.max,e.max,t.bvh.max)}var r,i,n;if(oh=this,this.glTF.cameras){var a=0;for(r=this.glTF.cameras.length;a<r;a++)this.glTF.cameras[a]=new fh(this.glTF.json.cameras[a])}if(this.glTF.bufferViews)for(a=0,r=this.glTF.bufferViews.length;a<r;a++)this.glTF.bufferViews[a]=new hh(this.glTF.json.bufferViews[a],this._buffers[this.glTF.json.bufferViews[a].buffer]);if(this.glTF.accessors)for(a=0,r=this.glTF.accessors.length;a<r;a++)this.glTF.accessors[a]=new lh(this.glTF.json.accessors[a],this.glTF.bufferViews[this.glTF.json.accessors[a].bufferView]);if(this.glTF.materials)for(a=0,r=this.glTF.materials.length;a<r;a++)this.glTF.materials[a]=new Ah(this.glTF.json.materials[a]);if(this.glTF.samplers)for(a=0,r=this.glTF.samplers.length;a<r;a++)this.glTF.samplers[a]=new mh(this.glTF.json.samplers[a]);if(this.glTF.textures)for(a=0,r=this.glTF.textures.length;a<r;a++)this.glTF.textures[a]=new gh(this.glTF.json.textures[a]);for(a=0,r=this.glTF.meshes.length;a<r;a++)this.glTF.meshes[a]=new vh(this.glTF.json.meshes[a],a);for(a=0,r=this.glTF.nodes.length;a<r;a++)this.glTF.nodes[a]=new ch(this.glTF.json.nodes[a],a);for(a=0,r=this.glTF.nodes.length;a<r;a++){var o=this.glTF.nodes[a],s=0;for(i=o.children.length;s<i;s++)o.children[s]=this.glTF.nodes[o.children[s]]}var u=Array(this.glTF.nodes.length);for(a=0,r=u.length;a<r;a++)u[a]=rs.create();for(a=0,r=this.glTF.scenes.length;a<r;a++){var l=this.glTF.scenes[a]=new sh(this.glTF,this.glTF.json.scenes[a]);for(l.boundingBox=new uh,s=0,i=l.nodes.length;s<i;s++)(o=l.nodes[s]).traverseTwoExecFun(null,t,e);l.boundingBox.calculateTransform()}for(s=0,i=this.glTF.nodes.length;s<i;s++)null!==(o=this.glTF.nodes[s]).bvh&&o.bvh.calculateTransform();if(this.glTF.animations)for(a=0,r=this.glTF.animations.length;a<r;a++)this.glTF.animations[a]=new Eh(this.glTF,this.glTF.json.animations[a]);if(this.glTF.json.skins)for(a=0,r=this.glTF.skins.length;a<r;a++)for(this.glTF.skins[a]=new Th(this.glTF,this.glTF.json.skins[a],a),s=0,i=(o=this.glTF.skins[a].joints).length;s<i;s++)o[s].jointID=s;for(a=0,r=this.glTF.nodes.length;a<r;a++)null!==(o=this.glTF.nodes[a]).skin&&"number"==typeof o.skin&&(o.skin=this.glTF.skins[o.skin])};var Dh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Bh=function(t){function e(t,r){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).call(this,t,r))}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{scale:1}}},{key:"initialize",value:function(t){var e=this;this.gl=t;var r=this.getOptions();this.gltfObj=Dt({gl:t,options:r}),(new Fh).loadGLTF(r.url,(function(t){e.gltfObj.setupScene(t),e.webglLayer.render()}))}},{key:"onChanged",value:function(t,e){}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var r=this.getData(),i=this.getOptions(),n=i.scale,a=[n,n,n];for("px"===i.unit&&this.map&&(a=[n*(a=this.map.getZoomUnits()),n*a,n*a]),n=0;n<r.length;n++){var o=r[n].geometry.coordinates;i=rs.create();var s=rs.create();o=this.normizedPoint(o),rs.identity(i),rs.translate(i,i,[o[0],o[1],o[2]]),rs.rotateX(i,i,Math.PI/2),rs.rotateY(i,i,(r[n].angle||0)*Math.PI/180),rs.scale(i,i,a),rs.mul(s,t,i),this.gltfObj.render({gl:e,matrix:s})}}}]),e}(Ds),Oh=Oh||{};!function(){function t(t,e,r){return r=t.createShader(r),t.shaderSource(r,e),t.compileShader(r),r}Oh.getShaderSource=function(t){return document.getElementById(t).textContent.replace(/^\s+|\s+$/g,"")},Oh.createProgram=function(e,r,i){var n=e.createProgram();return r=t(e,r,e.VERTEX_SHADER),i=t(e,i,e.FRAGMENT_SHADER),e.attachShader(n,r),e.deleteShader(r),e.attachShader(n,i),e.deleteShader(i),e.linkProgram(n),e.getProgramInfoLog(n),e.getShaderInfoLog(r),e.getShaderInfoLog(i),n};var e=Oh.loadImage=function(t,e){var r=new Image;return r.crossOrigin="Anonymous",r.src=t,r.onload=e,r};Oh.loadImages=function(t,r){function i(){0>=--a&&r(n)}for(var n=[],a=t.length,o=0;o<a;++o)n.push(e(t[o],i))}}();var kh=function(t){function e(t){Ut(this,e);var r=mi(this,(e.__proto__||Xe(e)).call(this,t));return t=r.getOptions(),r.gltfLayer=new Bh({url:t.url,scale:t.scale}),r.children=[r.gltfLayer],r.autoUpdate=!0,r.index=[],r.newData=[],r.isStarted=!1!==t.autoPlay,r}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{url:"https://mapv-website.bj.bcebos.com/gl/examples/model/car.gltf",scale:1,step:1,defaultAngle:90}}},{key:"onOptionsChanged",value:function(t){this.gltfLayer.setOptions({})}},{key:"onDataChanged",value:function(t){var e=this;this.index=[],this.newData=[];for(var r=0;r<t.length;r++){this.index.push(0);var i=t[r].geometry.coordinates;"LineString"===t[r].geometry.type?this.newData.push(this._addPath(i)):i.forEach((function(t){e.newData.push(e._addPath(t))}))}this.updatePoints()}},{key:"lnglatToMercator",value:function(t,e){return e=e*Math.PI/180,e=3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e))),[parseFloat((t*Math.PI/180*6378137).toFixed(2)),parseFloat(e.toFixed(2))]}},{key:"getDeg",value:function(t,e){-180<t[0]&&180>t[0]&&(t=this.lnglatToMercator(t[0],t[1]),e=this.lnglatToMercator(e[0],e[1]));var r=180*Math.atan((e[1]-t[1])/(e[0]-t[0]))/Math.PI;return e[0]>t[0]&&(r-=180),r}},{key:"getPoint",value:function(t,e,r){return[t[0]+(e[0]-t[0])*r,t[1]+(e[1]-t[1])*r,t[2]&&e[2]?t[2]+(e[2]-t[2])*r:0]}},{key:"updatePoints",value:function(){for(var t=this.getOptions(),e=this.newData,r=[],i=0;i<e.length;i++){for(var n=e[i],a=Math.floor(this.index[i]),o=a+1;n[o]&&n[o][0]===n[a][0]&&n[o][1]===n[a][1];)o++;o>=n.length-1&&(o=--a),o=this.getDeg(n[a],n[o]),r.push({geometry:{type:"Point",coordinates:this.getPoint(n[a],n[a+1],this.index[i]%1)},angle:o-t.defaultAngle})}this.pointData=r,this.gltfLayer.setData(r,{autoRender:!1})}},{key:"getCurrentPoint",value:function(){return this.pointData}},{key:"getDistance",value:function(t,e){var r=t[1]*Math.PI/180,i=e[1]*Math.PI/180;return t=2*Math.asin(Math.sqrt(Math.pow(Math.sin((r-i)/2),2)+Math.cos(r)*Math.cos(i)*Math.pow(Math.sin((t[0]*Math.PI/180-e[0]*Math.PI/180)/2),2))),Math.round(6378137e4*t)/1e4}},{key:"_addPath",value:function(t){for(var e=t.length,r=0,i=[],n=[],a=1;a<e;a++){var o=this.getDistance(t[a-1],t[a]);i.push(o),r+=o}for(o=[0],a=1;a<e;a++){var s=(i[a-1]/r).toFixed(2);o[a]=o[a-1]+parseFloat(s,10),n=n.concat(this._getPath(t[a-1],t[a],1e3*s))}return this._pathPercents=o,n}},{key:"_getPath",value:function(t,e,r){if(0===r)return[t];for(var i=[],n=0;n<=r;n++)i.push([(e[0]-t[0])/r*n+t[0],(e[1]-t[1])/r*n+t[1],e[2]&&t[2]?(e[2]-t[2])/r*n+t[2]:0]);return i}},{key:"start",value:function(){this.isStarted=!0}},{key:"stop",value:function(){this.isStarted=!1}},{key:"render",value:function(t){if(Is(e.prototype.__proto__||Xe(e.prototype),"render",this).call(this,t),t=this.getOptions(),this.isStarted)for(var r=this.newData,i=0;i<this.index.length;i++)this.index[i]+=t.step,this.index[i]>r[i].length-2&&(this.index[i]=0);this.updatePoints()}}]),e}(Qs),zh=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="BoardTextLayer",r=t.canvas=document.createElement("canvas"),(r=t.ctx=r.getContext("2d")).textAlign="start",r.textBaseline="top",t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,collides:!0,unit:"px",angle:0,translateX:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],shadow:{},maxHeightLine:20,lineBreak:"\n"}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new us(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uUnitPx;uniform float zoomUnits;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***点A(x,y)，绕原点顺时针旋转角度a新坐标的计算公式*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/mat3 rotateZ(float angle){float cos0=cos(angle);float sin0=sin(angle);return mat3(cos0,sin0,0.,-sin0,cos0,0.,0.,0.,1.);}vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;float z=coord.z;mat3 mat=rotateZ(rotation);vec3 rotated=vec3(size[0],0.0,size[1]);if(corner==1.0){rotated=mat*vec3(-size[0],0.0,size[1]);}else if(corner==2.0){rotated=mat*vec3(size[0],0.0,size[1]);}else if(corner==3.0){rotated=mat*vec3(size[0],0.0,-size[1]);}else{rotated=mat*vec3(-size[0],0.0,-size[1]);}x+=rotated.x;y+=rotated.y;z+=rotated.z;return vec3(x,y,z);}void main(){vTextCoord=aTextCoord;vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}",fragmentShader:"precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){vec4 textureColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));if(textureColor.a<=0.1&&uIsPickRender==false){discard;}gl_FragColor=textureColor;\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){this.cachedData=[];for(var r=0;r<e.length;r++){var i=this.normizedPoint(e[r].geometry.coordinates),n=e[r].text;"properties"in e[r]&&"text"in e[r].properties&&(n=e[r].properties.text);var a=this.getProperty("angle",t.angle,e[r]),o=this.getProperty("color",t.color,e[r]),s=this.getProperty("maxHeightLine",t.maxHeightLine,e[r]);i&&void 0!==n&&this.cachedData.push({point:i,text:n,angle:a,color:o,maxHeightLine:s,index:r})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,r=t.matrix,i=this.getOptions(),n=this.program;n.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:X(e,i.blend),polygonOffset:i.polygonOffset,depthTest:i.depthTest,depthMask:i.depthWrite});var a=this.map.getZoomUnits();n.setUniforms(ze(this.getCommonUniforms(t),{matrix:r,textureImage:this.texture,offset:i.offset,zoomUnits:a,zIndex:i.zIndex,uUnitPx:"px"===i.unit})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var e=t.gl,r=t.matrix,i=this.getOptions();t=i.fontSize;var n=i.fontFamily,a=i.translateX,o=i.padding,s=i.margin,u=i.collides,l=i.enablePicked,h=i.shadow;i=i.lineBreak;var f=e.canvas.width/window.devicePixelRatio,c=e.canvas.height/window.devicePixelRatio,d=this.canvas,v=this.ctx;v.save(),v.scale(window.devicePixelRatio,window.devicePixelRatio),v.textBaseline="top",v.font="normal bold 20px "+n;var p=new qs;e=[];for(var g=0;g<this.cachedData.length;g++){var m=this.cachedData[g],x=m.point,y=m.text,b=m.angle,_=m.index,A=m.color;m=m.maxHeightLine;var T=zi(x,3),w=Qo.clone([T[0],T[1],T[2],1]);Qo.transformMat4(w,w,r),Qo.scale(w,w,1/w[3]),T=(w[0]+1)/2*f,w=(1-w[1])/2*c;var M=v.measureText(y),C=y.split(i),R=C.map((function(t){return v.measureText(t).width}));R=Math.max.apply(Math,Vi(R));for(var S=20,P=0;P<C.length-1;P++)S+=m;if(C=S,M=Math.min(M.width,R)+1,M+=2*o[0]+a,C+=2*o[1],S=M+s[0],R=(w-=(R=C+s[1])/2)+R,!(0>(S=(T-=S/2)+S)||0>R||T>f||w>c)){if(u){if(T={minX:T,maxX:S,minY:w,maxY:R},p.collides(T))continue;p.insert(T)}e.push({w:M,h:C,point:x,text:y,color:A,angle:b,maxHeightLine:m,dataIndex:_})}}for(v.restore(),r=[],s=[],u=[],f=[],0>=(c=(p=vt(e)).w)&&(c=1),0>=(p=p.h)&&(p=1),d.width=c*window.devicePixelRatio,d.height=p*window.devicePixelRatio,v.save(),v.scale(window.devicePixelRatio,window.devicePixelRatio),v.textBaseline="top",v.font="normal bold 20px "+n,v.shadowColor=h&&h.color,v.shadowOffsetX=h&&h.offsetX,v.shadowOffsetY=h&&h.offsetY,v.shadowBlur=h&&h.blur,n=0,h=e.length;n<h;++n){for(d=e[n],v.fillStyle=d.color,Bt(v,d.text,d.x+o[0]+a,d.y+o[1],d.maxHeightLine,i),g=(y=zi(d.point,3))[0],x=y[1],y=y[2],b=0;4>b;b++)r.push(g,x,y),r.push(b),r.push(d.w,d.h),r.push(t/20,d.angle*Math.PI/180);g=d.x/c,x=(d.x+d.w)/c,y=(d.y+d.h)/p,b=d.y/p,s.push(g,y,g,b,x,b,x,y),g=4*n,u.push(g,g+2,g+1,g,g+3,g+2),l&&(d=this.indexToRgb(d.dataIndex),f.push(d[0]/255,d[1]/255,d[2]/255),f.push(d[0]/255,d[1]/255,d[2]/255),f.push(d[0]/255,d[1]/255,d[2]/255),f.push(d[0]/255,d[1]/255,d[2]/255))}v.restore(),this.loadTexture(),this.index=u,this.vertexBuffer.updateData(new Float32Array(r)),this.uvBuffer.updateData(new Float32Array(s)),this.indexBuffer.updateData(new Uint32Array(u)),l&&this.pickBuffer.updateData(new Float32Array(f))}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e}),{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),e}(Ds),Ih=function(t){function e(t){Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).name="LabelLayer";var r=t.canvas=document.createElement("canvas");return t.ctx=r.getContext("2d"),t.arrowHeight=8,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,textColor:"#0f0",borderColor:"#f00",backgroundColor:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,lineHeight:20,textAlign:"left",collides:!1,offset:[0,0],padding:[2,2],polygonOffset:[0,0],borderRadius:5}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new us(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***点A(x,y)，绕原点顺时针旋转角度a新坐标的计算公式*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x;y+=size.y;}else if(corner==2.0){x+=size.x;y+=size.y;}else if(corner==3.0){x+=size.x;y+=-size.y;}else{x+=-size.x;y+=-size.y;}return vec3(x,y+size.y,coord.z);}void main(){vTextCoord=aTextCoord;vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z+zIndex,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio;vec3 current=transformCoord(screen,halfSize,corner);gl_Position=vec4(current,1.0);}",fragmentShader:"precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:24,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:24,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:24,type:"FLOAT",offset:16},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){for(this.cachedData=[],t=0;t<e.length;t++){var r=e[t],i=this.normizedPoint(r.geometry.coordinates);i&&this.cachedData.push({point:i,item:r,index:t})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,r=t.matrix,i=this.getOptions(),n=this.program;n.use(e),this.updateText(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:i.polygonOffset,depthTest:i.depthTest,depthMask:i.depthWrite});var a=this.map.getZoomUnits();n.setUniforms(ze(this.getCommonUniforms(t),{matrix:r,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,offset:i.offset,zoomUnits:a,zIndex:i.zIndex})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"updateText",value:function(t){var e=this,r=t.gl,i=t.matrix,n=this.getOptions().enablePicked;t=this.canvas;var a=this.ctx,o=(i=vt(r=this.createMapbox(a,r,i))).w,s=i.h;0>=o&&(o=1),0>=s&&(s=1),t.width=o*window.devicePixelRatio,t.height=s*window.devicePixelRatio;var u=[],l=[],h=[],f=[];r.forEach((function(t,r){e.drawItem(a,t);var i=zi(t.point,3),c=i[0],d=i[1];i=i[2];for(var v=0;4>v;v++)u.push(c,d,i),u.push(v),u.push(t.w,t.h);c=t.x/o,d=(t.x+t.w)/o,i=(t.y+t.h)/s,v=t.y/s,l.push(c,i,c,v,d,v,d,i),r*=4,h.push(r,r+2,r+1,r,r+3,r+2),n&&(t=e.indexToRgb(t.dataIndex),f.push(t[0]/255,t[1]/255,t[2]/255),f.push(t[0]/255,t[1]/255,t[2]/255),f.push(t[0]/255,t[1]/255,t[2]/255),f.push(t[0]/255,t[1]/255,t[2]/255))})),this.loadTexture(),this.index=h,this.vertexBuffer.updateData(new Float32Array(u)),this.uvBuffer.updateData(new Float32Array(l)),this.indexBuffer.updateData(new Uint32Array(h)),n&&this.pickBuffer.updateData(new Float32Array(f))}},{key:"createMapbox",value:function(t,e,r){var i=this,n=this.getOptions(),a=n.padding,o=n.collides,s=n.fontSize,u=e.canvas.width/window.devicePixelRatio,l=e.canvas.height/window.devicePixelRatio,h=new qs,f=[];return this.cachedData.forEach((function(e){var n=e.point,c=e.item;e=e.index;var d=zi(n,3);d=Qo.clone([d[0],d[1],d[2],1]),Qo.transformMat4(d,d,r),Qo.scale(d,d,1/d[3]);var v=(d[0]+1)/2*u,p=(1-d[1])/2*l;d=i.computeTextWH(c,t,a,s);var g=zi(d,2),m=(v-=(d=g[0])/2)+d,x=(p-=(g=g[1])/2)+g;if(!(0>m||0>x||v>u||p>l)){if(o){if(v={minX:v,maxX:m,minY:p,maxY:x},h.collides(v))return;h.insert(v)}f.push({w:d,h:g+i.arrowHeight,point:n,item:c,dataIndex:e})}})),f}},{key:"computeTextWH",value:function(t,e){var r=this.getOptions(),i=r.padding,n=r.fontSize,a=r.borderRadius,o=r.fontFamily;return r=r.lineHeight,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.font=n+"px "+o,n=(t=t.properties.text.split("\n")).reduce((function(t,e){return t.length<e.length?e:t}),""),n=e.measureText(n),e.restore(),[n.width+2*(i[1]+a),2*(i[0]+a)+r*t.length]}},{key:"drawItem",value:function(t,e){var r=this.getOptions(),i=r.padding,n=r.backgroundColor,a=r.textColor,o=r.fontSize,s=r.borderColor,u=r.borderRadius,l=r.fontFamily,h=r.lineHeight;r=r.textAlign;var f=u-1,c=e.x,d=e.y,v=e.w,p=e.h;e=e.item;var g="";"object"===gi(e.properties)&&(g=e.properties.text||"",a=e.properties.textColor||a,s=e.properties.borderColor||s,n=e.properties.backgroundColor||n),e=g.split("\n"),p-=this.arrowHeight,t.save(),t.scale(window.devicePixelRatio,window.devicePixelRatio),t.textBaseline="top",t.font=o+"px "+l,t.translate(c,d),t.fillStyle=n,t.strokeStyle=s,t.beginPath(),t.arc(u,u,f,Math.PI,1.5*Math.PI),t.lineTo(v-u,1),t.arc(v-u,u,f,1.5*Math.PI,0),t.lineTo(v-1,p-u),t.arc(v-u,p-u,f,0*Math.PI,.5*Math.PI),t.lineTo(u,p-1),t.arc(u,p-u,f,.5*Math.PI,1*Math.PI),t.lineTo(1,u),t.closePath(),t.fill(),t.stroke(),t.beginPath(),l=v/2,f=(n=this.arrowHeight)/2,t.moveTo(l-f,p-1),t.lineTo(l+f,p-1),t.lineTo(l,p+.8*n),t.fillStyle=s,t.fill(),t.fillStyle=a;var m="center"===r?l:"right"===r?v-u-i[1]:u+i[1];t.textAlign=r,e.forEach((function(e,r){t.fillText(e,m,u+i[0]+(r+.5)*h-.5*o)})),t.restore()}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e}),{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),e}(Ds);Ot.prototype.parseColors=function(t){this.arrFeatureStyles=[[2,t[0]||"rgba(79,210,125,1)",2,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",5,2,0,[],0,0],[2,t[0]||"rgba(79,210,125,1)",6,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",2,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",5,2,0,[],0,0],[2,t[2]||"rgba(255,208,69,1)",6,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",2,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",5,2,0,[],0,0],[2,t[1]||"rgba(232,14,14,1)",6,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",2,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",5,2,0,[],0,0],[2,t[3]||"rgba(181,0,0,1)",6,2,0,[],0,0],[2,"rgba(255,255,255,1)",4,0,0,[],0,0],[2,"rgba(255,255,255,1)",5.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",7,0,0,[],0,0],[2,"rgba(255,255,255,1)",8.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",10,0,0,[],0,0]]},Ot.prototype.setColors=function(t){this.parseColors(t)},Ot.prototype.initialize=function(t){this._initialize||(this._initialize=!0)},Ot.prototype.clearCache=function(t){this.cache={}},Ot.prototype.setMap=function(t){t?(this.map=t,this._initialize?this.canvaslayer.show():this.initialize(t)):this.canvaslayer.hide()},Ot.prototype.draw=function(t){(t=t||{}).clearCache&&this.clearCache(),this.canvaslayer.draw()},Ot.prototype.clear=function(){},Ot.prototype.update=function(){var t=this.map,e=this.getDataZoom(),r=Math.pow(2,18-e),i=256*r,n=y.convertLL2MC(t.getCenter()),a=Math.ceil(n.lng/i),o=Math.ceil(n.lat/i),s=this.tileSize,u=e-Math.round(t.getZoom());for(0<u&&(s/=Math.pow(2,u)),i=[a,o,(n.lng-a*i)/i*s,(n.lat-o*i)/i*s],n=(a=t.getBounds()).getNorthEast(),a=a.getSouthWest(),t.getSize(),t.getSize(),t=(n.lng-a.lng)/r,r=(n.lat-a.lat)/r,n=i[1]-Math.ceil((r/2-i[3])/s),a=i[0]+Math.ceil((t/2+i[2])/s),o=i[1]+Math.ceil((r/2+i[3])/s),r=[],s=i[0]-Math.ceil((t/2-i[2])/s);s<a;s++)for(i=n;i<o;i++)r.push([s,i,e]);for(this.tilesOrder=r,this._loadCount={},s=0;s<r.length;s++)i=r[s][0],t=r[s][1],this._loadCount[i+"_"+t+"_"+r[s][2]]=!1;for(s=0;s<r.length;s++)i=r[s][0],t=r[s][1],this.showTile(i,t,e)},Ot.prototype.showTile=function(t,e,r){this._parseDataAndDraw(t,e,r)},Ot.prototype.drawCurrentData=function(){this.clear();for(var t=[],e=0;e<this.tilesOrder.length;e++){var r=this.tilesOrder[e][0],i=this.tilesOrder[e][1],n=this.tilesOrder[e][2],a=this.cache[this.getCacheKey(r,i,n)];if(a)for(r=this._drawFeatures(a,r,i,n),i=0;i<r.length;i++)t.push(r[i])}this.lineLayer.setData(t)},Ot.prototype.isAllLoaded=function(){var t,e=!0;for(t in this._loadCount)if(!this._loadCount[t]){e=!1;break}return e},Ot.prototype.getCacheKey=function(t,e,r){return t+"_"+e+"_"+r},Ot.prototype.getDataZoom=function(){var t=Math.round(this.map.getZoom());return 19<t&&(t=19),t},Ot.prototype._parseDataAndDraw=function(t,e,r){var i=this,n=i.map,a=n.getCenter(),o=Math.round(n.getZoom()),s=this.getCacheKey(t,e,r),u="_cbk"+(1e5*Math.random()).toFixed(0),l=this.getTileUrl(t,e,r,"BMapGL."+u);BMapGL[u]=function(l){i._loadCount[t+"_"+e+"_"+r]=!0;var h=n.getCenter(),f=Math.round(n.getZoom());h.equals(a)&&f===o?(h=l.content&&l.content.tf,l.data&&(h=l.data),i.cache[s]=h?{traffic:h,precision:l.precision}:null,i.drawTogether&&i.isAllLoaded()&&i.drawCurrentData()):f!==o&&i.clear(),delete BMapGL[u]},void 0!==i.cache[s]?(i._loadCount[t+"_"+e+"_"+r]=!0,i.drawTogether&&i.isAllLoaded()&&i.drawCurrentData()):this.request(l)},Ot.prototype.getTileUrl=function(t,e,r,i){return"https://sp3.baidu.com/7_AZsjOpB1gCo2Kml5_Y_DAcsMJiwa/traffic/?qt=vtraffic&x="+t+"&y="+e+"&z="+r+"&fn="+i+"&t="+(new Date).getTime()},Ot.prototype._drawFeatures=function(t,e,r,i){var n=10;i=Math.pow(2,18-i),this.map.getCenter();var a=this.tileSize;if(e=[e*a*i,(r+1)*a*i],r=[],t&&t.traffic){n*=t.precision,a=0;for(var o=(t=t.traffic).length;a<o;a++){var s=t[a],u=s[1];s=this.arrFeatureStyles[s[3]];var l=u[0]/n,h=-u[1]/n,f=[];f.push([e[0]+l*i,e[1]+h*i,1]);for(var c=2,d=u.length;c<d;c+=2)l+=u[c]/n,h-=u[c+1]/n,f.push([e[0]+l*i,e[1]+h*i,1]);r.push({color:s[1],geometry:{type:"LineString",coordinates:f}})}}return r},Ot.prototype.request=function(t,e){if(e){var r=(1e5*Math.random()).toFixed(0);BMapGL._rd["_cbk"+r]=function(t){e&&e(t),delete BMapGL._rd["_cbk"+r]},t+="&callback=BMapGL._rd._cbk"+r}var i=document.createElement("script");i.type="text/javascript",i.charset="utf-8",i.src=t,i.addEventListener?i.addEventListener("load",(function(t){(t=t.target).parentNode.removeChild(t)}),!1):i.attachEvent&&i.attachEvent("onreadystatechange",(function(t){!(t=window.event.srcElement)||"loaded"!==t.readyState&&"complete"!==t.readyState||t.parentNode.removeChild(t)})),setTimeout((function(){document.getElementsByTagName("head")[0].appendChild(i),i=null}),1)},Ot.prototype.getRGBA=function(t){return"rgba("+((t>>>=0)>>24&255)+","+(t>>16&255)+","+(t>>8&255)+","+(255&t)/256+")"},Ot.prototype.getLineCap=function(t){return["butt","square","round"][t]},Ot.prototype.getLineJoin=function(t){return["miter","bevel","round"][t]};var Uh=function(t){function e(t){Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t))).autoUpdate=!0,t.getOptions();var r=new th({color:"rgba(257, 254, 47, 0.9)",minZoom:18,duration:.8,interval:.2,trailLength:.4});return t.lineLayer=r,t.children=[r],t}return Mi(e,t),Ge(e,[{key:"initialize",value:function(t){Is(e.prototype.__proto__||Xe(e.prototype),"initialize",this).call(this,t),t=this.map.map;var r=new Ot({});r.lineLayer=this.lineLayer,this.trafficTileManager=r,r.setMap(t),r.update(),t.addEventListener("moveend",(function(){r.update()})),t.addEventListener("zoomend",(function(){r.update()})),t.addEventListener("ondraw",(function(){}))}},{key:"onOptionsChanged",value:function(t){}},{key:"onDataChanged",value:function(t){}},{key:"getDefaultOptions",value:function(){return{}}}]),e}(Qs),Nh=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="HeatmapLayer",t.bufferData=[],t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{size:13,unit:"px",height:0,max:100,min:0,opacity:1}}},{key:"initialize",value:function(t){var e=this;this.gl=t;var r=this.getOptions();this.inverseMatrix=rs.create(Float64Array),this.frameBuffer=new vs(t),this.webglLayer.map.onResize((function(){e.frameBuffer=new vs(t)})),this.circle=kt(64),this.circleTexture=H(t,this.circle,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}),this.intensity=new w({gradient:r.gradient}),this.paletteTexture=H(t,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}),this.offlineProgram=new us(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform mat4 pointToPixelMatrix;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform int unit;uniform float size;uniform float max;uniform float min;attribute vec3 aPos;attribute vec2 aOffset;attribute float aCount;varying vec2 vOffset;varying float vCount;varying vec3 vPosition;void main(){vOffset=aOffset;vCount=(aCount-min)/(max-min);if(unit==1){vec2 pos=(pointToPixelMatrix*vec4(aPos.xy,0.0,1.0)).xy+aOffset.xy*size/2.0;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pos,0.0,1.0);}else{vec2 pos=aPos.xy+aOffset.xy*size;gl_Position=u_matrix*vec4(pos,0.0,1.0);}vPosition=vec3(gl_Position.z/gl_Position.w);}",fragmentShader:"varying vec2 vOffset;varying float vCount;varying vec3 vPosition;uniform sampler2D uCircle;void main(){vec4 circle=texture2D(uCircle,(vOffset+1.0)/2.0);float intensity=circle.a*vCount;if(intensity<=0.0){discard;}gl_FragColor=vec4(vPosition,intensity);}"},this),this.offlineBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineIndexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineVertexArray=new ds({gl:t,program:this.offlineProgram,attributes:[{stride:24,name:"aPos",buffer:this.offlineBuffer,size:3,type:"FLOAT",offset:0},{stride:24,name:"aOffset",buffer:this.offlineBuffer,size:2,type:"FLOAT",offset:12},{stride:24,name:"aCount",buffer:this.offlineBuffer,size:1,type:"FLOAT",offset:20}]}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.program=new us(this.gl,{vertexShader:"attribute vec2 aPos;varying vec2 vPos;uniform float uHeight;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform sampler2D u_sampler;uniform mat4 inverseMatrix;void main(){vPos=aPos;if(uHeight<=0.0){gl_Position=vec4(aPos,0.0,1.0);}else{vec4 gray=texture2D(u_sampler,(aPos+1.0)/2.0);vec4 m0=inverseMatrix*vec4(aPos.xy,0.0,1.0);vec4 m1=inverseMatrix*vec4(aPos.xy,1.0,1.0);m0/=m0.w;m1/=m1.w;vec4 pixel=m0+(-m0.z/(m1.z-m0.z))*(m1-m0);pixel.z=uHeight*gray.a;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pixel.xyz,1.0);}}",fragmentShader:"uniform sampler2D u_sampler;uniform sampler2D u_samplerPalette;uniform float uHeight;uniform float opacity;varying vec2 vPos;void main(){vec4 gray=texture2D(u_sampler,(vPos+1.0)/2.0);float grayAlpha=gray.a;if(grayAlpha<=0.0){discard;}gl_FragColor=texture2D(u_samplerPalette,vec2(grayAlpha,1.0));float addAlpha=1.0;if(gray.a<0.3){addAlpha=gray.a*3.3;}gl_FragColor.a*=addAlpha;gl_FragColor.a*=opacity;}"},this),this.buffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new ds({gl:t,program:this.program,attributes:[{stride:8,name:"aPos",buffer:this.buffer,size:2,type:"FLOAT",offset:0}]}),r=[];for(var i=[],n=Math.floor(t.canvas.width/4),a=Math.floor(t.canvas.height/4),o=n+1,s=0;s<=a;s++)for(var u=0;u<=n;u++)if(r.push(2*u/n-1,2*s/a-1),u<n&&s<a){var l=o*s+u,h=o*(s+1)+u;i.push(l,l+1,h+1),i.push(l,h+1,h)}this.bufferData=r,this.buffer.updateData(new Float32Array(r)),this.indexData=i,this.indexBuffer.updateData(new Uint32Array(i))}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onOptionsChanged",value:function(t,e){var r=this.gl;r&&t.gradient!==e.gradient&&(this.intensity=new w({gradient:t.gradient}),this.paletteTexture=H(r,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}))}},{key:"onDataChanged",value:function(t){if(this.gl){var e=[],r=[];this.getOptions();for(var i=0;i<t.length;i++){var n=t[i],a=this.normizedPoint(t[i].geometry.coordinates),o=void 0===n.count?1:n.count;"properties"in n&&"count"in n.properties&&(o=n.properties.count),e.push(a[0],a[1],a[2]),e.push(-1,-1),e.push(o),e.push(a[0],a[1],a[2]),e.push(-1,1),e.push(o),e.push(a[0],a[1],a[2]),e.push(1,1),e.push(o),e.push(a[0],a[1],a[2]),e.push(1,-1),e.push(o),n=4*i,r.push(n+0,n+2,n+1),r.push(n+0,n+3,n+2)}this.offlineBufferData=e,this.offlineIndexData=r,this.offlineBuffer.updateData(new Float32Array(e)),this.offlineIndexBuffer.updateData(new Uint32Array(r))}}},{key:"render",value:function(t){var e=t.gl,r=t.matrix,i=t.pointToPixelMatrix,n=t.pixelToViewMatrix;if(t=t.projectionMatrix,this.offlineBufferData&&!(0>=this.offlineBufferData.length)){var a=this.getOptions();this.setGLState({blend:!0,blendFunc:[e.ONE,e.ONE],depthTest:!1}),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer.framebuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),this.offlineProgram.use(e),this.offlineProgram.setUniforms({u_matrix:r,uCircle:this.circleTexture,pointToPixelMatrix:i,pixelToViewMatrix:n,projectionMatrix:t,unit:"px"===a.unit?1:0,size:a.size,max:a.max,min:a.min}),this.offlineVertexArray.bind(),this.offlineIndexBuffer.bind(),e.drawElements(e.TRIANGLES,this.offlineIndexData.length,e.UNSIGNED_INT,0),e.bindFramebuffer(e.FRAMEBUFFER,null),this.program.use(e),this.vertexArray.bind(),r=this.inverseMatrix,rs.identity(r),rs.multiply(r,t,n),rs.invert(r,r),this.setGLState({blend:!0,blendFunc:[e.SRC_ALPHA,e.ONE],depthTest:!!a.height}),this.program.setUniforms({u_sampler:this.frameBuffer.framebuffer.texture,u_samplerPalette:this.paletteTexture,uHeight:a.height,opacity:a.opacity,pixelToViewMatrix:n,inverseMatrix:r,projectionMatrix:t}),this.indexBuffer.bind(),e.drawElements(e.TRIANGLES,this.indexData.length,e.UNSIGNED_INT,0)}}}]),e}(Ds),Hh=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="BarLayer",t.selectedColor=[-1,-1,-1],t.textureCache={},t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{color:"rgba(0, 180, 0, 1.0)",edgeCount:4,unit:"m",height:1e5,type:"normal",size:5e4}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),r={normal:["attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aEdgeIndex;attribute float aPointIndex;attribute float aEdgeCount;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vEdgeIndex=aEdgeIndex;vEdgeCount=aEdgeCount;vPointIndex=aPointIndex;float z=aPos.z*uZoomUnits;float x=aPos.x;float y=aPos.y;vSize=aSize*uZoomUnits;float a=radians(360.0/aEdgeCount);float b=a/2.0;float r=vSize/cos(b);if(aEdgeIndex<0.0){float index=aPointIndex;float angle=0.0;if(mod(index,2.0)==0.0){angle=a*(index/2.0)-b;}else{angle=-a*((index-1.0)/2.0)-b;}y=y+r*sin(angle);x=x+r*cos(angle);}else{float i=aEdgeIndex-1.0;float j=aPointIndex;float angle=a*i+b;y=y+r*sin(angle);x=x+r*cos(angle);}vPosition=vec4(aPos,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;if(aEdgeIndex==1.0&&aPointIndex==1.0){gl_PointSize=20.0;}else{gl_PointSize=10.0;}\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}","varying vec4 vColor;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;varying vec4 vPosition;varying vec4 vFragPosition;uniform mat4 uMatrix;void main(){vec4 color=vColor;if(vEdgeIndex<0.0){color.r+=0.2;color.g+=0.2;color.b+=0.2;}else{float i=ceil(vEdgeIndex);;float d=i/vEdgeCount*0.5;if(i<=vEdgeCount/2.0){d=0.2*(i/vEdgeCount*0.5)-0.1;}else{d=0.2*(vEdgeCount-i)/vEdgeCount*0.5-0.1;}color.r+=d;color.g+=d;color.b+=d;}gl_FragColor=color;}"],light:["attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aEdgeIndex;attribute float aPointIndex;attribute float aEdgeCount;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vEdgeIndex=aEdgeIndex;vEdgeCount=aEdgeCount;vPointIndex=aPointIndex;float z=aPos.z*uZoomUnits;float x=aPos.x;float y=aPos.y;vSize=aSize*uZoomUnits;float a=radians(360.0/aEdgeCount);float b=a/2.0;float i=aEdgeIndex;float j=aPointIndex;float angle=a*(i-1.0)+b;float r=vSize/cos(b);y=y+r*sin(angle);x=x+r*cos(angle);if(j==1.0){z=0.0;}vPosition=vec4(aPos.xyz,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;\n#if defined(PICK)\nif(mapvIsPicked()){vColor=uSelectedColor;}\n#endif\n}","varying vec4 vColor;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;varying vec4 vPosition;varying vec4 vFragPosition;uniform mat4 uMatrix;void main(){vec4 color=vColor;color.a=1.0-vFragPosition.z/vPosition.z;gl_FragColor=color;}"]};r=r[e.type]||r.normal,this.program=new us(this.gl,{vertexShader:r[0],fragmentShader:r[1],defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{stride:44,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:44,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:12},{stride:44,name:"aEdgeIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:16},{stride:44,name:"aPointIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:20},{stride:44,name:"aEdgeCount",buffer:this.buffer,size:1,type:"FLOAT",offset:24},{stride:44,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:28}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&e&&(this.uniforms={},this.data=e,this.options=t,this.processData(),t.enablePicked&&this.parsePickData(e))}},{key:"processData",value:function(){var t=[],e=[];"light"===this.options.type?this.createLightBuffer(this.data,t,e):this.createNormalBuffer(this.data,t,e),this.bufferData=t,this.indexData=e,this.buffer.updateData(new Float32Array(t)),this.indexBuffer.updateData(new Uint32Array(e))}},{key:"createNormalBuffer",value:function(t,e,r){var i=this,n=parseInt(this.options.edgeCount,10)||4;t.forEach((function(t,a){var o=t.color||i.options.color,s=t.size||i.options.size,u=Array.isArray(t.value)?t.value:"number"==typeof t.value?[t.value]:[1],l=i.normizedPoint(t.geometry.coordinates),h=t.height||i.options.height,f=u.reduce((function(t,e){return Number(t)+Number(e)})),c=0,d="blue";for(u.forEach((function(t,a){d=i.normizedColor("function"==typeof o?o(t,a,u):Array.isArray(o)?o[a]:o),t="function"==typeof h?h(t,a,u):Array.isArray(h)?h[a]:h/f*t;var v=r[r.length-1],p=e.length/11;for(0<p&&(1==n%2&&0===a?r.push(v,v,p):r.push(v,p)),a=1;a<=2*n;a++)0==a%2?e.push.apply(e,[l[0],l[1],c,s,a/2,2,n].concat(Vi(d))):e.push.apply(e,[l[0],l[1],c+t,s,(a+1)/2,1,n].concat(Vi(d))),r.push(p+a-1),a===2*n&&(e.push.apply(e,[l[0],l[1],c+t,s,a/2+1,1,n].concat(Vi(d))),e.push.apply(e,[l[0],l[1],c,s,a/2+1,2,n].concat(Vi(d))),r.push(p+a,p+a+1));c+=t})),a=r[r.length-1],0<(t=e.length/11)&&r.push(a,t),a=1;a<=n;a++)e.push.apply(e,[l[0],l[1],c,s,-1,a,n].concat(Vi(d))),r.push(t+a-1)}))}},{key:"createLightBuffer",value:function(t,e,r){var i=this,n=parseInt(this.options.edgeCount,10)||4;t.forEach((function(t,a){a=t.color||i.options.color,a=i.normizedColor("function"==typeof a?a(t.value):"string"==typeof a?a:"blue");var o=t.size||i.options.size,s=i.normizedPoint(t.geometry.coordinates),u=t.height||i.options.height;for(u="function"==typeof u?u(t.value):u,t=1;t<=n;t++){var l=r[r.length-1],h=e.length/11;for(0<h&&r.push(l,h),l=1;l<=2*n;l++)0==l%2?e.push.apply(e,[s[0],s[1],u,o,l/2,1,n].concat(Vi(a))):e.push.apply(e,[s[0],s[1],u,o,(l+1)/2,2,n].concat(Vi(a))),r.push(h+l-1),l===2*n&&r.push(h,h+1)}}))}},{key:"render",value:function(t){var e=this.program,r=t.gl,i=t.matrix;this.setGLState({cullFace:"normal"===this.options.type}),e.use(r),this.vertexArray.bind(),this.indexBuffer.bind();var n=this.map.getZoomUnits();ze(this.uniforms,this.getCommonUniforms(t),{uZoomUnits:"px"===this.options.unit?n:1,uMatrix:i}),e.setUniforms(this.uniforms),r.drawElements(r.TRIANGLE_STRIP,this.indexData.length,r.UNSIGNED_INT,0)}}]),e}(Ds),jh=function(t){function e(t){Ut(this,e);var r=mi(this,(e.__proto__||Xe(e)).call(this,t));return t=r.getOptions(),r.fillPoint=new jl({enablePicked:t.enablePicked,autoSelect:t.autoSelect}),r.shadowPoint=new jl,r.textPoint=new Ks,r.children=[r.shadowPoint,r.fillPoint,r.textPoint],r}return Mi(e,t),Ge(e,[{key:"pick",value:function(t,e){return this.fillPoint.pick(t,e)}},{key:"onOptionsChanged",value:function(t){this.shadowPoint.setOptions({depthTest:!1,polygonOffset:[1,1],color:t.shadowColor,size:t.shadowSize,borderWidth:t.shadowBorderWidth,borderColor:t.shadowBorderColor}),this.fillPoint.setOptions({onClick:function(e){t.onClick&&t.onClick(e)},selectedIndex:t.selectedIndex,selectedColor:t.selectedColor,depthTest:!1,color:t.fillColor,size:t.fillSize,borderWidth:t.fillBorderWidth,borderColor:t.fillBorderColor}),this.textPoint.setOptions({collides:!1,polygonOffset:[-1,-1],color:t.fontColor,fontFamily:t.fontFamily,fontSize:t.fontSize})}},{key:"onDataChanged",value:function(t){var e=this,r=this.getOptions(),i=JSON.parse($i(t)).map((function(t){return t.properties.size=e.getProperty("shadowSize",r.shadowSize,t),t.properties.color=e.getProperty("shadowColor",r.shadowColor,t),t.properties.borderColor=e.getProperty("shadowBorderColor",r.shadowBorderColor,t),t.properties.borderWidth=e.getProperty("shadowBorderWidth",r.shadowBorderWidth,t),t})),n=JSON.parse($i(t)).map((function(t){return t.properties.size=e.getProperty("fillSize",r.fillSize,t),t.properties.color=e.getProperty("fillColor",r.fillColor,t),t.properties.borderColor=e.getProperty("fillBorderColor",r.fillBorderColor,t),t.properties.borderWidth=e.getProperty("fillBorderWidth",r.fillBorderWidth,t),t}));this.shadowPoint.setData(i),this.fillPoint.setData(n),this.textPoint.setData(t)}},{key:"getProperty",value:function(t,e,r){return"[object Function]"===Object.prototype.toString.call(e)?e(r):(e=r[t]||e,"properties"in r&&t in r.properties&&(e=r.properties[t]),e)}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ffff00",autoSelect:!0,fillColor:"rgba(255, 50, 10, 1)",fillSize:20,fillBorderColor:"#ffffff",fillBorderWidth:1.2,shadowColor:"rgba(255, 80, 110, 0.7)",shadowSize:40,shadowBorderColor:"rgba(255, 80, 110, 1)",shadowBorderWidth:1.2,fontSize:12,fontFamily:"Microsoft Yahei",fontColor:"#ffffff"}}}]),e}(Qs),Xh=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="MaskLayer",t.bufferData=[],t.indices=[],t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{blend:"deeper",color:"rgba(100, 100, 100, 0.6)",height:0,polygonOffset:[0,0],depthTest:!1,depthWrite:!1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new us(this.gl,{vertexShader:"precision highp float;attribute vec2 a_position;uniform mat4 u_matrix;uniform float u_height;void main(){vec4 position=u_matrix*vec4(a_position.xy,u_height,1.0);gl_Position=position;}",fragmentShader:"precision highp float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}",defines:[]},this),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var e=[{stride:8,name:"a_position",buffer:this.vertexBuffer,size:2,type:"FLOAT",offset:0}];e=e.concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){this.bufferData=[],this.index=[]}},{key:"onChanged",value:function(t,e){var r=this;if(this.gl){t=[];for(var i=[],n=0;n<e.length;n++)if(e[n].geometry.coordinates){var a=[[this.normizedPoint([-180,-90]),this.normizedPoint([180,-90]),this.normizedPoint([180,90]),this.normizedPoint([-180,90])]],o=[];if("LineString"===e[n].geometry.type&&(o=[e[n].geometry.coordinates.map((function(t){return r.normizedPoint(t)}))]),"MultiPolygon"===e[n].geometry.type)for(var s=e[n].geometry.coordinates,u=0;u<s.length;u++)o=o.concat(s[u].map((function(t){return t.map((function(t){return r.normizedPoint(t)}))})));else for(s=0;s<e[n].geometry.coordinates.length;s++)o.push(e[n].geometry.coordinates[s].map((function(t){return r.normizedPoint(t)})));for(o=W.flatten(a.concat(o)),a=o.vertices,o=o.holes,s=[],u=0;u<a.length;u+=3)s.push(a[u+0],a[u+1]);this.parseBufferData(t,i,s,o)}this.bufferData=t,this.index=i,this.vertexBuffer.updateData(new Float32Array(t)),this.indexBuffer.updateData(new Uint32Array(i))}}},{key:"parseBufferData",value:function(t,e,r,i){var n=t.length/2;for(i=i&&i.length?W(r,i,2):W(r),t.push.apply(t,Vi(r)),t=0;t<i.length;t++)e.push(i[t]+n)}},{key:"render",value:function(t){if(this.index&&this.index.length){var e=t.gl,r=t.matrix,i=this.getOptions(),n=this.program;n.use(e),t=ze(this.getCommonUniforms(t),{u_matrix:r,u_height:i.height,u_color:this.normizedColor(i.color)}),n.setUniforms(t),this.setGLState({blend:!0,blendFunc:X(e,i.blend),polygonOffset:i.polygonOffset,depthTest:i.depthTest,depthMask:i.depthWrite}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)}}}]),e}(Ds),Wh=function(t){function e(){return Ut(this,e),mi(this,(e.__proto__||Xe(e)).apply(this,arguments))}return Mi(e,t),Ge(e,[{key:"toBBox",value:function(t){var e=zi(t.item.geometry.coordinates,2);return{minX:t=e[0],minY:e=e[1],maxX:t,maxY:e}}},{key:"compareMinX",value:function(t,e){return t.item.geometry.coordinates[0]-e.item.geometry.coordinates[0]}},{key:"compareMinY",value:function(t,e){return t.item.geometry.coordinates[1]-e.item.geometry.coordinates[1]}}]),e}(qs),Yh=function(t){function e(t,r){return Ut(this,e),(t=mi(this,(e.__proto__||Xe(e)).call(this,t,r))).name="PointCanvasCustomLayer",r=t.canvas=document.createElement("canvas"),t.ctx=r.getContext("2d"),t.geoRBush=new Wh,t}return Mi(e,t),Ge(e,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,flat:!1,collides:!0,unit:"px",angle:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],itemDimension:[20,20],renderItem:this.defaultOptionRenderItem}}},{key:"defaultOptionRenderItem",value:function(t,e,r){r.fillStyle="red",r.fillRect(e.x,e.y,e.w,e.h)}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new us(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***点A(x,y)，绕原点顺时针旋转角度a新坐标的计算公式*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)+size.x*sin(rotation);}else if(corner==2.0){x+=size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)-size.x*sin(rotation);}else if(corner==3.0){x+=size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)-size.x*sin(rotation);}else{x+=-size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)+size.x*sin(rotation);}return vec3(x,y,coord.z);}void main(){vTextCoord=aTextCoord;if(uFlat){vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}else{vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio*scale;vec3 current=transformCoord(screen,halfSize,corner);current.z+=zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:"precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));\n#if defined(PICK)\nif(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}\n#endif\n}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new fs({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new fs({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=(e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}]).concat(this.getCommonAttributes()),this.vertexArray=new ds({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){for(this.cachedData=[],this.geoRBush.clear(),t=0;t<e.length;t++){var r=e[t],i=this.normizedPoint(r.geometry.coordinates);i&&this.cachedData.push({point:i,item:r,extra:{},index:t})}this.geoRBush.load(this.cachedData)}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,r=t.matrix,i=this.getOptions(),n=this.program;n.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:i.polygonOffset,depthTest:i.depthTest,depthMask:i.depthWrite});var a=this.map.getZoomUnits();n.setUniforms(ze(this.getCommonUniforms(t),{matrix:r,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,uFlat:i.flat,offset:i.offset,zoomUnits:a,zIndex:i.zIndex,uUnitPx:"px"===i.unit})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var e=t.gl,r=t.matrix,i=this.getOptions(),n=i.padding,a=i.margin,o=i.collides;t=i.enablePicked;var s=i.itemDimension,u=i.beforeRenderAll,l=i.beforeComputeDimension;i=i.renderItem;var h=this.map.getBounds(),f=e.canvas.width/window.devicePixelRatio,c=e.canvas.height/window.devicePixelRatio,d=this.canvas;(e=this.ctx).save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),l&&l(e),h=this.geoRBush.search({minX:h.sw.lng,minY:h.sw.lat,maxX:h.ne.lng,maxY:h.ne.lat});var v=new qs;l=[];for(var p=0;p<h.length;p++){var g=h[p],m=g.point,x=g.item,y=g.extra;g=g.index;var b=zi(m,3);b=Qo.clone([b[0],b[1],b[2],1]),Qo.transformMat4(b,b,r),Qo.scale(b,b,1/b[3]);var _=(b[0]+1)/2*f,A=(1-b[1])/2*c,T=Array.isArray(s)?s:s(x,e,y);b=T[0]+2*n[0],T=T[1]+2*n[1];var w=b+a[0],M=T+a[1];if(M=(A-=M/2)+M,!(0>(w=(_-=w/2)+w)||0>M||_>f||A>c)){if(o){if(M={minX:_,maxX:w,minY:A,maxY:M},v.collides(M))continue;v.insert(M)}l.push({w:b,h:T,point:m,item:x,extra:y,dataIndex:g})}}for(e.restore(),0>=(r=(n=vt(l)).w)&&(r=1),0>=(n=n.h)&&(n=1),d.width=r*window.devicePixelRatio,d.height=n*window.devicePixelRatio,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),u&&u(e),u=[],d=[],a=[],o=[],s=0,f=l.length;s<f;++s){for(i((c=l[s]).item,c,e,c.extra),h=(p=zi(c.point,3))[0],v=p[1],p=p[2],m=0;4>m;m++)u.push(h,v,p),u.push(m),u.push(c.w,c.h),u.push(1,0);h=c.x/r,v=(c.x+c.w)/r,p=(c.y+c.h)/n,m=c.y/n,d.push(h,p,h,m,v,m,v,p),h=4*s,a.push(h,h+2,h+1,h,h+3,h+2),t&&(c=this.indexToRgb(c.dataIndex),o.push(c[0]/255,c[1]/255,c[2]/255),o.push(c[0]/255,c[1]/255,c[2]/255),o.push(c[0]/255,c[1]/255,c[2]/255),o.push(c[0]/255,c[1]/255,c[2]/255))}e.restore(),this.loadTexture(),this.index=a,this.vertexBuffer.updateData(new Float32Array(u)),this.uvBuffer.updateData(new Float32Array(d)),this.indexBuffer.updateData(new Uint32Array(a)),t&&this.pickBuffer.updateData(new Float32Array(o))}},{key:"loadTexture",value:function(){var t=this;this.canvas?j(this.gl,this.canvas,(function(e){t.texture=e}),{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),e}(Ds);window._hmt=window._hmt||[],function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?e8002ef3d9e0d8274b5b74cc4a027d08";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}(),t.View=Ls,t.CanvasLayer=r,t.CircleLayer=function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Ut(this,t),zs.includes(e.type)?new ks(e):new Bs(e)},t.GridLayer=$s,t.HeatGridLayer=tu,t.ShapeLayer=Gs,t.SimpleLineLayer=eu,t.LineLayer3D=au,t.LineLayer=uu,t.LineRainbowLayer=lu,t.WallSpriteLayer=fu,t.LinePointLayer=Bl,t.WallLayer=kl,t.WallTripLayer=Il,t.HeatLineLayer=Ul,t.HoneycombLayer=Hl,t.WebglLayer=Ps,t.PointLayer=jl,t.GroundRippleLayer=Xl,t.RippleLayer=Wl,t.SparkLayer=Yl,t.ClusterLayer=Vl,t.HeatPointLayer=Gl,t.ShapeLineLayer=ql,t.PointTripLayer=Ql,t.LineTripLayer=Jl,t.IconCollidesLayer=$l,t.LineFlowLayer=th,t.TileLayer=eh,t.IconLayer=Zl,t.BoardLayer=rh,t.PolygonLayer=ih,t.CarLineLayer=kh,t.Layer=Ds,t.TextLayer=Ks,t.BoardTextLayer=zh,t.LabelLayer=Ih,t.TrafficLayer=Uh,t.GltfLayer=Bh,t.HeatmapLayer=Nh,t.BarLayer=Hh,t.MarkerListLayer=jh,t.MaskLayer=Xh,t.PointCanvasCustomLayer=Yh,t.FXAA=gs,t.SMAA=ms,t.BlurEffect=xs,t.BloomEffect=ys,t.BrightEffect=bs,t.DepthEffect=_s,t.EffectManager=As,t.getContext=N,t.createTexture=H,t.loadTextureImage=j,t.getBlend=X,t.FrameBufferObject=vs,t.Program=us,t.StateManager=hs,t.Buffer=fs,t.VertexArray=ds,t.CommonLayer=Fs,t.MercatorProjection=y,t.Canvas=T,t.Intensity=w,t.BezierCurve=M,t.GeodesicCurve=R,t.OdCurve=mn,t.utilCity={getProvinceNameByCityName:function(t){for(var e=0;e<yn.length;e++)for(var r=yn[e].n,i=yn[e].cities,n=0;n<i.length;n++)if(i[n].n==t)return r;return null},getCenterByCityName:function(t){t=t.replace("市","");for(var e=0;e<xn.length;e++)if(xn[e].n==t)return P(xn[e].g);for(e=0;e<bn.length;e++)if(bn[e].n==t)return P(bn[e].g);for(e=0;e<yn.length;e++){if(yn[e].n==t)return P(yn[e].g);for(var r=yn[e].cities,i=0;i<r.length;i++)if(r[i].n==t)return P(r[i].g)}return null}},t.isMobile=An,t.Encryptor={encode:function(t){t=Uo.deflateRaw(t);for(var e=[],r=0;r<t.length;r++)e.push(23^t[r]);return new Uint8Array(e)},decode:function(t){t=new Uint8Array(t);for(var e=[],r=0;r<t.length;r++)e.push(23^t[r]);t=new Uint8Array(e);try{var i=window.flate.deflate_decode_raw(t);return new TextDecoder("utf-8").decode(i)}catch(cl){return Uo.inflateRaw(t,{to:"string"})}},download:function(t,e){var r=new Blob([t],{type:"application/octet-binary"});t=document.createElement("a"),r=window.URL.createObjectURL(r),t.href=r,t.download=e||"mapvgl_download",t.click()}},t.createFusionView=function(t,e){var r=void 0,i=!1;t.addEventListener("glmoduleloaded",(function(n){i||(i=!0,setTimeout((function(){(r=new Ls({cameraNear:10,cameraFar:4e3,gl:t._webglPainter.gl,canvas:t._webglPainter.gl.canvas,autoUpdate:!1,map:t})).webglLayer.canvas.style.zIndex=1;var i=r.webglLayer.stateManager;t.insertRender=function(){i.setState({blend:!0,depthTest:!1}),r.render()},e&&e(r)}),3e3))})),setTimeout((function(){if(!i&&t._webglMapScene&&t._webglPainter&&t._webglPainter.gl&&t._webglPainter.gl.canvas){i=!0,(r=new Ls({cameraNear:10,cameraFar:4e3,gl:t._webglPainter.gl,canvas:t._webglPainter.gl.canvas,autoUpdate:!1,map:t})).webglLayer.canvas.style.zIndex=1;var n=r.webglLayer.stateManager;t.insertRender=function(){n.setState({blend:!0,depthTest:!1}),r.render()},e&&e(r)}}),4e3)},t.toRadian=d,t.toAngle=v,t.ceilPowerOfTwo=p,t.floorPowerOfTwo=g,t.approximatelyEqual=m,t.isClosed=x,t.__moduleExports=Ko,t.vec4=Qo,t.vec3=Jo,t.vec2=$o,t.quat2=ts,t.quat=es,t.mat4=rs,t.mat3=is,t.mat2d=ns,t.mat2=as,t.glMatrix=os,Object.defineProperty(t,"__esModule",{value:!0})}(r)}(0,r.exports)}}}));
