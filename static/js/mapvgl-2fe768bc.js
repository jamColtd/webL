import{o as ii}from"./@babel-ee6b9e1a.js";var Ks={exports:{}};(function(qf,Qs){(function(D,Bt){Bt(Qs)})(ii,function(D){function Bt(r){this.options=r||{},this.paneName=this.options.paneName||"labelPane",this.zIndex=this.options.zIndex||1,this._map=r.map,this._lastDrawTime=null,this.show()}function tt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function V(r,i){return i={exports:{}},r(i,i.exports),i.exports}function Js(r,i){return function(t){return i(r(t))}}function qs(r){var i=function(t){return t==null?t:(1<arguments.length&&(t=Array.prototype.slice.call(arguments)),r(t))};return"conversion"in r&&(i.conversion=r.conversion),i}function $s(r){var i=function(t){if(t==null)return t;1<arguments.length&&(t=Array.prototype.slice.call(arguments));var e=r(t);if((typeof e=="undefined"?"undefined":It(e))==="object")for(var a=e.length,n=0;n<a;n++)e[n]=Math.round(e[n]);return e};return"conversion"in r&&(i.conversion=r.conversion),i}function pt(r,i){if(!(this instanceof pt))return new pt(r,i);if(i&&i in ga&&(i=null),i&&!(i in Nt))throw Error("Unknown model: "+i);if(typeof r=="undefined")this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(r instanceof pt)this.model=r.model,this.color=r.color.slice(),this.valpha=r.valpha;else if(typeof r=="string"){if(i=Dr.get(r),i===null)throw Error("Unable to parse color from string: "+r);this.model=i.model;var t=Nt[this.model].channels;this.color=i.value.slice(0,t),this.valpha=typeof i.value[t]=="number"?i.value[t]:1}else if(r.length)this.model=i||"rgb",t=Nt[this.model].channels,i=Rn.call(r,0,t),this.color=Wi(i,t),this.valpha=typeof r[t]=="number"?r[t]:1;else if(typeof r=="number")r&=16777215,this.model="rgb",this.color=[r>>16&255,r>>8&255,r&255],this.valpha=1;else{if(this.valpha=1,i=_t(r),"alpha"in r&&(i.splice(i.indexOf("alpha"),1),this.valpha=typeof r.alpha=="number"?r.alpha:0),i=i.sort().join(""),!(i in Pn))throw Error("Unable to parse color from object: "+Pr(r));this.model=Pn[i],t=Nt[this.model].labels;var e=[];for(i=0;i<t.length;i++)e.push(r[t[i]]);this.color=Wi(e)}if(Ri[this.model])for(t=Nt[this.model].channels,i=0;i<t;i++)(r=Ri[this.model][i])&&(this.color[i]=r(this.color[i]));this.valpha=Math.max(0,Math.min(1,this.valpha)),va&&va(this)}function tu(r){return function(i){return Number(i.toFixed(r))}}function ct(r,i,t){return r=Array.isArray(r)?r:[r],r.forEach(function(e){(Ri[e]||(Ri[e]=[]))[i]=t}),r=r[0],function(e){if(arguments.length){t&&(e=t(e));var a=this[r]();return a.color[i]=e,a}return a=this[r]().color[i],t&&(a=t(a)),a}}function xt(r){return function(i){return Math.max(0,Math.min(r,i))}}function Wi(r,i){for(var t=0;t<i;t++)typeof r[t]!="number"&&(r[t]=0);return r}function Et(r){return r*Math.PI/180}function Yi(r){return r/Math.PI*180}function oe(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Zi(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function Vi(r,i){return 1e-8>Math.abs(r-i)}function Gi(r){var i=r[0],t=r[r.length-1];return Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2)+Math.pow((i[2]||0)-(t[2]||0),2))<(1<arguments.length&&arguments[1]!==void 0?arguments[1]:2e-7)}function Lt(){}function Ki(r,i){for(var t in i)r[t]=i[t]}function kt(r,i){this.lng=r,this.lat=i}function go(r,i){this.x=r,this.y=i}function Qi(r,i){var t=document.createElement("canvas");return r&&(t.width=r),i&&(t.height=i),t}function Rt(r){r=r||{},this.gradient=r.gradient||{"0.25":"rgba(0, 0, 255, 1)","0.55":"rgba(0, 255, 0, 1)","0.85":"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=r.maxSize===void 0?35:r.maxSize,this.minSize=r.minSize||0,this.max=r.max||100,this.min=r.min||0,this.initPalette()}function ae(r){this.options=r||{},this._initialize()}function Ji(r,i,t,e,a){var n=1-r,s=1-r;return n*n*n*i+3*s*s*r*t+3*(1-r)*r*r*e+r*r*r*a}function ge(r){this.WORLD_SIZE_MC_HALF=20037726372307256e-9,this.WORLD_SIZE_MC=2*this.WORLD_SIZE_MC_HALF,this.options=r||{},this._initialize()}function mo(r,i){return r&&i?Math.round(Math.sqrt(Math.pow(r.lng-i.lng,2)+Math.pow(r.lat-i.lat,2))):0}function ni(r){return r=r.split("|"),r[0]=r[0].split(","),{lng:parseFloat(r[0][0]),lat:parseFloat(r[0][1])}}function Ge(r){for(var i=r.length;0<=--i;)r[i]=0}function qi(r,i,t,e,a){this.static_tree=r,this.extra_bits=i,this.extra_base=t,this.elems=e,this.max_length=a,this.has_stree=r&&r.length}function $i(r,i){this.dyn_tree=r,this.max_code=0,this.stat_desc=i}function qt(r,i,t,e,a){this.good_length=r,this.max_lazy=i,this.nice_length=t,this.max_chain=e,this.func=a}function eu(){this.strm=null,this.status=0,this.pending_buf=null,this.wrap=this.pending=this.pending_out=this.pending_buf_size=0,this.gzhead=null,this.gzindex=0,this.method=Di,this.last_flush=-1,this.w_mask=this.w_bits=this.w_size=0,this.window=null,this.window_size=0,this.head=this.prev=null,this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Re(this.dyn_ltree),Re(this.dyn_dtree),Re(this.bl_tree),this.bl_desc=this.d_desc=this.l_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Re(this.heap),this.heap_max=this.heap_len=0,this.depth=new Uint16Array(573),Re(this.depth),this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function dr(r){r=this.options=Fi.assign({level:Zl,method:Gl,chunkSize:16384,windowBits:15,memLevel:8,strategy:Vl},r||{}),r.raw&&0<r.windowBits?r.windowBits=-r.windowBits:r.gzip&&0<r.windowBits&&16>r.windowBits&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Na,this.strm.avail_out=0;var i=Nr.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==Bi)throw Error(He[i]);if(r.header&&Nr.deflateSetHeader(this.strm,r.header),r.dictionary){if(r=typeof r.dictionary=="string"?Hr.string2buf(r.dictionary):ja.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=Nr.deflateSetDictionary(this.strm,r),i!==Bi)throw Error(He[i]);this._dict_set=!0}}function tn(r,i){if(i=new dr(i),i.push(r,!0),i.err)throw i.msg||He[i.err];return i.result}function ru(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.total=this.check=this.dmax=this.flags=0,this.head=null,this.wnext=this.whave=this.wsize=this.wbits=0,this.window=null,this.extra=this.offset=this.length=this.bits=this.hold=0,this.distcode=this.lencode=null,this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.distdyn=this.lendyn=null,this.was=this.back=this.sane=0}function vr(r){var i=this.options=Fi.assign({chunkSize:65536,windowBits:15,to:""},r||{});if(i.raw&&0<=i.windowBits&&16>i.windowBits&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),!(0<=i.windowBits&&16>i.windowBits)||r&&r.windowBits||(i.windowBits+=32),15<i.windowBits&&48>i.windowBits&&(i.windowBits&15)===0&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Na,this.strm.avail_out=0,r=fe.inflateInit2(this.strm,i.windowBits),r!==Wr||(this.header=new nh,fe.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=Hr.string2buf(i.dictionary):qa.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(r=fe.inflateSetDictionary(this.strm,i.dictionary),r!==Wr))))throw Error(He[r])}function en(r,i){if(i=new vr(i),i.push(r),i.err)throw i.msg||He[i.err];return i.result}function xo(r,i){for(var t=["webgl2","experimental-webgl2","webgl","experimental-webgl"],e=void 0,a=0;a<t.length;a++)try{if(e=r.getContext(t[a],{stencil:!0,alpha:!0,premultipliedAlpha:!1,antialias:i.antialias||!0,preserveDrawingBuffer:i.preserveDrawingBuffer||!1}))break}catch(n){}return e}function Ke(r,i,t){var e=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};t=G({TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"REPEAT",TEXTURE_WRAP_T:"REPEAT"},t);var a=r.createTexture();if(r.bindTexture(r.TEXTURE_2D,a),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY||!0),e.format&&e.width){var n=r.LUMINANCE;e.format&&(n=r[e.format]),e.format!=="RGBA"&&e.format!=="RGB"?(i=new Float32Array(i),r.texImage2D(r.TEXTURE_2D,0,r.R32F,e.width,e.height,0,r.RED,r[e.type]||r.FLOAT,i)):r.texImage2D(r.TEXTURE_2D,0,n,e.width,e.height,0,n,r[e.type]||r.FLOAT,i)}else r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i);for(var s in t)r.texParameteri(r.TEXTURE_2D,r[s],r[t[s]]);return r.bindTexture(r.TEXTURE_2D,null),{texture:a,data:{width:e.width,height:e.height,data:i,type:e.type}}}function yt(r,i,t,e,a){if((typeof i=="undefined"?"undefined":It(i))==="object")i=Ke(r,i,e,a),t(i.texture,null,i.data);else{var n=new Image;n.crossOrigin="anonymous",n.onload=function(){var s=Zi(n.width),o=Zi(n.height),u=document.createElement("canvas");u.width=s,u.height=o;var f=u.getContext("2d");f.drawImage(n,0,0,s,o),n=u,u=Ke(r,n,e,a).texture,t(u,n,{width:s,height:o,data:f.getImageData(0,0,s,o),type:"RGBA"})},n.src=i}}function Zt(r,i){if(i instanceof Array){var t={zero:r.ZERO,one:r.ONE,src_color:r.SRC_COLOR,one_minus_src_color:r.ONE_MINUS_SRC_COLOR,dst_color:r.DST_COLOR,one_minus_dst_color:r.ONE_MINUS_DST_COLOR,src_alpha:r.SRC_ALPHA,one_minus_src_alpha:r.ONE_MINUS_SRC_ALPHA,dst_alpha:r.DST_ALPHA,one_minus_dst_alpha:r.ONE_MINUS_DST_ALPHA,constant_color:r.CONSTANT_COLOR,one_minus_constant_color:r.ONE_MINUS_CONSTANT_COLOR,constant_alpha:r.CONSTANT_ALPHA,one_minus_constant_alpha:r.ONE_MINUS_CONSTANT_ALPHA,src_alpha_saturate:r.SRC_ALPHA_SATURATE};return i.map(function(e){return t[e]})}switch(i){case"default":return xa?[r.SRC_ALPHA,r.ZERO,r.ONE,r.ZERO]:[r.ONE,r.ZERO];case"deeper":return[r.ONE,r.ONE_MINUS_SRC_ALPHA];case"normal":return[r.SRC_ALPHA,r.ONE];case"lighter":return[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA];default:return[r.ONE,r.ZERO]}}function yo(r,i){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:[],e=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"#ccc",a=4<arguments.length&&arguments[4]!==void 0?arguments[4]:1,n=document.createElement("canvas"),s=n.getContext("2d");n.width=256,n.height=a,n=i[0];var o=i[i.length-1];if(r.length===i.length){for(var u=s.createLinearGradient(0,0,256,1),f=0;f<r.length;++f)u.addColorStop((i[f]-n)/(o-n),r[f]);s.fillStyle=u,s.fillRect(0,0,256,a)}else if(r.length-i.length===-1){u=0,f=1;for(var v=0;v<r.length;++v){var l=Math.floor((i[f]-n)/(o-n)*256);s.fillStyle=r[v],s.fillRect(u,0,l,a),u=l,f++}}else s.fillStyle=e||"#ccc",s.fillRect(0,0,256,a);return-1>=r.length-i.length&&t.length===2&&(s.fillStyle=e||"#ccc",e=(t[0]-n)/(o-n),e=Math.floor(256*e),s.fillRect(0,0,e,a),e=(t[1]-n)/(o-n),e=Math.floor(256*e),s.fillRect(e,0,255,a)),{data:new Uint8Array(new Uint8ClampedArray(s.getImageData(0,0,256,a).data)),width:256,height:a}}function Dt(r,i,t){t=t||2;var e=i&&i.length,a=e?i[0]*t:r.length,n=_o(r,0,a,t,!0),s=[];if(!n||n.next===n.prev)return s;var o;if(e){var u=t;e=[];var f,v=0;for(f=i.length;v<f;v++){var l=i[v]*u,h=v<f-1?i[v+1]*u:r.length;l=_o(r,l,h,u,!1),l===l.next&&(l.steiner=!0),e.push(au(l))}for(e.sort(nu),v=0;v<e.length;v++)u=e[v],i=n,(i=ou(u,i))&&(u=To(i,u),me(i,i.next),me(u,u.next)),n=me(n,n.next)}if(r.length>80*t){var d=o=r[0],c=e=r[1];for(u=t;u<a;u+=t)v=r[u],i=r[u+1],v<d&&(d=v),i<c&&(c=i),v>o&&(o=v),i>e&&(e=i);o=Math.max(o-d,e-c),o=o!==0?1/o:0}return pr(n,s,t,d,c,o),s}function _o(r,i,t,e,a){if(a===0<on(r,i,t,e))for(a=i;a<t;a+=e)var n=wo(a,r[a],r[a+1],n);else for(a=t-e;a>=i;a-=e)n=wo(a,r[a],r[a+1],n);return n&&oi(n,n.next)&&(mr(n),n=n.next),n}function me(r,i){if(!r)return r;i||(i=r);do{var t=!1;if(r.steiner||!oi(r,r.next)&&ht(r.prev,r,r.next)!==0)r=r.next;else{if(mr(r),r=i=r.prev,r===r.next)break;t=!0}}while(t||r!==i);return i}function pr(r,i,t,e,a,n,s){if(r){if(!s&&n){var o=r,u=o;do u.z===null&&(u.z=rn(u.x,u.y,e,a,n)),u.prevZ=u.prev,u=u.nextZ=u.next;while(u!==o);u.prevZ.nextZ=null,u.prevZ=null,o=u;var f,v,l,h,d=1;do{u=o;var c=o=null;for(v=0;u;){v++;var p=u;for(f=l=0;f<d&&(l++,p=p.nextZ,p);f++);for(h=d;0<l||0<h&&p;)l!==0&&(h===0||!p||u.z<=p.z)?(f=u,u=u.nextZ,l--):(f=p,p=p.nextZ,h--),c?c.nextZ=f:o=f,f.prevZ=c,c=f;u=p}c.nextZ=null,d*=2}while(1<v)}for(o=r;r.prev!==r.next;){if(u=r.prev,p=r.next,n)c=iu(r,e,a,n);else t:if(c=r,v=c.prev,l=c,d=c.next,0<=ht(v,l,d))c=!1;else{for(f=c.next.next;f!==c.prev;){if(Qe(v.x,v.y,l.x,l.y,d.x,d.y,f.x,f.y)&&0<=ht(f.prev,f,f.next)){c=!1;break t}f=f.next}c=!0}if(c)i.push(u.i/t),i.push(r.i/t),i.push(p.i/t),mr(r),o=r=p.next;else if(r=p,r===o){if(!s)pr(me(r),i,t,e,a,n,1);else if(s===1){r=me(r),s=i,o=t,u=r;do p=u.prev,c=u.next.next,!oi(p,c)&&Ao(p,u,u.next,c)&&gr(p,c)&&gr(c,p)&&(s.push(p.i/o),s.push(u.i/o),s.push(c.i/o),mr(u),mr(u.next),u=r=c),u=u.next;while(u!==r);r=me(u),pr(r,i,t,e,a,n,2)}else if(s===2)t:{s=r;do{for(o=s.next.next;o!==s.prev;){if(u=s.i!==o.i){if(u=s,p=o,c=u.next.i!==p.i&&u.prev.i!==p.i){e:{c=u;do{if(c.i!==u.i&&c.next.i!==u.i&&c.i!==p.i&&c.next.i!==p.i&&Ao(c,c.next,u,p)){c=!0;break e}c=c.next}while(c!==u);c=!1}c=!c}if(c){if(c=gr(u,p)&&gr(p,u)){c=u,v=!1,l=(u.x+p.x)/2,d=(u.y+p.y)/2;do c.y>d!=c.next.y>d&&c.next.y!==c.y&&l<(c.next.x-c.x)*(d-c.y)/(c.next.y-c.y)+c.x&&(v=!v),c=c.next;while(c!==u);c=v}c=c&&(ht(u.prev,u,p.prev)||ht(u,p.prev,p))||oi(u,p)&&0<ht(u.prev,u,u.next)&&0<ht(p.prev,p,p.next)}u=c}if(u){r=To(s,o),s=me(s,s.next),r=me(r,r.next),pr(s,i,t,e,a,n),pr(r,i,t,e,a,n);break t}o=o.next}s=s.next}while(s!==r)}break}}}}function iu(r,i,t,e){var a=r.prev,n=r.next;if(0<=ht(a,r,n))return!1;var s=a.x>r.x?a.x>n.x?a.x:n.x:r.x>n.x?r.x:n.x,o=a.y>r.y?a.y>n.y?a.y:n.y:r.y>n.y?r.y:n.y,u=rn(a.x<r.x?a.x<n.x?a.x:n.x:r.x<n.x?r.x:n.x,a.y<r.y?a.y<n.y?a.y:n.y:r.y<n.y?r.y:n.y,i,t,e);for(i=rn(s,o,i,t,e),t=r.prevZ,e=r.nextZ;t&&t.z>=u&&e&&e.z<=i;){if(t!==r.prev&&t!==r.next&&Qe(a.x,a.y,r.x,r.y,n.x,n.y,t.x,t.y)&&0<=ht(t.prev,t,t.next)||(t=t.prevZ,e!==r.prev&&e!==r.next&&Qe(a.x,a.y,r.x,r.y,n.x,n.y,e.x,e.y)&&0<=ht(e.prev,e,e.next)))return!1;e=e.nextZ}for(;t&&t.z>=u;){if(t!==r.prev&&t!==r.next&&Qe(a.x,a.y,r.x,r.y,n.x,n.y,t.x,t.y)&&0<=ht(t.prev,t,t.next))return!1;t=t.prevZ}for(;e&&e.z<=i;){if(e!==r.prev&&e!==r.next&&Qe(a.x,a.y,r.x,r.y,n.x,n.y,e.x,e.y)&&0<=ht(e.prev,e,e.next))return!1;e=e.nextZ}return!0}function nu(r,i){return r.x-i.x}function ou(r,i){var t=i,e=r.x,a=r.y,n=-1/0;do{if(a<=t.y&&a>=t.next.y&&t.next.y!==t.y){var s=t.x+(a-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(s<=e&&s>n){if(n=s,s===e){if(a===t.y)return t;if(a===t.next.y)return t.next}var o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==i);if(!o)return null;if(e===n)return o;i=o,s=o.x;var u=o.y,f=1/0;t=o;do{if(e>=t.x&&t.x>=s&&e!==t.x&&Qe(a<u?e:n,a,s,u,a<u?n:e,a,t.x,t.y)){var v=Math.abs(a-t.y)/(e-t.x),l;if((l=gr(t,r))&&!(l=v<f)&&(l=v===f)&&!(l=t.x>o.x)&&(l=t.x===o.x)){l=o;var h=t;l=0>ht(l.prev,l,h.prev)&&0>ht(h.next,l,l.next)}l&&(o=t,f=v)}t=t.next}while(t!==i);return o}function rn(r,i,t,e,a){return r=32767*(r-t)*a,i=32767*(i-e)*a,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,(r|r<<1)&1431655765|((i|i<<1)&1431655765)<<1}function au(r){var i=r,t=r;do(i.x<t.x||i.x===t.x&&i.y<t.y)&&(t=i),i=i.next;while(i!==r);return t}function Qe(r,i,t,e,a,n,s,o){return 0<=(a-s)*(i-o)-(r-s)*(n-o)&&0<=(r-s)*(e-o)-(t-s)*(i-o)&&0<=(t-s)*(n-o)-(a-s)*(e-o)}function ht(r,i,t){return(i.y-r.y)*(t.x-i.x)-(i.x-r.x)*(t.y-i.y)}function oi(r,i){return r.x===i.x&&r.y===i.y}function Ao(r,i,t,e){var a=si(ht(r,i,t)),n=si(ht(r,i,e)),s=si(ht(t,e,r)),o=si(ht(t,e,i));return!!(a!==n&&s!==o||a===0&&ai(r,t,i)||n===0&&ai(r,e,i)||s===0&&ai(t,r,e)||o===0&&ai(t,i,e))}function ai(r,i,t){return i.x<=Math.max(r.x,t.x)&&i.x>=Math.min(r.x,t.x)&&i.y<=Math.max(r.y,t.y)&&i.y>=Math.min(r.y,t.y)}function si(r){return 0<r?1:0>r?-1:0}function gr(r,i){return 0>ht(r.prev,r,r.next)?0<=ht(r,i,r.next)&&0<=ht(r,r.prev,i):0>ht(r,i,r.prev)||0>ht(r,r.next,i)}function To(r,i){var t=new nn(r.i,r.x,r.y),e=new nn(i.i,i.x,i.y),a=r.next,n=i.prev;return r.next=i,i.prev=r,t.next=a,a.prev=t,e.next=t,t.prev=e,n.next=e,e.prev=n,e}function wo(r,i,t,e){return r=new nn(r,i,t),e?(r.next=e.next,r.prev=e,e.next.prev=r,e.next=r):(r.prev=r,r.next=r),r}function mr(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function nn(r,i,t){this.i=r,this.x=i,this.y=t,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function on(r,i,t,e){for(var a=0,n=t-e;i<t;i+=e)a+=(r[n]-r[i])*(r[i+1]+r[n+1]),n=i;return a}function Mo(r){try{return Ii.createObjectURL(new Blob([r],{type:"application/javascript"}))}catch(t){var i=new Dh;return i.append(r),Ii.createObjectURL(i.getBlob(type))}}function Oe(r,i){this.shapeLayer=r,this.gl=i,this.initData()}function Eo(r,i,t,e){var a=[];return e=e*Math.PI/180,a[0]=(r-t[0])*Math.cos(e)-(i-t[1])*Math.sin(e)+t[0],a[1]=(r-t[0])*Math.sin(e)+(i-t[1])*Math.cos(e)+t[1],a}function xe(r){var i=0,t=0,e=!0,a=!1,n=void 0;try{for(var s=er(r),o;!(e=(o=s.next()).done);e=!0){var u=o.value;i+=u.w*u.h,t=Math.max(t,u.w)}}catch(p){a=!0,n=p}finally{try{!e&&s.return&&s.return()}finally{if(a)throw n}}r.sort(function(p,m){return m.h-p.h}),t=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),t),h:1/0}],a=e=0,n=!0,s=!1,o=void 0;try{for(var f=er(r),v;!(n=(v=f.next()).done);n=!0)for(var l=v.value,h=t.length-1;0<=h;h--){var d=t[h];if(!(l.w>d.w||l.h>d.h)){if(l.x=d.x,l.y=d.y,a=Math.max(a,l.y+l.h),e=Math.max(e,l.x+l.w),l.w===d.w&&l.h===d.h){var c=t.pop();h<t.length&&(t[h]=c)}else l.h===d.h?(d.x+=l.w,d.w-=l.w):(l.w!==d.w&&t.push({x:d.x+l.w,y:d.y,w:d.w-l.w,h:l.h}),d.y+=l.h,d.h-=l.h);break}}}catch(p){s=!0,o=p}finally{try{!n&&f.return&&f.return()}finally{if(s)throw o}}return{w:e,h:a,fill:i/(e*a)||0}}function jt(r,i){var t=[];return r.forEach(function(e){t.push(i?-e:e,e)}),t}function Co(r){for(var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,t=[],e=0;e<r-1;e++){var a=2*(e+i);t.push(a,a+1,a+2),t.push(a+2,a+1,a+3)}return t}function ui(r){return function(i,t,e){return i=t+r,t=e.length-1,e[0<t?0>i?0:i>t?t:i:i<t?t:0<i?0:i]}}function $t(r){if(!r[0]||!r[0].length)return r;for(var i=r[0].length,t=[],e=0,a=0;a<r.length;a++)for(var n=0;n<i;n++)t[e++]=r[a][n];return t}function Ro(){for(var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],i=[],t=0,e=0;e<r.length;e++){var a=r[e];if(0<e){var n=r[e-1];t+=Math.sqrt(Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2))}i.push(t)}return{arr:i,total:t}}function Po(){var r=document.createElement("canvas");r.width=r.height=32;var i=r.getContext("2d");return{canvas:r,ctx:i}}function So(){var r=(0<arguments.length&&arguments[0]!==void 0?arguments[0]:{}).color,i=Po(),t=i.canvas;return i=i.ctx,i.save(),i.moveTo(0,0),i.lineTo(20,0),i.lineTo(32,16),i.lineTo(20,32),i.lineTo(0,32),i.lineTo(10,16),i.fillStyle=r||"#fff",i.fill(),i.restore(),t}function li(r,i){return q.set(r,-i[1],i[0])}function Lo(r,i,t){return q.sub(r,i,t),q.normalize(r,r),r}function su(r){var i,t;this.promise=new r(function(e,a){if(i!==void 0||t!==void 0)throw TypeError("Bad Promise constructor");i=e,t=a}),this.resolve=Ie(i),this.reject=Ie(t)}function uu(r,i,t){return t=Math.PI/180*(60*t+30),[r.x+i*Math.cos(t),r.y+i*Math.sin(t)]}function lu(r,i,t){for(var e={},a=[],n=r.length,s=i/2/Math.sin(Math.PI/3),o=1.5*s,u=1,f=0;f<n;++f){var v=r[f].geometry.coordinates;t&&(v=t(v));var l=+v[0],h=+v[1];if(!isNaN(l)&&!isNaN(h)){v=Math.round(h/=o);var d=Math.round(l=l/i-(v&1)/2),c=h-v;if(1<3*Math.abs(c)){var p=l-d,m=d+(l<d?-1:1)/2,g=v+(h<v?-1:1);l-=m,h-=g,p*p+c*c>l*l+h*h&&(d=m+(v&1?1:-1)/2,v=g)}c=d+"-"+v,(p=e[c])?(p.count+=r[f].count||1,u=Math.max(u,p.count)):(e[c]={center:{x:(d+(v&1)/2)*i,y:v*o},count:r[f].count||1},a.push(e[c]))}}return a.max=u,a.r=s,a}function hu(r,i,t,e){switch(e){case 5122:return new Int16Array(r,i,t);case 5123:return new Uint16Array(r,i,t);case 5124:return new Int32Array(r,i,t);case 5125:return new Uint32Array(r,i,t);case 5126:return new Float32Array(r,i,t);default:return null}}function hi(r){return hu(r.bufferView.data,r.byteOffset,r.count*co[r.type],r.componentType)}function fu(r){var i="",t=r.lastIndexOf("/");return t!==-1&&(i=r.substring(0,t+1)),i}function cu(r,i){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",r,!0),t.onreadystatechange=function(){t.readyState==4&&t.status=="200"&&i(t.responseText,this)},t.send(null)}function du(r,i){var t=new XMLHttpRequest;t.responseType="arraybuffer",t.open("GET",r,!0),t.onreadystatechange=function(){if(t.readyState==4&&t.status=="200"){var e=t.response;e&&i&&i(e)}},t.send(null)}function vu(r,i,t){var e=new Image;e.crossOrigin="Anonymous",e.src=r,e.onload=function(){t(e,i)}}function pu(r){function i(C,F){t.uniform1i(C,F.index),t.activeTexture(t.TEXTURE0+F.index),C=T.glTF.textures[F.index],t.bindTexture(t.TEXTURE_2D,C.texture),t.bindSampler(F.index,C.sampler?C.sampler.sampler:s)}var t=r.gl,e=0,a=[];r=t.canvas;var n=function(C,F,Z){for(this.glTFScene=C,this.glTF=F,this.id=Z,this.rootTransform=b.create(),this.nodeMatrix=Array(F.nodes.length),C=0,F=this.nodeMatrix.length;C<F;C++)this.nodeMatrix[C]=b.create()},s=t.createSampler();t.samplerParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_LINEAR),t.samplerParameteri(s,t.TEXTURE_MAG_FILTER,t.LINEAR),t.samplerParameteri(s,t.TEXTURE_WRAP_S,t.REPEAT),t.samplerParameteri(s,t.TEXTURE_WRAP_T,t.REPEAT),t.bindVertexArray(null),t.bindVertexArray(null);var o={HAS_SKIN:1,SKIN_VEC8:2,HAS_BASECOLORMAP:4,HAS_NORMALMAP:8,HAS_METALROUGHNESSMAP:16,HAS_OCCLUSIONMAP:32,HAS_EMISSIVEMAP:64},u={},f=function(){this.flags=0,this.programObject=null};f.prototype.hasSkin=function(){return this.flags&o.HAS_SKIN},f.prototype.hasBaseColorMap=function(){return this.flags&o.HAS_BASECOLORMAP},f.prototype.hasNormalMap=function(){return this.flags&o.HAS_NORMALMAP},f.prototype.hasMetalRoughnessMap=function(){return this.flags&o.HAS_METALROUGHNESSMAP},f.prototype.hasOcclusionMap=function(){return this.flags&o.HAS_OCCLUSIONMAP},f.prototype.hasEmissiveMap=function(){return this.flags&o.HAS_EMISSIVEMAP},f.prototype.defineMacro=function(C){o[C]!==void 0&&(this.flags|=o[C])},f.prototype.compile=function(){var C=u[this.flags];if(C)this.programObject=C;else{var F=C="";this.flags&o.HAS_SKIN&&(C+=`#define HAS_SKIN
`),this.flags&o.SKIN_VEC8&&(C+=`#define SKIN_VEC8
`),this.flags&o.HAS_BASECOLORMAP&&(F+=`#define HAS_BASECOLORMAP
`),this.flags&o.HAS_NORMALMAP&&(F+=`#define HAS_NORMALMAP
`),this.flags&o.HAS_METALROUGHNESSMAP&&(F+=`#define HAS_METALROUGHNESSMAP
`),this.flags&o.HAS_OCCLUSIONMAP&&(F+=`#define HAS_OCCLUSIONMAP
`),this.flags&o.HAS_EMISSIVEMAP&&(F+=`#define HAS_EMISSIVEMAP
`),C=cr.createProgram(t,`#version 300 es
`+C+`#define POSITION_LOCATION 0
#define NORMAL_LOCATION 1
#define TEXCOORD_0_LOCATION 2
#define JOINTS_0_LOCATION 3
#define JOINTS_1_LOCATION 5
#define WEIGHTS_0_LOCATION 4
#define WEIGHTS_1_LOCATION 6
#define TANGENT_LOCATION 7
precision highp float;precision highp int;uniform mat4 u_MVP;uniform mat4 u_MV;uniform mat4 u_MVNormal;
#ifdef HAS_SKIN
uniform JointMatrix{mat4 matrix[65];}u_jointMatrix;
#endif
layout(location=POSITION_LOCATION)in vec3 position;layout(location=NORMAL_LOCATION)in vec3 normal;layout(location=TEXCOORD_0_LOCATION)in vec2 uv;
#ifdef HAS_SKIN
layout(location=JOINTS_0_LOCATION)in vec4 joint0;layout(location=WEIGHTS_0_LOCATION)in vec4 weight0;
#ifdef SKIN_VEC8
layout(location=JOINTS_1_LOCATION)in vec4 joint1;layout(location=WEIGHTS_1_LOCATION)in vec4 weight1;
#endif
#endif
out vec3 v_position;out vec3 v_normal;out vec2 v_uv;void main(){
#ifdef HAS_SKIN
mat4 skinMatrix=weight0.x*u_jointMatrix.matrix[int(joint0.x)]+weight0.y*u_jointMatrix.matrix[int(joint0.y)]+weight0.z*u_jointMatrix.matrix[int(joint0.z)]+weight0.w*u_jointMatrix.matrix[int(joint0.w)];
#ifdef SKIN_VEC8
skinMatrix+=weight1.x*u_jointMatrix.matrix[int(joint1.x)]+weight1.y*u_jointMatrix.matrix[int(joint1.y)]+weight1.z*u_jointMatrix.matrix[int(joint1.z)]+weight1.w*u_jointMatrix.matrix[int(joint1.w)];
#endif
#endif
v_uv=uv;
#ifdef HAS_SKIN
v_normal=normalize((u_MVNormal*transpose(inverse(skinMatrix))*vec4(normal,0)).xyz);vec4 pos=u_MV*skinMatrix*vec4(position,1.0);gl_Position=u_MVP*skinMatrix*vec4(position,1.0);
#else
v_normal=normalize((u_MVNormal*vec4(normal,0)).xyz);vec4 pos=u_MV*vec4(position,1.0);gl_Position=u_MVP*vec4(position,1.0);
#endif
v_position=vec3(pos.xyz)/pos.w;}`,`#version 300 es
`+F+`#define FRAG_COLOR_LOCATION 0
precision highp float;precision highp int;uniform sampler2D u_brdfLUT;uniform vec4 u_baseColorFactor;
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_baseColorTexture;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_normalTexture;uniform float u_normalTextureScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_emissiveTexture;uniform vec3 u_emissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_metallicRoughnessTexture;
#endif
uniform float u_metallicFactor;uniform float u_roughnessFactor;
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_occlusionTexture;uniform float u_occlusionStrength;
#endif
in vec3 v_position;in vec3 v_normal;in vec2 v_uv;layout(location=FRAG_COLOR_LOCATION)out vec4 frag_color;struct PBRInfo{float NdotL;float NdotV;float NdotH;float LdotH;float VdotH;float perceptualRoughness;float metalness;vec3 reflectance0;vec3 reflectance90;float alphaRoughness;vec3 diffuseColor;vec3 specularColor;};const float M_PI=3.141592653589793;const float c_MinRoughness=0.04;vec3 getNormal(){vec3 pos_dx=dFdx(v_position);vec3 pos_dy=dFdy(v_position);vec3 tex_dx=dFdx(vec3(v_uv,0.0));vec3 tex_dy=dFdy(vec3(v_uv,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=v_normal;t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));mat3 tbn=mat3(t,b,ng);
#ifdef HAS_NORMALMAP
vec3 n=texture(u_normalTexture,v_uv).rgb;n=normalize(tbn*((2.0*n-1.0)*vec3(u_normalTextureScale,u_normalTextureScale,1.0)));
#else
vec3 n=tbn[2].xyz;
#endif
return n;}vec3 getIBLContribution(PBRInfo pbrInputs,vec3 n,vec3 reflection){float mipCount=10.0;float lod=(pbrInputs.perceptualRoughness*mipCount);vec3 brdf=texture(u_brdfLUT,vec2(pbrInputs.NdotV,1.0-pbrInputs.perceptualRoughness)).rgb;vec3 diffuseLight=vec3(0.6,0.6,0.6);vec3 specularLight=vec3(0.6,0.6,0.6);vec3 diffuse=diffuseLight*pbrInputs.diffuseColor;vec3 specular=specularLight*(pbrInputs.specularColor*brdf.x+brdf.y);return diffuse+specular;}vec3 diffuse(PBRInfo pbrInputs){return pbrInputs.diffuseColor/M_PI;}vec3 specularReflection(PBRInfo pbrInputs){return pbrInputs.reflectance0+(pbrInputs.reflectance90-pbrInputs.reflectance0)*pow(clamp(1.0-pbrInputs.VdotH,0.0,1.0),5.0);}float geometricOcclusion(PBRInfo pbrInputs){float NdotL=pbrInputs.NdotL;float NdotV=pbrInputs.NdotV;float r=pbrInputs.alphaRoughness;float attenuationL=2.0*NdotL/(NdotL+sqrt(r*r+(1.0-r*r)*(NdotL*NdotL)));float attenuationV=2.0*NdotV/(NdotV+sqrt(r*r+(1.0-r*r)*(NdotV*NdotV)));return attenuationL*attenuationV;}float microfacetDistribution(PBRInfo pbrInputs){float roughnessSq=pbrInputs.alphaRoughness*pbrInputs.alphaRoughness;float f=(pbrInputs.NdotH*roughnessSq-pbrInputs.NdotH)*pbrInputs.NdotH+1.0;return roughnessSq/(M_PI*f*f);}void main(){float perceptualRoughness=u_roughnessFactor;float metallic=u_metallicFactor;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample=texture(u_metallicRoughnessTexture,v_uv);perceptualRoughness=mrSample.g*perceptualRoughness;metallic=mrSample.b*metallic;
#endif
perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;
#ifdef HAS_BASECOLORMAP
vec4 baseColor=texture(u_baseColorTexture,v_uv)*u_baseColorFactor;
#else
vec4 baseColor=u_baseColorFactor;
#endif
vec3 f0=vec3(0.04);vec3 diffuseColor=baseColor.rgb*(vec3(1.0)-f0);diffuseColor*=1.0-metallic;vec3 specularColor=mix(f0,baseColor.rgb,metallic);float reflectance=max(max(specularColor.r,specularColor.g),specularColor.b);float reflectance90=clamp(reflectance*25.0,0.0,1.0);vec3 specularEnvironmentR0=specularColor.rgb;vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;vec3 n=getNormal();vec3 v=normalize(-v_position);vec3 l=normalize(vec3(1.0,1.0,1.0));vec3 h=normalize(l+v);vec3 reflection=-normalize(reflect(v,n));float NdotL=clamp(dot(n,l),0.001,1.0);float NdotV=abs(dot(n,v))+0.001;float NdotH=clamp(dot(n,h),0.0,1.0);float LdotH=clamp(dot(l,h),0.0,1.0);float VdotH=clamp(dot(v,h),0.0,1.0);PBRInfo pbrInputs=PBRInfo(NdotL,NdotV,NdotH,LdotH,VdotH,perceptualRoughness,metallic,specularEnvironmentR0,specularEnvironmentR90,alphaRoughness,diffuseColor,specularColor);vec3 F=specularReflection(pbrInputs);float G=geometricOcclusion(pbrInputs);float D=microfacetDistribution(pbrInputs);vec3 diffuseContrib=(1.0-F)*diffuse(pbrInputs);vec3 specContrib=max(vec3(0.0),F*G*D/(4.0*NdotL*NdotV));vec3 color=NdotL*(diffuseContrib+specContrib);color+=getIBLContribution(pbrInputs,n,reflection);
#ifdef HAS_OCCLUSIONMAP
float ao=texture(u_occlusionTexture,v_uv).r;color=mix(color,color*ao,u_occlusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive=texture(u_emissiveTexture,v_uv).rgb*u_emissiveFactor;color+=emissive;
#endif
frag_color=vec4(color,baseColor.a);}`),this.programObject={program:C,uniformLocations:{},uniformBlockIndices:{}},this.flags&o.HAS_SKIN&&(this.programObject.uniformBlockIndices.JointMatrix=t.getUniformBlockIndex(C,"JointMatrix")),F=this.programObject.uniformLocations,F.MVP=t.getUniformLocation(C,"u_MVP"),F.MVNormal=t.getUniformLocation(C,"u_MVNormal"),F.MV=t.getUniformLocation(C,"u_MV"),F.baseColorFactor=t.getUniformLocation(C,"u_baseColorFactor"),F.metallicFactor=t.getUniformLocation(C,"u_metallicFactor"),F.roughnessFactor=t.getUniformLocation(C,"u_roughnessFactor"),this.flags&o.HAS_BASECOLORMAP&&(F.baseColorTexture=t.getUniformLocation(C,"u_baseColorTexture")),this.flags&o.HAS_NORMALMAP&&(F.normalTexture=t.getUniformLocation(C,"u_normalTexture"),F.normalTextureScale=t.getUniformLocation(C,"u_normalTextureScale")),this.flags&o.HAS_METALROUGHNESSMAP&&(F.metallicRoughnessTexture=t.getUniformLocation(C,"u_metallicRoughnessTexture")),this.flags&o.HAS_OCCLUSIONMAP&&(F.occlusionTexture=t.getUniformLocation(C,"u_occlusionTexture"),F.occlusionStrength=t.getUniformLocation(C,"u_occlusionStrength")),this.flags&o.HAS_EMISSIVEMAP&&(F.emissiveTexture=t.getUniformLocation(C,"u_emissiveTexture"),F.emissiveFactor=t.getUniformLocation(C,"u_emissiveFactor")),t.useProgram(null),u[this.flags]=this.programObject}};var v=1,l=j.create(),h=b.create();zi.create();var d=[];t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW);var c=!0;t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL);var p=p||{},m=null;j.create();var g=b.create();b.perspective(g,.785,r.width/r.height,.01,100),b.create();var x=b.create(),y=b.create(),_=b.create();b.create();var A,T,w=[1,1,1,1],E=p.drawPrimitive=function(C,F){if(H){y=x=H.matrix,b.invert(_,x),b.transpose(_,_),F=w;var Z=C.shader,Y=C.material;if(Y!==null){var B=Y.pbrMetallicRoughness;F=B.baseColorFactor,C.material.doubleSided===c&&((c=!C.material.doubleSided)?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE))}m!=C.shader.programObject&&(m=C.shader.programObject,t.useProgram(m.program)),Y&&(Z.hasBaseColorMap()&&i(m.uniformLocations.baseColorTexture,B.baseColorTexture),Z.hasNormalMap()&&(i(m.uniformLocations.normalTexture,Y.normalTexture),t.uniform1f(m.uniformLocations.normalTextureScale,Y.normalTexture.scale)),Z.hasMetalRoughnessMap()&&i(m.uniformLocations.metallicRoughnessTexture,B.metallicRoughnessTexture),t.uniform1f(m.uniformLocations.metallicFactor,B.metallicFactor),t.uniform1f(m.uniformLocations.roughnessFactor,B.roughnessFactor),Z.hasOcclusionMap()&&(i(m.uniformLocations.occlusionTexture,Y.occlusionTexture),t.uniform1f(m.uniformLocations.occlusionStrength,Y.occlusionTexture.strength)),Z.hasEmissiveMap()&&(i(m.uniformLocations.emissiveTexture,Y.emissiveTexture),t.uniform3fv(m.uniformLocations.emissiveFactor,Y.emissiveFactor))),Z.hasSkin()&&t.uniformBlockBinding(m.program,m.uniformBlockIndices.JointMatrix,A),t.activeTexture(t.TEXTURE0+29),t.bindTexture(t.TEXTURE_2D,null),t.uniform4fv(m.uniformLocations.baseColorFactor,F),t.uniformMatrix4fv(m.uniformLocations.MV,!1,x),t.uniformMatrix4fv(m.uniformLocations.MVP,!1,y),t.uniformMatrix4fv(m.uniformLocations.MVNormal,!1,_),t.bindVertexArray(C.vertexArray),C.indices!==null?t.drawElements(C.mode,C.indicesLength,C.indicesComponentType,C.indicesOffset):t.drawArrays(C.mode,C.drawArraysOffset,C.drawArraysCount),t.bindVertexArray(null)}},M=b.create(),P=b.create(),R=p.drawNode=function(C,F,Z,Y){if(F=Z[F],Y!==void 0?b.mul(F,Y,C.matrix):b.copy(F,C.matrix),C.skin!==null){var B=C.skin;A=B.uniformBlockID;var Yt=C.skin.joints;for(b.invert(P,F),Y=0,ut=Yt.length;Y<ut;Y++){var st=Yt[Y];b.mul(M,Z[st.nodeID],B.inverseBindMatrix[Y]),b.mul(M,P,M),B.jointMatrixUnidormBufferData.set(M,16*Y)}t.bindBuffer(t.UNIFORM_BUFFER,B.jointMatrixUniformBuffer),t.bufferSubData(t.UNIFORM_BUFFER,0,B.jointMatrixUnidormBufferData,0,B.jointMatrixUnidormBufferData.length)}var ut;if(C.mesh!==null)for(B=C.mesh,Y=0,ut=B.primitives.length;Y<ut;Y++)E(B.primitives[Y],F);for(C.skin!==null&&t.bindBuffer(t.UNIFORM_BUFFER,null),Y=0,ut=C.children.length;Y<ut;Y++)R(C.children[Y],C.children[Y].nodeID,Z,F)},L=p.drawScene=function(C){var F=C.glTF;if(F.animations){var Z=F.animations[e],Y,B=0;for(Y=Z.samplers.length;B<Y;B++)Z.samplers[B].getValue(k);for(B=0,Y=Z.channels.length;B<Y;B++){var Yt=Z.channels[B],st=Yt.sampler,ut=F.nodes[Yt.target.nodeID];switch(Yt.target.path){case"rotation":ft.copy(ut.rotation,st.curValue);break;case"translation":j.copy(ut.translation,st.curValue);break;case"scale":j.copy(ut.scale,st.curValue)}ut.updateMatrixFromTRS()}}for(Z=0,F=C.glTFScene.nodes.length;Z<F;Z++)R(C.glTFScene.nodes[Z],C.glTFScene.nodes[Z].nodeID,C.nodeMatrix,C.rootTransform)},S=performance.now(),k=0,H;return{setupScene:function(C,F){function Z(po,Jf){if(po!==void 0){var ri=po.bufferView;return ri.target===null?(t.bindBuffer(t.ARRAY_BUFFER,ri.buffer),t.bufferData(t.ARRAY_BUFFER,ri.data,t.STATIC_DRAW)):t.bindBuffer(ri.target,ri.buffer),po.prepareVertexAttrib(Jf,t),!0}return!1}var Y;if(C.animations){var B=0;for(Y=C.animations.length;B<Y;B++)a.add(C.animations[B].name||B)}e=0,B=C.scenes[C.defaultScene],j.fromValues(1.2*B.boundingBox.transform[0],0,0),j.create(),F?F=d[F.id]=new n(B,C,F.id):(F=new n(B,C,d.length),d.push(F)),d.length===1&&(b.identity(h),v=1/Math.max(B.boundingBox.transform[0],Math.max(B.boundingBox.transform[5],B.boundingBox.transform[10])),b.getTranslation(l,B.boundingBox.transform),j.scale(l,l,-1),l[0]+=-.5*B.boundingBox.transform[0],l[1]+=-.5*B.boundingBox.transform[5],l[2]+=-.5*B.boundingBox.transform[10],v*=.5,h[0]=v,h[5]=v,h[10]=v,b.translate(h,h,l),j.set(l,0,0,-1.5),v=1);var Yt;for(B=0,Y=C.bufferViews.length;B<Y;B++){var st=C.bufferViews[B];st.createBuffer(t),st.bindData(t)}if(C.textures)for(B=0,Y=C.textures.length;B<Y;B++){var ut=C.textures[B];ut.createTexture(t)}if(C.samplers)for(B=0,Y=C.samplers.length;B<Y;B++)ut=C.samplers[B],ut.createSampler(t);if(C.skins)for(B=0,Y=C.skins.length;B<Y;B++)ut=C.skins[B],ut.jointMatrixUniformBuffer=t.createBuffer(),t.bindBufferBase(t.UNIFORM_BUFFER,ut.uniformBlockID,ut.jointMatrixUniformBuffer),t.bindBuffer(t.UNIFORM_BUFFER,ut.jointMatrixUniformBuffer),t.bufferData(t.UNIFORM_BUFFER,ut.jointMatrixUnidormBufferData,t.DYNAMIC_DRAW),t.bufferSubData(t.UNIFORM_BUFFER,0,ut.jointMatrixUnidormBufferData),t.bindBuffer(t.UNIFORM_BUFFER,null);var vo=0;for(Yt=C.meshes.length;vo<Yt;vo++)for(ut=C.meshes[vo],B=0,Y=ut.primitives.length;B<Y;++B){var mt=ut.primitives[B];mt.shader=new f,mt.vertexArray=st=t.createVertexArray(),t.bindVertexArray(st),Z(mt.attributes.POSITION,0),Z(mt.attributes.NORMAL,1),Z(mt.attributes.TEXCOORD_0,2),Z(mt.attributes.JOINTS_0,3)&&Z(mt.attributes.WEIGHTS_0,4)&&mt.shader.defineMacro("HAS_SKIN"),Z(mt.attributes.JOINTS_1,5)&&Z(mt.attributes.WEIGHTS_1,6)&&mt.shader.defineMacro("SKIN_VEC8"),mt.indices!==null&&(st=C.accessors[mt.indices],st=st.bufferView,st.target===null?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,st.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,st.data,t.STATIC_DRAW)):t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,st.buffer)),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),(st=mt.material)&&(st.pbrMetallicRoughness.baseColorTexture&&mt.shader.defineMacro("HAS_BASECOLORMAP"),st.pbrMetallicRoughness.metallicRoughnessTexture&&mt.shader.defineMacro("HAS_METALROUGHNESSMAP"),st.normalTexture&&mt.shader.defineMacro("HAS_NORMALMAP"),st.occlusionTexture&&mt.shader.defineMacro("HAS_OCCLUSIONMAP"),st.emissiveTexture&&mt.shader.defineMacro("HAS_EMISSIVEMAP")),mt.shader.compile()}return F},render:p.render=function(C){H=C,C=new Date().getTime();var F,Z=0;for(F=d.length;Z<F;Z++)T=d[Z],L(d[Z]);m=null,k=.001*(C-S)}}}function gu(r,i,t,e,a,n){if(typeof i=="string"&&typeof t=="number"&&typeof e=="number")for(i=i.split(n),n=0;n<i.length;n++)r.fillText(i[n],t,e),e+=a}function dt(r){this.options=r=r||{},r.colors=r.colors||["rgba(0,192,73,0.99609375)","rgba(242,48,48,0.99609375)","rgba(255,159,25,0.99609375)"];var i=r.colors;this.drawTogether=!0,this.parseColors(i),this.tileSize=256,this.ratio=window.devicePixelRatio,this.cache={},r.getTileUrl&&(this.getTileUrl=r.getTileUrl),this._loadCount={}}function mu(r){var i=r/2,t=r+i,e=new Qi(2*t,2*t),a=e.getContext("2d");return a.shadowBlur=i,a.shadowColor="black",a.shadowOffsetX=a.shadowOffsetY=1e4,a.beginPath(),a.arc(t-1e4,t-1e4,r,0,2*Math.PI,!0),a.closePath(),a.fill(),e}var an=window.BMapGL||window.BMap;an&&an.Overlay&&(Bt.prototype=new an.Overlay),Bt.prototype.initialize=function(r){this._map=r;var i=this.canvas=document.createElement("canvas"),t=this.ctx=this.canvas.getContext("2d");i.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";",this.adjustSize(),this.adjustRatio(t),r.getContainer().appendChild(i);var e=this;return r.addEventListener("resize",function(){e.adjustSize(),e._draw()}),this.canvas},Bt.prototype.adjustSize=function(){var r=this._map.getSize(),i=this.canvas;i.width=r.width,i.height=r.height,i.style.width=i.width+"px",i.style.height=i.height+"px"},Bt.prototype.adjustRatio=function(r){var i=(window.devicePixelRatio||1)/(r.backingStorePixelRatio||r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1),t=r.canvas.width,e=r.canvas.height;r.canvas.width=t*i,r.canvas.height=e*i,r.canvas.style.width=t+"px",r.canvas.style.height=e+"px",r.scale(i,i)},Bt.prototype.draw=function(){this._draw.apply(this,arguments)},Bt.prototype._draw=function(){this.dispatchEvent("draw"),this.options.update&&this.options.update.apply(this,arguments)},Bt.prototype.getContainer=function(){return this.canvas},Bt.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},Bt.prototype.hide=function(){this.canvas.style.display="none"},Bt.prototype.setZIndex=function(r){this.canvas.style.zIndex=r},Bt.prototype.getZIndex=function(){return this.zIndex};var Do=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof ii!="undefined"?ii:typeof self!="undefined"?self:{},xu=V(function(r,i){i.__esModule=!0,i.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}}),O=tt(xu),ye=function(r){if(r==null)throw TypeError("Can't call method on  "+r);return r},yu={}.hasOwnProperty,at=function(r,i){return yu.call(r,i)},_u={}.toString,ze=function(r){return _u.call(r).slice(8,-1)},sn=Object("z").propertyIsEnumerable(0)?Object:function(r){return ze(r)=="String"?r.split(""):Object(r)},te=function(r){return sn(ye(r))},Au=Math.ceil,Tu=Math.floor,un=function(r){return isNaN(r=+r)?0:(0<r?Tu:Au)(r)},wu=Math.min,fi=function(r){return 0<r?wu(un(r),9007199254740991):0},Mu=Math.max,Eu=Math.min,it=V(function(r){r=r.exports={version:"2.6.5"},typeof __e=="number"&&(__e=r)}),$=V(function(r){r=r.exports=typeof window!="undefined"&&Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")(),typeof __g=="number"&&(__g=r)}),xr=V(function(r){var i=$["__core-js_shared__"]||($["__core-js_shared__"]={});(r.exports=function(t,e){return i[t]||(i[t]=e!==void 0?e:{})})("versions",[]).push({version:it.version,mode:"pure",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),Cu=0,Ru=Math.random(),ci=function(r){return"Symbol(".concat(r===void 0?"":r,")_",(++Cu+Ru).toString(36))},Fo=xr("keys"),ln=function(r){return Fo[r]||(Fo[r]=ci(r))},Pu=function(r){return function(i,t,e){i=te(i);var a=fi(i.length);if(e=un(e),e=0>e?Mu(e+a,0):Eu(e,a),r&&t!=t){for(;a>e;)if(t=i[e++],t!=t)return!0}else for(;a>e;e++)if((r||e in i)&&i[e]===t)return r||e||0;return!r&&-1}}(!1),Su=ln("IE_PROTO"),Bo=function(r,i){r=te(r);var t=0,e=[],a;for(a in r)a!=Su&&at(r,a)&&e.push(a);for(;i.length>t;)at(r,a=i[t++])&&(~Pu(e,a)||e.push(a));return e},di="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Je=Object.keys||function(r){return Bo(r,di)},Ie=function(r){if(typeof r!="function")throw TypeError(r+" is not a function!");return r},Tt=function(r,i,t){if(Ie(r),i===void 0)return r;switch(t){case 1:return function(e){return r.call(i,e)};case 2:return function(e,a){return r.call(i,e,a)};case 3:return function(e,a,n){return r.call(i,e,a,n)}}return function(){return r.apply(i,arguments)}},Pt=function(r){return typeof r=="object"?r!==null:typeof r=="function"},Ft=function(r){if(!Pt(r))throw TypeError(r+" is not an object!");return r},_e=function(r){try{return!!r()}catch(i){return!0}},Ht=!_e(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),qe=$.document,vi=Pt(qe)&&Pt(qe.createElement),Oo=!Ht&&!_e(function(){return Object.defineProperty(vi?qe.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),yr=function(r,i){if(!Pt(r))return r;var t,e;if(i&&typeof(t=r.toString)=="function"&&!Pt(e=t.call(r))||typeof(t=r.valueOf)=="function"&&!Pt(e=t.call(r))||!i&&typeof(t=r.toString)=="function"&&!Pt(e=t.call(r)))return e;throw TypeError("Can't convert object to primitive value")},Lu=Object.defineProperty,Ut={f:Ht?Object.defineProperty:function(r,i,t){if(Ft(r),i=yr(i,!0),Ft(t),Oo)try{return Lu(r,i,t)}catch(e){}if("get"in t||"set"in t)throw TypeError("Accessors not supported!");return"value"in t&&(r[i]=t.value),r}},Ae=function(r,i){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:i}},se=Ht?function(r,i,t){return Ut.f(r,i,Ae(1,t))}:function(r,i,t){return r[i]=t,r},St=function(r,i,t){var e=r&St.F,a=r&St.G,n=r&St.S,s=r&St.P,o=r&St.B,u=r&St.W,f=a?it:it[i]||(it[i]={}),v=f.prototype;n=a?$:n?$[i]:($[i]||{}).prototype;var l;a&&(t=i);for(l in t)if(i=!e&&n&&n[l]!==void 0,!i||!at(f,l)){var h=i?n[l]:t[l];f[l]=a&&typeof n[l]!="function"?t[l]:o&&i?Tt(h,$):u&&n[l]==h?function(d){var c=function(p,m,g){if(this instanceof d){switch(arguments.length){case 0:return new d;case 1:return new d(p);case 2:return new d(p,m)}return new d(p,m,g)}return d.apply(this,arguments)};return c.prototype=d.prototype,c}(h):s&&typeof h=="function"?Tt(Function.call,h):h,s&&((f.virtual||(f.virtual={}))[l]=h,r&St.R&&v&&!v[l]&&se(v,l,h))}};St.F=1,St.G=2,St.S=4,St.P=8,St.B=16,St.W=32,St.U=64,St.R=128;var N=St,pi=function(r,i){var t=(it.Object||{})[r]||Object[r],e={};e[r]=i(t),N(N.S+N.F*_e(function(){t(1)}),"Object",e)};pi("keys",function(){return function(r){return Je(Object(ye(r)))}});var Du=it.Object.keys,Fu=V(function(r){r.exports={default:Du,__esModule:!0}}),_t=tt(Fu),hn=Object.getOwnPropertySymbols,gi={}.propertyIsEnumerable,mi=Object.assign,Bu=!mi||_e(function(){var r={},i={},t=Symbol();return r[t]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){i[e]=e}),mi({},r)[t]!=7||Object.keys(mi({},i)).join("")!="abcdefghijklmnopqrst"})?function(r,i){for(var t=Object(ye(r)),e=arguments.length,a=1,n=hn,s=gi;e>a;)for(var o=sn(arguments[a++]),u=n?Je(o).concat(n(o)):Je(o),f=u.length,v=0,l;f>v;)s.call(o,l=u[v++])&&(t[l]=o[l]);return t}:mi;N(N.S+N.F,"Object",{assign:Bu});var Ou=it.Object.assign,zu=V(function(r){r.exports={default:Ou,__esModule:!0}}),G=tt(zu),zo=ln("IE_PROTO"),Iu=Object.prototype,Io=Object.getPrototypeOf||function(r){return r=Object(ye(r)),at(r,zo)?r[zo]:typeof r.constructor=="function"&&r instanceof r.constructor?r.constructor.prototype:r instanceof Object?Iu:null};pi("getPrototypeOf",function(){return function(r){return Io(Object(ye(r)))}});var bu=it.Object.getPrototypeOf,_r=V(function(r){r.exports={default:bu,__esModule:!0}}),U=tt(_r);N(N.S+N.F*!Ht,"Object",{defineProperty:Ut.f});var ku=it.Object,Uu=function(r,i,t){return ku.defineProperty(r,i,t)},ue=V(function(r){r.exports={default:Uu,__esModule:!0}}),gt=tt(ue),Nu=V(function(r,i){i.__esModule=!0;var t=ue&&ue.__esModule?ue:{default:ue};i.default=function(){function e(a,n){for(var s=0;s<n.length;s++){var o=n[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,t.default)(a,o.key,o)}}return function(a,n,s){return n&&e(a.prototype,n),s&&e(a,s),a}}()}),z=tt(Nu),ee={},ju=Ht?Object.defineProperties:function(r,i){Ft(r);for(var t=Je(i),e=t.length,a=0,n;e>a;)Ut.f(r,n=t[a++],i[n]);return r},bo=$.document,fn=bo&&bo.documentElement,Hu=ln("IE_PROTO"),cn=function(){},xi=function(){var r=vi?qe.createElement("iframe"):{},i=di.length;for(r.style.display="none",fn.appendChild(r),r.src="javascript:",r=r.contentWindow.document,r.open(),r.write("<script>document.F=Object<\/script>"),r.close(),xi=r.F;i--;)delete xi.prototype[di[i]];return xi()},Te=Object.create||function(r,i){if(r!==null){cn.prototype=Ft(r);var t=new cn;cn.prototype=null,t[Hu]=r}else t=xi();return i===void 0?t:ju(t,i)},At=V(function(r){var i=xr("wks"),t=$.Symbol,e=typeof t=="function";(r.exports=function(a){return i[a]||(i[a]=e&&t[a]||(e?t:ci)("Symbol."+a))}).store=i}),Xu=Ut.f,ko=At("toStringTag"),be=function(r,i,t){r&&!at(r=t?r:r.prototype,ko)&&Xu(r,ko,{configurable:!0,value:i})},Uo={};se(Uo,At("iterator"),function(){return this});var Wu=function(r,i,t){r.prototype=Te(Uo,{next:Ae(1,t)}),be(r,i+" Iterator")},dn=At("iterator"),vn=!([].keys&&"next"in[].keys()),Yu=function(){return this},pn=function(r,i,t,e,a,n,s){Wu(t,i,e),e=function(g){return!vn&&g in v?v[g]:function(){return new t(this,g)}};var o=i+" Iterator",u=a=="values",f=!1,v=r.prototype,l=v[dn]||v["@@iterator"]||a&&v[a],h=l||e(a),d=a?u?e("entries"):h:void 0,c=i=="Array"&&v.entries||l,p;if(c&&(r=Io(c.call(new r)),r!==Object.prototype&&r.next&&be(r,o,!0)),u&&l&&l.name!=="values"&&(f=!0,h=function(){return l.call(this)}),s&&(vn||f||!v[dn])&&se(v,dn,h),ee[i]=h,ee[o]=Yu,a){var m={values:u?h:e("values"),keys:n?h:e("keys"),entries:d};if(s)for(p in m)p in v||se(v,p,m[p]);else N(N.P+N.F*(vn||f),i,m)}return m},Zu=function(r){return function(i,t){i=String(ye(i)),t=un(t);var e=i.length,a;if(0>t||t>=e)return r?"":void 0;var n=i.charCodeAt(t);return 55296>n||56319<n||t+1===e||56320>(a=i.charCodeAt(t+1))||57343<a?r?i.charAt(t):n:r?i.slice(t,t+2):(n-55296<<10)+(a-56320)+65536}}(!0);pn(String,"String",function(r){this._t=String(r),this._i=0},function(){var r=this._t,i=this._i;return i>=r.length?{value:void 0,done:!0}:(r=Zu(r,i),this._i+=r.length,{value:r,done:!1})});var we=function(r,i){return{value:i,done:!!r}};pn(Array,"Array",function(r,i){this._t=te(r),this._i=0,this._k=i},function(){var r=this._t,i=this._k,t=this._i++;return!r||t>=r.length?(this._t=void 0,we(1)):i=="keys"?we(0,t):i=="values"?we(0,r[t]):we(0,[t,r[t]])},"values"),ee.Arguments=ee.Array;for(var No=At("toStringTag"),jo="CSSRuleList CSSStyleDeclaration CSSValueList ClientRectList DOMRectList DOMStringList DOMTokenList DataTransferItemList FileList HTMLAllCollection HTMLCollection HTMLFormElement HTMLSelectElement MediaList MimeTypeArray NamedNodeMap NodeList PaintRequestList Plugin PluginArray SVGLengthList SVGNumberList SVGPathSegList SVGPointList SVGStringList SVGTransformList SourceBufferList StyleSheetList TextTrackCueList TextTrackList TouchList".split(" "),gn=0;gn<jo.length;gn++){var mn=jo[gn],Ho=$[mn],xn=Ho&&Ho.prototype;xn&&!xn[No]&&se(xn,No,mn),ee[mn]=ee.Array}var yi={f:At},Vu=yi.f("iterator"),Ar=V(function(r){r.exports={default:Vu,__esModule:!0}});tt(Ar);var _i=V(function(r){var i=ci("meta"),t=Ut.f,e=0,a=Object.isExtensible||function(){return!0},n=!_e(function(){return a(Object.preventExtensions({}))}),s=function(u){t(u,i,{value:{i:"O"+ ++e,w:{}}})},o=r.exports={KEY:i,NEED:!1,fastKey:function(u,f){if(!Pt(u))return typeof u=="symbol"?u:(typeof u=="string"?"S":"P")+u;if(!at(u,i)){if(!a(u))return"F";if(!f)return"E";s(u)}return u[i].i},getWeak:function(u,f){if(!at(u,i)){if(!a(u))return!0;if(!f)return!1;s(u)}return u[i].w},onFreeze:function(u){return n&&o.NEED&&a(u)&&!at(u,i)&&s(u),u}}}),Gu=Ut.f,yn=function(r){var i=it.Symbol||(it.Symbol={});r.charAt(0)=="_"||r in i||Gu(i,r,{value:yi.f(r)})},_n=Array.isArray||function(r){return ze(r)=="Array"},Ku=di.concat("length","prototype"),Xo=Object.getOwnPropertyNames||function(r){return Bo(r,Ku)},Wo=Xo,Qu={}.toString,Yo=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Zo=function(r){if(Yo&&Qu.call(r)=="[object Window]")try{var i=Wo(r)}catch(t){i=Yo.slice()}else i=Wo(te(r));return i},Vo=Object.getOwnPropertyDescriptor,Ai={f:Ht?Vo:function(r,i){if(r=te(r),i=yr(i,!0),Oo)try{return Vo(r,i)}catch(t){}if(at(r,i))return Ae(!gi.call(r,i),r[i])}},Ju=_i.KEY,Go=Ai.f,ke=Ut.f,Ko=Zo,Ot=$.Symbol,Ti=$.JSON,wi=Ti&&Ti.stringify,zt=At("_hidden"),Qo=At("toPrimitive"),qu={}.propertyIsEnumerable,Tr=xr("symbol-registry"),le=xr("symbols"),wr=xr("op-symbols"),Vt=Object.prototype,$e=typeof Ot=="function",An=$.QObject,Tn=!An||!An.prototype||!An.prototype.findChild,wn=Ht&&_e(function(){return Te(ke({},"a",{get:function(){return ke(this,"a",{value:7}).a}})).a!=7})?function(r,i,t){var e=Go(Vt,i);e&&delete Vt[i],ke(r,i,t),e&&r!==Vt&&ke(Vt,i,e)}:ke,Jo=function(r){var i=le[r]=Te(Ot.prototype);return i._k=r,i},Mn=$e&&typeof Ot.iterator=="symbol"?function(r){return typeof r=="symbol"}:function(r){return r instanceof Ot},Mi=function(r,i,t){return r===Vt&&Mi(wr,i,t),Ft(r),i=yr(i,!0),Ft(t),at(le,i)?(t.enumerable?(at(r,zt)&&r[zt][i]&&(r[zt][i]=!1),t=Te(t,{enumerable:Ae(0,!1)})):(at(r,zt)||ke(r,zt,Ae(1,{})),r[zt][i]=!0),wn(r,i,t)):ke(r,i,t)},qo=function(r,i){Ft(r);var t=i=te(i),e=Je(t),a=hn;if(a){a=a(t);for(var n=gi,s=0,o;a.length>s;)n.call(t,o=a[s++])&&e.push(o)}t=0,o=e.length;for(var u;o>t;)Mi(r,u=e[t++],i[u]);return r},$u=function(r){var i=qu.call(this,r=yr(r,!0));return this===Vt&&at(le,r)&&!at(wr,r)?!1:i||!at(this,r)||!at(le,r)||at(this,zt)&&this[zt][r]?i:!0},$o=function(r,i){if(r=te(r),i=yr(i,!0),r!==Vt||!at(le,i)||at(wr,i)){var t=Go(r,i);return!t||!at(le,i)||at(r,zt)&&r[zt][i]||(t.enumerable=!0),t}},ta=function(r){r=Ko(te(r));for(var i=[],t=0,e;r.length>t;)at(le,e=r[t++])||e==zt||e==Ju||i.push(e);return i},ea=function(r){var i=r===Vt;r=Ko(i?wr:te(r));for(var t=[],e=0,a;r.length>e;)at(le,a=r[e++])&&(i?at(Vt,a):1)&&t.push(le[a]);return t};$e||(Ot=function(){if(this instanceof Ot)throw TypeError("Symbol is not a constructor!");var r=ci(0<arguments.length?arguments[0]:void 0),i=function(t){this===Vt&&i.call(wr,t),at(this,zt)&&at(this[zt],r)&&(this[zt][r]=!1),wn(this,r,Ae(1,t))};return Ht&&Tn&&wn(Vt,r,{configurable:!0,set:i}),Jo(r)},se(Ot.prototype,"toString",function(){return this._k}),Ai.f=$o,Ut.f=Mi,Xo=Zo=ta,gi=$u,hn=ea,yi.f=function(r){return Jo(At(r))}),N(N.G+N.W+N.F*!$e,{Symbol:Ot});for(var ra="hasInstance isConcatSpreadable iterator match replace search species split toPrimitive toStringTag unscopables".split(" "),ia=0;ra.length>ia;)At(ra[ia++]);for(var na=Je(At.store),oa=0;na.length>oa;)yn(na[oa++]);N(N.S+N.F*!$e,"Symbol",{for:function(r){return at(Tr,r+="")?Tr[r]:Tr[r]=Ot(r)},keyFor:function(r){if(!Mn(r))throw TypeError(r+" is not a symbol!");for(var i in Tr)if(Tr[i]===r)return i},useSetter:function(){Tn=!0},useSimple:function(){Tn=!1}}),N(N.S+N.F*!$e,"Object",{create:function(r,i){return i===void 0?Te(r):qo(Te(r),i)},defineProperty:Mi,defineProperties:qo,getOwnPropertyDescriptor:$o,getOwnPropertyNames:ta,getOwnPropertySymbols:ea}),Ti&&N(N.S+N.F*(!$e||_e(function(){var r=Ot();return wi([r])!="[null]"||wi({a:r})!="{}"||wi(Object(r))!="{}"})),"JSON",{stringify:function(r){for(var i=[r],t=1,e;arguments.length>t;)i.push(arguments[t++]);if(e=t=i[1],(Pt(t)||r!==void 0)&&!Mn(r))return _n(t)||(t=function(a,n){if(typeof e=="function"&&(n=e.call(this,a,n)),!Mn(n))return n}),i[1]=t,wi.apply(Ti,i)}}),Ot.prototype[Qo]||se(Ot.prototype,Qo,Ot.prototype.valueOf),be(Ot,"Symbol"),be(Math,"Math",!0),be($.JSON,"JSON",!0),yn("asyncIterator"),yn("observable");var tl=it.Symbol,Mr=V(function(r){r.exports={default:tl,__esModule:!0}}),aa=tt(Mr),tr=V(function(r,i){i.__esModule=!0,r=Ar&&Ar.__esModule?Ar:{default:Ar};var t=Mr&&Mr.__esModule?Mr:{default:Mr},e=typeof t.default=="function"&&typeof r.default=="symbol"?function(a){return typeof a}:function(a){return a&&typeof t.default=="function"&&a.constructor===t.default&&a!==t.default.prototype?"symbol":typeof a};i.default=typeof t.default=="function"&&e(r.default)==="symbol"?function(a){return typeof a=="undefined"?"undefined":e(a)}:function(a){return a&&typeof t.default=="function"&&a.constructor===t.default&&a!==t.default.prototype?"symbol":typeof a=="undefined"?"undefined":e(a)}}),It=tt(tr),el=V(function(r,i){i.__esModule=!0;var t=tr&&tr.__esModule?tr:{default:tr};i.default=function(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||(typeof a=="undefined"?"undefined":(0,t.default)(a))!=="object"&&typeof a!="function"?e:a}}),X=tt(el),rl=Object.setPrototypeOf||("__proto__"in{}?function(r,i,t){try{t=Tt(Function.call,Ai.f(Object.prototype,"__proto__").set,2),t(r,[]),i=!(r instanceof Array)}catch(e){i=!0}return function(e,a){if(Ft(e),!Pt(a)&&a!==null)throw TypeError(a+": can't set as prototype!");return i?e.__proto__=a:t(e,a),e}}({},!1):void 0);N(N.S,"Object",{setPrototypeOf:rl});var il=it.Object.setPrototypeOf,sa=V(function(r){r.exports={default:il,__esModule:!0}});tt(sa),N(N.S,"Object",{create:Te});var nl=it.Object,ol=function(r,i){return nl.create(r,i)},ua=V(function(r){r.exports={default:ol,__esModule:!0}}),al=tt(ua),sl=V(function(r,i){function t(s){return s&&s.__esModule?s:{default:s}}i.__esModule=!0;var e=t(sa),a=t(ua),n=t(tr);i.default=function(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+(typeof o=="undefined"?"undefined":(0,n.default)(o)));s.prototype=(0,a.default)(o&&o.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),o&&(e.default?(0,e.default)(s,o):s.__proto__=o)}}),W=tt(sl),ul=At("toStringTag"),ll=ze(function(){return arguments}())=="Arguments",Ei=function(r){var i;if(r===void 0)var t="Undefined";else{if(r===null)var e="Null";else{t:{var a=r=Object(r);try{e=a[ul];break t}catch(n){}e=void 0}e=typeof(t=e)=="string"?t:ll?ze(r):(i=ze(r))=="Object"&&typeof r.callee=="function"?"Arguments":i}t=e}return t},hl=At("iterator"),fl=it.isIterable=function(r){return r=Object(r),r[hl]!==void 0||"@@iterator"in r||ee.hasOwnProperty(Ei(r))},Er=V(function(r){r.exports={default:fl,__esModule:!0}});tt(Er);var cl=At("iterator"),En=it.getIteratorMethod=function(r){if(r!=null)return r[cl]||r["@@iterator"]||ee[Ei(r)]},dl=it.getIterator=function(r){var i=En(r);if(typeof i!="function")throw TypeError(r+" is not iterable!");return Ft(i.call(r))},Cr=V(function(r){r.exports={default:dl,__esModule:!0}}),er=tt(Cr),vl=V(function(r,i){i.__esModule=!0;var t=Er&&Er.__esModule?Er:{default:Er},e=Cr&&Cr.__esModule?Cr:{default:Cr};i.default=function(){return function(a,n){if(Array.isArray(a))return a;if((0,t.default)(Object(a))){var s=[],o=!0,u=!1,f=void 0;try{for(var v=(0,e.default)(a),l;!(o=(l=v.next()).done)&&(s.push(l.value),!n||s.length!==n);o=!0);}catch(h){u=!0,f=h}finally{try{!o&&v.return&&v.return()}finally{if(u)throw f}}return s}throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()}),nt=tt(vl),la=function(r,i,t,e){try{return e?i(Ft(t)[0],t[1]):i(t)}catch(a){throw i=r.return,i!==void 0&&Ft(i.call(r)),a}},ha=At("iterator"),fa=Array.prototype,Cn=At("iterator"),ca=!1;try{[7][Cn]().return=function(){ca=!0}}catch(r){}var da=function(r,i){if(!i&&!ca)return!1;var t=!1;try{i=[7];var e=i[Cn]();e.next=function(){return{done:t=!0}},i[Cn]=function(){return e},r(i)}catch(a){}return t};N(N.S+N.F*!da(function(r){}),"Array",{from:function(r){var i=Object(ye(r)),t=typeof this=="function"?this:Array,e=arguments.length,a=1<e?arguments[1]:void 0,n=a!==void 0,s=0,o=En(i),u;if(n&&(a=Tt(a,2<e?arguments[2]:void 0,2)),o!=null&&(t!=Array||o===void 0||ee.Array!==o&&fa[ha]!==o))for(i=o.call(i),t=new t;!(u=i.next()).done;s++)e=t,o=s,u=n?la(i,a,[u.value,s],!0):u.value,o in e?Ut.f(e,o,Ae(0,u)):e[o]=u;else for(e=fi(i.length),t=new t(e);e>s;s++){o=t,u=s;var f=n?a(i[s],s):i[s];u in o?Ut.f(o,u,Ae(0,f)):o[u]=f}return t.length=s,t}});var pl=it.Array.from,Rr=V(function(r){r.exports={default:pl,__esModule:!0}}),Ci=tt(Rr),gl=V(function(r,i){i.__esModule=!0;var t=Rr&&Rr.__esModule?Rr:{default:Rr};i.default=function(e){if(Array.isArray(e)){for(var a=0,n=Array(e.length);a<e.length;a++)n[a]=e[a];return n}return(0,t.default)(e)}}),Q=tt(gl),ml=_i.onFreeze;pi("freeze",function(r){return function(i){return r&&Pt(i)?r(ml(i)):i}});var xl=it.Object.freeze,yl=V(function(r){r.exports={default:xl,__esModule:!0}}),va=tt(yl),pa=it.JSON||(it.JSON={stringify:JSON.stringify}),_l=function(r){return pa.stringify.apply(pa,arguments)},Al=V(function(r){r.exports={default:_l,__esModule:!0}}),Pr=tt(Al),Gt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Tl=Ai.f;pi("getOwnPropertyDescriptor",function(){return function(r,i){return Tl(te(r),i)}});var wl=it.Object,Ml=function(r,i){return wl.getOwnPropertyDescriptor(r,i)},Sr=V(function(r){r.exports={default:Ml,__esModule:!0}}),vt=tt(Sr),Lr=V(function(r){var i=Array.prototype.concat,t=Array.prototype.slice,e=r.exports=function(a){for(var n=[],s=0,o=a.length;s<o;s++){var u=a[s],f=(f=u)&&typeof f!="string"?f instanceof Array||Array.isArray(f)||0<=f.length&&(f.splice instanceof Function||vt(f,f.length-1)&&f.constructor.name!=="String"):!1;f?n=i.call(n,t.call(u)):n.push(u)}return n};e.wrap=function(a){return function(){return a(e(arguments))}}}),Dr=V(function(r){function i(s,o,u){return Math.min(Math.max(o,s),u)}function t(s){return s=s.toString(16).toUpperCase(),2>s.length?"0"+s:s}var e={},a;for(a in Gt)Gt.hasOwnProperty(a)&&(e[Gt[a]]=a);var n=r.exports={to:{},get:{}};n.get=function(s){switch(s.substring(0,3).toLowerCase()){case"hsl":s=n.get.hsl(s);var o="hsl";break;case"hwb":s=n.get.hwb(s),o="hwb";break;default:s=n.get.rgb(s),o="rgb"}return s?{model:o,value:s}:null},n.get.rgb=function(s){if(!s)return null;var o=/^#([a-f0-9]{3,4})$/i,u=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,f=/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,v=/(\D+)/,l=[0,0,0,1],h;if(h=s.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(o=h[2],h=h[1],s=0;3>s;s++)u=2*s,l[s]=parseInt(h.slice(u,u+2),16);o&&(l[3]=Math.round(parseInt(o,16)/255*100)/100)}else if(h=s.match(o)){for(h=h[1],o=h[3],s=0;3>s;s++)l[s]=parseInt(h[s]+h[s],16);o&&(l[3]=Math.round(parseInt(o+o,16)/255*100)/100)}else if(h=s.match(u)){for(s=0;3>s;s++)l[s]=parseInt(h[s+1],0);h[4]&&(l[3]=parseFloat(h[4]))}else if(h=s.match(f)){for(s=0;3>s;s++)l[s]=Math.round(2.55*parseFloat(h[s+1]));h[4]&&(l[3]=parseFloat(h[4]))}else return(h=s.match(v))?h[1]==="transparent"?[0,0,0,0]:(l=Gt[h[1]],l?(l[3]=1,l):null):null;for(s=0;3>s;s++)l[s]=i(l[s],0,255);return l[3]=i(l[3],0,1),l},n.get.hsl=function(s){if(!s)return null;var o=s.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(o){var u=parseFloat(o[4]);s=(parseFloat(o[1])+360)%360;var f=i(parseFloat(o[2]),0,100);return o=i(parseFloat(o[3]),0,100),u=i(isNaN(u)?1:u,0,1),[s,f,o,u]}return null},n.get.hwb=function(s){if(!s)return null;var o=s.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(o){var u=parseFloat(o[4]);s=(parseFloat(o[1])%360+360)%360;var f=i(parseFloat(o[2]),0,100);return o=i(parseFloat(o[3]),0,100),u=i(isNaN(u)?1:u,0,1),[s,f,o,u]}return null},n.to.hex=function(){var s=Lr(arguments);return"#"+t(s[0])+t(s[1])+t(s[2])+(1>s[3]?t(Math.round(255*s[3])):"")},n.to.rgb=function(){var s=Lr(arguments);return 4>s.length||s[3]===1?"rgb("+Math.round(s[0])+", "+Math.round(s[1])+", "+Math.round(s[2])+")":"rgba("+Math.round(s[0])+", "+Math.round(s[1])+", "+Math.round(s[2])+", "+s[3]+")"},n.to.rgb.percent=function(){var s=Lr(arguments),o=Math.round(s[0]/255*100),u=Math.round(s[1]/255*100),f=Math.round(s[2]/255*100);return 4>s.length||s[3]===1?"rgb("+o+"%, "+u+"%, "+f+"%)":"rgba("+o+"%, "+u+"%, "+f+"%, "+s[3]+")"},n.to.hsl=function(){var s=Lr(arguments);return 4>s.length||s[3]===1?"hsl("+s[0]+", "+s[1]+"%, "+s[2]+"%)":"hsla("+s[0]+", "+s[1]+"%, "+s[2]+"%, "+s[3]+")"},n.to.hwb=function(){var s=Lr(arguments),o="";return 4<=s.length&&s[3]!==1&&(o=", "+s[3]),"hwb("+s[0]+", "+s[1]+"%, "+s[2]+"%"+o+")"},n.to.keyword=function(s){return e[s.slice(0,3)]}}),Ue=V(function(r){var i={};for(a in Gt)Gt.hasOwnProperty(a)&&(i[Gt[a]]=a);var t=r.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},e;for(e in t)if(t.hasOwnProperty(e)){if(!("channels"in t[e]))throw Error("missing channels property: "+e);if(!("labels"in t[e]))throw Error("missing channel labels property: "+e);if(t[e].labels.length!==t[e].channels)throw Error("channel and label counts mismatch: "+e);r=t[e].channels;var a=t[e].labels;delete t[e].channels,delete t[e].labels,Object.defineProperty(t[e],"channels",{value:r}),Object.defineProperty(t[e],"labels",{value:a})}t.rgb.hsl=function(n){var s=n[0]/255,o=n[1]/255,u=n[2]/255;n=Math.min(s,o,u);var f=Math.max(s,o,u),v=f-n,l;return f===n?l=0:s===f?l=(o-u)/v:o===f?l=2+(u-s)/v:u===f&&(l=4+(s-o)/v),l=Math.min(60*l,360),0>l&&(l+=360),s=(n+f)/2,[l,100*(f===n?0:.5>=s?v/(f+n):v/(2-f-n)),100*s]},t.rgb.hsv=function(n){var s,o=n[0]/255,u=n[1]/255,f=n[2]/255,v=Math.max(o,u,f),l=v-Math.min(o,u,f);if(l===0)var h=s=0;else{s=l/v,n=(v-o)/6/l+.5;var d=(v-u)/6/l+.5;l=(v-f)/6/l+.5,o===v?h=l-d:u===v?h=1/3+n-l:f===v&&(h=2/3+d-n),0>h?h+=1:1<h&&--h}return[360*h,100*s,100*v]},t.rgb.hwb=function(n){var s=n[0],o=n[1],u=n[2];n=t.rgb.hsl(n)[0];var f=1/255*Math.min(s,Math.min(o,u));return u=1-1/255*Math.max(s,Math.max(o,u)),[n,100*f,100*u]},t.rgb.cmyk=function(n){var s=n[0]/255,o=n[1]/255;n=n[2]/255;var u=Math.min(1-s,1-o,1-n);return[100*((1-s-u)/(1-u)||0),100*((1-o-u)/(1-u)||0),100*((1-n-u)/(1-u)||0),100*u]},t.rgb.keyword=function(n){var s=i[n];if(s)return s;s=1/0;var o;for(o in Gt)if(Gt.hasOwnProperty(o)){var u=Gt[o];if(u=Math.pow(n[0]-u[0],2)+Math.pow(n[1]-u[1],2)+Math.pow(n[2]-u[2],2),u<s){s=u;var f=o}}return f},t.keyword.rgb=function(n){return Gt[n]},t.rgb.xyz=function(n){var s=n[0]/255,o=n[1]/255;return n=n[2]/255,s=.04045<s?Math.pow((s+.055)/1.055,2.4):s/12.92,o=.04045<o?Math.pow((o+.055)/1.055,2.4):o/12.92,n=.04045<n?Math.pow((n+.055)/1.055,2.4):n/12.92,[100*(.4124*s+.3576*o+.1805*n),100*(.2126*s+.7152*o+.0722*n),100*(.0193*s+.1192*o+.9505*n)]},t.rgb.lab=function(n){var s=t.rgb.xyz(n);n=s[0];var o=s[1];return s=s[2],n/=95.047,o/=100,s/=108.883,n=.008856<n?Math.pow(n,1/3):7.787*n+16/116,o=.008856<o?Math.pow(o,1/3):7.787*o+16/116,s=.008856<s?Math.pow(s,1/3):7.787*s+16/116,[116*o-16,500*(n-o),200*(o-s)]},t.hsl.rgb=function(n){var s=n[0]/360,o=n[1]/100;if(n=n[2]/100,o===0){var u=255*n;return[u,u,u]}o=.5>n?n*(1+o):n+o-n*o,n=2*n-o;for(var f=[0,0,0],v=0;3>v;v++)u=s+1/3*-(v-1),0>u&&u++,1<u&&u--,u=1>6*u?n+6*(o-n)*u:1>2*u?o:2>3*u?n+(o-n)*(2/3-u)*6:n,f[v]=255*u;return f},t.hsl.hsv=function(n){var s=n[0],o=n[1]/100;n=n[2]/100;var u=o,f=Math.max(n,.01);return n*=2,o*=1>=n?n:2-n,u*=1>=f?f:2-f,[s,100*(n===0?2*u/(f+u):2*o/(n+o)),(n+o)/2*100]},t.hsv.rgb=function(n){var s=n[0]/60,o=n[1]/100;n=n[2]/100;var u=Math.floor(s)%6,f=s-Math.floor(s);s=255*n*(1-o);var v=255*n*(1-o*f);switch(o=255*n*(1-o*(1-f)),n*=255,u){case 0:return[n,o,s];case 1:return[v,n,s];case 2:return[s,n,o];case 3:return[s,v,n];case 4:return[o,s,n];case 5:return[n,s,v]}},t.hsv.hsl=function(n){var s=n[0],o=n[1]/100;n=n[2]/100;var u=Math.max(n,.01),f=(2-o)*u;return u=o*u/(1>=f?f:2-f)||0,[s,100*u,(2-o)*n/2*100]},t.hwb.rgb=function(n){var s=n[0]/360,o=n[1]/100;n=n[2]/100;var u=o+n;switch(1<u&&(o/=u,n/=u),u=Math.floor(6*s),n=1-n,s=6*s-u,(u&1)!==0&&(s=1-s),s=o+s*(n-o),u){default:case 6:case 0:u=n;var f=s;break;case 1:u=s,f=n;break;case 2:u=o,f=n,o=s;break;case 3:u=o,f=s,o=n;break;case 4:u=s,f=o,o=n;break;case 5:u=n,f=o,o=s}return[255*u,255*f,255*o]},t.cmyk.rgb=function(n){var s=n[3]/100;return[255*(1-Math.min(1,n[0]/100*(1-s)+s)),255*(1-Math.min(1,n[1]/100*(1-s)+s)),255*(1-Math.min(1,n[2]/100*(1-s)+s))]},t.xyz.rgb=function(n){var s=n[0]/100,o=n[1]/100,u=n[2]/100;n=3.2406*s+-1.5372*o+-.4986*u;var f=-.9689*s+1.8758*o+.0415*u;return s=.0557*s+-.204*o+1.057*u,n=.0031308<n?1.055*Math.pow(n,1/2.4)-.055:12.92*n,f=.0031308<f?1.055*Math.pow(f,1/2.4)-.055:12.92*f,s=.0031308<s?1.055*Math.pow(s,1/2.4)-.055:12.92*s,n=Math.min(Math.max(0,n),1),f=Math.min(Math.max(0,f),1),s=Math.min(Math.max(0,s),1),[255*n,255*f,255*s]},t.xyz.lab=function(n){var s=n[0],o=n[1];return n=n[2],s/=95.047,o/=100,n/=108.883,s=.008856<s?Math.pow(s,1/3):7.787*s+16/116,o=.008856<o?Math.pow(o,1/3):7.787*o+16/116,n=.008856<n?Math.pow(n,1/3):7.787*n+16/116,[116*o-16,500*(s-o),200*(o-n)]},t.lab.xyz=function(n){var s=n[1],o=n[2];n=(n[0]+16)/116,s=s/500+n,o=n-o/200;var u=Math.pow(n,3),f=Math.pow(s,3),v=Math.pow(o,3);return[95.047*(.008856<f?f:(s-16/116)/7.787),100*(.008856<u?u:(n-16/116)/7.787),108.883*(.008856<v?v:(o-16/116)/7.787)]},t.lab.lch=function(n){var s=n[0],o=n[1];n=n[2];var u=360*Math.atan2(n,o)/2/Math.PI;return 0>u&&(u+=360),[s,Math.sqrt(o*o+n*n),u]},t.lch.lab=function(n){var s=n[0],o=n[1];return n=n[2]/360*2*Math.PI,[s,o*Math.cos(n),o*Math.sin(n)]},t.rgb.ansi16=function(n){var s=n[0],o=n[1],u=n[2],f=1 in arguments?arguments[1]:t.rgb.hsv(n)[2];return f=Math.round(f/50),f===0?30:(s=30+(Math.round(u/255)<<2|Math.round(o/255)<<1|Math.round(s/255)),f===2&&(s+=60),s)},t.hsv.ansi16=function(n){return t.rgb.ansi16(t.hsv.rgb(n),n[2])},t.rgb.ansi256=function(n){var s=n[0],o=n[1];return n=n[2],s===o&&o===n?8>s?16:248<s?231:Math.round((s-8)/247*24)+232:16+36*Math.round(s/255*5)+6*Math.round(o/255*5)+Math.round(n/255*5)},t.ansi16.rgb=function(n){var s=n%10;return s===0||s===7?(50<n&&(s+=3.5),s=s/10.5*255,[s,s,s]):(n=.5*(~~(50<n)+1),[(s&1)*n*255,(s>>1&1)*n*255,(s>>2&1)*n*255])},t.ansi256.rgb=function(n){if(232<=n){var s=10*(n-232)+8;return[s,s,s]}n-=16,s=Math.floor(n/36)/5*255;var o=Math.floor((n%=36)/6)/5*255;return[s,o,n%6/5*255]},t.rgb.hex=function(n){return n=(((Math.round(n[0])&255)<<16)+((Math.round(n[1])&255)<<8)+(Math.round(n[2])&255)).toString(16).toUpperCase(),"000000".substring(n.length)+n},t.hex.rgb=function(n){if(n=n.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i),!n)return[0,0,0];var s=n[0];return n[0].length===3&&(s=s.split("").map(function(o){return o+o}).join("")),n=parseInt(s,16),[n>>16&255,n>>8&255,n&255]},t.rgb.hcg=function(n){var s=n[0]/255,o=n[1]/255;n=n[2]/255;var u=Math.max(Math.max(s,o),n),f=Math.min(Math.min(s,o),n),v=u-f;return[(0>=v?0:u===s?(o-n)/v%6:u===o?2+(n-s)/v:(s-o)/v+8)/6%1*360,100*v,100*(1>v?f/(1-v):0)]},t.hsl.hcg=function(n){var s=n[1]/100,o=n[2]/100,u=0;return s=.5>o?2*s*o:2*s*(1-o),1>s&&(u=(o-.5*s)/(1-s)),[n[0],100*s,100*u]},t.hsv.hcg=function(n){var s=n[2]/100,o=n[1]/100*s,u=0;return 1>o&&(u=(s-o)/(1-o)),[n[0],100*o,100*u]},t.hcg.rgb=function(n){var s=n[1]/100,o=n[2]/100;if(s===0)return[255*o,255*o,255*o];var u=[0,0,0];n=n[0]/360%1*6;var f=n%1,v=1-f;switch(Math.floor(n)){case 0:u[0]=1,u[1]=f,u[2]=0;break;case 1:u[0]=v,u[1]=1,u[2]=0;break;case 2:u[0]=0,u[1]=1,u[2]=f;break;case 3:u[0]=0,u[1]=v,u[2]=1;break;case 4:u[0]=f,u[1]=0,u[2]=1;break;default:u[0]=1,u[1]=0,u[2]=v}return o*=1-s,[255*(s*u[0]+o),255*(s*u[1]+o),255*(s*u[2]+o)]},t.hcg.hsv=function(n){var s=n[1]/100,o=s+n[2]/100*(1-s),u=0;return 0<o&&(u=s/o),[n[0],100*u,100*o]},t.hcg.hsl=function(n){var s=n[1]/100,o=n[2]/100*(1-s)+.5*s,u=0;return 0<o&&.5>o?u=s/(2*o):.5<=o&&1>o&&(u=s/(2*(1-o))),[n[0],100*u,100*o]},t.hcg.hwb=function(n){var s=n[1]/100,o=s+n[2]/100*(1-s);return[n[0],100*(o-s),100*(1-o)]},t.hwb.hcg=function(n){var s=1-n[2]/100,o=s-n[1]/100,u=0;return 1>o&&(u=(s-o)/(1-o)),[n[0],100*o,100*u]},t.apple.rgb=function(n){return[n[0]/65535*255,n[1]/65535*255,n[2]/65535*255]},t.rgb.apple=function(n){return[n[0]/255*65535,n[1]/255*65535,n[2]/255*65535]},t.gray.rgb=function(n){return[n[0]/100*255,n[0]/100*255,n[0]/100*255]},t.gray.hsl=t.gray.hsv=function(n){return[0,0,n[0]]},t.gray.hwb=function(n){return[0,100,n[0]]},t.gray.cmyk=function(n){return[0,0,0,n[0]]},t.gray.lab=function(n){return[n[0],0,0]},t.gray.hex=function(n){return n=Math.round(n[0]/100*255)&255,n=((n<<16)+(n<<8)+n).toString(16).toUpperCase(),"000000".substring(n.length)+n},t.rgb.gray=function(n){return[(n[0]+n[1]+n[2])/3/255*100]}}),El=function(r){for(var i={},t=_t(Ue),e=t.length,a=0;a<e;a++)i[t[a]]={distance:-1,parent:null};for(t=[r],i[r].distance=0;t.length;){r=t.pop(),e=_t(Ue[r]),a=e.length;for(var n=0;n<a;n++){var s=e[n],o=i[s];o.distance===-1&&(o.distance=i[r].distance+1,o.parent=r,t.unshift(s))}}for(t={},r=_t(i),e=r.length,a=0;a<e;a++){var u=r[a];if(i[u].parent!==null){n=u,s=i,o=[s[u].parent,u];var f=Ue[s[u].parent][u];for(u=s[u].parent;s[u].parent;)o.unshift(s[u].parent),f=Js(Ue[s[u].parent][u],f),u=s[u].parent;f.conversion=o,t[n]=f}}return t},rr={};_t(Ue).forEach(function(r){rr[r]={},Object.defineProperty(rr[r],"channels",{value:Ue[r].channels}),Object.defineProperty(rr[r],"labels",{value:Ue[r].labels});var i=El(r);_t(i).forEach(function(t){var e=i[t];rr[r][t]=$s(e),rr[r][t].raw=qs(e)})});var Nt=rr,Rn=[].slice,ga=["keyword","gray","hex"],Pn={};_t(Nt).forEach(function(r){Pn[Rn.call(Nt[r].labels).sort().join("")]=r});var Ri={};pt.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(r){var i=this.model in Dr.to?this:this.rgb();return i=i.round(typeof r=="number"?r:1),r=i.valpha===1?i.color:i.color.concat(this.valpha),Dr.to[i.model](r)},percentString:function(r){return r=this.rgb().round(typeof r=="number"?r:1),r=r.valpha===1?r.color:r.color.concat(this.valpha),Dr.to.rgb.percent(r)},array:function(){return this.valpha===1?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var r={},i=Nt[this.model].channels,t=Nt[this.model].labels,e=0;e<i;e++)r[t[e]]=this.color[e];return this.valpha!==1&&(r.alpha=this.valpha),r},unitArray:function(){var r=this.rgb().color;return r[0]/=255,r[1]/=255,r[2]/=255,this.valpha!==1&&r.push(this.valpha),r},unitObject:function(){var r=this.rgb().object();return r.r/=255,r.g/=255,r.b/=255,this.valpha!==1&&(r.alpha=this.valpha),r},round:function(r){return r=Math.max(r||0,0),new pt(this.color.map(tu(r)).concat(this.valpha),this.model)},alpha:function(r){return arguments.length?new pt(this.color.concat(Math.max(0,Math.min(1,r))),this.model):this.valpha},red:ct("rgb",0,xt(255)),green:ct("rgb",1,xt(255)),blue:ct("rgb",2,xt(255)),hue:ct(["hsl","hsv","hsl","hwb","hcg"],0,function(r){return(r%360+360)%360}),saturationl:ct("hsl",1,xt(100)),lightness:ct("hsl",2,xt(100)),saturationv:ct("hsv",1,xt(100)),value:ct("hsv",2,xt(100)),chroma:ct("hcg",1,xt(100)),gray:ct("hcg",2,xt(100)),white:ct("hwb",1,xt(100)),wblack:ct("hwb",2,xt(100)),cyan:ct("cmyk",0,xt(100)),magenta:ct("cmyk",1,xt(100)),yellow:ct("cmyk",2,xt(100)),black:ct("cmyk",3,xt(100)),x:ct("xyz",0,xt(100)),y:ct("xyz",1,xt(100)),z:ct("xyz",2,xt(100)),l:ct("lab",0,xt(100)),a:ct("lab",1),b:ct("lab",2),keyword:function(r){return arguments.length?new pt(r):Nt[this.model].keyword(this.color)},hex:function(r){return arguments.length?new pt(r):Dr.to.hex(this.rgb().round().color)},rgbNumber:function(){var r=this.rgb().color;return(r[0]&255)<<16|(r[1]&255)<<8|r[2]&255},luminosity:function(){for(var r=this.rgb().color,i=[],t=0;t<r.length;t++){var e=r[t]/255;i[t]=.03928>=e?e/12.92:Math.pow((e+.055)/1.055,2.4)}return .2126*i[0]+.7152*i[1]+.0722*i[2]},contrast:function(r){var i=this.luminosity();return r=r.luminosity(),i>r?(i+.05)/(r+.05):(r+.05)/(i+.05)},level:function(r){return r=this.contrast(r),7.1<=r?"AAA":4.5<=r?"AA":""},isDark:function(){var r=this.rgb().color;return 128>(299*r[0]+587*r[1]+114*r[2])/1e3},isLight:function(){return!this.isDark()},negate:function(){for(var r=this.rgb(),i=0;3>i;i++)r.color[i]=255-r.color[i];return r},lighten:function(r){var i=this.hsl();return i.color[2]+=i.color[2]*r,i},darken:function(r){var i=this.hsl();return i.color[2]-=i.color[2]*r,i},saturate:function(r){var i=this.hsl();return i.color[1]+=i.color[1]*r,i},desaturate:function(r){var i=this.hsl();return i.color[1]-=i.color[1]*r,i},whiten:function(r){var i=this.hwb();return i.color[1]+=i.color[1]*r,i},blacken:function(r){var i=this.hwb();return i.color[2]+=i.color[2]*r,i},grayscale:function(){var r=this.rgb().color;return r=.3*r[0]+.59*r[1]+.11*r[2],pt.rgb(r,r,r)},fade:function(r){return this.alpha(this.valpha-this.valpha*r)},opaquer:function(r){return this.alpha(this.valpha+this.valpha*r)},rotate:function(r){var i=this.hsl(),t=i.color[0];return t=(t+r)%360,i.color[0]=0>t?360+t:t,i},mix:function(r,i){if(!r||!r.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+(typeof r=="undefined"?"undefined":It(r)));r=r.rgb();var t=this.rgb();i=i===void 0?.5:i;var e=2*i-1,a=r.alpha()-t.alpha();return e=((e*a===-1?e:(e+a)/(1+e*a))+1)/2,a=1-e,pt.rgb(e*r.red()+a*t.red(),e*r.green()+a*t.green(),e*r.blue()+a*t.blue(),r.alpha()*i+t.alpha()*(1-i))}},_t(Nt).forEach(function(r){if(ga.indexOf(r)===-1){var i=Nt[r].channels;pt.prototype[r]=function(){if(this.model===r)return new pt(this);if(arguments.length)return new pt(arguments,r);var t=typeof arguments[i]=="number"?i:this.valpha,e=Nt[this.model][r].raw(this.color);return e=Array.isArray(e)?e:[e],new pt(e.concat(t),r)},pt[r]=function(t){return typeof t=="number"&&(t=Wi(Rn.call(arguments),i)),new pt(t,r)}}}),Ki(kt.prototype,{equals:function(r){return this.lat===r.lat&&this.lng===r.lng},clone:function(){return new kt(this.lat,this.lng)},getLngSpan:function(r){return r=Math.abs(r-this.lng),180<r&&(r=360-r),r},sub:function(r){return new kt(this.lat-r.lat,this.lng-r.lng)},toString:function(){return"Point"}}),Ki(Lt,{EARTHRADIUS:637099681e-2,MCBAND:[1289059486e-2,836237787e-2,5591021,348198983e-2,167804312e-2,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1410526172116255e-23,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,173379812e-1],[-7435856389565537e-24,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1026014486e-2],[-3030883460898826e-23,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,685681737e-2],[-1981981304930552e-23,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,448277706e-2],[309191371068437e-23,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,25551644e-1],[2890871144776878e-24,8983055095805407e-21,-3068298e-14,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,6477955746671607e-7,-4082003173641316e-6,1077490566351142e-5,-1517187553151559e-5,1205306533862167e-5,-5124939663577472e-6,9133119359512032e-7,67.5],[.00337398766765,111320.7020202162,4481351045890365e-9,-2339375119931662e-8,7968221547186455e-8,-1159649932797253e-7,9723671115602145e-8,-4366194633752821e-8,8477230501135234e-9,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837749470245e-9,992013.7397791013,-122195221711287e-8,1340652697009075e-9,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758690035394e-9,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(r,i){if(!r||!i||(r=this.convertMC2LL(r),!r))return 0;var t=this.toRadians(r.lng);if(r=this.toRadians(r.lat),i=this.convertMC2LL(i),!i)return 0;var e=this.toRadians(i.lng);return i=this.toRadians(i.lat),this.getDistance(t,e,r,i)},getDistanceByLL:function(r,i){if(!r||!i)return 0;r.lng=this.getLoop(r.lng,-180,180),r.lat=this.getRange(r.lat,-74,74),i.lng=this.getLoop(i.lng,-180,180),i.lat=this.getRange(i.lat,-74,74);var t=this.toRadians(r.lng),e=this.toRadians(r.lat);return r=this.toRadians(i.lng),i=this.toRadians(i.lat),this.getDistance(t,r,e,i)},convertMC2LL:function(r){if(r==null)return new kt(0,0);if(180>r.lng&&-180<r.lng&&90>r.lat&&-90<r.lat)return r;for(var i=new kt(Math.abs(r.lng),Math.abs(r.lat)),t=0;t<this.MCBAND.length;t++)if(i.lat>=this.MCBAND[t]){var e=this.MC2LL[t];break}return r=this.convertor(r,e),r=new kt(r.lng.toFixed(6),r.lat.toFixed(6))},convertLL2MC:function(r){if(r==null)return new kt(0,0);if(180<r.lng||-180>r.lng||90<r.lat||-90>r.lat)return r;r.lng=this.getLoop(r.lng,-180,180),r.lat=this.getRange(r.lat,-74,74);for(var i=new kt(r.lng,r.lat),t=0;t<this.LLBAND.length;t++)if(i.lat>=this.LLBAND[t]){var e=this.LL2MC[t];break}if(!e){for(t=0;t<this.LLBAND.length;t++)if(i.lat<=-this.LLBAND[t]){e=this.LL2MC[t];break}}return r=this.convertor(r,e),r=new kt(Number(r.lng.toFixed(2)),Number(r.lat.toFixed(2)))},convertor:function(r,i){if(r&&i){var t=i[0]+i[1]*Math.abs(r.lng),e=Math.abs(r.lat)/i[9];return i=i[2]+i[3]*e+i[4]*e*e+i[5]*e*e*e+i[6]*e*e*e*e+i[7]*e*e*e*e*e+i[8]*e*e*e*e*e*e,t*=0>r.lng?-1:1,i*=0>r.lat?-1:1,new kt(t,i)}},getDistance:function(r,i,t,e){return this.EARTHRADIUS*Math.acos(Math.sin(t)*Math.sin(e)+Math.cos(t)*Math.cos(e)*Math.cos(i-r))},toRadians:function(r){return Math.PI*r/180},toDegrees:function(r){return 180*r/Math.PI},getRange:function(r,i,t){return i!=null&&(r=Math.max(r,i)),t!=null&&(r=Math.min(r,t)),r},getLoop:function(r,i,t){for(;r>t;)r-=t-i;for(;r<i;)r+=t-i;return r}}),Ki(Lt.prototype,{lngLatToMercator:function(r){return Lt.convertLL2MC(r)},lngLatToPoint:function(r){return r=Lt.convertLL2MC(r),new go(r.lng,r.lat)},mercatorToLngLat:function(r){return Lt.convertMC2LL(r)},pointToLngLat:function(r){return r=new kt(r.x,r.y),Lt.convertMC2LL(r)},pointToPixel:function(r,i,t,e,a){if(r)return r=this.lngLatToMercator(r,a),i=this.getZoomUnits(i),new go(Math.round((r.lng-t.lng)/i+e.width/2),Math.round((t.lat-r.lat)/i+e.height/2))},pixelToPoint:function(r,i,t,e,a){if(r)return i=this.getZoomUnits(i),r=new kt(t.lng+i*(r.x-e.width/2),t.lat-i*(r.y-e.height/2)),this.mercatorToLngLat(r,a)},getZoomUnits:function(r){return Math.pow(2,18-r)}}),Rt.prototype.setMax=function(r){this.max=r||100},Rt.prototype.setMin=function(r){this.min=r||0},Rt.prototype.setMaxSize=function(r){this.maxSize=r||35},Rt.prototype.setMinSize=function(r){this.minSize=r||0},Rt.prototype.initPalette=function(){var r=this.gradient,i=this.paletteCtx=new Qi(256,1).getContext("2d"),t=i.createLinearGradient(0,0,256,1);_t(r).forEach(function(e){t.addColorStop(parseFloat(e),r[e])}),i.fillStyle=t,i.fillRect(0,0,256,1),i.imageData=i.getImageData(0,0,256,1).data},Rt.prototype.getColor=function(r){return r=this.getImageData(r),"rgba("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]/256+")"},Rt.prototype.getImageData=function(r){var i=this.paletteCtx.imageData;if(r===void 0)return i;var t=this.max,e=this.min;return r>t&&(r=t),r<e&&(r=e),r=4*Math.floor((r-e)/(t-e)*255),[i[r],i[r+1],i[r+2],i[r+3]]},Rt.prototype.getSize=function(r){var i=this.max,t=this.min,e=this.maxSize,a=this.minSize;return r>i&&(r=i),r<t&&(r=t),a+(r-t)/(i-t)*(e-a)},ae.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start),this.v3=this._normalizaCoord(this.options.end),this.v1=this._getControlPoint(this.v0,this.v3,4),this.v2=this._getControlPoint(this.v3,this.v0,5),this.v0[2]||(this.v0[2]=0),this.v3[2]||(this.v3[2]=0)},ae.prototype.setOptions=function(r){this.options=r||{},this._initialize()},ae.prototype.getPoints=function(r){r===void 0&&(r=20);for(var i=[],t=0;t<=r;t++)i.push(this._getPoint(t/r));return i},ae.prototype._normalizaCoord=function(r){return r?(r=Lt.convertLL2MC({lng:Number(r[0]),lat:Number(r[1])}),[r.lng,r.lat]):[]},ae.prototype._getControlPoint=function(r,i){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return[].concat(Q(this._getQuarter(r,i)),[this._getDistance(r,i)/t])},ae.prototype._getQuarter=function(r,i){return[(3*r[0]+i[0])/4,(3*r[1]+i[1])/4]},ae.prototype._getDistance=function(r,i){return Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2))},ae.prototype._getPoint=function(r){var i=[],t=this.v0,e=this.v1,a=this.v2,n=this.v3;return i.push(Ji(r,t[0],e[0],a[0],n[0]),Ji(r,t[1],e[1],a[1],n[1]),Ji(r,t[2],e[2],a[2],n[2])),i},ge.prototype._initialize=function(){this.points=this.options.points||this.options.point||[],this.greatCirclePoints=[];for(var r=[],i=0;i<this.points.length;i++){var t=this._normalizaCoord(this.points[i]);t&&r.push(t)}this.points=r},ge.prototype.setOptions=function(r){this.options=r||{},this._initialize()},ge.prototype.getPoints=function(){if(this.greatCirclePoints.length===0)for(var r=0;r<this.points.length-1;r++)this._calcGreatCirclePoints(this.points[r],this.points[r+1]);return this.greatCirclePoints},ge.prototype._normalizaCoord=function(r){if(!r)return null;r instanceof Array&&(r={lng:Number(r[0]),lat:Number(r[1])});var i=Lt.convertLL2MC(r);return r=Lt.convertMC2LL(r),i.latLng=r,i},ge.prototype._calcGreatCirclePoints=function(r,i){var t=r.latLng,e=i.latLng;if(!Vi(t.lng,e.lng)||!Vi(t.lat,e.lat)){var a=Lt.getDistance(Et(t.lng),Et(t.lat),Et(e.lng),Et(e.lat));if(!(25e4>a)){a=Math.round(a/15e4);var n=this._calcAngularDistance(t,e);this.greatCirclePoints.push([r.lng,r.lat]);for(var s=0;s<a;s++){var o=this._calcMiddlePoint(t,e,s/a,n);o=Lt.convertLL2MC(o);var u=mo(o,r);30037726<u&&(o.lng=o.lng<r.lng?o.lng+this.WORLD_SIZE_MC:o.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([o.lng,o.lat]),r=o}u=mo(i,r),30037726<u&&(i.lng=i.lng<r.lng?i.lng+this.WORLD_SIZE_MC:i.lng-this.WORLD_SIZE_MC),this.greatCirclePoints.push([i.lng,i.lat])}}},ge.prototype._calcAngularDistance=function(r,i){var t=Et(r.lat),e=Et(i.lat);return r=Et(r.lng),i=Et(i.lng),Math.acos(Math.sin(t)*Math.sin(e)+Math.cos(t)*Math.cos(e)*Math.cos(Math.abs(i-r)))},ge.prototype._calcMiddlePoint=function(r,i,t,e){var a=i.lat,n=r.lng;i=i.lng,r=Et(r.lat),a=Et(a),n=Et(n);var s=Et(i);return i=Math.sin((1-t)*e)/Math.sin(e),e=Math.sin(t*e)/Math.sin(e),t=i*Math.cos(r)*Math.cos(n)+e*Math.cos(a)*Math.cos(s),n=i*Math.cos(r)*Math.sin(n)+e*Math.cos(a)*Math.sin(s),r=Math.atan2(i*Math.sin(r)+e*Math.sin(a),Math.sqrt(Math.pow(t,2)+Math.pow(n,2))),new kt(Yi(Math.atan2(n,t)),Yi(r))};var Cl=function(){function r(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};O(this,r),this.options=i,this._initialize()}return z(r,[{key:"_initialize",value:function(){this.points=this.options.points}},{key:"_normalizaCoord",value:function(i){return i?(i instanceof Array&&(i={lng:Number(i[0]),lat:Number(i[1])}),Lt.convertLL2MC(i)):null}},{key:"setOptions",value:function(){this.options=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},this._initialize()}},{key:"getPoints",value:function(i){for(var t=[],e=this.points,a=0;a<e.length-1;a++){var n=this.getCurveByTwoPoints(this._normalizaCoord(e[a]),this._normalizaCoord(e[a+1]),i);n&&0<n.length&&(t=t.concat(n))}return t}},{key:"getCurveByTwoPoints",value:function(i,t){var e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:20;if(!i||!t)return null;var a=[],n=0;if((typeof t=="undefined"?"undefined":It(t))===void 0)typeof a=="undefined"||It(a);else{var s=parseFloat(i.lat),o=parseFloat(t.lat),u=parseFloat(i.lng),f=parseFloat(t.lng);f>u&&180<parseFloat(f-u)&&0>u&&(u=parseFloat(360+u),f=parseFloat(360+f));var v=0;if(o===s)var l=0,h=u-f;else f===u?(l=Math.PI/2,h=s-o):(l=Math.atan((o-s)/(f-u)),h=(o-s)/Math.sin(l));for(v===0&&(v=l+Math.PI/5),h/=2,l=h*Math.cos(v)+u,v=h*Math.sin(v)+s,h=0;h<e+1;h++){var d=u*(1-2*n+n*n)+l*(2*n-2*n*n)+f*n*n,c=t.lng;a.push([0>i.lng&&0<c?d-360:d,s*(1-2*n+n*n)+v*(2*n-2*n*n)+o*n*n]),n+=1/e}return a}}}]),r}(),Sn=[{n:"\u5317\u4EAC",g:"116.395645,39.929986|12"},{n:"\u4E0A\u6D77",g:"121.487899,31.249162|12"},{n:"\u5929\u6D25",g:"117.210813,39.14393|12"},{n:"\u91CD\u5E86",g:"106.530635,29.544606|12"}],Ne=[{n:"\u5B89\u5FBD",g:"117.216005,31.859252|8",cities:[{n:"\u5408\u80A5",g:"117.282699,31.866942|12"},{n:"\u5B89\u5E86",g:"117.058739,30.537898|13"},{n:"\u868C\u57E0",g:"117.35708,32.929499|13"},{n:"\u4EB3\u5DDE",g:"115.787928,33.871211|13"},{n:"\u5DE2\u6E56",g:"117.88049,31.608733|13"},{n:"\u6C60\u5DDE",g:"117.494477,30.660019|14"},{n:"\u6EC1\u5DDE",g:"118.32457,32.317351|13"},{n:"\u961C\u9633",g:"115.820932,32.901211|13"},{n:"\u6DEE\u5317",g:"116.791447,33.960023|13"},{n:"\u6DEE\u5357",g:"117.018639,32.642812|13"},{n:"\u9EC4\u5C71",g:"118.29357,29.734435|13"},{n:"\u516D\u5B89",g:"116.505253,31.755558|13"},{n:"\u9A6C\u978D\u5C71",g:"118.515882,31.688528|13"},{n:"\u5BBF\u5DDE",g:"116.988692,33.636772|13"},{n:"\u94DC\u9675",g:"117.819429,30.94093|14"},{n:"\u829C\u6E56",g:"118.384108,31.36602|12"},{n:"\u5BA3\u57CE",g:"118.752096,30.951642|13"}]},{n:"\u798F\u5EFA",g:"117.984943,26.050118|8",cities:[{n:"\u798F\u5DDE",g:"119.330221,26.047125|12"},{n:"\u9F99\u5CA9",g:"117.017997,25.078685|13"},{n:"\u5357\u5E73",g:"118.181883,26.643626|13"},{n:"\u5B81\u5FB7",g:"119.542082,26.656527|14"},{n:"\u8386\u7530",g:"119.077731,25.44845|13"},{n:"\u6CC9\u5DDE",g:"118.600362,24.901652|12"},{n:"\u4E09\u660E",g:"117.642194,26.270835|14"},{n:"\u53A6\u95E8",g:"118.103886,24.489231|12"},{n:"\u6F33\u5DDE",g:"117.676205,24.517065|12"}]},{n:"\u7518\u8083",g:"102.457625,38.103267|6",cities:[{n:"\u5170\u5DDE",g:"103.823305,36.064226|12"},{n:"\u767D\u94F6",g:"104.171241,36.546682|13"},{n:"\u5B9A\u897F",g:"104.626638,35.586056|13"},{n:"\u7518\u5357\u5DDE",g:"102.917442,34.992211|14"},{n:"\u5609\u5CEA\u5173",g:"98.281635,39.802397|13"},{n:"\u91D1\u660C",g:"102.208126,38.516072|13"},{n:"\u9152\u6CC9",g:"98.508415,39.741474|13"},{n:"\u4E34\u590F\u5DDE",g:"103.215249,35.598514|13"},{n:"\u9647\u5357",g:"104.934573,33.39448|14"},{n:"\u5E73\u51C9",g:"106.688911,35.55011|13"},{n:"\u5E86\u9633",g:"107.644227,35.726801|13"},{n:"\u5929\u6C34",g:"105.736932,34.584319|13"},{n:"\u6B66\u5A01",g:"102.640147,37.933172|13"},{n:"\u5F20\u6396",g:"100.459892,38.93932|13"}]},{n:"\u5E7F\u4E1C",g:"113.394818,23.408004|8",cities:[{n:"\u5E7F\u5DDE",g:"113.30765,23.120049|12"},{n:"\u6F6E\u5DDE",g:"116.630076,23.661812|13"},{n:"\u4E1C\u839E",g:"113.763434,23.043024|12"},{n:"\u4F5B\u5C71",g:"113.134026,23.035095|13"},{n:"\u6CB3\u6E90",g:"114.713721,23.757251|12"},{n:"\u60E0\u5DDE",g:"114.410658,23.11354|12"},{n:"\u6C5F\u95E8",g:"113.078125,22.575117|13"},{n:"\u63ED\u9633",g:"116.379501,23.547999|13"},{n:"\u8302\u540D",g:"110.931245,21.668226|13"},{n:"\u6885\u5DDE",g:"116.126403,24.304571|13"},{n:"\u6E05\u8FDC",g:"113.040773,23.698469|13"},{n:"\u6C55\u5934",g:"116.72865,23.383908|13"},{n:"\u6C55\u5C3E",g:"115.372924,22.778731|14"},{n:"\u97F6\u5173",g:"113.594461,24.80296|13"},{n:"\u6DF1\u5733",g:"114.025974,22.546054|12"},{n:"\u9633\u6C5F",g:"111.97701,21.871517|14"},{n:"\u4E91\u6D6E",g:"112.050946,22.937976|13"},{n:"\u6E5B\u6C5F",g:"110.365067,21.257463|13"},{n:"\u8087\u5E86",g:"112.479653,23.078663|13"},{n:"\u4E2D\u5C71",g:"113.42206,22.545178|12"},{n:"\u73E0\u6D77",g:"113.562447,22.256915|13"}]},{n:"\u5E7F\u897F",g:"108.924274,23.552255|7",cities:[{n:"\u5357\u5B81",g:"108.297234,22.806493|12"},{n:"\u767E\u8272",g:"106.631821,23.901512|13"},{n:"\u5317\u6D77",g:"109.122628,21.472718|13"},{n:"\u5D07\u5DE6",g:"107.357322,22.415455|14"},{n:"\u9632\u57CE\u6E2F",g:"108.351791,21.617398|15"},{n:"\u6842\u6797",g:"110.26092,25.262901|12"},{n:"\u8D35\u6E2F",g:"109.613708,23.103373|13"},{n:"\u6CB3\u6C60",g:"108.069948,24.699521|14"},{n:"\u8D3A\u5DDE",g:"111.552594,24.411054|14"},{n:"\u6765\u5BBE",g:"109.231817,23.741166|14"},{n:"\u67F3\u5DDE",g:"109.422402,24.329053|12"},{n:"\u94A6\u5DDE",g:"108.638798,21.97335|13"},{n:"\u68A7\u5DDE",g:"111.305472,23.485395|13"},{n:"\u7389\u6797",g:"110.151676,22.643974|14"}]},{n:"\u8D35\u5DDE",g:"106.734996,26.902826|8",cities:[{n:"\u8D35\u9633",g:"106.709177,26.629907|12"},{n:"\u5B89\u987A",g:"105.92827,26.228595|13"},{n:"\u6BD5\u8282\u5730\u533A",g:"105.300492,27.302612|14"},{n:"\u516D\u76D8\u6C34",g:"104.852087,26.591866|13"},{n:"\u94DC\u4EC1\u5730\u533A",g:"109.196161,27.726271|14"},{n:"\u9075\u4E49",g:"106.93126,27.699961|13"},{n:"\u9ED4\u897F\u5357\u5DDE",g:"104.900558,25.095148|11"},{n:"\u9ED4\u4E1C\u5357\u5DDE",g:"107.985353,26.583992|11"},{n:"\u9ED4\u5357\u5DDE",g:"107.523205,26.264536|11"}]},{n:"\u6D77\u5357",g:"109.733755,19.180501|9",cities:[{n:"\u6D77\u53E3",g:"110.330802,20.022071|13"},{n:"\u767D\u6C99",g:"109.358586,19.216056|12"},{n:"\u4FDD\u4EAD",g:"109.656113,18.597592|12"},{n:"\u660C\u6C5F",g:"109.0113,19.222483|12"},{n:"\u510B\u5DDE",g:"109.413973,19.571153|13"},{n:"\u6F84\u8FC8",g:"109.996736,19.693135|13"},{n:"\u4E1C\u65B9",g:"108.85101,18.998161|13"},{n:"\u5B9A\u5B89",g:"110.32009,19.490991|13"},{n:"\u743C\u6D77",g:"110.414359,19.21483|13"},{n:"\u743C\u4E2D",g:"109.861849,19.039771|12"},{n:"\u4E50\u4E1C",g:"109.062698,18.658614|12"},{n:"\u4E34\u9AD8",g:"109.724101,19.805922|13"},{n:"\u9675\u6C34",g:"109.948661,18.575985|12"},{n:"\u4E09\u4E9A",g:"109.522771,18.257776|12"},{n:"\u5C6F\u660C",g:"110.063364,19.347749|13"},{n:"\u4E07\u5B81",g:"110.292505,18.839886|13"},{n:"\u6587\u660C",g:"110.780909,19.750947|13"},{n:"\u4E94\u6307\u5C71",g:"109.51775,18.831306|13"}]},{n:"\u6CB3\u5317",g:"115.661434,38.61384|7",cities:[{n:"\u77F3\u5BB6\u5E84",g:"114.522082,38.048958|12"},{n:"\u4FDD\u5B9A",g:"115.49481,38.886565|13"},{n:"\u6CA7\u5DDE",g:"116.863806,38.297615|13"},{n:"\u627F\u5FB7",g:"117.933822,40.992521|14"},{n:"\u90AF\u90F8",g:"114.482694,36.609308|13"},{n:"\u8861\u6C34",g:"115.686229,37.746929|13"},{n:"\u5ECA\u574A",g:"116.703602,39.518611|13"},{n:"\u79E6\u7687\u5C9B",g:"119.604368,39.945462|12"},{n:"\u5510\u5C71",g:"118.183451,39.650531|13"},{n:"\u90A2\u53F0",g:"114.520487,37.069531|13"},{n:"\u5F20\u5BB6\u53E3",g:"114.893782,40.811188|13"}]},{n:"\u6CB3\u5357",g:"113.486804,34.157184|7",cities:[{n:"\u90D1\u5DDE",g:"113.649644,34.75661|12"},{n:"\u5B89\u9633",g:"114.351807,36.110267|12"},{n:"\u9E64\u58C1",g:"114.29777,35.755426|13"},{n:"\u7126\u4F5C",g:"113.211836,35.234608|13"},{n:"\u5F00\u5C01",g:"114.351642,34.801854|13"},{n:"\u6D1B\u9633",g:"112.447525,34.657368|12"},{n:"\u6F2F\u6CB3",g:"114.046061,33.576279|13"},{n:"\u5357\u9633",g:"112.542842,33.01142|13"},{n:"\u5E73\u9876\u5C71",g:"113.300849,33.745301|13"},{n:"\u6FEE\u9633",g:"115.026627,35.753298|12"},{n:"\u4E09\u95E8\u5CE1",g:"111.181262,34.78332|13"},{n:"\u5546\u4E18",g:"115.641886,34.438589|13"},{n:"\u65B0\u4E61",g:"113.91269,35.307258|13"},{n:"\u4FE1\u9633",g:"114.085491,32.128582|13"},{n:"\u8BB8\u660C",g:"113.835312,34.02674|13"},{n:"\u5468\u53E3",g:"114.654102,33.623741|13"},{n:"\u9A7B\u9A6C\u5E97",g:"114.049154,32.983158|13"}]},{n:"\u9ED1\u9F99\u6C5F",g:"128.047414,47.356592|6",cities:[{n:"\u54C8\u5C14\u6EE8",g:"126.657717,45.773225|12"},{n:"\u5927\u5E86",g:"125.02184,46.596709|12"},{n:"\u5927\u5174\u5B89\u5CAD\u5730\u533A",g:"124.196104,51.991789|10"},{n:"\u9E64\u5C97",g:"130.292472,47.338666|13"},{n:"\u9ED1\u6CB3",g:"127.50083,50.25069|14"},{n:"\u9E21\u897F",g:"130.941767,45.32154|13"},{n:"\u4F73\u6728\u65AF",g:"130.284735,46.81378|12"},{n:"\u7261\u4E39\u6C5F",g:"129.608035,44.588521|13"},{n:"\u4E03\u53F0\u6CB3",g:"131.019048,45.775005|14"},{n:"\u9F50\u9F50\u54C8\u5C14",g:"123.987289,47.3477|13"},{n:"\u53CC\u9E2D\u5C71",g:"131.171402,46.655102|13"},{n:"\u7EE5\u5316",g:"126.989095,46.646064|13"},{n:"\u4F0A\u6625",g:"128.910766,47.734685|14"}]},{n:"\u6E56\u5317",g:"112.410562,31.209316|8",cities:[{n:"\u6B66\u6C49",g:"114.3162,30.581084|12"},{n:"\u9102\u5DDE",g:"114.895594,30.384439|14"},{n:"\u6069\u65BD",g:"109.517433,30.308978|14"},{n:"\u9EC4\u5188",g:"114.906618,30.446109|14"},{n:"\u9EC4\u77F3",g:"115.050683,30.216127|13"},{n:"\u8346\u95E8",g:"112.21733,31.042611|13"},{n:"\u8346\u5DDE",g:"112.241866,30.332591|12"},{n:"\u6F5C\u6C5F",g:"112.768768,30.343116|13"},{n:"\u795E\u519C\u67B6\u6797\u533A",g:"110.487231,31.595768|13"},{n:"\u5341\u5830",g:"110.801229,32.636994|13"},{n:"\u968F\u5DDE",g:"113.379358,31.717858|13"},{n:"\u5929\u95E8",g:"113.12623,30.649047|13"},{n:"\u4ED9\u6843",g:"113.387448,30.293966|13"},{n:"\u54B8\u5B81",g:"114.300061,29.880657|13"},{n:"\u8944\u9633",g:"112.176326,32.094934|12"},{n:"\u5B5D\u611F",g:"113.935734,30.927955|13"},{n:"\u5B9C\u660C",g:"111.310981,30.732758|13"}]},{n:"\u6E56\u5357",g:"111.720664,27.695864|7",cities:[{n:"\u957F\u6C99",g:"112.979353,28.213478|12"},{n:"\u5E38\u5FB7",g:"111.653718,29.012149|12"},{n:"\u90F4\u5DDE",g:"113.037704,25.782264|13"},{n:"\u8861\u9633",g:"112.583819,26.898164|13"},{n:"\u6000\u5316",g:"109.986959,27.557483|13"},{n:"\u5A04\u5E95",g:"111.996396,27.741073|13"},{n:"\u90B5\u9633",g:"111.461525,27.236811|13"},{n:"\u6E58\u6F6D",g:"112.935556,27.835095|13"},{n:"\u6E58\u897F\u5DDE",g:"109.745746,28.317951|14"},{n:"\u76CA\u9633",g:"112.366547,28.588088|13"},{n:"\u6C38\u5DDE",g:"111.614648,26.435972|13"},{n:"\u5CB3\u9633",g:"113.146196,29.378007|13"},{n:"\u5F20\u5BB6\u754C",g:"110.48162,29.124889|13"},{n:"\u682A\u6D32",g:"113.131695,27.827433|13"}]},{n:"\u6C5F\u82CF",g:"119.368489,33.013797|8",cities:[{n:"\u5357\u4EAC",g:"118.778074,32.057236|12"},{n:"\u5E38\u5DDE",g:"119.981861,31.771397|12"},{n:"\u6DEE\u5B89",g:"119.030186,33.606513|12"},{n:"\u8FDE\u4E91\u6E2F",g:"119.173872,34.601549|12"},{n:"\u5357\u901A",g:"120.873801,32.014665|12"},{n:"\u82CF\u5DDE",g:"120.619907,31.317987|12"},{n:"\u5BBF\u8FC1",g:"118.296893,33.95205|13"},{n:"\u6CF0\u5DDE",g:"119.919606,32.476053|13"},{n:"\u65E0\u9521",g:"120.305456,31.570037|12"},{n:"\u5F90\u5DDE",g:"117.188107,34.271553|12"},{n:"\u76D0\u57CE",g:"120.148872,33.379862|12"},{n:"\u626C\u5DDE",g:"119.427778,32.408505|13"},{n:"\u9547\u6C5F",g:"119.455835,32.204409|13"}]},{n:"\u6C5F\u897F",g:"115.676082,27.757258|7",cities:[{n:"\u5357\u660C",g:"115.893528,28.689578|12"},{n:"\u629A\u5DDE",g:"116.360919,27.954545|13"},{n:"\u8D63\u5DDE",g:"114.935909,25.845296|13"},{n:"\u5409\u5B89",g:"114.992039,27.113848|13"},{n:"\u666F\u5FB7\u9547",g:"117.186523,29.303563|12"},{n:"\u4E5D\u6C5F",g:"115.999848,29.71964|13"},{n:"\u840D\u4E61",g:"113.859917,27.639544|13"},{n:"\u4E0A\u9976",g:"117.955464,28.457623|13"},{n:"\u65B0\u4F59",g:"114.947117,27.822322|13"},{n:"\u5B9C\u6625",g:"114.400039,27.81113|13"},{n:"\u9E70\u6F6D",g:"117.03545,28.24131|13"}]},{n:"\u5409\u6797",g:"126.262876,43.678846|7",cities:[{n:"\u957F\u6625",g:"125.313642,43.898338|12"},{n:"\u767D\u57CE",g:"122.840777,45.621086|13"},{n:"\u767D\u5C71",g:"126.435798,41.945859|13"},{n:"\u5409\u6797",g:"126.564544,43.871988|12"},{n:"\u8FBD\u6E90",g:"125.133686,42.923303|13"},{n:"\u56DB\u5E73",g:"124.391382,43.175525|12"},{n:"\u677E\u539F",g:"124.832995,45.136049|13"},{n:"\u901A\u5316",g:"125.94265,41.736397|13"},{n:"\u5EF6\u8FB9",g:"129.485902,42.896414|13"}]},{n:"\u8FBD\u5B81",g:"122.753592,41.6216|8",cities:[{n:"\u6C88\u9633",g:"123.432791,41.808645|12"},{n:"\u978D\u5C71",g:"123.007763,41.118744|13"},{n:"\u672C\u6EAA",g:"123.778062,41.325838|12"},{n:"\u671D\u9633",g:"120.446163,41.571828|13"},{n:"\u5927\u8FDE",g:"121.593478,38.94871|12"},{n:"\u4E39\u4E1C",g:"124.338543,40.129023|12"},{n:"\u629A\u987A",g:"123.92982,41.877304|12"},{n:"\u961C\u65B0",g:"121.660822,42.01925|14"},{n:"\u846B\u82A6\u5C9B",g:"120.860758,40.74303|13"},{n:"\u9526\u5DDE",g:"121.147749,41.130879|13"},{n:"\u8FBD\u9633",g:"123.172451,41.273339|14"},{n:"\u76D8\u9526",g:"122.073228,41.141248|13"},{n:"\u94C1\u5CAD",g:"123.85485,42.299757|13"},{n:"\u8425\u53E3",g:"122.233391,40.668651|13"}]},{n:"\u5185\u8499\u53E4",g:"114.415868,43.468238|5",cities:[{n:"\u547C\u548C\u6D69\u7279",g:"111.660351,40.828319|12"},{n:"\u963F\u62C9\u5584\u76DF",g:"105.695683,38.843075|14"},{n:"\u5305\u5934",g:"109.846239,40.647119|12"},{n:"\u5DF4\u5F66\u6DD6\u5C14",g:"107.423807,40.76918|12"},{n:"\u8D64\u5CF0",g:"118.930761,42.297112|12"},{n:"\u9102\u5C14\u591A\u65AF",g:"109.993706,39.81649|12"},{n:"\u547C\u4F26\u8D1D\u5C14",g:"119.760822,49.201636|12"},{n:"\u901A\u8FBD",g:"122.260363,43.633756|12"},{n:"\u4E4C\u6D77",g:"106.831999,39.683177|13"},{n:"\u4E4C\u5170\u5BDF\u5E03",g:"113.112846,41.022363|12"},{n:"\u9521\u6797\u90ED\u52D2\u76DF",g:"116.02734,43.939705|11"},{n:"\u5174\u5B89\u76DF",g:"122.048167,46.083757|11"}]},{n:"\u5B81\u590F",g:"106.155481,37.321323|8",cities:[{n:"\u94F6\u5DDD",g:"106.206479,38.502621|12"},{n:"\u56FA\u539F",g:"106.285268,36.021523|13"},{n:"\u77F3\u5634\u5C71",g:"106.379337,39.020223|13"},{n:"\u5434\u5FE0",g:"106.208254,37.993561|14"},{n:"\u4E2D\u536B",g:"105.196754,37.521124|14"}]},{n:"\u9752\u6D77",g:"96.202544,35.499761|7",cities:[{n:"\u897F\u5B81",g:"101.767921,36.640739|12"},{n:"\u679C\u6D1B\u5DDE",g:"100.223723,34.480485|11"},{n:"\u6D77\u4E1C\u5730\u533A",g:"102.085207,36.51761|11"},{n:"\u6D77\u5317\u5DDE",g:"100.879802,36.960654|11"},{n:"\u6D77\u5357\u5DDE",g:"100.624066,36.284364|11"},{n:"\u6D77\u897F\u5DDE",g:"97.342625,37.373799|11"},{n:"\u9EC4\u5357\u5DDE",g:"102.0076,35.522852|11"},{n:"\u7389\u6811\u5DDE",g:"97.013316,33.00624|14"}]},{n:"\u5C71\u4E1C",g:"118.527663,36.09929|8",cities:[{n:"\u6D4E\u5357",g:"117.024967,36.682785|12"},{n:"\u6EE8\u5DDE",g:"117.968292,37.405314|12"},{n:"\u4E1C\u8425",g:"118.583926,37.487121|12"},{n:"\u5FB7\u5DDE",g:"116.328161,37.460826|12"},{n:"\u83CF\u6CFD",g:"115.46336,35.26244|13"},{n:"\u6D4E\u5B81",g:"116.600798,35.402122|13"},{n:"\u83B1\u829C",g:"117.684667,36.233654|13"},{n:"\u804A\u57CE",g:"115.986869,36.455829|12"},{n:"\u4E34\u6C82",g:"118.340768,35.072409|12"},{n:"\u9752\u5C9B",g:"120.384428,36.105215|12"},{n:"\u65E5\u7167",g:"119.50718,35.420225|12"},{n:"\u6CF0\u5B89",g:"117.089415,36.188078|13"},{n:"\u5A01\u6D77",g:"122.093958,37.528787|13"},{n:"\u6F4D\u574A",g:"119.142634,36.716115|12"},{n:"\u70DF\u53F0",g:"121.309555,37.536562|12"},{n:"\u67A3\u5E84",g:"117.279305,34.807883|13"},{n:"\u6DC4\u535A",g:"118.059134,36.804685|12"}]},{n:"\u5C71\u897F",g:"112.515496,37.866566|7",cities:[{n:"\u592A\u539F",g:"112.550864,37.890277|12"},{n:"\u957F\u6CBB",g:"113.120292,36.201664|12"},{n:"\u5927\u540C",g:"113.290509,40.113744|12"},{n:"\u664B\u57CE",g:"112.867333,35.499834|13"},{n:"\u664B\u4E2D",g:"112.738514,37.693362|13"},{n:"\u4E34\u6C7E",g:"111.538788,36.099745|13"},{n:"\u5415\u6881",g:"111.143157,37.527316|14"},{n:"\u6714\u5DDE",g:"112.479928,39.337672|13"},{n:"\u5FFB\u5DDE",g:"112.727939,38.461031|12"},{n:"\u9633\u6CC9",g:"113.569238,37.869529|13"},{n:"\u8FD0\u57CE",g:"111.006854,35.038859|13"}]},{n:"\u9655\u897F",g:"109.503789,35.860026|7",cities:[{n:"\u897F\u5B89",g:"108.953098,34.2778|12"},{n:"\u5B89\u5EB7",g:"109.038045,32.70437|13"},{n:"\u5B9D\u9E21",g:"107.170645,34.364081|12"},{n:"\u6C49\u4E2D",g:"107.045478,33.081569|13"},{n:"\u5546\u6D1B",g:"109.934208,33.873907|13"},{n:"\u94DC\u5DDD",g:"108.968067,34.908368|13"},{n:"\u6E2D\u5357",g:"109.483933,34.502358|13"},{n:"\u54B8\u9633",g:"108.707509,34.345373|13"},{n:"\u5EF6\u5B89",g:"109.50051,36.60332|13"},{n:"\u6986\u6797",g:"109.745926,38.279439|12"}]},{n:"\u56DB\u5DDD",g:"102.89916,30.367481|7",cities:[{n:"\u6210\u90FD",g:"104.067923,30.679943|12"},{n:"\u963F\u575D\u5DDE",g:"102.228565,31.905763|15"},{n:"\u5DF4\u4E2D",g:"106.757916,31.869189|14"},{n:"\u8FBE\u5DDE",g:"107.494973,31.214199|14"},{n:"\u5FB7\u9633",g:"104.402398,31.13114|13"},{n:"\u7518\u5B5C\u5DDE",g:"101.969232,30.055144|15"},{n:"\u5E7F\u5B89",g:"106.63572,30.463984|13"},{n:"\u5E7F\u5143",g:"105.819687,32.44104|13"},{n:"\u4E50\u5C71",g:"103.760824,29.600958|13"},{n:"\u51C9\u5C71\u5DDE",g:"102.259591,27.892393|14"},{n:"\u6CF8\u5DDE",g:"105.44397,28.89593|14"},{n:"\u5357\u5145",g:"106.105554,30.800965|13"},{n:"\u7709\u5C71",g:"103.84143,30.061115|13"},{n:"\u7EF5\u9633",g:"104.705519,31.504701|12"},{n:"\u5185\u6C5F",g:"105.073056,29.599462|13"},{n:"\u6500\u679D\u82B1",g:"101.722423,26.587571|14"},{n:"\u9042\u5B81",g:"105.564888,30.557491|12"},{n:"\u96C5\u5B89",g:"103.009356,29.999716|13"},{n:"\u5B9C\u5BBE",g:"104.633019,28.769675|13"},{n:"\u8D44\u9633",g:"104.63593,30.132191|13"},{n:"\u81EA\u8D21",g:"104.776071,29.359157|13"}]},{n:"\u897F\u85CF",g:"89.137982,31.367315|6",cities:[{n:"\u62C9\u8428",g:"91.111891,29.662557|13"},{n:"\u963F\u91CC\u5730\u533A",g:"81.107669,30.404557|11"},{n:"\u660C\u90FD\u5730\u533A",g:"97.185582,31.140576|15"},{n:"\u6797\u829D\u5730\u533A",g:"94.349985,29.666941|11"},{n:"\u90A3\u66F2\u5730\u533A",g:"92.067018,31.48068|14"},{n:"\u65E5\u5580\u5219\u5730\u533A",g:"88.891486,29.269023|14"},{n:"\u5C71\u5357\u5730\u533A",g:"91.750644,29.229027|11"}]},{n:"\u65B0\u7586",g:"85.614899,42.127001|6",cities:[{n:"\u4E4C\u9C81\u6728\u9F50",g:"87.564988,43.84038|12"},{n:"\u963F\u62C9\u5C14",g:"81.291737,40.61568|13"},{n:"\u963F\u514B\u82CF\u5730\u533A",g:"80.269846,41.171731|12"},{n:"\u963F\u52D2\u6CF0\u5730\u533A",g:"88.137915,47.839744|13"},{n:"\u5DF4\u97F3\u90ED\u695E",g:"86.121688,41.771362|12"},{n:"\u535A\u5C14\u5854\u62C9\u5DDE",g:"82.052436,44.913651|11"},{n:"\u660C\u5409\u5DDE",g:"87.296038,44.007058|13"},{n:"\u54C8\u5BC6\u5730\u533A",g:"93.528355,42.858596|13"},{n:"\u548C\u7530\u5730\u533A",g:"79.930239,37.116774|13"},{n:"\u5580\u4EC0\u5730\u533A",g:"75.992973,39.470627|12"},{n:"\u514B\u62C9\u739B\u4F9D",g:"84.88118,45.594331|13"},{n:"\u514B\u5B5C\u52D2\u82CF\u5DDE",g:"76.137564,39.750346|11"},{n:"\u77F3\u6CB3\u5B50",g:"86.041865,44.308259|13"},{n:"\u5854\u57CE\u5730\u533A",g:"82.974881,46.758684|12"},{n:"\u56FE\u6728\u8212\u514B",g:"79.198155,39.889223|13"},{n:"\u5410\u9C81\u756A\u5730\u533A",g:"89.181595,42.96047|13"},{n:"\u4E94\u5BB6\u6E20",g:"87.565449,44.368899|13"},{n:"\u4F0A\u7281\u5DDE",g:"81.297854,43.922248|11"}]},{n:"\u4E91\u5357",g:"101.592952,24.864213|7",cities:[{n:"\u6606\u660E",g:"102.714601,25.049153|12"},{n:"\u4FDD\u5C71",g:"99.177996,25.120489|13"},{n:"\u695A\u96C4\u5DDE",g:"101.529382,25.066356|13"},{n:"\u5927\u7406\u5DDE",g:"100.223675,25.5969|14"},{n:"\u5FB7\u5B8F\u5DDE",g:"98.589434,24.44124|14"},{n:"\u8FEA\u5E86\u5DDE",g:"99.713682,27.831029|14"},{n:"\u7EA2\u6CB3\u5DDE",g:"103.384065,23.367718|11"},{n:"\u4E3D\u6C5F",g:"100.229628,26.875351|13"},{n:"\u4E34\u6CA7",g:"100.092613,23.887806|14"},{n:"\u6012\u6C5F\u5DDE",g:"98.859932,25.860677|14"},{n:"\u666E\u6D31",g:"100.980058,22.788778|14"},{n:"\u66F2\u9756",g:"103.782539,25.520758|12"},{n:"\u662D\u901A",g:"103.725021,27.340633|13"},{n:"\u6587\u5C71",g:"104.089112,23.401781|14"},{n:"\u897F\u53CC\u7248\u7EB3",g:"100.803038,22.009433|13"},{n:"\u7389\u6EAA",g:"102.545068,24.370447|13"}]},{n:"\u6D59\u6C5F",g:"119.957202,29.159494|8",cities:[{n:"\u676D\u5DDE",g:"120.219375,30.259244|12"},{n:"\u6E56\u5DDE",g:"120.137243,30.877925|12"},{n:"\u5609\u5174",g:"120.760428,30.773992|13"},{n:"\u91D1\u534E",g:"119.652576,29.102899|12"},{n:"\u4E3D\u6C34",g:"119.929576,28.4563|13"},{n:"\u5B81\u6CE2",g:"121.579006,29.885259|12"},{n:"\u8862\u5DDE",g:"118.875842,28.95691|12"},{n:"\u7ECD\u5174",g:"120.592467,30.002365|13"},{n:"\u53F0\u5DDE",g:"121.440613,28.668283|13"},{n:"\u6E29\u5DDE",g:"120.690635,28.002838|12"},{n:"\u821F\u5C71",g:"122.169872,30.03601|13"}]}],Ln=[{n:"\u9999\u6E2F",g:"114.186124,22.293586|11"},{n:"\u6FB3\u95E8",g:"113.557519,22.204118|13"},{n:"\u53F0\u6E7E",g:"120.961454,23.80406|8"}],Fr=void 0,ma=function(){if(Fr!==void 0)return Fr;var r=navigator.userAgent,i="Android;iPhone;SymbianOS;Windows Phone;iPad;iPod".split(";");Fr=!1;for(var t=0;t<i.length;t++)if(0<r.indexOf(i[t])){Fr=!0;break}return Fr}(),Br=void 0,xa=function(){if(Br!==void 0)return Br;var r=navigator.userAgent,i=["iPhone","iPad","iPod"];Br=!1;for(var t=0;t<i.length;t++)if(0<r.indexOf(i[t])){Br=!0;break}return Br}(),Dn=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Pi=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Rl=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ya=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),he=Array(576);Ge(he);var Or=Array(60);Ge(Or);var je=Array(512);Ge(je);var zr=Array(256);Ge(zr);var Fn=Array(29);Ge(Fn);var Si=Array(30);Ge(Si);var _a=void 0,Aa=void 0,Ta=void 0,Ir=function(r,i){r.pending_buf[r.pending++]=i&255,r.pending_buf[r.pending++]=i>>>8&255},bt=function(r,i,t){r.bi_valid>16-t?(r.bi_buf|=i<<r.bi_valid&65535,Ir(r,r.bi_buf),r.bi_buf=i>>16-r.bi_valid,r.bi_valid+=t-16):(r.bi_buf|=i<<r.bi_valid&65535,r.bi_valid+=t)},re=function(r,i,t){bt(r,t[2*i],t[2*i+1])},wa=function(r,i){var t=0;do t|=r&1,r>>>=1,t<<=1;while(0<--i);return t>>>1},Ma=function(r,i,t){var e=Array(16),a=0,n;for(n=1;15>=n;n++)e[n]=a=a+t[n-1]<<1;for(t=0;t<=i;t++)a=r[2*t+1],a!==0&&(r[2*t]=wa(e[a]++,a))},Ea=function(r){var i;for(i=0;286>i;i++)r.dyn_ltree[2*i]=0;for(i=0;30>i;i++)r.dyn_dtree[2*i]=0;for(i=0;19>i;i++)r.bl_tree[2*i]=0;r.dyn_ltree[512]=1,r.opt_len=r.static_len=0,r.last_lit=r.matches=0},Ca=function(r){8<r.bi_valid?Ir(r,r.bi_buf):0<r.bi_valid&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},Ra=function(r,i,t,e){var a=2*i,n=2*t;return r[a]<r[n]||r[a]===r[n]&&e[i]<=e[t]},Bn=function(r,i,t){for(var e=r.heap[t],a=t<<1;a<=r.heap_len&&(a<r.heap_len&&Ra(i,r.heap[a+1],r.heap[a],r.depth)&&a++,!Ra(i,e,r.heap[a],r.depth));)r.heap[t]=r.heap[a],t=a,a<<=1;r.heap[t]=e},Pa=function(r,i,t){var e=0;if(r.last_lit!==0)do{var a=r.pending_buf[r.d_buf+2*e]<<8|r.pending_buf[r.d_buf+2*e+1],n=r.pending_buf[r.l_buf+e];if(e++,a===0)re(r,n,i);else{var s=zr[n];re(r,s+256+1,i);var o=Dn[s];o!==0&&(n-=Fn[s],bt(r,n,o)),a--,s=256>a?je[a]:je[256+(a>>>7)],re(r,s,t),o=Pi[s],o!==0&&(a-=Si[s],bt(r,a,o))}}while(e<r.last_lit);re(r,256,i)},On=function(r,i){var t=i.dyn_tree,e=i.stat_desc.static_tree,a=i.stat_desc.has_stree,n=i.stat_desc.elems,s,o=-1;for(r.heap_len=0,r.heap_max=573,s=0;s<n;s++)t[2*s]!==0?(r.heap[++r.heap_len]=o=s,r.depth[s]=0):t[2*s+1]=0;for(;2>r.heap_len;){var u=r.heap[++r.heap_len]=2>o?++o:0;t[2*u]=1,r.depth[u]=0,r.opt_len--,a&&(r.static_len-=e[2*u+1])}for(i.max_code=o,s=r.heap_len>>1;1<=s;s--)Bn(r,t,s);u=n;do s=r.heap[1],r.heap[1]=r.heap[r.heap_len--],Bn(r,t,1),e=r.heap[1],r.heap[--r.heap_max]=s,r.heap[--r.heap_max]=e,t[2*u]=t[2*s]+t[2*e],r.depth[u]=(r.depth[s]>=r.depth[e]?r.depth[s]:r.depth[e])+1,t[2*s+1]=t[2*e+1]=u,r.heap[1]=u++,Bn(r,t,1);while(2<=r.heap_len);r.heap[--r.heap_max]=r.heap[1],s=i.dyn_tree,u=i.max_code,e=i.stat_desc.static_tree,a=i.stat_desc.has_stree,n=i.stat_desc.extra_bits;var f=i.stat_desc.extra_base,v=i.stat_desc.max_length,l,h=0;for(l=0;15>=l;l++)r.bl_count[l]=0;for(s[2*r.heap[r.heap_max]+1]=0,i=r.heap_max+1;573>i;i++){var d=r.heap[i];if(l=s[2*s[2*d+1]+1]+1,l>v&&(l=v,h++),s[2*d+1]=l,!(d>u)){r.bl_count[l]++;var c=0;d>=f&&(c=n[d-f]);var p=s[2*d];r.opt_len+=p*(l+c),a&&(r.static_len+=p*(e[2*d+1]+c))}}if(h!==0){do{for(l=v-1;r.bl_count[l]===0;)l--;r.bl_count[l]--,r.bl_count[l+1]+=2,r.bl_count[v]--,h-=2}while(0<h);for(l=v;l!==0;l--)for(d=r.bl_count[l];d!==0;)e=r.heap[--i],e>u||(s[2*e+1]!==l&&(r.opt_len+=(l-s[2*e+1])*s[2*e],s[2*e+1]=l),d--)}Ma(t,o,r.bl_count)},Sa=function(r,i,t){var e,a=-1,n=i[1],s=0,o=7,u=4;for(n===0&&(o=138,u=3),i[2*(t+1)+1]=65535,e=0;e<=t;e++){var f=n;n=i[2*(e+1)+1],++s<o&&f===n||(s<u?r.bl_tree[2*f]+=s:f!==0?(f!==a&&r.bl_tree[2*f]++,r.bl_tree[32]++):10>=s?r.bl_tree[34]++:r.bl_tree[36]++,s=0,a=f,n===0?(o=138,u=3):f===n?(o=6,u=3):(o=7,u=4))}},La=function(r,i,t){var e,a=-1,n=i[1],s=0,o=7,u=4;for(n===0&&(o=138,u=3),e=0;e<=t;e++){var f=n;if(n=i[2*(e+1)+1],!(++s<o&&f===n)){if(s<u)do re(r,f,r.bl_tree);while(--s!==0);else f!==0?(f!==a&&(re(r,f,r.bl_tree),s--),re(r,16,r.bl_tree),bt(r,s-3,2)):10>=s?(re(r,17,r.bl_tree),bt(r,s-3,3)):(re(r,18,r.bl_tree),bt(r,s-11,7));s=0,a=f,n===0?(o=138,u=3):f===n?(o=6,u=3):(o=7,u=4)}}},Pl=function(r){var i=4093624447,t;for(t=0;31>=t;t++,i>>>=1)if(i&1&&r.dyn_ltree[2*t]!==0)return 0;if(r.dyn_ltree[18]!==0||r.dyn_ltree[20]!==0||r.dyn_ltree[26]!==0)return 1;for(t=32;256>t;t++)if(r.dyn_ltree[2*t]!==0)return 1;return 0},Da=!1,Fa=function(r,i,t,e){bt(r,e?1:0,3),Ca(r),Ir(r,t),Ir(r,~t),r.pending_buf.set(r.window.subarray(i,i+t),r.pending),r.pending+=t},br=function(r,i,t,e){var a=r&65535|0;r=r>>>16&65535|0;for(var n;t!==0;){n=2e3<t?2e3:t,t-=n;do a=a+i[e++]|0,r=r+a|0;while(--n);a%=65521,r%=65521}return a|r<<16|0},Sl=new Uint32Array(function(){for(var r,i=[],t=0;256>t;t++){r=t;for(var e=0;8>e;e++)r=r&1?3988292384^r>>>1:r>>>1;i[t]=r}return i}()),wt=function(r,i,t,e){for(t=e+t,r^=-1;e<t;e++)r=r>>>8^Sl[(r^i[e])&255];return r^-1},He={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},K={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Me=function(r,i,t){return r.pending_buf[r.d_buf+2*r.last_lit]=i>>>8&255,r.pending_buf[r.d_buf+2*r.last_lit+1]=i&255,r.pending_buf[r.l_buf+r.last_lit]=t&255,r.last_lit++,i===0?r.dyn_ltree[2*t]++:(r.matches++,i--,r.dyn_ltree[2*(zr[t]+256+1)]++,r.dyn_dtree[2*(256>i?je[i]:je[256+(i>>>7)])]++),r.last_lit===r.lit_bufsize-1},Xe=K.Z_NO_FLUSH,Ll=K.Z_PARTIAL_FLUSH,Dl=K.Z_FULL_FLUSH,Ee=K.Z_FINISH,Ba=K.Z_BLOCK,ie=K.Z_OK,Oa=K.Z_STREAM_END,Kt=K.Z_STREAM_ERROR,Fl=K.Z_DATA_ERROR,zn=K.Z_BUF_ERROR,Bl=K.Z_DEFAULT_COMPRESSION,Ol=K.Z_FILTERED,Li=K.Z_HUFFMAN_ONLY,zl=K.Z_RLE,Il=K.Z_FIXED,bl=K.Z_DEFAULT_STRATEGY,kl=K.Z_UNKNOWN,Di=K.Z_DEFLATED,Ce=function(r,i){return r.msg=He[i],i},Re=function(r){for(var i=r.length;0<=--i;)r[i]=0},Pe=function(r,i,t){return(i<<r.hash_shift^t)&r.hash_mask},Se=function(r){var i=r.state,t=i.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+t),r.next_out),r.next_out+=t,i.pending_out+=t,r.total_out+=t,r.avail_out-=t,i.pending-=t,i.pending===0&&(i.pending_out=0))},Ct=function(r,i){var t=0<=r.block_start?r.block_start:-1,e=r.strstart-r.block_start,a=0;if(0<r.level){for(r.strm.data_type===2&&(r.strm.data_type=Pl(r)),On(r,r.l_desc),On(r,r.d_desc),Sa(r,r.dyn_ltree,r.l_desc.max_code),Sa(r,r.dyn_dtree,r.d_desc.max_code),On(r,r.bl_desc),a=18;3<=a&&r.bl_tree[2*ya[a]+1]===0;a--);r.opt_len+=3*(a+1)+14;var n=r.opt_len+3+7>>>3,s=r.static_len+3+7>>>3;s<=n&&(n=s)}else n=s=e+5;if(e+4<=n&&t!==-1)Fa(r,t,e,i);else if(r.strategy===4||s===n)bt(r,2+(i?1:0),3),Pa(r,he,Or);else{for(bt(r,4+(i?1:0),3),t=r.l_desc.max_code+1,e=r.d_desc.max_code+1,a+=1,bt(r,t-257,5),bt(r,e-1,5),bt(r,a-4,4),n=0;n<a;n++)bt(r,r.bl_tree[2*ya[n]+1],3);La(r,r.dyn_ltree,t-1),La(r,r.dyn_dtree,e-1),Pa(r,r.dyn_ltree,r.dyn_dtree)}Ea(r),i&&Ca(r),r.block_start=r.strstart,Se(r.strm)},et=function(r,i){r.pending_buf[r.pending++]=i},kr=function(r,i){r.pending_buf[r.pending++]=i>>>8&255,r.pending_buf[r.pending++]=i&255},za=function(r,i){var t=r.max_chain_length,e=r.strstart,a=r.prev_length,n=r.nice_match,s=r.strstart>r.w_size-262?r.strstart-(r.w_size-262):0,o=r.window,u=r.w_mask,f=r.prev,v=r.strstart+258,l=o[e+a-1],h=o[e+a];r.prev_length>=r.good_match&&(t>>=2),n>r.lookahead&&(n=r.lookahead);do{var d=i;if(o[d+a]===h&&o[d+a-1]===l&&o[d]===o[e]&&o[++d]===o[e+1]){for(e+=2,d++;o[++e]===o[++d]&&o[++e]===o[++d]&&o[++e]===o[++d]&&o[++e]===o[++d]&&o[++e]===o[++d]&&o[++e]===o[++d]&&o[++e]===o[++d]&&o[++e]===o[++d]&&e<v;);if(d=258-(v-e),e=v-258,d>a){if(r.match_start=i,a=d,d>=n)break;l=o[e+a-1],h=o[e+a]}}}while((i=f[i&u])>s&&--t!==0);return a<=r.lookahead?a:r.lookahead},We=function(r){var i=r.w_size,t;do{var e=r.window_size-r.lookahead-r.strstart;if(r.strstart>=i+(i-262)){r.window.set(r.window.subarray(i,i+i),0),r.match_start-=i,r.strstart-=i,r.block_start-=i;var a=t=r.hash_size;do{var n=r.head[--a];r.head[a]=n>=i?n-i:0}while(--t);a=t=i;do n=r.prev[--a],r.prev[a]=n>=i?n-i:0;while(--t);e+=i}if(r.strm.avail_in===0)break;a=r.strm,t=r.window,n=r.strstart+r.lookahead;var s=a.avail_in;if(s>e&&(s=e),s===0?t=0:(a.avail_in-=s,t.set(a.input.subarray(a.next_in,a.next_in+s),n),a.state.wrap===1?a.adler=br(a.adler,t,s,n):a.state.wrap===2&&(a.adler=wt(a.adler,t,s,n)),a.next_in+=s,a.total_in+=s,t=s),r.lookahead+=t,3<=r.lookahead+r.insert)for(e=r.strstart-r.insert,r.ins_h=r.window[e],r.ins_h=Pe(r,r.ins_h,r.window[e+1]);r.insert&&(r.ins_h=Pe(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++,r.insert--,!(3>r.lookahead+r.insert)););}while(262>r.lookahead&&r.strm.avail_in!==0)},In=function(r,i){for(var t;;){if(262>r.lookahead){if(We(r),262>r.lookahead&&i===Xe)return 1;if(r.lookahead===0)break}if(t=0,3<=r.lookahead&&(r.ins_h=Pe(r,r.ins_h,r.window[r.strstart+3-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-262&&(r.match_length=za(r,t)),3<=r.match_length)if(t=Me(r,r.strstart-r.match_start,r.match_length-3),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&3<=r.lookahead){r.match_length--;do r.strstart++,r.ins_h=Pe(r,r.ins_h,r.window[r.strstart+3-1]),r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=Pe(r,r.ins_h,r.window[r.strstart+1]);else t=Me(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(t&&(Ct(r,!1),r.strm.avail_out===0))return 1}return r.insert=2>r.strstart?r.strstart:2,i===Ee?(Ct(r,!0),r.strm.avail_out===0?3:4):r.last_lit&&(Ct(r,!1),r.strm.avail_out===0)?1:2},ir=function(r,i){for(var t,e;;){if(262>r.lookahead){if(We(r),262>r.lookahead&&i===Xe)return 1;if(r.lookahead===0)break}if(t=0,3<=r.lookahead&&(r.ins_h=Pe(r,r.ins_h,r.window[r.strstart+3-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=2,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-262&&(r.match_length=za(r,t),5>=r.match_length&&(r.strategy===Ol||r.match_length===3&&4096<r.strstart-r.match_start)&&(r.match_length=2)),3<=r.prev_length&&r.match_length<=r.prev_length){e=r.strstart+r.lookahead-3,t=Me(r,r.strstart-1-r.prev_match,r.prev_length-3),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=e&&(r.ins_h=Pe(r,r.ins_h,r.window[r.strstart+3-1]),r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=2,r.strstart++,t&&(Ct(r,!1),r.strm.avail_out===0))return 1}else if(r.match_available){if((t=Me(r,0,r.window[r.strstart-1]))&&Ct(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return 1}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(Me(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=2>r.strstart?r.strstart:2,i===Ee?(Ct(r,!0),r.strm.avail_out===0?3:4):r.last_lit&&(Ct(r,!1),r.strm.avail_out===0)?1:2},Ul=function(r,i){for(var t,e,a,n=r.window;;){if(258>=r.lookahead){if(We(r),258>=r.lookahead&&i===Xe)return 1;if(r.lookahead===0)break}if(r.match_length=0,3<=r.lookahead&&0<r.strstart&&(e=r.strstart-1,t=n[e],t===n[++e]&&t===n[++e]&&t===n[++e])){for(a=r.strstart+258;t===n[++e]&&t===n[++e]&&t===n[++e]&&t===n[++e]&&t===n[++e]&&t===n[++e]&&t===n[++e]&&t===n[++e]&&e<a;);r.match_length=258-(a-e),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(3<=r.match_length?(t=Me(r,1,r.match_length-3),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=Me(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(Ct(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,i===Ee?(Ct(r,!0),r.strm.avail_out===0?3:4):r.last_lit&&(Ct(r,!1),r.strm.avail_out===0)?1:2},Nl=function(r,i){for(var t;;){if(r.lookahead===0&&(We(r),r.lookahead===0)){if(i===Xe)return 1;break}if(r.match_length=0,t=Me(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(Ct(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,i===Ee?(Ct(r,!0),r.strm.avail_out===0?3:4):r.last_lit&&(Ct(r,!1),r.strm.avail_out===0)?1:2},Ur=[new qt(0,0,0,0,function(r,i){var t=65535;for(t>r.pending_buf_size-5&&(t=r.pending_buf_size-5);;){if(1>=r.lookahead){if(We(r),r.lookahead===0&&i===Xe)return 1;if(r.lookahead===0)break}r.strstart+=r.lookahead,r.lookahead=0;var e=r.block_start+t;if((r.strstart===0||r.strstart>=e)&&(r.lookahead=r.strstart-e,r.strstart=e,Ct(r,!1),r.strm.avail_out===0)||r.strstart-r.block_start>=r.w_size-262&&(Ct(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,i===Ee?(Ct(r,!0),r.strm.avail_out===0?3:4):(r.strstart>r.block_start&&Ct(r,!1),1)}),new qt(4,4,8,4,In),new qt(4,5,16,8,In),new qt(4,6,32,32,In),new qt(4,4,16,16,ir),new qt(8,16,32,32,ir),new qt(8,16,128,128,ir),new qt(8,32,128,256,ir),new qt(32,128,258,1024,ir),new qt(32,258,258,4096,ir)],Ia=function(r){if(!r||!r.state)return Ce(r,Kt);r.total_in=r.total_out=0,r.data_type=kl;var i=r.state;if(i.pending=0,i.pending_out=0,0>i.wrap&&(i.wrap=-i.wrap),i.status=i.wrap?42:113,r.adler=i.wrap===2?0:1,i.last_flush=Xe,!Da){var t,e,a;for(r=Array(16),a=e=0;28>a;a++)for(Fn[a]=e,t=0;t<1<<Dn[a];t++)zr[e++]=a;for(zr[e-1]=a,a=e=0;16>a;a++)for(Si[a]=e,t=0;t<1<<Pi[a];t++)je[e++]=a;for(e>>=7;30>a;a++)for(Si[a]=e<<7,t=0;t<1<<Pi[a]-7;t++)je[256+e++]=a;for(t=0;15>=t;t++)r[t]=0;for(t=0;143>=t;)he[2*t+1]=8,t++,r[8]++;for(;255>=t;)he[2*t+1]=9,t++,r[9]++;for(;279>=t;)he[2*t+1]=7,t++,r[7]++;for(;287>=t;)he[2*t+1]=8,t++,r[8]++;for(Ma(he,287,r),t=0;30>t;t++)Or[2*t+1]=5,Or[2*t]=wa(t,5);_a=new qi(he,Dn,257,286,15),Aa=new qi(Or,Pi,0,30,15),Ta=new qi([],Rl,0,19,7),Da=!0}return i.l_desc=new $i(i.dyn_ltree,_a),i.d_desc=new $i(i.dyn_dtree,Aa),i.bl_desc=new $i(i.bl_tree,Ta),i.bi_buf=0,i.bi_valid=0,Ea(i),ie},ba=function(r){var i=Ia(r);return i===ie&&(r=r.state,r.window_size=2*r.w_size,Re(r.head),r.max_lazy_match=Ur[r.level].max_lazy,r.good_match=Ur[r.level].good_length,r.nice_match=Ur[r.level].nice_length,r.max_chain_length=Ur[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),i},ka=function(r,i,t,e,a,n){if(!r)return Kt;var s=1;if(i===Bl&&(i=6),0>e?(s=0,e=-e):15<e&&(s=2,e-=16),1>a||9<a||t!==Di||8>e||15<e||0>i||9<i||0>n||n>Il)return Ce(r,Kt);e===8&&(e=9);var o=new eu;return r.state=o,o.strm=r,o.wrap=s,o.gzhead=null,o.w_bits=e,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=i,o.strategy=n,o.method=t,ba(r)},Nr={deflateInit:function(r,i){return ka(r,i,Di,15,8,bl)},deflateInit2:ka,deflateReset:ba,deflateResetKeep:Ia,deflateSetHeader:function(r,i){return!r||!r.state||r.state.wrap!==2?Kt:(r.state.gzhead=i,ie)},deflate:function(r,i){if(!r||!r.state||i>Ba||0>i)return r?Ce(r,Kt):Kt;var t=r.state;if(!r.output||!r.input&&r.avail_in!==0||t.status===666&&i!==Ee)return Ce(r,r.avail_out===0?zn:Kt);t.strm=r;var e=t.last_flush;if(t.last_flush=i,t.status===42)if(t.wrap===2)r.adler=0,et(t,31),et(t,139),et(t,8),t.gzhead?(et(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),et(t,t.gzhead.time&255),et(t,t.gzhead.time>>8&255),et(t,t.gzhead.time>>16&255),et(t,t.gzhead.time>>24&255),et(t,t.level===9?2:t.strategy>=Li||2>t.level?4:0),et(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(et(t,t.gzhead.extra.length&255),et(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(r.adler=wt(r.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69):(et(t,0),et(t,0),et(t,0),et(t,0),et(t,0),et(t,t.level===9?2:t.strategy>=Li||2>t.level?4:0),et(t,3),t.status=113);else{var a=Di+(t.w_bits-8<<4)<<8;a|=(t.strategy>=Li||2>t.level?0:6>t.level?1:t.level===6?2:3)<<6,t.strstart!==0&&(a|=32),t.status=113,kr(t,a+(31-a%31)),t.strstart!==0&&(kr(t,r.adler>>>16),kr(t,r.adler&65535)),r.adler=1}if(t.status===69)if(t.gzhead.extra){for(a=t.pending;t.gzindex<(t.gzhead.extra.length&65535)&&(t.pending!==t.pending_buf_size||(t.gzhead.hcrc&&t.pending>a&&(r.adler=wt(r.adler,t.pending_buf,t.pending-a,a)),Se(r),a=t.pending,t.pending!==t.pending_buf_size));)et(t,t.gzhead.extra[t.gzindex]&255),t.gzindex++;t.gzhead.hcrc&&t.pending>a&&(r.adler=wt(r.adler,t.pending_buf,t.pending-a,a)),t.gzindex===t.gzhead.extra.length&&(t.gzindex=0,t.status=73)}else t.status=73;if(t.status===73)if(t.gzhead.name){a=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>a&&(r.adler=wt(r.adler,t.pending_buf,t.pending-a,a)),Se(r),a=t.pending,t.pending===t.pending_buf_size)){var n=1;break}n=t.gzindex<t.gzhead.name.length?t.gzhead.name.charCodeAt(t.gzindex++)&255:0,et(t,n)}while(n!==0);t.gzhead.hcrc&&t.pending>a&&(r.adler=wt(r.adler,t.pending_buf,t.pending-a,a)),n===0&&(t.gzindex=0,t.status=91)}else t.status=91;if(t.status===91)if(t.gzhead.comment){a=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>a&&(r.adler=wt(r.adler,t.pending_buf,t.pending-a,a)),Se(r),a=t.pending,t.pending===t.pending_buf_size)){n=1;break}n=t.gzindex<t.gzhead.comment.length?t.gzhead.comment.charCodeAt(t.gzindex++)&255:0,et(t,n)}while(n!==0);t.gzhead.hcrc&&t.pending>a&&(r.adler=wt(r.adler,t.pending_buf,t.pending-a,a)),n===0&&(t.status=103)}else t.status=103;if(t.status===103&&(t.gzhead.hcrc?(t.pending+2>t.pending_buf_size&&Se(r),t.pending+2<=t.pending_buf_size&&(et(t,r.adler&255),et(t,r.adler>>8&255),r.adler=0,t.status=113)):t.status=113),t.pending!==0){if(Se(r),r.avail_out===0)return t.last_flush=-1,ie}else if(r.avail_in===0&&(i<<1)-(4<i?9:0)<=(e<<1)-(4<e?9:0)&&i!==Ee)return Ce(r,zn);if(t.status===666&&r.avail_in!==0)return Ce(r,zn);if(r.avail_in!==0||t.lookahead!==0||i!==Xe&&t.status!==666){if(e=t.strategy===Li?Nl(t,i):t.strategy===zl?Ul(t,i):Ur[t.level].func(t,i),(e===3||e===4)&&(t.status=666),e===1||e===3)return r.avail_out===0&&(t.last_flush=-1),ie;if(e===2&&(i===Ll?(bt(t,2,3),re(t,256,he),t.bi_valid===16?(Ir(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)):i!==Ba&&(Fa(t,0,0,!1),i===Dl&&(Re(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),Se(r),r.avail_out===0))return t.last_flush=-1,ie}return i!==Ee?ie:0>=t.wrap?Oa:(t.wrap===2?(et(t,r.adler&255),et(t,r.adler>>8&255),et(t,r.adler>>16&255),et(t,r.adler>>24&255),et(t,r.total_in&255),et(t,r.total_in>>8&255),et(t,r.total_in>>16&255),et(t,r.total_in>>24&255)):(kr(t,r.adler>>>16),kr(t,r.adler&65535)),Se(r),0<t.wrap&&(t.wrap=-t.wrap),t.pending!==0?ie:Oa)},deflateEnd:function(r){if(!r||!r.state)return Kt;var i=r.state.status;return i!==42&&i!==69&&i!==73&&i!==91&&i!==103&&i!==113&&i!==666?Ce(r,Kt):(r.state=null,i===113?Ce(r,Fl):ie)},deflateSetDictionary:function(r,i){var t=i.length;if(!r||!r.state)return Kt;var e=r.state,a=e.wrap;if(a===2||a===1&&e.status!==42||e.lookahead)return Kt;if(a===1&&(r.adler=br(r.adler,i,t,0)),e.wrap=0,t>=e.w_size){a===0&&(Re(e.head),e.strstart=0,e.block_start=0,e.insert=0);var n=new Uint8Array(e.w_size);n.set(i.subarray(t-e.w_size,t),0),i=n,t=e.w_size}n=r.avail_in;var s=r.next_in,o=r.input;for(r.avail_in=t,r.next_in=0,r.input=i,We(e);3<=e.lookahead;){i=e.strstart,t=e.lookahead-2;do e.ins_h=Pe(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++;while(--t);e.strstart=i,e.lookahead=2,We(e)}return e.strstart+=e.lookahead,e.block_start=e.strstart,e.insert=e.lookahead,e.lookahead=0,e.match_length=e.prev_length=2,e.match_available=0,r.next_in=s,r.input=o,r.avail_in=n,e.wrap=a,ie},deflateInfo:"pako deflate (from Nodeca project)"},Fi={assign:function(r){for(var i=Array.prototype.slice.call(arguments,1);i.length;){var t=i.shift();if(t){if((typeof t=="undefined"?"undefined":It(t))!=="object")throw new TypeError(t+"must be non-object");for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=t[e])}}return r},flattenChunks:function(r){for(var i=0,t=0,e=r.length;t<e;t++)i+=r[t].length;i=new Uint8Array(i),e=t=0;for(var a=r.length;t<a;t++){var n=r[t];i.set(n,e),e+=n.length}return i}},Ua=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(r){Ua=!1}for(var jr=new Uint8Array(256),Le=0;256>Le;Le++)jr[Le]=252<=Le?6:248<=Le?5:240<=Le?4:224<=Le?3:192<=Le?2:1;jr[254]=jr[254]=1;var Hr={string2buf:function(r){var i,t,e=r.length,a=0;for(i=0;i<e;i++){var n=r.charCodeAt(i);if((n&64512)===55296&&i+1<e){var s=r.charCodeAt(i+1);(s&64512)===56320&&(n=65536+(n-55296<<10)+(s-56320),i++)}a+=128>n?1:2048>n?2:65536>n?3:4}var o=new Uint8Array(a);for(i=t=0;t<a;i++)n=r.charCodeAt(i),(n&64512)===55296&&i+1<e&&(s=r.charCodeAt(i+1),(s&64512)===56320&&(n=65536+(n-55296<<10)+(s-56320),i++)),128>n?o[t++]=n:(2048>n?o[t++]=192|n>>>6:(65536>n?o[t++]=224|n>>>12:(o[t++]=240|n>>>18,o[t++]=128|n>>>12&63),o[t++]=128|n>>>6&63),o[t++]=128|n&63);return o},buf2string:function(r,i){var t,e,a=i||r.length;for(i=Array(2*a),t=e=0;t<a;){var n=r[t++];if(128>n)i[e++]=n;else{var s=jr[n];if(4<s)i[e++]=65533,t+=s-1;else{for(n&=s===2?31:s===3?15:7;1<s&&t<a;)n=n<<6|r[t++]&63,s--;1<s?i[e++]=65533:65536>n?i[e++]=n:(n-=65536,i[e++]=55296|n>>10&1023,i[e++]=56320|n&1023)}}}if(r=e,65534>r&&i.subarray&&Ua)i=String.fromCharCode.apply(null,i.length===r?i:i.subarray(0,r));else{for(t="",e=0;e<r;e++)t+=String.fromCharCode(i[e]);i=t}return i},utf8border:function(r,i){i=i||r.length,i>r.length&&(i=r.length);for(var t=i-1;0<=t&&(r[t]&192)===128;)t--;return 0>t||t===0?i:t+jr[r[t]]>i?t:i}},Na=function(){this.input=null,this.total_in=this.avail_in=this.next_in=0,this.output=null,this.total_out=this.avail_out=this.next_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},ja=Object.prototype.toString,jl=K.Z_NO_FLUSH,Hl=K.Z_SYNC_FLUSH,Xl=K.Z_FULL_FLUSH,Wl=K.Z_FINISH,Bi=K.Z_OK,Yl=K.Z_STREAM_END,Zl=K.Z_DEFAULT_COMPRESSION,Vl=K.Z_DEFAULT_STRATEGY,Gl=K.Z_DEFLATED;dr.prototype.push=function(r,i){var t=this.strm,e=this.options.chunkSize;if(this.ended)return!1;for(i=i===~~i?i:i===!0?Wl:jl,typeof r=="string"?t.input=Hr.string2buf(r):ja.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;)if(t.avail_out===0&&(t.output=new Uint8Array(e),t.next_out=0,t.avail_out=e),(i===Hl||i===Xl)&&6>=t.avail_out)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else{if(r=Nr.deflate(t,i),r===Yl)return 0<t.next_out&&this.onData(t.output.subarray(0,t.next_out)),r=Nr.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Bi;if(t.avail_out===0)this.onData(t.output);else if(0<i&&0<t.next_out)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else if(t.avail_in===0)break}return!0},dr.prototype.onData=function(r){this.chunks.push(r)},dr.prototype.onEnd=function(r){r===Bi&&(this.result=Fi.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};var Kl=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ql=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Jl=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ql=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Xr=function(r,i,t,e,a,n,s,o){var u=o.bits,f,v,l,h,d,c,p=0,m=new Uint16Array(16),g=new Uint16Array(16),x,y=0;for(f=0;15>=f;f++)m[f]=0;for(v=0;v<e;v++)m[i[t+v]]++;var _=u;for(l=15;1<=l&&m[l]===0;l--);if(_>l&&(_=l),l===0)return a[n++]=20971520,a[n++]=20971520,o.bits=1,0;for(u=1;u<l&&m[u]===0;u++);for(_<u&&(_=u),f=h=1;15>=f;f++)if(h<<=1,h-=m[f],0>h)return-1;if(0<h&&(r===0||l!==1))return-1;for(g[1]=0,f=1;15>f;f++)g[f+1]=g[f]+m[f];for(v=0;v<e;v++)i[t+v]!==0&&(s[g[i[t+v]]++]=v);if(r===0)var A=x=s,T=19;else r===1?(A=Kl,p-=257,x=Ql,y-=257,T=256):(A=Jl,x=ql,T=-1);v=d=0,f=u;var w=n;e=_,g=0;var E=-1,M=1<<_,P=M-1;if(r===1&&852<M||r===2&&592<M)return 1;for(;;){var R=f-g;if(s[v]<T)var L=0,S=s[v];else s[v]>T?(L=x[y+s[v]],S=A[p+s[v]]):(L=96,S=0);h=1<<f-g,u=c=1<<e;do c-=h,a[w+(d>>g)+c]=R<<24|L<<16|S|0;while(c!==0);for(h=1<<f-1;d&h;)h>>=1;if(h!==0?(d&=h-1,d+=h):d=0,v++,--m[f]===0){if(f===l)break;f=i[t+s[v]]}if(f>_&&(d&P)!==E){for(g===0&&(g=_),w+=u,e=f-g,h=1<<e;e+g<l&&(h-=m[e+g],!(0>=h));)e++,h<<=1;if(M+=1<<e,r===1&&852<M||r===2&&592<M)return 1;E=d&P,a[E]=_<<24|e<<16|w-n|0}}return d!==0&&(a[w+d]=f-g<<24|4194304),o.bits=_,0},Ha=K.Z_FINISH,$l=K.Z_BLOCK,Oi=K.Z_TREES,Ye=K.Z_OK,th=K.Z_STREAM_END,eh=K.Z_NEED_DICT,Xt=K.Z_STREAM_ERROR,Xa=K.Z_DATA_ERROR,rh=K.Z_MEM_ERROR,ih=K.Z_BUF_ERROR,Wa=K.Z_DEFLATED,Ya=function(r){return(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24)},Za=function(r){if(!r||!r.state)return Xt;var i=r.state;return r.total_in=r.total_out=i.total=0,r.msg="",i.wrap&&(r.adler=i.wrap&1),i.mode=1,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,Ye},Va=function(r){if(!r||!r.state)return Xt;var i=r.state;return i.wsize=0,i.whave=0,i.wnext=0,Za(r)},Ga=function(r,i){if(!r||!r.state)return Xt;var t=r.state;if(0>i){var e=0;i=-i}else e=(i>>4)+1,48>i&&(i&=15);return i&&(8>i||15<i)?Xt:(t.window!==null&&t.wbits!==i&&(t.window=null),t.wrap=e,t.wbits=i,Va(r))},Ka=function(r,i){if(!r)return Xt;var t=new ru;return r.state=t,t.window=null,i=Ga(r,i),i!==Ye&&(r.state=null),i},Qa=!0,bn=void 0,kn=void 0,Ja=function(r,i,t,e){var a=r.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),e>=a.wsize?(a.window.set(i.subarray(t-a.wsize,t),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>e&&(r=e),a.window.set(i.subarray(t-e,t-e+r),a.wnext),(e-=r)?(a.window.set(i.subarray(t-e,t),0),a.wnext=e,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0},fe={inflateReset:Va,inflateReset2:Ga,inflateResetKeep:Za,inflateInit:function(r){return Ka(r,15)},inflateInit2:Ka,inflate:function(r,i){var t=new Uint8Array(4),e=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!r||!r.state||!r.output||!r.input&&r.avail_in!==0)return Xt;var a=r.state;a.mode===12&&(a.mode=13);var n=r.next_out,s=r.output,o=r.avail_out,u=r.next_in,f=r.input,v=r.avail_in,l=a.hold,h=a.bits,d=v,c=o,p=Ye;t:for(;;)switch(a.mode){case 1:if(a.wrap===0){a.mode=13;break}for(;16>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if(a.wrap&2&&l===35615){a.check=0,t[0]=l&255,t[1]=l>>>8&255,a.check=wt(a.check,t,2,0),h=l=0,a.mode=2;break}if(a.flags=0,a.head&&(a.head.done=!1),!(a.wrap&1)||(((l&255)<<8)+(l>>8))%31){r.msg="incorrect header check",a.mode=30;break}if((l&15)!==Wa){r.msg="unknown compression method",a.mode=30;break}l>>>=4,h-=4;var m=(l&15)+8;if(a.wbits===0)a.wbits=m;else if(m>a.wbits){r.msg="invalid window size",a.mode=30;break}a.dmax=1<<a.wbits,r.adler=a.check=1,a.mode=l&512?10:12,h=l=0;break;case 2:for(;16>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if(a.flags=l,(a.flags&255)!==Wa){r.msg="unknown compression method",a.mode=30;break}if(a.flags&57344){r.msg="unknown header flags set",a.mode=30;break}a.head&&(a.head.text=l>>8&1),a.flags&512&&(t[0]=l&255,t[1]=l>>>8&255,a.check=wt(a.check,t,2,0)),h=l=0,a.mode=3;case 3:for(;32>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}a.head&&(a.head.time=l),a.flags&512&&(t[0]=l&255,t[1]=l>>>8&255,t[2]=l>>>16&255,t[3]=l>>>24&255,a.check=wt(a.check,t,4,0)),h=l=0,a.mode=4;case 4:for(;16>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}a.head&&(a.head.xflags=l&255,a.head.os=l>>8),a.flags&512&&(t[0]=l&255,t[1]=l>>>8&255,a.check=wt(a.check,t,2,0)),h=l=0,a.mode=5;case 5:if(a.flags&1024){for(;16>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}a.length=l,a.head&&(a.head.extra_len=l),a.flags&512&&(t[0]=l&255,t[1]=l>>>8&255,a.check=wt(a.check,t,2,0)),h=l=0}else a.head&&(a.head.extra=null);a.mode=6;case 6:if(a.flags&1024){var g=a.length;if(g>v&&(g=v),g&&(a.head&&(m=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(f.subarray(u,u+g),m)),a.flags&512&&(a.check=wt(a.check,f,g,u)),v-=g,u+=g,a.length-=g),a.length)break t}a.length=0,a.mode=7;case 7:if(a.flags&2048){if(v===0)break t;g=0;do m=f[u+g++],a.head&&m&&65536>a.length&&(a.head.name+=String.fromCharCode(m));while(m&&g<v);if(a.flags&512&&(a.check=wt(a.check,f,g,u)),v-=g,u+=g,m)break t}else a.head&&(a.head.name=null);a.length=0,a.mode=8;case 8:if(a.flags&4096){if(v===0)break t;g=0;do m=f[u+g++],a.head&&m&&65536>a.length&&(a.head.comment+=String.fromCharCode(m));while(m&&g<v);if(a.flags&512&&(a.check=wt(a.check,f,g,u)),v-=g,u+=g,m)break t}else a.head&&(a.head.comment=null);a.mode=9;case 9:if(a.flags&512){for(;16>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if(l!==(a.check&65535)){r.msg="header crc mismatch",a.mode=30;break}h=l=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),r.adler=a.check=0,a.mode=12;break;case 10:for(;32>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}r.adler=a.check=Ya(l),h=l=0,a.mode=11;case 11:if(a.havedict===0)return r.next_out=n,r.avail_out=o,r.next_in=u,r.avail_in=v,a.hold=l,a.bits=h,eh;r.adler=a.check=1,a.mode=12;case 12:if(i===$l||i===Oi)break t;case 13:if(a.last){l>>>=h&7,h-=h&7,a.mode=27;break}for(;3>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}switch(a.last=l&1,l>>>=1,--h,l&3){case 0:a.mode=14;break;case 1:if(g=a,Qa){for(bn=new Int32Array(512),kn=new Int32Array(32),m=0;144>m;)g.lens[m++]=8;for(;256>m;)g.lens[m++]=9;for(;280>m;)g.lens[m++]=7;for(;288>m;)g.lens[m++]=8;for(Xr(1,g.lens,0,288,bn,0,g.work,{bits:9}),m=0;32>m;)g.lens[m++]=5;Xr(2,g.lens,0,32,kn,0,g.work,{bits:5}),Qa=!1}if(g.lencode=bn,g.lenbits=9,g.distcode=kn,g.distbits=5,a.mode=20,i===Oi){l>>>=2,h-=2;break t}break;case 2:a.mode=17;break;case 3:r.msg="invalid block type",a.mode=30}l>>>=2,h-=2;break;case 14:for(l>>>=h&7,h-=h&7;32>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if((l&65535)!==(l>>>16^65535)){r.msg="invalid stored block lengths",a.mode=30;break}if(a.length=l&65535,h=l=0,a.mode=15,i===Oi)break t;case 15:a.mode=16;case 16:if(g=a.length){if(g>v&&(g=v),g>o&&(g=o),g===0)break t;s.set(f.subarray(u,u+g),n),v-=g,u+=g,o-=g,n+=g,a.length-=g;break}a.mode=12;break;case 17:for(;14>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if(a.nlen=(l&31)+257,l>>>=5,h-=5,a.ndist=(l&31)+1,l>>>=5,h-=5,a.ncode=(l&15)+4,l>>>=4,h-=4,286<a.nlen||30<a.ndist){r.msg="too many length or distance symbols",a.mode=30;break}a.have=0,a.mode=18;case 18:for(;a.have<a.ncode;){for(;3>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}a.lens[e[a.have++]]=l&7,l>>>=3,h-=3}for(;19>a.have;)a.lens[e[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,g={bits:a.lenbits},p=Xr(0,a.lens,0,19,a.lencode,0,a.work,g),a.lenbits=g.bits,p){r.msg="invalid code lengths set",a.mode=30;break}a.have=0,a.mode=19;case 19:for(;a.have<a.nlen+a.ndist;){for(;;){var x=a.lencode[l&(1<<a.lenbits)-1];if(g=x>>>24,x&=65535,g<=h)break;if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if(16>x)l>>>=g,h-=g,a.lens[a.have++]=x;else{if(x===16){for(m=g+2;h<m;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if(l>>>=g,h-=g,a.have===0){r.msg="invalid bit length repeat",a.mode=30;break}m=a.lens[a.have-1],g=3+(l&3),l>>>=2,h-=2}else if(x===17){for(m=g+3;h<m;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}l>>>=g,h-=g,m=0,g=3+(l&7),l>>>=3,h-=3}else{for(m=g+7;h<m;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}l>>>=g,h-=g,m=0,g=11+(l&127),l>>>=7,h-=7}if(a.have+g>a.nlen+a.ndist){r.msg="invalid bit length repeat",a.mode=30;break}for(;g--;)a.lens[a.have++]=m}}if(a.mode===30)break;if(a.lens[256]===0){r.msg="invalid code -- missing end-of-block",a.mode=30;break}if(a.lenbits=9,g={bits:a.lenbits},p=Xr(1,a.lens,0,a.nlen,a.lencode,0,a.work,g),a.lenbits=g.bits,p){r.msg="invalid literal/lengths set",a.mode=30;break}if(a.distbits=6,a.distcode=a.distdyn,g={bits:a.distbits},p=Xr(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,g),a.distbits=g.bits,p){r.msg="invalid distances set",a.mode=30;break}if(a.mode=20,i===Oi)break t;case 20:a.mode=21;case 21:if(6<=v&&258<=o){r.next_out=n,r.avail_out=o,r.next_in=u,r.avail_in=v,a.hold=l,a.bits=h,f=r;var y=f.state;s=f.next_in;var _=f.input;u=s+(f.avail_in-5),n=f.next_out;var A=f.output;v=n-(c-f.avail_out),o=n+(f.avail_out-257),l=y.dmax,h=y.wsize,g=y.whave,m=y.wnext;var T=y.window,w=y.hold,E=y.bits;x=y.lencode;var M=y.distcode,P=(1<<y.lenbits)-1,R=(1<<y.distbits)-1;e:do{15>E&&(w+=_[s++]<<E,E+=8,w+=_[s++]<<E,E+=8);var L=x[w&P];r:for(;;){var S=L>>>24;if(w>>>=S,E-=S,S=L>>>16&255,S===0)A[n++]=L&65535;else if(S&16){var k=L&65535;(S&=15)&&(E<S&&(w+=_[s++]<<E,E+=8),k+=w&(1<<S)-1,w>>>=S,E-=S),15>E&&(w+=_[s++]<<E,E+=8,w+=_[s++]<<E,E+=8),L=M[w&R];i:for(;;){if(S=L>>>24,w>>>=S,E-=S,S=L>>>16&255,S&16){if(L&=65535,S&=15,E<S&&(w+=_[s++]<<E,E+=8,E<S&&(w+=_[s++]<<E,E+=8)),L+=w&(1<<S)-1,L>l){f.msg="invalid distance too far back",y.mode=30;break e}if(w>>>=S,E-=S,S=n-v,L>S){if(S=L-S,S>g&&y.sane){f.msg="invalid distance too far back",y.mode=30;break e}var H=0,C=T;if(m===0){if(H+=h-S,S<k){k-=S;do A[n++]=T[H++];while(--S);H=n-L,C=A}}else if(m<S){if(H+=h+m-S,S-=m,S<k){k-=S;do A[n++]=T[H++];while(--S);if(H=0,m<k){S=m,k-=S;do A[n++]=T[H++];while(--S);H=n-L,C=A}}}else if(H+=m-S,S<k){k-=S;do A[n++]=T[H++];while(--S);H=n-L,C=A}for(;2<k;)A[n++]=C[H++],A[n++]=C[H++],A[n++]=C[H++],k-=3;k&&(A[n++]=C[H++],1<k&&(A[n++]=C[H++]))}else{H=n-L;do A[n++]=A[H++],A[n++]=A[H++],A[n++]=A[H++],k-=3;while(2<k);k&&(A[n++]=A[H++],1<k&&(A[n++]=A[H++]))}}else if((S&64)===0){L=M[(L&65535)+(w&(1<<S)-1)];continue i}else{f.msg="invalid distance code",y.mode=30;break e}break}}else if((S&64)===0){L=x[(L&65535)+(w&(1<<S)-1)];continue r}else{S&32?y.mode=12:(f.msg="invalid literal/length code",y.mode=30);break e}break}}while(s<u&&n<o);k=E>>3,s-=k,E-=k<<3,f.next_in=s,f.next_out=n,f.avail_in=s<u?5+(u-s):5-(s-u),f.avail_out=n<o?257+(o-n):257-(n-o),y.hold=w&(1<<E)-1,y.bits=E,n=r.next_out,s=r.output,o=r.avail_out,u=r.next_in,f=r.input,v=r.avail_in,l=a.hold,h=a.bits,a.mode===12&&(a.back=-1);break}for(a.back=0;x=a.lencode[l&(1<<a.lenbits)-1],g=x>>>24,m=x>>>16&255,x&=65535,!(g<=h);){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if(m&&(m&240)===0){for(T=g,w=m,E=x;x=a.lencode[E+((l&(1<<T+w)-1)>>T)],g=x>>>24,m=x>>>16&255,x&=65535,!(T+g<=h);){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}l>>>=T,h-=T,a.back+=T}if(l>>>=g,h-=g,a.back+=g,a.length=x,m===0){a.mode=26;break}if(m&32){a.back=-1,a.mode=12;break}if(m&64){r.msg="invalid literal/length code",a.mode=30;break}a.extra=m&15,a.mode=22;case 22:if(a.extra){for(m=a.extra;h<m;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}a.length+=l&(1<<a.extra)-1,l>>>=a.extra,h-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=23;case 23:for(;x=a.distcode[l&(1<<a.distbits)-1],g=x>>>24,m=x>>>16&255,x&=65535,!(g<=h);){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if((m&240)===0){for(T=g,w=m,E=x;x=a.distcode[E+((l&(1<<T+w)-1)>>T)],g=x>>>24,m=x>>>16&255,x&=65535,!(T+g<=h);){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}l>>>=T,h-=T,a.back+=T}if(l>>>=g,h-=g,a.back+=g,m&64){r.msg="invalid distance code",a.mode=30;break}a.offset=x,a.extra=m&15,a.mode=24;case 24:if(a.extra){for(m=a.extra;h<m;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}a.offset+=l&(1<<a.extra)-1,l>>>=a.extra,h-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){r.msg="invalid distance too far back",a.mode=30;break}a.mode=25;case 25:if(o===0)break t;if(g=c-o,a.offset>g){if(g=a.offset-g,g>a.whave&&a.sane){r.msg="invalid distance too far back",a.mode=30;break}g>a.wnext?(g-=a.wnext,m=a.wsize-g):m=a.wnext-g,g>a.length&&(g=a.length),T=a.window}else T=s,m=n-a.offset,g=a.length;g>o&&(g=o),o-=g,a.length-=g;do s[n++]=T[m++];while(--g);a.length===0&&(a.mode=21);break;case 26:if(o===0)break t;s[n++]=a.length,o--,a.mode=21;break;case 27:if(a.wrap){for(;32>h;){if(v===0)break t;v--,l|=f[u++]<<h,h+=8}if(c-=o,r.total_out+=c,a.total+=c,c&&(r.adler=a.check=a.flags?wt(a.check,s,c,n-c):br(a.check,s,c,n-c)),c=o,(a.flags?l:Ya(l))!==a.check){r.msg="incorrect data check",a.mode=30;break}h=l=0}a.mode=28;case 28:if(a.wrap&&a.flags){for(;32>h;){if(v===0)break t;v--,l+=f[u++]<<h,h+=8}if(l!==(a.total&4294967295)){r.msg="incorrect length check",a.mode=30;break}h=l=0}a.mode=29;case 29:p=th;break t;case 30:p=Xa;break t;case 31:return rh;default:return Xt}return r.next_out=n,r.avail_out=o,r.next_in=u,r.avail_in=v,a.hold=l,a.bits=h,(a.wsize||c!==r.avail_out&&30>a.mode&&(27>a.mode||i!==Ha))&&Ja(r,r.output,r.next_out,c-r.avail_out),d-=r.avail_in,c-=r.avail_out,r.total_in+=d,r.total_out+=c,a.total+=c,a.wrap&&c&&(r.adler=a.check=a.flags?wt(a.check,s,c,r.next_out-c):br(a.check,s,c,r.next_out-c)),r.data_type=a.bits+(a.last?64:0)+(a.mode===12?128:0)+(a.mode===20||a.mode===15?256:0),(d===0&&c===0||i===Ha)&&p===Ye&&(p=ih),p},inflateEnd:function(r){if(!r||!r.state)return Xt;var i=r.state;return i.window&&(i.window=null),r.state=null,Ye},inflateGetHeader:function(r,i){return!r||!r.state||(r=r.state,(r.wrap&2)===0)?Xt:(r.head=i,i.done=!1,Ye)},inflateSetDictionary:function(r,i){var t=i.length;if(!r||!r.state)return Xt;var e=r.state;if(e.wrap!==0&&e.mode!==11)return Xt;if(e.mode===11){var a=br(1,i,t,0);if(a!==e.check)return Xa}return Ja(r,i,t,t),e.havedict=1,Ye},inflateInfo:"pako inflate (from Nodeca project)"},nh=function(){this.os=this.xflags=this.time=this.text=0,this.extra=null,this.extra_len=0,this.comment=this.name="",this.hcrc=0,this.done=!1},qa=Object.prototype.toString,oh=K.Z_NO_FLUSH,ah=K.Z_FINISH,Wr=K.Z_OK,Un=K.Z_STREAM_END,Nn=K.Z_NEED_DICT,sh=K.Z_STREAM_ERROR,$a=K.Z_DATA_ERROR,uh=K.Z_MEM_ERROR;vr.prototype.push=function(r,i){var t=this.strm,e=this.options.chunkSize,a=this.options.dictionary;if(this.ended)return!1;var n=i===~~i?i:i===!0?ah:oh;for(qa.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(e),t.next_out=0,t.avail_out=e),i=fe.inflate(t,n),i===Nn&&a&&(i=fe.inflateSetDictionary(t,a),i===Wr?i=fe.inflate(t,n):i===$a&&(i=Nn));0<t.avail_in&&i===Un&&0<t.state.wrap&&r[t.next_in]!==0;)fe.inflateReset(t),i=fe.inflate(t,n);switch(i){case sh:case $a:case Nn:case uh:return this.onEnd(i),this.ended=!0,!1}var s=t.avail_out;if(t.next_out&&(t.avail_out===0||i===Un))if(this.options.to==="string"){var o=Hr.utf8border(t.output,t.next_out),u=t.next_out-o,f=Hr.buf2string(t.output,o);t.next_out=u,t.avail_out=e-u,u&&t.output.set(t.output.subarray(o,o+u),0),this.onData(f)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(i!==Wr||s!==0){if(i===Un){i=fe.inflateEnd(this.strm),this.onEnd(i),this.ended=!0;break}if(t.avail_in===0)break}}return!0},vr.prototype.onData=function(r){this.chunks.push(r)},vr.prototype.onEnd=function(r){r===Wr&&(this.result=this.options.to==="string"?this.chunks.join(""):Fi.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};var ts={Deflate:dr,deflate:tn,deflateRaw:function(r,i){return i=i||{},i.raw=!0,tn(r,i)},gzip:function(r,i){return i=i||{},i.gzip=!0,tn(r,i)},Inflate:vr,inflate:en,inflateRaw:function(r,i){return i=i||{},i.raw=!0,en(r,i)},ungzip:en,constants:K},Qt=V(function(r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setMatrixArrayType=function(n){i.ARRAY_TYPE=e=n},i.toRadian=function(n){return n*a},i.equals=function(n,s){return Math.abs(n-s)<=t*Math.max(1,Math.abs(n),Math.abs(s))},i.RANDOM=i.ARRAY_TYPE=i.EPSILON=void 0;var t=1e-6;i.EPSILON=t;var e=typeof Float32Array!="undefined"?Float32Array:Array;i.ARRAY_TYPE=e,i.RANDOM=Math.random;var a=Math.PI/180});tt(Qt);var es=V(function(r,i){function t(n,s,o){var u=s[0],f=s[1],v=s[2];s=s[3];var l=o[0],h=o[1],d=o[2];return o=o[3],n[0]=u*l+v*h,n[1]=f*l+s*h,n[2]=u*d+v*o,n[3]=f*d+s*o,n}function e(n,s,o){return n[0]=s[0]-o[0],n[1]=s[1]-o[1],n[2]=s[2]-o[2],n[3]=s[3]-o[3],n}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var n=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},i.clone=function(n){var s=new a.ARRAY_TYPE(4);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s},i.copy=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n},i.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},i.fromValues=function(n,s,o,u){var f=new a.ARRAY_TYPE(4);return f[0]=n,f[1]=s,f[2]=o,f[3]=u,f},i.set=function(n,s,o,u,f){return n[0]=s,n[1]=o,n[2]=u,n[3]=f,n},i.transpose=function(n,s){if(n===s){var o=s[1];n[1]=s[2],n[2]=o}else n[0]=s[0],n[1]=s[2],n[2]=s[1],n[3]=s[3];return n},i.invert=function(n,s){var o=s[0],u=s[1],f=s[2];s=s[3];var v=o*s-f*u;return v?(v=1/v,n[0]=s*v,n[1]=-u*v,n[2]=-f*v,n[3]=o*v,n):null},i.adjoint=function(n,s){var o=s[0];return n[0]=s[3],n[1]=-s[1],n[2]=-s[2],n[3]=o,n},i.determinant=function(n){return n[0]*n[3]-n[2]*n[1]},i.multiply=t,i.rotate=function(n,s,o){var u=s[0],f=s[1],v=s[2];s=s[3];var l=Math.sin(o);return o=Math.cos(o),n[0]=u*o+v*l,n[1]=f*o+s*l,n[2]=u*-l+v*o,n[3]=f*-l+s*o,n},i.scale=function(n,s,o){var u=s[1],f=s[2],v=s[3],l=o[0];return o=o[1],n[0]=s[0]*l,n[1]=u*l,n[2]=f*o,n[3]=v*o,n},i.fromRotation=function(n,s){var o=Math.sin(s);return s=Math.cos(s),n[0]=s,n[1]=o,n[2]=-o,n[3]=s,n},i.fromScaling=function(n,s){return n[0]=s[0],n[1]=0,n[2]=0,n[3]=s[1],n},i.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},i.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2))},i.LDU=function(n,s,o,u){return n[2]=u[2]/u[0],o[0]=u[0],o[1]=u[1],o[3]=u[3]-n[2]*o[1],[n,s,o]},i.add=function(n,s,o){return n[0]=s[0]+o[0],n[1]=s[1]+o[1],n[2]=s[2]+o[2],n[3]=s[3]+o[3],n},i.subtract=e,i.exactEquals=function(n,s){return n[0]===s[0]&&n[1]===s[1]&&n[2]===s[2]&&n[3]===s[3]},i.equals=function(n,s){var o=n[0],u=n[1],f=n[2];n=n[3];var v=s[0],l=s[1],h=s[2];return s=s[3],Math.abs(o-v)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(u-l)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(l))&&Math.abs(f-h)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(h))&&Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},i.multiplyScalar=function(n,s,o){return n[0]=s[0]*o,n[1]=s[1]*o,n[2]=s[2]*o,n[3]=s[3]*o,n},i.multiplyScalarAndAdd=function(n,s,o,u){return n[0]=s[0]+o[0]*u,n[1]=s[1]+o[1]*u,n[2]=s[2]+o[2]*u,n[3]=s[3]+o[3]*u,n},i.sub=i.mul=void 0;var a=function(n){if(n&&n.__esModule)return n;var s={};if(n!=null){for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var u=gt&&vt?vt(n,o):{};u.get||u.set?gt(s,o,u):s[o]=n[o]}}return s.default=n,s}(Qt);i.mul=t,i.sub=e});tt(es);var rs=V(function(r,i){function t(n,s,o){var u=s[0],f=s[1],v=s[2],l=s[3],h=s[4];s=s[5];var d=o[0],c=o[1],p=o[2],m=o[3],g=o[4];return o=o[5],n[0]=u*d+v*c,n[1]=f*d+l*c,n[2]=u*p+v*m,n[3]=f*p+l*m,n[4]=u*g+v*o+h,n[5]=f*g+l*o+s,n}function e(n,s,o){return n[0]=s[0]-o[0],n[1]=s[1]-o[1],n[2]=s[2]-o[2],n[3]=s[3]-o[3],n[4]=s[4]-o[4],n[5]=s[5]-o[5],n}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var n=new a.ARRAY_TYPE(6);return a.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[4]=0,n[5]=0),n[0]=1,n[3]=1,n},i.clone=function(n){var s=new a.ARRAY_TYPE(6);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s},i.copy=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n},i.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},i.fromValues=function(n,s,o,u,f,v){var l=new a.ARRAY_TYPE(6);return l[0]=n,l[1]=s,l[2]=o,l[3]=u,l[4]=f,l[5]=v,l},i.set=function(n,s,o,u,f,v,l){return n[0]=s,n[1]=o,n[2]=u,n[3]=f,n[4]=v,n[5]=l,n},i.invert=function(n,s){var o=s[0],u=s[1],f=s[2],v=s[3],l=s[4];s=s[5];var h=o*v-u*f;return h?(h=1/h,n[0]=v*h,n[1]=-u*h,n[2]=-f*h,n[3]=o*h,n[4]=(f*s-v*l)*h,n[5]=(u*l-o*s)*h,n):null},i.determinant=function(n){return n[0]*n[3]-n[1]*n[2]},i.multiply=t,i.rotate=function(n,s,o){var u=s[0],f=s[1],v=s[2],l=s[3],h=s[4];s=s[5];var d=Math.sin(o);return o=Math.cos(o),n[0]=u*o+v*d,n[1]=f*o+l*d,n[2]=u*-d+v*o,n[3]=f*-d+l*o,n[4]=h,n[5]=s,n},i.scale=function(n,s,o){var u=s[1],f=s[2],v=s[3],l=s[4],h=s[5],d=o[0];return o=o[1],n[0]=s[0]*d,n[1]=u*d,n[2]=f*o,n[3]=v*o,n[4]=l,n[5]=h,n},i.translate=function(n,s,o){var u=s[0],f=s[1],v=s[2],l=s[3],h=s[4];s=s[5];var d=o[0];return o=o[1],n[0]=u,n[1]=f,n[2]=v,n[3]=l,n[4]=u*d+v*o+h,n[5]=f*d+l*o+s,n},i.fromRotation=function(n,s){var o=Math.sin(s);return s=Math.cos(s),n[0]=s,n[1]=o,n[2]=-o,n[3]=s,n[4]=0,n[5]=0,n},i.fromScaling=function(n,s){return n[0]=s[0],n[1]=0,n[2]=0,n[3]=s[1],n[4]=0,n[5]=0,n},i.fromTranslation=function(n,s){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=s[0],n[5]=s[1],n},i.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"},i.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+1)},i.add=function(n,s,o){return n[0]=s[0]+o[0],n[1]=s[1]+o[1],n[2]=s[2]+o[2],n[3]=s[3]+o[3],n[4]=s[4]+o[4],n[5]=s[5]+o[5],n},i.subtract=e,i.multiplyScalar=function(n,s,o){return n[0]=s[0]*o,n[1]=s[1]*o,n[2]=s[2]*o,n[3]=s[3]*o,n[4]=s[4]*o,n[5]=s[5]*o,n},i.multiplyScalarAndAdd=function(n,s,o,u){return n[0]=s[0]+o[0]*u,n[1]=s[1]+o[1]*u,n[2]=s[2]+o[2]*u,n[3]=s[3]+o[3]*u,n[4]=s[4]+o[4]*u,n[5]=s[5]+o[5]*u,n},i.exactEquals=function(n,s){return n[0]===s[0]&&n[1]===s[1]&&n[2]===s[2]&&n[3]===s[3]&&n[4]===s[4]&&n[5]===s[5]},i.equals=function(n,s){var o=n[0],u=n[1],f=n[2],v=n[3],l=n[4];n=n[5];var h=s[0],d=s[1],c=s[2],p=s[3],m=s[4];return s=s[5],Math.abs(o-h)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(u-d)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))&&Math.abs(f-c)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(c))&&Math.abs(v-p)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(p))&&Math.abs(l-m)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},i.sub=i.mul=void 0;var a=function(n){if(n&&n.__esModule)return n;var s={};if(n!=null){for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var u=gt&&vt?vt(n,o):{};u.get||u.set?gt(s,o,u):s[o]=n[o]}}return s.default=n,s}(Qt);i.mul=t,i.sub=e});tt(rs);var jn=V(function(r,i){function t(n,s,o){var u=s[0],f=s[1],v=s[2],l=s[3],h=s[4],d=s[5],c=s[6],p=s[7];s=s[8];var m=o[0],g=o[1],x=o[2],y=o[3],_=o[4],A=o[5],T=o[6],w=o[7];return o=o[8],n[0]=m*u+g*l+x*c,n[1]=m*f+g*h+x*p,n[2]=m*v+g*d+x*s,n[3]=y*u+_*l+A*c,n[4]=y*f+_*h+A*p,n[5]=y*v+_*d+A*s,n[6]=T*u+w*l+o*c,n[7]=T*f+w*h+o*p,n[8]=T*v+w*d+o*s,n}function e(n,s,o){return n[0]=s[0]-o[0],n[1]=s[1]-o[1],n[2]=s[2]-o[2],n[3]=s[3]-o[3],n[4]=s[4]-o[4],n[5]=s[5]-o[5],n[6]=s[6]-o[6],n[7]=s[7]-o[7],n[8]=s[8]-o[8],n}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var n=new a.ARRAY_TYPE(9);return a.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},i.fromMat4=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[4],n[4]=s[5],n[5]=s[6],n[6]=s[8],n[7]=s[9],n[8]=s[10],n},i.clone=function(n){var s=new a.ARRAY_TYPE(9);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s},i.copy=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n},i.fromValues=function(n,s,o,u,f,v,l,h,d){var c=new a.ARRAY_TYPE(9);return c[0]=n,c[1]=s,c[2]=o,c[3]=u,c[4]=f,c[5]=v,c[6]=l,c[7]=h,c[8]=d,c},i.set=function(n,s,o,u,f,v,l,h,d,c){return n[0]=s,n[1]=o,n[2]=u,n[3]=f,n[4]=v,n[5]=l,n[6]=h,n[7]=d,n[8]=c,n},i.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},i.transpose=function(n,s){if(n===s){var o=s[1],u=s[2],f=s[5];n[1]=s[3],n[2]=s[6],n[3]=o,n[5]=s[7],n[6]=u,n[7]=f}else n[0]=s[0],n[1]=s[3],n[2]=s[6],n[3]=s[1],n[4]=s[4],n[5]=s[7],n[6]=s[2],n[7]=s[5],n[8]=s[8];return n},i.invert=function(n,s){var o=s[0],u=s[1],f=s[2],v=s[3],l=s[4],h=s[5],d=s[6],c=s[7];s=s[8];var p=s*l-h*c,m=-s*v+h*d,g=c*v-l*d,x=o*p+u*m+f*g;return x?(x=1/x,n[0]=p*x,n[1]=(-s*u+f*c)*x,n[2]=(h*u-f*l)*x,n[3]=m*x,n[4]=(s*o-f*d)*x,n[5]=(-h*o+f*v)*x,n[6]=g*x,n[7]=(-c*o+u*d)*x,n[8]=(l*o-u*v)*x,n):null},i.adjoint=function(n,s){var o=s[0],u=s[1],f=s[2],v=s[3],l=s[4],h=s[5],d=s[6],c=s[7];return s=s[8],n[0]=l*s-h*c,n[1]=f*c-u*s,n[2]=u*h-f*l,n[3]=h*d-v*s,n[4]=o*s-f*d,n[5]=f*v-o*h,n[6]=v*c-l*d,n[7]=u*d-o*c,n[8]=o*l-u*v,n},i.determinant=function(n){var s=n[3],o=n[4],u=n[5],f=n[6],v=n[7],l=n[8];return n[0]*(l*o-u*v)+n[1]*(-l*s+u*f)+n[2]*(v*s-o*f)},i.multiply=t,i.translate=function(n,s,o){var u=s[0],f=s[1],v=s[2],l=s[3],h=s[4],d=s[5],c=s[6],p=s[7];s=s[8];var m=o[0];return o=o[1],n[0]=u,n[1]=f,n[2]=v,n[3]=l,n[4]=h,n[5]=d,n[6]=m*u+o*l+c,n[7]=m*f+o*h+p,n[8]=m*v+o*d+s,n},i.rotate=function(n,s,o){var u=s[0],f=s[1],v=s[2],l=s[3],h=s[4],d=s[5],c=s[6],p=s[7];s=s[8];var m=Math.sin(o);return o=Math.cos(o),n[0]=o*u+m*l,n[1]=o*f+m*h,n[2]=o*v+m*d,n[3]=o*l-m*u,n[4]=o*h-m*f,n[5]=o*d-m*v,n[6]=c,n[7]=p,n[8]=s,n},i.scale=function(n,s,o){var u=o[0];return o=o[1],n[0]=u*s[0],n[1]=u*s[1],n[2]=u*s[2],n[3]=o*s[3],n[4]=o*s[4],n[5]=o*s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n},i.fromTranslation=function(n,s){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=s[0],n[7]=s[1],n[8]=1,n},i.fromRotation=function(n,s){var o=Math.sin(s);return s=Math.cos(s),n[0]=s,n[1]=o,n[2]=0,n[3]=-o,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},i.fromScaling=function(n,s){return n[0]=s[0],n[1]=0,n[2]=0,n[3]=0,n[4]=s[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},i.fromMat2d=function(n,s){return n[0]=s[0],n[1]=s[1],n[2]=0,n[3]=s[2],n[4]=s[3],n[5]=0,n[6]=s[4],n[7]=s[5],n[8]=1,n},i.fromQuat=function(n,s){var o=s[0],u=s[1],f=s[2];s=s[3];var v=o+o,l=u+u,h=f+f;o*=v;var d=u*v;u*=l;var c=f*v,p=f*l;return f*=h,v*=s,l*=s,s*=h,n[0]=1-u-f,n[3]=d-s,n[6]=c+l,n[1]=d+s,n[4]=1-o-f,n[7]=p-v,n[2]=c-l,n[5]=p+v,n[8]=1-o-u,n},i.normalFromMat4=function(n,s){var o=s[0],u=s[1],f=s[2],v=s[3],l=s[4],h=s[5],d=s[6],c=s[7],p=s[8],m=s[9],g=s[10],x=s[11],y=s[12],_=s[13],A=s[14];s=s[15];var T=o*h-u*l,w=o*d-f*l,E=o*c-v*l,M=u*d-f*h,P=u*c-v*h,R=f*c-v*d,L=p*_-m*y,S=p*A-g*y;p=p*s-x*y;var k=m*A-g*_;return m=m*s-x*_,g=g*s-x*A,x=T*g-w*m+E*k+M*p-P*S+R*L,x?(x=1/x,n[0]=(h*g-d*m+c*k)*x,n[1]=(d*p-l*g-c*S)*x,n[2]=(l*m-h*p+c*L)*x,n[3]=(f*m-u*g-v*k)*x,n[4]=(o*g-f*p+v*S)*x,n[5]=(u*p-o*m-v*L)*x,n[6]=(_*R-A*P+s*M)*x,n[7]=(A*E-y*R-s*w)*x,n[8]=(y*P-_*E+s*T)*x,n):null},i.projection=function(n,s,o){return n[0]=2/s,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/o,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,n},i.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"},i.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2))},i.add=function(n,s,o){return n[0]=s[0]+o[0],n[1]=s[1]+o[1],n[2]=s[2]+o[2],n[3]=s[3]+o[3],n[4]=s[4]+o[4],n[5]=s[5]+o[5],n[6]=s[6]+o[6],n[7]=s[7]+o[7],n[8]=s[8]+o[8],n},i.subtract=e,i.multiplyScalar=function(n,s,o){return n[0]=s[0]*o,n[1]=s[1]*o,n[2]=s[2]*o,n[3]=s[3]*o,n[4]=s[4]*o,n[5]=s[5]*o,n[6]=s[6]*o,n[7]=s[7]*o,n[8]=s[8]*o,n},i.multiplyScalarAndAdd=function(n,s,o,u){return n[0]=s[0]+o[0]*u,n[1]=s[1]+o[1]*u,n[2]=s[2]+o[2]*u,n[3]=s[3]+o[3]*u,n[4]=s[4]+o[4]*u,n[5]=s[5]+o[5]*u,n[6]=s[6]+o[6]*u,n[7]=s[7]+o[7]*u,n[8]=s[8]+o[8]*u,n},i.exactEquals=function(n,s){return n[0]===s[0]&&n[1]===s[1]&&n[2]===s[2]&&n[3]===s[3]&&n[4]===s[4]&&n[5]===s[5]&&n[6]===s[6]&&n[7]===s[7]&&n[8]===s[8]},i.equals=function(n,s){var o=n[0],u=n[1],f=n[2],v=n[3],l=n[4],h=n[5],d=n[6],c=n[7];n=n[8];var p=s[0],m=s[1],g=s[2],x=s[3],y=s[4],_=s[5],A=s[6],T=s[7];return s=s[8],Math.abs(o-p)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(u-m)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(f-g)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(g))&&Math.abs(v-x)<=a.EPSILON*Math.max(1,Math.abs(v),Math.abs(x))&&Math.abs(l-y)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(h-_)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(_))&&Math.abs(d-A)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(c-T)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(n-s)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},i.sub=i.mul=void 0;var a=function(n){if(n&&n.__esModule)return n;var s={};if(n!=null){for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var u=gt&&vt?vt(n,o):{};u.get||u.set?gt(s,o,u):s[o]=n[o]}}return s.default=n,s}(Qt);i.mul=t,i.sub=e});tt(jn);var Hn=V(function(r,i){function t(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function e(o,u,f){var v=u[0],l=u[1],h=u[2],d=u[3],c=u[4],p=u[5],m=u[6],g=u[7],x=u[8],y=u[9],_=u[10],A=u[11],T=u[12],w=u[13],E=u[14];u=u[15];var M=f[0],P=f[1],R=f[2],L=f[3];return o[0]=M*v+P*c+R*x+L*T,o[1]=M*l+P*p+R*y+L*w,o[2]=M*h+P*m+R*_+L*E,o[3]=M*d+P*g+R*A+L*u,M=f[4],P=f[5],R=f[6],L=f[7],o[4]=M*v+P*c+R*x+L*T,o[5]=M*l+P*p+R*y+L*w,o[6]=M*h+P*m+R*_+L*E,o[7]=M*d+P*g+R*A+L*u,M=f[8],P=f[9],R=f[10],L=f[11],o[8]=M*v+P*c+R*x+L*T,o[9]=M*l+P*p+R*y+L*w,o[10]=M*h+P*m+R*_+L*E,o[11]=M*d+P*g+R*A+L*u,M=f[12],P=f[13],R=f[14],L=f[15],o[12]=M*v+P*c+R*x+L*T,o[13]=M*l+P*p+R*y+L*w,o[14]=M*h+P*m+R*_+L*E,o[15]=M*d+P*g+R*A+L*u,o}function a(o,u,f){var v=u[0],l=u[1],h=u[2],d=u[3],c=v+v,p=l+l,m=h+h;u=v*c;var g=v*p;v*=m;var x=l*p;return l*=m,h*=m,c*=d,p*=d,d*=m,o[0]=1-(x+h),o[1]=g+d,o[2]=v-p,o[3]=0,o[4]=g-d,o[5]=1-(u+h),o[6]=l+c,o[7]=0,o[8]=v+p,o[9]=l-c,o[10]=1-(u+x),o[11]=0,o[12]=f[0],o[13]=f[1],o[14]=f[2],o[15]=1,o}function n(o,u,f){return o[0]=u[0]-f[0],o[1]=u[1]-f[1],o[2]=u[2]-f[2],o[3]=u[3]-f[3],o[4]=u[4]-f[4],o[5]=u[5]-f[5],o[6]=u[6]-f[6],o[7]=u[7]-f[7],o[8]=u[8]-f[8],o[9]=u[9]-f[9],o[10]=u[10]-f[10],o[11]=u[11]-f[11],o[12]=u[12]-f[12],o[13]=u[13]-f[13],o[14]=u[14]-f[14],o[15]=u[15]-f[15],o}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var o=new s.ARRAY_TYPE(16);return s.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},i.clone=function(o){var u=new s.ARRAY_TYPE(16);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},i.copy=function(o,u){return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=u[7],o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},i.fromValues=function(o,u,f,v,l,h,d,c,p,m,g,x,y,_,A,T){var w=new s.ARRAY_TYPE(16);return w[0]=o,w[1]=u,w[2]=f,w[3]=v,w[4]=l,w[5]=h,w[6]=d,w[7]=c,w[8]=p,w[9]=m,w[10]=g,w[11]=x,w[12]=y,w[13]=_,w[14]=A,w[15]=T,w},i.set=function(o,u,f,v,l,h,d,c,p,m,g,x,y,_,A,T,w){return o[0]=u,o[1]=f,o[2]=v,o[3]=l,o[4]=h,o[5]=d,o[6]=c,o[7]=p,o[8]=m,o[9]=g,o[10]=x,o[11]=y,o[12]=_,o[13]=A,o[14]=T,o[15]=w,o},i.identity=t,i.transpose=function(o,u){if(o===u){var f=u[1],v=u[2],l=u[3],h=u[6],d=u[7],c=u[11];o[1]=u[4],o[2]=u[8],o[3]=u[12],o[4]=f,o[6]=u[9],o[7]=u[13],o[8]=v,o[9]=h,o[11]=u[14],o[12]=l,o[13]=d,o[14]=c}else o[0]=u[0],o[1]=u[4],o[2]=u[8],o[3]=u[12],o[4]=u[1],o[5]=u[5],o[6]=u[9],o[7]=u[13],o[8]=u[2],o[9]=u[6],o[10]=u[10],o[11]=u[14],o[12]=u[3],o[13]=u[7],o[14]=u[11],o[15]=u[15];return o},i.invert=function(o,u){var f=u[0],v=u[1],l=u[2],h=u[3],d=u[4],c=u[5],p=u[6],m=u[7],g=u[8],x=u[9],y=u[10],_=u[11],A=u[12],T=u[13],w=u[14];u=u[15];var E=f*c-v*d,M=f*p-l*d,P=f*m-h*d,R=v*p-l*c,L=v*m-h*c,S=l*m-h*p,k=g*T-x*A,H=g*w-y*A,C=g*u-_*A,F=x*w-y*T,Z=x*u-_*T,Y=y*u-_*w,B=E*Y-M*Z+P*F+R*C-L*H+S*k;return B?(B=1/B,o[0]=(c*Y-p*Z+m*F)*B,o[1]=(l*Z-v*Y-h*F)*B,o[2]=(T*S-w*L+u*R)*B,o[3]=(y*L-x*S-_*R)*B,o[4]=(p*C-d*Y-m*H)*B,o[5]=(f*Y-l*C+h*H)*B,o[6]=(w*P-A*S-u*M)*B,o[7]=(g*S-y*P+_*M)*B,o[8]=(d*Z-c*C+m*k)*B,o[9]=(v*C-f*Z-h*k)*B,o[10]=(A*L-T*P+u*E)*B,o[11]=(x*P-g*L-_*E)*B,o[12]=(c*H-d*F-p*k)*B,o[13]=(f*F-v*H+l*k)*B,o[14]=(T*M-A*R-w*E)*B,o[15]=(g*R-x*M+y*E)*B,o):null},i.adjoint=function(o,u){var f=u[0],v=u[1],l=u[2],h=u[3],d=u[4],c=u[5],p=u[6],m=u[7],g=u[8],x=u[9],y=u[10],_=u[11],A=u[12],T=u[13],w=u[14];return u=u[15],o[0]=c*(y*u-_*w)-x*(p*u-m*w)+T*(p*_-m*y),o[1]=-(v*(y*u-_*w)-x*(l*u-h*w)+T*(l*_-h*y)),o[2]=v*(p*u-m*w)-c*(l*u-h*w)+T*(l*m-h*p),o[3]=-(v*(p*_-m*y)-c*(l*_-h*y)+x*(l*m-h*p)),o[4]=-(d*(y*u-_*w)-g*(p*u-m*w)+A*(p*_-m*y)),o[5]=f*(y*u-_*w)-g*(l*u-h*w)+A*(l*_-h*y),o[6]=-(f*(p*u-m*w)-d*(l*u-h*w)+A*(l*m-h*p)),o[7]=f*(p*_-m*y)-d*(l*_-h*y)+g*(l*m-h*p),o[8]=d*(x*u-_*T)-g*(c*u-m*T)+A*(c*_-m*x),o[9]=-(f*(x*u-_*T)-g*(v*u-h*T)+A*(v*_-h*x)),o[10]=f*(c*u-m*T)-d*(v*u-h*T)+A*(v*m-h*c),o[11]=-(f*(c*_-m*x)-d*(v*_-h*x)+g*(v*m-h*c)),o[12]=-(d*(x*w-y*T)-g*(c*w-p*T)+A*(c*y-p*x)),o[13]=f*(x*w-y*T)-g*(v*w-l*T)+A*(v*y-l*x),o[14]=-(f*(c*w-p*T)-d*(v*w-l*T)+A*(v*p-l*c)),o[15]=f*(c*y-p*x)-d*(v*y-l*x)+g*(v*p-l*c),o},i.determinant=function(o){var u=o[0],f=o[1],v=o[2],l=o[3],h=o[4],d=o[5],c=o[6],p=o[7],m=o[8],g=o[9],x=o[10],y=o[11],_=o[12],A=o[13],T=o[14];return o=o[15],(u*d-f*h)*(x*o-y*T)-(u*c-v*h)*(g*o-y*A)+(u*p-l*h)*(g*T-x*A)+(f*c-v*d)*(m*o-y*_)-(f*p-l*d)*(m*T-x*_)+(v*p-l*c)*(m*A-g*_)},i.multiply=e,i.translate=function(o,u,f){var v=f[0],l=f[1];if(f=f[2],u===o)o[12]=u[0]*v+u[4]*l+u[8]*f+u[12],o[13]=u[1]*v+u[5]*l+u[9]*f+u[13],o[14]=u[2]*v+u[6]*l+u[10]*f+u[14],o[15]=u[3]*v+u[7]*l+u[11]*f+u[15];else{var h=u[0],d=u[1],c=u[2],p=u[3],m=u[4],g=u[5],x=u[6],y=u[7],_=u[8],A=u[9],T=u[10],w=u[11];o[0]=h,o[1]=d,o[2]=c,o[3]=p,o[4]=m,o[5]=g,o[6]=x,o[7]=y,o[8]=_,o[9]=A,o[10]=T,o[11]=w,o[12]=h*v+m*l+_*f+u[12],o[13]=d*v+g*l+A*f+u[13],o[14]=c*v+x*l+T*f+u[14],o[15]=p*v+y*l+w*f+u[15]}return o},i.scale=function(o,u,f){var v=f[0],l=f[1];return f=f[2],o[0]=u[0]*v,o[1]=u[1]*v,o[2]=u[2]*v,o[3]=u[3]*v,o[4]=u[4]*l,o[5]=u[5]*l,o[6]=u[6]*l,o[7]=u[7]*l,o[8]=u[8]*f,o[9]=u[9]*f,o[10]=u[10]*f,o[11]=u[11]*f,o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},i.rotate=function(o,u,f,v){var l=v[0],h=v[1];v=v[2];var d=Math.sqrt(l*l+h*h+v*v);if(d<s.EPSILON)return null;d=1/d,l*=d,h*=d,v*=d;var c=Math.sin(f),p=Math.cos(f),m=1-p;f=u[0],d=u[1];var g=u[2],x=u[3],y=u[4],_=u[5],A=u[6],T=u[7],w=u[8],E=u[9],M=u[10],P=u[11],R=l*l*m+p,L=h*l*m+v*c,S=v*l*m-h*c,k=l*h*m-v*c,H=h*h*m+p,C=v*h*m+l*c,F=l*v*m+h*c;return l=h*v*m-l*c,h=v*v*m+p,o[0]=f*R+y*L+w*S,o[1]=d*R+_*L+E*S,o[2]=g*R+A*L+M*S,o[3]=x*R+T*L+P*S,o[4]=f*k+y*H+w*C,o[5]=d*k+_*H+E*C,o[6]=g*k+A*H+M*C,o[7]=x*k+T*H+P*C,o[8]=f*F+y*l+w*h,o[9]=d*F+_*l+E*h,o[10]=g*F+A*l+M*h,o[11]=x*F+T*l+P*h,u!==o&&(o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o},i.rotateX=function(o,u,f){var v=Math.sin(f);f=Math.cos(f);var l=u[4],h=u[5],d=u[6],c=u[7],p=u[8],m=u[9],g=u[10],x=u[11];return u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=l*f+p*v,o[5]=h*f+m*v,o[6]=d*f+g*v,o[7]=c*f+x*v,o[8]=p*f-l*v,o[9]=m*f-h*v,o[10]=g*f-d*v,o[11]=x*f-c*v,o},i.rotateY=function(o,u,f){var v=Math.sin(f);f=Math.cos(f);var l=u[0],h=u[1],d=u[2],c=u[3],p=u[8],m=u[9],g=u[10],x=u[11];return u!==o&&(o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=u[7],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=l*f-p*v,o[1]=h*f-m*v,o[2]=d*f-g*v,o[3]=c*f-x*v,o[8]=l*v+p*f,o[9]=h*v+m*f,o[10]=d*v+g*f,o[11]=c*v+x*f,o},i.rotateZ=function(o,u,f){var v=Math.sin(f);f=Math.cos(f);var l=u[0],h=u[1],d=u[2],c=u[3],p=u[4],m=u[5],g=u[6],x=u[7];return u!==o&&(o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=l*f+p*v,o[1]=h*f+m*v,o[2]=d*f+g*v,o[3]=c*f+x*v,o[4]=p*f-l*v,o[5]=m*f-h*v,o[6]=g*f-d*v,o[7]=x*f-c*v,o},i.fromTranslation=function(o,u){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=u[0],o[13]=u[1],o[14]=u[2],o[15]=1,o},i.fromScaling=function(o,u){return o[0]=u[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=u[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromRotation=function(o,u,f){var v=f[0],l=f[1];f=f[2];var h=Math.sqrt(v*v+l*l+f*f);if(h<s.EPSILON)return null;h=1/h,v*=h,l*=h,f*=h,h=Math.sin(u),u=Math.cos(u);var d=1-u;return o[0]=v*v*d+u,o[1]=l*v*d+f*h,o[2]=f*v*d-l*h,o[3]=0,o[4]=v*l*d-f*h,o[5]=l*l*d+u,o[6]=f*l*d+v*h,o[7]=0,o[8]=v*f*d+l*h,o[9]=l*f*d-v*h,o[10]=f*f*d+u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromXRotation=function(o,u){var f=Math.sin(u);return u=Math.cos(u),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=f,o[7]=0,o[8]=0,o[9]=-f,o[10]=u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromYRotation=function(o,u){var f=Math.sin(u);return u=Math.cos(u),o[0]=u,o[1]=0,o[2]=-f,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=f,o[9]=0,o[10]=u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromZRotation=function(o,u){var f=Math.sin(u);return u=Math.cos(u),o[0]=u,o[1]=f,o[2]=0,o[3]=0,o[4]=-f,o[5]=u,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.fromRotationTranslation=a,i.fromQuat2=function(o,u){var f=new s.ARRAY_TYPE(3),v=-u[0],l=-u[1],h=-u[2],d=u[3],c=u[4],p=u[5],m=u[6],g=u[7],x=v*v+l*l+h*h+d*d;return 0<x?(f[0]=2*(c*d+g*v+p*h-m*l)/x,f[1]=2*(p*d+g*l+m*v-c*h)/x,f[2]=2*(m*d+g*h+c*l-p*v)/x):(f[0]=2*(c*d+g*v+p*h-m*l),f[1]=2*(p*d+g*l+m*v-c*h),f[2]=2*(m*d+g*h+c*l-p*v)),a(o,u,f),o},i.getTranslation=function(o,u){return o[0]=u[12],o[1]=u[13],o[2]=u[14],o},i.getScaling=function(o,u){var f=u[0],v=u[1],l=u[2],h=u[4],d=u[5],c=u[6],p=u[8],m=u[9];return u=u[10],o[0]=Math.sqrt(f*f+v*v+l*l),o[1]=Math.sqrt(h*h+d*d+c*c),o[2]=Math.sqrt(p*p+m*m+u*u),o},i.getRotation=function(o,u){var f=u[0]+u[5]+u[10];return 0<f?(f=2*Math.sqrt(f+1),o[3]=.25*f,o[0]=(u[6]-u[9])/f,o[1]=(u[8]-u[2])/f,o[2]=(u[1]-u[4])/f):u[0]>u[5]&&u[0]>u[10]?(f=2*Math.sqrt(1+u[0]-u[5]-u[10]),o[3]=(u[6]-u[9])/f,o[0]=.25*f,o[1]=(u[1]+u[4])/f,o[2]=(u[8]+u[2])/f):u[5]>u[10]?(f=2*Math.sqrt(1+u[5]-u[0]-u[10]),o[3]=(u[8]-u[2])/f,o[0]=(u[1]+u[4])/f,o[1]=.25*f,o[2]=(u[6]+u[9])/f):(f=2*Math.sqrt(1+u[10]-u[0]-u[5]),o[3]=(u[1]-u[4])/f,o[0]=(u[8]+u[2])/f,o[1]=(u[6]+u[9])/f,o[2]=.25*f),o},i.fromRotationTranslationScale=function(o,u,f,v){var l=u[0],h=u[1],d=u[2],c=u[3],p=l+l,m=h+h,g=d+d;u=l*p;var x=l*m;l*=g;var y=h*m;h*=g,d*=g,p*=c,m*=c,c*=g,g=v[0];var _=v[1];return v=v[2],o[0]=(1-(y+d))*g,o[1]=(x+c)*g,o[2]=(l-m)*g,o[3]=0,o[4]=(x-c)*_,o[5]=(1-(u+d))*_,o[6]=(h+p)*_,o[7]=0,o[8]=(l+m)*v,o[9]=(h-p)*v,o[10]=(1-(u+y))*v,o[11]=0,o[12]=f[0],o[13]=f[1],o[14]=f[2],o[15]=1,o},i.fromRotationTranslationScaleOrigin=function(o,u,f,v,l){var h=u[0],d=u[1],c=u[2],p=u[3],m=h+h,g=d+d,x=c+c;u=h*m;var y=h*g,_=h*x;h=d*g,d*=x;var A=c*x;c=p*m,g*=p;var T=p*x,w=v[0],E=v[1];x=v[2],v=l[0],p=l[1],l=l[2],m=(1-(h+A))*w;var M=(y+T)*w;return w*=_-g,y=(y-T)*E,A=(1-(u+A))*E,E*=d+c,_=(_+g)*x,d=(d-c)*x,u=(1-(u+h))*x,o[0]=m,o[1]=M,o[2]=w,o[3]=0,o[4]=y,o[5]=A,o[6]=E,o[7]=0,o[8]=_,o[9]=d,o[10]=u,o[11]=0,o[12]=f[0]+v-(m*v+y*p+_*l),o[13]=f[1]+p-(M*v+A*p+d*l),o[14]=f[2]+l-(w*v+E*p+u*l),o[15]=1,o},i.fromQuat=function(o,u){var f=u[0],v=u[1],l=u[2];u=u[3];var h=f+f,d=v+v,c=l+l;f*=h;var p=v*h;v*=d;var m=l*h,g=l*d;return l*=c,h*=u,d*=u,u*=c,o[0]=1-v-l,o[1]=p+u,o[2]=m-d,o[3]=0,o[4]=p-u,o[5]=1-f-l,o[6]=g+h,o[7]=0,o[8]=m+d,o[9]=g-h,o[10]=1-f-v,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},i.frustum=function(o,u,f,v,l,h,d){var c=1/(f-u),p=1/(l-v),m=1/(h-d);return o[0]=2*h*c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*h*p,o[6]=0,o[7]=0,o[8]=(f+u)*c,o[9]=(l+v)*p,o[10]=(d+h)*m,o[11]=-1,o[12]=0,o[13]=0,o[14]=d*h*2*m,o[15]=0,o},i.perspective=function(o,u,f,v,l){return u=1/Math.tan(u/2),o[0]=u/f,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,l!=null&&l!==1/0?(f=1/(v-l),o[10]=(l+v)*f,o[14]=2*l*v*f):(o[10]=-1,o[14]=-2*v),o},i.perspectiveFromFieldOfView=function(o,u,f,v){var l=Math.tan(u.upDegrees*Math.PI/180),h=Math.tan(u.downDegrees*Math.PI/180),d=Math.tan(u.leftDegrees*Math.PI/180);u=Math.tan(u.rightDegrees*Math.PI/180);var c=2/(d+u),p=2/(l+h);return o[0]=c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=p,o[6]=0,o[7]=0,o[8]=-((d-u)*c*.5),o[9]=(l-h)*p*.5,o[10]=v/(f-v),o[11]=-1,o[12]=0,o[13]=0,o[14]=v*f/(f-v),o[15]=0,o},i.ortho=function(o,u,f,v,l,h,d){var c=1/(u-f),p=1/(v-l),m=1/(h-d);return o[0]=-2*c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*p,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*m,o[11]=0,o[12]=(u+f)*c,o[13]=(l+v)*p,o[14]=(d+h)*m,o[15]=1,o},i.lookAt=function(o,u,f,v){var l=u[0],h=u[1];u=u[2];var d=v[0],c=v[1],p=v[2],m=f[0];v=f[1];var g=f[2];if(Math.abs(l-m)<s.EPSILON&&Math.abs(h-v)<s.EPSILON&&Math.abs(u-g)<s.EPSILON)return t(o);f=l-m,v=h-v,m=u-g;var x=1/Math.sqrt(f*f+v*v+m*m);f*=x,v*=x,m*=x,g=c*m-p*v,p=p*f-d*m,d=d*v-c*f,(x=Math.sqrt(g*g+p*p+d*d))?(x=1/x,g*=x,p*=x,d*=x):d=p=g=0,c=v*d-m*p;var y=m*g-f*d,_=f*p-v*g;return(x=Math.sqrt(c*c+y*y+_*_))?(x=1/x,c*=x,y*=x,_*=x):_=y=c=0,o[0]=g,o[1]=c,o[2]=f,o[3]=0,o[4]=p,o[5]=y,o[6]=v,o[7]=0,o[8]=d,o[9]=_,o[10]=m,o[11]=0,o[12]=-(g*l+p*h+d*u),o[13]=-(c*l+y*h+_*u),o[14]=-(f*l+v*h+m*u),o[15]=1,o},i.targetTo=function(o,u,f,v){var l=u[0],h=u[1];u=u[2];var d=v[0],c=v[1],p=v[2];v=l-f[0];var m=h-f[1];f=u-f[2];var g=v*v+m*m+f*f;0<g&&(g=1/Math.sqrt(g),v*=g,m*=g,f*=g);var x=c*f-p*m;return p=p*v-d*f,d=d*m-c*v,g=x*x+p*p+d*d,0<g&&(g=1/Math.sqrt(g),x*=g,p*=g,d*=g),o[0]=x,o[1]=p,o[2]=d,o[3]=0,o[4]=m*d-f*p,o[5]=f*x-v*d,o[6]=v*p-m*x,o[7]=0,o[8]=v,o[9]=m,o[10]=f,o[11]=0,o[12]=l,o[13]=h,o[14]=u,o[15]=1,o},i.str=function(o){return"mat4("+o[0]+", "+o[1]+", "+o[2]+", "+o[3]+", "+o[4]+", "+o[5]+", "+o[6]+", "+o[7]+", "+o[8]+", "+o[9]+", "+o[10]+", "+o[11]+", "+o[12]+", "+o[13]+", "+o[14]+", "+o[15]+")"},i.frob=function(o){return Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)+Math.pow(o[2],2)+Math.pow(o[3],2)+Math.pow(o[4],2)+Math.pow(o[5],2)+Math.pow(o[6],2)+Math.pow(o[7],2)+Math.pow(o[8],2)+Math.pow(o[9],2)+Math.pow(o[10],2)+Math.pow(o[11],2)+Math.pow(o[12],2)+Math.pow(o[13],2)+Math.pow(o[14],2)+Math.pow(o[15],2))},i.add=function(o,u,f){return o[0]=u[0]+f[0],o[1]=u[1]+f[1],o[2]=u[2]+f[2],o[3]=u[3]+f[3],o[4]=u[4]+f[4],o[5]=u[5]+f[5],o[6]=u[6]+f[6],o[7]=u[7]+f[7],o[8]=u[8]+f[8],o[9]=u[9]+f[9],o[10]=u[10]+f[10],o[11]=u[11]+f[11],o[12]=u[12]+f[12],o[13]=u[13]+f[13],o[14]=u[14]+f[14],o[15]=u[15]+f[15],o},i.subtract=n,i.multiplyScalar=function(o,u,f){return o[0]=u[0]*f,o[1]=u[1]*f,o[2]=u[2]*f,o[3]=u[3]*f,o[4]=u[4]*f,o[5]=u[5]*f,o[6]=u[6]*f,o[7]=u[7]*f,o[8]=u[8]*f,o[9]=u[9]*f,o[10]=u[10]*f,o[11]=u[11]*f,o[12]=u[12]*f,o[13]=u[13]*f,o[14]=u[14]*f,o[15]=u[15]*f,o},i.multiplyScalarAndAdd=function(o,u,f,v){return o[0]=u[0]+f[0]*v,o[1]=u[1]+f[1]*v,o[2]=u[2]+f[2]*v,o[3]=u[3]+f[3]*v,o[4]=u[4]+f[4]*v,o[5]=u[5]+f[5]*v,o[6]=u[6]+f[6]*v,o[7]=u[7]+f[7]*v,o[8]=u[8]+f[8]*v,o[9]=u[9]+f[9]*v,o[10]=u[10]+f[10]*v,o[11]=u[11]+f[11]*v,o[12]=u[12]+f[12]*v,o[13]=u[13]+f[13]*v,o[14]=u[14]+f[14]*v,o[15]=u[15]+f[15]*v,o},i.exactEquals=function(o,u){return o[0]===u[0]&&o[1]===u[1]&&o[2]===u[2]&&o[3]===u[3]&&o[4]===u[4]&&o[5]===u[5]&&o[6]===u[6]&&o[7]===u[7]&&o[8]===u[8]&&o[9]===u[9]&&o[10]===u[10]&&o[11]===u[11]&&o[12]===u[12]&&o[13]===u[13]&&o[14]===u[14]&&o[15]===u[15]},i.equals=function(o,u){var f=o[0],v=o[1],l=o[2],h=o[3],d=o[4],c=o[5],p=o[6],m=o[7],g=o[8],x=o[9],y=o[10],_=o[11],A=o[12],T=o[13],w=o[14];o=o[15];var E=u[0],M=u[1],P=u[2],R=u[3],L=u[4],S=u[5],k=u[6],H=u[7],C=u[8],F=u[9],Z=u[10],Y=u[11],B=u[12],Yt=u[13],st=u[14];return u=u[15],Math.abs(f-E)<=s.EPSILON*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(v-M)<=s.EPSILON*Math.max(1,Math.abs(v),Math.abs(M))&&Math.abs(l-P)<=s.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(h-R)<=s.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(d-L)<=s.EPSILON*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(c-S)<=s.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(p-k)<=s.EPSILON*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(m-H)<=s.EPSILON*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(g-C)<=s.EPSILON*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(x-F)<=s.EPSILON*Math.max(1,Math.abs(x),Math.abs(F))&&Math.abs(y-Z)<=s.EPSILON*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(_-Y)<=s.EPSILON*Math.max(1,Math.abs(_),Math.abs(Y))&&Math.abs(A-B)<=s.EPSILON*Math.max(1,Math.abs(A),Math.abs(B))&&Math.abs(T-Yt)<=s.EPSILON*Math.max(1,Math.abs(T),Math.abs(Yt))&&Math.abs(w-st)<=s.EPSILON*Math.max(1,Math.abs(w),Math.abs(st))&&Math.abs(o-u)<=s.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},i.sub=i.mul=void 0;var s=function(o){if(o&&o.__esModule)return o;var u={};if(o!=null){for(var f in o)if(Object.prototype.hasOwnProperty.call(o,f)){var v=gt&&vt?vt(o,f):{};v.get||v.set?gt(u,f,v):u[f]=o[f]}}return u.default=o,u}(Qt);i.mul=e,i.sub=n});tt(Hn);var Xn=V(function(r,i){function t(){var c=new d.ARRAY_TYPE(3);return d.ARRAY_TYPE!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function e(c){var p=c[0],m=c[1];return c=c[2],Math.sqrt(p*p+m*m+c*c)}function a(c,p,m){var g=new d.ARRAY_TYPE(3);return g[0]=c,g[1]=p,g[2]=m,g}function n(c,p,m){return c[0]=p[0]-m[0],c[1]=p[1]-m[1],c[2]=p[2]-m[2],c}function s(c,p,m){return c[0]=p[0]*m[0],c[1]=p[1]*m[1],c[2]=p[2]*m[2],c}function o(c,p,m){return c[0]=p[0]/m[0],c[1]=p[1]/m[1],c[2]=p[2]/m[2],c}function u(c,p){var m=p[0]-c[0],g=p[1]-c[1];return c=p[2]-c[2],Math.sqrt(m*m+g*g+c*c)}function f(c,p){var m=p[0]-c[0],g=p[1]-c[1];return c=p[2]-c[2],m*m+g*g+c*c}function v(c){var p=c[0],m=c[1];return c=c[2],p*p+m*m+c*c}function l(c,p){var m=p[0],g=p[1],x=p[2];return m=m*m+g*g+x*x,0<m&&(m=1/Math.sqrt(m)),c[0]=p[0]*m,c[1]=p[1]*m,c[2]=p[2]*m,c}function h(c,p){return c[0]*p[0]+c[1]*p[1]+c[2]*p[2]}Object.defineProperty(i,"__esModule",{value:!0}),i.create=t,i.clone=function(c){var p=new d.ARRAY_TYPE(3);return p[0]=c[0],p[1]=c[1],p[2]=c[2],p},i.length=e,i.fromValues=a,i.copy=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c},i.set=function(c,p,m,g){return c[0]=p,c[1]=m,c[2]=g,c},i.add=function(c,p,m){return c[0]=p[0]+m[0],c[1]=p[1]+m[1],c[2]=p[2]+m[2],c},i.subtract=n,i.multiply=s,i.divide=o,i.ceil=function(c,p){return c[0]=Math.ceil(p[0]),c[1]=Math.ceil(p[1]),c[2]=Math.ceil(p[2]),c},i.floor=function(c,p){return c[0]=Math.floor(p[0]),c[1]=Math.floor(p[1]),c[2]=Math.floor(p[2]),c},i.min=function(c,p,m){return c[0]=Math.min(p[0],m[0]),c[1]=Math.min(p[1],m[1]),c[2]=Math.min(p[2],m[2]),c},i.max=function(c,p,m){return c[0]=Math.max(p[0],m[0]),c[1]=Math.max(p[1],m[1]),c[2]=Math.max(p[2],m[2]),c},i.round=function(c,p){return c[0]=Math.round(p[0]),c[1]=Math.round(p[1]),c[2]=Math.round(p[2]),c},i.scale=function(c,p,m){return c[0]=p[0]*m,c[1]=p[1]*m,c[2]=p[2]*m,c},i.scaleAndAdd=function(c,p,m,g){return c[0]=p[0]+m[0]*g,c[1]=p[1]+m[1]*g,c[2]=p[2]+m[2]*g,c},i.distance=u,i.squaredDistance=f,i.squaredLength=v,i.negate=function(c,p){return c[0]=-p[0],c[1]=-p[1],c[2]=-p[2],c},i.inverse=function(c,p){return c[0]=1/p[0],c[1]=1/p[1],c[2]=1/p[2],c},i.normalize=l,i.dot=h,i.cross=function(c,p,m){var g=p[0],x=p[1];p=p[2];var y=m[0],_=m[1];return m=m[2],c[0]=x*m-p*_,c[1]=p*y-g*m,c[2]=g*_-x*y,c},i.lerp=function(c,p,m,g){var x=p[0],y=p[1];return p=p[2],c[0]=x+g*(m[0]-x),c[1]=y+g*(m[1]-y),c[2]=p+g*(m[2]-p),c},i.hermite=function(c,p,m,g,x,y){var _=y*y,A=_*(2*y-3)+1,T=_*(y-2)+y,w=_*(y-1);return y=_*(3-2*y),c[0]=p[0]*A+m[0]*T+g[0]*w+x[0]*y,c[1]=p[1]*A+m[1]*T+g[1]*w+x[1]*y,c[2]=p[2]*A+m[2]*T+g[2]*w+x[2]*y,c},i.bezier=function(c,p,m,g,x,y){var _=1-y,A=_*_,T=y*y,w=A*_;return A*=3*y,_*=3*T,y*=T,c[0]=p[0]*w+m[0]*A+g[0]*_+x[0]*y,c[1]=p[1]*w+m[1]*A+g[1]*_+x[1]*y,c[2]=p[2]*w+m[2]*A+g[2]*_+x[2]*y,c},i.random=function(c,p){p=p||1;var m=2*d.RANDOM()*Math.PI,g=2*d.RANDOM()-1,x=Math.sqrt(1-g*g)*p;return c[0]=Math.cos(m)*x,c[1]=Math.sin(m)*x,c[2]=g*p,c},i.transformMat4=function(c,p,m){var g=p[0],x=p[1];p=p[2];var y=m[3]*g+m[7]*x+m[11]*p+m[15];return y=y||1,c[0]=(m[0]*g+m[4]*x+m[8]*p+m[12])/y,c[1]=(m[1]*g+m[5]*x+m[9]*p+m[13])/y,c[2]=(m[2]*g+m[6]*x+m[10]*p+m[14])/y,c},i.transformMat3=function(c,p,m){var g=p[0],x=p[1];return p=p[2],c[0]=g*m[0]+x*m[3]+p*m[6],c[1]=g*m[1]+x*m[4]+p*m[7],c[2]=g*m[2]+x*m[5]+p*m[8],c},i.transformQuat=function(c,p,m){var g=m[0],x=m[1],y=m[2],_=p[0],A=p[1];p=p[2];var T=x*p-y*A,w=y*_-g*p,E=g*A-x*_;return m=2*m[3],c[0]=_+T*m+2*(x*E-y*w),c[1]=A+w*m+2*(y*T-g*E),c[2]=p+E*m+2*(g*w-x*T),c},i.rotateX=function(c,p,m,g){var x=[],y=[];return x[0]=p[0]-m[0],x[1]=p[1]-m[1],x[2]=p[2]-m[2],y[0]=x[0],y[1]=x[1]*Math.cos(g)-x[2]*Math.sin(g),y[2]=x[1]*Math.sin(g)+x[2]*Math.cos(g),c[0]=y[0]+m[0],c[1]=y[1]+m[1],c[2]=y[2]+m[2],c},i.rotateY=function(c,p,m,g){var x=[],y=[];return x[0]=p[0]-m[0],x[1]=p[1]-m[1],x[2]=p[2]-m[2],y[0]=x[2]*Math.sin(g)+x[0]*Math.cos(g),y[1]=x[1],y[2]=x[2]*Math.cos(g)-x[0]*Math.sin(g),c[0]=y[0]+m[0],c[1]=y[1]+m[1],c[2]=y[2]+m[2],c},i.rotateZ=function(c,p,m,g){var x=[],y=[];return x[0]=p[0]-m[0],x[1]=p[1]-m[1],x[2]=p[2]-m[2],y[0]=x[0]*Math.cos(g)-x[1]*Math.sin(g),y[1]=x[0]*Math.sin(g)+x[1]*Math.cos(g),y[2]=x[2],c[0]=y[0]+m[0],c[1]=y[1]+m[1],c[2]=y[2]+m[2],c},i.angle=function(c,p){return c=a(c[0],c[1],c[2]),p=a(p[0],p[1],p[2]),l(c,c),l(p,p),p=h(c,p),1<p?0:-1>p?Math.PI:Math.acos(p)},i.zero=function(c){return c[0]=0,c[1]=0,c[2]=0,c},i.str=function(c){return"vec3("+c[0]+", "+c[1]+", "+c[2]+")"},i.exactEquals=function(c,p){return c[0]===p[0]&&c[1]===p[1]&&c[2]===p[2]},i.equals=function(c,p){var m=c[0],g=c[1];c=c[2];var x=p[0],y=p[1];return p=p[2],Math.abs(m-x)<=d.EPSILON*Math.max(1,Math.abs(m),Math.abs(x))&&Math.abs(g-y)<=d.EPSILON*Math.max(1,Math.abs(g),Math.abs(y))&&Math.abs(c-p)<=d.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))},i.forEach=i.sqrLen=i.len=i.sqrDist=i.dist=i.div=i.mul=i.sub=void 0;var d=function(c){if(c&&c.__esModule)return c;var p={};if(c!=null){for(var m in c)if(Object.prototype.hasOwnProperty.call(c,m)){var g=gt&&vt?vt(c,m):{};g.get||g.set?gt(p,m,g):p[m]=c[m]}}return p.default=c,p}(Qt);i.sub=n,i.mul=s,i.div=o,i.dist=u,i.sqrDist=f,i.len=e,i.sqrLen=v,r=function(){var c=t();return function(p,m,g,x,y,_){for(m||(m=3),g||(g=0),x=x?Math.min(x*m+g,p.length):p.length;g<x;g+=m)c[0]=p[g],c[1]=p[g+1],c[2]=p[g+2],y(c,c,_),p[g]=c[0],p[g+1]=c[1],p[g+2]=c[2];return p}}(),i.forEach=r});tt(Xn);var Wn=V(function(r,i){function t(){var l=new v.ARRAY_TYPE(4);return v.ARRAY_TYPE!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function e(l,h,d){return l[0]=h[0]-d[0],l[1]=h[1]-d[1],l[2]=h[2]-d[2],l[3]=h[3]-d[3],l}function a(l,h,d){return l[0]=h[0]*d[0],l[1]=h[1]*d[1],l[2]=h[2]*d[2],l[3]=h[3]*d[3],l}function n(l,h,d){return l[0]=h[0]/d[0],l[1]=h[1]/d[1],l[2]=h[2]/d[2],l[3]=h[3]/d[3],l}function s(l,h){var d=h[0]-l[0],c=h[1]-l[1],p=h[2]-l[2];return l=h[3]-l[3],Math.sqrt(d*d+c*c+p*p+l*l)}function o(l,h){var d=h[0]-l[0],c=h[1]-l[1],p=h[2]-l[2];return l=h[3]-l[3],d*d+c*c+p*p+l*l}function u(l){var h=l[0],d=l[1],c=l[2];return l=l[3],Math.sqrt(h*h+d*d+c*c+l*l)}function f(l){var h=l[0],d=l[1],c=l[2];return l=l[3],h*h+d*d+c*c+l*l}Object.defineProperty(i,"__esModule",{value:!0}),i.create=t,i.clone=function(l){var h=new v.ARRAY_TYPE(4);return h[0]=l[0],h[1]=l[1],h[2]=l[2],h[3]=l[3],h},i.fromValues=function(l,h,d,c){var p=new v.ARRAY_TYPE(4);return p[0]=l,p[1]=h,p[2]=d,p[3]=c,p},i.copy=function(l,h){return l[0]=h[0],l[1]=h[1],l[2]=h[2],l[3]=h[3],l},i.set=function(l,h,d,c,p){return l[0]=h,l[1]=d,l[2]=c,l[3]=p,l},i.add=function(l,h,d){return l[0]=h[0]+d[0],l[1]=h[1]+d[1],l[2]=h[2]+d[2],l[3]=h[3]+d[3],l},i.subtract=e,i.multiply=a,i.divide=n,i.ceil=function(l,h){return l[0]=Math.ceil(h[0]),l[1]=Math.ceil(h[1]),l[2]=Math.ceil(h[2]),l[3]=Math.ceil(h[3]),l},i.floor=function(l,h){return l[0]=Math.floor(h[0]),l[1]=Math.floor(h[1]),l[2]=Math.floor(h[2]),l[3]=Math.floor(h[3]),l},i.min=function(l,h,d){return l[0]=Math.min(h[0],d[0]),l[1]=Math.min(h[1],d[1]),l[2]=Math.min(h[2],d[2]),l[3]=Math.min(h[3],d[3]),l},i.max=function(l,h,d){return l[0]=Math.max(h[0],d[0]),l[1]=Math.max(h[1],d[1]),l[2]=Math.max(h[2],d[2]),l[3]=Math.max(h[3],d[3]),l},i.round=function(l,h){return l[0]=Math.round(h[0]),l[1]=Math.round(h[1]),l[2]=Math.round(h[2]),l[3]=Math.round(h[3]),l},i.scale=function(l,h,d){return l[0]=h[0]*d,l[1]=h[1]*d,l[2]=h[2]*d,l[3]=h[3]*d,l},i.scaleAndAdd=function(l,h,d,c){return l[0]=h[0]+d[0]*c,l[1]=h[1]+d[1]*c,l[2]=h[2]+d[2]*c,l[3]=h[3]+d[3]*c,l},i.distance=s,i.squaredDistance=o,i.length=u,i.squaredLength=f,i.negate=function(l,h){return l[0]=-h[0],l[1]=-h[1],l[2]=-h[2],l[3]=-h[3],l},i.inverse=function(l,h){return l[0]=1/h[0],l[1]=1/h[1],l[2]=1/h[2],l[3]=1/h[3],l},i.normalize=function(l,h){var d=h[0],c=h[1],p=h[2];h=h[3];var m=d*d+c*c+p*p+h*h;return 0<m&&(m=1/Math.sqrt(m)),l[0]=d*m,l[1]=c*m,l[2]=p*m,l[3]=h*m,l},i.dot=function(l,h){return l[0]*h[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]},i.cross=function(l,h,d,c){var p=d[0]*c[1]-d[1]*c[0],m=d[0]*c[2]-d[2]*c[0],g=d[0]*c[3]-d[3]*c[0],x=d[1]*c[2]-d[2]*c[1],y=d[1]*c[3]-d[3]*c[1];d=d[2]*c[3]-d[3]*c[2],c=h[0];var _=h[1],A=h[2];return h=h[3],l[0]=_*d-A*y+h*x,l[1]=-(c*d)+A*g-h*m,l[2]=c*y-_*g+h*p,l[3]=-(c*x)+_*m-A*p,l},i.lerp=function(l,h,d,c){var p=h[0],m=h[1],g=h[2];return h=h[3],l[0]=p+c*(d[0]-p),l[1]=m+c*(d[1]-m),l[2]=g+c*(d[2]-g),l[3]=h+c*(d[3]-h),l},i.random=function(l,h){h=h||1;do var d=2*v.RANDOM()-1,c=2*v.RANDOM()-1,p=d*d+c*c;while(1<=p);do var m=2*v.RANDOM()-1,g=2*v.RANDOM()-1,x=m*m+g*g;while(1<=x);return p=Math.sqrt((1-p)/x),l[0]=h*d,l[1]=h*c,l[2]=h*m*p,l[3]=h*g*p,l},i.transformMat4=function(l,h,d){var c=h[0],p=h[1],m=h[2];return h=h[3],l[0]=d[0]*c+d[4]*p+d[8]*m+d[12]*h,l[1]=d[1]*c+d[5]*p+d[9]*m+d[13]*h,l[2]=d[2]*c+d[6]*p+d[10]*m+d[14]*h,l[3]=d[3]*c+d[7]*p+d[11]*m+d[15]*h,l},i.transformQuat=function(l,h,d){var c=h[0],p=h[1],m=h[2],g=d[0],x=d[1],y=d[2];d=d[3];var _=d*c+x*m-y*p,A=d*p+y*c-g*m,T=d*m+g*p-x*c;return c=-g*c-x*p-y*m,l[0]=_*d+c*-g+A*-y-T*-x,l[1]=A*d+c*-x+T*-g-_*-y,l[2]=T*d+c*-y+_*-x-A*-g,l[3]=h[3],l},i.zero=function(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=0,l},i.str=function(l){return"vec4("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},i.exactEquals=function(l,h){return l[0]===h[0]&&l[1]===h[1]&&l[2]===h[2]&&l[3]===h[3]},i.equals=function(l,h){var d=l[0],c=l[1],p=l[2];l=l[3];var m=h[0],g=h[1],x=h[2];return h=h[3],Math.abs(d-m)<=v.EPSILON*Math.max(1,Math.abs(d),Math.abs(m))&&Math.abs(c-g)<=v.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(p-x)<=v.EPSILON*Math.max(1,Math.abs(p),Math.abs(x))&&Math.abs(l-h)<=v.EPSILON*Math.max(1,Math.abs(l),Math.abs(h))},i.forEach=i.sqrLen=i.len=i.sqrDist=i.dist=i.div=i.mul=i.sub=void 0;var v=function(l){if(l&&l.__esModule)return l;var h={};if(l!=null){for(var d in l)if(Object.prototype.hasOwnProperty.call(l,d)){var c=gt&&vt?vt(l,d):{};c.get||c.set?gt(h,d,c):h[d]=l[d]}}return h.default=l,h}(Qt);i.sub=e,i.mul=a,i.div=n,i.dist=s,i.sqrDist=o,i.len=u,i.sqrLen=f,r=function(){var l=t();return function(h,d,c,p,m,g){for(d||(d=4),c||(c=0),p=p?Math.min(p*d+c,h.length):h.length;c<p;c+=d)l[0]=h[c],l[1]=h[c+1],l[2]=h[c+2],l[3]=h[c+3],m(l,l,g),h[c]=l[0],h[c+1]=l[1],h[c+2]=l[2],h[c+3]=l[3];return h}}(),i.forEach=r});tt(Wn);var Yn=V(function(r,i){function t(d){if(d&&d.__esModule)return d;var c={};if(d!=null){for(var p in d)if(Object.prototype.hasOwnProperty.call(d,p)){var m=gt&&vt?vt(d,p):{};m.get||m.set?gt(c,p,m):c[p]=d[p]}}return c.default=d,c}function e(){var d=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(d[0]=0,d[1]=0,d[2]=0),d[3]=1,d}function a(d,c,p){p*=.5;var m=Math.sin(p);return d[0]=m*c[0],d[1]=m*c[1],d[2]=m*c[2],d[3]=Math.cos(p),d}function n(d,c,p){var m=c[0],g=c[1],x=c[2];c=c[3];var y=p[0],_=p[1],A=p[2];return p=p[3],d[0]=m*p+c*y+g*A-x*_,d[1]=g*p+c*_+x*y-m*A,d[2]=x*p+c*A+m*_-g*y,d[3]=c*p-m*y-g*_-x*A,d}function s(d,c,p,m){var g=c[0],x=c[1],y=c[2];c=c[3];var _=p[0],A=p[1],T=p[2];p=p[3];var w=g*_+x*A+y*T+c*p;if(0>w&&(w=-w,_=-_,A=-A,T=-T,p=-p),1-w>u.EPSILON){var E=Math.acos(w),M=Math.sin(E);w=Math.sin((1-m)*E)/M,m=Math.sin(m*E)/M}else w=1-m;return d[0]=w*g+m*_,d[1]=w*x+m*A,d[2]=w*y+m*T,d[3]=w*c+m*p,d}function o(d,c){var p=c[0]+c[4]+c[8];if(0<p)p=Math.sqrt(p+1),d[3]=.5*p,p=.5/p,d[0]=(c[5]-c[7])*p,d[1]=(c[6]-c[2])*p,d[2]=(c[1]-c[3])*p;else{var m=0;c[4]>c[0]&&(m=1),c[8]>c[3*m+m]&&(m=2);var g=(m+1)%3,x=(m+2)%3;p=Math.sqrt(c[3*m+m]-c[3*g+g]-c[3*x+x]+1),d[m]=.5*p,p=.5/p,d[3]=(c[3*g+x]-c[3*x+g])*p,d[g]=(c[3*g+m]+c[3*m+g])*p,d[x]=(c[3*x+m]+c[3*m+x])*p}return d}Object.defineProperty(i,"__esModule",{value:!0}),i.create=e,i.identity=function(d){return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d},i.setAxisAngle=a,i.getAxisAngle=function(d,c){var p=2*Math.acos(c[3]),m=Math.sin(p/2);return m>u.EPSILON?(d[0]=c[0]/m,d[1]=c[1]/m,d[2]=c[2]/m):(d[0]=1,d[1]=0,d[2]=0),p},i.multiply=n,i.rotateX=function(d,c,p){p*=.5;var m=c[0],g=c[1],x=c[2];c=c[3];var y=Math.sin(p);return p=Math.cos(p),d[0]=m*p+c*y,d[1]=g*p+x*y,d[2]=x*p-g*y,d[3]=c*p-m*y,d},i.rotateY=function(d,c,p){p*=.5;var m=c[0],g=c[1],x=c[2];c=c[3];var y=Math.sin(p);return p=Math.cos(p),d[0]=m*p-x*y,d[1]=g*p+c*y,d[2]=x*p+m*y,d[3]=c*p-g*y,d},i.rotateZ=function(d,c,p){p*=.5;var m=c[0],g=c[1],x=c[2];c=c[3];var y=Math.sin(p);return p=Math.cos(p),d[0]=m*p+g*y,d[1]=g*p-m*y,d[2]=x*p+c*y,d[3]=c*p-x*y,d},i.calculateW=function(d,c){var p=c[0],m=c[1];return c=c[2],d[0]=p,d[1]=m,d[2]=c,d[3]=Math.sqrt(Math.abs(1-p*p-m*m-c*c)),d},i.slerp=s,i.random=function(d){var c=u.RANDOM(),p=u.RANDOM(),m=u.RANDOM(),g=Math.sqrt(1-c);return c=Math.sqrt(c),d[0]=g*Math.sin(2*Math.PI*p),d[1]=g*Math.cos(2*Math.PI*p),d[2]=c*Math.sin(2*Math.PI*m),d[3]=c*Math.cos(2*Math.PI*m),d},i.invert=function(d,c){var p=c[0],m=c[1],g=c[2];c=c[3];var x=p*p+m*m+g*g+c*c;return x=x?1/x:0,d[0]=-p*x,d[1]=-m*x,d[2]=-g*x,d[3]=c*x,d},i.conjugate=function(d,c){return d[0]=-c[0],d[1]=-c[1],d[2]=-c[2],d[3]=c[3],d},i.fromMat3=o,i.fromEuler=function(d,c,p,m){var g=.5*Math.PI/180;c*=g,p*=g,m*=g,g=Math.sin(c),c=Math.cos(c);var x=Math.sin(p);p=Math.cos(p);var y=Math.sin(m);return m=Math.cos(m),d[0]=g*p*m-c*x*y,d[1]=c*x*m+g*p*y,d[2]=c*p*y-g*x*m,d[3]=c*p*m+g*x*y,d},i.str=function(d){return"quat("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")"},i.setAxes=i.sqlerp=i.rotationTo=i.equals=i.exactEquals=i.normalize=i.sqrLen=i.squaredLength=i.len=i.length=i.lerp=i.dot=i.scale=i.mul=i.add=i.set=i.copy=i.fromValues=i.clone=void 0;var u=t(Qt),f=t(jn),v=t(Xn);r=t(Wn),i.clone=r.clone,i.fromValues=r.fromValues,i.copy=r.copy,i.set=r.set,i.add=r.add,i.mul=n,i.scale=r.scale,i.dot=r.dot,i.lerp=r.lerp;var l=r.length;i.length=l,i.len=l,l=r.squaredLength,i.squaredLength=l,i.sqrLen=l;var h=r.normalize;i.normalize=h,i.exactEquals=r.exactEquals,i.equals=r.equals,r=function(){var d=v.create(),c=v.fromValues(1,0,0),p=v.fromValues(0,1,0);return function(m,g,x){var y=v.dot(g,x);return-.999999>y?(v.cross(d,c,g),1e-6>v.len(d)&&v.cross(d,p,g),v.normalize(d,d),a(m,d,Math.PI),m):.999999<y?(m[0]=0,m[1]=0,m[2]=0,m[3]=1,m):(v.cross(d,g,x),m[0]=d[0],m[1]=d[1],m[2]=d[2],m[3]=1+y,h(m,m))}}(),i.rotationTo=r,r=function(){var d=e(),c=e();return function(p,m,g,x,y,_){return s(d,m,y,_),s(c,g,x,_),s(p,d,c,2*_*(1-_)),p}}(),i.sqlerp=r,r=function(){var d=f.create();return function(c,p,m,g){return d[0]=m[0],d[3]=m[1],d[6]=m[2],d[1]=g[0],d[4]=g[1],d[7]=g[2],d[2]=-p[0],d[5]=-p[1],d[8]=-p[2],h(c,o(c,d))}}(),i.setAxes=r});tt(Yn);var is=V(function(r,i){function t(l){if(l&&l.__esModule)return l;var h={};if(l!=null){for(var d in l)if(Object.prototype.hasOwnProperty.call(l,d)){var c=gt&&vt?vt(l,d):{};c.get||c.set?gt(h,d,c):h[d]=l[d]}}return h.default=l,h}function e(l,h,d){var c=.5*d[0],p=.5*d[1];d=.5*d[2];var m=h[0],g=h[1],x=h[2];return h=h[3],l[0]=m,l[1]=g,l[2]=x,l[3]=h,l[4]=c*h+p*x-d*g,l[5]=p*h+d*m-c*x,l[6]=d*h+c*g-p*m,l[7]=-c*m-p*g-d*x,l}function a(l,h){return l[0]=h[0],l[1]=h[1],l[2]=h[2],l[3]=h[3],l[4]=h[4],l[5]=h[5],l[6]=h[6],l[7]=h[7],l}function n(l,h,d){var c=h[0],p=h[1],m=h[2],g=h[3],x=d[4],y=d[5],_=d[6],A=d[7],T=h[4],w=h[5],E=h[6];h=h[7];var M=d[0],P=d[1],R=d[2];return d=d[3],l[0]=c*d+g*M+p*R-m*P,l[1]=p*d+g*P+m*M-c*R,l[2]=m*d+g*R+c*P-p*M,l[3]=g*d-c*M-p*P-m*R,l[4]=c*A+g*x+p*_-m*y+T*d+h*M+w*R-E*P,l[5]=p*A+g*y+m*x-c*_+w*d+h*P+E*M-T*R,l[6]=m*A+g*_+c*y-p*x+E*d+h*R+T*P-w*M,l[7]=g*A-c*x-p*y-m*_+h*d-T*M-w*P-E*R,l}Object.defineProperty(i,"__esModule",{value:!0}),i.create=function(){var l=new s.ARRAY_TYPE(8);return s.ARRAY_TYPE!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[4]=0,l[5]=0,l[6]=0,l[7]=0),l[3]=1,l},i.clone=function(l){var h=new s.ARRAY_TYPE(8);return h[0]=l[0],h[1]=l[1],h[2]=l[2],h[3]=l[3],h[4]=l[4],h[5]=l[5],h[6]=l[6],h[7]=l[7],h},i.fromValues=function(l,h,d,c,p,m,g,x){var y=new s.ARRAY_TYPE(8);return y[0]=l,y[1]=h,y[2]=d,y[3]=c,y[4]=p,y[5]=m,y[6]=g,y[7]=x,y},i.fromRotationTranslationValues=function(l,h,d,c,p,m,g){var x=new s.ARRAY_TYPE(8);return x[0]=l,x[1]=h,x[2]=d,x[3]=c,p*=.5,m*=.5,g*=.5,x[4]=p*c+m*d-g*h,x[5]=m*c+g*l-p*d,x[6]=g*c+p*h-m*l,x[7]=-p*l-m*h-g*d,x},i.fromRotationTranslation=e,i.fromTranslation=function(l,h){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l[4]=.5*h[0],l[5]=.5*h[1],l[6]=.5*h[2],l[7]=0,l},i.fromRotation=function(l,h){return l[0]=h[0],l[1]=h[1],l[2]=h[2],l[3]=h[3],l[4]=0,l[5]=0,l[6]=0,l[7]=0,l},i.fromMat4=function(l,h){var d=o.create();u.getRotation(d,h);var c=new s.ARRAY_TYPE(3);return u.getTranslation(c,h),e(l,d,c),l},i.copy=a,i.identity=function(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l[6]=0,l[7]=0,l},i.set=function(l,h,d,c,p,m,g,x,y){return l[0]=h,l[1]=d,l[2]=c,l[3]=p,l[4]=m,l[5]=g,l[6]=x,l[7]=y,l},i.getDual=function(l,h){return l[0]=h[4],l[1]=h[5],l[2]=h[6],l[3]=h[7],l},i.setDual=function(l,h){return l[4]=h[0],l[5]=h[1],l[6]=h[2],l[7]=h[3],l},i.getTranslation=function(l,h){var d=h[4],c=h[5],p=h[6],m=h[7],g=-h[0],x=-h[1],y=-h[2];return h=h[3],l[0]=2*(d*h+m*g+c*y-p*x),l[1]=2*(c*h+m*x+p*g-d*y),l[2]=2*(p*h+m*y+d*x-c*g),l},i.translate=function(l,h,d){var c=h[0],p=h[1],m=h[2],g=h[3],x=.5*d[0],y=.5*d[1];d=.5*d[2];var _=h[4],A=h[5],T=h[6];return h=h[7],l[0]=c,l[1]=p,l[2]=m,l[3]=g,l[4]=g*x+p*d-m*y+_,l[5]=g*y+m*x-c*d+A,l[6]=g*d+c*y-p*x+T,l[7]=-c*x-p*y-m*d+h,l},i.rotateX=function(l,h,d){var c=-h[0],p=-h[1],m=-h[2],g=h[3],x=h[4],y=h[5],_=h[6],A=h[7],T=x*g+A*c+y*m-_*p,w=y*g+A*p+_*c-x*m,E=_*g+A*m+x*p-y*c;return x=A*g-x*c-y*p-_*m,o.rotateX(l,h,d),c=l[0],p=l[1],m=l[2],g=l[3],l[4]=T*g+x*c+w*m-E*p,l[5]=w*g+x*p+E*c-T*m,l[6]=E*g+x*m+T*p-w*c,l[7]=x*g-T*c-w*p-E*m,l},i.rotateY=function(l,h,d){var c=-h[0],p=-h[1],m=-h[2],g=h[3],x=h[4],y=h[5],_=h[6],A=h[7],T=x*g+A*c+y*m-_*p,w=y*g+A*p+_*c-x*m,E=_*g+A*m+x*p-y*c;return x=A*g-x*c-y*p-_*m,o.rotateY(l,h,d),c=l[0],p=l[1],m=l[2],g=l[3],l[4]=T*g+x*c+w*m-E*p,l[5]=w*g+x*p+E*c-T*m,l[6]=E*g+x*m+T*p-w*c,l[7]=x*g-T*c-w*p-E*m,l},i.rotateZ=function(l,h,d){var c=-h[0],p=-h[1],m=-h[2],g=h[3],x=h[4],y=h[5],_=h[6],A=h[7],T=x*g+A*c+y*m-_*p,w=y*g+A*p+_*c-x*m,E=_*g+A*m+x*p-y*c;return x=A*g-x*c-y*p-_*m,o.rotateZ(l,h,d),c=l[0],p=l[1],m=l[2],g=l[3],l[4]=T*g+x*c+w*m-E*p,l[5]=w*g+x*p+E*c-T*m,l[6]=E*g+x*m+T*p-w*c,l[7]=x*g-T*c-w*p-E*m,l},i.rotateByQuatAppend=function(l,h,d){var c=d[0],p=d[1],m=d[2];d=d[3];var g=h[0],x=h[1],y=h[2],_=h[3];return l[0]=g*d+_*c+x*m-y*p,l[1]=x*d+_*p+y*c-g*m,l[2]=y*d+_*m+g*p-x*c,l[3]=_*d-g*c-x*p-y*m,g=h[4],x=h[5],y=h[6],_=h[7],l[4]=g*d+_*c+x*m-y*p,l[5]=x*d+_*p+y*c-g*m,l[6]=y*d+_*m+g*p-x*c,l[7]=_*d-g*c-x*p-y*m,l},i.rotateByQuatPrepend=function(l,h,d){var c=h[0],p=h[1],m=h[2];h=h[3];var g=d[0],x=d[1],y=d[2],_=d[3];return l[0]=c*_+h*g+p*y-m*x,l[1]=p*_+h*x+m*g-c*y,l[2]=m*_+h*y+c*x-p*g,l[3]=h*_-c*g-p*x-m*y,g=d[4],x=d[5],y=d[6],_=d[7],l[4]=c*_+h*g+p*y-m*x,l[5]=p*_+h*x+m*g-c*y,l[6]=m*_+h*y+c*x-p*g,l[7]=h*_-c*g-p*x-m*y,l},i.rotateAroundAxis=function(l,h,d,c){if(Math.abs(c)<s.EPSILON)return a(l,h);var p=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);c*=.5;var m=Math.sin(c),g=m*d[0]/p,x=m*d[1]/p;d=m*d[2]/p,c=Math.cos(c),p=h[0],m=h[1];var y=h[2],_=h[3];return l[0]=p*c+_*g+m*d-y*x,l[1]=m*c+_*x+y*g-p*d,l[2]=y*c+_*d+p*x-m*g,l[3]=_*c-p*g-m*x-y*d,p=h[4],m=h[5],y=h[6],h=h[7],l[4]=p*c+h*g+m*d-y*x,l[5]=m*c+h*x+y*g-p*d,l[6]=y*c+h*d+p*x-m*g,l[7]=h*c-p*g-m*x-y*d,l},i.add=function(l,h,d){return l[0]=h[0]+d[0],l[1]=h[1]+d[1],l[2]=h[2]+d[2],l[3]=h[3]+d[3],l[4]=h[4]+d[4],l[5]=h[5]+d[5],l[6]=h[6]+d[6],l[7]=h[7]+d[7],l},i.multiply=n,i.scale=function(l,h,d){return l[0]=h[0]*d,l[1]=h[1]*d,l[2]=h[2]*d,l[3]=h[3]*d,l[4]=h[4]*d,l[5]=h[5]*d,l[6]=h[6]*d,l[7]=h[7]*d,l},i.lerp=function(l,h,d,c){var p=1-c;return 0>f(h,d)&&(c=-c),l[0]=h[0]*p+d[0]*c,l[1]=h[1]*p+d[1]*c,l[2]=h[2]*p+d[2]*c,l[3]=h[3]*p+d[3]*c,l[4]=h[4]*p+d[4]*c,l[5]=h[5]*p+d[5]*c,l[6]=h[6]*p+d[6]*c,l[7]=h[7]*p+d[7]*c,l},i.invert=function(l,h){var d=v(h);return l[0]=-h[0]/d,l[1]=-h[1]/d,l[2]=-h[2]/d,l[3]=h[3]/d,l[4]=-h[4]/d,l[5]=-h[5]/d,l[6]=-h[6]/d,l[7]=h[7]/d,l},i.conjugate=function(l,h){return l[0]=-h[0],l[1]=-h[1],l[2]=-h[2],l[3]=h[3],l[4]=-h[4],l[5]=-h[5],l[6]=-h[6],l[7]=h[7],l},i.normalize=function(l,h){var d=v(h);if(0<d){d=Math.sqrt(d);var c=h[0]/d,p=h[1]/d,m=h[2]/d,g=h[3]/d,x=h[4],y=h[5],_=h[6];h=h[7];var A=c*x+p*y+m*_+g*h;l[0]=c,l[1]=p,l[2]=m,l[3]=g,l[4]=(x-c*A)/d,l[5]=(y-p*A)/d,l[6]=(_-m*A)/d,l[7]=(h-g*A)/d}return l},i.str=function(l){return"quat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+")"},i.exactEquals=function(l,h){return l[0]===h[0]&&l[1]===h[1]&&l[2]===h[2]&&l[3]===h[3]&&l[4]===h[4]&&l[5]===h[5]&&l[6]===h[6]&&l[7]===h[7]},i.equals=function(l,h){var d=l[0],c=l[1],p=l[2],m=l[3],g=l[4],x=l[5],y=l[6];l=l[7];var _=h[0],A=h[1],T=h[2],w=h[3],E=h[4],M=h[5],P=h[6];return h=h[7],Math.abs(d-_)<=s.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(c-A)<=s.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(p-T)<=s.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(m-w)<=s.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))&&Math.abs(g-E)<=s.EPSILON*Math.max(1,Math.abs(g),Math.abs(E))&&Math.abs(x-M)<=s.EPSILON*Math.max(1,Math.abs(x),Math.abs(M))&&Math.abs(y-P)<=s.EPSILON*Math.max(1,Math.abs(y),Math.abs(P))&&Math.abs(l-h)<=s.EPSILON*Math.max(1,Math.abs(l),Math.abs(h))},i.sqrLen=i.squaredLength=i.len=i.length=i.dot=i.mul=i.setReal=i.getReal=void 0;var s=t(Qt),o=t(Yn),u=t(Hn);i.getReal=o.copy,i.setReal=o.copy,i.mul=n;var f=o.dot;i.dot=f,r=o.length,i.length=r,i.len=r;var v=o.squaredLength;i.squaredLength=v,i.sqrLen=v});tt(is);var ns=V(function(r,i){function t(){var l=new v.ARRAY_TYPE(2);return v.ARRAY_TYPE!=Float32Array&&(l[0]=0,l[1]=0),l}function e(l,h,d){return l[0]=h[0]-d[0],l[1]=h[1]-d[1],l}function a(l,h,d){return l[0]=h[0]*d[0],l[1]=h[1]*d[1],l}function n(l,h,d){return l[0]=h[0]/d[0],l[1]=h[1]/d[1],l}function s(l,h){var d=h[0]-l[0];return l=h[1]-l[1],Math.sqrt(d*d+l*l)}function o(l,h){var d=h[0]-l[0];return l=h[1]-l[1],d*d+l*l}function u(l){var h=l[0];return l=l[1],Math.sqrt(h*h+l*l)}function f(l){var h=l[0];return l=l[1],h*h+l*l}Object.defineProperty(i,"__esModule",{value:!0}),i.create=t,i.clone=function(l){var h=new v.ARRAY_TYPE(2);return h[0]=l[0],h[1]=l[1],h},i.fromValues=function(l,h){var d=new v.ARRAY_TYPE(2);return d[0]=l,d[1]=h,d},i.copy=function(l,h){return l[0]=h[0],l[1]=h[1],l},i.set=function(l,h,d){return l[0]=h,l[1]=d,l},i.add=function(l,h,d){return l[0]=h[0]+d[0],l[1]=h[1]+d[1],l},i.subtract=e,i.multiply=a,i.divide=n,i.ceil=function(l,h){return l[0]=Math.ceil(h[0]),l[1]=Math.ceil(h[1]),l},i.floor=function(l,h){return l[0]=Math.floor(h[0]),l[1]=Math.floor(h[1]),l},i.min=function(l,h,d){return l[0]=Math.min(h[0],d[0]),l[1]=Math.min(h[1],d[1]),l},i.max=function(l,h,d){return l[0]=Math.max(h[0],d[0]),l[1]=Math.max(h[1],d[1]),l},i.round=function(l,h){return l[0]=Math.round(h[0]),l[1]=Math.round(h[1]),l},i.scale=function(l,h,d){return l[0]=h[0]*d,l[1]=h[1]*d,l},i.scaleAndAdd=function(l,h,d,c){return l[0]=h[0]+d[0]*c,l[1]=h[1]+d[1]*c,l},i.distance=s,i.squaredDistance=o,i.length=u,i.squaredLength=f,i.negate=function(l,h){return l[0]=-h[0],l[1]=-h[1],l},i.inverse=function(l,h){return l[0]=1/h[0],l[1]=1/h[1],l},i.normalize=function(l,h){var d=h[0],c=h[1];return d=d*d+c*c,0<d&&(d=1/Math.sqrt(d)),l[0]=h[0]*d,l[1]=h[1]*d,l},i.dot=function(l,h){return l[0]*h[0]+l[1]*h[1]},i.cross=function(l,h,d){return h=h[0]*d[1]-h[1]*d[0],l[0]=l[1]=0,l[2]=h,l},i.lerp=function(l,h,d,c){var p=h[0];return h=h[1],l[0]=p+c*(d[0]-p),l[1]=h+c*(d[1]-h),l},i.random=function(l,h){h=h||1;var d=2*v.RANDOM()*Math.PI;return l[0]=Math.cos(d)*h,l[1]=Math.sin(d)*h,l},i.transformMat2=function(l,h,d){var c=h[0];return h=h[1],l[0]=d[0]*c+d[2]*h,l[1]=d[1]*c+d[3]*h,l},i.transformMat2d=function(l,h,d){var c=h[0];return h=h[1],l[0]=d[0]*c+d[2]*h+d[4],l[1]=d[1]*c+d[3]*h+d[5],l},i.transformMat3=function(l,h,d){var c=h[0];return h=h[1],l[0]=d[0]*c+d[3]*h+d[6],l[1]=d[1]*c+d[4]*h+d[7],l},i.transformMat4=function(l,h,d){var c=h[0];return h=h[1],l[0]=d[0]*c+d[4]*h+d[12],l[1]=d[1]*c+d[5]*h+d[13],l},i.rotate=function(l,h,d,c){var p=h[0]-d[0];h=h[1]-d[1];var m=Math.sin(c);return c=Math.cos(c),l[0]=p*c-h*m+d[0],l[1]=p*m+h*c+d[1],l},i.angle=function(l,h){var d=l[0];l=l[1];var c=h[0];h=h[1];var p=d*d+l*l;0<p&&(p=1/Math.sqrt(p));var m=c*c+h*h;return 0<m&&(m=1/Math.sqrt(m)),d=(d*c+l*h)*p*m,1<d?0:-1>d?Math.PI:Math.acos(d)},i.zero=function(l){return l[0]=0,l[1]=0,l},i.str=function(l){return"vec2("+l[0]+", "+l[1]+")"},i.exactEquals=function(l,h){return l[0]===h[0]&&l[1]===h[1]},i.equals=function(l,h){var d=l[0];l=l[1];var c=h[0];return h=h[1],Math.abs(d-c)<=v.EPSILON*Math.max(1,Math.abs(d),Math.abs(c))&&Math.abs(l-h)<=v.EPSILON*Math.max(1,Math.abs(l),Math.abs(h))},i.forEach=i.sqrLen=i.sqrDist=i.dist=i.div=i.mul=i.sub=i.len=void 0;var v=function(l){if(l&&l.__esModule)return l;var h={};if(l!=null){for(var d in l)if(Object.prototype.hasOwnProperty.call(l,d)){var c=gt&&vt?vt(l,d):{};c.get||c.set?gt(h,d,c):h[d]=l[d]}}return h.default=l,h}(Qt);i.len=u,i.sub=e,i.mul=a,i.div=n,i.dist=s,i.sqrDist=o,i.sqrLen=f,r=function(){var l=t();return function(h,d,c,p,m,g){for(d||(d=2),c||(c=0),p=p?Math.min(p*d+c,h.length):h.length;c<p;c+=d)l[0]=h[c],l[1]=h[c+1],m(l,l,g),h[c]=l[0],h[c+1]=l[1];return h}}(),i.forEach=r});tt(ns);var Wt=V(function(r,i){function t(e){if(e&&e.__esModule)return e;var a={};if(e!=null){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=gt&&vt?vt(e,n):{};s.get||s.set?gt(a,n,s):a[n]=e[n]}}return a.default=e,a}Object.defineProperty(i,"__esModule",{value:!0}),i.vec4=i.vec3=i.vec2=i.quat2=i.quat=i.mat4=i.mat3=i.mat2d=i.mat2=i.glMatrix=void 0,r=t(Qt),i.glMatrix=r,r=t(es),i.mat2=r,r=t(rs),i.mat2d=r,r=t(jn),i.mat3=r,r=t(Hn),i.mat4=r,r=t(Yn),i.quat=r,r=t(is),i.quat2=r,r=t(ns),i.vec2=r,r=t(Xn),i.vec3=r,r=t(Wn),i.vec4=r});tt(Wt);var ft=Wt.vec4,j=Wt.vec3,q=Wt.vec2,lh=Wt.quat2,zi=Wt.quat,b=Wt.mat4,hh=Wt.mat3,fh=Wt.mat2d,ch=Wt.mat2,dh=Wt.glMatrix,J=function(){function r(i,t,e){O(this,r),this.options=t,this.gl=i,e&&(this.map=e.map),e=this.getVertexShader(t.vertexShader);var a=this.getFragmentShader(t.fragmentShader);t=i.createShader(i.VERTEX_SHADER),i.shaderSource(t,e),i.compileShader(t),i.getShaderParameter(t,i.COMPILE_STATUS)?(e=i.createShader(i.FRAGMENT_SHADER),i.shaderSource(e,a),i.compileShader(e),i.getShaderParameter(e,i.COMPILE_STATUS)?(a=i.createProgram(),i.attachShader(a,t),i.attachShader(a,e),i.deleteShader(t),i.deleteShader(e),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)?t=a:(t="Shader program failed to link.  The error log is:"+i.getProgramInfoLog(a),console.error(t),t=-1)):(t="Fragment shader failed to compile.  The error log is:"+i.getShaderInfoLog(e),console.error(t),t=-1)):(t="Vertex shader failed to compile.  The error log is:"+i.getShaderInfoLog(t),console.error(t),t=-1),t=this.program=t,e={},a=i.getProgramParameter(t,i.ACTIVE_ATTRIBUTES);for(var n=0;n<a;n++){var s=i.getActiveAttrib(t,n);e[s.name]=i.getAttribLocation(t,s.name)}n={},s={};for(var o=i.getProgramParameter(t,i.ACTIVE_UNIFORMS),u=0;u<o;u++){var f=i.getActiveUniform(t,u);n[f.name]=i.getUniformLocation(t,f.name),s[f.name]=f.type}this.parameter=i={attributes:e,numAttributes:a,uniformsType:s,uniforms:n},this.attributes=i.attributes,this.uniforms=i.uniforms,this.parameter=i}return z(r,[{key:"getVertexShader",value:function(i){var t="";return this.map&&this.map.type==="cesium"&&(t=`#define LOG_DEPTH
`),t+=`#ifdef LOG_DEPTH
uniform float currentFrustumX;varying float v_depthFromNearPlusOne;
#endif
uniform vec2 MAPV_resolution;
#if defined(PICK)
uniform bool uIsPickRender;attribute vec3 aPickColor;uniform vec3 uPickedColor;varying vec4 vPickColor;uniform bool uEnablePicked;bool mapvIsPicked(){return uEnablePicked&&aPickColor==uPickedColor;}
#endif
void afterMain(){
#if defined(LOG_DEPTH)
v_depthFromNearPlusOne=(gl_Position.w-currentFrustumX)+1.0;gl_Position.z=clamp(gl_Position.z/gl_Position.w,-1.0,1.0)*gl_Position.w;
#endif
#if defined(PICK)
vPickColor=vec4(aPickColor,0.0);if(mapvIsPicked()){vPickColor.a=1.0;}
#endif
}`,i=this.getDefines()+t+i,i=i.replace("void main","void originMain"),i+"void main() {originMain(); afterMain();}"}},{key:"getFragmentShader",value:function(i){var t="";return this.map&&this.map.type==="cesium"&&(t=`#define LOG_DEPTH
`),t+=`#if defined(LOG_DEPTH)
#extension GL_EXT_frag_depth : enable
#endif
precision highp float;uniform vec2 MAPV_resolution;uniform bool uIsPickRender;
#if defined(PICK)
varying vec4 vPickColor;bool mapvIsPicked(){return vPickColor.a==1.0;}
#endif
#if defined(LOG_DEPTH)
uniform float oneOverLog2FarDepthFromNearPlusOne;uniform float farDepthFromNearPlusOne;varying float v_depthFromNearPlusOne;void writeLogDepth(float depth){if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}gl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;}
#endif
void afterMain(){
#if defined(PICK)
if(uIsPickRender){gl_FragColor=vec4(vPickColor.rgb,1.0);return;}
#endif
#if defined(LOG_DEPTH)
writeLogDepth(v_depthFromNearPlusOne);
#endif
}`,i=this.getDefines()+t+i,i=i.replace("void main","void originMain"),i+"void main() {originMain(); afterMain();}"}},{key:"getDefines",value:function(){var i="",t=this.options.defines;if(t)for(var e=0;e<t.length;e++)i+="#define "+t[e]+`
`;return i}},{key:"use",value:function(i,t){this.gl=i,i.useProgram(this.program),this.map&&this.map.type==="cesium"&&this.setUniforms({currentFrustumX:this.map.map.scene.camera.frustum.near,oneOverLog2FarDepthFromNearPlusOne:this.map.map.scene.context.uniformState.oneOverLog2FarDepthFromNearPlusOne,farDepthFromNearPlusOne:this.map.map.scene.context.uniformState.farDepthFromNearPlusOne}),this.uniforms.MAPV_resolution&&this.setUniforms({MAPV_resolution:[i.canvas.width,i.canvas.height]})}},{key:"setUniform",value:function(i,t){var e=this.gl,a=this.uniforms[i];if(a)switch(this.parameter.uniformsType[i]){case e.FLOAT:e.uniform1f(a,t);break;case e.FLOAT_VEC2:e.uniform2f(a,t[0],t[1]);break;case e.FLOAT_VEC3:e.uniform3f(a,t[0],t[1],t[2]);break;case e.FLOAT_VEC4:e.uniform4f(a,t[0],t[1],t[2],t[3]);break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:e.activeTexture(e["TEXTURE"+this.textureIndex]),e.uniform1i(a,this.textureIndex),e.bindTexture(e.TEXTURE_2D,t),this.textureIndex++;break;case e.INT:case e.BOOL:e.uniform1i(a,t);break;case e.INT_VEC2:case e.BOOL_VEC2:e.uniform2i(a,t[0],t[1]);break;case e.INT_VEC3:case e.BOOL_VEC3:e.uniform3i(a,t[0],t[1],t[2]);break;case e.INT_VEC4:case e.BOOL_VEC4:e.uniform4i(a,t[0],t[1],t[2],t[3]);break;case e.FLOAT_MAT2:e.uniformMatrix2fv(a,!1,t);break;case e.FLOAT_MAT3:e.uniformMatrix3fv(a,!1,t);break;case e.FLOAT_MAT4:e.uniformMatrix4fv(a,!1,t);break;default:console.error("Unrecognized uniform type: "+i)}else console.warn("Unrecognized uniform type: "+i)}},{key:"setUniforms",value:function(i){this.textureIndex=0;for(var t in i)this.setUniform(t,i[t])}}]),r}(),ce=function(r,i,t,e){var a=t?t.call(e,r,i):void 0;if(a!==void 0)return!!a;if(r===i)return!0;if((typeof r=="undefined"?"undefined":It(r))!=="object"||!r||(typeof i=="undefined"?"undefined":It(i))!=="object"||!i)return!1;var n=_t(r),s=_t(i);if(n.length!==s.length)return!1;s=Object.prototype.hasOwnProperty.bind(i);for(var o=0;o<n.length;o++){if(a=n[o],!s(a))return!1;var u=r[a],f=i[a];if(a=t?t.call(e,u,f,a):void 0,a===!1||a===void 0&&u!==f)return!1}return!0},os=function(){function r(i){O(this,r),this.options=i,this.gl=i.gl,this.savedState=[],this.currentState=this.getDefaultState()}return z(r,[{key:"setDefaultState",value:function(){this.setState()}},{key:"getDefaultState",value:function(){var i=this.gl;return{blend:!1,blendEquation:i.FUNC_ADD,blendFunc:[i.ONE,i.ZERO],depthMask:!0,depthTest:!0,depthFunc:i.LEQUAL,polygonOffset:[0,0],cullFace:!1,stencilTest:!1}}},{key:"getRealState",value:function(){var i=this.gl;return{blend:i.getParameter(i.BLEND),blendEquation:i.getParameter(i.BLEND_EQUATION),depthMask:i.getParameter(i.DEPTH_WRITEMASK),depthTest:i.getParameter(i.DEPTH_TEST),depthFunc:i.getParameter(i.DEPTH_FUNC),polygonOffset:[i.getParameter(i.POLYGON_OFFSET_FACTOR),i.getParameter(i.POLYGON_OFFSET_UNITS)],cullFace:i.getParameter(i.CULL_FACE),stencilTest:i.getParameter(i.STENCIL_TEST)}}},{key:"getCurrentState",value:function(){return this.currentState}},{key:"save",value:function(){this.savedState.push(this.getCurrentState())}},{key:"restore",value:function(){var i=this.savedState.pop();this.setState(i,{force:!0})}},{key:"setState",value:function(i){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};i=G(this.getDefaultState(),i),this.setBlend(i,t),this.setDepth(i,t),this.setCullFace(i,t),this.setPolygonOffset(i,t),this.setStencil(i,t),this.currentState=i}},{key:"setBlend",value:function(i,t){var e=this.gl,a=this.getCurrentState();((t=t.force)||!ce(i.blend,a.blend))&&(i.blend?e.enable(e.BLEND):e.disable(e.BLEND)),!t&&ce(i.blendEquation,a.blendEquation)||e.blendEquation(i.blendEquation),(t||!ce(i.blendFunc,a.blendFunc))&&(i.blendFunc.length===2?e.blendFunc(i.blendFunc[0],i.blendFunc[1]):i.blendFunc.length===4&&e.blendFuncSeparate(i.blendFunc[0],i.blendFunc[1],i.blendFunc[2],i.blendFunc[3]))}},{key:"setDepth",value:function(i,t){var e=this.gl,a=this.getCurrentState();((t=t.force)||!ce(i.depthTest,a.depthTest))&&(i.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST)),(t||!ce(i.depthMask,a.depthMask))&&(i.depthMask?e.depthMask(!0):e.depthMask(!1)),!t&&ce(i.depthFunc,a.depthFunc)||e.depthFunc(i.depthFunc)}},{key:"setPolygonOffset",value:function(i,t){var e=this.gl,a=this.getCurrentState();(t.force||!ce(i.polygonOffset,a.polygonOffset))&&(i.polygonOffset[0]!==0&&i.polygonOffset[1]!==0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.polygonOffset(i.polygonOffset[0],i.polygonOffset[1]))}},{key:"setCullFace",value:function(i,t){var e=this.gl,a=this.getCurrentState();(t.force||!ce(i.cullFace,a.cullFace))&&(i.cullFace?(e.enable(e.CULL_FACE),e.cullFace(e.BACK)):e.disable(e.CULL_FACE))}},{key:"setStencil",value:function(i,t){var e=this.gl,a=this.getCurrentState();(t.force||!ce(i.stencilTest,a.stencilTest))&&(i.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST))}}]),r}(),I=function(){function r(i){O(this,r),this.options=i,this.gl=i.gl,this.buffer=this.gl.createBuffer(),i.data&&this.updateData(i.data)}return z(r,[{key:"updateData",value:function(i){var t=this.options,e=this.gl;this.bind(),e.bufferData(e[t.target],i,e[t.usage])}},{key:"bind",value:function(i){i=i||this.gl,i.bindBuffer(i[this.options.target],this.buffer)}},{key:"unBind",value:function(i){i=i||this.gl,i.bindBuffer(i[this.options.target],null)}},{key:"destroy",value:function(){this.buffer=null}}]),r}(),vh={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FLOAT:4},ot=function(){function r(i){for(O(this,r),this.options=i,this.attributes=i.attributes,this.gl=i.gl,this.program=i.program,i=this.stride=0;i<this.attributes.length;i++)this.stride+=vh[this.attributes[i].type]*this.attributes[i].size}return z(r,[{key:"setVertexAttribPointers",value:function(){for(var i=this.gl,t=this.program,e=0;e<this.attributes.length;e++){var a=this.attributes[e],n=t.attributes[a.name];n!==void 0&&(a.buffer.bind(i),i.vertexAttribPointer(n,a.size,i[a.type],a.normalize||!1,a.stride!==void 0?a.stride:this.stride,a.offset),i.enableVertexAttribArray(n))}}},{key:"bind",value:function(){this.setVertexAttribPointers()}},{key:"destroy",value:function(){}}]),r}(),Mt=function r(i,t,e){O(this,r),t=t||i.canvas.width,e=e||i.canvas.height;var a=i.createFramebuffer(),n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),a.texture=n;var s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e),a.depthBuffer=s,i.bindFramebuffer(i.FRAMEBUFFER,a),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s),t=i.checkFramebufferStatus(i.FRAMEBUFFER),i.FRAMEBUFFER_COMPLETE===t&&(i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),this.framebuffer=a)},nr=function(){function r(i){O(this,r),this.options={},G(this.options,i),this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0],this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}return z(r,[{key:"getOptions",value:function(){return this.options}},{key:"onResize",value:function(i){}},{key:"render",value:function(i){var t=i.gl;i=i.texture;var e=this.programSample;t.useProgram(e.program);var a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);var n=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW),t.enableVertexAttribArray(e.attributes.aPos),t.vertexAttribPointer(e.attributes.aPos,3,t.FLOAT,!1,0,0),a=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),t.STATIC_DRAW),t.enableVertexAttribArray(e.attributes.aTextureCoord),t.vertexAttribPointer(e.attributes.aTextureCoord,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.uniform1i(e.uniforms.uSampler,0),t.drawArrays(t.TRIANGLES,0,n.length/3)}}]),r}(),ph=function(r){function i(t){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t))}return W(i,r),z(i,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new J(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(void){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;vec4 fxaa_2_0(sampler2D tex,vec2 fragCoord,vec2 resolution,vec2 v_rgbNW,vec2 v_rgbNE,vec2 v_rgbSW,vec2 v_rgbSE,vec2 v_rgbM){vec4 color;mediump vec2 inverseVP=vec2(1.0/resolution.x,1.0/resolution.y);vec3 rgbNW=texture2D(tex,v_rgbNW).xyz;vec3 rgbNE=texture2D(tex,v_rgbNE).xyz;vec3 rgbSW=texture2D(tex,v_rgbSW).xyz;vec3 rgbSE=texture2D(tex,v_rgbSE).xyz;vec4 texColor=texture2D(tex,v_rgbM);vec3 rgbM=texColor.xyz;vec3 luma=vec3(0.299,0.587,0.114);float lumaNW=dot(rgbNW,luma);float lumaNE=dot(rgbNE,luma);float lumaSW=dot(rgbSW,luma);float lumaSE=dot(rgbSE,luma);float lumaM=dot(rgbM,luma);float lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));float lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));mediump vec2 dir;dir.x=-((lumaNW+lumaNE)-(lumaSW+lumaSE));dir.y=((lumaNW+lumaSW)-(lumaNE+lumaSE));float dirReduce=max((lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*1.0/8.0),1.0/128.0);float rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);dir=min(vec2(8.0,8.0),max(vec2(-8.0,-8.0),dir*rcpDirMin))*inverseVP;vec3 rgbA=0.5*(texture2D(tex,fragCoord*inverseVP+dir*(1.0/3.0-0.5)).xyz+texture2D(tex,fragCoord*inverseVP+dir*(2.0/3.0-0.5)).xyz);vec3 rgbB=rgbA*0.5+0.25*(texture2D(tex,fragCoord*inverseVP+dir*-0.5).xyz+texture2D(tex,fragCoord*inverseVP+dir*0.5).xyz);float lumaB=dot(rgbB,luma);if((lumaB<lumaMin)||(lumaB>lumaMax)){color=vec4(rgbA,texColor.a);}else{color=vec4(rgbB,texColor.a);}return color;}void texcoords_3_1(vec2 fragCoord,vec2 resolution,out vec2 v_rgbNW,out vec2 v_rgbNE,out vec2 v_rgbSW,out vec2 v_rgbSE,out vec2 v_rgbM){vec2 inverseVP=1.0/resolution.xy;v_rgbNW=(fragCoord+vec2(-1.0,-1.0))*inverseVP;v_rgbNE=(fragCoord+vec2(1.0,-1.0))*inverseVP;v_rgbSW=(fragCoord+vec2(-1.0,1.0))*inverseVP;v_rgbSE=(fragCoord+vec2(1.0,1.0))*inverseVP;v_rgbM=vec2(fragCoord*inverseVP);}vec4 apply_1_2(sampler2D tex,vec2 fragCoord,vec2 resolution){mediump vec2 v_rgbNW;mediump vec2 v_rgbNE;mediump vec2 v_rgbSW;mediump vec2 v_rgbSE;mediump vec2 v_rgbM;texcoords_3_1(fragCoord,resolution,v_rgbNW,v_rgbNE,v_rgbSW,v_rgbSE,v_rgbM);return fxaa_2_0(tex,fragCoord,resolution,v_rgbNW,v_rgbNE,v_rgbSW,v_rgbSE,v_rgbM);}void main(void){vec2 fragCoord=vTextureCoord*canvasSize;gl_FragColor=apply_1_2(uSampler,fragCoord,canvasSize);}"})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture,this.getOptions(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var a=this.getProgram(e);e.useProgram(a.program);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),n=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(a.uniforms.uSampler,1),e.uniform2fv(a.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),i}(nr),gh=function(r){function i(t){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t))}return W(i,r),z(i,[{key:"getProgram",value:function(t){if(this.program1||(this.program1=new J(t,{vertexShader:"attribute vec3 position;attribute vec2 uv;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];void SMAAEdgeDetectionVS(vec2 texcoord){vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-1.0,0.0,0.0,1.0);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(1.0,0.0,0.0,-1.0);vOffset[2]=texcoord.xyxy+resolution.xyxy*vec4(-2.0,0.0,0.0,2.0);}void main(){vUv=uv;SMAAEdgeDetectionVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:`precision highp float;
#define SMAA_THRESHOLD 0.1
uniform sampler2D tDiffuse;varying vec2 vUv;varying vec4 vOffset[3];vec4 SMAAColorEdgeDetectionPS(vec2 texcoord,vec4 offset[3],sampler2D colorTex){vec2 threshold=vec2(SMAA_THRESHOLD,SMAA_THRESHOLD);vec4 delta;vec3 C=texture2D(colorTex,texcoord).rgb;vec3 Cleft=texture2D(colorTex,offset[0].xy).rgb;vec3 t=abs(C-Cleft);delta.x=max(max(t.r,t.g),t.b);vec3 Ctop=texture2D(colorTex,offset[0].zw).rgb;t=abs(C-Ctop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0,1.0))==0.0)discard;vec3 Cright=texture2D(colorTex,offset[1].xy).rgb;t=abs(C-Cright);delta.z=max(max(t.r,t.g),t.b);vec3 Cbottom=texture2D(colorTex,offset[1].zw).rgb;t=abs(C-Cbottom);delta.w=max(max(t.r,t.g),t.b);float maxDelta=max(max(max(delta.x,delta.y),delta.z),delta.w);vec3 Cleftleft=texture2D(colorTex,offset[2].xy).rgb;t=abs(C-Cleftleft);delta.z=max(max(t.r,t.g),t.b);vec3 Ctoptop=texture2D(colorTex,offset[2].zw).rgb;t=abs(C-Ctoptop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(max(maxDelta,delta.z),delta.w);edges.xy*=step(0.5*maxDelta,delta.xy);return vec4(edges,0.0,0.0);}void main(){gl_FragColor=SMAAColorEdgeDetectionPS(vUv,vOffset,tDiffuse);}`})),this.program2||(this.program2=new J(t,{vertexShader:`precision highp float;
#define SMAA_MAX_SEARCH_STEPS 8
#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
#define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )
attribute vec3 position;attribute vec2 uv;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixcoord;void SMAABlendingWeightCalculationVS(vec2 texcoord){vPixcoord=texcoord/resolution;vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-0.25,0.125,1.25,0.125);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(-0.125,0.25,-0.125,-1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*resolution.xxyy*float(SMAA_MAX_SEARCH_STEPS);}void main(){vUv=uv;SMAABlendingWeightCalculationVS(vUv);gl_Position=vec4(position,1.0);}`,fragmentShader:`precision highp float;
#define SMAA_MAX_SEARCH_STEPS 8
#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
#define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )
#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )
uniform sampler2D tDiffuse;uniform sampler2D tArea;uniform sampler2D tSearch;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixcoord;vec2 round(vec2 x){return sign(x)*floor(abs(x)+0.5);}float SMAASearchLength(sampler2D searchTex,vec2 e,float bias,float scale){e.r=bias+e.r*scale;return 255.0*texture2D(searchTex,e,0.0).r;}float SMAASearchXLeft(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){/***@PSEUDO_GATHER4*This texcoord has been offset by(-0.25,-0.125)in the vertex shader to*sample between edge,thus fetching four edges in a row.*Sampling with different offsets in each direction allows to disambiguate*which edges are active from the four fetched ones.*/vec2 e=vec2(0.0,1.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord-=vec2(2.0,0.0)*resolution;if(!(texcoord.x>end&&e.g>0.8281&&e.r==0.0))break;}texcoord.x+=0.25*resolution.x;texcoord.x+=resolution.x;texcoord.x+=2.0*resolution.x;texcoord.x-=resolution.x*SMAASearchLength(searchTex,e,0.0,0.5);return texcoord.x;}float SMAASearchXRight(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord+=vec2(2.0,0.0)*resolution;if(!(texcoord.x<end&&e.g>0.8281&&e.r==0.0))break;}texcoord.x-=0.25*resolution.x;texcoord.x-=resolution.x;texcoord.x-=2.0*resolution.x;texcoord.x+=resolution.x*SMAASearchLength(searchTex,e,0.5,0.5);return texcoord.x;}float SMAASearchYUp(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord+=vec2(0.0,2.0)*resolution;if(!(texcoord.y>end&&e.r>0.8281&&e.g==0.0))break;}texcoord.y-=0.25*resolution.y;texcoord.y-=resolution.y;texcoord.y-=2.0*resolution.y;texcoord.y+=resolution.y*SMAASearchLength(searchTex,e.gr,0.0,0.5);return texcoord.y;}float SMAASearchYDown(sampler2D edgesTex,sampler2D searchTex,vec2 texcoord,float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<SMAA_MAX_SEARCH_STEPS;i++){e=texture2D(edgesTex,texcoord,0.0).rg;texcoord-=vec2(0.0,2.0)*resolution;if(!(texcoord.y<end&&e.r>0.8281&&e.g==0.0))break;}texcoord.y+=0.25*resolution.y;texcoord.y+=resolution.y;texcoord.y+=2.0*resolution.y;texcoord.y-=resolution.y*SMAASearchLength(searchTex,e.gr,0.5,0.5);return texcoord.y;}vec2 SMAAArea(sampler2D areaTex,vec2 dist,float e1,float e2,float offset){vec2 texcoord=float(SMAA_AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texcoord=SMAA_AREATEX_PIXEL_SIZE*texcoord+(0.5*SMAA_AREATEX_PIXEL_SIZE);texcoord.y+=SMAA_AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTex,texcoord,0.0).rg;}vec4 SMAABlendingWeightCalculationPS(vec2 texcoord,vec2 pixcoord,vec4 offset[3],sampler2D edgesTex,sampler2D areaTex,sampler2D searchTex,ivec4 subsampleIndices){vec4 weights=vec4(0.0,0.0,0.0,0.0);vec2 e=texture2D(edgesTex,texcoord).rg;if(e.g>0.0){vec2 d;vec2 coords;coords.x=SMAASearchXLeft(edgesTex,searchTex,offset[0].xy,offset[2].x);coords.y=offset[1].y;d.x=coords.x;float e1=texture2D(edgesTex,coords,0.0).r;coords.x=SMAASearchXRight(edgesTex,searchTex,offset[0].zw,offset[2].y);d.y=coords.x;d=d/resolution.x-pixcoord.x;vec2 sqrt_d=sqrt(abs(d));coords.y-=1.0*resolution.y;float e2=SMAASampleLevelZeroOffset(edgesTex,coords,ivec2(1,0)).r;weights.rg=SMAAArea(areaTex,sqrt_d,e1,e2,float(subsampleIndices.y));}if(e.r>0.0){vec2 d;vec2 coords;coords.y=SMAASearchYUp(edgesTex,searchTex,offset[1].xy,offset[2].z);coords.x=offset[0].x;d.x=coords.y;float e1=texture2D(edgesTex,coords,0.0).g;coords.y=SMAASearchYDown(edgesTex,searchTex,offset[1].zw,offset[2].w);d.y=coords.y;d=d/resolution.y-pixcoord.y;vec2 sqrt_d=sqrt(abs(d));coords.y-=1.0*resolution.y;float e2=SMAASampleLevelZeroOffset(edgesTex,coords,ivec2(0,1)).g;weights.ba=SMAAArea(areaTex,sqrt_d,e1,e2,float(subsampleIndices.x));}return weights;}void main(){gl_FragColor=SMAABlendingWeightCalculationPS(vUv,vPixcoord,vOffset,tDiffuse,tArea,tSearch,ivec4(0.0));}`})),this.program3||(this.program3=new J(t,{vertexShader:"precision highp float;uniform vec2 resolution;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;varying vec4 vOffset[2];void SMAANeighborhoodBlendingVS(vec2 texcoord){vOffset[0]=texcoord.xyxy+resolution.xyxy*vec4(-1.0,0.0,0.0,1.0);vOffset[1]=texcoord.xyxy+resolution.xyxy*vec4(1.0,0.0,0.0,-1.0);}void main(){vUv=uv;SMAANeighborhoodBlendingVS(vUv);gl_Position=vec4(position,1.0);}",fragmentShader:"precision highp float;uniform sampler2D tDiffuse;uniform sampler2D tColor;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[2];vec4 SMAANeighborhoodBlendingPS(vec2 texcoord,vec4 offset[2],sampler2D colorTex,sampler2D blendTex){vec4 a;a.xz=texture2D(blendTex,texcoord).xz;a.y=texture2D(blendTex,offset[1].zw).g;a.w=texture2D(blendTex,offset[1].xy).a;if(dot(a,vec4(1.0,1.0,1.0,1.0))<1e-5){return texture2D(colorTex,texcoord,0.0);}else{vec2 offset;offset.x=a.a>a.b ? a.a :-a.b;offset.y=a.g>a.r ?-a.g : a.r;if(abs(offset.x)>abs(offset.y)){offset.y=0.0;}else{offset.x=0.0;}vec4 C=texture2D(colorTex,texcoord,0.0);texcoord+=sign(offset)*resolution;vec4 Cop=texture2D(colorTex,texcoord,0.0);float s=abs(offset.x)>abs(offset.y)? abs(offset.x): abs(offset.y);C.xyz=pow(C.xyz,vec3(2.2));Cop.xyz=pow(Cop.xyz,vec3(2.2));vec4 mixed=mix(C,Cop,s);mixed.xyz=pow(mixed.xyz,vec3(1.0/2.2));return mixed;}}void main(){gl_FragColor=SMAANeighborhoodBlendingPS(vUv,vOffset,tColor,tDiffuse);}"})),!this.vertexBuffer||!this.sampleBuffer){this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord));var e=[{stride:12,name:"position",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"uv",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}];this.vertexArray1=new ot({gl:t,program:this.program1,attributes:e}),this.vertexArray2=new ot({gl:t,program:this.program2,attributes:e}),this.vertexArray3=new ot({gl:t,program:this.program3,attributes:e})}return{program1:this.program1,program2:this.program2,program3:this.program3}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new Mt(t),this.bloomBuffer=new Mt(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Mt(t)),this.bloomBuffer||(this.bloomBuffer=new Mt(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,a=t.texture;t=t.fbo,this.getOptions(),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var n=this.getProgram(e),s=n.program1,o=n.program2;n=n.program3;var u=this.getExtraFbo(e),f=u.collectBrightBuffer;u=u.bloomBuffer;var v=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(s.attributes.position),e.vertexAttribPointer(s.attributes.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.position),e.vertexAttribPointer(o.attributes.position,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n.attributes.position),e.vertexAttribPointer(n.attributes.position,3,e.FLOAT,!1,0,0),v=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(s.attributes.uv),e.vertexAttribPointer(s.attributes.uv,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.uv),e.vertexAttribPointer(o.attributes.uv,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n.attributes.uv),e.vertexAttribPointer(n.attributes.uv,2,e.FLOAT,!1,0,0),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,f),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,a),e.uniform1i(s.uniforms.tDiffuse,2),e.uniform2fv(s.uniforms.resolution,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,u),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,f.texture),e.uniform1i(o.uniforms.uSampler,2),e.uniform2fv(o.uniforms.resolution,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(n.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,a),e.uniform1i(n.uniforms.tDiffuse,2),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,u.texture),e.uniform1i(n.uniforms.tColor,3),e.uniform2fv(n.uniforms.resolution,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}},{key:"getAreaTexture",value:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAdI5JREFUeNrsvVmsNMl1JnYiMqvu8q/dzW6yKVLdokYSh7RkakyOORIpaoOXsU0bMAzYwBh8sA3YD4KBeZGfBjD8Jj/YL7bhF43lkT1j+EELDGsIjDnijEjMSJrhIkoiKTXZP7tJsdd/vf+9VZUZ4YwTcSJORGTWza3u/dW3Aonq+qvzZmXFl+fEibN8R8DQ8S0ADVADrAFWAGcAj/E4YYf95BSPXxt2+Rfw8hXABi/fXGBTAFwDOMbXa/S+OY7w+DXYjy1Djvw7jYdCKCoE2+PtDwvwqGsDXb55kGCBxwEeh3gcsWM/to5yEro1Q5fjyiV47PNjL68EorskdDm0x/jJfswPMDDx3TDZ9dBOAFjHl3foWsE9Jlz9sQd4hwB78V0RtMkyfIqoTxBfAzBHN1mGj/YA7wJgrp+9IWRBfUTHCYnv2cjbsuKrS9TMRwTqdTqukfjuAd7VGpyg24D6kI5HpKLP8IQJ6j+g24B6gw4LsBXfgz2CuwN4jeg2cD7A4z4eD0k/W3RXIxWEfX4MihbamwC38LgRi+9yj+AuVLTC6T8jdO8B3MXjAelna06vLUpj9LND9xpCexvgKTxuMvE9QHT3AO8K4DVi2UD7NsBbeNwj8T1l6G5Gagcj+dcQ2mfouI0AJ+iWewR3AfAGgWxE9g2A1wBeR4Ct+J4iOIiu1FAMh9iuvvUSRfZZgOcA3g3wNImvR3eB974HeH6ArXw18vp9gO/i8Qb+88ShKyo38wX6yUYAbMS3kdf3APwAHs/iPz26HtpivCNuD3D32KAq/i46pb+FMN916CYz3xwCxlz+tLnE+wA+gMd7UJSvk0m1wKtP+YI9wOeMBt1XAL4K8EcArxrZLdZOrvy025kfN/mPC9CN1P44wE+g+N7GdTeBVrBjP2YG+JsAv2sO8V04qgy0ZTztwKZ9xPyvXwT4BMDPArwfN0X22ZExrqOvvgf43CH+Ccjfg+WrcFxHM59M+OjJVz8D0Bw/iuhaqd3jOmEMn61vkaV7Ro6Oh8zRYQ/r+rBera8Mu/wLzN2hfEwJX5M39th1fPov+5Ajz06iSWdxvIGc0qIaf2e67VDxIZOzdxOfvioAyxzgmlxaHl3mlG7QFZup99eKq0dXJiftLD79zl+DvXncEk2yWtFDi/q5gXYKwK2CWzP9LFsfuB3Ep68EwJJtgaLZXMfo0kps0N04jCeKr4pXYi+7RQ7wzuLT73CAiy6AN4SuhxajDmJtoJVWgquRuEKb4NojvZ8LiU+/YwEu4gkVfkIrChc+RGjvuqhDg65cB/EdLcFdyrnlfmDn8el3LMAFO2QyoXab9JACSm+aQ6xArmLxrScp55r0Lke3/X52Fp9+xwJcZrMZJNjGG2y48E2MJr0O8hQBXqOKRnRFDULNA3C1/X52HJ9+BwJc0iEz768D+BTnsYH2LwC+B/IxyDMnvk45o1Ek6qnobgjdbfezy/j0OxDgRRaziSbUzuYDjAS/CvAdkI+g8OK7QcFFcOSoaJ6OjfTNufez4/j0Ow1gmyjhlaHIowgVLmnNPL4M8GdQPIDiBMQZrrsbp5aLfJ86yB3N3BXn38+O49PvKIAPKQ2myKJ+4XWFavDPTMSwfBuKR0Y523U3/0MxCt2aHBW97mfH8el3DsDXwMX+zgnNNdP3dYDfg8X3oXxg0C3qbRgMHTXtrvvez47j0+8EgCWG5g6zsC604vQHIH4bli/B4iEsVXvEcMpU2i3rzf73s+P49F96gA+oLsRnOG2fhfILsPg6HD6ApTZTuYtY7fGQ+9l1fHo/9mM/9mM/9mM/9mM/9mM/9mM/9mM/9mM/9mM/9mM/9mM/9mM/9mM/9mM/9uNJHGPrg9vKGsLxNn54D//vwPFCVilYCdBLUAvQC/bGHiW88JU9v/S2MTDv8RarKkmKvU5YCZovLLg1/s583YouQGM+dAOnOwhdQ86y55eeDeDbeNih2sqBWAmaeeXnD0fXA9zco07QxTeOujJG9xx+6T3AneMpZCN7ik2nLx89IV3ta0buxudPkGAjuEWA1utnk5aHxzB+6eMrB3C/AvBnECpLJghxOdAJlaDdZWtwcv5Y8a0hoMuXXqP5bxIx6Z5feirAzxJgluxVx9V8cYGhqSpIzp8gvtoqZ7StjPguzZtw5esOYNjzS48H+N0A72JcoNdp+jesfPQtKgp6reP8KeK7cNCqA0TXX9nzCu/5pccD/DwBZoXGzpSvtj7BdfdNrBb5Czxazx81nER6aJvjEK/8NBNf1Lp7fumxAL8fAXsW5/Q2zdQRycsp2sxvIK6v4tF1/ij9XAOtuwegDkEdIe3suxhrNFtT9/zSwwH+IaQDfQ+pxBtsmny55htY8vUyHi92nz9q9TXiuzRSWx+BarB8LwLsxZdJ5J5feiDAAmkEX0RxfBdD65CmqaYCw1exxvDPzjt/FMB1YQS3vgaqEcEfjC9+TBdHh8aeX3oIwAI5Xn+EWJqtuBwxKt8Sp9MW9P0JwNeQFnb7+cMBbhSEQfc61Dfx4u9D2G5nFy/M9ff80r0Bbn78TwF8CCf0WdJvHCpbg22rv78M8M8B/kaP8wcO4z6RUN2E6hl82l5EibwdU0azctU9v3Q/gJu5+LcBPoK20tO0dC3aymybdfdfAPx/AH+z3/kDx1rA5gZsnkdS4R9BdG+SLJasXpjKQ/f80j0AbhD6TwH+NZxNTtFcZFMjENr/F+A/633+wHF2G9YfBPg0wAfxxo4Zh4NogWrPL30ewP86wMcBfgHXuWPSfl0g2fd/c+D5Q8bmp0H/NMDHUNP6Ev/uWu49v/T28STGg2EQX/R+bB3DzcpB8eAJow9f9H7sAGDvSzw3HjzH2MIXvR87A7hPPBjmFN+cL3o/dg/wlngwzCa+rXzR+7H7NXhLPHgOXKGbL3o/LkSCu+LB88luq3LejwuR4K54MMwJcM4XvR8XBXAeD35l5tvK+aL34wIBTuLB394hups9uhcNcBIP/ub86CZ80ftxsQDzePBXyeSddXC+6P24cIB9PPiLu0LX80Xvx2UA/DrGg39nVx6Hmtwn+zHLGJ5y8RzA30PP885u6OFOVMMe4P7jz3d7T3uzecYxPB78AiQFucVmznLcfTvgy16DIS3I3UU57r4d8FyjHI8AoivUtnLcw2no7tsBXwbAcUHu9nLcQ5j0/OzbAV+SBDP52lE57r4d8GWraJSvUs9fjrtvB/zESHC1q3LcfTvgy16DCYEdlePu2wFftgQrh+4uynH37YCfAAnGaMCOynH37YAvG2BcfZf1rspxe7cDduxoe5B3APBqh+W457UDNsyGV7oh8M4B3kB5usNy3O52wLBvCHwRABeP4Qf0Dstxs3bAsC5g3xD44gB+cb3bclxqBwzfFVD5uu99Q+ALA/hn1G7Lcf+JgN+T8OoS6mPYNwSePsbGg1msR1SmWfRCwUKHN/YoNXxl4OUHlx/vOD79l30Ms3Nv5TtWBYUGqZHyRrvDozucyXAUHfXu49NXAuCI/plVDpntqI7QtW9ujOciHU5H3S8+vQe4c7TQP+OcFgzdBdPPROc8Zgyjox4Sn756dNH9jKyU/pmF9AK6bOmN6ZxHAjyAjnr38el3MsDt9M84p2bp1WRbNa/KvGmjcx68Bg+mo95ZfPodDnAL/XMsvguC9gDRbaNzHoPxMDrqHcen37EAb6N/tgseQXug4VC30jmPQXcYHfXu49PvTIC30T/jhNp110Cr4EhtoXMeswAPo6PeZXz6nQnwFrporw+XKLVHNRyrLXTOI/XzADrqHcen32kAn0sX7XZHtRHcazVcV9vpnAePwXTUO45Pv6MA7kMXbUWsQfd6DTfrc+mcB4/BdNQ7jk+/cwDuSRfdICDXcLOCZ6o+dM6Dx2A66h3Hp98hAPenixZruLGB5zc96ZwHj9cH0lHvOj79TgB4EF307TP44Lo/nfPgMZSOetfx6b/0AA+li/7pDfy07k/nPGYMoqPedXx6P/ZjP/ZjP/ZjP/ZjP/ZjP/ZjP/ZjP/ZjP/ZjP/ZjP/ZjP/ZjP/ZjP/ZjP/bjSRyj6oNhhw1+v0WVZ2dEhPaQ1Yvaw1aQWta739jzS28dcvzpfRr8jk1jTNhmz2I+Uk9aWYnoXvb80tMAbk2T3NLgV04FuKYiJY8uJ61s0N2I6Bb2/NL5KIehKzvEN2/wK0cCnLPNWq3robX6uYHWAwx7fumpAMuOROeuBr9yQmJ0VgD+OFuJN8IdXEXv+aXHAlxkgG1v8FvMA/CG0H0YkzesLbrSoNsce37paQAXMWAiU9EJxl3nD1TRVQfRToPuWgbxrUQQ3z2/9HCAC3bIDOC8we+W8wdiXLECcF/evxKwkpH41kw/7/mlBwJcZmhtAbg67/wh6NoCQ0sn/CYWszTHqTQAN+K7JtmtBSix55ceB3DJKo2KrA4kb/C7/fzhAJ8iTq9jAfj3GhGUcCZJfD26YF73/NLDAV5kVXkcsLzB7/bzBw6L1gOsMXwV4DsNchJOCye+G4S2tsoZv2jPLz0Q4CWrJrOFPnntEW/w2+f8IaOiCtKXsfr7QQEnBZzhurshtcyfpD2/9BCAD4nooMhqQP0rb/Db5/yBw5b3/xkyCr9dwqPCKGe77rZ8kdjzS/cH+BorF9xSfFnR/rTn+QNHA8/XAX6vgWoBD0qDbl1se4b2/NI9AJZYfHmY0TK3QmU3lTd7nz9w/AHAbwt4aQkPF6CWHYzC7Cv2/NLnAXxAzH+ew+LcWTgeeP6Q8YUSvt7I7iFoq/zPUwx7funt4wmNBw/gi96PrWMC70yfePCEq/bhi96PXQIMmShPRpfvhs/li96PXQJ8bjx42jNzLl/0flyIBHfFg2GGq27hi96PHQO8PR48h8rfwhe9HxerohOM5xhb+KL34wIBzuPBM6HbxRe9H5cHcDXbDbXyRb+yB+qi1+AkHgxzApzwRX97j9KFApzHg2cdCV/0N/cQXYIE83jw3IPzRX+VDPb9uECAeTx4B8PzRX9xj+7lAFyTA2I3w/JF/84M/pL9MKMY8xcPdyhczwH8PfQ878clAQwzm835+PM9LPON4W0z/hfmjDhrK8h9zIqBmuPOsMt/ENm9eSjpNLu2Sco5pv4uA6//yZ93D7ZNubXLlJLxiiBBFy2em2f/EVTSHM35tX0VJllT2ytgNqDG9E2NyYf2VeEFv/4rlLhbsYO5eAX6BO2r3acIen3hzniApzk6fMmmL+pbUSLy2chiIN220+Y1g2tB/WIPJ/SLFWyRkfGCg5ip8/7WHJhqom2ip6BrenQhoGsOzX5bxyGYA9ijK/QFS3Di6/Ctt1esyvp0hnpNXhHKLx81BD6cjK4IMx/wFu02hgPVni8CxiAISPtGpOjqxIugg5jaQ/j3HmmPrrp4gPOKvhXDNVHRo0auGtzFeOPYWfrFZspZdYlvwXQMoWsPIJHlmtm+elFOAdYtqtj9UzmM3edwWRJcx9PfVpC71GN8ITqL+Vt062XWEPhomgSLWFjtgtp6viSFDAxUpqIDqPRGy1hdA9PSKsPYi7JFN0H9EiS4lWDhhBXknjkBW09QzvzhWZVZQ+Cj8f1ida6ru5SzMAaXatPVXEWDXYmlexRSdHlddZzYJFSKt2BCfBkSrFnKRZ4PhwW5xTr06707VkVXeHn/5LhuwDdJgqc0BBbtplaLcpaZwSVIRZNYKxGZzSm6/pWj26ai3aLLhDiYXZcgwb5C22dM3XcAH1ROdx6M7T7q0fWXd03jeUPg0V+QgLRFOSPkulV2uZaWTIdLQpc+BNLeqYWFGU6iZu9VhK5fkuUlSLAnsnoU5znejyb/YFT3UWAF4Pby9XXqCXyLtSae8AU6W4kbA0olyjn/hMwrIICbE5QVYsJVEboW2mBqiXhvmalowQG2atlb0fpSAF6xgtw3TVpN8Si09fWNIRejZt8XgDfonh1hN+B3ZX2DfV/R0frZ614ZY2n3waJ7B8z0sBdZh27BVLSMRDxPHRdd6HrBvZx9sKYST1t/jwW5h6dGuqz4HsQNQsetvvby90rWEPhW9viM+wK+Sc1X2TaTivuENF99SVi1R1dGCzDkKjpLUxT2iJWze4VLMbKsfN3FXKlXTdbF7crpTr8s8mL/EQD7y5t2ou8j8eUNgXm9OUxbhjm6bYtuEPF4U+RxNQ8EvlqAox0wF2IdlfYIfjDxlVx8gaytCwV4g8bUdwFeAnnH9Ov1zYMPYmjFqPlf0+XVCwA/DNEXLNuoBEZA680rvi9qXXSlM740t7CsvW3ltcA3hXNfe3XN98QBYBVc0KIOb4KK1iS+Xj/Dxa/BVJB7444RsKdILZdxqfDousNHePmHL1BD4K4vmNDF1qPr9kX5ouuVcPaHyqNL0NrDi69dhvlEaE99Qf45gTA30EoCWDLN7N1YlwTwNwE+b+Ib78edywHrAOtBnbJsvFTAnebSn4LoC/IaczFeOXtPk84XXQJbdz0Z0iFq0C1BlQFgBy3NRaSfITjWG3QFvsoKAVYxwKScHdJw4WvwU1+Fp18xuvM6qsyuclwYi8LbP4Gy29UQeHKZr9PPBTkoElu6A9rglSygbnBd4FEajJ34soVDi/hx9ABjXEysDcAWXcnFNxbcSwP47i/BXQ0vcTcxZw18SK5K75EeWOX56S+B/lIUaThjoSTPIbsi+hz41WHxabd/9RhnC22CaIgaAQaJEd16aV4NuosArZbxEiXI9hZknDbQnhmA5RqKyuAqufjC/OgOBnjpfcu6g+E1Jnltfsbogocktd5HhfkR3U+/+LTVrqpwq6nm4UJJQAr3Jt1AlFAfQH0I6sDQS2hieOG2VUuje0HW42OQp1CszLQUNQKMiMpEcP2f6osF+MBPqO7B33uCP2MzBmCdUUBzaFd0HOQA94hPN3rV4FQEP9QWRJNRHcPmuuGKaADmstuJK7/mfRD3oXwMC0S3QFwlwzV6HvRstCJlf3TthD7kDqcq5nRm4cIG2hIBXg9HlwtkwuDO0Q33MyQ+vT42jHlKBGhbvZitH67fC+ubhjxElx20UTkgIhinNx5FpFOwlYBkLk6RXgAfsgkNIlZTTOAsDReWawR4Y85/PEE/d/Hzp/czJD59/WW4jhvQmrn7tQZVh92ntbsUkOeBPr92H54dvTv4P+GB5zQ+pd+zcj/P2tXN/Uv8FQJ/vESnYfPJe5/Lkrloo+UDFeYNToIAesXPzwfYx+Usp10Ie3l0vZGF0aRyZaBtxNd6Ju6OVdE8JMx1bXo/A+PTwZRi/gtNO07v3NcebP5mqgUf+7PIaBBka0j8zUJH6AqdzYtqo1fQLEpB6J4vwUfxhC4ScVkRH/sDFy5s0F2sYVmHPxk38o4cHt30fgbGpxNoHZzk+PUaWXNv8FzoQuyLZomVQjlxTNH1oglpKohQaaqe4AlAyp2/DeBrEEV2A8BefDl9xj1YnBl0D5WZykN+/rSQsJfGzvsZGp9GkfUzonjuhFXOOkNXz5Hrr+Nov3JrhPDOS0TdyrFDtyJvbGtSpkqTfgTHHn3anQBfj4M3Pn4TxMUSLFgWq7dheQqLlUuIO2BBgekBf6tlz7mf/vFpEtlIfLly1lFE1s/pDGKsYmuf5UXLKkQgInQ1BNbzblwjCfZRqS0SfJMi64dxgKjwE3pG6CJxxsFjOFiHP1myPxn3oHsGFsuKdf79DIpPc9h4UB3/qVkslmytOQQ4IQCzCnnjxBfqzEFN+rnQ8bMfpwlsy9nDn9YCwW3KfDqKobK7Pie+J8idgewKh4/gWmVmM0G3GBsurBlBx71z72dgfHplcVUBYGDpx53oTg68R46b+I2sHMwSYeaRxHYJbsvIFHlGZqsE29jrNRZ75VEcCTT9b2FI7ztw/ABuKycrh9nsy1EAW/p2S1/Y636GxKdXNN0imanmvxxdklm3WYKZ7CxWrCHosOrawmxeFb4hs6uAVDmLpNRFR9kggt1/tAYLjL0+TcSzB9lUui35Bte575id+817Zl94kwlKObVlg/n5j0kU+97PoPh0rJA9nDpJRdaxtTWLkaWYfmZ7WcHQlfi/CuV2Tc6KTvK54twuUUfJAl58LfalT0d5EcXFTs1iS+z1vmHNEF+C5+6Z2bxFmpPP45Rw7WMsEX6l//0MjU8Trsa/wZIXuXJzgHrBVXNwifPNOgUN5Ya9cnQrXHpRRUvVku5jgQ9LNUYs/NMpdUgIKa0b8oOY/HRM9PyiLQjo3vwxlP8YfvhteC9FDIvumN6ISXkFiVc+1P9+hsanad3SDFqdoEv6zU6TnEWCufFsvVdrF1ly6Fohrp1ytrEmgzG06OewdY7R5eaVRbp8N2rC9zMGaLnVpfquP4Zn3zDidY3ombtitaMf+ReH3M/g+DSfLEXK2VukfiWOI3cwS8k7+W4stGJDGFcEcG3iEA14JUHrUIw9JIJxggqvya2sM2jtLy0tg9xX+t/l18wC+aewq/EV9tprfMkYWC/1Pv1nlDOhLa4RuijKsg3aGaxo7nq1grtCdFF8i43bIBVkPNu7KnS0exZ1mrMnVZTS5aH1O/sSrtrAmdLZ7kJTWoWVm7B39R9O/150ppqYPx5yhbFhCzBuloxatjkemnIByFbysTtRuSNK91HR0hvyBa4owMzXL+pQICSZmHr7WZJ2FtP1MzrnxCkUpyDPjN++QAl28f+aFmACGChmrNj6HdCljB/BTg6ySzHmqwdwHXz9gtVfS+bCNKlzcWbFDKNyLnX52BzlKQLM0C0US+LRpKXxCVupkMxlre6Qz6VZvm2W8QNXEWBSdMC3j7TcSt2dKzMR5pXZ0cn7UDyE8sQEZso1lHVI3ym8ZmZ2gES0Vij9zZrdaHUr8T5bT2bZel524Yqq6LULnos6eAMEm5TIWT1bMifu19+C8m1YPjDoLtcmZF7ifreoncj6JB5JGTxO3zayy/K5rLgLFZ+sY2jpkysHcLMEyg2ZnRDQDSfo9q38VIxfheIOHL0FR6dwsIGFMuJbahRccDhJYPlZHLAHLflczvSLn07hHbH0zysH8OKhkcy0A98FdFX6f+D576PbVTvHnMh27e6uRPY88XwunfkKRecjeBUBPv0b2Ea8NHRXttF0bbOdMROvlpQyXVIZkidYkfBTvw5nJawWsClhU7hXk6C5wItIk2ppXvFqzdTWOMGum+YvmVDIuPGB/xve5PxceJ9J+r7mRegQSmYkXL1hK1YUKyazZUjOl+XzpWN0NRM0/4e25kxR71rjdCocovy9Lue7c8/PJVlBOsSvMpxzFQH2tf2hrEGwgjNfx01nalaN4hPllX1EBGFMf1gLei3pUuUMxKp5qqC/Ycenl1CC0BNQXk0J5lQbHjANVFjGqrw9uqoIf+uZGxQ2MLbi66uErX4O6M6yEsbMXFpE1Ri+dhnih7X5Z3lFJVhEtfqhIq2IJkjTUqd9yCymcNBUAG5VsaLaQx2jq+Rstw3+9mRU5czZBDR7U15F8RUUJ5SsFg0rB8HX7YtAz2DrGHQsQ8r/oRXf0hg+BktfNEym1nQJ1iJiUYzElwgTOX0TZ/e5kiqa5kv5klFBNd0yYmiwOEWqj8h1fCV4c1S2tBAxdn+Cn3t0tZzv0WQPH2fYi9CVQdbLK6ifIdbPSrhqbi1SwdUJ7QbEJ7DyflW6TuW6pKvxyv9ihocyEHvxFZeVrSYcbGMB/lVKZEwSlx9QJQHVE5hjeGXSZ+I6I16R6l9XAqpmx7kw+9fP3E9blW7nl3bBftoFuRpDX03KBbeIKeyIbtRJcOFe3TbayivV/KuSVYUX86zB0fPnmQgYMxe39v2SPPCbj5kZqrICw7h81LweT7By42/gFaQ1odtcfzC/NIlvqCAtiVFF0j8XhC4zj4O4e+VculddOjoH+16hp0pjHrb9fGSJR2Y3RLYhI+rSsSgDu/khEmxJIiGe0QRdX/J1Quc/HvxjoK362wPWyG6FNb4u7zm+o3P5pZ2FJcPS64vB3TJcEmuOzAgKCeDaOrAKV+eviNTBwVkGvT2PihYptC1HEZyf3GjoDfB1Ki6wQ3WUa3oWB3/+6yOfWRU3Abe62kC7IF7h43A/g/ilvRTWJIVuNV3Q+5iXkCd5B4IAW0heEmXHkv58EaAFvgxP18+MdE1xIyCW5oQCph/ANxgLaC6+j6nkyx/J+aNUtMqKg5ul1IjvMmYUHsgvbcXXOXVLQqsgEfQTR4ZxYEaiZc/hisuEhdagy1k7JCpnqwbKsXxe2errTXddxAd5TCNoBwBsOV79nCblmh7dB1TTl5w/dtWpGWDNl5xJ2CyhOogvfhgp5z780vrUoeuEz8riwq3EULj1GLyVxNSdQ7dwWkQdIGWHpXOwElwStAVBOx/AOoY22HGc4jZGtwfAtzMSX2Bm7ikViN1jhUT5+ZPRbQ6H7s2MMppUdE9+abVyVEjWTGtwMlCVwTuhGa9KJA24SDdrRIV3YtlYDCELiq/lddAM4FAKUEwNJuvEsiNbPQK4iKHtJcFPU+XXDULrkCS4YuV/91wFafv5Y/WzR7dZ0DcHsDmkp4eL78Fgfml9D6qCdlkHjhDJW8JQRjIRTRmibtA9hOrIHeoQlTMC7KBdkOAW7q+mSzCICFq7FoDfhSf0TXH1RzfA7yLAbmQM67UjBTIK+S3qvr7l/OEY8/ry1RLWR+zpSQpJB/JLNwrWimCF8mfXUb10/qZovoqU96p5LJrnbH3NcO1Ux6COzBW0fW5KVsHojTLB6nkmDKdyrLIhVaHzOjCZkbt0Avwequu7yaowbXWfpgJDi+7rVCbWdf4o/WyfnwbdkxJWzdWeJUbh61THSFWhQ/mla3xcNg1IR6RgF2Fj46asaGdGav5kdRM2t6C6BfU1A3CDrl5m0BZMT0qYTmjm+LkOUGEsiMGpzHjXcuqedoDfRxTNN9tqbK159RA7OH8Py/p+YOv5owC2HcDvSThrEH0eAXsKQg2y5w8oB/NLr6/D2W3DhmQU7AGRmZWxzOVcV/h69gycPg+rZ6C6AepaXM9atE33TBl7hp/rBvJz0eMYdMwWci58U6Z+2h8CU1b2DJughKLZTv+bWEH6co/zh6ojFN/7+Pw8bp6YH0T18BSJ4wErHSwdr/cgfulHPwKPnzL6WS87aMygs4bu4Ufh0fugvpGVL0JcLJtzX03DeP08rG913DCcQ9HFAJZYZPiDqA9vkawsMopmO50vYVlfn/MHjg0q2watB7eRkvQH8Om5EVeAs0VuKL/0j/6muaql9xVMbYgOdcI/X/wL+JAIJMQ2iaLGqZMQInf2/wpBGXHoxP7C/2z38kQWQ3XfJp2dce3YikJRRSW/z53B81REWrDOoIITPNAdC8/tBRzg5r8fxQl6F1Vct5ZzC1TLf44dnHueP3Cc4De83ujYn8Sn5xladBexIqXjAvilWz3Dgne0g9DIzqMLDN3Uw571b+CN7NKC7tbMHXt53aIAkw9L56j6eYC/grNzxJ560Ua210D7BwD/Zu/zB46XBbz0LOifQ+V/i6CVbYWh+DqCX3q2HFkKvEtgLQvpG4VHV8S6QkXFvgn9USCv44X6bYiKnFiipsqMCOAfQ037EdRsB0xEtqwfHxt4/pDxxoeh+jDAhxHdRSyybfjsml+6dZvum6i4JB4Z5TWKGF2dCLGK+ZQ8pxX5dwKxf1yQkgOcyK5sq7gp4Rtgjt8aFQ9+OH88+N/5GuivDeCLNlSJXxryBZ+cnC/A0kKsNua9Rs9BV2fo+hJWu/Rq1r+BcbOlKjpT3aKjP8vk7qPb48HTZOVcvuhLTwsJsTxajEWcep6q6DbyFIdxFXfn8K91C6gyrqQSdZs5q8+jMuw1/VviwdPU4Ll80ZeVzxVaDnvxJbAlbw3tGd8z6gjOk+UquCvWfsWj6zlWikx8dayc27ab1pweC/C58eAJ6EIPvuhLE1wWgQcIMUTBugg7dElwpWCt7bxarkgt+x8Zi6+sndHkceUrsYgNq1z2pHLfX84gvnk8eA5bZgtf9CUOzfIrhKD+LDiXwqfI+0+4xubiy0lmKwe29OgSC5qnlIgsLM0QzQ0ruogcvwafGw+eyVLt4ou+9OFTlH0OukdXs27Bkm+CJZPgmqqTicRQ8O4clheNuGKD6USizD+JDCvLwFKnu/2xEtwVD55pdPFFPwno+pRVG6MVHF1BPiwRFyJARAXu+AU4+6hyRJXSCy6nZAAq+dVBjiPDSjuJlzNY0VviwfNNYitf9OWjGycnWy0teNdvMP8UCbS8d6Fl7K+J6c53T6qiHkqBwkFFNOUewsjL4av926ZylAS3xoN3g67fZs8rheP9H3EqsvCtR20xblIKxr1a3o+xca/WcvYUaDJGV8bsV4I7N2pGZG2ZOtqE0CrwsfE8Hg/+/vxqMOGLflIGLxpGdF3VoSBjijcrxPOlN7C9TbFBOhUkuDOEG5Yyx9Ov8PU4plNxK673R+aCy7j9vXdxOMBJPPjVmecw54t+ckYoxqV8KG9hRX0oaRkWvmhMMCK0NaG7Jgo0y6+TCDHECzD5LyXFJPxGyIuy0C0hlVH9g308+NvzTyLni34TnqyhRchatQCLODfP74vCXtkvw2i1GNk9Q7Ic7G5XqECS5eixgLGrMK6daJfs7SkdejO0h8rGrME+Hvz1mRjCsufH8kV/f1dadvxdu4o0luLjc/OsbQWJbQWMUQXDwPKxobmznYc8wAWJbMEYryTjrFPasRx6mjShGF0qpFsp/zpqDb6H8eA/hBl4CdqG5Yt+eScPT+TvG6NdFphlx2jnrXIWIthW1qQSxNzj3zQ/TCAL2hLZkAxJFpKfFSpmyALGkEXvV2SLSU5tx1wfHk7IAmnDAf4ywOdQ4exmvIKqQcGTOKqnTdpbM2dWMwtvIVMRn8gZkPw/3oDy+3D0GA43sFSIrkbZ9cFr3cJxbV8rq9VVeA4g48bq2hcMB/jr8zgju8b3d+xqnrJHOvl3YfmKWURlFbWmitQjsPggGz/338M3PwjXD2ApoUTrWnpZj0HN3N7wqd+GL/wkyAOzDYvSRYa4z3uPz8C5BbmNBUHluHBn4OUHtgMefP2f/6Rb6gu/wUA9mYRXZd2SMPhffKmlhWBg5xbu1Qd8NX5is7d+5edCV4ZgMNMu1hrPBYWGPKuxFeiPb8Y/0HKMCMC2glyxjspxp7g7erQDHv8FovU9+Xjlea689jY3Inrvc/M0dyb7JdOvsn7Dw9D1QUA5zRgpJym7toLcuBx30rV7tAOejK5qCbdJ3ZlkqbswFuk/FdEBaNbElqMLsas5IrrVAd2JVS/T4sFZQW5bOe74aFKPdsAzrMlJuE12ia9KJThkz4kgsoqTvIgAduRp8ouuZtE9xh9swZY60JFfLMAdBbnLOi/HHS/BPdoBYy74egKoOmURbg3IgA6M4dDefYxE1sMsGMwQ8Yum5N2kpb1zg6MrLkeC2wpym817WznuJP28tR0wqYhRAHetvi3KGYWsyLR0aCMqkgRnYt1iilpnFozQoVOT39TKVnT1ZanouCC3oxx3vHbobgeMrDn+C+6OuX3RthgXbWEZji7EXYA5okF8BRPiWIKTpTeU8sbkz4nD8sIluK0gt7scd6QEd7cDxjLwo6lfIBL9nOhqZn/JDnQT8XX0pCJS0crznTJBDGnPFD7imyLJmMGnW1gTVDQryL1ebynHHf/8tLUDhraGwOMX4JDupNi22At0my2dZHyaV0Gv/uDKOZNgvvpKEmUZoyt1WhN6sRLMCnKPzraX444EOGsHDI8K6G4IPPJrBJNUke2DxdYNuoIAp4rRVSLUKXFmWMHa3kjmgvboFkxFe3r/CweYFeSW984txx2pHeJ2wHB6CJ0NgcfqZ986PdoXZYsu/8O2mrE2dInSEkTk/fBWleQY00JQkOxy/Ty9Xm4UwFSQ26Mcd0y4MG4HDJWn5mhtCAzTluE4ual92eONlbyLTaSHU86SvSI4LkdaR6uvl92C0C2Y4EZCfNEAU0HuC6pPOe7gwdoBwx0JPRoCD4eWdQWW3COd7Zp87zG+OjkXrSAvtIgXYC++BK21v3zXUyuyNjRkcS2sfoYgwZGBfdEAY0HuCw93VY5L7YDhzg3o1xB4zD5McKdVvuj6/JgOA7ASDtpKEsAyoKsJWsWTOnTY6RY2VqgCwAVBW8T6WV68BBcvwfvvDCrHHTawHTDceQF6NwQevAMWLLqeLro6rQxo8cAIA3Bl0Y0B5u5Jx04LlLtDBSkFxflLjX2TIGAsqGuOjAmvLhTgn3h7t+W4X30KXnkahjQEHizBNimiIDEt4oW265LN/3WxFUR3g31urARz8fWyCzzjDlxueoH9sBYKFpoBTBi3MdVdOMBf+jR86TxCZ7EyWSmL2vyYoeOX7oK+C9VLvemoB8anBUtrktSxU7Y6OnRoLhcSI4U51tJ0TPISzJnj/QEQ3pgoPfYGtuguLcBWQnRksiSa+aJV9LGd0/MInRtoLbrHo4qVBtFRPx4YnxbU5LNgvf8SREG3i45J+JdwVhhf6bpwnaoUAzipe9Bcx1Qm0e6ghkMFBxqWOqVfku3cXBcIsKN/Po/Q2WWU1VO4SEfRUfeLT1sxKn3rTt5O+bzZXAt4XMLpAlaF4UOsZeCdTgTXIxMwbrTIGq5rONZuM1l00DiJGSyN4QCn9M8dhM4lauZlndA5jww3D6Cj7h2fPljBAS3AMos9tAYk/Lh/A+4vDcYWXU7BHmEJDGY/gfcNn9hN2sbLjHCt1agQFwNwSv/cQejcLHWN+C6rhM55qvieT0c9JD798BgeYbPlBRUFCZLp0G+ZtjGShW+b9z9yCj8ydqL/wS/Cl7Hr92KNSdEbbB68MRplYdeLCumEaoQfXwUSMDRf/fzzlDZbUxt47V4L7xRjQWVJrrpe/YPb6Z8zyl95BstmjalyOudJ4cJedNRD4tMPIM27SaoE7Kpc6BRdMUd/ukCGpRweBdWhFLjIF5bezDpe8AYKlcawQ8CRvQeVZvzY7zoH4Hb65zZCZ4tuB53zyHSOAXTUvePTD3SIywbnA68IUq7UAGJ0p0fuPLrAOM+sD8sqD/umINm1LpEyj2Qxd03IA4H01b7ZBnA7/XMbofPBxuRzt9E5j5TgAXTUI+LTLGwHDEvv9ChY8QiPxs8wdPCPuseIxFf6VHgdoes1R2hnDeHmgbeJztDdJsHb6J9jQuflCo7WW+icx8QbhtFRD4pPM5ox0KGgT3jnsGpBV6JTYrp+Dk5QKiq00Fq1zDH26JYQZevxPD1JdWk8VS960yXB2+ifY0Ln8gSOV1vonEfq5wF01EPj05ppSNoKB24bVh7i3xQUy5thDVbpYSpINRlWPvxgVTQZWcCKSIEvMSpkXoZkLh2iFO3FZ9vpojmhs7wH18+20zmP2SANo6MeEZ/mRXwqZL5Z36GI0S0J3YlGloaoclCSKWcF1xnP2vmoLcwl17EsWy8KGCef6DSWXCa7rvPpnxmh883H59I5j9HPw+ioh8anGflnKLhWLrbDZ1+Sr1jqGTIrPK2CZK60Av2XVl4LrEgrSXxDlEnFyVw6rQcPuT6aqW7I1uCedNGe0Pn2gz50zoPHYDrqofFpTTXUDF2LZUixwPktvX0LMwHs1bLd+NKK60C18SU0uEKUCd8opplFVmvKn0gOreQS3J8u2hI6P/16TzrnwePeUDrqgfFpQdXTLuruhYkl0JQ4xWHK9AxO/8i8qh2iDleGbknoWqStFbZObLRM04RsvUR7W4AH0UWLl+HZl+DndE8658FjKB314Pg00TLLOjitSh2yLErtDBye3TjLNomLr1XOi9qhu9DGn2W/2kLr5bi5h3VcDyFVnLOnWbIAs66dBA+li/7wG/Dhqj+d85gxiI56cHya9GRBc+0r7Quys7hA+DSaQs+got2iW0ey26BrA4jNVyx0rKLxF50k63dipuko10fGKQPlULroxv75Guxw/BZ77TXuDqOL/gWvJHGWFxiBLzQpSZ2mR/k90tQH1/qQrd8b4zE2qLrU7ligfl7gdy3oHkpuNyS4KpYpQI+gyILKV64DuFXOJb2WtduZLLMUuCTLYjrAAgOpBQXcDmoT1zpAqV1qSgEgqS0TgLl69/omBli25YRcSYArFxVe4hK4pAQaD2qpW6y56VZ0gQAvK+O0b45DBYeonI0Eg1uAvcHBOx9CnKdQ0modnsg40VRcZQm2/HImrGk1JMpQSfsibnvLbL4mDSS1W66N0/6ogiMFRzUCDA5gC21r50MblvCpCqVmT2RHfztxZSVYrmGxwegIZs8Y3YiKMd8xyyyZZtLYwGJl0L1WGW/5cQOwNgD7TP4tnQ+B0HXizp7Fc7sXXjmAF2cmdaaZ5WNFAsRmqmjbas+SPSPO4OgUbq7gVgW3VPDK9el86PO5DvCevbenT/fCKwfwtRO4XcMt7dzUyeRubV04bTyEZx7B87Vz/A3rfIj5XDe08eH4B6Jn98IrB/CPVsb3eRxPU1ffwhk39+9+1fjm3ofoDu18eP2BiejcQnSHdi8UVw3gT/4M1p7UUGuXrV4r0NoEOQLvAjoWXKqMJAoVAf/T72Gz+bb2TTZf2rBoSSTPEthmQ5pPGjQqAb87oV/Tf/jnKT9XUhyVcg14BieYI8r5l3JoCHF0HabD1xFpAtW/UXEul+J1pDTXSjouNItuRejWO7h9lXANxLgCoX4VAdY6gKdVwMy9oU+ANVVJ0K2jzmVEcycCulrSK36o5TyghsZ4IiLkSnD16Nq2qFdRfENZmI7aDipL39uKroo4OnzOf8WgtR8m6DpRnqpu3Fcn/Q9T3jUOOS4u5ZXUzSQQOp0jr5w1RzcmGlVtXcwqGWqFnX7m6BbziC8kLF2ig4yNcYOUV1NF+9UXuLpT9EYGRefRVUyGVCa+NSsarqX73KnrYoY1uAVXwWi5Mg42f/9XEWC/nwhICwK7Dd2gz9kaXLFSN1cGbk3ohNdBzrkGq+zQIqWD4exr+ipKsEZciT/STYQmW5qjy+0vGdU81oymwy69lYfZY0yozyzBIl10U3SJumvsGvwZ9gz3afA7cPwqI0I7i0uEfeUZr/79HwbyS/MFOAiBCisuR9d3IVTsD3mN6oZ2wFZ2bUm4WYMLtxJbjCeuwQm7T80M+EC9JlN+Lj1mDV5mKmN7g9/lyDa/Oq4G5c0peZVwVYCVjv780l4tgyaiMuVE2U2WdupaMcF1LXPYV9TE4lCR1Hp068JhbI0sq6Xn3PjG5Fx1gi5XQsMk2Jcq9GzwezAS4C50kwLwBt1NDHBPfmkuvkrHLISangARBNrpbR2VPW7Qqtogl4N79WBjPXiF7XbsAqzETAALxi7PvCucnyvsCOQggA8IsJ4Nfv35D0f+nqS8P6ETNgwKJQK8HsgvrYNODjslEX8oGcYiMEVz43nND0mUHQJLh5szS5p6RGKiu0En/FycRVHSAiwDd6bnf2ne9AP4kAHGn6iuBr/5+cN/T00FUGcZnfAaod2UeP3H4YHowy/tQVWCxNfOkYroj4CML2CuD+DaShpoLV9Hc1QFqevCWVgO2sIhMXFw8Y1MdBGRoGpelt7Xij5ixUbLTIfmDX7z84c7IhRDl/OwNOpgVRpoG/F12dJ3B/JL68gTVFv9phzS4fFnzmog8g33iwWsSHBXSNaxQYA3lpOFbGlN9B0hXDFNP3NoE/omL8EcWvumPB/do7Zqsq4Gv13nD9fPvgD8EVV/P0B01wuol+ErhvJLa1x37errpkaTBCTQsjZm3sY23yIMD8uZhLPSALwigN3qS7w72suuTOkcxi9YsWXn7CwZZDehbzpPgq/FzMwesK4Gv13nD1dHrDrVMQo3x9nCoGtaUx2y0pSB/NLWvAoUhBCEIDi2MpYrq1fcL5Z4lA5gy7hjRKpwEhwEV7DG0dP0M2dfq5ieCHtffjDvejfA1+PyPJ9J0NXgt+v8UerIlvc/xDolW/19uoTVgihVDkJZ2VB+acU6HdVeRQMRH/EJ0oHDzM5X8y0nEk4Kw8PyeGEwXqE1UBHAihEradIK08Pulp/LmnIbuxaIwPGj8jsXYWXpQCAv5C5Z/WXe4Hf7+cMBPiN038Q60scHsD5gX7EMXzGUX1pVwS9R+41j8uBD3F2SEGq+5WFpiHYeLuBkaSS4MfdqRqkUBJd1igYxtQ9jc6srGS8HnpxLRusueB4nUjxtAPtC66NoKl3aUt7gd/v5I55WfHLeQkbhv2igOoTqGqs+5nlyxWB+6eqhk4aKM9SR2zK4qXNmJAEPC3jrCN4+ggcHuF6grVdhD9JaBm3MuZVAxE05Ro0Wfi4RUXRB/HTyn5ABbKtrr8X1oDxXmDf4favH+QOHfXjewtLv7zTa4RiUL9Y/zJ4eOZhf+uzUaNcNJx/k6MYhxWS8+rzhwH3r0Mx1Y8krZi3zxRsgUwbTxgPOzyUyXHOKLgZzGQVY3oPF8Tcycmae5uUb/L7W7/yBY4Nr53ewPvjeTawOvskEMUsFHsov/byA5yvXRViwGeki8Oef/+Kr8Ana9p/hq3V6GL9HRhxtg0u+/9mvfyIUkAEE0gghGfOG/dz2EGd9ln74AbxIurAqWEgbNUd6zzLadhPAzXkvojheZ9mkrcnB91EJvtL7/IHjPvYV/5KAe88hWrdI85dtaaJi9/zS3X5/v92sWYzWh2lr3t1OtCkHzdrRKnrN0I3avnBtL1qikLlbtHRuyA+Cobc4psxM0Ubia9+8gtQKH+p9/sDxxwD/uIS3fxipG67T9YvONNER/NJiArp5Uod3HGoZggHWgtMiWuP5DTiOTBl6Uro2EnGPNLnljkXmP5GUZhQB/G4UlPcjWkVc/NA1Ky8OPH8QwO+CN57Fr7hGlTpd6ef4z53zS3e7hXm6DO9GWYl4e+oD/gmNmXAohq6k0ilTYIyEvPCcGwoqmw3VZs2VZiltjq+Migev5o8H/+03Qb8J1Z/25Ys2xcGW1KPn+OQ8AGsK6VRx7xW+Ekf84PlVBOv/gotxK7qJiubCGqHb4RCd3F52ezx42iSeyxd94ckgaWjWrb4yoFvF6GpyZiUaRFiAPdterpktuqLNPM6obNvd3bhITeg+em48eA73+ha+6EtK+GG4WvFlhQURuhS6qL0E89bQpLQdgiLiInTkdbENpXkWvojN5vxGyclVTn2Mu+LBk6Nj2/miLwtd3Zbv7mSXB+/IzeQD8ty8svpZesI9Sf/LoyuCgS0g3am7ZoitutrnGMkRGR35k9wVD4Y5xTfni77EoVjgvYrR5a4xH+qvmfcjtP+maxlEaenN0fXrcW5M+fd1YliR4KpJa/D2ePBMZmoXX/QlDi/B1rYKAPPeKzjFPmTr8GDKVqD97PhhBUNXB7wF45aVifeUK2oZbYu54E42srriwTPNYxdfNFw2wF4z+9xYm43FAbbBWm9eaWAA+yazipDmPd1zQxqioorg3BCxYUWLgprHiu6KB88nJa180fAEAJyIr22g5CU4pHP4MDAPPPgOPZZlTTAGUcF8gJwUWrgVmpfS2H/WXC3b7D5oWYznaBD9aGazp5Uvel6cxASAbdaODbxvKMhvj4pC/Rxg5TufAeN85jSTsQkdoC3C3knz/bQ3rIR7n6hl71hU4yU4iQfPLSWcL/r78KQM3/nMquV1EQC2WRYJuok/C5j4JujyjtBWalvc+bScO8Mqs6f83/hqJRjZXjaJB889iZwv+lV4gkbIrPC9sQqXT1kXhGvcKsvH/IGxsIduwYKRDwqnqCHT1ZrFIn0HrsiekiHwrKcaWTwe/Ob8k8j5or8NT9YwsWfsfHZGyTo2X8fMNQJssnY8rpKtvjKswTJhSxQB2mgB5g51kaaLKBHKahKRTZbhcsyvtPHg3ahOzxf99TlC5a3+u9GXbZbe08Jkh5nkCpu9W2Btmc/XYUsvJCk71A664PkKMiIAdqun3TQLZ2MDhPQum19QszZ60eqbUQONcnQ8xoXx5d1MP/FF/yGA2o0UTrnrRnAfHpkUogZjm43lE+00KUmQaeWLpsdKUpB6IQItl1uDGZw5IZIBtXRZm251jztfejh17GwcpaJfQeFSu1KDXwb4HEzlPNjRuPscvHkdHi0xT7YIXsnIBREnRvHR4HogeT5Z2km2i8FJHZjk34pkV7OUsXOzgoYD/P0ZXM1bxtd37IzUE4LCX/nP4f6rUD8CjaxGOmXKiAki4je/8An4s38Jhyukp/aNUXSKZbKa2PGxT8Nn/yXUK/xG7RR+T100/Md+jnXWWbUV5J7QJ9a39flhl/8UOTqSdsDN9VYF60TomxEOvP4nf9HZREYaSnyV5PMraAeC/yvUBBfOiqm/gNZyYf5c4RtdkH4unMMB0NoK4kkJQ3d/JSYGqGOunrqtfJ8yCm5/dfwDLccLwvZ4w9l456Vm2zFfq2m0hq9pOGLHWFsrpFTKlDTJVoy5UaSZErzpqBYx+6Bs/6eOw4XpkdO68HyRabbOtGhSUuefVGhP8E7nJcKwzKA9HtkcMSnu8FtJ/yaEazJ0gSUhczsZmGMy4X/VIvNFd0Gr22jWLgHgJNq/aku5GAuwjv2hLpNAMHSP2XE4RnaTTUUkvpJFWxP3fRGeD27mamYm6SSvVLJPoBtjlYlvkvd1ORLcpyD3bKp2WPvKT9/omTcEPhyrn/2rjLR0CNFIFqgXTpQjS1fG4tvGMa250tZbD9XFojN1w1JOEt8tBbmn4wGGONZsSoEttElD4MOxKhriai3JxFe0oKsLVgDBlLMmkXWb4C3oymz2cjjrJwRgiAt4T1m+hU94fMwyLMdKsG8H7KDtagg8QkWLIL6+sha8Lc3RpTJfYOimtpVoQ7fI6PVhC5lp/M86U92XAzAvyPX5Fg9JP2Npx8HwPbPXDvbyphr4BnUD5g2BfYnwFBOaOZ50QYuxR7eIg+qti6vFssjQbWVi11m+Yi7BdQq50BevolsLcu8izCS+vtHEatTz49M5DLS2G/BTcW/osRQRiYvY+aEKoh6iN5H9TPCLfI/klTPBrIus1YNfgyHe/OTEV5mWFvrijayugtx7TnzLipfjGtxHaAdb3m9E9hk4ryHwKCudQnva1/MI0sYJuuy9AKZ4pRNxXcTobmHnz0H1ro+U3yxuBn/RAOcFuW9hO+GzvBx3pHlljLYFlhZ2NQT2LWwn6GfNQ/QFcUsVbAGWaTg9/G3BGuDYSuW8gVHCvJ+T1NaZY0u55nu+i/WFS3BekPuGUdTX2stxxwC8smkE74F+DYEnY0zo6iLQxDnUGdLaJkGyVdaebzGOZLfIVl8Z2xddh4WWK+dLUNG8IPdbBuZrm1DdX8ZNZkfMv738aSOyH4DzGwIPd6U75VywCG5BGAvnkVYZtGExls4FrUtzOHR5eKhVfEVW6ZN2YAjoCrZOX8Ya7Aty/wiO3jaTf0xyVUwt/naXf6251o9DS0PgYo4GxZKxW0hDSRfQlUGCQYYMGCeCZE9pyRYIBnNn+0AOsIpLuQhdwcWXeo36ptAXC/A3AX4XFl+Ed29aynGnVwi/dgs2HwH42f4NgUdKcG2DQpSMAZRFBTIQanOkbeDdyO4Cxddy/MR8Ep3oCpbOz4/KoSvi1RdYN/eJYzDAB/8MDr9s0L3BWkPncz465nr2cYCPdzcEhqk1vlY5W3TrMqRTOYwhODGScnonviiyGhcLvWxDN4dWsM2fd+4i/4OoXF9Cbli5giWYYQEeA/Dql2Gl4X6V8co9ZDW8D5nP8s6w63/8s6A/20bLbNsT0ZuKBGBofFojrvYwlKGSbGkR0m74istTYQqEVlvGvAOALuXc2oisimNuG4Ouh1aoCFfBcjXERQJc2jnVHeHChOH1xLT6HOdoy915iXVi0S19ck/v+HQDarXEo8AFmFHSAXds5aEnYdBVR6DxCBvBLsGF+HUTnjaxwUM55Sx0AFX4av850B0GsO2QWUEWz1u1hxwkNlQd7UnVWY0qh7ZqvZ8e8enqCDbNsUAh9u6OhD8sJ8myO8QboG6Cvhbz/Yg2nol8QbmPe8uHpv2pRNm12lioUPHgX8PfXZiKXnC/Qh7P49Ciim6gtQBPRLfOOATskd5P7/j0ybsNF2Elo+w1gPZMuSQjtXoe9G1mGcg2RLushD8CeR+b/uqWTcBMBCdjAV7QUUKcULOJ+yrQMtzgWmwcxjBBglUbtJvkfgbGp5/7ArxLgaqRLFphCVdNTKQq9MACH8VRro9h8/lqPf7n3PsdUGtYr2KKi9yo5pvjjVNft2Gbb6TFia1DSOp8gJdsNiMJTvh7KaBUrAngaiTAug1d3gYiup9R8emQ/k7kwcB6OQR0eVud6UN3RPXr2B1d0aui1zwYpdtInXQczMDVvTwXXT6hRWu4kBXwNuhygEU1ZhKgm/9j2/30jE/rkHnKX8MbxXLk1PSAbAaw7obW/7OKUzCXHQl7alvqjzhXgg9iXmA3ob6A10Z87ocC3uIMipWB1olvPY4uOhLIvMlHej8D49Nhe5nB7AAWDGkuyrvDuIpfq+zDZZYvoLsou+Jg1BaAOWk7byju4g1rQvdtDDa8CeUport2q+9iZDSvJWWHt4FouZ+B8WmGMDGAe/H1S2+Grpgux7pHNKmK94L+8y0XUS3iy73Z7RD4fJhFtt8L5aMPqID3NSgfQ3kG5QqhVZOieQm6SRuIlvsZGJ922lizhqI69N/QIkNXtZEGTrEb82BwzfZ/mwzgqi0bpKtJJndod0lwHvjjTn7ncmMFvItHsEDxXVRpNK8YOwm+vvykz/2Mi09n4us6GCaaWUTm2GwSXMe+Om82W4xJjoVP0WrFODOkhUo7R6cA26SJg47QnLQut1NE9zsmXLh8AMsTI7uH89BFhwp/u+06/35Gxae1b4ClqCl0gq6O0Z1FhFVHQKnKHLAWXR9o6tLwsaUmsoxMkUjwUyzwWsZTGTbma5zNbwH8KRy+DctHcKw66aJHAGzxsoZ5r/sZGp/WYenVbCVWyRoMzJbWc0Cs6eclFUoc3TVD1waaFFuDt2RhUsQiQpdb0YKYt1u5nyN3jS3g/X241kzlqZGwg2666BEemTWxc/S9nxHxaQ+tCn2yArqKGdK8e9JcElwxzcwiS24j6KGlJ0Cqjj00zwPhuloHI8vtgxfIzXwL5yUnCE5B+jLIfwi3X4ZnVKCL3uKLHTpsF4739b+fgfFp153Qd6BUDmnnrvJqmbWzm2ebtMV3s2bo4gJsMZYexa3mt+CbaU1pIfQn5S1MiXkXY/be7lW99odw/WV4FtEt5w4G2/HskPsZEZ92hpViGGvX5g5YOzvu2JpnJ5w4bjzjMvkvTQSCALbK2S2rkKFLZraowkMgapZK7Y0s6w8YELT9grFsX4NdjTvstdf4rJmf/hSHn1ABXaUcnAFdtRtoIfPdnMWx4RUpZ3QQ8SQekdPL83Wa3JlCpdAK3b0PficPrqJt42+d9aFMoNXzfG8aXT11zOlijYK7QWgpC0DSmioVez6qGF1miAkdm1eE8ZUD2AquOxDdyK7mNq9uixtO0c+bmLEAHaiN7Ar0/VlonXJGgAXXtzXLZcB8Ab9RdvYzz9NjGT9XD2DlDkUqWnNodVrMP5sEKwpzUUqTOMNjgxJcY+TN4opwyiRz1kv/2pwfGdsEbZIcYu/86gFcm2BwrYKiVjmuun0TO2lYZ+pdF3YTpyBPXe6ODcyI2qV5WLXszWABLJSCz4Q1tr0VJjSrhNAh3ce60K8ewBXUGO2vvTMrAxh2QQJm+cXQjSpPDLqSciKs1IZWWQwqS3y3oXyu5rEw4l5RMhcvcqEGLiHpR/fO6HgnjXpjxLfWwVe/K0Tz7cFLIL4HxSMTmCnQpJK4gkrf9kwHkHj23QaDKMLnc6nwHARQGTc8z5W/cgCvFaz1OTVdetasKDf+PizuwKGChU6T9aCFOCQap1+D4h7mc8HgfK4rB/D1H4KyMK2IDZXoAmmfbZq0BLWgWgfMbneFh9KVHjVvnv/7sDkw/cerpXmtm/Pta4mtpzHR2iTEF/TqvfPN699y/qsR49b/Yagxzzw/l3RcXRE/V84Tgk+QvGoAcwoHzbgINStjsaQcEKPrex9pYCSGrFA4hEjLqGiYZUpM3UjrmFo4OvL0bHx/5QAO00TV32lL54J9WIR/erqkQPktGc0dPh8R0iXLOyknP5QQcxMwCHVG+cMl+Op5siBkREf1wZKVhtpyNFs8yBU1RMwNvlbYg6oT8S3Z62TFoyESWc3gjNjXYnaf8mqqaJ20SPcoeu5JW2TmUS+D9nMzy4u+cUWMqknLGN1ipjuHlG6tBdqYSLG8iiqa4erEt6DKweQNvfdsAk4f+gXbV4KzN7x6OJBET9Y6wFjktchsK7GXYDZZrl2G1cYFvefo+jL+IliqnNkDZMTOEQR3Qa9FnD82Ed3Etkro1mRnBfpVVNGcfsXvOnTJJJKTNHhGjpIxGNL/NX9FmZ6ao1tG/CyzrMGRfk42RUWHlh4D8OdY2qN1nd9n2ci+R5mvFR44PhW3zePB05Vw+06z9bRHCZ+6M4xfWlOrG9eozCrbBcnugtBdMHRpDfb8Ou7JKAJHh15SDphNVOASLCcDLKJlJcKY2QGtDCEDAb7BlrKku52Nfz2i4yElRT4cuVKqOErWfI/1JKgyoGvAG84vrUiCFQqruWDhLusEl6GrF1HeULC58DRlS8I5uq3iK+eQ4FgzR1vtboaQIQDfJIA1bwLGykdZgaE5bk4COMlhchiUDlqD7nUHMAzhl9ZnhC45htTCiaB9gPSCtjreaGJq0G+lnGbm5TTLeAEuWLKunEmCZexRKZgpINsJ2HoDfAsBu761fPQBKwry5393PLoRwKVTzlY/m0fnusFsKL+0XmG/UHxc6tI5GhW9alpNg+Cy2XT6uTQrhV64V+0xPmB2VoLBRCMLaPn3Nl0ROc62EPz0A/g2Awyy9oWPaCX2C3By/tAfkwGm+Lq7IN1gF9eB/NL6vhPc2qv6pXu1pCpOPxexGSzIXUV/pZGmw/J1BDluXX3l5NiFjHbqwctddFPA0Jf2APhpBOwmCQ2wcs0zquaz/AS2SWh+/lgJdgmmkmQXXfzh0bkWejb055fWSLFjZbe5mrLHAeK6dBIMRRvBirW3LbqH7nBrPK+8WLTN+3Qji+NaZgCLji495++Dn2GAoUoMC/CK0L2Lier2yM8fNTj/h7LQHpjD6YYbTCgH8ku7JlOEa31oGIutoaT5Jidf3oRbsA0PS/Mnx4x1Pil6LNr2LRN9q57BaZGV4HVx652vop9DwJ7COb0eVKLbJp0ium8jrm9grkLX+aNMaAuYaR+H0DZIRI8OYTaUX7oByVDsHBo2lvrIoaWWcYVaUuDm/YKIrjmuIxXLtUx8c80sZ1DRbtu2IHN90aZgRBZhPgfg5zED/Zlsmrz4PqTi4L/Ao+v8Ufq5ou1vA60Fw+TCP028lf7iS/cn/fmlG9k1LDvHUF2H+hoCfBDPGq+TiTFunh7zJ7dB2994FNculucsh+MBtpbBYUbYWWylXtsG8PsQMCuON4jp9ZC4BGx/yruY/24L+racP0o/2/W9kd0GjOoYGYWfJfG9FtULD+WXbh6X9Q3Y3Ib6JqhjspIWsdQWDBsmDfV1qJ4B9TQxaB61acsuKsMpAC/xVo+oVGsRf1cuuMzz1QbwDyFgz6LE3IhZmhekDe+h1L6Mx4tbzx8uwRawxxLW12BzHS/+XBtlNM7sUH7p1TNw9jxsnjZqNhKILUyTZOls3gv1D+BXXCd0y2wvJDuY7iYMw89lJ3bJ6nO6vijO5SlTd8mPIWDvZmgllb8VCsv3scbwmz3OHy6+a1T/6+uwvomkwu8lzX+NUUaTShzKL/3wI3D2biIzK7r5ByF+g+/P/hroF6h8UXazZU2sv8tG9Tz+fPurW7VCd/1WyTdb8JMAfwWV7VNsjUme0xVWAP4pVmz2OX/oj7HieARnDah/FeAHqZC0ow58KL/0h/9HNwk8s64ryy75/NvfpX8Kovcnnn9BMiTZLAs2t1//Dao227h6JPe6pqLvNSOf3YSa7uafNzBT2mTGaygw093yU9mMTP7GlqBJlitKAC/Qzf9XaYJ4jW3ymH8H4GsAX+x9/sDRoPuWhJPmofnriNmz+OjkReB0/Z3zS3fKRkAXOOoJukkZvE6JypKGDQbRKkLX/DPpjEcVw4L+GRJmY3Sbf5bODfkfAPwrqNy87io6KJq/aOpx4T/qff7A8cYB3Gt0/r+FuuEpWuqKjFeYXkfwS8+eEitykY3RlXkUJaFh8LzCmxRdoULTFp4s7QqQ2BtXgsbQxWyDfxWgmaCfwnWOl09vWY1+duD5Q8ajj4L6KN7SbZLaZJ2LL75rfulzA7Sp+ErKRMfbDgKs4846dRz/iqu5rRybI+Zha2Gkren6tuCFvkvS5yV8Bczxa6PiwQ/mjwd/9AugvzCAL9qEBT875As+ORO0HGLJ5LgV3TwIqtJewk4bK4aurxkElqevnCq2JSp+6ZU13ZddsFuMrHHepu3x4CmZUz34oi8xcS8RYgku8VHm6CZtdXQLX6GoQ7WgRzfUkXqt26qlNeGdoNuTjLRz+s+NB0/PjtvKF325eT989RVb0PXC3UVfyH6VtZ99YRnUznLmPZQCMTzZVsGw4ujah0OPbh12bjx4JnS7+KIvP7VLpAZziq5gws3VHmdS8owctDvysis8abhiDxNOvuTi69HFN55rUii/Bk+MBrTGg+cYW/iiL2tojyvEtpUIPiyObjD1ZKz2GHehoHL9gC5BLq281k4nR3XAtSOBcwQPHl3t3ot0HzzCndgVD4Y5xTfnHHpSZLd5I8M/BUdXspWXRxpUi+kYoYvQyooKhWtiaPBLOWEsNTObPbrKLcaev0Go0Q2iu+LBc6AL3XzRT8bKi6Ba9cvQlfxzBq3ka3CskRy61MVBbkhw69CvI2LZ0fR/fUkxE3ShwwJs/+/YqqiueDDMrJwTvugnajRYCmtYeXSls7OECEIcFmNullpWLKRfaV4tNb7YUKl/TW8ITs15gnFx9c+BJOYzp5YZtBapcqR+zuPBs46cL3rmpXSKFDP8nOwKp6iLHFpuRdcRBZpAjD2Rg0AuhwCtFVOEsIZQzy9xagycFVEDKNLPKvBxen6PsQDzePCrO0TXJrI/MWJLskvQGnRpJRYeWuZKc28FqT3q9yORTkWuiabDHhat2r0R4NRvrelzVN2B+IH0s1t6ObkHPVWj2svyePC357dUE77oJ00zOwsZEbWyGx0Q7GfBnaaKsooeI5fKKUgkyLfQFrXTzFI5uZQ6ZtBRQXtLOlP4M/1pdhPlI0tjVDSPB39jJ1sRzhf9hMGL4EkjtQJlNwHYml1CRJ4Qh3RF6J4Ylh3b38J0L0HNXFQOWifE2i3Adtd7phyRVkFPgzuNE/N4T7WKMgCGA+zjwV/aCTWN54u+uzOM9JQ/lgZgURggc4AFs79EEudYu/2kfAAFUqiXGwLMeqAIYOmXW8+kVNNS7R8I5dbjiGuH+TIn8GS9hfHgz8/YbSYali/6jV06K8aPBtcFyAIKaQ4hGMAQAAaGdED5gflV8g0oH5oOCIuNaSZRIFQNkAWTWrf0QgCsMbDNA3Hm/kTWJOs6ll3vr4bgrx4O8BcBfnOH/qQ3sROEhidyHJsGpCWiW5A2DhMqulJ9cLwM4s/h4C4crmBZmdYlpTJt7iQ2u5MEp38Tqdm7sHyIz4Rij4IPOQBrY6nTexgO8JdncDVvGfd27Iycskda/HU4fg2by9TOlhE6jrF3K4qf+2X44+fhxjEclIbHqRDs+Yifkvz5+PSvw+//GJTHIEujP4At+Wn2SDaGA3wb4GfaC3IbqyErxzW6fND4jWHtgAdf3612teEVA3y1Ro117Rak6JpzCmbW28//13/a0jmwausfyHNy7D//9otw67GhuROM9NdKsEuBtW90S5Xvu5+Cf2+sH0mOX8eygtyOctxJ7ujz2gFP+gLp4QTmDIIQirE/s4j7+CbdbaCtqWDeror/vQC2xJJalrT0JhUREytPyxkQwP17RznuPKGk7nbAYy4t4ma9MlGwigUI2tDdgmjeetL/LyDDJ6osiTFu47m62A7gaTSApl+su8pxZ4gmbW0HPPILRPJeMWlmLvtCtSyrCcYq6w7ZKsSJrxO6oc0ZzS5cgrOC3O5y3Enujh7tgCeZW16GgIKpQrXlsKHSLnSnHLd1h0wbR0bi6/e4TDlLaD/E5aho5i9uNmfd5biTxLd3O+DBX8Cn2Iqv/V/WukkymwS17dZbD9XRHdh+6P0PQmcyqkF0o3t5EkwFuVvLcSeJb592wCMdjpqlNZGRVegWdIM5nT2Cuq3Ts9q6DPOlt3XdlW0Vvxe+BrOC3EO1vRx3PMA92gHjE7QaL8SCtCWQ6wAU09LWwRTrZb0VY54DGlS3sM3UWMhPB51c6LTmtLhkIwuigtzzynHHa4et7YBZKfRAgHkoTZL4Ciumit7QoiuYlpa6ZY9Ut0lwtCEWKbW8YHLslfMWPqTLkGDK1+lRjjsS4O52wEjBwVkThgclvCTZxdXti3QHuirY1bwyQbV1i43QFQFj7S1nJr4JiY9s6616GWswFeQuTvqU444BuKMdMJxJ2NoQeLiRpcKMO3RjH5boXoDzNs8cZosuF18d+zesD6ts41vKKTcuHGAsyO1XjjsyXJi1A4ZzGgIPdXQwjB26mqHLAjutKnpLl3YvuEpES7XXyZI8lJ4OvgvgS1qDsSD36dOe5bjjLs/bAcPG2+XtDYHHmNCSouUFoRs80kwn+z1SbmK2HyJWzp583GJMuBYdlNKigzHnYgF+CIvXdliOy9oBw9tH0K8h8DANJClaXqBVVXqMuU7WUQmXXbnbGkRSH1ARiy/Xz0hEyO3nUrcQXnWT1V0swLdeg49sBpXjDhvYDhi+uIDNu6FXQ+BRFpbLflIuNaJkISO3MCfnUypIa4t2g66IV1/PSu0xJuW80I6MK2EtPZcj5IIA/vjZbstx/9kBfPkQ0e3fEHgQwMrlUYSDhFXwgBLD1WtnnxAYDpGJr8eVKWcQTnyt7Hru0oSsbgsl0sUB/NmPw2c7CJ3FCpYKFjUeyiUtDB2/vAK1gs393nTUn4IuwujW+LRJaKqhrM29lRgALlQwqcIbCEX1fuusk87sDboIsEIJ9pazJv0MJL72j5tvXGrw7JZbmLVm5OgZBnBgB24jdC7xN5QqoHttWriwLx31kPi0rIzzfEFJM9ID7Kv2dJQ0w3W7r5Y9E+bYIMAeWiu4ytPvk+w6rtjaPP3+NhYdTHVtLBUXBfDNBOA4ZluogK59w+icx8QbhtFR945P6zUcbuAAAfYpUcC0cVRhHU+06xEpDYfXBgH2sqt5tx5wGAN3YFXBV7/MtgJdoE6nn+gLcET/3EboXHrljPr5xlgu0sF01APj0/Ix3KywgSDTxhxOYPo52V/dl3C3hIeFU861cHAqL6kQoct/0W1l6KZuM8NFdojpvJwivQCO6J/bJnShwrrbHDGd86RgVS866iHx6Zeeh+9jScES04yXmIVql2RZO7G2R0kbYmscNZ+8qODFsSWOf/cH4Z+j5ljaAyfKvjYXNzKNVQj2yVuwvbJE8Spql1JZMMVTxPlceVC5V150C/1zrA+babKCu8Sjjc55ZLhwAB11//i0DsXUvujDGtIusGOdGxm6cpZUXuraLijH3SGE+297A4lvq+QpXToNmfD06dbuhecA3En/zAidzZNYwwEebXTOIxfgAXTUg+LTMRNRcHGwSoKS0rIEQ3eGvhps6+VD/d63JXV4TTofqjjLJw0qQ7hsntW1DeBO+mc2oSWqnQbaw7qVznlktsgAOurh8Wnhqy59bqVySk8wOZYxurO08eSh/hD9VSSycfjBY1zFq3Uivq2Nz+S5EtxJ/xwTOhtoKziqttA5j4xGDqCjHhSf1qmWjgIACGpwKLLQXqnnQdepDb6agvve3H8ZAma8iIHuKlfOeffCdoDPoX+m+s5Gdo82cFxtoXMeCfAAOuqh8WlWlumr+QpS1Dm6BaErJ6MLtPTywJH9oiIGNel8yF0uqSrWLaCeI8Hb6aL9hDb7jWtruL7ZTuc8Jlw4jI56YHza11j6KKFXzrxYqCQb1QrW9DVYQ5xDqZ0TzT9AWzofturn3GYuzgW4D120J3S+voab63PpnAePwXTUQ+PTVFnrj0JFyrnUbq9i593qz+lrMLfjCsUQpfDDls6HPnDJ9XMivsW5a3BPumgrLkcn8MxZHzrnwWMwHfXQ+LQORlZBQcNCuR0wR9e/kSRPUyXY1yOBE1+rJ0qyD7o6H0LM3O91gMzyufKIsrvt/nTRDbryLXj+pCed8+Dx1lA66oHxabf6Eq6lCqAaZ5y1Y62rId6xTO5O5yx2+0VeUpcxup2NS3lGJoBsy+dqjSiXMJAu+uANePFefzrnwWMoHfXQ+LRnOSmUcw/5w0VqyaAtSJhmKSHR3lxHVbHArzvQvTofQrLu6vDwndu9sBxKF/3RR/BR1Z/Oecz42SH3Mzg+XTuMPbo2OnKgw4pYZKH46SraKg+rM5b4LUsddbfc0vmQ54UVMbo9uhdesfFv/DAcn8C1FRytjXOmOQ4QXQtt0vvMT59d235iwvf+4nvhqRO4vTKhjuvKHMdsP7m98+GXb5i7PcBbXdKTsejXvfDKdQAXNrRQOw/rEtFdorZcxCZ33iNr0veSKdc8Roc6xKr7dD70uX+5P+Tc7oVXDmBLRrSonECYuVZhivP2Z9xAnbgGW4CP8EsHdT70+rlk+Vw9uxdePYA3JlB4WBnlfNxMt45kKLdgxUwJ6AIjqkf4jdcpBNKz8yFQtt6CtaPu2b3wygFcYkbHcW1WwWs6+MyXsfu31fM3aaDT/poKAbf+nQ+BtnAjuhdeOYAPzuDGBp5SZpaPM9dbV3HfDBK8geu1C3cO7nyItoJX6YO6F145gJ8+g+e1888cdXi7WrcZU5t4n8F7NYzrfGjzucZ1L7xyAH9EG+f2DdLJcms3yRlTpV7YwF9rXkd1PryF+VzjuhdeuX3wJ38alAJVYw6zfVXGxFW4TLoMOnTrK5bdYD//ra8H7vl1SM+Nqhzse0Xdrioi0vrfPjD+nv/W3ZScq26rRa7bCtIlXMkhcN9idy+2ZMHGXD2oIbqv2OeEOE8azosNec+riv4542ilB8mZuezr1QPYMzEwXDU4MfVg6q3oqjZ2jjprmlMxKrxd4JrwOOkMXX0F1+CAnmYweyC5HCunqHX8ZOgOqc0pDmsmyjPd8jZoc+4mdTUB1qSBtQ64apo/3YGuaFPReSMzv+4mH8LOMN7O0nUlJTgRYhXBrBN0XfF2i7i0VoInLet8Yfi8q28rlrqNu6m8itBqEmJ6VXzpTdCFUJYC3QQdrJdZMKd9ZWk1H7S6gwUmp7u9uhJsKVGcFa1iXR2jK7h9pFIBquNyRt+NsPJ7JF9cOrdy9ozFdTcHm62bGg7wp1j1QZ8GvwPH51ja9SkrKnzIaoIfMk7DvzuQX9oDZre/Xny1iNFVTi2HqaWlubXIv8p+d8Vqw+sdKOc6s/KiQ4wzsspsu7C9wW85BmPdQSd8yghnLXKVDKq1J7/0QSi7Z0IswobYo6sZtOyPUs1cx+iuCVoHcHMxOZuR1cWql/Nz+SL0chi6i44tYWuDX3t+Nf7H+LL9VkrSBt0NA7gnv/SB18/4qqxy9u4qvuiqWHp1kOCKKS9X7e8fLELXYC8Dt9IsEqzaFoiEn0sz8R2iohcxs9m5DX4XY5nQWqpBI2itim6gdQAP5Je+xaA1SKvg5VDMB5I4tvIbS3qirj26Ahdg4TBWc6jo1oU/5+dybjUR2V9lX3QXWanClga/recPMShaC8D9Mtzguikcxv6v+vJLayfB3M4K6MY6OSEBh6wh6orEdyUcwDXenrWwFASCh4lDta2EYaVAka2Z4HqCnx4IJMkscF6D3/z8URK8ie0sX9u/LhzAFQI8mF/ao2tjDBxd1Q2tjh67dIFHOocVrhqJfla4Bk9U0Ro6KboUGeoqg9byc5Xno7uMA9PbG/zm54/6PZxO+AGr7W/QjQAWkfj24pe20CqGMaEOfg0GpqvjWU7MglNE14ivdKxKQTlLRnwnZpDgnH3NUcDYmAfnPmUYbwX4oC0FCLob/HadP/xpragA/D5xzjbHWQGrApUzotuIiDX6BvFLW3SVPbiiZhEknbH323c1lak6oiZhDguw4WRB8a2lU87WeHYiJWdDd834ucIqwHnXYganboB5QtiCpVf770wa/G4/f8iwaFl0bYnwm82clgbddeFWX68khvJLmxiwivSzD/3qbvH1P/qU2LseCngkiU9JGgm2squY+LoVUUacLONUmtcca8bPVRMRTGBOjNnXugHmFb4JpRO0Nfjdfv7wp/UM4XkLC/tfa+a0hLMG4NJMpVpE9aBD+aVNqL+G2osvl13d0lKPf2K/xfCxSXOc4rHBw2rLMOMiaEs1OaHL6yf7PFWcwSmBlpE4WYzbAM6Je3ltUN7gd/v5w5/WDWLzBjYxfLWZ0wWcLoz4VousHrQYzC+tK6gtwOSzTFDcUsjffMvrAl4v4K0STooUXUdiKOKFUMzQh9HzczXfuBbR1ymGZUS9Rj8kA/hGdyWozSBKGvyee/7AYdvsNuh+B+mEHyzhZGlkN60LprSzofzS1SPnKGZ9lOOOhkmTI/bPOwt46RC+t4BHhXl6jEklIzECJknchzxxNNribcbPpRKaU37jIv3GGOCnWGlt2ZF06xv83ut3/sCxRrS+hSXCbx/CoyWoY0I3htY+QEP5pW/eMkWIIsNUdKgT/vknvw0f25hfb/XXhvmwVt4IEiGC5MFojv/9fexSrFF46C6JwuAkQrIItDD8XO+rnNapUWk1D5bC0+w+IrxBg65iX1SGR9UWch+SlMgOjr3HKCBv9T5/6NOKtf2/30B1DU6voYY4aPsKOnbOL90d1fFbT9+fshLMHcHQjTxZ2cx4mCVTG8IjLSIBta+WW0/RpXy8WfPvQrBL56h6L6ZlHsTGUStIb6ISfF/v8weOLwP8Qwkv3wb1DEK1jPO7s28ZzC+tZ8gk3ZKN5cJHbJm0Xq12iEUs0xC3i5Xucx3/paa/d4uCpBPIdLfvNa5fpcHpNtZaL+NSXOhG69mB5w8Zf3gNXr4O6llEtzyfLHowv7SeKsQ8HBtFhb3bga2UFYly1/DKWbShm9ip3o8bYPahqjZ0cQ22HoE7o+LBm/njwf/dCagT2LzWly/6s3b70r9n9SfncfqrJDGW0K04ugiwlpkvOlNFgq4vO9DVjHpae1yZlg4eb4nO0XYja3r4KgkaTot9nssXfUkJP1EUNoGZb4grcHOde7ISLS24lk7QZcuTSqx0Wow1k2OOLsgpKTvnxoOnXfhcvmi4bIBrSs3xLugNR5cbWXkxDBNfmdjSHt225U9lRlY7usJpjnKeH5oHDadZqufyRV8WuoqlPVc+8QqFdcOgdehKaufAJFiIyHgWZBvLBF1amIXfXpN+tlaVs63I4x2hK0NUuJzh5+bx4DnmcQtf9CUOHSe1O1yZcrbeD5V4LmWbgpYBbynCPliIbNcEYRfk1LKVWm9YYehF0xNRiyDH5VTxzePBc0ziFr7oS0c3UljCOTc2ONfWbalkpKJ1Fg8OG19BGDN0tSAfIO31NQv0ggz+bReI9DALWvLpb7Wc2OI9jwfPtMh18UXDkwGw76mzFg7dynqJpTOerRDbUH+0BjNFHTa+khCVTlcLglYwAzuk40j33NQiFmJam/0CrKcmTSXx4JlGF180PBkAh0caFfKahxykE2U7+xbaEC6MPbgWRWHRpQ+LGFrBzDFN2t5iHNAlK1rH0E5Q0a3x4PkmsZUvel6cxLS1w6CLIruSLhhcURKgldqaTb0V4ghixNX806JLi7Hg0MZF6e5SkuBkrz6KFXbD9Ldjreg8HgwzA8z5ol+FJ2VoCjCsMC57JjEHQboUIgtqLZ1+9lMfZXSI4IA06Aq3DEsZDCshw66JW9FO21t7yuajka0eQStZS2oxusU7jwfPOhK+6G/DEzRqn4Iv4bTAFCLpkkxsClElCVcSL28WecSspHp07RtrcEX2M/unB1IVeGX7DJFAK7K5tO/MxeR+bAdwHw+ee3C+6G/AkzXs735cmGi/SzKx2bsEsGLzbtdLTWunEQmC1uIqpQPbQUtamru3vLtD0SpQWVVROMh90khwZLKsnVEA+3jw3Z1MoueL/tIcofJW5/7oyzbi+0jCgxIeLuBkYdIQGvENM840s3tl+xzz5DaIFgQtASwFrcoibIs5zFaCqxLq0ry6r5PR6qvj1mtBgseswWvclr6xKymxfNGfn4n2oGuXN26cCHj7wKQhPFyaLKJ1GdD1iGomtT7zTeOTa9AtoSgMtA2uToIhegURuandAlzCpvm6JWxKsxwovrqL4JeOsrHIXz0c4DcxV0rvCuAvAvzmDN6wnYzXn4VXbsDbS5PiuS5IJ3dMdFRVLAzXlVxCKc1RMMGVzH/Z5bGub8DpsflS8zzFmZQA7a0S9fho0r3dTv+Xd+xq1hNi1p//r+AvXjNZXWoFCt2VNsvaL3oaskQsevPRX4Q//QYsTwwVqm31wrtg8je58HzgP4Y/+QZUJ+ZLFUZ3tI7LL7r/djjA/3VWSpAU5D6mWpHHY/bH/z7Ap3d4+UkZCe/5bw0X4YbCCa4+RbhEGb8oAv1Ts6jO//UxTIOpDKdhI82ixkPRUVMnCc3e4I60EfF/8LlgPQzNI5PjBUFl5bEr5vfAWpFD2OnlYfwXTFvC+WqnfTCH9GRoRkroclgEO3y81WIpIHzu0Z24Gk4G2Kfc83odPI7Gdh/td3kY/QWT0opE1PzZO4w0eZKDhcXQ1SKgy1P3fOsyh6WK3num6Cn3PDmatIldWlSNezyhd2GPy8OkL5hFfNl92virz3f06EZWNLT9MWtGaptUu1ePN1+bLw5g7ndvY1e4Nnn+t14eZviCiRiL+CAgFfmtrOwKEQL1Eboq0tX+fSLBQWNfNMD59LN0qesQ+OoPYPbLwwxfMA1gzRgwfFmfM6UpH12x+E+Q4Exk+fvQUTHWzxPzVMvxCnTTwoTjO7uHfr1zXh5m+II5MFYQVY5oVnAGDGNBq7Ir+SG5DLaVplZ73niG9jX4wiW4igty7xvn5U3WGtSXBc13eZjtC6ZLMHNuRA5n76dkSOcSnHchB9oXha7GhPGFA+wrtHlB7j3XiuA6052j28u2XR5m+4KJ6DKt64vAeGqOS9CxMWDJorOaNZhUTnCjVqj8DXWSdRJ/0RJcU6nsfZdy8Uzcr3dKe9m2y8PMXzBZPysmxIoF9nOPtM9T938sVFh6XR/UBF0SXKFn2AcPnyHFCnIxlWZL8+ARFB3Z5WHmL5hJP3t0lWToymgT7BwNIuInBsUcWP7QAWmunKeXzI0C2Bfkftd0mXiWdCcvx406Z46/PMz/BRO9HBAiOS70y9BVtAxbH5bw5f0iamtrfZO+gbFHV7IWo+LSAF67glzxbdMrPO/XmzRKHHt5+LaAnXzBtJysCF3/WpC1JSNrS1AEPjAjKOeClhxjTTD7Ju6aNcPVk+55OMCPTEFu8SfwIZ326y1nqP+2l4c/aabsQ7CTL5i4APuShSSFg/QzMIx5LYKN0NgYg8SjUBHAVmrDK8P4YiX4G3D8B/CxOurXW7T13Bo3vgHwB8dQfwx29QVTAKZMWIcui/ZrL76Eq5JR5jr4qFHtGhi7NsbUV9j2BrZbYY/0JQD8wsvw4mP4MdSay5mLv814+QV4/CLs8AumSbBBtwiHwoMDDLEJDV5Lo/UoNyYebA7sXmz7AXuAA646all+oQDf+Qzc0fD5nQVsP3MH9B2oP9/78n9nWHx6Sk6WqVqwOZSYIWUBrpHbJciuDMlvkcqpDboW4LIy6BYkvgXE6CYAT8sjGwbwoYesdzz4bPRq1yMePOJ+pshDg+imhGppMqQUAqwLtwBDjC5QiVFAukF3ZVpjLivThrS0vd7BYOx7t6fdJfVUdIcBbP2D6YRujQcfTQZ4Szx43P1MGesFnB3B6sABrAtnW3FwNEtm9mF/M05Mvo5p5I19REtq0+5kt6MF4fQVqS/AUXTuCYgHj76fKTlZJ8/C42PYLI2itpjYtVZwIGNSnDDRLxuHzVHM/tPFSSRm2tf1Bbgl/Hqp8eAp9yORSERsjBErUOKt50Hi8+Fd/1LH6TVoBn/gPnyg9646aSv3uf8GvvUYRHOcGl3d3IZYQbHBjuRYMVGosH0CfDV74tpc5MX3mhsGXMIFu22bvJfctkbDzYcazwe4Jfx6qfHgqfeTJM0AhWa945cF4YGhK/VkkfJRIxXFkQyc1gojT7X1ewhE1/EzZLcN/W77HIBbwq+XGg+e5X5CvJ3NiIvi+Z1okvymJ5NF6eCt5B7pAjfHDYolkCzSq0G9Mqs1+ATb+LZF220nD+U2gDvDr5cUD57lfqrWDnFeDnyCY47u9FKLjt441pPV/ASLaBGjK1ozwXrfdifAneHXS4oHz3U/97kQKCdPPoQndUilkEjyL/kyPFFFq+COluTPsuJrXZUGUYjRtcYBxIKrQn5PftsBXTzaAT4n/Hrh8eAZ7+d+tmLxdPMkqTFCV88hwSrkuwOLN1g3daGDHJfafSJZ1YLgy0rHbScPZQsE54RfLzYe/Mbs9xPnqyaz5m1RG3XXmszp6Z2W/ZJJDhmLNLDAg7C4Vm49LikLAAbetmC3nQJ8fvj1AuPB30OS1JnvJ0mMUlk2RZbaKIElrE8UX0UKmTZFpQ88eHRRdi3GZsesWpKot9y2jm+75JZhr/DrRcWD7+zsfrxO9nmNwLMbedqb31NOdyrZ61DE0JYn2b14A62sCV3lQkzNbZSadlB02xHMSVImu+0WCW6u0jf8eiHx4G/u7n4YvyZPmpFsmpKct5DKOjUURZq5IiML3xR4WEVt3R1GcGsXhxB1RAsqzrttQKH3t11aN+SA8Ovu48F/AvDx3d1P7G3w/iA+TdxIcavaLEYWF18fNKwcwC6AqNx6XJA5XXTcdkjjim87SrltZuMFgEHh113HgwFld3f3I8jMCQAnCY5eAnCyirbcqDHbJOVcjC4k7F9rghk1c1G5dbfQTlG7zU9+23X7bUOc0lXewdXu8wMCwgPPHzg+z153cT+/oFhKFHkHQ+qMjnKjQM+W3egC/hVFhfFoLKwCo4dWfAsWJLZCbO9E+7WW3bZL9MluO8kauHodwGnT6fNmCusyZNPEJ8ib0NMBNqXfaxNmKNZQbvDA4P9CIdJWakl2bYTYauC130An6T4xupL265Ld9tUD2NuuceZb0Zo3o4PCn5g6Y56qRmpXiO4aFhs8UHwNwIoBjDdQKLL8NQKcJewJBjC/baCHw972lQOYGziFN1yZ0HhcvTREjHOjdXXzvWcgz2BxBssVLDG1Y1k78S1tCgDTzAV9tXVD5rctcR8ls9sGnvpzFQGmJbCZ1kVNtox2bn23iWSI+jV46mg082NYPIaDUzhcweHGoLtUBuAFyq5Fq8SvC32etIssCbZsl+TC9DfPbxv8zvBqrsFGhlZGeho5WOp4wUvyVW2XDD1T/vUJlPfh6CEcn8K1DRwqOMAbWKDIlpR65/a+EGGm15jPtTIqfVmTrJOUJ7cNcdrelQO4kaFGeg5xmhYQNGGRJTICSYP39E1ahd+Aa2/AUydwawPHCg61QdfegySRLSA27vydPMZ8Liv0KOX2bov4cQwPJbv/Kwfwcyeu3Zak3Cjozo3Ssbd1Sm7U4e/Cj2MU5FrcCDDFsi0zq2D5XGW8189vW8cPqLhqAH/iZ7AtjMCGKb6zAnWx8OXbWoYaUU+k8l/+tukIfSoM2+xKYl9oIiNdY1KtJ5zdoHxV9mqF8VF++z+ZcM//dPw9S7iSI/DfxA3RNWuiHQp8BWNJYoQNmqa4Rm++7fqtRczFXrjuGZd1z+WVBZjTqfD5Spot+5nyDeU85YorRCscxrp0HXR81WHzSWWxF5d2z1cR4IhROZuywK3BXjlbncoPW4WGWBqkkTLUo1uLqS3ep9xzeUX1cy4HcVei9JUq9pUXGiocrX0nFItxiUsvR1cayC/rnq+qimZEKpx2sHO+RFCS1q5xLc18rTA4dV1ZjD26RdxM8MLvubyC4qtjlqvQoN3TtOcz5duaUBNmD7O1rRQ15XCyW9KqPIcET7nnK6qiE9bQlC8HQi2oitfgwBxMRf6mjtRX+3v9LAjjgir/L+mehwP8d3bLFz308uNuJ8hBzg/L3nMrJuxGqE2h749k0a09utLZWRZjKLLehRPsrKH3PBDgQ/ZEDSvgHfzA9uWLPht2vmZt4rRIKXNa+i4IZrOQZrbQVl6IqTWHxjdWYzvWjsJhPIuKHnHPQwDmBbaDC3hHAnwOX/RRCvD550PbHPHWCwkbkmdUoSl2DWSlY3GoSkbqUIb12BtZdu80XXzH3XNvgHm95uAC3jEPbH++6EHncy3He5co4tlIqeoYoajGXqMWWtvCyB91GbF2WJiBCHimS/Doe+4HcF6QO7iAd8xP6s8XPeB80S4NmrGaAb06BiRmQludbP3PGy++CyfKCkkdKunWXU3tdqYStk245x4A5wW5gwt4p6K7nS960PlO1q2V5K3fgnUsi9mQvEDY97ZJ8AbJOuxhmlUtAidL4N0pHLuD9UhPl+Bx93wewHmB7eAC3pH6uSdf9Ijza7/JKUI3QL+f8ZPFOTd8b88NNitcl4avY4NHhYcigDUBDB5gOdUXPeWetwLcVZA7uIB38O8ZxBc96Hy1xn2ON30LJgp0hDmSUaPHRoAMutiEzPQhw8OJb2k2SM54xtXXSbBwGE8ZVjOPu+dugLsKbAcX8I6R4P580UPPVxtcQcuI64qTmQEjiuVdQzVO8dkCTg/g7BBWhwbjamkWYIVrcAOwuULpFl3vdoDJjg6rOcbdcwfA2wtyBxfwDhtD+aIHna8eONXaHNY40kWLHEDWtlsjjdLjI3h8zTSaawDeHED9/1N3NikNg0EYHksoogsRxHVx6QFc6cZreABv5xHceJHSrQtRaUGLjf2Sfvlpkybv/DSdWQhCeBkznWn8JjPPOBTnVZ6+8amKYmUudKQZPOL73BSB/QO28AAv+MeA+6LR69dp95PlX/7FWeQBbX2HUR3Anf1cnNHXJX1fhAAvT2k1LiszxdAWTzo0qu+7E5jE550Adw7YwgO8cIChfdHo9YurkIK/+Z3a2k0X/ychapxqovfbwKecn2eVOSnTqHhkpUYpsUl8Tqq/9BqwhQd4wU8ruC8avX4yDcN2PA7g/Rvd5e9GxfOskgU6KnmFxYFiFW338pw96LPYhZMPvs8xwP0HhD/RAV7M0H3Rh94vvYO2S9vRdrSFtqMB2IXJ5hiy/4AwPMCLGbovmrFfmh3ltoVGfdF2w7AL0QFhAgd4QUP3RR94v7QIbUeDsAvRAeFqA3Yx/L7ote+Y/w9KL1fw0Hbkgl0INGCPU16ptwOh7cgLuxBo2CoE2EZe4dUZGG3njF3Y3YCV3kQzeZljbLQdeWEX9mrA6pRBM3mpYxy0nSd2YUcDVj+6qvI69ZmDtvPBLuxowOrcRDN58SkH1UILoO3IC7twXwNWLVEs5WWlJbKxGGg7J+zC1gasZhk0k993its/wEy0nQ92YXMDVtOM5QWfDAnazg27sKEBq2nG8tLUl6DtfLALdxqw+gG2lJf5JkHbeWEXVhqwJjfRWF60LEeEtnPBLgy2acBqrNcdQF4ku5Sg7Y6fXbix0IAlhWmbYeRFJkHbHTu7sLSp7Vmwsbxo19Xsif5mgU2XZq/d5AcXaVrHkrUUiuSGrqdcduEjnbwyff4XYACMH+CC6Spl3gAAAABJRU5ErkJggg=="}},{key:"getSearchTexture",value:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAIAAADiVupLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFZJREFUeNrs00EKgAAIRNEZ739mTQoiwmhRi4L/FiKiu9ERISkzbXdTVV3H4WhfOG6ehl1rNR7qDSF8hwkVcJXt+3A//I0Nv0GoCBUAAAAAAMA/LAIMAB+Dcg2OE2zsAAAAAElFTkSuQmCC"}}]),i}(nr),mh=function(r){function i(t){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t))}return W(i,r),z(i,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new J(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.sampleBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexBuffer.updateData(new Float32Array(this.vertex)),this.sampleBuffer.updateData(new Float32Array(this.sampleCoord)),this.vertexArray=new ot({gl:t,program:this.programSample,attributes:[{stride:12,name:"aPos",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:0},{stride:8,name:"aTextureCoord",buffer:this.sampleBuffer,size:2,type:"FLOAT",offset:0}]})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture,e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var a=this.getProgram(e);a.use(e),this.vertexArray.bind(),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(a.uniforms.uSampler,1),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),i}(nr),xh=function(r){function i(t){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t))}return W(i,r),z(i,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new J(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-(1.0-threshold)/5.0));float brightness=dot(color.rgb,vec3(0.2126,0.7152,0.0722));if(brightness>threshold){color=lightColor;}else{color=vec4(0.0);}gl_FragColor=color;}"})),this.programBloom||(this.programBloom=new J(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new J(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord);vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new Mt(t),this.bloomBuffer=new Mt(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Mt(t)),this.bloomBuffer||(this.bloomBuffer=new Mt(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,a=t.texture;t=t.fbo;var n=this.getOptions();e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var s=this.getProgram(e),o=s.programBright,u=s.programBloom;s=s.programResult;var f=this.getExtraFbo(e),v=f.collectBrightBuffer;f=f.bloomBuffer;var l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(u.attributes.aPos),e.vertexAttribPointer(u.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aPos),e.vertexAttribPointer(s.attributes.aPos,3,e.FLOAT,!1,0,0),l=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(u.attributes.aTextureCoord),e.vertexAttribPointer(u.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s.attributes.aTextureCoord),e.vertexAttribPointer(s.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,v),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,a),e.uniform1i(o.uniforms.uSampler,1),e.uniform1f(o.uniforms.threshold,n.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(u.program),e.bindFramebuffer(e.FRAMEBUFFER,f),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,v.texture),e.uniform1i(u.uniforms.uSampler,1),e.uniform1i(u.uniforms.isVertical,!0),e.uniform1f(u.uniforms.blurSize,n.blurSize||2),e.uniform1f(u.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(u.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(u.program),e.bindFramebuffer(e.FRAMEBUFFER,v),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,f.texture),e.uniform1i(u.uniforms.uSampler,1),e.uniform1i(u.uniforms.isVertical,!1),e.uniform1f(u.uniforms.blurSize,n.blurSize||2),e.uniform1f(u.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(u.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(s.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,a),e.uniform1i(s.uniforms.originalTexture,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,v.texture),e.uniform1i(s.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),i}(nr),yh=function(r){function i(t){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t))}return W(i,r),z(i,[{key:"getProgram",value:function(t){return this.programBright||(this.programBright=new J(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-threshold));gl_FragColor=lightColor;}"})),this.programBloom||(this.programBloom=new J(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;uniform float devicePixelRatio;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y)*devicePixelRatio;vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"})),this.programResult||(this.programResult=new J(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;uniform float toneScale;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord)*toneScale;vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"})),{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"onResize",value:function(t){this.collectBrightBuffer=new Mt(t),this.bloomBuffer=new Mt(t)}},{key:"getExtraFbo",value:function(t){return this.collectBrightBuffer||(this.collectBrightBuffer=new Mt(t)),this.bloomBuffer||(this.bloomBuffer=new Mt(t)),{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(t){var e=t.gl,a=t.texture;t=t.fbo;var n=this.getOptions(),s="clarity"in n?n.clarity:1;s=Math.max(0,s),s=Math.min(1,s),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var o=this.getProgram(e),u=o.programBright,f=o.programBloom;o=o.programResult;var v=this.getExtraFbo(e),l=v.collectBrightBuffer;v=v.bloomBuffer;var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(u.attributes.aPos),e.vertexAttribPointer(u.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(f.attributes.aPos),e.vertexAttribPointer(f.attributes.aPos,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aPos),e.vertexAttribPointer(o.attributes.aPos,3,e.FLOAT,!1,0,0),h=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(u.attributes.aTextureCoord),e.vertexAttribPointer(u.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(f.attributes.aTextureCoord),e.vertexAttribPointer(f.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o.attributes.aTextureCoord),e.vertexAttribPointer(o.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.useProgram(u.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,a),e.uniform1i(u.uniforms.uSampler,1),e.uniform1f(u.uniforms.threshold,n.threshold||0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(f.program),e.bindFramebuffer(e.FRAMEBUFFER,v),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(f.uniforms.uSampler,1),e.uniform1i(f.uniforms.isVertical,!0),e.uniform1f(f.uniforms.blurSize,n.blurSize||2),e.uniform1f(f.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(f.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(f.program),e.bindFramebuffer(e.FRAMEBUFFER,l),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,v.texture),e.uniform1i(f.uniforms.uSampler,1),e.uniform1i(f.uniforms.isVertical,!1),e.uniform1f(f.uniforms.blurSize,n.blurSize||2),e.uniform1f(f.uniforms.devicePixelRatio,window.devicePixelRatio),e.uniform2fv(f.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.useProgram(o.program),e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,a),e.uniform1i(o.uniforms.originalTexture,1),e.uniform1f(o.uniforms.toneScale,s),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,l.texture),e.uniform1i(o.uniforms.bloomTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3),e.bindBuffer(e.ARRAY_BUFFER,null),e.useProgram(null)}}]),i}(nr),_h=function(r){function i(t){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t))}return W(i,r),z(i,[{key:"getProgram",value:function(t){return this.programSample||(this.programSample=new J(t,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"})),this.programSample}},{key:"render",value:function(t){var e=t.gl;t=t.texture;var a=this.getProgram(e);e.useProgram(a.program);var n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertex),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),n=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sampleCoord),e.STATIC_DRAW),e.enableVertexAttribArray(a.attributes.aTextureCoord),e.vertexAttribPointer(a.attributes.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(a.uniforms.uSampler,1),e.uniform2fv(a.uniforms.canvasSize,[e.canvas.width,e.canvas.height]),e.drawArrays(e.TRIANGLES,0,this.vertex.length/3)}}]),i}(nr),as=function(){function r(i){O(this,r),this.gl=i,this.effects=[],this.initFbo()}return z(r,[{key:"addEffect",value:function(i){this.effects.push(i)}},{key:"removeEffect",value:function(i){}},{key:"setEffects",value:function(i){this.effects=i}},{key:"onResize",value:function(){this.initFbo();var i=this.gl,t=this.effects;if(t&&1<t.length)for(var e=1;e<t.length;e++){var a=t[e];a.onResize&&a.onResize(i)}}},{key:"initFbo",value:function(){var i=this.gl;i&&(this.fbo=[new Mt(i),new Mt(i)])}},{key:"destroy",value:function(){this.effects=[],this.fbo=[],this.gl=null}},{key:"render",value:function(){var i=this.gl,t=this.effects;if(t&&0<t.length)for(var e={},a=0;a<t.length;a++){var n=this.fbo[a%2].framebuffer;a===t.length-1&&(n=null),i.bindFramebuffer(i.FRAMEBUFFER,n);var s=[0,0,0,0];i.clearColor(s[0],s[1],s[2],s[3]),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),t[a].render({isPickRender:!1,gl:i,texture:e.texture,fbo:n}),e=n}}}]),r}(),Yr=function(){function r(i,t){O(this,r),this.map=i,this.options=t||{},this.eventMap={}}return z(r,[{key:"onResize",value:function(i){}},{key:"onUpdate",value:function(i){throw"\u672A\u5B9E\u73B0onUpdate\u65B9\u6CD5"}},{key:"getContainer",value:function(){throw"\u672A\u5B9E\u73B0getContainer\u65B9\u6CD5"}},{key:"getSize",value:function(){throw"\u672A\u5B9E\u73B0getSize\u65B9\u6CD5"}},{key:"getTilt",value:function(){throw"\u672A\u5B9E\u73B0getTilt\u65B9\u6CD5"}},{key:"getHeading",value:function(){throw"\u672A\u5B9E\u73B0getHeading\u65B9\u6CD5"}},{key:"getZoomUnits",value:function(){throw"\u672A\u5B9E\u73B0getZoomUnits\u65B9\u6CD5"}},{key:"getCenter",value:function(){throw"\u672A\u5B9E\u73B0getCenter\u65B9\u6CD5"}},{key:"getMapType",value:function(){throw"\u672A\u5B9E\u73B0getMapType\u65B9\u6CD5"}},{key:"lnglatToMercator",value:function(i,t){return this.options.coordinateSystem==="gcj02"?(t=t*Math.PI/180,t=31890685e-1*Math.log((1+Math.sin(t))/(1-Math.sin(t))),[parseFloat((i*Math.PI/180*6378137).toFixed(2)),parseFloat(t.toFixed(2))]):(i=Lt.convertLL2MC({lng:i,lat:t}),[i.lng,i.lat])}}]),r}(),Ah=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.eventMap={},t}return W(i,r),z(i,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onMousemove",value:function(t){t=this.extendCallback(t),this.map.addEventListener("mousemove",t),this.eventMap.mousemove=t}},{key:"onClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("click",t),this.eventMap.click=t}},{key:"onDblClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("dblclick",t),this.eventMap.dblclick=t}},{key:"onRightClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("rightclick",t),this.eventMap.rightclick=t}},{key:"onUpdate",value:function(t){this.map.addEventListener("update",t),this.map.addEventListener("onearthstatuschange",t),this.eventMap.update=t,this.eventMap.onearthstatuschange=t}},{key:"extendCallback",value:function(t){return function(e){t(G(e,{x:e.x,y:e.y}))}}},{key:"unbind",value:function(t){var e=this;this.eventMap[t]?(this.map.removeEventListener(t,this.eventMap[t]),delete this.eventMap[t]):(_t(this.eventMap).forEach(function(a){e.map.removeEventListener(a,e.eventMap[a])}),this.eventMap={})}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getBounds",value:function(){return this.map.getBounds()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},{key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var t=this.map.getCenter();return-180<=t.lng&&180>=t.lng&&(t=this.map.lnglatToMercator(t.lng,t.lat),t={lng:t[0],lat:t[1]}),t}},{key:"getMapType",value:function(){return this.map.getMapType()}},{key:"lnglatToMercator",value:function(t,e){return this.map.lnglatToMercator(t,e)}},{key:"mercatorToLnglat",value:function(t,e){return this.map.mercatorToLnglat(t,e)}},{key:"pixelToPointIn",value:function(t){return t=this.map.pixelToPointIn(t),this.mercatorToLnglat(t.lng,t.lat)}}]),i}(Yr),Th=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.div=document.createElement("div"),t.div.style.position="absolute",t.div.style.userSelect="none",t.map.getPanes().mapPane.appendChild(t.div),t.eventMap={},t}return W(i,r),z(i,[{key:"onResize",value:function(t){this.map.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onMousemove",value:function(t){t=this.extendCallback(t),this.map.addEventListener("mousemove",t),this.eventMap.mousemove=t}},{key:"onClick",value:function(t){t=this.extendCallback(t),ma?(this.map.addEventListener("touchend",t),this.eventMap.touchend=t):(this.map.addEventListener("click",t),this.eventMap.click=t)}},{key:"onDblClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("dblclick",t),this.eventMap.dblclick=t}},{key:"onRightClick",value:function(t){t=this.extendCallback(t),this.map.addEventListener("rightclick",t),this.eventMap.rightclick=t}},{key:"changeCanvas",value:function(){var t=this.map,e=t.getSize(),a=t.getCenter();t=t.pointToOverlayPixel(a),this.div.style.left=t.x-e.width/2+"px",this.div.style.top=t.y-e.height/2+"px"}},{key:"onUpdate",value:function(t){var e=this,a=function(){e.changeCanvas(),t()};this.map.addEventListener("moveend",a),this.map.addEventListener("moving",a),this.map.addEventListener("zoomend",a),this.eventMap.moveend=a,this.eventMap.moving=a,this.eventMap.zoomend=a}},{key:"extendCallback",value:function(t){return function(e){t(G(e,{x:e.pixel.x,y:e.pixel.y}))}}},{key:"unbind",value:function(){var t=this;_t(this.eventMap).forEach(function(e){t.map.removeEventListener(e,t.eventMap[e])}),this.eventMap={}}},{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getBounds",value:function(){return this.map.getBounds()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",value:function(){return 0}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getZoomUnits",value:function(){var t=this.getZoom();return this.map.getMapType().getZoomUnits?this.map.getMapType().getZoomUnits(t):Math.pow(2,18-t)}},{key:"getCenter",value:function(){var t=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:t.x,lat:t.y}}},{key:"lnglatToMercator",value:function(t,e){return t=this.map.getMapType().getProjection().lngLatToPoint({lng:t,lat:e}),[t.x,t.y]}},{key:"mercatorToLnglat",value:function(t,e){return t=this.map.getMapType().getProjection().pointToLngLat({lng:t,lat:e}),[t.lng,t.lat]}}]),i}(Yr),wh=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.eventMap={},t}return W(i,r),z(i,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;_t(this.eventMap).forEach(function(e){window.removeEventListener(e,t.eventMap[e])}),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},{key:"getSize",value:function(){var t=this.map;return{width:t.canvas.clientWidth,height:t.canvas.clientHeight}}},{key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/Math.PI}},{key:"getZoomUnits",value:function(){var t=this.map;return 6.8*t.scene.globe.ellipsoid.cartesianToCartographic(t.camera.position).height/6500}},{key:"getZoom",value:function(){return 10}},{key:"getCenter",value:function(){var t=this.map;return t=t.camera.pickEllipsoid(new Cesium.Cartesian2(t.canvas.clientWidth/2,t.canvas.clientHeight/2)),t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),t=this.getMercator([180*t.longitude/Math.PI,180*t.latitude/Math.PI]),{lng:t[0],lat:t[1]}}},{key:"getMercator",value:function(t){var e=[];return e[0]=t[0]*Math.PI/180*6378137,t=t[1]*Math.PI/180,e[1]=31890685e-1*Math.log((1+Math.sin(t))/(1-Math.sin(t))),e}}]),i}(Yr),Mh=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.eventMap={},t}return W(i,r),z(i,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;_t(this.eventMap).forEach(function(e){window.removeEventListener(e,t.eventMap[e])}),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getZoom",value:function(){return this.map.zoom}},{key:"getCenter",value:function(){return this.map.center}}]),i}(Yr),Eh=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.eventMap={},t}return W(i,r),z(i,[{key:"onResize",value:function(t){window.addEventListener("resize",t),this.eventMap.resize=t}},{key:"onUpdate",value:function(t){}},{key:"unbind",value:function(){var t=this;_t(this.eventMap).forEach(function(e){window.removeEventListener(e,t.eventMap[e])}),this.eventMap={}}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]),i}(Yr),ss=function(){function r(i,t){var e=this;O(this,r),t=t||{},t.mapType==="bmap"?this.map=new Th(i,t):t.mapType==="blank"?this.map=new Mh(i,t):t.mapType==="cesium"?this.map=new wh(i,t):t.mapType==="three"?this.map=new Eh(i,t):(t.mapType="bmapgl",this.map=new Ah(i,t)),this.map.type=t.mapType,this._dpr=window.devicePixelRatio,t.mapType==="bmapgl"&&(this._dpr=this.map.map.config.ratio),this.options=t||{},this.renderArr=[],(i=t.canvas)||(i=document.createElement("canvas")),this.canvas=i,this.gl=t.gl?t.gl:xo(i,t),["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"].forEach(function(a){e.gl.getExtension(a)}),this.changeSize(),this.projectionMatrix=b.create(Float64Array),this.orthoMatrix=b.create(Float64Array),this.matrix=b.create(Float64Array),this.viewMatrix=b.create(Float64Array),this.pointToPixelMatrix=b.create(Float64Array),this.pixelToViewMatrix=b.create(Float64Array),this.fovy=35,this.fps=Math.min(t.fps,60)||60,this.renderTime=new Date().valueOf(),this._animation=this.animation.bind(this),this._update=this.update.bind(this),this.onInitialize(this.options.onInitialize),this.options.onRender&&this.renderArr.push(this.options.onRender),this.stateManager=new os({gl:this.gl}),this.pickFBO=new Mt(this.gl),this.transferOptions={},this.bind()}return z(r,[{key:"bind",value:function(){var i=this,t=this.map;t.onResize(function(){i.changeSize(),i.render()}),t.onUpdate(this._update),t.onClick&&t.onClick(function(e){i.onClick&&i.onClick(e)}),t.onDblClick&&t.onDblClick(function(e){i.onDblClick&&i.onDblClick(e)}),t.onRightClick&&t.onRightClick(function(e){i.onRightClick&&i.onRightClick(e)}),t.onMousemove&&t.onMousemove(function(e){i.onMousemove&&i.onMousemove(e)}),this.options.canvas||t.getContainer().appendChild(this.canvas)}},{key:"unbind",value:function(){var i=this.map;i.unbind&&i.unbind()}},{key:"setOptions",value:function(i){this.options=i}},{key:"onInitialize",value:function(i){i&&(this.transferOptions=i.bind(this)(this.gl)||{})}},{key:"bindFramebuffer",value:function(i){var t=this.gl;i?t.bindFramebuffer(t.FRAMEBUFFER,i.framebuffer):t.bindFramebuffer(t.FRAMEBUFFER,null)}},{key:"saveFramebuffer",value:function(){var i=this.gl;this.preFramebuffer=i.getParameter(i.FRAMEBUFFER_BINDING)}},{key:"restoreFramebuffer",value:function(){var i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,this.preFramebuffer)}},{key:"onRender",value:function(i){this.renderArr.push(i)}},{key:"changeSize",value:function(){var i=this.canvas,t=this.options;if(i){var e=i.style,a=this.map.getSize(),n=this._dpr;i.width=a.width*n,i.height=a.height*n,e.cssText="position: absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px;z-index:2;",t.mapType!=="cesium"||t.canvas||(e.pointerEvents="none"),this.gl.viewport(0,0,i.width,i.height)}}},{key:"update",value:function(){this.options.autoUpdate===!1||this.isAnimation&&60<=this.fps||this.render()}},{key:"pixelToPointIn",value:function(i){return this.map.pixelToPointIn(i)}},{key:"render",value:function(){if(this.map&&this.gl){var i=this.options,t=this.projectionMatrix,e=this.viewMatrix;if(i.mapType==="three")e=this.map.map.camera,t=e.projectionMatrix.elements,e=e.matrixWorldInverse.elements;else if(i.mapType==="cesium"){e=this.map.map;var a=e.camera.frustum.projectionMatrix;t=new Float32Array([a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]),a=e.camera.viewMatrix,e=new Float32Array([a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]])}else this.map.map.mapType==="B_EARTH_MAP"?(t=this.map.map.getEarth().scene._camera.getProjectionMatrix(),e=this.map.map.getEarth().scene._camera.getModelViewMatrix()):(this.updateProjectionMatrix(),this.updateModelViewMatrix());for(a=b.multiply(this.matrix,t,e),G(this.transferOptions,{gl:this.gl,matrix:a,pointToPixelMatrix:this.pointToPixelMatrix,pixelToViewMatrix:this.pixelToViewMatrix,projectionMatrix:t,orthoMatrix:this.orthoMatrix,viewMatrix:e,stateManager:this.stateManager}),i.mapType!=="three"&&i.mapType!=="cesium"&&i.autoUpdate!==!1&&this.clear(),i=0;i<this.renderArr.length;i++)this.renderArr[i]&&this.renderArr[i].bind(this)(this.transferOptions)}}},{key:"clear",value:function(i){var t=this.gl,e=this.options.clearColor||[0,0,0,0];t.clearColor(e[0],e[1],e[2],e[3]),i&&(i instanceof Array||(i=pt(i).unitArray()),t.clearColor(i[0],i[1],i[2],i[3])),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var i=this.gl.canvas.width/this.gl.canvas.height,t=this.options.cameraNear||1,e=this.options.cameraFar||4e3;b.perspective(this.projectionMatrix,Et(this.fovy),i,t,e),i=this.map.getSize(),b.ortho(this.orthoMatrix,-i.width/2,i.width/2,-i.height/2,i.height/2,t,e)}},{key:"updateModelViewMatrix",value:function(){var i=this.map,t=this.viewMatrix,e=this.pointToPixelMatrix,a=this.pixelToViewMatrix;b.identity(t),b.identity(e),b.identity(a);var n=i.getSize();n=Math.round(-n.height/(2*Math.tan(Et(this.fovy)/2))),b.translate(a,a,[0,0,n]),b.rotate(a,a,Et(i.getTilt()),[-1,0,0]),b.rotate(a,a,Et(i.getHeading()),[0,0,-1]),n=i.getCenter();var s=this.options.pointOffset||[0,0];i=i.getZoomUnits(),b.translate(e,e,[(s[0]-n.lng)/i,(s[1]-n.lat)/i,0]),i=1/i,b.scale(e,e,[i,i,i]),b.multiply(t,a,e)}},{key:"destroy",value:function(){this.stopAnimation(),this.unbind();var i=this.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this.map.getContainer().removeChild(this.canvas),this.gl=this.canvas=null}},{key:"animation",value:function(){if(this.isAnimation){if(60<=this.fps)this.render();else{var i=new Date().valueOf(),t=Math.floor(1e3/this.fps),e=i-this.renderTime;e>t&&(this.render(),this.renderTime=i-e%t)}window.requestAnimationFrame(this._animation)}}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",value:function(){this.isAnimation=!1}}]),r}(),Ch=function(){function r(i){O(this,r),this.layers=[],this.options=i,this.webglLayer=i.webglLayer}return z(r,[{key:"addLayer",value:function(i){for(var t=!1,e=0;e<this.layers.length;e++)if(this.layers[e]===i){t=!0;break}t||(i.map=this.webglLayer.map,i.layerType==="threeLayer"?(i.setWebglLayer(this.webglLayer),t=i.getThreeLayer(),this.addLayer(t),i.initialize&&i.initialize(t)):(i.setWebglLayer(this.webglLayer),i.commonInitialize&&i.commonInitialize(this.webglLayer.gl),i.initialize&&i.initialize(this.webglLayer.gl),i.onOptionsChanged(i.getOptions(),{}),i.onDataChanged(i.getData()),i.onChanged(i.getOptions(),i.getData())),this.putInLayer(i)),this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"putInLayer",value:function(i){i.options.renderOrder===void 0&&(i.options.renderOrder=this.layers.length),this.layers.push(i),this.layers=this.layers.sort(function(t,e){return t.options.renderOrder-e.options.renderOrder})}},{key:"removeLayer",value:function(i){for(var t=0;t<this.layers.length;t++)this.layers[t]===i&&this.layers.splice(t,1);this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"showLayer",value:function(i){for(var t=0;t<this.layers.length;t++)this.layers[t]===i&&i.show();this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"hideLayer",value:function(i){for(var t=0;t<this.layers.length;t++)this.layers[t]===i&&i.hide();this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation()),this.webglLayer.render()}},{key:"removeAllLayers",value:function(){this.layers=[],this.webglLayer.stopAnimation(),this.webglLayer.render()}},{key:"destroyAllLayers",value:function(){for(var i=0;i<this.layers.length;i++){var t=this.layers[i];t.destroy&&t.destroy()}}},{key:"getAllLayers",value:function(){return this.layers}},{key:"getAllThreeLayers",value:function(){for(var i=[],t=0;t<this.layers.length;t++){var e=this.layers[t];e.layerType==="ThreeLayer"&&i.push(e)}return i}},{key:"isRequestAnimation",value:function(){for(var i=!1,t=0;t<this.layers.length;t++)if(this.layers[t].isRequestAnimation()){i=!0;break}return i}},{key:"beforeRender",value:function(i){i.gl&&this.webglLayer.stateManager.setDefaultState()}},{key:"afterRender",value:function(i){(i=i.gl)&&(i.bindBuffer(i.ARRAY_BUFFER,null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),i.useProgram(null))}},{key:"renderGLLayers",value:function(i){this.webglLayer.stateManager.save();for(var t=0;t<this.layers.length;t++){var e=this.layers[t];if(e._visible===!0&&e.layerType!=="threeLayer"&&e.layerType!=="ThreeLayer"){var a=e.map.getZoom(),n=e.getOptions().zoomThreshold;n&&(a<n[0]||a>=n[1])||(this.beforeRender(i),e.render(i),this.afterRender(i))}}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayer",value:function(i){this.webglLayer.stateManager.save(),this.webglLayer.stateManager.setState({blendFunc:[i.gl.SRC_ALPHA,i.gl.ONE],depthMask:!1,depthTest:!0,depthFunc:i.gl.LESS,cullFace:!1});for(var t=0;t<this.layers.length;t++){var e=this.layers[t];if(e._visible===!0&&e.layerType==="ThreeLayer"){var a=e.map.getZoom(),n=e.getOptions().zoomThreshold;n&&(a<n[0]||a>=n[1])||e.render(i)}}this.webglLayer.stateManager.restore()}},{key:"renderThreeLayers",value:function(i){this.webglLayer.stateManager.save(),this.webglLayer.stateManager.setState({blendFunc:[i.gl.SRC_ALPHA,i.gl.ONE],depthMask:!1,depthTest:!0,depthFunc:i.gl.LESS,cullFace:!1});for(var t=0;t<this.layers.length;t++){var e=this.layers[t];if(e._visible===!0&&e.layerType==="threeLayer"){var a=e.map.getZoom(),n=e.getOptions().zoomThreshold;n&&(a<n[0]||a>=n[1])||e.render(i)}}this.webglLayer.stateManager.restore()}},{key:"onClick",value:function(i){for(var t=0;t<this.layers.length;t++){var e=this.layers[t];if(e._visible===!0&&e.layerType!=="threeLayer"&&e.layerType!=="ThreeLayer"){var a=e.map.getZoom(),n=e.getOptions().zoomThreshold;n&&(a<=n[0]||a>=n[1])||!e.options.enablePicked||!e.options.onClick||!e.pick||(a=e.pick(i.x,i.y,"onClick"),e.options.onClick(a,i),e.options.autoSelect&&this.webglLayer.render())}}}},{key:"onDblClick",value:function(i){for(var t=0;t<this.layers.length;t++){var e=this.layers[t];if(e._visible===!0&&e.layerType!=="threeLayer"&&e.layerType!=="ThreeLayer"){var a=e.map.getZoom(),n=e.getOptions().zoomThreshold;n&&(a<=n[0]||a>=n[1])||!e.options.enablePicked||!e.options.onDblClick||!e.pick||(a=e.pick(i.x,i.y,"onDblClick"),e.options.onDblClick(a,i),e.options.autoSelect&&this.webglLayer.render())}}}},{key:"onRightClick",value:function(i){for(var t=0;t<this.layers.length;t++){var e=this.layers[t];if(e._visible===!0&&e.layerType!=="threeLayer"&&e.layerType!=="ThreeLayer"){var a=e.map.getZoom(),n=e.getOptions().zoomThreshold;n&&(a<=n[0]||a>=n[1])||!e.options.enablePicked||!e.options.onRightClick||!e.pick||(a=e.pick(i.x,i.y,"onRightClick"),e.options.onRightClick(a,i),e.options.autoSelect&&this.webglLayer.render())}}}},{key:"onMousemove",value:function(i){for(var t=!1,e=0;e<this.layers.length;e++){var a=this.layers[e];if(a._visible===!0&&a.layerType!=="threeLayer"&&a.layerType!=="ThreeLayer"){var n=a.map.getZoom(),s=a.getOptions().zoomThreshold;(!s||!(n<=s[0]||n>=s[1]))&&a.options.enablePicked&&a.pick&&(a.options.onMousemove||a.options.autoSelect)&&(n=a.pick(i.x,i.y,"onMousemove"),this.webglLayer.map.map.platform.style.cursor=n.dataIndex===-1?"default":"pointer",a.options.onMousemove&&a.options.onMousemove(n,i),a.options.autoSelect&&(t=!0))}}t&&(this.webglLayer.isAnimation||this.webglLayer.render())}},{key:"destroy",value:function(){this.destroyAllLayers(),this.removeAllLayers()}}]),r}(),Zn=function(){function r(i){var t=this;O(this,r),this.options={autoUpdate:!0},this._visible=!0,G(this.options,i);var e=i.pointOffset;this.webglLayer=i.webglLayer||new ss(i.map,this.options),this.layerManager=new Ch({autoUpdate:this.options.autoUpdate,webglLayer:this.webglLayer}),this.effectManager=new as(this.webglLayer.gl),this.webglRender={render:function(){}},this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects)),this.webglLayer.onRender(function(a){t._render(a)}),this.webglLayer.onClick=function(a){t._visible&&t.layerManager.onClick(a)},this.webglLayer.onDblClick=function(a){t._visible&&t.layerManager.onDblClick(a)},this.webglLayer.onRightClick=function(a){t._visible&&t.layerManager.onRightClick(a)},this.webglLayer.onMousemove=function(a){t._visible&&t.layerManager.onMousemove(a)},e||this.webglLayer.options.mapType==="cesium"||(e=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[e.lng,e.lat]),this.webglLayer.map.onResize(function(){t.effectManager.onResize()}),(this.postProcessing=i.postProcessing)&&(this.postProcessing.setWebglLayer(this.webglLayer),i=this.postProcessing.getThreeLayer(),this.addLayer(i),this.postProcessing.initialize(i),i.postProcessing=this.postProcessing)}return z(r,[{key:"renderCanvas",value:function(i){var t=this;this.postProcessing?this.postProcessing.addRender(function(){t.layerManager.renderGLLayers(i)}):this.layerManager.renderGLLayers(i),this.layerManager.renderThreeLayers(i),this.layerManager.renderThreeLayer(i)}},{key:"render",value:function(){this.webglLayer&&this.webglLayer.render()}},{key:"_render",value:function(i){var t=this;if(this._visible){var e=this.options.effects;e&&0<e.length?(this.webglRender.render=function(){t.renderCanvas(i)},this.effectManager.render()):(this.webglLayer.saveFramebuffer(),this.renderCanvas(i),this.webglLayer.restoreFramebuffer())}}},{key:"onRender",value:function(i){this.webglLayer.onRender(i)}},{key:"destroy",value:function(){this.stopAnimation(),this.layerManager.destroy(),this.effectManager.destroy(),this.webglLayer.destroy()}},{key:"isRequestAnimation",value:function(){return this.layerManager.isRequestAnimation()}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}},{key:"show",value:function(){this._visible!==!0&&(this._visible=!0,this.webglLayer.render(),this.isRequestAnimation()&&this.startAnimation())}},{key:"hide",value:function(){this._visible!==!1&&(this._visible=!1,this.stopAnimation(),this.webglLayer.clear())}},{key:"showLayer",value:function(i){this.layerManager.showLayer(i)}},{key:"hideLayer",value:function(i){this.layerManager.hideLayer(i)}},{key:"add",value:function(i){this.addLayer(i)}},{key:"remove",value:function(i){this.removeLayer(i)}},{key:"addLayer",value:function(i){this.layerManager.addLayer(i)}},{key:"removeLayer",value:function(i){this.layerManager.removeLayer(i)}},{key:"removeAllLayers",value:function(){this.layerManager.removeAllLayers()}},{key:"getAllLayers",value:function(){return this.layerManager.getAllLayers()}},{key:"getAllThreeLayers",value:function(){return this.layerManager.getAllThreeLayers()}}]),r}(),Vn=function(){function r(i){O(this,r),this._visible=!0,this.options=this.getCommonDefaultOptions(),this.options=G(this.options,this.getDefaultOptions()),this.autoUpdate=!1,this.options=G(this.options,i),this.options.data&&(this.data=this.options.data,delete this.options.data)}return z(r,[{key:"getCommonDefaultOptions",value:function(){return{}}},{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(i){}},{key:"destroy",value:function(){this.onDestroy&&this.onDestroy()}},{key:"show",value:function(){this._visible=!0}},{key:"hide",value:function(){this._visible=!1}},{key:"render",value:function(){}},{key:"clear",value:function(){this.setData([])}},{key:"setData",value:function(i,t){t=t||{},this.data=i,this.onDataChanged&&this.onDataChanged(this.getData()),this.onChanged&&this.onChanged(this.getOptions(),this.getData(),t),t.autoRender!==!1&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",value:function(i,t){i=i||{},t=t||{};var e=G({},this.getOptions());G(this.options,i),this.onOptionsChanged&&this.onOptionsChanged(this.getOptions(),e),this.onChanged&&this.onChanged(this.getOptions(),this.getData(),t),i.data?(this.setData(i.data,t),delete i.data):t.autoRender!==!1&&this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(i,t){}},{key:"onDataChanged",value:function(i){}},{key:"onChanged",value:function(i,t){}},{key:"onDestroy",value:function(){}},{key:"lnglatToMercator",value:function(i,t){}},{key:"setWebglLayer",value:function(i){this.webglLayer=i}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",value:function(){return this.autoUpdate}}]),r}(),rt=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.pickedColor=[-1,-1,-1],t}return W(i,r),z(i,[{key:"getCommonDefaultOptions",value:function(){return{blend:"default",zIndex:0,zoomThreshold:[0,30],repeat:!1,enablePicked:!1,autoSelect:!1,selectedIndex:-1,selectedColor:"rgba(20, 20, 200, 1.0)"}}},{key:"commonInitialize",value:function(t){var e=this.getOptions();this.gl=t,e.enablePicked&&(this.pickBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}))}},{key:"getCommonAttributes",value:function(){var t=[];return this.getOptions().enablePicked&&t.push({name:"aPickColor",buffer:this.pickBuffer,size:3,type:"FLOAT",stride:12,offset:0}),t}},{key:"getProperty",value:function(t,e,a){return Object.prototype.toString.call(e)==="[object Function]"?e(a):(e=a[t]||e,"properties"in a&&t in a.properties&&(e=a.properties[t]),e)}},{key:"normizedColor",value:function(t){var e=t;return t instanceof Array||(e=pt(t).unitArray()),e[3]===void 0&&(e[3]=1),e}},{key:"normizedPoint",value:function(t){var e=this.getPointOffset();if(!t||!t[0]||!t[1])return[e[0],e[1],0];var a=Number(t[0]),n=Number(t[1]);-180<=a&&180>=a&&-90<=n&&90>=n&&(n=this.webglLayer.map.lnglatToMercator(a,n),a=n[0],n=n[1]);var s=Number(t[2])||0;return this.webglLayer&&this.webglLayer.options.mapType==="cesium"&&window.Cesium?(a=this.convertLngLat([a,n]),s=window.Cesium.Cartesian3.fromDegrees(a[0],a[1],s),a=s.x,n=s.y,s=s.z):this.webglLayer&&this.webglLayer.options.mapType==="bmapgl"&&this.webglLayer.map.map.mapType==="B_EARTH_MAP"&&(a=this.convertLngLat([a,n]),s=this.webglLayer.map.map.getEarth().scene.fromLatLngToXYZ({lng:a[0],lat:a[1]}),a=s.x,n=s.y,s=s.z),3<t.length?[a-e[0],n-e[1],s].concat(Q(t.slice(3))):[a-e[0],n-e[1],s]}},{key:"convertLngLat",value:function(t){return[t[0]/2003750834e-2*180,180/Math.PI*(2*Math.atan(Math.exp(t[1]/2003750834e-2*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){var t=[0,0],e=this.getOptions();return this.webglLayer&&this.webglLayer.options.pointOffset?t=this.webglLayer.options.pointOffset:e.pointOffset&&(t=e.pointOffset),t}},{key:"indexToRgb",value:function(t){t++;var e=Math.floor(t/65536);t-=65536*e;var a=Math.floor(t/256);return[t-256*a,a,e]}},{key:"rgbToIndex",value:function(t){return t[0]+256*t[1]+65536*t[2]-1}},{key:"getCommonUniforms",value:function(t){t=t.isPickRender;var e=this.getOptions(),a={};if(e.enablePicked){var n=0<=e.selectedIndex?e.selectedIndex:-1;n=e.autoSelect?this.pickedColor:this.indexToRgb(n),a=G(a,{uSelectedColor:this.normizedColor(e.selectedColor),uEnablePicked:e.enablePicked,uPickedColor:n.map(function(s){return s/255}),uIsPickRender:!!t})}return a}},{key:"pick",value:function(t,e,a){var n=this.gl,s=this.webglLayer._dpr;this.webglLayer.saveFramebuffer(),this.webglLayer.bindFramebuffer(this.webglLayer.pickFBO),this.webglLayer.clear(),this.render({gl:n,isPickRender:!0,matrix:this.webglLayer.matrix,projectionMatrix:this.webglLayer.projectionMatrix,viewMatrix:this.webglLayer.viewMatrix,orthoMatrix:this.webglLayer.orthoMatrix});var o=new Uint8Array(4);return n.readPixels(t*s,n.canvas.height-e*s,1,1,n.RGBA,n.UNSIGNED_BYTE,o),t=this.rgbToIndex(o),this.pickAfter&&(t=this.pickAfter(o,t+1)),this.setPickedIndex&&this.setPickedIndex(t,a),a=this.getData(),this.pickedColor=[o[0],o[1],o[2]],this.webglLayer.restoreFramebuffer(),{dataIndex:t,dataItem:a[t]}}},{key:"setGLState",value:function(t){this.webglLayer.stateManager.setState(t,this.options)}},{key:"addMultipleCoords",value:function(t,e,a){if(!this.options.repeat||!this.webglLayer||this.webglLayer.options.mapType!=="bmapgl"||this.webglLayer.map.map.mapType==="B_EARTH_MAP")return[t];var n=this.webglLayer.map.map;e=e||n.getZoom();var s=a?n.worldSize(e):4007545274461451e-8;if(e=function(d){return[[d[0]-s,d[1],d[2]||0],[d[0]+s,d[1],d[2]||0]]},t instanceof Array&&!(t[0]instanceof Array))return e=e(t),e=nt(e,2),[t,e[0],e[1]];if(t instanceof Array&&t[0]instanceof Array&&!(t[0][0]instanceof Array)){a=[],n=[];for(var o=0;o<t.length;o++){var u=e(t[o]);u=nt(u,2);var f=u[1];a.push(u[0]),n.push(f)}return[t,a,n]}for(a=[],n=[],o=0;o<t.length;o++){u=[],f=[];for(var v=0;v<t[o].length;v++){var l=e(t[o][v]);l=nt(l,2);var h=l[1];u.push(l[0]),f.push(h)}a.push(u),n.push(f)}return[t,a,n]}}]),i}(Vn),Rh=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.name="CircleLayer",t.bufferData=[],t.initializeTime=new Date,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!0,depthTest:!0,size:10,unit:"px",color:"blue",borderWidth:0,borderColor:"#000000",antialias:!0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new J(this.gl,{vertexShader:`attribute vec3 aPos;attribute float aSize;attribute float aIndex;attribute vec4 aColor;attribute float aBorderWidth;attribute vec4 aBorderColor;varying vec4 vColor;varying vec3 vPosition;varying vec3 vFragPosition;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vBorderWidth=aBorderWidth*uZoomUnits;vBorderColor=aBorderColor;float x=aPos.x;float y=aPos.y;float z=aPos.z*uZoomUnits;vSize=aSize*uZoomUnits+vBorderWidth;if(aIndex==1.0){x+=vSize;y-=vSize;}else if(aIndex==2.0){x-=vSize;y+=vSize;}else if(aIndex==3.0){x+=vSize;y+=vSize;}else{x-=vSize;y-=vSize;}vPosition=aPos;vFragPosition=vec3(x,y,z);gl_Position=uMatrix*vec4(vFragPosition,1.0);
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,fragmentShader:"varying vec3 vPosition;varying float vSize;varying vec3 vFragPosition;varying vec4 vColor;varying float vBorderWidth;varying vec4 vBorderColor;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float lineWidth;uniform float uAntiAliasing;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>vSize){discard;}vec4 color=vColor;float r=vSize-vBorderWidth;if(vBorderWidth>0.0){if(d>r){color=vBorderColor;}else if(uAntiAliasing==1.0&&d>0.95*r){color=vBorderColor;float st=1.0-smoothstep(0.95*r,r,d);color.r+=(vColor.r-vBorderColor.r)*st;color.g+=(vColor.g-vBorderColor.g)*st;color.b+=(vColor.b-vBorderColor.b)*st;color.a+=(vColor.a-vBorderColor.a)*st;}}if(uAntiAliasing==1.0&&d>0.95*vSize&&d<=vSize){color.a*=1.0-smoothstep(0.95*vSize,vSize,d);}gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=Float32Array.BYTES_PER_ELEMENT;var a=14*e;e=[{stride:a,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:a,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:3*e},{stride:a,name:"aIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:4*e},{stride:a,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:5*e},{stride:a,name:"aBorderWidth",buffer:this.buffer,size:1,type:"FLOAT",offset:9*e},{stride:a,name:"aBorderColor",buffer:this.buffer,size:4,type:"FLOAT",offset:10*e}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&e&&(this.uniforms={},this.data=e,this.processData(),t.enablePicked&&this.parsePickData(e))}},{key:"processData",value:function(){var t=this,e=[],a=[];this.data.forEach(function(n,s){var o=n.properties||{},u=function(c){return n[c]||o[c]||t.options[c]},f=u("color"),v=u("size"),l=u("borderWidth");u=u("borderColor"),f=t.normizedColor(f),u=t.normizedColor(u);for(var h=t.normizedPoint(n.geometry.coordinates),d=0;4>d;d++)e.push(h[0],h[1],h[2]||0,v,d),e.push(f[0],f[1],f[2],f[3]),e.push(l,u[0],u[1],u[2],u[3]);f=4*s,0<s&&a.push(f-1,f),a.push(f,f+1,f+2,f+3)}),this.bufferData=e,this.indexData=a,this.buffer.updateData(new Float32Array(e)),this.indexBuffer.updateData(new Uint32Array(a))}},{key:"parsePickData",value:function(t){var e=[];if(this.getOptions().enablePicked){for(var a=0;a<t.length;a++){var n=this.indexToRgb(a);e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255)}this.pickBuffer.updateData(new Float32Array(e))}}},{key:"render",value:function(t){var e=this.getOptions(),a=this.program,n=t.gl,s=t.matrix;this.setGLState({blend:!0,blendEquation:n.FUNC_ADD,blendFunc:Zt(n,e.blend||"lighter"),depthTest:e.depthTest,depthMask:e.depthWrite}),a.use(n),this.vertexArray.bind(),this.indexBuffer.bind(),e=this.map.getZoomUnits(),G(this.uniforms,this.getCommonUniforms(t),{uZoomUnits:this.options.unit==="px"?e:1,uMatrix:s,uAntiAliasing:this.options.antialias?1:0}),a.setUniforms(this.uniforms),n.drawElements(n.TRIANGLE_STRIP,this.indexData.length,n.UNSIGNED_INT,0)}}]),i}(rt),us={wave:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}vec4 color=vColor;float R=vRadius;float center=vSize;float time=vStartTime+uTime;float alpha=sin((R-d)/R*trail*2.0*3.14+time/duration);if(d<=center){if(uAntiAliasing==1.0&&d>0.9*center&&d<=center){if(alpha>=0.5){color.a=0.9;}else{color.a=1.0-smoothstep(0.9*center,center,d);}}}else{if(alpha>=0.5){color.a=0.9;if(uAntiAliasing==1.0){if(alpha>=0.5&&alpha<=0.6){color.a*=smoothstep(0.0,0.1,alpha-0.5);}if(d>=0.98*R&&d<=R){color.a*=1.0-smoothstep(0.98,1.0,d/R);}}}else{color.a=0.0;}}gl_FragColor=color;}",bubble:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}float time=vStartTime+uTime;float range=mod(time,(duration+trail));float percent=0.0;if(range<=duration){percent=range/duration;}else{percent=1.0;}float center=vSize;float R=vRadius;float r=R*percent;vec4 color=vColor;if(d<=center){if(uAntiAliasing==1.0&&d>0.9*center&&d<=center){color.a=1.0-smoothstep(0.9*center,center,d);}}else{if(d<r){color.a=smoothstep(0.1,0.9,pow(d/r,2.0)*0.9);if(uAntiAliasing==1.0&&d>=0.9*r&&d<=r){color.a*=1.0-smoothstep(0.9,1.0,d/r);}if(range>duration){color.a*=1.0-(range-duration)/trail;}}else{color.a=0.0;}}gl_FragColor=color;}",breath:"varying vec4 vPosition;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}vec4 color=vColor;if(uAntiAliasing==1.0&&d>0.9*vRadius&&d<=vRadius){color.a=1.0-smoothstep(0.9*vRadius,vRadius,d);}float time=vStartTime+uTime;float range=mod(time,(duration+trail));float percent=0.0;if(range<=duration){percent=range/duration;}else{percent=1.0;}color.a*=abs(1.0-percent*2.0)+0.2;gl_FragColor=color;}",radar:"varying vec4 vPosition;varying float vSize;varying vec4 vFragPosition;varying vec4 vColor;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uTime;uniform float duration;uniform float trail;uniform float uAntiAliasing;varying float vWidth;void main(){float d=distance(vFragPosition.xy,vPosition.xy);if(d>=vRadius){discard;}float time=vStartTime+uTime;float range=mod(time,duration);float percent=range/duration;float center=vSize;float startDeg=360.0*percent;vec4 color=vColor;float deltaX=vFragPosition.x-vPosition.x;float deltaY=vFragPosition.y-vPosition.y;float currDeg=degrees(atan(deltaX/deltaY));if(deltaX>=0.0&&deltaY<=0.0){currDeg=180.0+currDeg;}if(deltaX<=0.0&&deltaY<=0.0){currDeg=180.0+currDeg;}if(deltaX<=0.0&&deltaY>=0.0){currDeg=360.0+currDeg;}float maxDeg=trail;if(trail<0.0){currDeg=-currDeg;maxDeg=-trail;}float modDeg=mod((currDeg-startDeg),360.0);if(modDeg<maxDeg){color.a=modDeg/maxDeg;}else{color.a=0.0;}if(uAntiAliasing==1.0&&d>0.95*vRadius&&d<=vRadius){color.a=color.a-smoothstep(0.95*vRadius,vRadius,d);}gl_FragColor=color;}"},Ph=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.name="RippleCircleLayer",t.autoUpdate=!0,t.bufferData=[],t.initializeTime=new Date,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){var t=1;return this.options.type==="radar"&&(t=120),{depthWrite:!1,depthTest:!0,type:"bubble",size:10,duration:1,trail:t,unit:"px",random:!0,color:"blue",antialias:!0,radius:function(e){return 2*e}}}},{key:"initialize",value:function(t){this.gl=t,this.program=new J(this.gl,{vertexShader:`attribute vec3 aPos;attribute float aSize;attribute float aIndex;attribute vec4 aColor;attribute float aStartTime;attribute float aRadius;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vWidth;varying float vStartTime;varying float vRadius;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vStartTime=aStartTime;vSize=aSize*uZoomUnits;vRadius=aRadius*uZoomUnits;float x=aPos.x;float y=aPos.y;float z=aPos.z*uZoomUnits;float R=vRadius;if(aIndex==1.0){x+=R;y-=R;}else if(aIndex==2.0){x-=R;y+=R;}else if(aIndex==3.0){x+=R;y+=R;}else{x-=R;y-=R;}vPosition=vec4(aPos.xy,z,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,fragmentShader:us[this.options.type]||"bubble",defines:this.options.enablePicked?["PICK"]:[]},this),this.buffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var e=[{stride:44,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:44,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:12},{stride:44,name:"aIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:16},{stride:44,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:20},{stride:44,name:"aRadius",buffer:this.buffer,size:1,type:"FLOAT",offset:36},{stride:44,name:"aStartTime",buffer:this.buffer,size:1,type:"FLOAT",offset:40}];e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&e&&(this.uniforms={duration:t.duration,trail:t.trail},this.data=e,this.processData(),t.enablePicked&&this.parsePickData(e))}},{key:"processData",value:function(){var t=this,e=[],a=[];this.data.forEach(function(n,s){var o=n.size||t.options.size,u=n.radius||t.options.radius||1.618*o;typeof u=="function"&&(u=u(o));var f=n.color||t.options.color;f=t.normizedColor(f),n=t.normizedPoint(n.geometry.coordinates);for(var v=t.options.random?Math.random()*t.data.length*9999:0,l=0;4>l;l++)e.push(n[0],n[1],n[2]||0,o,l),e.push(f[0],f[1],f[2],f[3]),e.push(u),e.push(v);o=4*s,0<s&&a.push(o-1,o),a.push(o,o+1,o+2,o+3)}),this.bufferData=e,this.indexData=a,this.buffer.updateData(new Float32Array(e)),this.indexBuffer.updateData(new Uint32Array(a))}},{key:"parsePickData",value:function(t){var e=[];if(this.getOptions().enablePicked){for(var a=0;a<t.length;a++){var n=this.indexToRgb(a);e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255),e.push(n[0]/255,n[1]/255,n[2]/255)}this.pickBuffer.updateData(new Float32Array(e))}}},{key:"render",value:function(t){var e=this.getOptions(),a=this.program,n=t.gl,s=t.matrix;a.use(n);var o=this.map.getZoomUnits();G(this.uniforms,this.getCommonUniforms(t),{uTime:(new Date-this.initializeTime)/1e3,uZoomUnits:e.unit==="m"?1:o,uMatrix:s,uAntiAliasing:e.antialias?1:0}),a.setUniforms(this.uniforms),this.setGLState({blend:!0,blendEquation:n.FUNC_ADD,blendFunc:[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA],depthTest:e.depthTest,depthMask:e.depthWrite}),0<this.indexData.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),n.drawElements(n.TRIANGLE_STRIP,this.indexData.length,n.UNSIGNED_INT,0))}}]),i}(rt),Sh=_t(us),Lh=V(function(r,i){i.__esModule=!0;var t=_r&&_r.__esModule?_r:{default:_r},e=Sr&&Sr.__esModule?Sr:{default:Sr};i.default=function a(n,s,o){n===null&&(n=Function.prototype);var u=(0,e.default)(n,s);if(u===void 0){if(n=(0,t.default)(n),n!==null)return a(n,s,o)}else return"value"in u?u.value:(s=u.get,s===void 0?void 0:s.call(o))}}),de=tt(Lh);Dt.deviation=function(r,i,t,e){var a=i&&i.length,n=Math.abs(on(r,0,a?i[0]*t:r.length,t));if(a){a=0;for(var s=i.length;a<s;a++)n-=Math.abs(on(r,i[a]*t,a<s-1?i[a+1]*t:r.length,t))}for(a=i=0;a<e.length;a+=3){s=e[a]*t;var o=e[a+1]*t,u=e[a+2]*t;i+=Math.abs((r[s]-r[u])*(r[o+1]-r[s+1])-(r[s]-r[o])*(r[u+1]-r[s+1]))}return n===0&&i===0?0:Math.abs((i-n)/n)},Dt.flatten=function(r){for(var i=r[0][0].length,t={vertices:[],holes:[],dimensions:i},e=0,a=0;a<r.length;a++){for(var n=0;n<r[a].length;n++)for(var s=0;s<i;s++)t.vertices.push(r[a][n][s]);0<a&&(e+=r[a-1].length,t.holes.push(e))}return t},Dt.default=Dt;var ls=typeof aa=="undefined"?"__target":aa(),Dh=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Ii=window.URL||window.webkitURL,or=window.Worker;if(or){var hs=Mo("self.onmessage = function () {}"),fs=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");var Gn=new or(hs);Gn.postMessage(fs,[fs.buffer])}catch(r){or=null}finally{Ii.revokeObjectURL(hs),Gn&&Gn.terminate()}}var Fh=new function(r,i){return function(t){var e=this;if(i){if(or&&!t)return t=(""+i).replace(/^function.+?{/,"").slice(0,-1),t=Mo(t),this[ls]=new or(t),Ii.revokeObjectURL(t),this[ls];var a={postMessage:function(n){e.onmessage&&setTimeout(function(){return e.onmessage({data:n,target:a})})}};i.call(a),this.postMessage=function(n){setTimeout(function(){return a.onmessage({data:n,target:e})})},this.isThisThread=!0}else return new or(r)}}("./worker.js",function(r,i){}),cs={window:1,windowAnimation:2,gradual:3,ripple:4,water:6,repeat:7},bi=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="ShapeLayer",t._isShow=!0,e=t.getOptions(),(e.style==="windowAnimation"||e.style==="ripple"||0<e.riseTime)&&(t.autoUpdate=!0),t.selectedColor=[-1,-1,-1],t.textureCache={},t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:"rgba(50, 50, 230, 1.0)",opacity:.8,height:0,isTextureFull:!1,topColor:"rgba(76, 76, 76, 0.8)",textureRotate:0,textureScale:1,useLight:!0,useTopColor:!1,riseTime:0,polygonOffset:[0,0],depthTest:!0,zIndex:0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.dataMgr=new Oe(this,this.gl),this.texture=null,this.isUseTexture=!1;var a=[];e.enablePicked&&a.push("PICK"),e.texture&&a.push("USE_TEXTURE"),this.program=new J(this.gl,{vertexShader:`precision highp float;uniform vec4 uSelectedColor;attribute vec4 a_pos;attribute vec3 a_normal;attribute vec4 a_color;attribute vec4 a_pre_color;attribute float a_height;attribute float a_pre_height;
#if defined(USE_TEXTURE)
attribute vec2 a_texture_coord;
#endif
uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float dataTime;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;uniform float u_zIndex;varying float v_height;varying vec4 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.8,0.8,0.8);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);float getTransitionValue(float pre_value,float to_value,float dataTime,float riseTime){float result=0.0;if(pre_value==to_value){result=to_value;}else{if(riseTime>0.0&&dataTime<riseTime){result=(pre_value+(to_value-pre_value)*(dataTime/riseTime));}else{result=to_value;}}return result;}void main(){vec4 pos=a_pos;pos.z=pos.z+pos.w*getTransitionValue(a_pre_height,a_height,dataTime,riseTime);v_position=pos.xyz;v_height=a_height;
#if defined(USE_TEXTURE)
if(u_use_texture){v_texture_coord=a_texture_coord;}
#endif
pos.z+=u_zIndex;vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos.xyz,1.0);gl_Position=position;vec4 icolor=a_color;
#if defined(PICK)
if(mapvIsPicked()){icolor=uSelectedColor;}
#endif
if(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));if(a_pre_color.r==a_color.r&&a_pre_color.g==a_color.g&&a_pre_color.b==a_color.b){}else{if(riseTime>0.0&&dataTime<riseTime){icolor.r=a_pre_color.r+(a_color.r-a_pre_color.r)*(dataTime/riseTime);icolor.g=a_pre_color.g+(a_color.g-a_pre_color.g)*(dataTime/riseTime);icolor.b=a_pre_color.b+(a_color.b-a_pre_color.b)*(dataTime/riseTime);}}v_color.rgb=icolor.rgb+icolor.rgb*light_color*lambert+icolor.rgb*light_color_2*lambert_2+icolor.rgb*point_color*lambert_point;v_color.a=icolor.a;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec4 vLightWeighting;vLightWeighting=vec4(uAmbientColor+uDirectionalColor*directionalLightWeighting,1.0);v_color=vLightWeighting;}}else{v_color=icolor;}}`,fragmentShader:"precision highp float;varying vec4 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec4 top_color;uniform float u_zoom_units;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;uniform bool u_use_top_color;void main(){vec4 color=vec4(v_color);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){if(style==6.0){float x=v_texture_coord.s;float y=v_texture_coord.t;vec2 cPos=-1.0+2.0*gl_FragCoord.xy/MAPV_resolution;float cLength=length(cPos);vec2 uv=gl_FragCoord.xy/MAPV_resolution+(cPos/cLength)*cos(cLength*12.0-time/1000.0*4.0)*0.03;textureColor=texture2D(u_sampler,uv/2.0+vec2(x,y));}else if(style==7.0){float tWidth=1.*u_zoom_units;float deltaX=mod(v_texture_coord.x,tWidth);float deltaY=mod(v_texture_coord.y,tWidth);if(deltaX>=0.&&deltaX<=tWidth){vec2 uv=vec2(deltaX,deltaY)/tWidth;vec4 texture=texture2D(u_sampler,uv);textureColor=texture.a>=0.1 ? texture : vec4(0.,0.,0.,0.);}}else{textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));}if(u_use_lighting){color=vec4(textureColor*v_color*1.1);}else{color=textureColor;}}if(u_use_top_color&&v_position.z>=v_height){color=top_color;}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}else if(style==6.0){}gl_FragColor=color;}",defines:a},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.heightBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.textureBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),a=[{name:"a_pos",buffer:this.vertexBuffer,stride:28,size:4,type:"FLOAT",offset:0},{name:"a_normal",buffer:this.vertexBuffer,size:3,stride:28,type:"FLOAT",offset:16},{name:"a_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:0},{name:"a_pre_color",buffer:this.colorBuffer,size:4,stride:32,type:"FLOAT",offset:16},{name:"a_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:0},{name:"a_pre_height",buffer:this.heightBuffer,size:1,stride:8,type:"FLOAT",offset:4}],e.texture&&a.push({name:"a_texture_coord",buffer:this.textureBuffer,size:2,stride:8,type:"FLOAT",offset:0}),a=a.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:a}),this.initializeTime=new Date,this.normalMatrix=b.create()}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var a=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){a.loadTexture(function(){a.dataMgr.parseData(e),a.dataTime=new Date,a.webglLayer.render()})},0))}},{key:"render",value:function(t){var e=t.gl,a=t.projectionMatrix,n=t.viewMatrix;if(this._isShow){var s=this.getData();if(s&&!(0>=s.length)){s=this.getOptions();var o=this.program;if(o.use(e),!s.texture||this.texture){var u=0;s.style&&cs[s.style]&&(u=cs[s.style]);var f=[e.ONE,e.ZERO];if(s.blend&&(f=Zt(e,s.blend)),(s.height===0||s.style==="gradual")&&(f=[e.ONE,e.ONE_MINUS_SRC_ALPHA]),this.setGLState({cullFace:!1,blend:!0,blendEquation:e.FUNC_ADD,blendFunc:f,polygonOffset:s.polygonOffset,depthTest:s.depthTest,depthMask:s.style!=="gradual"}),f=this.normizedColor(s.topColor),s.style==="ripple"&&s.rippleLayer&&s.rippleLayer.data&&s.rippleLayer.data[0]){var v=this.normizedPoint(s.rippleLayer.data[0].geometry.coordinates);o.setUniforms({u_ripple_center:[v[0],v[1],0],u_radius:s.rippleLayer.options.size*s.rippleLayer.currentScale})}v=j.fromValues(0,-1,2),s.lightDir&&(v=j.fromValues(s.lightDir[0],s.lightDir[1],s.lightDir[2]));var l=this.normalMatrix;b.invert(l,n),b.transpose(l,l),o.setUniforms(G(this.getCommonUniforms(t),{u_normal_matrix:l,u_sampler:this.texture,u_proj_matrix:a,u_mv_matrix:n,u_zoom_units:this.map.getZoomUnits(),style:u,u_use_top_color:s.useTopColor,top_color:f,u_use_lighting:s.useLight,u_use_texture:this.isUseTexture,alpha:s.opacity===void 0?.8:parseFloat(s.opacity),time:new Date-this.initializeTime,dataTime:new Date-this.dataTime,riseTime:s.riseTime,u_side_light_dir:v,u_zIndex:s.zIndex})),t=this.dataMgr.getData(),0<t.vertex.length&&(this.vertexArray.bind(),this.indexBuffer.bind(),e.drawElements(e.TRIANGLES,t.index.length,e.UNSIGNED_INT,0))}}}else this.webglLayer.clear()}},{key:"loadTexture",value:function(t){var e=this,a=this.getOptions();a.texture?(this.isUseTexture=!0,yt(this.gl,a.texture,function(n,s){e.image=s,e.texture=n,t&&t(),e.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),i}(rt);Oe.prototype.initData=function(){this.outBuilding3d={pickColorVertex:[],vertex:[],texture:[],color:[],height:[],index:[]}},Oe.prototype.getData=function(){return this.outBuilding3d},Oe.prototype.initWorker=function(){this.worker=new Fh,this.worker.onmessage=function(r){}},Oe.prototype.parseData=function(r){var i=this;this.initData();for(var t=this.shapeLayer.getOptions(),e=0;e<r.length;e++){var a=r[e],n=a.height||t.height;"properties"in a&&"height"in a.properties&&(n=a.properties.height),n*=1;var s=a.color||t.color;"properties"in a&&"color"in a.properties&&(s=a.properties.color),"properties"in a&&"fillColor"in a.properties&&(s=a.properties.fillColor),Object.prototype.toString.call(s)==="[object Function]"&&(s=s(a)),s=this.shapeLayer.normizedColor(s);var o=this.shapeLayer.getProperty("angle",t.textureRotate,a),u=void 0;t.enablePicked&&(u=this.shapeLayer.indexToRgb(e));var f=void 0,v=void 0;if(t.riseTime&&(v=a.preColor,"properties"in a&&"preColor"in a.properties&&(v=a.properties.preColor),f=a.preHeight,"properties"in a&&"preHeight"in a.properties&&(f=a.properties.preHeight),f===void 0&&(f=0)),a.geometry.coordinates){if(a.geometry.type==="LineString"){var l=a.geometry.coordinates.map(function(g){return i.shapeLayer.normizedPoint(g)}),h=Dt.flatten([l]);l=h.vertices,h=h.holes;for(var d=[],c=[],p=0;p<l.length;p+=3)d.push(l[p+0],l[p+1]),c.push(l[p+2]);this.parseBuilding3d(this.outBuilding3d,d,c,f,n,v,s,u,o,h)}if(a.geometry.type==="MultiPolygon"){for(l=a.geometry.coordinates,a=[],h=0;h<l.length;h++)a.push(l[h].map(function(g){return g.map(function(x){return i.shapeLayer.normizedPoint(x)})}));for(l=0;l<a.length;l++){h=[],d=[],p=Dt.flatten(a[l]),c=p.vertices,p=p.holes;for(var m=0;m<c.length;m+=3)h.push(c[m+0],c[m+1]),d.push(c[m+2]);this.parseBuilding3d(this.outBuilding3d,h,d,f,n,v,s,u,o,p)}}else{for(l=[],h=0;h<a.geometry.coordinates.length;h++)l.push(a.geometry.coordinates[h].map(function(g){return i.shapeLayer.normizedPoint(g)}));for(l=Dt.flatten(l),a=l.vertices,l=l.holes,h=[],d=[],c=0;c<a.length;c+=3)h.push(a[c+0],a[c+1]),d.push(a[c+2]);this.parseBuilding3d(this.outBuilding3d,h,d,f,n,v,s,u,o,l)}}}this.shapeLayer.vertexBuffer.updateData(new Float32Array(this.outBuilding3d.vertex)),this.shapeLayer.colorBuffer.updateData(new Float32Array(this.outBuilding3d.color)),this.shapeLayer.heightBuffer.updateData(new Float32Array(this.outBuilding3d.height)),this.shapeLayer.textureBuffer.updateData(new Float32Array(this.outBuilding3d.texture)),this.shapeLayer.indexBuffer.updateData(new Uint32Array(this.outBuilding3d.index)),t.enablePicked&&this.shapeLayer.pickBuffer.updateData(new Float32Array(this.outBuilding3d.pickColorVertex))},Oe.prototype.getBounds=function(r,i){for(var t=r[0],e=r[1],a=r[0],n=r[1],s=0;s<r.length;s+=2)t=Math.min(r[s],t),e=Math.min(r[s+1],e),a=Math.max(r[s],a),n=Math.max(r[s+1],n);if(s=[(a-t)/2+t,(n-e)/2+e],i===0||!i)return{minX:t,minY:e,maxX:a,maxY:n,width:a-t,height:n-e,center:s};for(t=r.slice(0),e=0;e<t.length;e+=2)a=Eo(r[e],r[e+1],s,i),t[e]=a[0],t[e+1]=a[1];return this.getBounds(t,0)},Oe.prototype.parseBuilding3d=function(r,i,t,e,a,n,s,o,u,f){e===void 0&&(e=a);var v=this.shapeLayer.options,l=r.vertex,h=r.texture,d=r.color,c=r.height,p=r.pickColorVertex;r=r.index,n===void 0&&(n=s);var m=0,g=0;if(this.shapeLayer.image&&(m=this.shapeLayer.image.width*v.textureScale,g=this.shapeLayer.image.height*v.textureScale),v.style!=="gradual"){f=f&&f.length?Dt(i,f,2):Dt(i);var x=f[0],y=f[1],_=f[2];x=[i[2*x],i[2*x+1],1],y=[i[2*y],i[2*y+1],1];var A=[i[2*_],i[2*_+1],1];_=[],j.cross(_,[A[0]-y[0],A[1]-y[1],A[2]-y[2]],[x[0]-y[0],x[1]-y[1],x[2]-y[2]]),y=l.length/7;var T;v.texture&&(T=this.getBounds(i,u)),x=v.isTextureFull,A=0;for(var w=i.length;A<w;A+=2){if(l.push(i[A],i[A+1],t[A/2],1,_[0],_[1],_[2]),d.push(s[0],s[1],s[2],s[3],n[0],n[1],n[2],n[3]),c.push(a,e),v.texture){var E=Eo(i[A],i[A+1],T.center,u),M=nt(E,2);E=M[0],M=M[1],x?(E=(E-T.minX)/T.width,M=(M-T.minY)/T.height):(E=(E-T.minX)/m,M=(M-T.minY)/g),h.push(E,M)}o&&p.push(o[0]/255,o[1]/255,o[2]/255)}for(u=0,T=f.length;u<T;u++)r.push(f[u]+y)}if(!(a===e&&0>=a))for(u=0,f=i.length;u<f;u+=2)T=l.length/7,w=i[u],E=i[u+1],_=[w,E,t[u/2],0],y=[w,E,t[u/2],1],A=u+2,M=u+3,u===f-2&&(A=0,M=1),A=i[A],M=i[M],w=Math.sqrt(Math.pow(A-w,2),Math.pow(M-E,2)),E=[A,M,t[u/2],0],A=[A,M,t[u/2],1],M=[],j.cross(M,[E[0]-_[0],E[1]-_[1],E[2]-_[2]],[y[0]-_[0],y[1]-_[1],y[2]-_[2]]),l.push(_[0],_[1],_[2],_[3]),l.push(M[0],M[1],M[2]),l.push(y[0],y[1],y[2],y[3]),l.push(M[0],M[1],M[2]),l.push(E[0],E[1],E[2],E[3]),l.push(M[0],M[1],M[2]),l.push(A[0],A[1],A[2],A[3]),l.push(M[0],M[1],M[2]),d.push(s[0],s[1],s[2],s[3]),d.push(n[0],n[1],n[2],n[3]),d.push(s[0],s[1],s[2],s[3]),d.push(n[0],n[1],n[2],n[3]),d.push(s[0],s[1],s[2],s[3]),d.push(n[0],n[1],n[2],n[3]),d.push(s[0],s[1],s[2],s[3]),d.push(n[0],n[1],n[2],n[3]),c.push(a),c.push(e),c.push(a),c.push(e),c.push(a),c.push(e),c.push(a),c.push(e),v.texture&&(x?(h.push(0,0),h.push(0,1),h.push(1,0),h.push(1,1)):(h.push(0,0),h.push(0,a/g),h.push(w/m,0),h.push(w/m,a/g))),o&&(p.push(o[0]/255,o[1]/255,o[2]/255),p.push(o[0]/255,o[1]/255,o[2]/255),p.push(o[0]/255,o[1]/255,o[2]/255),p.push(o[0]/255,o[1]/255,o[2]/255)),r.push(T,T+2,T+3,T,T+3,T+1)};var ar=V(function(r,i){(function(t,e){r.exports=e()})(Do,function(){function t(g,x,y,_,A){for(;_>y;){if(600<_-y){var T=_-y+1,w=x-y+1,E=Math.log(T),M=.5*Math.exp(2*E/3);E=.5*Math.sqrt(E*M*(T-M)/T)*(0>w-T/2?-1:1),t(g,x,Math.max(y,Math.floor(x-w*M/T+E)),Math.min(_,Math.floor(x+(T-w)*M/T+E)),A)}for(T=g[x],w=y,M=_,e(g,y,x),0<A(g[_],T)&&e(g,y,_);w<M;){for(e(g,w,M),w++,M--;0>A(g[w],T);)w++;for(;0<A(g[M],T);)M--}A(g[y],T)===0?e(g,y,M):(M++,e(g,M,_)),M<=x&&(y=M+1),x<=M&&(_=M-1)}}function e(g,x,y){var _=g[x];g[x]=g[y],g[y]=_}function a(g,x){return g<x?-1:g>x?1:0}function n(g,x){s(g,0,g.children.length,x,g)}function s(g,x,y,_,A){for(A||(A=c(null)),A.minX=1/0,A.minY=1/0,A.maxX=-1/0,A.maxY=-1/0;x<y;x++){var T=g.children[x];o(A,g.leaf?_(T):T)}return A}function o(g,x){return g.minX=Math.min(g.minX,x.minX),g.minY=Math.min(g.minY,x.minY),g.maxX=Math.max(g.maxX,x.maxX),g.maxY=Math.max(g.maxY,x.maxY),g}function u(g,x){return g.minX-x.minX}function f(g,x){return g.minY-x.minY}function v(g){return(g.maxX-g.minX)*(g.maxY-g.minY)}function l(g){return g.maxX-g.minX+(g.maxY-g.minY)}function h(g,x){return g.minX<=x.minX&&g.minY<=x.minY&&x.maxX<=g.maxX&&x.maxY<=g.maxY}function d(g,x){return x.minX<=g.maxX&&x.minY<=g.maxY&&x.maxX>=g.minX&&x.maxY>=g.minY}function c(g){return{children:g,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function p(g,x,y,_,A){for(var T=[x,y];T.length;)if(y=T.pop(),x=T.pop(),!(y-x<=_)){var w=x+Math.ceil((y-x)/_/2)*_;t(g,w,x||0,y||g.length-1,A||a),T.push(x,w,w,y)}}var m=function(g){g===void 0&&(g=9),this._maxEntries=Math.max(4,g),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};return m.prototype.all=function(){return this._all(this.data,[])},m.prototype.search=function(g){var x=this.data,y=[];if(!d(g,x))return y;for(var _=this.toBBox,A=[];x;){for(var T=0;T<x.children.length;T++){var w=x.children[T],E=x.leaf?_(w):w;d(g,E)&&(x.leaf?y.push(w):h(g,E)?this._all(w,y):A.push(w))}x=A.pop()}return y},m.prototype.collides=function(g){var x=this.data;if(!d(g,x))return!1;for(var y=[];x;){for(var _=0;_<x.children.length;_++){var A=x.children[_],T=x.leaf?this.toBBox(A):A;if(d(g,T)){if(x.leaf||h(g,T))return!0;y.push(A)}}x=y.pop()}return!1},m.prototype.load=function(g){if(!g||!g.length)return this;if(g.length<this._minEntries){for(var x=0;x<g.length;x++)this.insert(g[x]);return this}return g=this._build(g.slice(),0,g.length-1,0),this.data.children.length?this.data.height===g.height?this._splitRoot(this.data,g):(this.data.height<g.height&&(x=this.data,this.data=g,g=x),this._insert(g,this.data.height-g.height-1,!0)):this.data=g,this},m.prototype.insert=function(g){return g&&this._insert(g,this.data.height-1),this},m.prototype.clear=function(){return this.data=c([]),this},m.prototype.remove=function(g,x){if(!g)return this;for(var y=this.data,_=this.toBBox(g),A=[],T=[],w,E,M;y||A.length;){if(y||(y=A.pop(),E=A[A.length-1],w=T.pop(),M=!0),y.leaf){t:{var P=g,R=y.children,L=x;if(L){for(var S=0;S<R.length;S++)if(L(P,R[S])){P=S;break t}P=-1}else P=R.indexOf(P)}if(P!==-1){y.children.splice(P,1),A.push(y),this._condense(A);break}}M||y.leaf||!h(y,_)?E?(w++,y=E.children[w],M=!1):y=null:(A.push(y),T.push(w),w=0,E=y,y=y.children[0])}return this},m.prototype.toBBox=function(g){return g},m.prototype.compareMinX=function(g,x){return g.minX-x.minX},m.prototype.compareMinY=function(g,x){return g.minY-x.minY},m.prototype.toJSON=function(){return this.data},m.prototype.fromJSON=function(g){return this.data=g,this},m.prototype._all=function(g,x){for(var y=[];g;)g.leaf?x.push.apply(x,g.children):y.push.apply(y,g.children),g=y.pop();return x},m.prototype._build=function(g,x,y,_){var A=y-x+1,T=this._maxEntries;if(A<=T){var w=c(g.slice(x,y+1));return n(w,this.toBBox),w}for(_||(_=Math.ceil(Math.log(A)/Math.log(T)),T=Math.ceil(A/Math.pow(T,_-1))),w=c([]),w.leaf=!1,w.height=_,A=Math.ceil(A/T),T=A*Math.ceil(Math.sqrt(T)),p(g,x,y,T,this.compareMinX);x<=y;x+=T){var E=Math.min(x+T-1,y);p(g,x,E,A,this.compareMinY);for(var M=x;M<=E;M+=A)w.children.push(this._build(g,M,Math.min(M+A-1,E),_-1))}return n(w,this.toBBox),w},m.prototype._chooseSubtree=function(g,x,y,_){for(;_.push(x),!(x.leaf||_.length-1===y);){for(var A=1/0,T=1/0,w=void 0,E=0;E<x.children.length;E++){var M=x.children[E],P=v(M),R=(Math.max(M.maxX,g.maxX)-Math.min(M.minX,g.minX))*(Math.max(M.maxY,g.maxY)-Math.min(M.minY,g.minY))-P;R<T?(T=R,A=P<A?P:A,w=M):R===T&&P<A&&(A=P,w=M)}x=w||x.children[0]}return x},m.prototype._insert=function(g,x,y){y=y?g:this.toBBox(g);var _=[],A=this._chooseSubtree(y,this.data,x,_);for(A.children.push(g),o(A,y);0<=x&&_[x].children.length>this._maxEntries;)this._split(_,x),x--;this._adjustParentBBoxes(y,_,x)},m.prototype._split=function(g,x){var y=g[x],_=y.children.length,A=this._minEntries;this._chooseSplitAxis(y,A,_),_=this._chooseSplitIndex(y,A,_),_=c(y.children.splice(_,y.children.length-_)),_.height=y.height,_.leaf=y.leaf,n(y,this.toBBox),n(_,this.toBBox),x?g[x-1].children.push(_):this._splitRoot(y,_)},m.prototype._splitRoot=function(g,x){this.data=c([g,x]),this.data.height=g.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},m.prototype._chooseSplitIndex=function(g,x,y){for(var _,A=1/0,T=1/0,w=x;w<=y-x;w++){var E=s(g,0,w,this.toBBox),M=s(g,w,y,this.toBBox),P=Math.max(0,Math.min(E.maxX,M.maxX)-Math.max(E.minX,M.minX))*Math.max(0,Math.min(E.maxY,M.maxY)-Math.max(E.minY,M.minY));E=v(E)+v(M),P<A?(A=P,_=w,T=E<T?E:T):P===A&&E<T&&(T=E,_=w)}return _||y-x},m.prototype._chooseSplitAxis=function(g,x,y){var _=g.leaf?this.compareMinX:u,A=g.leaf?this.compareMinY:f,T=this._allDistMargin(g,x,y,_);x=this._allDistMargin(g,x,y,A),T<x&&g.children.sort(_)},m.prototype._allDistMargin=function(g,x,y,_){g.children.sort(_),_=this.toBBox;for(var A=s(g,0,x,_),T=s(g,y-x,y,_),w=l(A)+l(T),E=x;E<y-x;E++){var M=g.children[E];o(A,g.leaf?_(M):M),w+=l(A)}for(y=y-x-1;y>=x;y--)A=g.children[y],o(T,g.leaf?_(A):A),w+=l(T);return w},m.prototype._adjustParentBBoxes=function(g,x,y){for(;0<=y;y--)o(x[y],g)},m.prototype._condense=function(g){for(var x=g.length-1,y;0<=x;x--)g[x].children.length===0?0<x?(y=g[x-1].children,y.splice(y.indexOf(g[x]),1)):this.clear():n(g[x],this.toBBox)},m})}),Zr=function(r){function i(t){O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.name="TextLayer";var e=t.canvas=document.createElement("canvas");return e=t.ctx=e.getContext("2d"),e.textAlign="start",e.textBaseline="top",t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,flat:!1,collides:!0,unit:"px",angle:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],shadow:{},stroke:{color:"#000"}}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new J(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)+size.x*sin(rotation);}else if(corner==2.0){x+=size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)-size.x*sin(rotation);}else if(corner==3.0){x+=size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)-size.x*sin(rotation);}else{x+=-size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)+size.x*sin(rotation);}return vec3(x,y,coord.z);}void main(){vTextCoord=aTextCoord;if(uFlat){vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}else{vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z+zIndex,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio*scale;vec3 current=transformCoord(screen,halfSize,corner);gl_Position=vec4(current,1.0);}}",fragmentShader:`precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){this.cachedData=[];for(var a=0;a<e.length;a++){var n=this.normizedPoint(e[a].geometry.coordinates),s=e[a].text;"properties"in e[a]&&"text"in e[a].properties&&(s=e[a].properties.text);var o=this.getProperty("angle",t.angle,e[a]),u=this.getProperty("color",t.color,e[a]);n&&s!==void 0&&this.cachedData.push({point:n,text:s,angle:o,color:u,index:a})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();s.setUniforms(G(this.getCommonUniforms(t),{matrix:a,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,uFlat:n.flat,offset:n.offset,zoomUnits:o,zIndex:n.zIndex,uUnitPx:n.unit==="px"})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var e=t.gl,a=t.matrix,n=this.getOptions();t=n.fontSize;var s=n.fontFamily,o=n.padding,u=n.margin,f=n.collides,v=n.enablePicked,l=n.shadow,h=e.canvas.width/window.devicePixelRatio,d=e.canvas.height/window.devicePixelRatio,c=this.canvas;e=this.ctx,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.textBaseline="top",e.font="20px "+s;var p=new ar;n=[];for(var m=0;m<this.cachedData.length;m++){var g=this.cachedData[m],x=g.point,y=g.text,_=g.angle,A=g.color;g=g.index;var T=nt(x,3),w=ft.clone([T[0],T[1],T[2],1]);ft.transformMat4(w,w,a),ft.scale(w,w,1/w[3]),T=this.map.getHeading()%360;var E=(w[0]+1)/2*h,M=(-w[1]+1)/2*d;w=E*Math.cos(T*Math.PI/180)-M*Math.sin(T*Math.PI/180);var P=E*Math.sin(T*Math.PI/180)+M*Math.cos(T*Math.PI/180);M=e.measureText(y),T=M.width+2*o[0],E=20,M.actualBoundingBoxAscent&&M.actualBoundingBoxDescent&&(E=M.actualBoundingBoxDescent-M.actualBoundingBoxAscent),E+=2*o[1];var R=T+u[0];if(M=E+u[1],w-=R/2,P-=M/2,R=w+R,M=P+M,!(0>R||0>M||w>h||P>d)){if(f){if(w={minX:w,maxX:R,minY:P,maxY:M},p.collides(w))continue;p.insert(w)}n.push({w:T,h:E,point:x,text:y,angle:_,color:A,dataIndex:g})}}for(e.restore(),u=xe(n),a=u.w,u=u.h,0>=a&&(a=1),0>=u&&(u=1),c.width=a*window.devicePixelRatio,c.height=u*window.devicePixelRatio,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.textBaseline="top",e.font="20px "+s,e.shadowColor=l&&l.color,e.shadowOffsetX=l&&l.offsetX,e.shadowOffsetY=l&&l.offsetY,e.shadowBlur=l&&l.blur,s=[],l=[],c=[],f=[],h=0,d=n.length;h<d;++h){for(p=n[h],e.fillStyle=p.color,e.fillText(p.text,p.x+o[0],p.y+o[1]),y=nt(p.point,3),m=y[0],x=y[1],y=y[2],_=0;4>_;_++)s.push(m,x,y),s.push(_),s.push(p.w,p.h),s.push(t/20,p.angle*Math.PI/180);m=p.x/a,x=(p.x+p.w)/a,y=(p.y+p.h)/u,_=p.y/u,l.push(m,y,m,_,x,_,x,y),m=4*h,c.push(m,m+2,m+1,m,m+3,m+2),v&&(p=this.indexToRgb(p.dataIndex),f.push(p[0]/255,p[1]/255,p[2]/255),f.push(p[0]/255,p[1]/255,p[2]/255),f.push(p[0]/255,p[1]/255,p[2]/255),f.push(p[0]/255,p[1]/255,p[2]/255))}e.restore(),this.loadTexture(),this.index=c,this.vertexBuffer.updateData(new Float32Array(s)),this.uvBuffer.updateData(new Float32Array(l)),this.indexBuffer.updateData(new Uint32Array(c)),v&&this.pickBuffer.updateData(new Float32Array(f))}},{key:"loadTexture",value:function(){var t=this;this.canvas?yt(this.gl,this.canvas,function(e){t.texture=e},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),i}(rt),ve=function(r){function i(t){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t))}return W(i,r),z(i,[{key:"initialize",value:function(t){var e=this;this.children&&this.children.forEach(function(a){a.map=e.map,a.setWebglLayer(e.getWebglLayer()),a.commonInitialize&&a.commonInitialize(t),a.initialize&&a.initialize(t),a.onOptionsChanged(a.getOptions()),a.onDataChanged(a.getData()),a.onChanged(a.getOptions(),a.getData())})}},{key:"isRequestAnimation",value:function(){if(this.autoUpdate!==void 0)return de(i.prototype.__proto__||U(i.prototype),"isRequestAnimation",this).call(this);for(var t=!1,e=0;e<this.children.length;e++)if(this.children[e].isRequestAnimation()){t=!0;break}return t}},{key:"render",value:function(t){this.children&&this.children.forEach(function(e){e.render(t)})}},{key:"onDestroy",value:function(t){this.children&&this.children.forEach(function(e){e.onDestroy(t)})}}]),i}(Vn),Bh=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.preHeightMapper={},t.preColorMapper={},t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return G(de(i.prototype.__proto__||U(i.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gridGap:5,height:function(){return 1e3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(t,e){var a=e.gridSize,n=[],s={};e=t.length;for(var o=this.getPointOffset(),u=0;u<e;u++){var f=this.normizedPoint(t[u].geometry.coordinates);f=~~((f[0]+o[0])/a)+"_"+~~((f[1]+o[1])/a),s[f]===void 0&&(s[f]=0);var v=~~t[u].count||1;"properties"in t[u]&&"count"in t[u].properties&&(v=~~t[u].properties.count),s[f]+=v}return _t(s).forEach(function(l){var h=l.split("_");n.push([h[0]*a+a/2,h[1]*a+a/2,s[l]])}),n}},{key:"onChanged",value:function(t,e){e=this.processData(e),de(i.prototype.__proto__||U(i.prototype),"onChanged",this).call(this,t,e)}},{key:"getGridDataRange",value:function(){var t=this.gridData,e=void 0,a=void 0;t[0]&&(e=t[0][2],a=t[0][2]);for(var n=t.length,s=0;s<n;s++){var o=t[s];e=Math.max(o[2],e),a=Math.min(o[2],a)}return{max:e/2,min:a}}},{key:"processData",value:function(t){var e=this.getOptions(),a=e.gridSize,n=[];if(e.style==="normal")for(var s=this.getPointOffset(),o=0;o<t.length;o++){var u=this.normizedPoint(t[o].geometry.coordinates),f=u[0]+s[0];u=u[1]+s[1];var v=~~t[o].count||1;"properties"in t[o]&&"count"in t[o].properties&&(v=~~t[o].properties.count);var l=t[o].color;"properties"in t[o]&&"color"in t[o].properties&&(l=~~t[o].properties.color),n.push([f,u,v,l])}else n=this.generateGrid(t,e);for(t=[],this._preHeightMapper={},this._preColorMapper={},s=0;s<n.length;s++)o=n[s],o[0]=o[0],o[1]=o[1],f=o[2],e.height&&(f=typeof e.height=="function"?e.height({count:o[2],coordinates:[o[0],o[1]]}):e.height),u=a/2-e.gridGap,v=o[3],e.color&&(v=typeof e.color=="function"?e.color({count:o[2],color:o[3]}):pt(v||e.color).unitArray()),l="p"+o[0]+o[1],t.push({geometry:{type:"Polygon",coordinates:[[[o[0]-u,o[1]-u],[o[0]-u,o[1]+u],[o[0]+u,o[1]+u],[o[0]+u,o[1]-u]]]},color:v,origin:o,count:o[2],preHeight:this.preHeightMapper[l],preColor:this.preColorMapper[l],height:f}),this._preHeightMapper[l]=f,this._preColorMapper[l]=v;return this.preHeightMapper=this._preHeightMapper,this.preColorMapper=this._preColorMapper,this.gridData=t}}]),i}(bi),ds=function(r){function i(t){O(this,i);var e=X(this,(i.__proto__||U(i)).call(this,t));return e.gridLayer=new Bh(t),e.options.textOptions=G({show:!1,flat:!0,unit:"m",fontSize:100,collides:!1},t.textOptions||{}),e.textLayer=new Zr(e.options.textOptions),e.children=[e.gridLayer,e.textLayer],e}return W(i,r),z(i,[{key:"pick",value:function(t,e){return this.gridLayer.pick(t,e)}},{key:"setData",value:function(t){this.gridLayer.setData(t),this.options.textOptions.show&&this.setTextData()}},{key:"setTextData",value:function(){var t=this.gridLayer.gridData.map(function(e){return{geometry:{type:"Point",coordinates:[e.origin[0],e.origin[1],e.height+5]},properties:{text:e.count}}});this.textLayer.setData(t)}},{key:"setOptions",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},e=this.options.textOptions;G(this.options,t),this.gridLayer.setOptions(this.options),t.textOptions&&(this.options.textOptions.show&&this.setTextData(),this.options.textOptions=G(e||{},t.textOptions),this.textLayer.setOptions(this.options.textOptions))}},{key:"getData",value:function(){return this.gridLayer.getData()}},{key:"render",value:function(t){this.gridLayer.render(t),this.options.textOptions.show&&this.textLayer.render(t)}}]),i}(ve),Oh=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.gridLayer=new ds(t.getGridOptions()),t.children=[t.gridLayer],t.options.riseTime&&(t.autoUpdate=!0),t}return W(i,r),z(i,[{key:"pick",value:function(t,e){return this.gridLayer.pick(t,e)}},{key:"onDataChanged",value:function(t){this.gridLayer.setData(t)}},{key:"getGridOptions",value:function(){var t=this.getOptions(),e=t.max,a=t.min;e===void 0&&(a=this.gridLayer.getGridDataRange(),e=a.max,a=a.min);var n=new Rt({max:e,min:a,gradient:t.gradient,maxSize:t.maxHeight,minSize:t.minHeight});return t.height=function(s){var o=n.getSize(s.count);return"properties"in s&&"count"in s.properties&&(o=n.getSize(s.properties.count)),o},t.color=function(s){var o=n.getImageData(s.count);return"properties"in s&&"count"in s.properties&&(o=n.getImageData(s.properties.count)),[o[0]/255,o[1]/255,o[2]/255,o[3]/255]},t}},{key:"onOptionsChanged",value:function(t){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,style:"grid",gridSize:500,maxHeight:8e3,minHeight:200,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]),i}(ve),vs=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="SimpleLineLayer",t.bufferData=[],t}return W(i,r),z(i,[{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new J(this.gl,{vertexShader:`uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;
#if defined(DASH)
varying vec3 vPos;
#endif
void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);
#if defined(DASH)
vPos=aPos;
#endif
}`,fragmentShader:`precision highp float;varying vec4 vColor;varying vec3 vPos;void main(){
#if defined(DASH)
if(mod(vPos.x,3.0)<1.5){discard;}
#endif
gl_FragColor=vColor;}`,defines:e.useDash?["DASH"]:""},this),this.buffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new ot({gl:t,program:this.program,attributes:[{stride:28,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12}]})}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,e){var a=this;if(this.gl){var n=[],s=function(l,h){if(l)for(var d=0;d<l.length-1;d++){var c=a.normizedPoint(l[d]);n.push(c[0]),n.push(c[1]),n.push(c[2]),n.push(h[0],h[1],h[2],h[3]),c=a.normizedPoint(l[d+1]),n.push(c[0]),n.push(c[1]),n.push(c[2]),n.push(h[0],h[1],h[2],h[3])}};t=t.color;for(var o=0;o<e.length;o++){var u=this.getProperty("color",t,e[o]);u=this.normizedColor(u);var f=e[o].geometry,v=f.coordinates;if(f.type==="MultiPolygon"){if(v)for(f=0;f<v.length;f++)s(v[f][0],u)}else if(f.type==="Polygon")v&&s(v[0],u);else if(f.type==="MultiLineString"){if(v)for(f=0;f<v.length;f++)s(v[f],u)}else s(v,u)}this.bufferData=n,this.buffer.updateData(new Float32Array(n))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,this.bufferData&&!(0>=this.bufferData.length)){var a=this.program;a.use(e),this.vertexArray.bind(),a.setUniforms({u_matrix:t}),t=this.getOptions(),this.setGLState({blend:!0,blendFunc:t.blend==="lighter"?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEquation:e.FUNC_ADD}),e.drawArrays(e.LINES,0,this.bufferData.length/7)}}}]),i}(rt),zh=yi.f("species"),Ih=V(function(r){r.exports={default:zh,__esModule:!0}});tt(Ih);var ps=typeof ii!="undefined"?ii:typeof self!="undefined"?self:typeof window!="undefined"?window:{};ps.TYPED_ARRAY_SUPPORT!==void 0&&ps.TYPED_ARRAY_SUPPORT;var Kn={normal:null,road:So()},bh=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="LineLayer3D",t.initData(),t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",offset:0,blend:"normal",width:4,unit:"px",flat:!1,antialias:!1,style:"normal",dashArray:[0,0],dashOffset:0,polygonOffset:[0,0]}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[],uv:[]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),a=[];e.enablePicked&&a.push("PICK"),Kn[e.style]&&(this.isUseTexture=!0,a.push("USE_TEXTURE")),this.program=new J(this.gl,{vertexShader:`precision highp float;uniform vec4 uSelectedColor;uniform mat4 uMatrix;uniform bool uFlat;uniform bool uUnitPx;uniform vec2 uDashArray;uniform float thickness;uniform float zoomUnits;uniform float devicePixelRatio;uniform float uOffset;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aDistance;attribute float aTotalDistance;
#if defined(USE_TEXTURE)
attribute vec2 uv;
#endif
varying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vTotalDistance;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}vec3 getNormalAndWidth(vec2 currentScreen,vec2 previousScreen,vec2 nextScreen,float thickness){vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){thickness=thickness/dot(miter,perp);}}vec2 normal=vec2(-dir.y,dir.x);return vec3(normal,thickness);}void main(){vColor=aColor;vCounter=aDistance/aTotalDistance;vDashArray=uDashArray/aTotalDistance;if(uUnitPx){vDashArray*=zoomUnits;}vTotalDistance=aTotalDistance;
#if defined(USE_TEXTURE)
vUV=uv;
#endif
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
if(uFlat){float width=thickness;if(uUnitPx){width*=zoomUnits;}vec3 nw=getNormalAndWidth(position.xy,previous.xy,next.xy,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;float offsetXy=uOffset;float offsetHeight=uOffset/100.0;if(uUnitPx){offsetXy/=zoomUnits;offsetHeight*=zoomUnits;}gl_Position=uMatrix*vec4(position.xy+normal*(direction+offsetXy),position.z+offsetHeight,1.0);}else{vec4 previousProjected=uMatrix*vec4(previous,1.0);vec4 currentProjected=uMatrix*vec4(position,1.0);vec4 nextProjected=uMatrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float width=thickness*devicePixelRatio;if(!uUnitPx){width/=zoomUnits;}vec3 nw=getNormalAndWidth(currentScreen,previousScreen,nextScreen,width);width=nw.z;vec2 normal=nw.xy;vNormal=normal*direction;normal*=width/2.0;vec2 pos=currentScreen+normal*direction;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}}`,fragmentShader:`precision highp float;varying vec4 vColor;varying vec2 vNormal;varying vec2 vUV;varying vec2 vDashArray;varying float vCounter;varying float vTotalDistance;uniform bool uAntialias;uniform float uDashOffset;uniform float zoomUnits;uniform float thickness;
#if defined(USE_TEXTURE)
uniform float uTextureMargin;uniform sampler2D textureImage;
#endif
void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.8,1.0,length(vNormal));color.a*=blur;}
#if defined(USE_TEXTURE)
float segLen=uTextureMargin*zoomUnits;float textureLen=thickness*zoomUnits;float deltaX=mod(vUV.x,segLen);float middle=segLen/2.0;if(deltaX>=middle&&deltaX<=middle+textureLen){float uvx=(deltaX-middle)/textureLen;vec4 texture=texture2D(textureImage,vec2(uvx,vUV.y));color=texture.a>=0.5 ? texture : color;}
#endif
if(vDashArray.y>0.0){float offset=uDashOffset*zoomUnits/vTotalDistance;color.a*=(1.0-step(vDashArray.x,mod(vCounter+offset,vDashArray.x+vDashArray.y)));}gl_FragColor=color;}`,defines:a},this),this.prevBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),a=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:8,name:"aDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0},{stride:8,name:"aTotalDistance",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:4}],a=a.concat(this.getCommonAttributes()),Kn[e.style]&&(a.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),this.setOptions({texture:Kn[e.style]}),this.loadTexture()),this.vertexArray=new ot({gl:t,program:this.program,attributes:a})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var a=this;if(this.gl){this.initData();for(var n=t.color,s=[],o=0;o<e.length;o++){var u=[],f=e[o].geometry.coordinates;f&&0<f.length&&(u=e[o].geometry.type==="MultiPolygon"?f.reduce(function(h,d){return h.concat(d)})[0].map(function(h){return a.normizedPoint(h)}):e[o].geometry.type==="Polygon"||e[o].geometry.type==="MultiLineString"?f[0].map(function(h){return a.normizedPoint(h)}):f.map(function(h){return a.normizedPoint(h)})),f=this.getProperty("color",n,e[o]),f=this.getProperty("lineColor",n,e[o]),f=this.normizedColor(f);for(var v=this.addMultipleCoords(u),l=0;l<v.length;l++)this.processData(this.dataMgr,v[l],f);if(t.enablePicked)for(f=this.indexToRgb(o),v=0;v<u.length;v++)s.push(f[0]/255,f[1]/255,f[2]/255),s.push(f[0]/255,f[1]/255,f[2]/255),t.repeat&&(s.push(f[0]/255,f[1]/255,f[2]/255),s.push(f[0]/255,f[1]/255,f[2]/255),s.push(f[0]/255,f[1]/255,f[2]/255),s.push(f[0]/255,f[1]/255,f[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(this.dataMgr.uv)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(s))}}},{key:"processData",value:function(t,e,a){var n,s,o,u,f,v,l,h,d=e.length,c=t.position.length/6,p=Ro(e),m=p.arr,g=p.total;p=jt(m.map(function(T){return[T,g]})),m=m.map(function(T){return[T,0,T,1]});var x=jt(e.map(function(T){return-1}),!0),y=jt(e),_=jt(e.map(ui(-1))),A=jt(e.map(ui(1)));e=jt(e.map(function(T){return a})),d=Co(d,c),(n=t.uv).push.apply(n,Q($t(m))),(s=t.counter).push.apply(s,Q($t(p))),(o=t.position).push.apply(o,Q($t(y))),(u=t.prev).push.apply(u,Q($t(_))),(f=t.next).push.apply(f,Q($t(A))),(v=t.direction).push.apply(v,Q(x)),(l=t.color).push.apply(l,Q($t(e))),(h=t.index).push.apply(h,Q(d))}},{key:"render",value:function(t){var e=t.gl,a=t.matrix,n=this.dataMgr;if(n&&!(0>=n.index.length)&&this.map){var s=this.getOptions(),o=this.program;o.use(e),t=G(this.getCommonUniforms(t),{uMatrix:a,uFlat:s.flat,uUnitPx:s.unit==="px",zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio,thickness:s.width,uDashArray:s.dashArray,uDashOffset:s.dashOffset,uAntialias:s.antialias,uOffset:s.offset}),this.isUseTexture&&(t=G(t,{uTextureMargin:140,textureImage:this.texture})),o.setUniforms(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:s.blend==="lighter"?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:s.polygonOffset}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,n.index.length,e.UNSIGNED_INT,0)}}},{key:"loadTexture",value:function(t){var e=this,a=this.getOptions();a.texture?yt(this.gl,a.texture,function(n,s){e.image=s,e.texture=n,t&&t(),e.webglLayer.render()}):(this.image=this.texture=null,t&&t())}}]),i}(rt),kh=function(){function r(i){O(this,r),this.join=i.join||"miter",this.cap=i.cap||"butt",this.thickness=i.thickness||4,this.miterLimit=i.miterLimit||2*this.thickness,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],colors:[],uvs:[],startIndex:0,maxDistance:0},this._lastFlip=-1,this._started=!1,this._normal=null,this._totalDistance=0,this._colorFlag=!1,this._count=0}return z(r,[{key:"extrude",value:function(i,t,e,a){var n=this.complex;if(1>=i.length)return n;this._lastFlip=-1,this._started=!1,this._normal=null,this._totalDistance=0;for(var s=i.length,o=n.startIndex,u=null,f=1;f<s;f++){var v=u||i[f-1],l=i[f],h=f<s-1?i[f+1]:null;h&&l[0]===h[0]&&l[1]===h[1]&&l[2]===h[2]?u=v:(v=this._segment(n,o,v,l,h,t,e,a),v!==-1&&(o+=v,u=null))}return this.dash&&(n.maxDistance=Math.max(this._totalDistance,n.maxDistance)),n.startIndex=n.positions.length/7,n}},{key:"_segment",value:function(i,t,e,a,n,s,o,u){u[0]instanceof Array&&(this._colorFlag=!0);var f=0,v=q.create(),l=q.create(),h=q.create(),d=q.create(),c=i.indices,p=i.positions,m=i.normals,g=i.colors;i=i.uvs;var x=this.cap==="square",y=this.cap==="round",_=this.join==="bevel",A=this.join==="round",T=[a[0],a[1]],w=[e[0],e[1]];Lo(l,T,w);var E=0;if(this.dash&&(E=this._calcDistance(T,w),this._totalDistance+=E),this._normal||(this._normal=q.create(),li(this._normal,l)),!this._started)if(this._started=!0,x){w=q.create();var M=q.create();q.add(w,this._normal,l),q.sub(M,this._normal,l),m.push(M[0],M[1],0),m.push(w[0],w[1],0),p.push(e[0],e[1],e[2],this._totalDistance-E,s,o,0),p.push(e[0],e[1],e[2],this._totalDistance-E,-s,o,0),i.push(this._totalDistance-E,0,this._totalDistance-E,1),this._colorFlag?(g.push(u[0][0],u[0][1],u[0][2],u[0][3]),g.push(u[0][0],u[0][1],u[0][2],u[0][3])):(g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]))}else if(y){w=q.fromValues(-l[0],-l[1]),M=q.create(),q.sub(M,this._normal,l),q.normalize(M,M);var P=q.create();q.add(P,this._normal,l),q.normalize(P,P);var R=q.fromValues(this._normal[0],this._normal[1]),L=q.fromValues(-this._normal[0],-this._normal[1]);for(m.push(w[0],w[1],0),m.push(M[0],M[1],0),m.push(-P[0],-P[1],0),m.push(R[0],R[1],0),m.push(L[0],L[1],0),w=0;5>w;w++)p.push(e[0],e[1],e[2],this._totalDistance-E,s,o,0),i.push(this._totalDistance-E,0),this._colorFlag?g.push(u[0][0],u[0][1],u[0][2],u[0][3]):g.push(u[0],u[1],u[2],u[3]);c.push(t+0,t+2,t+1,t+1,t+2,t+3,t+3,t+2,t+4),f+=3,t+=3}else this._extrusions(p,m,i,g,e,this._normal,s,this._totalDistance-E,o,u,0);if(c.push.apply(c,Q(this._lastFlip===-1?[t+0,t+1,t+2]:[t+1,t+0,t+2])),n)Lo(h,[n[0],n[1]],T),this._count++,q.create(),q.add(d,l,h),q.normalize(d,d),y=q.fromValues(-d[1],d[0]),l=q.fromValues(-l[1],l[0]),l=[s/q.dot(y,l),y],l=nt(l,2),y=l[0],l=l[1],d=0<q.dot(d,this._normal)?-1:1,_||this.join!=="miter"||Math.abs(y)>this.miterLimit&&(_=!0),_?(A=Math.min(2*s,Math.abs(y)),m.push(this._normal[0],this._normal[1],0),m.push(l[0],l[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),p.push(a[0],a[1],a[2],this._totalDistance,-A*d,o,0),c.push.apply(c,Q(this._lastFlip===-d?[t+2,t+1,t+3]:[t+0,t+2,t+3])),li(v,h),q.copy(this._normal,v),m.push(this._normal[0],this._normal[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),c.push.apply(c,Q(d===1?[t+2,t+3,t+4]:[t+3,t+2,t+4])),this._flipedUV(i,this._totalDistance,d,!0),this._colorFlag?(g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3])):(g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3])),f+=3):A?(A=Math.min(2*s,Math.abs(y)),m.push(this._normal[0],this._normal[1],0),m.push(l[0],l[1],0),m.push(l[0],l[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),p.push(a[0],a[1],a[2],this._totalDistance,-A*d,o,0),c.push.apply(c,Q(this._lastFlip===-d?[t+2,t+1,t+4,t+2,t+4,t+3]:[t+0,t+2,t+4,t+2,t+3,t+4])),li(v,h),q.copy(this._normal,v),m.push(this._normal[0],this._normal[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s*d,o,0),c.push.apply(c,Q(d===1?[t+4,t+3,t+5]:[t+3,t+4,t+5])),this._flipedUV(i,this._totalDistance,d,!1),this._colorFlag?(g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3]),g.push(u[this._count][0],u[this._count][1],u[this._count][2],u[this._count][3])):(g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3])),f+=4):(this._extrusions(p,m,i,g,a,l,y,this._totalDistance,o,u,this._count),c.push.apply(c,Q(this._lastFlip===-1?[t+2,t+1,t+3]:[t+2,t+0,t+3])),d=-1,q.copy(this._normal,l),f+=2),this._lastFlip=d;else if(li(this._normal,l),v=u.length-1,x?(h=q.create(),A=q.create(),q.add(h,l,this._normal),q.sub(A,l,this._normal),m.push(h[0],h[1],0),m.push(A[0],A[1],0),p.push(a[0],a[1],a[2],this._totalDistance,s,o,0),p.push(a[0],a[1],a[2],this._totalDistance,s,o,0),i.push(this._totalDistance,0,this._totalDistance,1),this._colorFlag?(g.push(u[v][0],u[v][1],u[v][2],u[v][3]),g.push(u[v][0],u[v][1],u[v][2],u[v][3])):(g.push(u[0],u[1],u[2],u[3]),g.push(u[0],u[1],u[2],u[3]))):this._extrusions(p,m,i,g,a,this._normal,s,this._totalDistance,o,u,v),c.push.apply(c,Q(this._lastFlip===-1?[t+2,t+1,t+3]:[t+2,t+0,t+3])),f+=2,y){for(h=q.create(),q.add(h,l,this._normal),q.normalize(h,h),A=q.create(),q.sub(A,l,this._normal),q.normalize(A,A),l=q.fromValues(l[0],l[1]),m.push(h[0],h[1],0),m.push(A[0],A[1],0),m.push(l[0],l[1],0),m=0;3>m;m++)p.push(a[0],a[1],a[2],this._totalDistance,s,o,0),i.push(this._totalDistance,0),this._colorFlag?g.push(u[v][0],u[v][1],u[v][2],u[v][3]):g.push(u[0],u[1],u[2],u[3]);c.push(t+2,t+3,t+4,t+4,t+3,t+5,t+4,t+5,t+6),f+=3}return f}},{key:"_extrusions",value:function(i,t,e,a,n,s,o,u,f,v,l){t.push(s[0],s[1],0),t.push(s[0],s[1],0),i.push(n[0],n[1],n[2],u,o,f,0),i.push(n[0],n[1],n[2],u,-o,f,0),e.push(u,0,u,1),this._colorFlag?(a.push(v[l][0],v[l][1],v[l][2],v[l][3]),a.push(v[l][0],v[l][1],v[l][2],v[l][3])):(a.push(v[0],v[1],v[2],v[3]),a.push(v[0],v[1],v[2],v[3]))}},{key:"_calcDistance",value:function(i,t){return Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2))}},{key:"_flipedUV",value:function(i,t,e,a){a?e===-1?i.push(t,0,t,1,t,0):i.push(t,1,t,0,t,1):e===-1?i.push(t,0,t,0,t,1,t,0):i.push(t,1,t,1,t,0,t,1)}}]),r}(),Qn={normal:null,road:So,arrow:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},i=r.width;r=r.color;var t=Po(),e=t.canvas;return t=t.ctx,t.save(),t.moveTo(5,0),t.lineTo(32,16),t.lineTo(5,32),t.strokeStyle=r||"#fff",t.lineWidth=i||8,t.stroke(),t.restore(),e}},Jn=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="LineLayer",t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{style:"normal",styleOptions:{},color:"rgba(25, 25, 250, 1)",blend:"default",lineJoin:"miter",lineCap:"butt",unit:"px",width:4,offset:0,antialias:!1,dashArray:[0,0],dashOffset:0,animation:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0],depthTest:!0,depthWrite:!0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),a=[];e.enablePicked&&a.push("PICK"),Qn[e.style]&&(this.isUseTexture=!0,this.prevStyle=e.style,this.prevStyleOptions=e.styleOptions,a.push("USE_TEXTURE")),e.animation===!0&&(this.isAnimateLine=!0,this.date=new Date,this.autoUpdate=!0,a.push("USE_LINE_ANIMATION")),e.useDash===!0&&a.push("USE_SIMPLE_DASH"),this.program=new J(this.gl,{vertexShader:`precision highp float;uniform vec4 uSelectedColor;uniform mat4 u_matrix;uniform vec2 u_dash_array;uniform float u_zoom_units;uniform float u_zIndex;uniform bool u_unit_px;attribute vec4 a_color;attribute vec3 a_position;attribute vec3 a_normal;attribute float a_distance;attribute float a_total_distance;attribute float a_width;attribute float a_offset;
#if defined(USE_TEXTURE)
attribute vec2 uv;
#endif
varying vec4 v_color;varying vec2 v_normal;varying vec2 v_uv;varying vec2 v_dash_array;varying float v_total_distance;varying float v_counter;varying float v_width;
#if defined(USE_SIMPLE_DASH)
varying vec3 v_position;
#endif
void main(){v_width=a_width;v_color=a_color;v_counter=a_distance/a_total_distance;v_dash_array=u_dash_array/a_total_distance;if(u_unit_px){v_dash_array*=u_zoom_units;}v_total_distance=a_total_distance;v_normal=vec2(normalize(a_normal.xy)*sign(a_width));
#if defined(USE_TEXTURE)
v_uv=uv;
#endif
#if defined(PICK)
if(mapvIsPicked()){v_color=uSelectedColor;}
#endif
vec2 extrude=a_normal.xy*a_width/2.0;if(u_unit_px){extrude*=u_zoom_units;}vec2 offsetXY=a_normal.xy*-a_offset;float offsetZ=a_offset/100.0+u_zIndex;if(u_unit_px){offsetXY*=u_zoom_units;offsetZ*=u_zoom_units;}
#if defined(USE_SIMPLE_DASH)
v_position=a_position;
#endif
gl_Position=u_matrix*vec4(a_position.xy+extrude+offsetXY,a_position.z+offsetZ,1.0);}`,fragmentShader:`precision highp float;varying vec4 v_color;varying vec2 v_normal;varying vec2 v_uv;varying vec2 v_dash_array;varying float v_counter;varying float v_total_distance;varying float v_width;
#if defined(USE_SIMPLE_DASH)
varying vec3 v_position;
#endif
uniform bool u_antialias;uniform float u_dash_offset;uniform float u_zoom_units;
#if defined(USE_LINE_ANIMATION)
uniform bool u_animate;uniform float u_time;uniform float u_duration;uniform float u_interval;uniform float u_trail_length;
#endif
#if defined(USE_TEXTURE)
uniform float u_texture_width;uniform float u_texture_margin;uniform sampler2D u_sampler;
#endif
void main(){vec4 color=v_color;
#if defined(USE_SIMPLE_DASH)
if(mod(v_position.x,5.0)<3.0){discard;}
#endif
if(u_antialias){float blur=1.0;blur=1.0-smoothstep(0.8,1.0,length(v_normal));color.a*=blur;}
#if defined(USE_LINE_ANIMATION)
if(u_animate){float alpha=1.0-fract(mod(1.0-v_counter,u_interval)*(1.0/u_interval)+u_time/u_duration);alpha=(alpha+u_trail_length-1.0)/u_trail_length;color.a*=alpha;gl_FragColor=color;return;}
#endif
#if defined(USE_TEXTURE)
float margin_width=u_texture_margin*u_zoom_units;float margin_width_half=margin_width/2.0;float texture_width=u_texture_width*u_zoom_units;float delta=mod(v_uv.x,texture_width+margin_width);if(delta>=margin_width_half&&delta<=margin_width_half+texture_width){float uvx=(delta-margin_width_half)/texture_width;vec4 texture=texture2D(u_sampler,vec2(uvx,v_uv.y));color=texture.a>=0.5 ? texture : color;}
#endif
if(v_dash_array.y>0.0){float offset=u_dash_offset*u_zoom_units/v_total_distance;color.a*=(1.0-step(v_dash_array.x,mod(v_counter+offset,v_dash_array.x+v_dash_array.y)));}gl_FragColor=color;}`,defines:a},this),this.positionBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.normalBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),a=[{stride:28,name:"a_position",buffer:this.positionBuffer,size:3,type:"FLOAT",offset:0},{stride:28,name:"a_distance",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:12},{stride:28,name:"a_width",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:16},{stride:28,name:"a_offset",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:20},{stride:28,name:"a_total_distance",buffer:this.positionBuffer,size:1,type:"FLOAT",offset:24},{stride:12,name:"a_normal",buffer:this.normalBuffer,size:3,type:"FLOAT",offset:0},{stride:16,name:"a_color",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0}],a=a.concat(this.getCommonAttributes()),this.isUseTexture&&(this.uvBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),a.push({stride:8,name:"uv",buffer:this.uvBuffer,size:2,type:"FLOAT",offset:0}),e=(0,Qn[e.style])(e.styleOptions),this.setOptions({texture:e}),this.loadTexture()),this.vertexArray=new ot({gl:t,program:this.program,attributes:a})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var a=this,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if(this.gl)if(!this.isUseTexture||this.prevStyle===t.style&&Pr(this.prevStyleOptions)===Pr(t.styleOptions))this.parseData(t,e,n);else{this.prevStyle=t.style,this.prevStyleOptions=t.styleOptions;var s=(0,Qn[t.style])(t.styleOptions);this.setOptions({texture:s}),this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){a.loadTexture(function(){a.parseData(t,e,n)})},0)}}},{key:"onParseProperties",value:function(t){return this.normizedColor(t)}},{key:"parseData",value:function(t,e,a){var n=this,s=t.dashArray,o=t.width,u=t.color,f=t.offset;s=!!this.isUseTexture||!!s[1]||!!this.isAnimateLine;for(var v=new kh({dash:s,cap:t.lineCap,join:t.lineJoin,miterLimit:t.miterLimit,thickness:o}),l=[],h=function(c){var p=e[c].geometry.coordinates;p&&0<p.length&&(e[c].geometry.type==="MultiPolygon"?p=p.reduce(function(A,T){return A.concat(T)}):e[c].geometry.type==="LineString"&&(p=[p]),p=p.map(function(A){return A=A.map(function(T){return n.normizedPoint(T)}),a.closePath===!0&&A[0].toString()!==A[A.length-1].toString()&&A.push(A[0]),A}));var m=n.getProperty("color",u,e[c]);m=n.getProperty("lineColor",m,e[c]),m=n.onParseProperties(m,e[0].geometry.coordinates.length);var g=n.getProperty("width",o,e[c]);g=Number(g);var x=n.getProperty("offset",f,e[c]);x=Number(x);var y=v.complex.startIndex;p=n.addMultipleCoords(p);for(var _=0;_<p.length;_++)p[_].forEach(function(A){v.extrude(A,g,x,m)});if(t.enablePicked)for(c=n.indexToRgb(c),p=v.complex.startIndex;y<p;y++)l.push(c[0]/255,c[1]/255,c[2]/255),t.repeat&&(l.push(c[0]/255,c[1]/255,c[2]/255),l.push(c[0]/255,c[1]/255,c[2]/255))},d=0;d<e.length;d++)h(d);if(h=v.complex,s)for(d=0;d<h.positions.length/7;d++)h.positions[7*d+6]=h.maxDistance;this.lineData=h,this.positionBuffer.updateData(new Float32Array(h.positions)),this.normalBuffer.updateData(new Float32Array(h.normals)),this.colorBuffer.updateData(new Float32Array(h.colors)),this.indexBuffer.updateData(new Uint32Array(h.indices)),this.isUseTexture&&this.uvBuffer.updateData(new Float32Array(h.uvs)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(l))}},{key:"render",value:function(t){var e=t.gl,a=t.matrix,n=this.lineData;if(n&&!(0>=n.indices.length)&&this.map){var s=this.getOptions(),o=this.program;o.use(e),t=G(this.getCommonUniforms(t),{u_matrix:a,u_zoom_units:this.map.getZoomUnits(),u_dash_array:s.dashArray,u_dash_offset:s.dashOffset,u_antialias:s.antialias,u_unit_px:s.unit==="px",u_zIndex:s.zIndex}),this.isUseTexture&&(t=G(t,{u_texture_width:s.width,u_texture_margin:140,u_sampler:this.texture})),this.isAnimateLine&&(a=this.map.getZoom(),t=G(t,{u_time:(new Date-this.date)/1e3,u_animate:!!(a>=s.minZoom&&a<=s.maxZoom&&this.autoUpdate),u_duration:s.duration,u_interval:s.interval,u_trail_length:s.trailLength})),o.setUniforms(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:Zt(e,s.blend),polygonOffset:s.polygonOffset,depthTest:s.depthTest,depthMask:s.depthWrite}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,n.indices.length,e.UNSIGNED_INT,0)}}},{key:"loadTexture",value:function(t){var e=this,a=this.getOptions();a.texture?yt(this.gl,a.texture,function(n,s){e.image=s,e.texture=n,t&&t(),e.webglLayer.render()}):(this.image=this.texture=null,t&&t())}}]),i}(rt),Uh=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="LineRainbowLayer",t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{style:"normal",styleOptions:{},color:"rgba(25, 25, 250, 1)",blend:"normal",lineJoin:"miter",lineCap:"butt",unit:"px",width:4,offset:0,antialias:!1,dashArray:[0,0],dashOffset:0,animation:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0],depthTest:!0,depthWrite:!0}}},{key:"onDestroy",value:function(){this.options&&this.options.enablePicked&&(this.pickBuffer=null),this.options=this.data=this.indexBuffer=this.normalBuffer=this.colorBuffer=this.positionBuffer=this.program=this.vertexArray=null}},{key:"onParseProperties",value:function(t,e){var a=t.length;if(t instanceof Array){var n=[];if(a<e){var s=Math.floor(e/a);e%=a;for(var o=0,u=0;o<a;o++,u++)for(var f=u<e?s+1:s,v=0;v<f;v++)n.push(t[o]);t=n}for(a=[],s=0;s<t.length;s++)a.push(this.normizedColor(t[s]))}else a=this.normizedColor(t);return a}}]),i}(Jn),Nh=function(){function r(i,t){O(this,r),this.layer=i,this.gl=t,this.initData()}return z(r,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(i,t){this.initData();var e=i.color,a=i.height,n=i.gradient;i=this.gl;for(var s=0;s<t.length;s++){var o=t[s].geometry.coordinates,u=o.length;this.maxLength=u>this.maxLength?u:this.maxLength;for(var f=[],v=0;v<u;v++){var l=this.layer.normizedPoint(o[v]);f.push(l)}u=t[s].color||e,"properties"in t[s]&&"color"in t[s].properties&&(u=t[s].properties.color),n||Object.prototype.toString.call(u)!=="[object Function]"||(u=u(t[s])),o=this.layer.normizedColor(n?n[0]:u),u=this.layer.normizedColor(n?n[1]:u),v=t[s].height||a,"properties"in t[s]&&"height"in t[s].properties&&(v=t[s].properties.height),Object.prototype.toString.call(v)==="[object Function]"&&(v=v(t[s])),this.processData(this.outWall3d,f,o,u,v)}for(t=0;t<this.outWall3d.vertex.length;t++){for(e=[],a=this.outWall3d.vertex[t].length,n=0;n<a;n++)e.push.apply(e,Q(this.outWall3d.vertex[t][n]));a=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e),i.STATIC_DRAW),this.outWall3d.vertexBuffer[t]=a,i.bindBuffer(i.ARRAY_BUFFER,null),a=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[t]),i.STATIC_DRAW),this.outWall3d.indexBuffer[t]=a,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(i,t,e,a,n){var s=i.vertex[i.vertex.length-1],o=i.index[i.index.length-1],u=t.length;(!o||65536<=o.length+2*u+2)&&(s=[],o=[],i.vertex.push(s),i.index.push(o)),(i=s.length)&&o.push(i-1,i);for(var f=i=0;f<u;f++){var v=[],l=[],h=t[f];v.push(h[0],h[1]),v.push(h[2]?Number(h[2])+n:n),v.push(h[3]?Number(h[3]):f),v.push(i),v.push(e[0],e[1],e[2],e[3]),l.push(h[0],h[1]),l.push(h[2]?Number(h[2]):0),l.push(h[3]?Number(h[3]):f),l.push(i),l.push(a[0],a[1],a[2],a[3]),h=s.length,s.push(v,l),o.push(h,h+1),f<u-1&&(i+=this.getDistance(t[f],t[f+1]))}}},{key:"getDistance",value:function(i,t){return Math.sqrt(Math.pow(Math.abs(i[0]-t[0]),2)+Math.pow(Math.abs(i[1]-t[1]),2))}}]),r}(),jh=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new Nh(this,this.gl),this.program=new J(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),t.endTime===void 0&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,a=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),s=this.program;for(e.useProgram(s.program),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),e.enableVertexAttribArray(s.attributes.aPos),e.enableVertexAttribArray(s.attributes.aDistance),e.enableVertexAttribArray(s.attributes.aColor),e.uniformMatrix4fv(s.uniforms.u_matrix,!1,a),e.uniform1f(s.uniforms.currentTime,this.time),e.uniform1f(s.uniforms.trailLength,n.trailLength),a=0;a<t.vertex.length;a++)if(!(0>=t.vertex[a].length)){var o=t.vertex[a],u=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=u*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[a]),e.vertexAttribPointer(s.attributes.aPos,4,e.FLOAT,!1,o,0),e.vertexAttribPointer(s.attributes.aDistance,1,e.FLOAT,!1,o,4*u),e.vertexAttribPointer(s.attributes.aColor,4,e.FLOAT,!1,o,5*u),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[a]),e.drawElements(e.TRIANGLE_STRIP,t.index[a].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}this.time+=n.step,this.time>this.endTime&&(this.time=this.startTime)}}}]),i}(rt),ki=function(r,i,t,e){if(!(r instanceof i)||e!==void 0&&e in r)throw TypeError(t+": incorrect invocation!");return r},Ze=V(function(r){var i={},t={};r=r.exports=function(e,a,n,s,o){o=o?function(){return e}:En(e),n=Tt(n,s,a?2:1),s=0;var u,f;if(typeof o!="function")throw TypeError(e+" is not iterable!");if(o===void 0||ee.Array!==o&&fa[ha]!==o){for(s=o.call(e);!(f=s.next()).done;)if(o=la(s,n,f.value,a),o===i||o===t)return o}else for(u=fi(e.length);u>s;s++)if(o=a?n(Ft(f=e[s])[0],f[1]):n(e[s]),o===i||o===t)return o},r.BREAK=i,r.RETURN=t}),Hh=At("species"),gs=function(r,i){r=Ft(r).constructor;var t;return r===void 0||(t=Ft(r)[Hh])==null?i:Ie(t)},Xh=function(r,i,t){var e=t===void 0;switch(i.length){case 0:return e?r():r.call(t);case 1:return e?r(i[0]):r.call(t,i[0]);case 2:return e?r(i[0],i[1]):r.call(t,i[0],i[1]);case 3:return e?r(i[0],i[1],i[2]):r.call(t,i[0],i[1],i[2]);case 4:return e?r(i[0],i[1],i[2],i[3]):r.call(t,i[0],i[1],i[2],i[3])}return r.apply(t,i)},ms=$.process,qn=$.setImmediate,xs=$.clearImmediate,ys=$.MessageChannel,$n=$.Dispatch,to=0,Vr={},Gr=function(){var r=+this;if(Vr.hasOwnProperty(r)){var i=Vr[r];delete Vr[r],i()}},_s=function(r){Gr.call(r.data)};if(!qn||!xs)if(qn=function(r){for(var i=[],t=1;arguments.length>t;)i.push(arguments[t++]);return Vr[++to]=function(){Xh(typeof r=="function"?r:Function(r),i)},Kr(to),to},xs=function(r){delete Vr[r]},ze(ms)=="process")var Kr=function(r){ms.nextTick(Tt(Gr,r,1))};else if($n&&$n.now)Kr=function(r){$n.now(Tt(Gr,r,1))};else if(ys){var As=new ys,Ts=As.port2;As.port1.onmessage=_s,Kr=Tt(Ts.postMessage,Ts,1)}else $.addEventListener&&typeof postMessage=="function"&&!$.importScripts?(Kr=function(r){$.postMessage(r+"","*")},$.addEventListener("message",_s,!1)):Kr="onreadystatechange"in(vi?qe.createElement("script"):{})?function(r){fn.appendChild(vi?qe.createElement("script"):{}).onreadystatechange=function(){fn.removeChild(this),Gr.call(r)}}:function(r){setTimeout(Tt(Gr,r,1),0)};var eo=qn,ws=$.MutationObserver||$.WebKitMutationObserver,ro=$.process,io=$.Promise,Ms=ze(ro)=="process",Ui={f:function(r){return new su(r)}},Ni=function(r){try{return{e:!1,v:r()}}catch(i){return{e:!0,v:i}}},Es=$.navigator,Wh=Es&&Es.userAgent||"",no=function(r,i){if(Ft(r),Pt(i)&&i.constructor===r)return i;r=Ui.f(r);var t=r.resolve;return t(i),r.promise},oo=function(r,i,t){for(var e in i)t&&r[e]?r[e]=i[e]:se(r,e,i[e]);return r},Cs=At("species"),Rs=function(r){r=typeof it[r]=="function"?it[r]:$[r],Ht&&r&&!r[Cs]&&Ut.f(r,Cs,{configurable:!0,get:function(){return this}})},Ps=function(){var r,i,t=function(){var o;for(Ms&&(o=ro.domain)&&o.exit();r;){var u=r.fn;r=r.next;try{u()}catch(f){throw r?e():i=void 0,f}}i=void 0,o&&o.enter()};if(Ms)var e=function(){ro.nextTick(t)};else if(!ws||$.navigator&&$.navigator.standalone)if(io&&io.resolve){var a=io.resolve(void 0);e=function(){a.then(t)}}else e=function(){eo.call($,t)};else{var n=!0,s=document.createTextNode("");new ws(t).observe(s,{characterData:!0}),e=function(){s.data=n=!n}}return function(o){o={fn:o,next:void 0},i&&(i.next=o),r||(r=o,e()),i=o}}(),Ss=$.TypeError,sr=$.process,Ls=sr&&sr.versions,Yh=Ls&&Ls.v8||"",ne=$.Promise,Qr=Ei(sr)=="process",ji=function(){},Ds,Jr=Ds=Ui.f,Hi=!!function(){try{var r=ne.resolve(1),i=(r.constructor={})[At("species")]=function(t){t(ji,ji)};return(Qr||typeof PromiseRejectionEvent=="function")&&r.then(ji)instanceof i&&Yh.indexOf("6.6")!==0&&Wh.indexOf("Chrome/66")===-1}catch(t){}}(),Fs=function(r){var i;return Pt(r)&&typeof(i=r.then)=="function"?i:!1},ao=function(r,i){if(!r._n){r._n=!0;var t=r._c;Ps(function(){for(var e=r._v,a=r._s==1,n=0;t.length>n;){var s=void 0,o=void 0,u=void 0,f=t[n++],v=a?f.ok:f.fail,l=f.resolve,h=f.reject,d=f.domain;try{v?(a||(r._h==2&&Vh(r),r._h=1),v===!0?u=e:(d&&d.enter(),u=v(e),d&&(d.exit(),s=!0)),u===f.promise?h(Ss("Promise-chain cycle")):(o=Fs(u))?o.call(u,l,h):l(u)):h(e)}catch(c){d&&!s&&d.exit(),h(c)}}r._c=[],r._n=!1,i&&!r._h&&Zh(r)})}},Zh=function(r){eo.call($,function(){var i=r._v,t=r._h!==1&&(r._a||r._c).length===0,e,a;if(t){var n=Ni(function(){Qr?sr.emit("unhandledRejection",i,r):(e=$.onunhandledrejection)?e({promise:r,reason:i}):(a=$.console)&&a.error&&a.error("Unhandled promise rejection",i)});r._h=Qr||r._h!==1&&(r._a||r._c).length===0?2:1}if(r._a=void 0,t&&n.e)throw n.v})},Vh=function(r){eo.call($,function(){var i;Qr?sr.emit("rejectionHandled",r):(i=$.onrejectionhandled)&&i({promise:r,reason:r._v})})},ur=function(r){var i=this;i._d||(i._d=!0,i=i._w||i,i._v=r,i._s=2,i._a||(i._a=i._c.slice()),ao(i,!0))},so=function(r){var i=this,t;if(!i._d){i._d=!0,i=i._w||i;try{if(i===r)throw Ss("Promise can't be resolved itself");(t=Fs(r))?Ps(function(){var e={_w:i,_d:!1};try{t.call(r,Tt(so,e,1),Tt(ur,e,1))}catch(a){ur.call(e,a)}}):(i._v=r,i._s=1,ao(i,!1))}catch(e){ur.call({_w:i,_d:!1},e)}}};if(!Hi){ne=function(r){ki(this,ne,"Promise","_h"),Ie(r),uo.call(this);try{r(Tt(so,this,1),Tt(ur,this,1))}catch(i){ur.call(this,i)}};var uo=function(r){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1};uo.prototype=oo(ne.prototype,{then:function(r,i){var t=Jr(gs(this,ne));return t.ok=typeof r=="function"?r:!0,t.fail=typeof i=="function"&&i,t.domain=Qr?sr.domain:void 0,this._c.push(t),this._a&&this._a.push(t),this._s&&ao(this,!1),t.promise},catch:function(r){return this.then(void 0,r)}});var Gh=function(){var r=new uo;this.promise=r,this.resolve=Tt(so,r,1),this.reject=Tt(ur,r,1)};Ui.f=Jr=function(r){return r===ne||r===Bs?new Gh(r):Ds(r)}}N(N.G+N.W+N.F*!Hi,{Promise:ne}),be(ne,"Promise"),Rs("Promise");var Bs=it.Promise;N(N.S+N.F*!Hi,"Promise",{reject:function(r){var i=Jr(this),t=i.reject;return t(r),i.promise}}),N(N.S+1*N.F,"Promise",{resolve:function(r){return no(this===Bs?ne:this,r)}}),N(N.S+N.F*!(Hi&&da(function(r){ne.all(r).catch(ji)})),"Promise",{all:function(r){var i=this,t=Jr(i),e=t.resolve,a=t.reject,n=Ni(function(){var s=[],o=0,u=1;Ze(r,!1,function(f){var v=o++,l=!1;s.push(void 0),u++,i.resolve(f).then(function(h){l||(l=!0,s[v]=h,--u||e(s))},a)}),--u||e(s)});return n.e&&a(n.v),t.promise},race:function(r){var i=this,t=Jr(i),e=t.reject,a=Ni(function(){Ze(r,!1,function(n){i.resolve(n).then(t.resolve,e)})});return a.e&&e(a.v),t.promise}}),N(N.P+N.R,"Promise",{finally:function(r){var i=gs(this,it.Promise||$.Promise),t=typeof r=="function";return this.then(t?function(e){return no(i,r()).then(function(){return e})}:r,t?function(e){return no(i,r()).then(function(){throw e})}:r)}}),N(N.S,"Promise",{try:function(r){var i=Ui.f(this);return r=Ni(r),(r.e?i.reject:i.resolve)(r.v),i.promise}});var Kh=it.Promise,Qh=V(function(r){r.exports={default:Kh,__esModule:!0}}),De=tt(Qh),Fe=function(r,i){if(!Pt(r)||r._t!==i)throw TypeError("Incompatible receiver, "+i+" required!");return r},Jh=Ut.f,Os=_i.fastKey,qr=Ht?"_s":"size",Xi=function(r,i){var t=Os(i);if(t!=="F")return r._i[t];for(r=r._f;r;r=r.n)if(r.k==i)return r},lo={getConstructor:function(r,i,t,e){var a=r(function(n,s){ki(n,a,i,"_i"),n._t=i,n._i=Te(null),n._f=void 0,n._l=void 0,n[qr]=0,s!=null&&Ze(s,t,n[e],n)});return oo(a.prototype,{clear:function(){for(var n=Fe(this,i),s=n._i,o=n._f;o;o=o.n)o.r=!0,o.p&&(o.p=o.p.n=void 0),delete s[o.i];n._f=n._l=void 0,n[qr]=0},delete:function(n){var s=Fe(this,i);if(n=Xi(s,n)){var o=n.n,u=n.p;delete s._i[n.i],n.r=!0,u&&(u.n=o),o&&(o.p=u),s._f==n&&(s._f=o),s._l==n&&(s._l=u),s[qr]--}return!!n},forEach:function(n){Fe(this,i);for(var s=Tt(n,1<arguments.length?arguments[1]:void 0,3),o;o=o?o.n:this._f;)for(s(o.v,o.k,this);o&&o.r;)o=o.p},has:function(n){return!!Xi(Fe(this,i),n)}}),Ht&&Jh(a.prototype,"size",{get:function(){return Fe(this,i)[qr]}}),a},def:function(r,i,t){var e=Xi(r,i),a;return e?e.v=t:(r._l=e={i:a=Os(i,!0),k:i,v:t,p:i=r._l,n:void 0,r:!1},r._f||(r._f=e),i&&(i.n=e),r[qr]++,a!=="F"&&(r._i[a]=e)),r},getEntry:Xi,setStrong:function(r,i,t){pn(r,i,function(e,a){this._t=Fe(e,i),this._k=a,this._l=void 0},function(){for(var e=this._k,a=this._l;a&&a.r;)a=a.p;return this._t&&(this._l=a=a?a.n:this._t._f)?e=="keys"?we(0,a.k):e=="values"?we(0,a.v):we(0,[a.k,a.v]):(this._t=void 0,we(1))},t?"entries":"values",!t,!0),Rs(i)}},qh=At("species"),$h=function(r,i){if(_n(r)){var t=r.constructor;typeof t!="function"||t!==Array&&!_n(t.prototype)||(t=void 0),Pt(t)&&(t=t[qh],t===null&&(t=void 0))}return new(t===void 0?Array:t)(i)},tf=Ut.f,ef=function(r,i){var t=r==1,e=r==2,a=r==3,n=r==4,s=r==6,o=r==5||s,u=i||$h;return function(f,v,l){var h=Object(ye(f)),d=sn(h);v=Tt(v,l,3),l=fi(d.length);var c=0;f=t?u(f,l):e?u(f,0):void 0;for(var p,m;l>c;c++)if((o||c in d)&&(p=d[c],m=v(p,c,h),r)){if(t)f[c]=m;else if(m)switch(r){case 3:return!0;case 5:return p;case 6:return c;case 2:f.push(p)}else if(n)return!1}return s?-1:a||n?n:f}}(0);(function(r,i,t,e,a,n){var s=$[r],o=s,u=a?"set":"add",f=o&&o.prototype,v={};return Ht&&typeof o=="function"&&(n||f.forEach&&!_e(function(){new o().entries().next()}))?(o=i(function(l,h){ki(l,o,r,"_c"),l._c=new s,h!=null&&Ze(h,a,l[u],l)}),ef("add clear delete forEach get has set keys values entries toJSON".split(" "),function(l){var h=l=="add"||l=="set";l in f&&(!n||l!="clear")&&se(o.prototype,l,function(d,c){return ki(this,o,l),!h&&n&&!Pt(d)?l=="get"?void 0:!1:(d=this._c[l](d===0?0:d,c),h?this:d)})}),n||tf(o.prototype,"size",{get:function(){return this._c.size}})):(o=e.getConstructor(i,r,a,u),oo(o.prototype,t),_i.NEED=!0),be(o,r),v[r]=o,N(N.G+N.W+N.F,v),n||e.setStrong(o,r,a),o})("Map",function(r){return function(){return r(this,0<arguments.length?arguments[0]:void 0)}},{get:function(r){return(r=lo.getEntry(Fe(this,"Map"),r))&&r.v},set:function(r,i){return lo.def(Fe(this,"Map"),r===0?0:r,i)}},lo,!0),N(N.P+N.R,"Map",{toJSON:function(r){return function(){if(Ei(this)!=r)throw TypeError(r+"#toJSON isn't generic");var i=[];return Ze(this,!1,i.push,i,void 0),i}}("Map")}),function(r){N(N.S,r,{of:function(){for(var i=arguments.length,t=Array(i);i--;)t[i]=arguments[i];return new this(t)}})}("Map"),function(r){N(N.S,r,{from:function(i,t,e){var a;if(Ie(this),(a=t!==void 0)&&Ie(t),i==null)return new this;var n=[];if(a){var s=0,o=Tt(t,e,2);Ze(i,!1,function(u){n.push(o(u,s++))})}else Ze(i,!1,n.push,n);return new this(n)}})}("Map");var rf=it.Map,nf=V(function(r){r.exports={default:rf,__esModule:!0}}),Be=tt(nf),of=V(function(r,i){i.__esModule=!0;var t=ue&&ue.__esModule?ue:{default:ue};i.default=function(e,a,n){return a in e?(0,t.default)(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}}),lr=tt(of),$r,ti,af=($r={},lr($r,1,1),lr($r,2,1),lr($r,3,1),$r),sf=(ti={},lr(ti,1,1),lr(ti,2,1),lr(ti,3,1),ti),Ve=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.vertCount=0,t.bufferMap={},t.bufferData=[],t.autoUpdate=!0,e=t.canvas=document.createElement("canvas"),t.ctx=e.getContext("2d"),t.iconHash=new Be,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:[1,1,1,.8],speed:1,size:5,pointFade:!0,pointFadeBuffer:1,minLineLength:2,animationType:2,shapeType:2,depthTest:!1,delay:0,unit:"px",padding:0}}},{key:"initialize",value:function(t){this.gl=t,this.texture=null,this.isUseTexture=!1;var e=this.getOptions();this.updateUniformsFromOptions(e),this.program=new J(this.gl,{vertexShader:"precision highp float;attribute vec3 aPos;attribute vec3 aNextPos;attribute vec4 aColor;attribute float aIndex;attribute float aNextIndex;attribute float aLength;attribute float aSpeed;attribute float aDelay;attribute vec3 aUV;uniform float uSize;uniform mat4 u_matrix;uniform float uOriginSpeed;uniform float uElapsedSteps;uniform int uAnimationType;uniform int uPointFade;uniform float uPointFadeBuffer;uniform float uZoomUnits;varying float vAddOpacity;varying vec3 vUV;varying vec4 vColor;void main(){vColor=aColor;if(uAnimationType==1){if(abs(aIndex-mod(uElapsedSteps,aLength))>.1){gl_Position=vec4(-2.,-2.,0,1.0);return;}gl_Position=u_matrix*vec4(aPos.xyz,1.0);vAddOpacity=1.;}else if(uAnimationType==2){float lineLength=aLength-1.;float cIndex=mod(uElapsedSteps,lineLength);float rest=cIndex-aIndex;if(rest<1.&&rest>=0.){if(uPointFade==1){if(cIndex<uPointFadeBuffer){vAddOpacity=cIndex/uPointFadeBuffer;}else if(cIndex>lineLength-uPointFadeBuffer){vAddOpacity=(lineLength-cIndex)/uPointFadeBuffer;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}else if(uAnimationType==3){float speedRatio=aSpeed/uOriginSpeed;float percent=mod(mod(uElapsedSteps*aSpeed,aLength)/aLength-aDelay,1.0);if(percent<=aNextIndex&&percent>=aIndex){if(uPointFade==1){float fadePercent=uPointFadeBuffer*1000./aLength;if(percent<fadePercent){vAddOpacity=percent/fadePercent;}else if(percent>1.-fadePercent){vAddOpacity=(1.-percent)/fadePercent;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}float rest=(percent-aIndex)/(aNextIndex-aIndex);gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}vUV=aUV;gl_PointSize=uSize/uZoomUnits;}",fragmentShader:"precision highp float;uniform int ushapeType;uniform bool uUseTexture;uniform sampler2D uSampler;varying float vAddOpacity;varying vec4 vColor;varying vec3 vUV;void main(){if(ushapeType==2){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(vColor.rgb,vColor.a*vAddOpacity);}else if(ushapeType==3){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(vColor.rgb,vColor.a*smoothstep(1.0,0.0,d*2.)*vAddOpacity);}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vAddOpacity);}if(uUseTexture){float ratio=vUV.z;vec2 uv=vUV.xy;gl_FragColor=texture2D(uSampler,vec2(gl_PointCoord.x*ratio+uv.x,1.0-(uv.y+gl_PointCoord.y*ratio)));}}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"bindAttributeBufferData",value:function(t,e,a,n){var s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),a=new Float32Array(a),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),this.bufferMap[e]={buffer:s,data:a,elementSize:n}}},{key:"onChanged",value:function(t,e){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};this.gl&&(Array.isArray(e)||(e=[]),this.processCache(t,e,a))}},{key:"processCache",value:function(t,e,a){var n=this;this.cachedData=[];for(var s=t.icon,o=t.speed,u=t.color,f=0;f<e.length;f++){var v=e[f].geometry.coordinates,l=this.getProperty("color",u,e[f]);l=this.normizedColor(l);var h=this.getProperty("icon",s,e[f]),d=this.getProperty("speed",o,e[f]),c=this.getProperty("delay",0,e[f]);v&&(this.cachedData.push({coordinates:v,color:l,icon:h,speed:d,delay:c}),this.iconHash.get(h)||this.iconHash.set(h,h))}e=Ci(this.iconHash.entries()).filter(function(p){return typeof p[1]=="string"}).map(function(p){var m=nt(p,2)[0];return new De(function(g,x){n.url2canvas(m,function(y){n.iconHash.set(m,y),g()})})}),De.all(e).then(function(p){n.buildSprite(t),a.autoRender!==!1&&n.webglLayer&&n.webglLayer.render()})}},{key:"buildSprite",value:function(t){var e=t.padding,a=this.canvas,n=this.ctx,s=0,o=[],u=new Be;if(t.icon){s=!0;var f=!1,v=void 0;try{for(var l=er(this.iconHash),h;!(s=(h=l.next()).done);s=!0){var d=nt(h.value,2),c=d[1];if(typeof c!="string"){var p=c.width,m=p+e;o.push({w:m,h:m,width:p,key:d[0],icon:c})}}}catch(g){f=!0,v=g}finally{try{!s&&l.return&&l.return()}finally{if(f)throw v}}for(l=xe(o),h=0;h<o.length;h++)d=o[h],u.get(d.key)||u.set(d.key,d);for(s=Math.max(oe(l.w),oe(l.h)),a.width=s||1,a.height=s||1,n.save(),a=0;a<o.length;a++)l=o[a],n.drawImage(l.icon,l.x+e,l.y+e,l.width,l.width);n.restore()}this.loadTexture(),this.buildVertex(t,u,s)}},{key:"buildVertex",value:function(t,e,a){var n=this.gl;this.updateUniformsFromOptions(t);for(var s=[],o=[],u=[],f=[],v=[],l=[],h=[],d=[],c=[],p=t.minLineLength,m=0;m<this.cachedData.length;m++){var g=this.cachedData[m],x=g.coordinates,y=g.icon,_=g.speed,A=g.delay;g=g.color;var T=x.length,w=[];if(!(T<p)){for(t.icon&&(w=(w=e.get(y))?[w.x/a,w.y/a,w.w/a]:[0,0,0]),y=0;y<T;++y){var E=this.normizedPoint(x[y]);s.push(E[0]),s.push(E[1]),s.push(E[2]||0),o.push.apply(o,Q(g)),c.push.apply(c,Q(w)),this.animationType!==3&&(u.push(y),v.push(T))}if(this.animationType!==1){for(w=s.length-3*T+3,T=s.length,x=w;x<T;++x)l.push(s[x]);if(s.splice(T-3,3),c.splice(T-3,2),o.splice(T-3,4),this.animationType===2)u.pop(),v.pop();else if(this.animationType===3){for(w-=3,T=s.length-3,x=0,g=[],y=w;y<=T;y+=3)w=Math.sqrt(Math.pow(l[y]-s[y],2)+Math.pow(l[y+1]-s[y+1],2)+Math.pow(l[y+2]-s[y+2],2)),x+=w,g.push(w);for(u.push(0),h.push(_),A/=x/_,d.push(A),y=T=0,E=g.length-1;y<E;++y)T+=g[y],w=T/x,u.push(w),f.push(w),v.push(x),h.push(_),d.push(A);f.push(1),v.push(x)}}}}this.bindAttributeBufferData(n,"aPos",s,3),this.bindAttributeBufferData(n,"aIndex",u,1),this.bindAttributeBufferData(n,"aLength",v,1),this.bindAttributeBufferData(n,"aColor",o,4),this.animationType!==1&&(this.bindAttributeBufferData(n,"aNextPos",l,3),this.animationType===3&&(this.bindAttributeBufferData(n,"aNextIndex",f,1),this.bindAttributeBufferData(n,"aSpeed",h,1),this.bindAttributeBufferData(n,"aDelay",d,1))),t.icon&&this.bindAttributeBufferData(n,"aUV",c,3),this.vertCount=s.length/3}},{key:"updateUniformsFromOptions",value:function(t){this.startTime=new Date().getTime(),af[t.animationType]||(t.animationType=2),sf[t.shapeType]||(t.shapeType=2),(isNaN(t.minLineLength)||2>t.minLineLength)&&(t.minLineLength=2),this.animationType=t.animationType}},{key:"renderAttributeArr",value:function(t,e,a){if(e.attributes[a]!==void 0){var n=this.bufferMap[a];n&&(t.bindBuffer(t.ARRAY_BUFFER,n.buffer),t.enableVertexAttribArray(e.attributes[a]),t.vertexAttribPointer(e.attributes[a],n.elementSize,t.FLOAT,!1,n.data.BYTES_PER_ELEMENT*n.elementSize,0))}}},{key:"render",value:function(t){var e=t.gl;if(t=t.matrix,!(0>=this.vertCount)){var a=this.getOptions(),n=this.program;e.useProgram(n.program),this.renderAttributeArr(e,n,"aPos"),this.renderAttributeArr(e,n,"aIndex"),this.renderAttributeArr(e,n,"aLength"),this.renderAttributeArr(e,n,"aColor"),this.animationType!==1&&(this.renderAttributeArr(e,n,"aNextPos"),this.animationType===3&&(this.renderAttributeArr(e,n,"aNextIndex"),this.renderAttributeArr(e,n,"aSpeed"),this.renderAttributeArr(e,n,"aDelay"))),a.icon&&this.texture&&(this.renderAttributeArr(e,n,"aUV"),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(n.uniforms.uSampler,0)),e.uniform1i(n.uniforms.uUseTexture,this.isUseTexture);var s=new Date().getTime()-this.startTime;s<this.options.delay?s=0:(s-=this.options.delay,s=this.animationType===1?Math.round(s/1e3*this.options.speed*20):this.animationType===3?s/1e3*this.options.speed*1e3:s/1e3*this.options.speed);var o=this.options.size;if(Array.isArray(o)){var u=this.map.map.getMaxZoom(),f=this.map.map.getMinZoom();o=o[0]+(this.map.getZoom()-f)/(u-f)*(o[1]-o[0])}e.uniformMatrix4fv(n.uniforms.u_matrix,!1,t),e.uniform1f(n.uniforms.uSize,o),e.uniform1f(n.uniforms.uElapsedSteps,s),e.uniform1f(n.uniforms.uOriginSpeed,this.options.speed),e.uniform1i(n.uniforms.uAnimationType,this.animationType),e.uniform1i(n.uniforms.ushapeType,this.options.shapeType),e.uniform1i(n.uniforms.uPointFade,this.options.pointFade?1:0),e.uniform1f(n.uniforms.uPointFadeBuffer,this.options.pointFadeBuffer),e.uniform1f(n.uniforms.uZoomUnits,this.options.unit==="m"?this.map.getZoomUnits():1),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:a.blend==="lighter"?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],depthTest:!!a.depthTest}),e.drawArrays(e.POINTS,0,this.vertCount)}}},{key:"url2canvas",value:function(t,e){if((typeof t=="undefined"?"undefined":It(t))==="object")e(t);else{var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var n=document.createElement("canvas");n.width=128,n.height=128,n.getContext("2d").drawImage(a,0,0,128,128),e(n)},a.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas&&this.getOptions().icon?yt(this.gl,this.canvas,function(e){t.isUseTexture=!0,t.texture=e}):(this.isUseTexture=!1,this.texture=null)}}]),i}(rt);Ve.ANIMATION_TYPE_LEAP=1,Ve.ANIMATION_TYPE_SMOOTH=2,Ve.ANIMATION_TYPE_UNIFORM_SPEED=3,Ve.SHAPE_TYPE_SQUARE=1,Ve.SHAPE_TYPE_CIRCLE=2,Ve.SHAPE_TYPE_CIRCLE_GRADIENT=3;var uf=function(){function r(i,t){O(this,r),this.layer=i,this.gl=t,this.initData()}return z(r,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(i,t){this.initData();for(var e=i.color,a=i.height,n=i.gradient,s=i.enablePreciseMap,o=i.repeatMap,u=i.closePath,f=this.gl,v=0;v<t.length;v++){var l=t[v],h=l.color||e;"properties"in l&&"color"in l.properties&&(h=l.properties.color),n||Object.prototype.toString.call(h)!=="[object Function]"||(h=h(l));var d=this.layer.normizedColor(n?n[0]:h);h=this.layer.normizedColor(n?n[1]:h);var c=l.height||a;if("properties"in l&&"height"in l.properties&&(c=l.properties.height),Object.prototype.toString.call(c)==="[object Function]"&&(c=c(l)),l.geometry.type==="MultiLineString"||l.geometry.type==="Polygon")for(var p=0;p<l.geometry.coordinates.length;p++){var m=l.geometry.coordinates[p];u&&!Gi(m)&&m.push(m[0]);for(var g=[],x=[],y=0,_=0;_<m.length;_++){var A=this.layer.normizedPoint(m[_]);if(0<_&&(s||o)){var T=this.layer.normizedPoint(m[_-1]);y+=Math.sqrt(Math.pow(A[0]-T[0],2)+Math.pow(A[1]-T[1],2))}g.push(A),x.push(y)}this.processData(this.outWall3d,i,g,x,d,h,c)}else{for(l=l.geometry.coordinates,u&&!Gi(l)&&l.push(l[0]),p=[],m=[],x=g=0;x<l.length;x++)y=this.layer.normizedPoint(l[x]),0<x&&(s||o)&&(_=this.layer.normizedPoint(l[x-1]),g+=Math.sqrt(Math.pow(y[0]-_[0],2)+Math.pow(y[1]-_[1],2))),p.push(y),m.push(g);this.processData(this.outWall3d,i,p,m,d,h,c)}}for(i=0;i<this.outWall3d.vertex.length;i++){for(t=[],e=this.outWall3d.vertex[i].length,a=0;a<e;a++)t.push.apply(t,Q(this.outWall3d.vertex[i][a]));e=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,e),f.bufferData(f.ARRAY_BUFFER,new Float32Array(t),f.STATIC_DRAW),this.outWall3d.vertexBuffer[i]=e,f.bindBuffer(f.ARRAY_BUFFER,null),e=f.createBuffer(),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,e),f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[i]),f.STATIC_DRAW),this.outWall3d.indexBuffer[i]=e,f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(i,t,e,a,n,s,o){var u=a[a.length-1],f=i.vertex[i.vertex.length-1],v=i.index[i.index.length-1],l=e.length;for((!v||65536<=v.length+2*l+2)&&(f=[],v=[],i.vertex.push(f),i.index.push(v)),(i=f.length)&&v.push(i-1,i),i=0;i<l;i++){var h=[],d=[],c=e[i];h.push(c[0],c[1],c[2]+o),h.push(n[0],n[1],n[2],n[3]),d.push(c[0],c[1],c[2]),d.push(s[0],s[1],s[2],s[3]),t.texture&&(c=a[i],t.enablePreciseMap||t.repeatMap?(h.push(c,1,u),d.push(c,0,u)):(h.push(i,1,l-1),d.push(i,0,l-1))),c=f.length,f.push(h,d),v.push(c,c+1)}}}]),r}(),lf=function(r){function i(t,e){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t,e))}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,repeatMap:0,height:100,closePath:!1,color:[1,1,1,1]}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new uf(this,this.gl),this.texture=null,this.isUseTexture=!1,this.vertexLength=10,this.program=new J(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;attribute float aTotalDistance;varying vec2 vTextureCoords;varying float vTotalDistance;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;vTotalDistance=aTotalDistance;}gl_Position=u_matrix*vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform bool uUseTexture;uniform float uDistance;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying float vTotalDistance;varying vec4 vColor;void main(){if(uUseTexture){float uvx=vTextureCoords.x/vTotalDistance;if(uDistance>0.0){uvx=mod(vTextureCoords.x,uDistance)/uDistance;}gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vec2(uvx,vTextureCoords.y));}else{gl_FragColor=vColor;}}"}),this.loadTexture()}},{key:"onChanged",value:function(t,e){var a=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){a.loadTexture(function(){a.dataMgr.onLayerChange(t,e),a.webglLayer.render()})},0))}},{key:"render",value:function(t){var e=t.gl,a=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),s=this.program;if(e.useProgram(s.program),n.texture){if(!this.texture)return;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniform1i(s.uniforms.uSampler,0)}for(this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],depthMask:!!n.texture,depthFunc:n.texture?e.LESS:e.LEQUAL}),n.texture?e.enableVertexAttribArray(s.attributes.aTextureCoords):e.disableVertexAttribArray(s.attributes.aTextureCoords),e.enableVertexAttribArray(s.attributes.aPos),e.enableVertexAttribArray(s.attributes.aColor),e.uniformMatrix4fv(s.uniforms.u_matrix,!1,a),e.uniform1i(s.uniforms.uUseTexture,this.isUseTexture),e.uniform1f(s.uniforms.uDistance,n.repeatMap),a=0;a<t.vertex.length;a++)if(!(0>=t.vertex[a].length)){var o=t.vertex[a],u=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=u*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[a]),e.vertexAttribPointer(s.attributes.aPos,3,e.FLOAT,!1,o,0),e.vertexAttribPointer(s.attributes.aColor,4,e.FLOAT,!1,o,3*u),n.texture&&(e.vertexAttribPointer(s.attributes.aTextureCoords,2,e.FLOAT,!1,o,7*u),e.vertexAttribPointer(s.attributes.aTotalDistance,1,e.FLOAT,!1,o,9*u)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[a]),e.drawElements(e.TRIANGLE_STRIP,t.index[a].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}}},{key:"loadTexture",value:function(t){var e=this,a=this.getOptions();a.texture?(this.isUseTexture=!0,yt(this.gl,a.texture,function(n,s){e.image=s,e.texture=n,t&&t(),e.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,t&&t())}}]),i}(rt),hf=function(){function r(i,t){O(this,r),this.layer=i,this.gl=t,this.initData()}return z(r,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]},this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(i,t){this.initData();var e=i.color,a=i.height,n=i.gradient;i=this.gl;for(var s=0;s<t.length;s++){var o=t[s].geometry.coordinates,u=o.length;this.maxLength=u>this.maxLength?u:this.maxLength;for(var f=[],v=0;v<u;v++){var l=this.layer.normizedPoint(o[v]);f.push(l)}u=t[s].color||e,"properties"in t[s]&&"color"in t[s].properties&&(u=t[s].properties.color),n||Object.prototype.toString.call(u)!=="[object Function]"||(u=u(t[s])),o=this.layer.normizedColor(n?n[0]:u),u=this.layer.normizedColor(n?n[1]:u),v=t[s].height||a,"properties"in t[s]&&"height"in t[s].properties&&(v=t[s].properties.height),Object.prototype.toString.call(v)==="[object Function]"&&(v=v(t[s])),this.processData(this.outWall3d,f,o,u,v)}for(t=0;t<this.outWall3d.vertex.length;t++){for(e=[],a=this.outWall3d.vertex[t].length,n=0;n<a;n++)e.push.apply(e,Q(this.outWall3d.vertex[t][n]));a=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e),i.STATIC_DRAW),this.outWall3d.vertexBuffer[t]=a,i.bindBuffer(i.ARRAY_BUFFER,null),a=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[t]),i.STATIC_DRAW),this.outWall3d.indexBuffer[t]=a,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(i,t,e,a,n){var s=i.vertex[i.vertex.length-1],o=i.index[i.index.length-1],u=t.length;for((!o||65536<=o.length+2*u+2)&&(s=[],o=[],i.vertex.push(s),i.index.push(o)),(i=s.length)&&o.push(i-1,i),i=0;i<u;i++){var f=[],v=[],l=t[i];f.push(l[0],l[1]),f.push(l[2]?Number(l[2])+n:n),f.push(l[3]?Number(l[3]):i),f.push(e[0],e[1],e[2],e[3]),v.push(l[0],l[1]),v.push(l[2]?Number(l[2]):0),v.push(l[3]?Number(l[3]):i),v.push(a[0],a[1],a[2],a[3]),l=s.length,s.push(f,v),o.push(l,l+1)}}}]),r}(),ff=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.dataMgr=new hf(this,this.gl),this.program=new J(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},{key:"onChanged",value:function(t,e){this.gl&&(this.dataMgr.onLayerChange(t,e),t.endTime===void 0&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(t){var e=t.gl,a=t.matrix;if((t=this.dataMgr.getData())&&!(0>=t.vertex.length)){var n=this.getOptions(),s=this.program;for(e.useProgram(s.program),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),e.enableVertexAttribArray(s.attributes.aPos),e.enableVertexAttribArray(s.attributes.aColor),e.uniformMatrix4fv(s.uniforms.u_matrix,!1,a),e.uniform1f(s.uniforms.currentTime,this.time),e.uniform1f(s.uniforms.trailLength,n.trailLength),a=0;a<t.vertex.length;a++)if(!(0>=t.vertex[a].length)){var o=t.vertex[a],u=new Float32Array(o[0]).BYTES_PER_ELEMENT;o=u*o[0].length,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer[a]),e.vertexAttribPointer(s.attributes.aPos,4,e.FLOAT,!1,o,0),e.vertexAttribPointer(s.attributes.aColor,4,e.FLOAT,!1,o,4*u),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer[a]),e.drawElements(e.TRIANGLE_STRIP,t.index[a].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}this.time+=n.step,this.time>this.endTime&&(this.time=this.startTime)}}}]),i}(rt),cf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.simpleLineLayer=new vs(t.getHeatOptions()),t.children=[t.simpleLineLayer],t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(t){this.simpleLineLayer.setData(t)}},{key:"onOptionsChanged",value:function(t){this.simpleLineLayer.setOptions(this.getHeatOptions())}},{key:"getHeatOptions",value:function(){var t=this.getOptions(),e=t.max,a=t.min;e===void 0&&(a=this.getDataRange(),e=a.max,a=a.min);var n=new Rt({max:e,min:a,gradient:t.gradient});return t.color=function(s){var o=~~s.count||1;return"properties"in s&&"count"in s.properties&&(o=~~s.properties.count),s=n.getImageData(o),[s[0]/255,s[1]/255,s[2]/255,s[3]/255]},t}},{key:"getDataRange",value:function(){var t=this.getData(),e=0,a=0;t[0]&&(e=~~t[0].count||1,a=~~t[0].count||1),"properties"in t[0]&&"count"in t[0].properties&&(e=~~t[0].properties.count,a=~~t[0].properties.count);for(var n=t.length,s=0;s<n;s++){var o=~~t[s].count||1;"properties"in t[s]&&"count"in t[s].properties&&(o=~~t[s].properties.count),e=Math.max(o,e),a=Math.min(o,a)}return{max:e/2,min:a}}}]),i}(ve),zs=V(function(r,i){(function(t,e){r.exports=e()})(Do,function(){function t(x,y,_,A,T,w){if(!(T-A<=_)){var E=A+T>>1;e(x,y,E,A,T,w%2),t(x,y,_,A,E-1,w+1),t(x,y,_,E+1,T,w+1)}}function e(x,y,_,A,T,w){for(;T>A;){if(600<T-A){var E=T-A+1,M=_-A+1,P=Math.log(E),R=.5*Math.exp(2*P/3);P=.5*Math.sqrt(P*R*(E-R)/E)*(0>M-E/2?-1:1),e(x,y,_,Math.max(A,Math.floor(_-M*R/E+P)),Math.min(T,Math.floor(_+(E-M)*R/E+P)),w)}for(E=y[2*_+w],M=A,R=T,a(x,y,A,_),y[2*T+w]>E&&a(x,y,A,T);M<R;){for(a(x,y,M,R),M++,R--;y[2*M+w]<E;)M++;for(;y[2*R+w]>E;)R--}y[2*A+w]===E?a(x,y,A,R):(R++,a(x,y,R,T)),R<=_&&(A=R+1),_<=R&&(T=R-1)}}function a(x,y,_,A){n(x,_,A),n(y,2*_,2*A),n(y,2*_+1,2*A+1)}function n(x,y,_){var A=x[y];x[y]=x[_],x[_]=A}function s(x,y){return x=x.geometry.coordinates,{x:x[0]/360+.5,y:f(x[1]),zoom:1/0,index:y,parentId:-1}}function o(x){var y=x.id,_=u(x);return{type:"Feature",id:y,properties:_,geometry:{type:"Point",coordinates:[360*(x.x-.5),360*Math.atan(Math.exp((180-360*x.y)*Math.PI/180))/Math.PI-90]}}}function u(x){var y=x.numPoints,_=1e4<=y?Math.round(y/1e3)+"k":1e3<=y?Math.round(y/100)/10+"k":y;return v(v({},x.properties),{cluster:!0,cluster_id:x.id,point_count:y,point_count_abbreviated:_})}function f(x){return x=Math.sin(x*Math.PI/180),x=.5-.25*Math.log((1+x)/(1-x))/Math.PI,0>x?0:1<x?1:x}function v(x,y){for(var _ in y)x[_]=y[_];return x}function l(x){return x.x}function h(x){return x.y}var d=function(x){return x[0]},c=function(x){return x[1]},p=function(x,y,_,A,T){y===void 0&&(y=d),_===void 0&&(_=c),A===void 0&&(A=64),T===void 0&&(T=Float64Array),this.nodeSize=A,this.points=x;var w=this.ids=new(65536>x.length?Uint16Array:Uint32Array)(x.length);T=this.coords=new T(2*x.length);for(var E=0;E<x.length;E++)w[E]=E,T[2*E]=y(x[E]),T[2*E+1]=_(x[E]);t(w,T,A,0,w.length-1,0)};p.prototype.range=function(x,y,_,A){for(var T=this.ids,w=this.coords,E=this.nodeSize,M=[0,T.length-1,0],P=[],R,L;M.length;){var S=M.pop(),k=M.pop(),H=M.pop();if(k-H<=E)for(S=H;S<=k;S++)R=w[2*S],L=w[2*S+1],R>=x&&R<=_&&L>=y&&L<=A&&P.push(T[S]);else{var C=Math.floor((H+k)/2);R=w[2*C],L=w[2*C+1],R>=x&&R<=_&&L>=y&&L<=A&&P.push(T[C]);var F=(S+1)%2;(S===0?x<=R:y<=L)&&(M.push(H),M.push(C-1),M.push(F)),(S===0?_>=R:A>=L)&&(M.push(C+1),M.push(k),M.push(F))}}return P},p.prototype.within=function(x,y,_){for(var A=this.ids,T=this.coords,w=this.nodeSize,E=[0,A.length-1,0],M=[],P=_*_;E.length;){var R=E.pop(),L=E.pop(),S=E.pop();if(L-S<=w)for(R=S;R<=L;R++){S=T[2*R]-x;var k=T[2*R+1]-y;S*S+k*k<=P&&M.push(A[R])}else{k=Math.floor((S+L)/2);var H=T[2*k],C=T[2*k+1],F=H-x,Z=C-y;F*F+Z*Z<=P&&M.push(A[k]),F=(R+1)%2,(R===0?x-_<=H:y-_<=C)&&(E.push(S),E.push(k-1),E.push(F)),(R===0?x+_>=H:y+_>=C)&&(E.push(k+1),E.push(L),E.push(F))}}return M};var m={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(x){return x}},g=function(x){this.options=v(al(m),x),this.trees=Array(this.options.maxZoom+1)};return g.prototype.load=function(x){var y=this.options,_=y.minZoom,A=y.maxZoom;y=y.nodeSize,this.points=x;for(var T=[],w=0;w<x.length;w++)x[w].geometry&&T.push(s(x[w],w));for(this.trees[A+1]=new p(T,l,h,y,Float32Array),x=A;x>=_;x--)T=this._cluster(T,x),this.trees[x]=new p(T,l,h,y,Float32Array);return this},g.prototype.getClusters=function(x,y){var _=((x[0]+180)%360+360)%360-180,A=Math.max(-90,Math.min(90,x[1])),T=x[2]===180?180:((x[2]+180)%360+360)%360-180,w=Math.max(-90,Math.min(90,x[3]));if(360<=x[2]-x[0])_=-180,T=180;else if(_>T)return _=this.getClusters([_,A,180,w],y),A=this.getClusters([-180,A,T,w],y),_.concat(A);y=this.trees[this._limitZoom(y)],x=[];var E=0;for(A=y.range(_/360+.5,f(w),T/360+.5,f(A));E<A.length;E+=1)T=y.points[A[E]],x.push(T.numPoints?o(T):this.points[T.index]);return x},g.prototype.getChildren=function(x){var y=this._getOriginId(x),_=this._getOriginZoom(x),A=this.trees[_];if(!A)throw Error("No cluster with the specified id.");var T=A.points[y];if(!T)throw Error("No cluster with the specified id.");y=[];var w=0;for(_=A.within(T.x,T.y,this.options.radius/(this.options.extent*Math.pow(2,_-1)));w<_.length;w+=1)T=A.points[_[w]],T.parentId===x&&y.push(T.numPoints?o(T):this.points[T.index]);if(y.length===0)throw Error("No cluster with the specified id.");return y},g.prototype.getLeaves=function(x,y,_){var A=[];return this._appendLeaves(A,x,y||10,_||0,0),A},g.prototype.getTile=function(x,y,_){var A=this.trees[this._limitZoom(x)];x=Math.pow(2,x);var T=this.options;T=T.radius/T.extent;var w=(_-T)/x,E=(_+1+T)/x,M={features:[]};return this._addTileFeatures(A.range((y-T)/x,w,(y+1+T)/x,E),A.points,y,_,x,M),y===0&&this._addTileFeatures(A.range(1-T/x,w,1,E),A.points,x,_,x,M),y===x-1&&this._addTileFeatures(A.range(0,w,T/x,E),A.points,-1,_,x,M),M.features.length?M:null},g.prototype.getClusterExpansionZoom=function(x){for(var y=this._getOriginZoom(x)-1;y<=this.options.maxZoom&&(x=this.getChildren(x),y++,x.length===1);)x=x[0].properties.cluster_id;return y},g.prototype._appendLeaves=function(x,y,_,A,T){var w=0;for(y=this.getChildren(y);w<y.length;w+=1){var E=y[w],M=E.properties;if(M&&M.cluster?T=T+M.point_count<=A?T+M.point_count:this._appendLeaves(x,M.cluster_id,_,A,T):T<A?T++:x.push(E),x.length===_)break}return T},g.prototype._addTileFeatures=function(x,y,_,A,T,w){for(var E=0;E<x.length;E+=1){var M=y[x[E]],P=M.numPoints,R={type:1,geometry:[[Math.round(this.options.extent*(M.x*T-_)),Math.round(this.options.extent*(M.y*T-A))]],tags:P?u(M):this.points[M.index].properties},L=void 0;P?L=M.id:this.options.generateId?L=M.index:this.points[M.index].id&&(L=this.points[M.index].id),L!==void 0&&(R.id=L),w.features.push(R)}},g.prototype._limitZoom=function(x){return Math.max(this.options.minZoom,Math.min(+x,this.options.maxZoom+1))},g.prototype._cluster=function(x,y){var _=[],A=this.options,T=A.reduce,w=A.minPoints;A=A.radius/(A.extent*Math.pow(2,y));for(var E=0;E<x.length;E++){var M=x[E];if(!(M.zoom<=y)){M.zoom=y;for(var P=this.trees[y+1],R=P.within(M.x,M.y,A),L=M.numPoints||1,S=L,k=0,H=R;k<H.length;k+=1){var C=P.points[H[k]];C.zoom>y&&(S+=C.numPoints||1)}if(S>=w){k=M.x*L,H=M.y*L,L=T&&1<L?this._map(M,!0):null,C=(E<<5)+(y+1)+this.points.length;for(var F=0;F<R.length;F+=1){var Z=P.points[R[F]];if(!(Z.zoom<=y)){Z.zoom=y;var Y=Z.numPoints||1;k+=Z.x*Y,H+=Z.y*Y,Z.parentId=C,T&&(L||(L=this._map(M,!0)),T(L,this._map(Z)))}}M.parentId=C,_.push({x:k/S,y:H/S,zoom:1/0,id:C,parentId:-1,numPoints:S,properties:L})}else if(_.push(M),1<S)for(M=0,S=R;M<S.length;M+=1)R=P.points[S[M]],R.zoom<=y||(R.zoom=y,_.push(R))}}return _},g.prototype._getOriginId=function(x){return x-this.points.length>>5},g.prototype._getOriginZoom=function(x){return(x-this.points.length)%32},g.prototype._map=function(x,y){if(x.numPoints)return y?v({},x.properties):x.properties;x=this.points[x.index].properties;var _=this.options.map(x);return y&&_===x?v({},_):_},g})}),df=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.shapeLayer=new bi(t.options),t.textLayer=new Zr(t.options.textOptions),t.children=[t.shapeLayer,t.textLayer],t.max=[],t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{size:50,height:0,maxZoom:19,minZoom:5,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},enableCluster:!1,showText:!0,textOptions:{fontSize:13,color:"white"}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},e=this.options.textOptions;t.textOptions&&G(e,t.textOptions);var a=t.minZoom,n=t.maxZoom,s=t.size;a=n&&n!==this.options.maxZoom||a&&a!==this.options.minZoom||s&&s!==this.options.size,G(this.options,t,{textOptions:e}),a?this.onChanged(this.options,this.data):this.refreshLayer(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,e){if(e&&e.length){this.zoom=Math.floor(this.map.getZoom());var a=t.maxZoom,n=t.minZoom,s=t.enableCluster;t=t.size,this.zoom>a?this.zoom=a:this.zoom<n&&(this.zoom=n),s&&(this.supercluster=new zs({maxZoom:a,minZoom:n,radius:t/2}),this.supercluster.load(e)),this.refreshLayer()}}},{key:"refreshLayer",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.options,e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.data,a=this.map,n=this.zoom;if(t.enableCluster&&this.supercluster&&(e=this.getClusterData(t)),e&&e.length){var s=t.gradient,o=t.showText,u=t.textOptions,f=t.height,v=t.size;v*=Math.pow(2,18-n),e=lu(e,v,function(d){var c=nt(d,2),p=c[0];return c=c[1],-180<=p&&180>=p&&-90<=c&&90>=c&&(c=a.lnglatToMercator(p,c),p=c[0],c=c[1]),d[0]=p,d[1]=c,d}),this.max[n]=Math.max(this.max[n]||0,e.max);var l=new Rt({max:this.max[n],min:0,maxSize:f*Math.pow(2,18-n),minSize:0,gradient:s});if(s=[],o){var h=u&&u.format;h=typeof h=="function"?h:null,s=e.map(function(d){return{geometry:{coordinates:[d.center.x,d.center.y,l.getSize(d.count)+u.fontSize/2*Math.pow(2,18-n)]},text:h?h(d.count):d.count}})}this.textLayer.setData(s),o=e.map(function(d){for(var c=d.center,p=e.r,m=[],g=0;6>g;g++)m.push(uu({x:c.x,y:c.y},p,g));return{geometry:{type:"Polygon",coordinates:[m]},properties:{height:l.getSize(d.count),color:l.getColor(d.count)}}}),this.shapeLayer.setData(o),t.enablePicked&&t.autoSelect&&this.pick(-1,-1)}}},{key:"getClusterData",value:function(){var t=this.map,e=t.getBounds(),a=e.ne;e=e.sw,this.ne=a,this.sw=e;var n=a,s=n.lng;n=n.lat;var o=[];return-180<=s&&180>=s&&-90<=n&&90>=n?o=[e.lng,e.lat,a.lng,a.lat]:(a=t.mercatorToLnglat(this.ne.lng,this.ne.lat),e=t.mercatorToLnglat(this.sw.lng,this.sw.lat),o=e.concat(a)),this.supercluster.getClusters(o,this.zoom).map(function(u){var f=0;return u.properties&&u.properties.point_count&&(f=u.properties.point_count),{geometry:u.geometry,count:f}})}},{key:"pick",value:function(t,e){return this.shapeLayer.pick(t,e)}},{key:"shouldUpdate",value:function(){if(!this.data)return!1;var t=this.map,e=Math.floor(t.getZoom()),a=this.options,n=a.maxZoom;if(a=a.minZoom,e>n?e=n:e<a&&(e=a),this.zoom!==e)return this.zoom=e,!0;if(!this.options.enableCluster||(e=t.getBounds(),t=e.ne,e=e.sw,!(t&&e&&this.ne&&this.sw)))return!1;if(this.ne.lng!==t.lng||this.ne.lat!==t.lat||this.sw.lng!==e.lng||this.sw.lat!==e.lat)return!0}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshLayer():de(i.prototype.__proto__||U(i.prototype),"render",this).call(this,t)}}]),i}(ve),ei=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.name="PointLayer",t.bufferData=[],t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"default",shape:"circle",size:5,unit:"px",borderWidth:0,borderColor:[1,1,1,.9],polygonOffset:[0,0],depthTest:!0}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),a=[];e.enablePicked&&a.push("PICK"),e.shape&&e.shape==="circle"&&a.push("SHAPE_CIRCLE"),this.program=new J(this.gl,{vertexShader:`attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aBorderWidth;attribute vec4 aBorderColor;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;varying vec4 vColor;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float size=aSize*devicePixelRatio;float borderWidth=aBorderWidth*devicePixelRatio;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=uUnitPx ? size : size/zoomUnits;vSize=size;vBorderWidth=borderWidth;vBorderColor=aBorderColor;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,fragmentShader:`varying vec4 vColor;varying float vSize;varying float vBorderWidth;varying vec4 vBorderColor;void main(void){vec4 color=vColor;
#if defined(SHAPE_CIRCLE)
float d=distance(gl_PointCoord,vec2(0.5,0.5));float ratio=1.0-vBorderWidth/vSize*2.0;if(d>0.5){discard;}if(d>ratio*0.5){color=vBorderColor;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;
#else
float ratio=vBorderWidth/vSize;if(gl_PointCoord.x<ratio||gl_PointCoord.x>1.0-ratio||gl_PointCoord.y<ratio||gl_PointCoord.y>1.0-ratio){color=vBorderColor;}
#endif
gl_FragColor=color;}`,defines:a},this),this.buffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:52,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:52,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:52,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28},{stride:52,name:"aBorderWidth",buffer:this.buffer,size:1,type:"FLOAT",offset:32},{stride:52,name:"aBorderColor",buffer:this.buffer,size:4,type:"FLOAT",offset:36}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,e){if(this.gl){for(var a=[],n=t.color,s=t.size,o=t.borderWidth,u=t.borderColor,f=0;f<e.length;f++){var v=this.normizedPoint(e[f].geometry.coordinates),l=this.getProperty("color",n,e[f]);l=this.normizedColor(l);var h=this.getProperty("size",s,e[f]);h=Number(h);var d=this.getProperty("borderWidth",o,e[f]);d=Number(d);var c=this.getProperty("borderColor",u,e[f]);c=this.normizedColor(c),v=this.addMultipleCoords(v);for(var p=0;p<v.length;p++){var m=v[p];a.push(m[0],m[1],Number(m[2]||0)),a.push(l[0],l[1],l[2],l[3]),a.push(h),a.push(d,c[0],c[1],c[2],c[3])}}this.bufferData=a,this.buffer.updateData(new Float32Array(a)),t.enablePicked&&this.parsePickData(e)}}},{key:"parsePickData",value:function(t){var e=this.getOptions(),a=[];if(e.enablePicked)for(var n=0;n<t.length;n++){var s=this.indexToRgb(n);a.push(s[0]/255,s[1]/255,s[2]/255),e.repeat&&(a.push(s[0]/255,s[1]/255,s[2]/255),a.push(s[0]/255,s[1]/255,s[2]/255))}e.enablePicked&&this.pickBuffer.updateData(new Float32Array(a))}},{key:"render",value:function(t){var e=t.gl,a=t.matrix,n=t.isPickRender;if(!(0>=this.bufferData.length)){var s=this.getOptions(),o=this.program;o.use(e),t=this.getCommonUniforms(t),t=G(t,{uMatrix:a,uUnitPx:s.unit==="px",zoomUnits:this.map.getZoomUnits(),devicePixelRatio:window.devicePixelRatio}),o.setUniforms(t),this.setGLState({blend:!n,blendFunc:Zt(e,s.blend),blendEquation:e.FUNC_ADD,polygonOffset:s.polygonOffset,depthTest:s.depthTest}),this.vertexArray.bind(),e.drawArrays(e.POINTS,0,this.bufferData.length/13)}}}]),i}(rt),vf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="GroundRippleLayer",t.bufferDataArr=[],t.indexDataArr=[],t.vertexBuffer=[],t.indexBuffer=[],t.position=[],t.opacity=1,t.currentScale=1,t.autoUpdate=!0,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],size:5,segs:32,scale:2,unit:"m",step:.1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new J(this.gl,{vertexShader:"uniform mat4 u_projectionMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_modelMatrix;uniform float u_opacity;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){vColor=aColor;vColor.a=u_opacity;gl_Position=u_projectionMatrix*u_modelViewMatrix*u_modelMatrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;void main(){if(vColor.a==0.0){discard;}gl_FragColor=vColor;}"})}},{key:"onDestroy",value:function(){this.bufferDataArr=[],this.indexDataArr=[],this.vertexBuffer=[],this.indexBuffer=[]}},{key:"onChanged",value:function(t,e){var a=this.gl;if(a&&(this.currentScale=this.opacity=1,(this.data=e)&&e.length)){var n=t.color,s=t.segs;t=t.size;for(var o=360/s,u=0;u<e.length;u++){var f=[],v=[],l=this.normizedPoint(e[u].geometry.coordinates),h=n;Object.prototype.toString.call(h)==="[object Function]"?h=h(e[u]):(h=e[u].color||n,"properties"in e[u]&&"color"in e[u].properties&&(h=e[u].properties.color)),h=this.normizedColor(h);var d=Object.prototype.toString.call(t)==="[object Function]"?t(e[u]):Number(t),c=l[0],p=l[1];f.push(0,0,-.5),f.push(h[0],h[1],h[2],0);for(var m=1,g=0;m<=s;m++,g+=o)f.push(l[0]-c+Math.cos(Math.PI/180*g)*d,l[1]-p+Math.sin(Math.PI/180*g)*d,-.5),f.push(h[0],h[1],h[2],this.opacity),m===s?v.push(0,0+m,1):v.push(0,0+m,0+m+1);h=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferData(a.ARRAY_BUFFER,new Float32Array(f),a.STATIC_DRAW),this.vertexBuffer[u]=h,this.bufferDataArr[u]=f,a.bindBuffer(a.ARRAY_BUFFER,null),f=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(v),a.STATIC_DRAW),this.indexBuffer[u]=f,this.indexDataArr[u]=v,a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),this.position[u]=[l[0],l[1]]}this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,a=t.projectionMatrix,n=t.viewMatrix;for(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_projectionMatrix,!1,a),e.uniformMatrix4fv(t.uniforms.u_modelViewMatrix,!1,n),a=this.opacity,this.options.opacity!==void 0&&(a=this.options.opacity),e.uniform1f(t.uniforms.u_opacity,a),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.DST_ALPHA]}),e.enableVertexAttribArray(t.attributes.aPos),e.enableVertexAttribArray(t.attributes.aColor),a=0;a<this.bufferDataArr.length;a++)if(!(0>=this.bufferDataArr[a].length)){n=new Float32Array(this.bufferDataArr[a]).BYTES_PER_ELEMENT,e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer[a]),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,7*n,3*n),e.vertexAttribPointer(t.attributes.aPos,3,e.FLOAT,!1,7*n,0),n=this.position[a];var s=b.create(),o=[this.currentScale,this.currentScale,this.currentScale];this.options.unit==="px"&&this.map&&(o=this.map.getZoomUnits(),o=[this.currentScale*o,this.currentScale*o,this.currentScale]),b.identity(s),b.translate(s,s,[n[0],n[1],0]),b.scale(s,s,o),e.uniformMatrix4fv(t.uniforms.u_modelMatrix,!1,s),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer[a]),e.drawElements(e.TRIANGLES,this.indexDataArr[a].length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}t=this.getOptions(),e=t.scale,t=t.step,this.opacity-=t/10,this.currentScale+=e*t,0>this.opacity&&(this.currentScale=this.opacity=1)}}]),i}(rt),pf=function(r){function i(t){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.name="RippleLayer",t.bufferData=[],t.date=new Date,t.autoUpdate=!0,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{depthTest:!0,polygonOffset:[0,0],color:[.1,.1,.9,1],blend:"normal",size:20,unit:"px",duration:2}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new J(this.gl,{vertexShader:`attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 uMatrix;uniform vec4 uSelectedColor;uniform float uTime;uniform float duration;uniform float zoomUnits;varying vec4 vColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}float percent=mod(uTime,duration)/duration;vColor.a=1.-percent;gl_Position=uMatrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize/zoomUnits*percent;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,fragmentShader:"varying vec4 vColor;void main(void){vec4 color=vColor;float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}float blur=1.0;blur=1.0-smoothstep(0.49,0.5,d);color.a*=blur;gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:32,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:32,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{stride:32,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,e){if(this.gl){for(var a=[],n=t.color,s=t.size,o=0;o<e.length;o++){var u=e[o].geometry.coordinates,f=n;Object.prototype.toString.call(f)==="[object Function]"?f=f(e[o]):(f=e[o].color||n,"properties"in e[o]&&"color"in e[o].properties&&(f=e[o].properties.color)),f=this.normizedColor(f),u=this.normizedPoint(u);var v=e[o].size||s;"properties"in e[o]&&"size"in e[o].properties&&(v=e[o].properties.size),v=Object.prototype.toString.call(v)==="[object Function]"?v(e[o]):Number(v),a.push(u[0],u[1],Number(u[2]||0)),a.push(f[0],f[1],f[2],f[3]),a.push(v*window.devicePixelRatio)}this.bufferData=a,this.buffer.updateData(new Float32Array(a)),t.enablePicked&&this.parsePickData(e)}}},{key:"parsePickData",value:function(t){var e=this.getOptions(),a=[];if(e.enablePicked)for(var n=0;n<t.length;n++){var s=this.indexToRgb(n);a.push(s[0]/255,s[1]/255,s[2]/255)}e.enablePicked&&this.pickBuffer.updateData(new Float32Array(a))}},{key:"render",value:function(t){var e=t.gl,a=t.matrix,n=t.isPickRender;if(!(0>=this.bufferData.length)){var s=this.getOptions(),o=this.program;o.use(e),this.vertexArray.bind(),t=this.getCommonUniforms(t);var u=1;s.unit==="m"&&this.map&&(u=this.map.getZoomUnits()),t=G(t,{zoomUnits:u,uTime:(new Date-this.date)/1e3,duration:s.duration,uMatrix:a}),o.setUniforms(t),this.setGLState({blend:!n,blendFunc:s.blend==="lighter"?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],blendEquation:e.FUNC_ADD,polygonOffset:s.polygonOffset,depthTest:s.depthTest}),e.drawArrays(e.POINTS,0,this.bufferData.length/8)}}}]),i}(rt),gf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="SparkLayer",t.bufferData=[],t.startTime=Number(t.options.startTime)||0,t.endTime=Number(t.options.endTime),t.time=t.startTime,t.segs=Number(t.options.segs)||10,t.autoUpdate=!0,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10,polygonOffset:[0,0]}}},{key:"setTime",value:function(t){this.time=t}},{key:"initialize",value:function(t){this.gl=t,this.program=new J(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onChanged",value:function(t,e){var a=this.gl;if(a){this.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.buffer);for(var n=[],s=t.height,o=0;o<e.length;o++)for(var u=e[o].geometry.coordinates,f=Object.prototype.toString.call(s)==="[object Function]"?s(e[o]):Number(s),v=0,l=0;l<this.segs;l++){var h=this.normizedPoint(u);n.push(h[0],h[1],v),u[2]===void 0?n.push(l):n.push(Number(u[2])),v+=f/this.segs,n.push(h[0],h[1],v),u[2]===void 0?n.push(l+1):n.push(Number(u[2]))}t.endTime===void 0&&(this.endTime=this.segs),this.bufferData=n,a.bufferData(a.ARRAY_BUFFER,new Float32Array(n),a.STATIC_DRAW),this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(t){var e=t.gl,a=t.matrix;t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,a),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,0,0),a=this.normizedColor(this.options.color),e.uniform3f(t.uniforms.uFragColor,a[0],a[1],a[2]),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength),this.setGLState({blend:!0,blendFunc:[e.SRC_ALPHA,e.ONE],blendEquation:e.FUNC_ADD,polygonOffset:this.options.polygonOffset}),e.drawArrays(e.LINES,0,this.bufferData.length/4),this.time+=Number(this.options.step),this.time>1.5*this.endTime&&(this.time=this.startTime)}}]),i}(rt),Is=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="IconLayer",t.index=[],e=t.canvas=document.createElement("canvas"),t.ctx=e.getContext("2d"),t.iconHash=new Be,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!0,depthTest:!0,blend:"default",flat:!1,unit:"px",scale:1,angle:0,opacity:1,offset:[0,0],padding:[0,0],polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new J(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform float devicePixelRatio;uniform float u_zoom_units;uniform float u_zIndex;uniform float u_scale;uniform bool u_unit_px;uniform bool u_flat;varying vec2 v_texture_coord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)+size.x*sin(a_rotation);}else if(corner==2.0){x+=size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)-size.x*sin(a_rotation);}else if(corner==3.0){x+=size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)-size.x*sin(a_rotation);}else{x+=-size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)+size.x*sin(a_rotation);}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;if(u_flat){vec2 offset=a_offset;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;offset*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=u_zIndex;gl_Position=u_matrix*vec4(current.x+offset[0],current.y-offset[1],current.z,1.0);}else{vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio*u_scale;vec2 offset=a_offset*2./MAPV_resolution*devicePixelRatio;if(!u_unit_px){halfSize/=u_zoom_units;offset/=u_zoom_units;}vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-offset;current.z+=u_zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:`precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform float u_opacity;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}textureColor.a*=u_opacity;gl_FragColor=textureColor;
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:36,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:32},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:{})}},{key:"processCache",value:function(t,e,a){var n=this;this.cachedData=[];for(var s=t.icon,o=t.width,u=t.height,f=t.offset,v=t.angle,l=0;l<e.length;l++){var h=this.normizedPoint(e[l].geometry.coordinates),d=this.getProperty("icon",s,e[l]),c=this.getProperty("width",o,e[l]),p=this.getProperty("height",u,e[l]),m=this.getProperty("offset",f,e[l]),g=this.getProperty("angle",v,e[l]);h&&d&&(this.cachedData.push({point:h,icon:d,width:c,height:p,offset:m,angle:g,index:l}),this.iconHash.get(d)||this.iconHash.set(d,d))}e=Ci(this.iconHash.entries()).filter(function(x){return typeof x[1]=="string"}).map(function(x){var y=nt(x,2)[0];return new De(function(_,A){n.url2canvas(y,function(T){n.iconHash.set(y,T),_()})})}),De.all(e).then(function(x){n.buildSprite(t),a.autoRender!==!1&&n.webglLayer&&n.webglLayer.render()})}},{key:"buildSprite",value:function(t){var e=t.padding,a=this.canvas,n=this.ctx,s=[],o=new Be,u=!0,f=!1,v=void 0;try{for(var l=er(this.iconHash),h;!(u=(h=l.next()).done);u=!0){var d=nt(h.value,2),c=d[1];if(typeof c!="string"){var p=c.width,m=c.height;s.push({w:p+e[0],h:m+e[0],width:p,height:m,key:d[0],icon:c})}}}catch(g){f=!0,v=g}finally{try{!u&&l.return&&l.return()}finally{if(f)throw v}}for(f=xe(s),u=0;u<s.length;u++)v=s[u],o.get(v.key)||o.set(v.key,v);for(u=oe(f.w),f=oe(f.h),a.width=u||1,a.height=f||1,n.save(),a=0;a<s.length;a++)v=s[a],n.drawImage(v.icon,v.x+e[0],v.y+e[1],v.width,v.height);n.restore(),this.loadTexture(),this.buildVertex(t,o,u,f)}},{key:"buildVertex",value:function(t,e,a,n){t=t.enablePicked;for(var s=[],o=[],u=[],f=[],v=0;v<this.cachedData.length;v++){var l=this.cachedData[v],h=l.point,d=l.width,c=l.height,p=l.offset,m=l.angle,g=l.index;if(l=e.get(l.icon)){d=d||l.icon.width,c=c||l.icon.height;var x=nt(h,3);h=x[0];var y=x[1];x=x[2];for(var _=0;4>_;_++)s.push(h,y,x),s.push(_),s.push(d,c),s.push.apply(s,Q(p)),s.push(m*Math.PI/180);d=l.x/a,c=(l.x+l.w)/a,p=(l.y+l.h)/n,l=l.y/n,o.push(d,p,d,l,c,l,c,p),l=4*v,u.push(l,l+2,l+1,l,l+3,l+2),t&&(g=this.indexToRgb(g),f.push(g[0]/255,g[1]/255,g[2]/255),f.push(g[0]/255,g[1]/255,g[2]/255),f.push(g[0]/255,g[1]/255,g[2]/255),f.push(g[0]/255,g[1]/255,g[2]/255))}}this.index=u,this.vertexBuffer.updateData(new Float32Array(s)),this.uvBuffer.updateData(new Float32Array(o)),this.indexBuffer.updateData(new Uint32Array(u)),t&&this.pickBuffer.updateData(new Float32Array(f))}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var e=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(e);var o=t.isPickRender?Zt(e,null):Zt(e,n.blend);this.setGLState({blend:!0,blendFunc:o,polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite}),s.setUniforms(G(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:a,u_flat:n.flat,u_unit_px:n.unit==="px",u_zoom_units:this.map.getZoomUnits(),u_scale:n.scale,u_opacity:n.opacity,u_zIndex:n.zIndex,devicePixelRatio:window.devicePixelRatio})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"url2canvas",value:function(t,e){if((typeof t=="undefined"?"undefined":It(t))==="object")e(t);else{var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var n=a.width,s=a.height,o=document.createElement("canvas");o.width=n,o.height=s,o.getContext("2d").drawImage(a,0,0,n,s),e(o)},a.onerror=function(){var n=document.createElement("canvas");n.width=20,n.height=40;var s=n.getContext("2d");s.fillStyle="red",s.beginPath(),s.lineTo(0,0),s.lineTo(20,0),s.lineTo(10,40),s.closePath(),s.fill(),e(n)},a.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?yt(this.gl,this.canvas,function(e){t.texture=e}):this.texture=null}}]),i}(rt),mf=function(r){function i(t){O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t));var e=G({blend:"default"},t.options);return t.pointLayer=new ei(e),t.options.textOptions=G({depthTest:!1,collides:!1},t.options.textOptions),t.textLayer=new Zr(t.options.textOptions),e=G({},t.options,t.options.iconOptions),t.iconLayer=new Is(e),t.children=[t.pointLayer,t.textLayer,t.iconLayer],t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{minSize:25,maxSize:40,clusterRadius:200,minPoints:2,extent:400,showText:!0,maxZoom:19,minZoom:4,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"},textOptions:{fontSize:12,color:"white"},iconOptions:{}}}},{key:"onOptionsChanged",value:function(t){this.textLayer.setOptions(t.textOptions)}},{key:"setOptions",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},e=this.options.textOptions;t.textOptions&&G(e,t.textOptions);var a=t.minZoom,n=t.maxZoom,s=t.clusterRadius;a=n&&n!==this.options.maxZoom||a&&a!==this.options.minZoom||s&&s!==this.options.clusterRadius,G(this.options,t,{textOptions:e}),a?this.onChanged(this.options,this.data):this.refreshCluster(),this.onOptionsChanged(this.getOptions())}},{key:"onChanged",value:function(t,e){var a=this;e&&e.length?(e.forEach(function(n){var s=nt(n.geometry.coordinates,2),o=s[0];s=s[1],-180<=o&&180>=o&&-90<=s&&90>=s||(o=a.map.mercatorToLnglat(o,s),n.geometry.coordinates[0]=o[0],n.geometry.coordinates[1]=o[1])}),this.supercluster=new zs({maxZoom:t.maxZoom,minZoom:t.minZoom,radius:t.clusterRadius,minPoints:t.minPoints,extent:t.extent}),this.supercluster.load(e),this.supercluster.trees.forEach(function(n){var s=0,o=1/0;n.points.forEach(function(u){s=Math.max(u.numPoints||0,s),o=Math.min(u.numPoints||1/0,o)}),n.max=s,n.min=o}),this.refreshCluster()):(this.supercluster=null,this.pointLayer.setData([]),this.iconLayer.setData([]),this.textLayer.setData([]))}},{key:"refreshCluster",value:function(){var t=this,e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.options;if(this.supercluster){var a=this.getClusterData(e);if(a&&a.length)if(typeof e.beforeRender=="function"&&e.beforeRender(a)===!1)this.pointLayer.setData([]),this.iconLayer.setData([]),this.textLayer.setData([]);else{var n=[],s=[],o=[];a.forEach(function(u){u.properties.cluster?(n.push(u),o.push({geometry:u.geometry,properties:{text:u.properties.text}})):u.properties.icon||t.options.iconOptions.icon?s.push(u):n.push(u)}),this.pointLayer.setData(n),this.iconLayer.setData(s),this.textLayer.setData(e.showText?o:[]),e.enablePicked&&e.autoSelect&&this.pick(-1,-1)}}}},{key:"getClusterData",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.options,e=this.map.getBounds(),a=this.ne=e.getNorthEast();e=this.sw=e.getSouthWest();var n=a,s=n.lng;return n=n.lat,-180<=s&&180>=s&&-90<=n&&90>=n?e=[e.lng,e.lat,a.lng,a.lat]:(a=this.map.mercatorToLnglat(this.ne.lng,this.ne.lat),e=this.map.mercatorToLnglat(this.sw.lng,this.sw.lat),e=e.concat(a)),a=Math.floor(this.map.getZoom()),e=this.supercluster.getClusters(e,a),this.zoom!==a&&0<e.length&&(this.zoom=a,n=this.supercluster.trees,s=n[a]&&n[a].max||this.max,a=n[a]&&n[a].min||this.min,s!==a&&(this.max=s,this.min=a)),this.processData(e,t)}},{key:"processData",value:function(t,e){var a=e.defaultColor,n=e.defaultSize,s=e.gradient,o=e.minSize,u=e.textOptions,f=new Rt({max:this.max,min:~~this.min||1,minSize:o||8,maxSize:e.maxSize||30,gradient:s});a=a||s[0]||"black",n=n||.5*o||5;var v=u&&u.format;return v=typeof v=="function"?v:null,t.map(function(l){var h=n,d=a,c="";return l.properties&&l.properties.point_count&&(c=l.properties.point_count,h=f.getSize(c)||h,d=f.getColor(c),c=v?v(c):c),h=G({},l.properties,{text:c,size:h,color:d}),G({},l,{properties:h,children:l.id})})}},{key:"pick",value:function(t,e){var a=this.pointLayer.pick(t,e);return 0>a.dataIndex&&(a=this.iconLayer.pick(t,e)),(t=a.dataItem)&&typeof t.children=="number"&&(t.children=this.getClusterPoints(t.children)),a}},{key:"getClusterPoints",value:function(t){var e=this;return t?this.supercluster.getChildren(t).map(function(a){return a.type==="Feature"?e.getClusterPoints(a.id):a}).flat():[]}},{key:"shouldUpdate",value:function(){if(!this.data||!this.supercluster)return!1;if(this.zoom!==Math.floor(this.map.getZoom()))return!0;var t=this.map.getBounds(),e=t.getNorthEast();if(t=t.getSouthWest(),this.ne.lng!==e.lng||this.ne.lat!==e.lat||this.sw.lng!==t.lng||this.sw.lat!==t.lat)return!0}},{key:"render",value:function(t){this.shouldUpdate()?this.refreshCluster():de(i.prototype.__proto__||U(i.prototype),"render",this).call(this,t)}}]),i}(ve),xf=function(r){function i(t,e){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t,e))}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return G(de(i.prototype.__proto__||U(i.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}})}},{key:"onChanged",value:function(t,e){this.gl&&(e=this.processData(e,t),de(i.prototype.__proto__||U(i.prototype),"onChanged",this).call(this,t,e))}},{key:"generateGrid",value:function(t,e){var a=e.gridSize,n=[],s={};e=t.length;for(var o=this.getPointOffset(),u=0;u<e;u++){var f=this.normizedPoint(t[u].geometry.coordinates),v=f[2];f=~~((f[0]+o[0])/a)+"_"+~~((f[1]+o[1])/a),s[f]===void 0&&(s[f]={count:0,num:0,z:0});var l=~~t[u].count||1;"properties"in t[u]&&"count"in t[u].properties&&(l=~~t[u].properties.count),s[f].count+=l,s[f].num+=1,s[f].z+=v}return _t(s).forEach(function(h){var d=h.split("_");n.push([d[0]*a+a/2,d[1]*a+a/2,s[h].z/s[h].num,s[h].count])}),n}},{key:"processData",value:function(t,e){var a=[];if(e.style==="normal")for(var n=this.getPointOffset(),s=0;s<t.length;s++){var o=this.normizedPoint(t[s].geometry.coordinates),u=o[0]+n[0],f=o[1]+n[1];o=o[2];var v=~~t[s].count||1;"properties"in t[s]&&"count"in t[s].properties&&(v=~~t[s].properties.count),a.push([u,f,o,v])}else a=this.generateGrid(t,e);if(n=t=0,e.max!==void 0&&e.min!==void 0)t=e.max,n=e.min;else{for(a[0]&&(t=a[0][3],n=a[0][3]),s=a.length,u=0;u<s;u++)f=a[u],t=Math.max(f[3],t),n=Math.min(f[3],n);t/=2}for(e=new Rt({max:~~t,min:n,gradient:e.gradient}),t=[],n=0;n<a.length;n++)s=a[n],s[0]=s[0],s[1]=s[1],u=e.getImageData(s[3]),t.push({geometry:{type:"Point",coordinates:[s[0],s[1],s[2]]},color:[u[0]/255,u[1]/255,u[2]/255,u[3]/255]});return t}}]),i}(ei),yf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.bufferData=[],t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(t,e){var a=this;if(t=this.gl){this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer);for(var n=[],s=function(u){var f=5*u;for(u=0;u<e.length;u++)e[u].geometry.coordinates.forEach(function(v){for(var l=0;l<v.length-1;l++){var h=a.normizedPoint(v[l]);n.push(h[0]),n.push(h[1]),n.push(Number(f)),h=a.normizedPoint(v[l+1]),n.push(h[0]),n.push(h[1]),n.push(Number(f))}})},o=0;20>o;o++)s(o);t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW),this.bufferData=n,t.bindBuffer(t.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(t){this.gl=t,this.program=new J(t,{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"}),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var a=this.program;e.useProgram(a.program);var n=this.normizedColor(this.options.color);e.uniform4f(a.uniforms.uFragColor,n[0],n[1],n[2],n[3]),e.uniformMatrix4fv(a.uniforms.uMatrix,!1,t),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.enableVertexAttribArray(a.attributes.aPos),e.vertexAttribPointer(a.attributes.aPos,3,e.FLOAT,!1,0,0),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.ONE,e.ONE]}),e.drawArrays(e.LINES,0,this.bufferData.length/3)}}]),i}(rt),bs={circle:1,square:2},_f=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return W(i,r),z(i,[{key:"initialize",value:function(t){this.gl=t,this.program=new J(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"}),this.f32BufferData=new Float32Array,this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(t,e){var a=this.gl;if(a){this.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.buffer);for(var n=[],s=t.color||[.1,.1,.9,1],o=t.size||5,u=0;u<e.length;u++){var f=e[u].geometry.coordinates,v=s;Object.prototype.toString.call(v)==="[object Function]"?v=v(e[u]):(v=e[u].color||s,"properties"in e[u]&&"color"in e[u].properties&&(v=e[u].properties.color)),v=this.normizedColor(v);var l=this.normizedPoint(f),h=o;h=Object.prototype.toString.call(h)==="[object Function]"?h(e[u]):Number(h);var d=e[u].time||u;"properties"in e[u]&&"time"in e[u].properties&&(d=e[u].properties.time),n.push(l[0],l[1],Number(f[2]||0),d),n.push(v[0],v[1],v[2],v[3]),n.push(h*window.devicePixelRatio)}t.endTime===void 0&&(this.endTime=e.length),this.bufferData=n,this.f32BufferData=new Float32Array(n),a.bufferData(a.ARRAY_BUFFER,this.f32BufferData,a.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,a=t.matrix;0>=this.bufferData.length||(t=this.program,e.useProgram(t.program),e.uniformMatrix4fv(t.uniforms.u_matrix,!1,a),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),a=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(t.attributes.aPos),e.vertexAttribPointer(t.attributes.aPos,4,e.FLOAT,!1,9*a,0),e.enableVertexAttribArray(t.attributes.aColor),e.vertexAttribPointer(t.attributes.aColor,4,e.FLOAT,!1,9*a,4*a),e.enableVertexAttribArray(t.attributes.aSize),e.vertexAttribPointer(t.attributes.aSize,1,e.FLOAT,!1,9*a,8*a),e.uniform1f(t.uniforms.currentTime,this.time),e.uniform1f(t.uniforms.trailLength,this.options.trailLength||3),a=1,this.options.shape&&bs[this.options.shape]&&(a=bs[this.options.shape]),e.uniform1i(t.uniforms.uShape,a),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:this.options.blend==="lighter"?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),e.drawArrays(e.POINTS,0,this.bufferData.length/9),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]),i}(rt),Af=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.bufferData=[],t.startTime=t.options.startTime||0,t.endTime=t.options.endTime,t.time=t.startTime,t.autoUpdate=!0,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1,polygonOffset:[0,0]}}},{key:"initialize",value:function(t){this.gl=t,this.program=new J(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"},this),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(t){this.time=t}},{key:"onChanged",value:function(t,e){var a=this.gl;if(a){this.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.buffer);for(var n=[],s=0,o=this.options.color,u=0;u<e.length;u++){var f=e[u].geometry.coordinates;e[u].color&&(o=e[u].color),"properties"in e[u]&&"color"in e[u].properties&&(o=e[u].properties.color),Object.prototype.toString.call(o)==="[object Function]"&&(o=o(e[u])),o=this.normizedColor(o),f.length>s&&(s=f.length);for(var v=0;v<f.length-1;v++){var l=this.normizedPoint(f[v]);n.push(l[0]),n.push(l[1]),n.push(l[2]),f[v][3]===void 0?n.push(v):n.push(Number(f[v][3])),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(o[3]),l=this.normizedPoint(f[v+1]),n.push(l[0]),n.push(l[1]),n.push(l[2]),f[v+1][3]===void 0?n.push(v+1):n.push(Number(f[v+1][3])),n.push(o[0]),n.push(o[1]),n.push(o[2]),n.push(o[3])}}t.endTime===void 0&&(this.endTime=s),this.bufferData=n,this.f32BufferData=new Float32Array(n),a.bufferData(a.ARRAY_BUFFER,this.f32BufferData,a.STATIC_DRAW)}}},{key:"render",value:function(t){var e=t.gl,a=t.matrix;t=this.getOptions();var n=this.program;n.use(e),e.uniformMatrix4fv(n.uniforms.u_matrix,!1,a),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),a=this.f32BufferData.BYTES_PER_ELEMENT,e.enableVertexAttribArray(n.attributes.aPos),e.vertexAttribPointer(n.attributes.aPos,4,e.FLOAT,!1,8*a,0),e.enableVertexAttribArray(n.attributes.aColor),e.vertexAttribPointer(n.attributes.aColor,4,e.FLOAT,!1,8*a,4*a),a=this.normizedColor(t.color),e.uniform3f(n.uniforms.uFragColor,a[0],a[1],a[2]),e.uniform1f(n.uniforms.currentTime,this.time),e.uniform1f(n.uniforms.trailLength,t.trailLength),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:t.blend==="lighter"?[e.ONE,e.ONE]:[e.SRC_ALPHA,e.ONE],polygonOffset:t.polygonOffset,depthMask:!1}),e.drawArrays(e.LINES,0,this.bufferData.length/8),this.time+=t.step,this.time>this.endTime&&(this.time=this.startTime)}}]),i}(rt),Tf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="IconCollidesLayer",t.index=[],e=t.canvas=document.createElement("canvas"),t.ctx=e.getContext("2d"),t.iconHash=new Be,t.boxHash=new Be,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{flat:!1,unit:"px",scale:1,angle:0,offset:[0,0],padding:[0,0]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new J(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute vec2 a_size;attribute vec2 a_offset;attribute vec2 a_texture_coord;uniform mat4 u_matrix;uniform vec2 u_size;uniform float devicePixelRatio;uniform float u_zoom_units;uniform float u_zIndex;uniform float u_scale;uniform bool u_unit_px;uniform bool u_flat;varying vec2 v_texture_coord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)+size.x*sin(a_rotation);}else if(corner==2.0){x+=size.x*cos(a_rotation)+size.y*sin(a_rotation);y+=size.y*cos(a_rotation)-size.x*sin(a_rotation);}else if(corner==3.0){x+=size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)-size.x*sin(a_rotation);}else{x+=-size.x*cos(a_rotation)-size.y*sin(a_rotation);y+=-size.y*cos(a_rotation)+size.x*sin(a_rotation);}return vec3(x,y,coord.z);}void main(){v_texture_coord=a_texture_coord;if(u_flat){vec2 offset=a_offset;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;offset*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=u_zIndex;gl_Position=u_matrix*vec4(current.x+offset[0],current.y-offset[1],current.z,1.0);}else{vec4 position=u_matrix*vec4(a_pos,1.0);vec3 screen=position.xyz/position.w;vec2 halfSize=a_size/MAPV_resolution*devicePixelRatio*u_scale;vec2 offset=a_offset*2./MAPV_resolution*devicePixelRatio;if(!u_unit_px){halfSize/=u_zoom_units;offset/=u_zoom_units;}vec3 current=transformCoord(screen,halfSize,a_corner);current.xy=current.xy-offset;current.z+=u_zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:`precision highp float;varying vec2 v_texture_coord;uniform sampler2D u_icon;uniform vec4 uSelectedColor;void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}gl_FragColor=textureColor;
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:36,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:16},{name:"a_offset",buffer:this.vertexBuffer,size:2,stride:36,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:36,type:"FLOAT",offset:32},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};this.gl&&(this.cachedData=[],this.boxHash.clear(),this.processCache(t,e,a))}},{key:"processCache",value:function(t,e,a){for(var n=this,s=t.icon,o=t.width,u=t.height,f=t.offset,v=t.angle,l=0;l<e.length;l++){var h=this.normizedPoint(e[l].geometry.coordinates),d=this.getProperty("icon",s,e[l]),c=this.getProperty("width",o,e[l]),p=this.getProperty("height",u,e[l]),m=this.getProperty("offset",f,e[l]),g=this.getProperty("angle",v,e[l]);h&&d&&(this.cachedData.push({point:h,icon:d,width:c,height:p,offset:m,angle:g,dataIndex:l}),this.iconHash.get(d)||this.iconHash.set(d,d))}e=Ci(this.iconHash.entries()).filter(function(x){return typeof x[1]=="string"}).map(function(x){var y=nt(x,2)[0];return new De(function(_,A){n.url2canvas(y,function(T){n.iconHash.set(y,T),_()})})}),De.all(e).then(function(x){n.buildSprite(t),a.autoRender!==!1&&n.webglLayer&&n.webglLayer.render()})}},{key:"buildSprite",value:function(t){t=t.padding;var e=this.canvas,a=this.ctx,n=[],s=!0,o=!1,u=void 0;try{for(var f=er(this.iconHash),v;!(s=(v=f.next()).done);s=!0){var l=nt(v.value,2),h=l[1];if(typeof h!="string"){var d=h.width,c=h.height;n.push({w:d+t[0],h:c+t[0],width:d,height:c,key:l[0],icon:h})}}}catch(p){o=!0,u=p}finally{try{!s&&f.return&&f.return()}finally{if(o)throw u}}for(f=xe(n),v=0;v<n.length;v++)l=n[v],this.boxHash.get(l.key)||this.boxHash.set(l.key,l);for(v=oe(f.w)||1,f=oe(f.h)||1,e.width=v,e.height=f,a.save(),e=0;e<n.length;e++)f=n[e],a.drawImage(f.icon,f.x+t[0],f.y+t[1],f.width,f.height);a.restore(),this.loadTexture()}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.texture){var e=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}),s.setUniforms(G(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:a,u_flat:n.flat,u_unit_px:n.unit==="px",u_zoom_units:this.map.getZoomUnits(),u_scale:n.scale,u_zIndex:n.zIndex,devicePixelRatio:window.devicePixelRatio})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateIcon(t)}},{key:"updateIcon",value:function(t){if(this.iconHash.size&&this.boxHash.size){var e=this.getOptions(),a=t.gl;t=t.matrix,e=e.enablePicked;var n=[],s=[],o=[],u=[],f=this.canvas.width,v=this.canvas.height,l=a.canvas.width/window.devicePixelRatio;a=a.canvas.height/window.devicePixelRatio;for(var h=new ar,d=0,c=0;c<this.cachedData.length;c++){var p=this.cachedData[c],m=p.point,g=p.width,x=p.height,y=p.offset,_=p.angle,A=p.dataIndex;if(p=this.boxHash.get(p.icon)){g=g||p.icon.width,x=x||p.icon.height;var T=nt(m,3);m=T[0];var w=T[1];T=T[2];var E=ft.clone([m,w,T,1]);ft.transformMat4(E,E,t),ft.scale(E,E,1/E[3]);var M=(E[0]+1)/2*l-g/2;E=(-E[1]+1)/2*a-x/2;var P=M+g,R=E+x;if(!(0>P||0>R||M>l||E>a||(M={minX:M,maxX:P,minY:E,maxY:R},h.collides(M)))){for(h.insert(M),M=0;4>M;M++)n.push(m,w,T),n.push(M),n.push(g,x),n.push.apply(n,Q(y)),n.push(_*Math.PI/180);g=p.x/f,x=(p.x+p.w)/f,y=(p.y+p.h)/v,p=p.y/v,s.push(g,y,g,p,x,p,x,y),p=4*d,o.push(p,p+2,p+1,p,p+3,p+2),e&&(A=this.indexToRgb(A),u.push(A[0]/255,A[1]/255,A[2]/255),u.push(A[0]/255,A[1]/255,A[2]/255),u.push(A[0]/255,A[1]/255,A[2]/255),u.push(A[0]/255,A[1]/255,A[2]/255)),d+=1}}}this.index=o,this.vertexBuffer.updateData(new Float32Array(n)),this.uvBuffer.updateData(new Float32Array(s)),this.indexBuffer.updateData(new Uint32Array(o)),e&&this.pickBuffer.updateData(new Float32Array(u))}}},{key:"url2canvas",value:function(t,e){if((typeof t=="undefined"?"undefined":It(t))==="object")e(t);else{var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var n=a.width,s=a.height,o=document.createElement("canvas");o.width=n,o.height=s,o.getContext("2d").drawImage(a,0,0,n,s),e(o)},a.onerror=function(){var n=document.createElement("canvas");n.width=20,n.height=40;var s=n.getContext("2d");s.fillStyle="red",s.beginPath(),s.lineTo(0,0),s.lineTo(20,0),s.lineTo(10,40),s.closePath(),s.fill(),e(n)},a.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?yt(this.gl,this.canvas,function(e){t.texture=e}):this.texture=null}}]),i}(rt),ks=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="LineFlowLayer",t.initData(),t.date=new Date,t.autoUpdate=!0,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:"rgba(25, 25, 250, 1)",blend:"normal",width:2,antialias:!1,interval:.1,duration:2,trailLength:.5,minZoom:2,maxZoom:25,polygonOffset:[0,0]}}},{key:"initData",value:function(){this.dataMgr={position:[],prev:[],next:[],direction:[],color:[],index:[],counter:[]}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.program=new J(this.gl,{vertexShader:`uniform mat4 u_matrix;uniform float thickness;uniform vec4 uSelectedColor;attribute vec3 position;attribute vec3 next;attribute vec3 previous;attribute float direction;attribute vec4 aColor;attribute float aCounter;attribute vec2 uv;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;vec2 project(vec4 coord){vec3 screen=coord.xyz/coord.w;vec2 clip=(screen.xy+1.0)/2.0;return clip*MAPV_resolution;}vec4 unproject(vec2 projected,float z,float w){vec2 clip=projected/MAPV_resolution;vec2 screen=clip*2.0-1.0;return vec4(screen*w,z,w);}void main(){vColor=aColor;vCounter=aCounter;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
vec4 previousProjected=u_matrix*vec4(previous,1.0);vec4 currentProjected=u_matrix*vec4(position,1.0);vec4 nextProjected=u_matrix*vec4(next,1.0);vec2 currentScreen=project(currentProjected);vec2 previousScreen=project(previousProjected);vec2 nextScreen=project(nextProjected);float len=thickness;float orientation=direction;vec2 dir=vec2(0.0);if(currentScreen==previousScreen){dir=normalize(nextScreen-currentScreen);}else if(currentScreen==nextScreen){dir=normalize(currentScreen-previousScreen);}else{vec2 dirA=normalize((currentScreen-previousScreen));vec2 dirB=normalize((nextScreen-currentScreen));vec2 tangent=normalize(dirA+dirB);vec2 perp=vec2(-dirA.y,dirA.x);vec2 miter=vec2(-tangent.y,tangent.x);dir=tangent;float angle=40.0;if(dot(dirA,dirB)>cos(radians(angle))){len=thickness/dot(miter,perp);}}vec2 normal=vec2(-dir.y,dir.x);vNormal=normal*orientation;normal*=len/2.0;vec2 pos=currentScreen+normal*orientation;vec4 finalPos=unproject(pos,currentProjected.z,currentProjected.w);gl_Position=finalPos;}`,fragmentShader:"precision highp float;uniform bool uAntialias;uniform bool uAnimate;uniform float uTime;uniform float duration;uniform float interval;uniform float trailLength;varying vec4 vColor;varying vec2 vNormal;varying float vCounter;void main(){vec4 color=vColor;if(uAntialias){float blur=1.0;blur=1.0-smoothstep(0.98,1.0,length(vNormal));color.a*=blur;}if(uAnimate){float alpha=1.0-fract(mod(1.0-vCounter,interval)*(1.0/interval)+uTime/duration);alpha=(alpha+trailLength-1.0)/trailLength;color.a*=alpha;}gl_FragColor=color;}",defines:e.enablePicked?["PICK"]:[]},this),this.prevBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.currentBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.nextBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.directionBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.colorBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.counterBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:12,name:"previous",buffer:this.prevBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"position",buffer:this.currentBuffer,size:3,type:"FLOAT",offset:0},{stride:12,name:"next",buffer:this.nextBuffer,size:3,type:"FLOAT",offset:0},{stride:4,name:"direction",buffer:this.directionBuffer,size:1,type:"FLOAT",offset:0},{stride:16,name:"aColor",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0},{stride:4,name:"aCounter",buffer:this.counterBuffer,size:1,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){var a=this;if(this.gl){this.initData();for(var n=1,s=[],o=0;o<e.length;o++){var u=[],f=e[o].geometry.coordinates;f&&0<f.length&&(u=e[o].geometry.type==="Polygon"?f[0].map(function(c){return a.normizedPoint(c)}):f.map(function(c){return a.normizedPoint(c)})),u=Ro(u),f=u.total,s[o]=u.arr,n=Math.max(f,n)}for(o=[],u=t.color,f=0;f<e.length;f++){var v=[],l=e[f].geometry.coordinates;l&&0<l.length&&(v=e[f].geometry.type==="Polygon"?l[0].map(function(c){return a.normizedPoint(c)}):l.map(function(c){return a.normizedPoint(c)})),l=u,Object.prototype.toString.call(l)==="[object Function]"?l=l(e[f]):(l=e[f].color||u,"properties"in e[f]&&"color"in e[f].properties&&(l=e[f].properties.color)),l=this.normizedColor(l);for(var h=this.addMultipleCoords(v),d=0;d<h.length;d++)this.processData(this.dataMgr,h[d],s[f],n,l);if(t.enablePicked)for(l=this.indexToRgb(f),h=0;h<v.length;h++)o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),t.repeat&&(o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255),o.push(l[0]/255,l[1]/255,l[2]/255))}this.counterBuffer.updateData(new Float32Array(this.dataMgr.counter)),this.currentBuffer.updateData(new Float32Array(this.dataMgr.position)),this.prevBuffer.updateData(new Float32Array(this.dataMgr.prev)),this.nextBuffer.updateData(new Float32Array(this.dataMgr.next)),this.directionBuffer.updateData(new Float32Array(this.dataMgr.direction)),this.colorBuffer.updateData(new Float32Array(this.dataMgr.color)),this.indexBuffer.updateData(new Uint32Array(this.dataMgr.index)),t.enablePicked&&this.pickBuffer.updateData(new Float32Array(o))}}},{key:"processData",value:function(t,e,a,n,s){var o,u,f,v,l,h,d,c=e.length,p=t.position.length/6;a=jt(a.map(function(_){return _/n}));var m=jt(e.map(function(_){return-1}),!0),g=jt(e),x=jt(e.map(ui(-1))),y=jt(e.map(ui(1)));e=jt(e.map(function(_){return s})),c=Co(c,p),(o=t.counter).push.apply(o,Q(a)),(u=t.position).push.apply(u,Q($t(g))),(f=t.prev).push.apply(f,Q($t(x))),(v=t.next).push.apply(v,Q($t(y))),(l=t.direction).push.apply(l,Q(m)),(h=t.color).push.apply(h,Q($t(e))),(d=t.index).push.apply(d,Q(c))}},{key:"render",value:function(t){var e=t.gl,a=t.matrix,n=this.dataMgr;if(n&&!(0>=n.index.length)){var s=this.getOptions(),o=this.program;if(o.use(e),this.map){var u=this.map.getZoom();u=!!(u>=s.minZoom&&u<=s.maxZoom&&this.autoUpdate)}else u=!0;o.setUniforms(G(this.getCommonUniforms(t),{u_matrix:a,thickness:s.width,uAntialias:s.antialias,uTime:(new Date-this.date)/1e3,uAnimate:u,duration:s.duration,interval:s.interval,trailLength:s.trailLength})),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:s.blend==="lighter"?[e.SRC_ALPHA,e.ONE]:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:s.polygonOffset}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,n.index.length,e.UNSIGNED_INT,0)}}}]),i}(rt),wf=function(r){function i(t,e){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t,e))}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.program=new J(this.gl,{vertexShader:`precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform sampler2D uTerrain;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;
#if defined(TERRAIN)
vec4 terrainColor=texture2D(uTerrain,vec2(v_texture_coord.s,v_texture_coord.t));vec3 rgb=terrainColor.rgb*256.0;pos.z=-10000.0+((rgb.r*256.0*256.0+rgb.g*256.0+rgb.b)*0.1);pos.z=pos.z-60.0;
#endif
vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;}`,fragmentShader:"precision highp float;varying vec2 v_texture_coord;uniform sampler2D uTile;uniform bool uUseFilter;uniform vec4 uFilterColor;void main(){vec4 textureColor=texture2D(uTile,vec2(v_texture_coord.s,v_texture_coord.t));if(uUseFilter){textureColor=textureColor*uFilterColor;}gl_FragColor=textureColor;}",defines:e.terrain?["TERRAIN"]:""},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new ot({gl:t,program:this.program,attributes:[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]})}},{key:"onChanged",value:function(t,e){var a=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){a.loadTexture(function(){a.parseData(e),a.dataTime=new Date,a.webglLayer.render()})},0))}},{key:"render",value:function(t){var e=t.gl,a=t.projectionMatrix;t=t.viewMatrix;var n=this.getOptions(),s=this.program,o=s.uniforms;s.use(e),this.texture&&(e.activeTexture(e.TEXTURE0),e.uniform1i(o.uTile,0),e.bindTexture(e.TEXTURE_2D,this.texture),e.activeTexture(e.TEXTURE1),e.uniform1i(o.uTerrain,1),e.bindTexture(e.TEXTURE_2D,this.terrainSampler),this.setGLState({cullFace:!1}),s.setUniforms({u_proj_matrix:a,uUseFilter:!!n.filterColor,uFilterColor:this.normizedColor(n.filterColor||"rgba(0, 0, 100, 1.0)"),u_mv_matrix:t}),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)))}},{key:"loadTexture",value:function(t){var e=this,a=this.getOptions();a.tile?a.terrain?yt(this.gl,a.terrain,function(n,s){e.terrainSampler=n,yt(e.gl,a.tile,function(o,u){e.texture=o,t&&t(),e.webglLayer.render()})},{TEXTURE_WRAP_S:"MIRRORED_REPEAT",TEXTURE_WRAP_T:"MIRRORED_REPEAT"}):yt(this.gl,a.tile,function(n,s){e.texture=n,t&&t(),e.webglLayer.render()}):(this.texture=null,t&&t())}},{key:"parseData",value:function(t){var e=this,a=[],n=[];if(t&&t[0]){var s=t[0].geometry.coordinates[0];s=s.map(function(c){return e.normizedPoint(c)}),t=s[0][0];var o=s[0][1],u=s[0][2],f=(s[2][0]-t)/16;s=(s[2][1]-o)/16;for(var v=0;16>=v;v++)for(var l=0;16>=l;l++)if(a.push(t+f*l,o+s*v,u),a.push(l/16,v/16),16>l&&16>v){var h=17*v+l,d=17*(v+1)+l;n.push(h,d+1,h+1),n.push(h,d,d+1)}}this.index=n,this.vertexBuffer.updateData(new Float32Array(a)),this.indexBuffer.updateData(new Uint32Array(n))}}]),i}(rt),Mf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="BoardLayer",t.index=[],e=t.canvas=document.createElement("canvas"),t.ctx=e.getContext("2d"),t.iconHash=new Be,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{unit:"px",scale:1,angle:0,offsetZ:0,padding:[0,0],polygonOffset:[0,0],enableColorMix:!1,mixColor:"#fff",mixAmount:.5}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var a=[{name:"a_pos",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"a_corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"a_size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"a_offsetZ",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"a_rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"a_texture_coord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}];a=a.concat(this.getCommonAttributes());var n=[];e.enablePicked&&n.push("PICK"),this.options.enableColorMix&&(this.colorBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),a.push({stride:16,name:"a_color",buffer:this.colorBuffer,size:4,type:"FLOAT",offset:0}),n.push("USE_COLOR_MIX")),this.program=new J(this.gl,{vertexShader:`precision highp float;attribute vec3 a_pos;attribute float a_corner;attribute float a_rotation;attribute float a_offsetZ;attribute vec2 a_size;attribute vec2 a_texture_coord;
#if defined(USE_COLOR_MIX)
attribute vec4 a_color;
#endif
uniform mat4 u_matrix;uniform vec2 u_size;uniform float u_zoom_units;uniform float u_scale;uniform bool u_unit_px;varying vec2 v_texture_coord;varying vec4 v_color;/***\u4E09\u7EF4\u7A7A\u95F4\u5185\uFF0C\u7ED5Z\u8F74\u65CB\u8F6C\u7684\u77E9\u9635\uFF0C\u53F3\u624B\u5750\u6807\u7CFB\u4E0B*[x'][cos0-sin0  0  0]*[y']=[sin0 cos0   0  0]*[z'][0     0     1  0]*[1][0     0     0  1]*/mat3 rotateZ(float angle){float cos0=cos(angle);float sin0=sin(angle);return mat3(cos0,sin0,0.,-sin0,cos0,0.,0.,0.,1.);}vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;float z=coord.z;mat3 mat=rotateZ(a_rotation);vec3 rotated=vec3(size[0],0.0,size[1]);if(corner==1.0){rotated=mat*vec3(-size[0],0.0,size[1]);}else if(corner==2.0){rotated=mat*vec3(size[0],0.0,size[1]);}else if(corner==3.0){rotated=mat*vec3(size[0],0.0,-size[1]);}else{rotated=mat*vec3(-size[0],0.0,-size[1]);}x+=rotated.x;y+=rotated.y;z+=rotated.z;return vec3(x,y,z);}void main(){
#if defined(USE_COLOR_MIX)
v_color=a_color;
#endif
v_texture_coord=a_texture_coord;vec2 halfSize=a_size/2.0*u_scale;if(u_unit_px){halfSize*=u_zoom_units;}vec3 current=transformCoord(a_pos,halfSize,a_corner);current.z+=a_offsetZ;gl_Position=u_matrix*vec4(current,1.0);}`,fragmentShader:`precision highp float;varying vec2 v_texture_coord;varying vec4 v_color;uniform sampler2D u_icon;uniform vec4 uSelectedColor;
#if defined(USE_COLOR_MIX)
uniform float u_mix_amount;
#endif
void main(){vec4 textureColor=texture2D(u_icon,vec2(v_texture_coord.x,1.0-v_texture_coord.y));if(textureColor.a==0.0&&uIsPickRender==false){discard;}gl_FragColor=textureColor;
#if defined(USE_COLOR_MIX)
gl_FragColor=mix(gl_FragColor,v_color,u_mix_amount);
#endif
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:n},this),this.vertexArray=new ot({gl:t,program:this.program,attributes:a})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"forceUpdate",value:function(){this.gl&&this.processCache(this.options,this.data)}},{key:"processCache",value:function(t,e){var a=this;this.cachedData=[];for(var n=t.icon,s=t.width,o=t.height,u=t.offsetZ,f=t.angle,v=t.mixColor,l=0;l<e.length;l++){var h=this.normizedPoint(e[l].geometry.coordinates),d=this.getProperty("icon",n,e[l]),c=this.getProperty("width",s,e[l]),p=this.getProperty("height",o,e[l]),m=this.getProperty("angle",f,e[l]),g=this.getProperty("offsetZ",u,e[l]),x=this.normizedColor(this.getProperty("mixColor",v,e[l]));h&&d&&(this.cachedData.push({point:h,icon:d,width:c,height:p,offsetZ:g,angle:m,mixColor:x,index:l}),this.iconHash.get(d)||this.iconHash.set(d,d))}e=Ci(this.iconHash.entries()).filter(function(y){return typeof y[1]=="string"}).map(function(y){var _=nt(y,2)[0];return new De(function(A,T){a.url2canvas(_,function(w){a.iconHash.set(_,w),A()})})}),De.all(e).then(function(y){a.buildSprite(t),a.webglLayer.render()})}},{key:"buildSprite",value:function(t){var e=t.padding,a=this.canvas,n=this.ctx,s=[],o=new Be,u=!0,f=!1,v=void 0;try{for(var l=er(this.iconHash),h;!(u=(h=l.next()).done);u=!0){var d=nt(h.value,2),c=d[1];if(typeof c!="string"){var p=c.width,m=c.height;s.push({w:p+e[0],h:m+e[0],width:p,height:m,key:d[0],icon:c})}}}catch(g){f=!0,v=g}finally{try{!u&&l.return&&l.return()}finally{if(f)throw v}}for(f=xe(s),u=0;u<s.length;u++)v=s[u],o.get(v.key)||o.set(v.key,v);for(u=oe(f.w),f=oe(f.h),a.width=u||1,a.height=f||1,n.save(),a=0;a<s.length;a++)v=s[a],n.drawImage(v.icon,v.x+e[0],v.y+e[1],v.width,v.height);n.restore(),this.loadTexture(),this.buildVertex(t,o,u,f)}},{key:"buildVertex",value:function(t,e,a,n){var s=t.enablePicked;t=t.enableColorMix;for(var o=[],u=[],f=[],v=[],l=[],h=0;h<this.cachedData.length;h++){var d=this.cachedData[h],c=d.point,p=d.width,m=d.height,g=d.offsetZ,x=d.angle,y=d.mixColor,_=d.index;if(d=e.get(d.icon)){p=p||d.icon.width,m=m||d.icon.height;var A=nt(c,3);c=A[0];var T=A[1];A=A[2];for(var w=0;4>w;w++)o.push(c,T,A),o.push(w),o.push(p,m),o.push(g),o.push(x*Math.PI/180);p=d.x/a,m=(d.x+d.w)/a,g=(d.y+d.h)/n,d=d.y/n,u.push(p,g,p,d,m,d,m,g),d=4*h,f.push(d,d+2,d+1,d,d+3,d+2),s&&(_=this.indexToRgb(_),v.push(_[0]/255,_[1]/255,_[2]/255),v.push(_[0]/255,_[1]/255,_[2]/255),v.push(_[0]/255,_[1]/255,_[2]/255),v.push(_[0]/255,_[1]/255,_[2]/255)),t&&(l.push.apply(l,Q(y)),l.push.apply(l,Q(y)),l.push.apply(l,Q(y)),l.push.apply(l,Q(y)))}}this.index=f,this.vertexBuffer.updateData(new Float32Array(o)),this.uvBuffer.updateData(new Float32Array(u)),this.indexBuffer.updateData(new Uint32Array(f)),s&&this.pickBuffer.updateData(new Float32Array(v)),t&&this.colorBuffer.updateData(new Float32Array(l))}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.iconHash&&this.texture){var e=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(e),this.setGLState({blend:!0,blendFunc:Zt(e,n.blend),polygonOffset:n.polygonOffset}),t=G(this.getCommonUniforms(t),{u_icon:this.texture,u_matrix:a,u_unit_px:n.unit==="px",u_zoom_units:this.map.getZoomUnits(),u_scale:n.scale}),n.enableColorMix&&(t=G(t,{u_mix_amount:n.mixAmount})),s.setUniforms(t),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"url2canvas",value:function(t,e){if((typeof t=="undefined"?"undefined":It(t))==="object")e(t);else{var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var n=a.width,s=a.height,o=document.createElement("canvas");o.width=n,o.height=s,o.getContext("2d").drawImage(a,0,0,n,s),e(o)},a.onerror=function(){var n=document.createElement("canvas");n.width=20,n.height=40;var s=n.getContext("2d");s.fillStyle="red",s.beginPath(),s.lineTo(0,0),s.lineTo(20,0),s.lineTo(10,40),s.closePath(),s.fill(),e(n)},a.src=t}}},{key:"loadTexture",value:function(){var t=this;this.canvas?yt(this.gl,this.canvas,function(e){t.texture=e}):this.texture=null}}]),i}(rt),Ef=function(r){function i(t){O(this,i);var e=X(this,(i.__proto__||U(i)).call(this,t));return t=e.getOptions(),e.shapeLayer=new bi({enablePicked:t.enablePicked}),e.lineLayer=new Jn,e.children=[e.shapeLayer,e.lineLayer],e}return W(i,r),z(i,[{key:"pick",value:function(t,e){return this.shapeLayer.pick(t,e)}},{key:"onOptionsChanged",value:function(t){this.shapeLayer.setOptions({onClick:function(e){t.onClick&&t.onClick(e)},selectedIndex:t.selectedIndex,selectedColor:t.selectedColor,height:0,polygonOffset:[2,2],depthTest:t.depthTest,autoSelect:t.autoSelect,color:t.fillColor,opacity:t.fillOpacity,topColor:t.fillColor,useLight:!1,blend:t.blend}),this.lineLayer.setOptions({depthTest:t.depthTest,dashArray:t.dashArray,color:t.lineColor,width:t.lineWidth,lineJoin:t.lineJoin,blend:t.blend})}},{key:"onDataChanged",value:function(t){this.shapeLayer.setData(t),this.lineLayer.setData(t,{closePath:!0})}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ff0000",autoSelect:!0,dashArray:[0,0],lineColor:"rgba(250, 250, 25, 1)",depthTest:!0,lineWidth:2,lineJoin:"miter",fillColor:"rgba(25, 25, 250, 1)",fillOpacity:1,blend:"default"}}}]),i}(ve),lt=lt||{},Us=0,Jt=null,Cf=lt.Scene=function(r,i){this.name=i.name!==void 0?i.name:null,this.nodes=Array(i.nodes.length);for(var t=0,e=i.nodes.length;t<e;t++)this.nodes[t]=r.nodes[i.nodes[t]];this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null,this.boundingBox=null},pe=lt.BoundingBox=function(r,i,t){r=r||j.fromValues(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=i||j.fromValues(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),t===void 0||t===!0?(this.min=j.clone(r),this.max=j.clone(i)):(this.min=r,this.max=i),this.transform=b.create()};pe.prototype.updateBoundingBox=function(r){j.min(this.min,this.min,r.min),j.max(this.max,this.max,r.max)},pe.prototype.calculateTransform=function(){this.transform[0]=this.max[0]-this.min[0],this.transform[5]=this.max[1]-this.min[1],this.transform[10]=this.max[2]-this.min[2],this.transform[12]=this.min[0],this.transform[13]=this.min[1],this.transform[14]=this.min[2]},pe.getAABBFromOBB=function(){var r=j.create(),i=j.create(),t=j.create(),e=j.create(),a=j.create();return function(n,s){j.set(r,s[0],s[1],s[2]),j.set(i,s[4],s[5],s[6]),j.set(t,s[8],s[9],s[10]),s=j.fromValues(s[12],s[13],s[14]);var o=j.clone(s);return j.scale(e,r,n.min[0]),j.scale(a,r,n.max[0]),j.min(r,e,a),j.add(s,s,r),j.max(r,e,a),j.add(o,o,r),j.scale(e,i,n.min[1]),j.scale(a,i,n.max[1]),j.min(i,e,a),j.add(s,s,i),j.max(i,e,a),j.add(o,o,i),j.scale(e,t,n.min[2]),j.scale(a,t,n.max[2]),j.min(t,e,a),j.add(s,s,t),j.max(t,e,a),j.add(o,o,t),n=new pe(s,o,!1),n.calculateTransform(),n}}();var Ns=lt.Accessor=function(r,i){this.bufferView=i,this.componentType=r.componentType,this.byteOffset=r.byteOffset!==void 0?r.byteOffset:0,this.byteStride=i.byteStride,this.normalized=r.normalized!==void 0?r.normalized:!1,this.count=r.count,this.type=r.type,this.size=co[this.type],this.min=r.min,this.max=r.max,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null};Ns.prototype.prepareVertexAttrib=function(r,i){i.vertexAttribPointer(r,this.size,this.componentType,this.normalized,this.byteStride,this.byteOffset),i.enableVertexAttribArray(r)};var ho=lt.BufferView=function(r,i){this.byteLength=r.byteLength,this.byteOffset=r.byteOffset!==void 0?r.byteOffset:0,this.byteStride=r.byteStride!==void 0?r.byteStride:0,this.target=r.target!==void 0?r.target:null,this.data=i.slice(this.byteOffset,this.byteOffset+this.byteLength),this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null,this.buffer=null};ho.prototype.createBuffer=function(r){this.buffer=r.createBuffer()},ho.prototype.bindData=function(r){return this.target?(r.bindBuffer(this.target,this.buffer),r.bufferData(this.target,this.data,r.STATIC_DRAW),r.bindBuffer(this.target,null),!0):!1};var Rf=lt.Camera=function(r){this.name=r.name!==void 0?r.name:null,this.type=r.type,this.othographic=r.othographic===void 0?null:r.othographic,this.perspective=r.perspective===void 0?null:{yfov:r.perspective.yfov,znear:r.perspective.znear,zfar:r.perspective.zfar!==void 0?r.perspective.zfar:null,aspectRatio:r.perspective.aspectRatio!==void 0?r.perspective.aspectRatio:null},this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},hr=lt.Node=function(r,i){if(this.name=r.name!==void 0?r.name:null,this.nodeID=i,this.camera=r.camera!==void 0?r.camera:null,this.matrix=b.create(),r.hasOwnProperty("matrix")){for(i=0;16>i;++i)this.matrix[i]=r.matrix[i];this.translation=j.create(),b.getTranslation(this.translation,this.matrix),this.rotation=zi.create(),b.getRotation(this.rotation,this.matrix),this.scale=j.create(),b.getScaling(this.scale,this.matrix)}else this.getTransformMatrixFromTRS(r.translation,r.rotation,r.scale);this.children=r.children||[],this.mesh=r.mesh!==void 0?Jt.glTF.meshes[r.mesh]:null,this.skin=r.skin!==void 0?r.skin:null,r.extensions!==void 0&&r.extensions.gl_avatar!==void 0&&Jt.enableGLAvatar===!0&&(this.skin=new Of(Jt.glTF,Jt.skeletonGltf.skins[Jt.skeletonGltf.json.extensions.gl_avatar.skins[r.extensions.gl_avatar.skin.name]],r.extensions.gl_avatar.skin.inverseBindMatrices)),this.weights=r.weights!==void 0?r.weights:null,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null,this.aabb=null,this.bvh=new pe};hr.prototype.traverse=function(r,i){i(this,r),r=0;for(var t=this.children.length;r<t;r++)this.children[r].traverse(this,i)},hr.prototype.traversePostOrder=function(r,i){for(var t=0,e=this.children.length;t<e;t++)this.children[t].traversePostOrder(this,i);i(this,r)},hr.prototype.traverseTwoExecFun=function(r,i,t){i(this,r);for(var e=0,a=this.children.length;e<a;e++)this.children[e].traverseTwoExecFun(this,i,t);t(this,r)};var js=b.create();hr.prototype.getTransformMatrixFromTRS=function(r,i,t){this.translation=r!==void 0?j.fromValues(r[0],r[1],r[2]):j.fromValues(0,0,0),this.rotation=i!==void 0?ft.fromValues(i[0],i[1],i[2],i[3]):ft.fromValues(0,0,0,1),this.scale=t!==void 0?j.fromValues(t[0],t[1],t[2]):j.fromValues(1,1,1),this.updateMatrixFromTRS()},hr.prototype.updateMatrixFromTRS=function(){b.fromRotationTranslation(js,this.rotation,this.translation),b.scale(this.matrix,js,this.scale)};var Pf=lt.Mesh=function(r,i){this.meshID=i,this.name=r.name!==void 0?r.name:null,this.primitives=[],this.boundingBox=null,i=0;for(var t=r.primitives.length;i<t;++i){var e=r.primitives[i];e=new Sf(Jt.glTF,e),this.primitives.push(e),e.boundingBox&&(this.boundingBox||(this.boundingBox=new pe),this.boundingBox.updateBoundingBox(e.boundingBox))}this.boundingBox&&this.boundingBox.calculateTransform(),this.weights=r.weights!==void 0?r.weights:null,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},Sf=lt.Primitive=function(r,i){this.attributes=i.attributes,this.indices=i.indices!==void 0?i.indices:null;var t;if(i.extensions!==void 0&&i.extensions.gl_avatar!==void 0&&Jt.enableGLAvatar===!0&&i.extensions.gl_avatar.attributes)for(t in i.extensions.gl_avatar.attributes)this.attributes[t]=i.extensions.gl_avatar.attributes[t];this.indices!==null?(this.indicesComponentType=r.json.accessors[this.indices].componentType,this.indicesLength=r.json.accessors[this.indices].count,this.indicesOffset=r.json.accessors[this.indices].byteOffset||0):(this.drawArraysCount=r.json.accessors[this.attributes.POSITION].count,this.drawArraysOffset=r.json.accessors[this.attributes.POSITION].byteOffset||0);for(t in this.attributes)this.attributes[t]=r.accessors[this.attributes[t]];this.material=i.material!==void 0?r.materials[i.material]:null,this.mode=i.mode!==void 0?i.mode:4,this.targets=i.targets,this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null,this.boundingBox=this.shader=this.indexBuffer=this.vertexBuffer=this.vertexArray=null,this.attributes.POSITION!==void 0&&(r=this.attributes.POSITION,r.max&&r.type==="VEC3"&&(this.boundingBox=new pe(j.fromValues(r.min[0],r.min[1],r.min[2]),j.fromValues(r.max[0],r.max[1],r.max[2]),!1),this.boundingBox.calculateTransform()))},Hs=lt.Texture=function(r){this.name=r.name!==void 0?r.name:null,this.sampler=r.sampler!==void 0?Jt.glTF.samplers[r.sampler]:null,this.source=r.source!==void 0?Jt.glTF.images[r.source]:null,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null,this.texture=null};Hs.prototype.createTexture=function(r){this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this.source),r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null)};var Xs=lt.Sampler=function(r){this.name=r.name!==void 0?r.name:null,this.magFilter=r.magFilter!==void 0?r.magFilter:null,this.minFilter=r.minFilter!==void 0?r.minFilter:null,this.wrapS=r.wrapS!==void 0?r.wrapS:10497,this.wrapT=r.wrapT!==void 0?r.wrapT:10497,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null,this.sampler=null};Xs.prototype.createSampler=function(r){this.sampler=r.createSampler(),this.minFilter?r.samplerParameteri(this.sampler,r.TEXTURE_MIN_FILTER,this.minFilter):r.samplerParameteri(this.sampler,r.TEXTURE_MIN_FILTER,r.NEAREST_MIPMAP_LINEAR),this.magFilter?r.samplerParameteri(this.sampler,r.TEXTURE_MAG_FILTER,this.magFilter):r.samplerParameteri(this.sampler,r.TEXTURE_MAG_FILTER,r.LINEAR),r.samplerParameteri(this.sampler,r.TEXTURE_WRAP_S,this.wrapS),r.samplerParameteri(this.sampler,r.TEXTURE_WRAP_T,this.wrapT)};var fo=lt.TextureInfo=function(r){this.index=r.index,this.texCoord=r.texCoord!==void 0?r.texCoord:0,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},Ws=lt.PbrMetallicRoughness=function(r){this.baseColorFactor=r.baseColorFactor!==void 0?r.baseColorFactor:[1,1,1,1],this.baseColorTexture=r.baseColorTexture!==void 0?new fo(r.baseColorTexture):null,this.metallicFactor=r.metallicFactor!==void 0?r.metallicFactor:1,this.roughnessFactor=r.roughnessFactor!==void 0?r.roughnessFactor:1,this.metallicRoughnessTexture=r.metallicRoughnessTexture!==void 0?new fo(r.metallicRoughnessTexture):null,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},Lf=lt.NormalTextureInfo=function(r){this.index=r.index,this.texCoord=r.texCoord!==void 0?r.texCoord:0,this.scale=r.scale!==void 0?r.scale:1,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},Df=lt.OcclusionTextureInfo=function(r){this.index=r.index,this.texCoord=r.texCoord!==void 0?r.texCoord:0,this.strength=r.strength!==void 0?r.strength:1,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},Ff=lt.Material=function(r){this.name=r.name!==void 0?r.name:null,this.pbrMetallicRoughness=r.pbrMetallicRoughness!==void 0?new Ws(r.pbrMetallicRoughness):new Ws({baseColorFactor:[1,1,1,1],metallicFactor:1,metallicRoughnessTexture:1}),this.normalTexture=r.normalTexture!==void 0?new Lf(r.normalTexture):null,this.occlusionTexture=r.occlusionTexture!==void 0?new Df(r.occlusionTexture):null,this.emissiveTexture=r.emissiveTexture!==void 0?new fo(r.emissiveTexture):null,this.emissiveFactor=r.emissiveFactor!==void 0?r.emissiveFactor:[0,0,0],this.alphaMode=r.alphaMode!==void 0?r.alphaMode:"OPAQUE",this.alphaCutoff=r.alphaCutoff!==void 0?r.alphaCutoff:.5,this.doubleSided=r.doubleSided||!1,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},Bf=lt.Skin=function(r,i,t){this.name=i.name!==void 0?i.name:null,this.skinID=t,this.joints=Array(i.joints.length);var e;for(t=0,e=this.joints.length;t<e;t++)this.joints[t]=r.nodes[i.joints[t]];if(this.skeleton=i.skeleton!==void 0?r.nodes[i.skeleton]:null,this.inverseBindMatrices=i.inverseBindMatrices!==void 0?r.accessors[i.inverseBindMatrices]:null,this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null,this.uniformBlockID=Us++,this.inverseBindMatrices)for(this.inverseBindMatricesData=hi(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),t=0,e=this.inverseBindMatricesData.length;t<e;t+=16)this.inverseBindMatrix.push(b.fromValues(this.inverseBindMatricesData[t],this.inverseBindMatricesData[t+1],this.inverseBindMatricesData[t+2],this.inverseBindMatricesData[t+3],this.inverseBindMatricesData[t+4],this.inverseBindMatricesData[t+5],this.inverseBindMatricesData[t+6],this.inverseBindMatricesData[t+7],this.inverseBindMatricesData[t+8],this.inverseBindMatricesData[t+9],this.inverseBindMatricesData[t+10],this.inverseBindMatricesData[t+11],this.inverseBindMatricesData[t+12],this.inverseBindMatricesData[t+13],this.inverseBindMatricesData[t+14],this.inverseBindMatricesData[t+15]))},Of=lt.SkinLink=function(r,i,t){if(this.isLink=!0,r.skins||(r.skins=[]),r.skins.push(this),this.name=i.name,this.skinID=r.skins.length-1,this.joints=i.joints,this.skeleton=i.skeleton,this.inverseBindMatrices=t!==void 0?r.accessors[t]:null,this.uniformBlockID=Us++,this.inverseBindMatrices)for(this.inverseBindMatricesData=hi(this.inverseBindMatrices),this.inverseBindMatrix=[],this.jointMatrixUniformBuffer=null,this.jointMatrixUnidormBufferData=new Float32Array(1040),r=0,i=this.inverseBindMatricesData.length;r<i;r+=16)this.inverseBindMatrix.push(b.fromValues(this.inverseBindMatricesData[r],this.inverseBindMatricesData[r+1],this.inverseBindMatricesData[r+2],this.inverseBindMatricesData[r+3],this.inverseBindMatricesData[r+4],this.inverseBindMatricesData[r+5],this.inverseBindMatricesData[r+6],this.inverseBindMatricesData[r+7],this.inverseBindMatricesData[r+8],this.inverseBindMatricesData[r+9],this.inverseBindMatricesData[r+10],this.inverseBindMatricesData[r+11],this.inverseBindMatricesData[r+12],this.inverseBindMatricesData[r+13],this.inverseBindMatricesData[r+14],this.inverseBindMatricesData[r+15]))},zf=lt.Target=function(r){this.nodeID=r.node!==void 0?r.node:null,this.path=r.path,this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},If=lt.Channel=function(r,i){this.sampler=i.samplers[r.sampler],this.target=new zf(r.target),this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},Ys=lt.AnimationSampler=function(r,i){this.input=r.accessors[i.input],this.output=r.accessors[i.output],this.inputTypedArray=hi(this.input),this.outputTypedArray=hi(this.output),this.interpolation=i.interpolation!==void 0?i.interpolation:"LINEAR",this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null,this.curIdx=0,this.curValue=ft.create(),this.endT=this.inputTypedArray[this.inputTypedArray.length-1],this.inputMax=this.endT-this.inputTypedArray[0]},Zs=ft.create(),Vs=ft.create();Ys.prototype.getValue=function(r){r>this.endT&&(r-=this.inputMax*Math.ceil((r-this.endT)/this.inputMax),this.curIdx=0);for(var i=this.inputTypedArray.length;this.curIdx<=i-2&&r>=this.inputTypedArray[this.curIdx+1];)this.curIdx++;this.curIdx>=i-1&&(r-=this.inputMax,this.curIdx=0),i=co[this.output.type];var t=i===4?zi.slerp:ft.lerp,e=this.curIdx,a=e*i,n=a+i;for(r=Math.max(0,r-this.inputTypedArray[e])/(this.inputTypedArray[e+1]-this.inputTypedArray[e]),e=0;e<i;e++)Zs[e]=this.outputTypedArray[a+e],Vs[e]=this.outputTypedArray[n+e];switch(this.interpolation){case"LINEAR":t(this.curValue,Zs,Vs,r)}};var bf=lt.Animation=function(r,i){this.name=i.name!==void 0?i.name:null;var t;this.samplers=[];var e=0;for(t=i.samplers.length;e<t;e++)this.samplers[e]=new Ys(r,i.samplers[e]);for(this.channels=[],e=0,t=i.channels.length;e<t;e++)this.channels[e]=new If(i.channels[e],this);this.extensions=i.extensions!==void 0?i.extensions:null,this.extras=i.extras!==void 0?i.extras:null},kf=lt.glTFModel=function(r){this.json=r,this.defaultScene=r.scene!==void 0?r.scene:0,this.version=Number(r.asset.version),r.accessors&&(this.accessors=Array(r.accessors.length)),r.bufferViews&&(this.bufferViews=Array(r.bufferViews.length)),r.scenes&&(this.scenes=Array(r.scenes.length)),r.nodes&&(this.nodes=Array(r.nodes.length)),r.meshes&&(this.meshes=Array(r.meshes.length)),r.materials&&(this.materials=Array(r.materials.length)),r.textures&&(this.textures=Array(r.textures.length)),r.samplers&&(this.samplers=Array(r.samplers.length)),r.images&&(this.images=Array(r.images.length)),r.skins&&(this.skins=Array(r.skins.length)),r.animations&&(this.animations=Array(r.animations.length)),r.cameras&&(this.cameras=Array(r.cameras.length)),this.extensions=r.extensions!==void 0?r.extensions:null,this.extras=r.extras!==void 0?r.extras:null},fr=lt.glTFLoader=function(r){this._init(),this.glTF=null,this.enableGLAvatar=!1,this.linkSkeletonGltf=null};fr.prototype._init=function(){this._loadDone=!1,this._bufferLoaded=this._bufferRequested=0,this._buffers=[],this._bufferTasks={},this._finishedPendingTasks=this._pendingTasks=this._imageLoaded=this._imageRequested=this._shaderLoaded=this._shaderRequested=0,this.onload=null,Jt=this},fr.prototype._checkComplete=function(){this._bufferRequested==this._bufferLoaded&&this._imageRequested==this._imageLoaded&&(this._loadDone=!0),this._loadDone&&this._pendingTasks==this._finishedPendingTasks&&(this._postprocess(),this.onload(this.glTF))},fr.prototype.loadGLTF_GL_Avatar_Skin=function(r,i,t){this.enableGLAvatar=!0,this.skeletonGltf=i,this.loadGLTF(r,t)},fr.prototype.loadGLTF=function(r,i){this._init(),this.onload=i||function(e){},this.baseUri=fu(r);var t=this;cu(r,function(e){e=JSON.parse(e),t.glTF=new kf(e);var a,n=function(u){if(t._buffers[a]=u,t._bufferLoaded++,t._bufferTasks[a]){var f,v=0;for(f=t._bufferTasks[a].length;v<f;++v)t._bufferTasks[a][v](u)}t._checkComplete()};if(e.buffers)for(a in e.buffers){t._bufferRequested++;var s=e.buffers[a].uri;s.indexOf("base64")===-1&&(s=t.baseUri+s),du(s,n)}n=function(u,f){t._imageLoaded++,t.glTF.images[f]=u,t._checkComplete()};var o;if(e.images)for(o in e.images)t._imageRequested++,vu(t.baseUri+e.images[o].uri,o,n);t._checkComplete()})},fr.prototype._postprocess=function(){function r(v,l){var h=u[v.nodeID];l!==null?b.mul(h,u[l.nodeID],v.matrix):b.copy(h,v.matrix)}function i(v,l){var h=u[v.nodeID];l=l!==null?l.bvh:f.boundingBox,v.mesh&&(a=v.mesh,a.boundingBox&&(v.aabb=pe.getAABBFromOBB(a.boundingBox,h),v.children.length===0&&(j.copy(v.bvh.min,v.aabb.min),j.copy(v.bvh.max,v.aabb.max)))),j.min(l.min,l.min,v.bvh.min),j.max(l.max,l.max,v.bvh.max)}Jt=this;var t,e,a;if(this.glTF.cameras){var n=0;for(t=this.glTF.cameras.length;n<t;n++)this.glTF.cameras[n]=new Rf(this.glTF.json.cameras[n])}if(this.glTF.bufferViews)for(n=0,t=this.glTF.bufferViews.length;n<t;n++)this.glTF.bufferViews[n]=new ho(this.glTF.json.bufferViews[n],this._buffers[this.glTF.json.bufferViews[n].buffer]);if(this.glTF.accessors)for(n=0,t=this.glTF.accessors.length;n<t;n++)this.glTF.accessors[n]=new Ns(this.glTF.json.accessors[n],this.glTF.bufferViews[this.glTF.json.accessors[n].bufferView]);if(this.glTF.materials)for(n=0,t=this.glTF.materials.length;n<t;n++)this.glTF.materials[n]=new Ff(this.glTF.json.materials[n]);if(this.glTF.samplers)for(n=0,t=this.glTF.samplers.length;n<t;n++)this.glTF.samplers[n]=new Xs(this.glTF.json.samplers[n]);if(this.glTF.textures)for(n=0,t=this.glTF.textures.length;n<t;n++)this.glTF.textures[n]=new Hs(this.glTF.json.textures[n]);for(n=0,t=this.glTF.meshes.length;n<t;n++)this.glTF.meshes[n]=new Pf(this.glTF.json.meshes[n],n);for(n=0,t=this.glTF.nodes.length;n<t;n++)this.glTF.nodes[n]=new hr(this.glTF.json.nodes[n],n);for(n=0,t=this.glTF.nodes.length;n<t;n++){var s=this.glTF.nodes[n],o=0;for(e=s.children.length;o<e;o++)s.children[o]=this.glTF.nodes[s.children[o]]}var u=Array(this.glTF.nodes.length);for(n=0,t=u.length;n<t;n++)u[n]=b.create();for(n=0,t=this.glTF.scenes.length;n<t;n++){var f=this.glTF.scenes[n]=new Cf(this.glTF,this.glTF.json.scenes[n]);for(f.boundingBox=new pe,o=0,e=f.nodes.length;o<e;o++)s=f.nodes[o],s.traverseTwoExecFun(null,r,i);f.boundingBox.calculateTransform()}for(o=0,e=this.glTF.nodes.length;o<e;o++)s=this.glTF.nodes[o],s.bvh!==null&&s.bvh.calculateTransform();if(this.glTF.animations)for(n=0,t=this.glTF.animations.length;n<t;n++)this.glTF.animations[n]=new bf(this.glTF,this.glTF.json.animations[n]);if(this.glTF.json.skins)for(n=0,t=this.glTF.skins.length;n<t;n++)for(this.glTF.skins[n]=new Bf(this.glTF,this.glTF.json.skins[n],n),s=this.glTF.skins[n].joints,o=0,e=s.length;o<e;o++)s[o].jointID=o;for(n=0,t=this.glTF.nodes.length;n<t;n++)s=this.glTF.nodes[n],s.skin!==null&&typeof s.skin=="number"&&(s.skin=this.glTF.skins[s.skin])};var co={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gs=function(r){function i(t,e){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t,e))}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{scale:1}}},{key:"initialize",value:function(t){var e=this;this.gl=t;var a=this.getOptions();this.gltfObj=pu({gl:t,options:a}),new fr().loadGLTF(a.url,function(n){e.gltfObj.setupScene(n),e.webglLayer.render()})}},{key:"onChanged",value:function(t,e){}},{key:"render",value:function(t){var e=t.gl;t=t.matrix;var a=this.getData(),n=this.getOptions(),s=n.scale,o=[s,s,s];for(n.unit==="px"&&this.map&&(o=this.map.getZoomUnits(),o=[s*o,s*o,s*o]),s=0;s<a.length;s++){var u=a[s].geometry.coordinates;n=b.create();var f=b.create();u=this.normizedPoint(u),b.identity(n),b.translate(n,n,[u[0],u[1],u[2]]),b.rotateX(n,n,Math.PI/2),b.rotateY(n,n,(a[s].angle||0)*Math.PI/180),b.scale(n,n,o),b.mul(f,t,n),this.gltfObj.render({gl:e,matrix:f})}}}]),i}(rt),cr=cr||{};(function(){function r(t,e,a){return a=t.createShader(a),t.shaderSource(a,e),t.compileShader(a),a}cr.getShaderSource=function(t){return document.getElementById(t).textContent.replace(/^\s+|\s+$/g,"")},cr.createProgram=function(t,e,a){var n=t.createProgram();return e=r(t,e,t.VERTEX_SHADER),a=r(t,a,t.FRAGMENT_SHADER),t.attachShader(n,e),t.deleteShader(e),t.attachShader(n,a),t.deleteShader(a),t.linkProgram(n),t.getProgramInfoLog(n),t.getShaderInfoLog(e),t.getShaderInfoLog(a),n};var i=cr.loadImage=function(t,e){var a=new Image;return a.crossOrigin="Anonymous",a.src=t,a.onload=e,a};cr.loadImages=function(t,e){function a(){0>=--s&&e(n)}for(var n=[],s=t.length,o=0;o<s;++o)n.push(i(t[o],a))}})();var Uf=function(r){function i(t){O(this,i);var e=X(this,(i.__proto__||U(i)).call(this,t));return t=e.getOptions(),e.gltfLayer=new Gs({url:t.url,scale:t.scale}),e.children=[e.gltfLayer],e.autoUpdate=!0,e.index=[],e.newData=[],e.isStarted=t.autoPlay!==!1,e}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{url:"https://mapv-website.bj.bcebos.com/gl/examples/model/car.gltf",scale:1,step:1,defaultAngle:90}}},{key:"onOptionsChanged",value:function(t){this.gltfLayer.setOptions({})}},{key:"onDataChanged",value:function(t){var e=this;this.index=[],this.newData=[];for(var a=0;a<t.length;a++){this.index.push(0);var n=t[a].geometry.coordinates;t[a].geometry.type==="LineString"?this.newData.push(this._addPath(n)):n.forEach(function(s){e.newData.push(e._addPath(s))})}this.updatePoints()}},{key:"lnglatToMercator",value:function(t,e){return e=e*Math.PI/180,e=31890685e-1*Math.log((1+Math.sin(e))/(1-Math.sin(e))),[parseFloat((t*Math.PI/180*6378137).toFixed(2)),parseFloat(e.toFixed(2))]}},{key:"getDeg",value:function(t,e){-180<t[0]&&180>t[0]&&(t=this.lnglatToMercator(t[0],t[1]),e=this.lnglatToMercator(e[0],e[1]));var a=180*Math.atan((e[1]-t[1])/(e[0]-t[0]))/Math.PI;return e[0]>t[0]&&(a-=180),a}},{key:"getPoint",value:function(t,e,a){return[t[0]+(e[0]-t[0])*a,t[1]+(e[1]-t[1])*a,t[2]&&e[2]?t[2]+(e[2]-t[2])*a:0]}},{key:"updatePoints",value:function(){for(var t=this.getOptions(),e=this.newData,a=[],n=0;n<e.length;n++){for(var s=e[n],o=Math.floor(this.index[n]),u=o+1;s[u]&&s[u][0]===s[o][0]&&s[u][1]===s[o][1];)u++;u>=s.length-1&&(u=--o),u=this.getDeg(s[o],s[u]),a.push({geometry:{type:"Point",coordinates:this.getPoint(s[o],s[o+1],this.index[n]%1)},angle:u-t.defaultAngle})}this.pointData=a,this.gltfLayer.setData(a,{autoRender:!1})}},{key:"getCurrentPoint",value:function(){return this.pointData}},{key:"getDistance",value:function(t,e){var a=t[1]*Math.PI/180,n=e[1]*Math.PI/180;return t=2*Math.asin(Math.sqrt(Math.pow(Math.sin((a-n)/2),2)+Math.cos(a)*Math.cos(n)*Math.pow(Math.sin((t[0]*Math.PI/180-e[0]*Math.PI/180)/2),2))),t=Math.round(6378137e4*t)/1e4}},{key:"_addPath",value:function(t){for(var e=t.length,a=0,n=[],s=[],o=1;o<e;o++){var u=this.getDistance(t[o-1],t[o]);n.push(u),a+=u}for(u=[0],o=1;o<e;o++){var f=(n[o-1]/a).toFixed(2);u[o]=u[o-1]+parseFloat(f,10),s=s.concat(this._getPath(t[o-1],t[o],1e3*f))}return this._pathPercents=u,s}},{key:"_getPath",value:function(t,e,a){if(a===0)return[t];for(var n=[],s=0;s<=a;s++)n.push([(e[0]-t[0])/a*s+t[0],(e[1]-t[1])/a*s+t[1],e[2]&&t[2]?(e[2]-t[2])/a*s+t[2]:0]);return n}},{key:"start",value:function(){this.isStarted=!0}},{key:"stop",value:function(){this.isStarted=!1}},{key:"render",value:function(t){if(de(i.prototype.__proto__||U(i.prototype),"render",this).call(this,t),t=this.getOptions(),this.isStarted)for(var e=this.newData,a=0;a<this.index.length;a++)this.index[a]+=t.step,this.index[a]>e[a].length-2&&(this.index[a]=0);this.updatePoints()}}]),i}(ve),Nf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="BoardTextLayer",e=t.canvas=document.createElement("canvas"),e=t.ctx=e.getContext("2d"),e.textAlign="start",e.textBaseline="top",t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,collides:!0,unit:"px",angle:0,translateX:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],shadow:{},maxHeightLine:20,lineBreak:`
`}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new J(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uUnitPx;uniform float zoomUnits;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/mat3 rotateZ(float angle){float cos0=cos(angle);float sin0=sin(angle);return mat3(cos0,sin0,0.,-sin0,cos0,0.,0.,0.,1.);}vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;float z=coord.z;mat3 mat=rotateZ(rotation);vec3 rotated=vec3(size[0],0.0,size[1]);if(corner==1.0){rotated=mat*vec3(-size[0],0.0,size[1]);}else if(corner==2.0){rotated=mat*vec3(size[0],0.0,size[1]);}else if(corner==3.0){rotated=mat*vec3(size[0],0.0,-size[1]);}else{rotated=mat*vec3(-size[0],0.0,-size[1]);}x+=rotated.x;y+=rotated.y;z+=rotated.z;return vec3(x,y,z);}void main(){vTextCoord=aTextCoord;vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}",fragmentShader:`precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){vec4 textureColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));if(textureColor.a<=0.1&&uIsPickRender==false){discard;}gl_FragColor=textureColor;
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){this.cachedData=[];for(var a=0;a<e.length;a++){var n=this.normizedPoint(e[a].geometry.coordinates),s=e[a].text;"properties"in e[a]&&"text"in e[a].properties&&(s=e[a].properties.text);var o=this.getProperty("angle",t.angle,e[a]),u=this.getProperty("color",t.color,e[a]),f=this.getProperty("maxHeightLine",t.maxHeightLine,e[a]);n&&s!==void 0&&this.cachedData.push({point:n,text:s,angle:o,color:u,maxHeightLine:f,index:a})}}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:Zt(e,n.blend),polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();s.setUniforms(G(this.getCommonUniforms(t),{matrix:a,textureImage:this.texture,offset:n.offset,zoomUnits:o,zIndex:n.zIndex,uUnitPx:n.unit==="px"})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var e=t.gl,a=t.matrix,n=this.getOptions();t=n.fontSize;var s=n.fontFamily,o=n.translateX,u=n.padding,f=n.margin,v=n.collides,l=n.enablePicked,h=n.shadow;n=n.lineBreak;var d=e.canvas.width/window.devicePixelRatio,c=e.canvas.height/window.devicePixelRatio,p=this.canvas,m=this.ctx;m.save(),m.scale(window.devicePixelRatio,window.devicePixelRatio),m.textBaseline="top",m.font="normal bold 20px "+s;var g=new ar;e=[];for(var x=0;x<this.cachedData.length;x++){var y=this.cachedData[x],_=y.point,A=y.text,T=y.angle,w=y.index,E=y.color;y=y.maxHeightLine;var M=nt(_,3),P=ft.clone([M[0],M[1],M[2],1]);ft.transformMat4(P,P,a),ft.scale(P,P,1/P[3]),M=(P[0]+1)/2*d,P=(-P[1]+1)/2*c;var R=m.measureText(A),L=A.split(n),S=L.map(function(C){return m.measureText(C).width});S=Math.max.apply(Math,Q(S));for(var k=20,H=0;H<L.length-1;H++)k+=y;if(L=k,R=Math.min(R.width,S)+1,R+=2*u[0]+o,L+=2*u[1],k=R+f[0],S=L+f[1],M-=k/2,P-=S/2,k=M+k,S=P+S,!(0>k||0>S||M>d||P>c)){if(v){if(M={minX:M,maxX:k,minY:P,maxY:S},g.collides(M))continue;g.insert(M)}e.push({w:R,h:L,point:_,text:A,color:E,angle:T,maxHeightLine:y,dataIndex:w})}}for(m.restore(),a=[],f=[],v=[],d=[],g=xe(e),c=g.w,g=g.h,0>=c&&(c=1),0>=g&&(g=1),p.width=c*window.devicePixelRatio,p.height=g*window.devicePixelRatio,m.save(),m.scale(window.devicePixelRatio,window.devicePixelRatio),m.textBaseline="top",m.font="normal bold 20px "+s,m.shadowColor=h&&h.color,m.shadowOffsetX=h&&h.offsetX,m.shadowOffsetY=h&&h.offsetY,m.shadowBlur=h&&h.blur,s=0,h=e.length;s<h;++s){for(p=e[s],m.fillStyle=p.color,gu(m,p.text,p.x+u[0]+o,p.y+u[1],p.maxHeightLine,n),A=nt(p.point,3),x=A[0],_=A[1],A=A[2],T=0;4>T;T++)a.push(x,_,A),a.push(T),a.push(p.w,p.h),a.push(t/20,p.angle*Math.PI/180);x=p.x/c,_=(p.x+p.w)/c,A=(p.y+p.h)/g,T=p.y/g,f.push(x,A,x,T,_,T,_,A),x=4*s,v.push(x,x+2,x+1,x,x+3,x+2),l&&(p=this.indexToRgb(p.dataIndex),d.push(p[0]/255,p[1]/255,p[2]/255),d.push(p[0]/255,p[1]/255,p[2]/255),d.push(p[0]/255,p[1]/255,p[2]/255),d.push(p[0]/255,p[1]/255,p[2]/255))}m.restore(),this.loadTexture(),this.index=v,this.vertexBuffer.updateData(new Float32Array(a)),this.uvBuffer.updateData(new Float32Array(f)),this.indexBuffer.updateData(new Uint32Array(v)),l&&this.pickBuffer.updateData(new Float32Array(d))}},{key:"loadTexture",value:function(){var t=this;this.canvas?yt(this.gl,this.canvas,function(e){t.texture=e},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),i}(rt),jf=function(r){function i(t){O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.name="LabelLayer",t.pickedIndex=null;var e=t.canvas=document.createElement("canvas");return t.ctx=e.getContext("2d"),t.arrowHeight=8,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,textColor:"#0f0",borderColor:"#f00",backgroundColor:"#fff",pickedTextColor:"#fff",pickedBorderColor:"#666",pickedBackgroundColor:"#666",fontFamily:"Microsoft Yahei",fontSize:14,lineHeight:20,textAlign:"left",collides:!1,offset:[0,0],padding:[2,2],polygonOffset:[0,0],borderRadius:5}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new J(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x;y+=size.y;}else if(corner==2.0){x+=size.x;y+=size.y;}else if(corner==3.0){x+=size.x;y+=-size.y;}else{x+=-size.x;y+=-size.y;}return vec3(x,y+size.y,coord.z);}void main(){vTextCoord=aTextCoord;vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z+zIndex,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio;vec3 current=transformCoord(screen,halfSize,corner);gl_Position=vec4(current,1.0);}",fragmentShader:"precision highp float;uniform sampler2D textureImage;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));}",defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:24,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:24,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:24,type:"FLOAT",offset:16},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){for(this.cachedData=[],this.pickedIndex=null,t=0;t<e.length;t++){var a=e[t],n=this.normizedPoint(a.geometry.coordinates);n&&this.cachedData.push({point:n,item:a,index:t})}}},{key:"setPickedIndex",value:function(t,e){var a=this;e!=="onMousemove"?0<=t&&(this.pickedIndex=t,setTimeout(function(){a.webglLayer.render()})):this.pickedIndex=t}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(e),this.updateText(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();t=G(this.getCommonUniforms(t),{matrix:a,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,offset:n.offset,zoomUnits:o,zIndex:n.zIndex}),delete t.uSelectedColor,s.setUniforms(t),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"updateText",value:function(t){var e=this,a=t.gl,n=t.matrix,s=this.getOptions().enablePicked;t=this.canvas;var o=this.ctx;a=this.createMapbox(o,a,n),n=xe(a);var u=n.w,f=n.h;0>=u&&(u=1),0>=f&&(f=1),t.width=u*window.devicePixelRatio,t.height=f*window.devicePixelRatio;var v=[],l=[],h=[],d=[];a.forEach(function(c,p){e.drawItem(o,c);var m=nt(c.point,3),g=m[0],x=m[1];m=m[2];for(var y=0;4>y;y++)v.push(g,x,m),v.push(y),v.push(c.w,c.h);g=c.x/u,x=(c.x+c.w)/u,m=(c.y+c.h)/f,y=c.y/f,l.push(g,m,g,y,x,y,x,m),p*=4,h.push(p,p+2,p+1,p,p+3,p+2),s&&(c=e.indexToRgb(c.dataIndex),d.push(c[0]/255,c[1]/255,c[2]/255),d.push(c[0]/255,c[1]/255,c[2]/255),d.push(c[0]/255,c[1]/255,c[2]/255),d.push(c[0]/255,c[1]/255,c[2]/255))}),this.loadTexture(),this.index=h,this.vertexBuffer.updateData(new Float32Array(v)),this.uvBuffer.updateData(new Float32Array(l)),this.indexBuffer.updateData(new Uint32Array(h)),s&&this.pickBuffer.updateData(new Float32Array(d))}},{key:"createMapbox",value:function(t,e,a){function n(p){var m=p.point,g=p.item;p=p.index;var x=nt(m,3);x=ft.clone([x[0],x[1],x[2],1]),ft.transformMat4(x,x,a),ft.scale(x,x,1/x[3]);var y=(x[0]+1)/2*l,_=(-x[1]+1)/2*h;x=this.computeTextWH(g,t,u,v);var A=nt(x,2);x=A[0],A=A[1],y-=x/2,_-=A/2;var T=y+x,w=_+A;if(!(0>T||0>w||y>l||_>h)){if(f){if(y={minX:y,maxX:T,minY:_,maxY:w},d.collides(y))return;d.insert(y)}c.push({w:x,h:A+this.arrowHeight,point:m,item:g,dataIndex:p})}}var s=this,o=this.getOptions(),u=o.padding,f=o.collides,v=o.fontSize,l=e.canvas.width/window.devicePixelRatio,h=e.canvas.height/window.devicePixelRatio,d=new ar,c=[];return this.cachedData[this.pickedIndex]&&n.bind(this)(this.cachedData[this.pickedIndex]),this.cachedData.forEach(function(p){s.pickedIndex!==p.index&&n.bind(s)(p)}),c}},{key:"computeTextWH",value:function(t,e){var a=this.getOptions(),n=a.padding,s=a.fontSize,o=a.borderRadius,u=a.fontFamily;return a=a.lineHeight,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),e.font=s+"px "+u,t=t.properties.text.split(`
`),s=t.reduce(function(f,v){return f.length<v.length?v:f},""),s=e.measureText(s),e.restore(),[s.width+2*(n[1]+o),2*(n[0]+o)+a*t.length]}},{key:"drawItem",value:function(t,e){var a=this.getOptions(),n=a.padding,s=a.backgroundColor,o=a.textColor,u=a.fontSize,f=a.borderColor,v=a.borderRadius,l=a.fontFamily,h=a.lineHeight,d=a.textAlign,c=a.pickedTextColor,p=a.pickedBorderColor,m=a.pickedBackgroundColor,g=v-1,x=e.x,y=e.y;a=e.w;var _=e.h,A=e.item;e=e.dataIndex;var T="";It(A.properties)==="object"&&(T=A.properties.text||"",o=A.properties.textColor||o,f=A.properties.borderColor||f,s=A.properties.backgroundColor||s),this.pickedIndex===e&&(o=c,f=p,s=m),c=T.split(`
`),p=_-this.arrowHeight,t.save(),t.scale(window.devicePixelRatio,window.devicePixelRatio),t.textBaseline="top",t.font=u+"px "+l,t.translate(x,y),t.fillStyle=s,t.strokeStyle=f,t.beginPath(),t.arc(v,v,g,Math.PI,1.5*Math.PI),t.lineTo(a-v,1),t.arc(a-v,v,g,1.5*Math.PI,0),t.lineTo(a-1,p-v),t.arc(a-v,p-v,g,0*Math.PI,.5*Math.PI),t.lineTo(v,p-1),t.arc(v,p-v,g,.5*Math.PI,1*Math.PI),t.lineTo(1,v),t.closePath(),t.fill(),t.stroke(),t.beginPath(),s=this.arrowHeight,l=a/2,g=s/2,t.moveTo(l-g,p-1),t.lineTo(l+g,p-1),t.lineTo(l,p+.8*s),t.fillStyle=f,t.fill(),t.fillStyle=o;var w=d==="center"?l:d==="right"?a-v-n[1]:v+n[1];t.textAlign=d,c.forEach(function(E,M){t.fillText(E,w,v+n[0]+(M+.5)*h-.5*u)}),t.restore()}},{key:"loadTexture",value:function(){var t=this;this.canvas?yt(this.gl,this.canvas,function(e){t.texture=e},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),i}(rt);dt.prototype.parseColors=function(r){this.arrFeatureStyles=[[2,r[0]||"rgba(79,210,125,1)",2,2,0,[],0,0],[2,r[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,r[0]||"rgba(79,210,125,1)",3,2,0,[],0,0],[2,r[0]||"rgba(79,210,125,1)",5,2,0,[],0,0],[2,r[0]||"rgba(79,210,125,1)",6,2,0,[],0,0],[2,r[2]||"rgba(255,208,69,1)",2,2,0,[],0,0],[2,r[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,r[2]||"rgba(255,208,69,1)",3,2,0,[],0,0],[2,r[2]||"rgba(255,208,69,1)",5,2,0,[],0,0],[2,r[2]||"rgba(255,208,69,1)",6,2,0,[],0,0],[2,r[1]||"rgba(232,14,14,1)",2,2,0,[],0,0],[2,r[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,r[1]||"rgba(232,14,14,1)",3,2,0,[],0,0],[2,r[1]||"rgba(232,14,14,1)",5,2,0,[],0,0],[2,r[1]||"rgba(232,14,14,1)",6,2,0,[],0,0],[2,r[3]||"rgba(181,0,0,1)",2,2,0,[],0,0],[2,r[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,r[3]||"rgba(181,0,0,1)",3,2,0,[],0,0],[2,r[3]||"rgba(181,0,0,1)",5,2,0,[],0,0],[2,r[3]||"rgba(181,0,0,1)",6,2,0,[],0,0],[2,"rgba(255,255,255,1)",4,0,0,[],0,0],[2,"rgba(255,255,255,1)",5.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",7,0,0,[],0,0],[2,"rgba(255,255,255,1)",8.5,0,0,[],0,0],[2,"rgba(255,255,255,1)",10,0,0,[],0,0]]},dt.prototype.setColors=function(r){this.parseColors(r)},dt.prototype.initialize=function(r){this._initialize||(this._initialize=!0)},dt.prototype.clearCache=function(r){this.cache={}},dt.prototype.setMap=function(r){r?(this.map=r,this._initialize?this.canvaslayer.show():this.initialize(r)):this.canvaslayer.hide()},dt.prototype.draw=function(r){r=r||{},r.clearCache&&this.clearCache(),this.canvaslayer.draw()},dt.prototype.clear=function(){},dt.prototype.update=function(){var r=this.map,i=this.getDataZoom(),t=Math.pow(2,18-i),e=256*t,a=Lt.convertLL2MC(r.getCenter()),n=Math.ceil(a.lng/e),s=Math.ceil(a.lat/e),o=this.tileSize,u=i-Math.round(r.getZoom());for(0<u&&(o/=Math.pow(2,u)),e=[n,s,(a.lng-n*e)/e*o,(a.lat-s*e)/e*o],n=r.getBounds(),a=n.getNorthEast(),n=n.getSouthWest(),r.getSize(),r.getSize(),r=(a.lng-n.lng)/t,t=(a.lat-n.lat)/t,a=e[1]-Math.ceil((t/2-e[3])/o),n=e[0]+Math.ceil((r/2+e[2])/o),s=e[1]+Math.ceil((t/2+e[3])/o),t=[],o=e[0]-Math.ceil((r/2-e[2])/o);o<n;o++)for(e=a;e<s;e++)t.push([o,e,i]);for(this.tilesOrder=t,this._loadCount={},o=0;o<t.length;o++)e=t[o][0],r=t[o][1],this._loadCount[e+"_"+r+"_"+t[o][2]]=!1;for(o=0;o<t.length;o++)e=t[o][0],r=t[o][1],this.showTile(e,r,i)},dt.prototype.showTile=function(r,i,t){this._parseDataAndDraw(r,i,t)},dt.prototype.drawCurrentData=function(){this.clear();for(var r=[],i=0;i<this.tilesOrder.length;i++){var t=this.tilesOrder[i][0],e=this.tilesOrder[i][1],a=this.tilesOrder[i][2],n=this.cache[this.getCacheKey(t,e,a)];if(n)for(t=this._drawFeatures(n,t,e,a),e=0;e<t.length;e++)r.push(t[e])}this.lineLayer.setData(r)},dt.prototype.isAllLoaded=function(){var r=!0,i;for(i in this._loadCount)if(!this._loadCount[i]){r=!1;break}return r},dt.prototype.getCacheKey=function(r,i,t){return r+"_"+i+"_"+t},dt.prototype.getDataZoom=function(){var r=Math.round(this.map.getZoom());return 19<r&&(r=19),r},dt.prototype._parseDataAndDraw=function(r,i,t){var e=this,a=e.map,n=a.getCenter(),s=Math.round(a.getZoom()),o=this.getCacheKey(r,i,t),u="_cbk"+(1e5*Math.random()).toFixed(0),f=this.getTileUrl(r,i,t,"BMapGL."+u);BMapGL[u]=function(v){e._loadCount[r+"_"+i+"_"+t]=!0;var l=a.getCenter(),h=Math.round(a.getZoom());l.equals(n)&&h===s?(l=v.content&&v.content.tf,v.data&&(l=v.data),e.cache[o]=l?{traffic:l,precision:v.precision}:null,e.drawTogether&&e.isAllLoaded()&&e.drawCurrentData()):h!==s&&e.clear(),delete BMapGL[u]},e.cache[o]!==void 0?(e._loadCount[r+"_"+i+"_"+t]=!0,e.drawTogether&&e.isAllLoaded()&&e.drawCurrentData()):this.request(f)},dt.prototype.getTileUrl=function(r,i,t,e){return"https://sp3.baidu.com/7_AZsjOpB1gCo2Kml5_Y_DAcsMJiwa/traffic/?qt=vtraffic&x="+r+"&y="+i+"&z="+t+"&fn="+e+"&t="+new Date().getTime()},dt.prototype._drawFeatures=function(r,i,t,e){var a=10;e=Math.pow(2,18-e),this.map.getCenter();var n=this.tileSize;if(i=[i*n*e,(t+1)*n*e],t=[],r&&r.traffic){a*=r.precision,r=r.traffic,n=0;for(var s=r.length;n<s;n++){var o=r[n],u=o[1];o=this.arrFeatureStyles[o[3]];var f=u[0]/a,v=-u[1]/a,l=[];l.push([i[0]+f*e,i[1]+v*e,1]);for(var h=2,d=u.length;h<d;h+=2)f+=u[h]/a,v-=u[h+1]/a,l.push([i[0]+f*e,i[1]+v*e,1]);t.push({color:o[1],geometry:{type:"LineString",coordinates:l}})}}return t},dt.prototype.request=function(r,i){if(i){var t=(1e5*Math.random()).toFixed(0);BMapGL._rd["_cbk"+t]=function(a){i&&i(a),delete BMapGL._rd["_cbk"+t]},r+="&callback=BMapGL._rd._cbk"+t}var e=document.createElement("script");e.type="text/javascript",e.charset="utf-8",e.src=r,e.addEventListener?e.addEventListener("load",function(a){a=a.target,a.parentNode.removeChild(a)},!1):e.attachEvent&&e.attachEvent("onreadystatechange",function(a){a=window.event.srcElement,!a||a.readyState!=="loaded"&&a.readyState!=="complete"||a.parentNode.removeChild(a)}),setTimeout(function(){document.getElementsByTagName("head")[0].appendChild(e),e=null},1)},dt.prototype.getRGBA=function(r){return r>>>=0,"rgba("+(r>>24&255)+","+(r>>16&255)+","+(r>>8&255)+","+(r&255)/256+")"},dt.prototype.getLineCap=function(r){return["butt","square","round"][r]},dt.prototype.getLineJoin=function(r){return["miter","bevel","round"][r]};var Hf=function(r){function i(t){O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t)),t.autoUpdate=!0,t.getOptions();var e=new ks({color:"rgba(257, 254, 47, 0.9)",minZoom:18,duration:.8,interval:.2,trailLength:.4});return t.lineLayer=e,t.children=[e],t}return W(i,r),z(i,[{key:"initialize",value:function(t){de(i.prototype.__proto__||U(i.prototype),"initialize",this).call(this,t),t=this.map.map;var e=new dt({});e.lineLayer=this.lineLayer,this.trafficTileManager=e,e.setMap(t),e.update(),t.addEventListener("moveend",function(){e.update()}),t.addEventListener("zoomend",function(){e.update()}),t.addEventListener("ondraw",function(){})}},{key:"onOptionsChanged",value:function(t){}},{key:"onDataChanged",value:function(t){}},{key:"getDefaultOptions",value:function(){return{}}}]),i}(ve),Xf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="HeatmapLayer",t.bufferData=[],t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{size:13,unit:"px",height:0,max:100,min:0,opacity:1,blend:"normal"}}},{key:"initialize",value:function(t){var e=this;this.gl=t;var a=this.getOptions();this.inverseMatrix=b.create(Float64Array),this.frameBuffer=new Mt(t),this.webglLayer.map.onResize(function(){e.frameBuffer=new Mt(t)}),this.circle=mu(64),this.circleTexture=Ke(t,this.circle,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}).texture,this.intensity=new Rt({gradient:a.gradient}),this.paletteTexture=Ke(t,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}).texture,this.offlineProgram=new J(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform mat4 pointToPixelMatrix;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform int unit;uniform float size;uniform float max;uniform float min;attribute vec3 aPos;attribute vec2 aOffset;attribute float aCount;varying vec2 vOffset;varying float vCount;varying vec3 vPosition;void main(){vOffset=aOffset;vCount=(aCount-min)/(max-min);if(unit==1){vec2 pos=(pointToPixelMatrix*vec4(aPos.xy,0.0,1.0)).xy+aOffset.xy*size/2.0;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pos,0.0,1.0);}else{vec2 pos=aPos.xy+aOffset.xy*size;gl_Position=u_matrix*vec4(pos,0.0,1.0);}vPosition=vec3(gl_Position.z/gl_Position.w);}",fragmentShader:"varying vec2 vOffset;varying float vCount;varying vec3 vPosition;uniform sampler2D uCircle;void main(){vec4 circle=texture2D(uCircle,(vOffset+1.0)/2.0);float intensity=circle.a*vCount;if(intensity<=0.0){discard;}gl_FragColor=vec4(vPosition,intensity);}"},this),this.offlineBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineIndexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.offlineVertexArray=new ot({gl:t,program:this.offlineProgram,attributes:[{stride:24,name:"aPos",buffer:this.offlineBuffer,size:3,type:"FLOAT",offset:0},{stride:24,name:"aOffset",buffer:this.offlineBuffer,size:2,type:"FLOAT",offset:12},{stride:24,name:"aCount",buffer:this.offlineBuffer,size:1,type:"FLOAT",offset:20}]}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.program=new J(this.gl,{vertexShader:"attribute vec2 aPos;varying vec2 vPos;uniform float uHeight;uniform mat4 pixelToViewMatrix;uniform mat4 projectionMatrix;uniform sampler2D u_sampler;uniform mat4 inverseMatrix;void main(){vPos=aPos;if(uHeight<=0.0){gl_Position=vec4(aPos,0.0,1.0);}else{vec4 gray=texture2D(u_sampler,(aPos+1.0)/2.0);vec4 m0=inverseMatrix*vec4(aPos.xy,0.0,1.0);vec4 m1=inverseMatrix*vec4(aPos.xy,1.0,1.0);m0/=m0.w;m1/=m1.w;vec4 pixel=m0+(-m0.z/(m1.z-m0.z))*(m1-m0);pixel.z=uHeight*gray.a;gl_Position=projectionMatrix*pixelToViewMatrix*vec4(pixel.xyz,1.0);}}",fragmentShader:"uniform sampler2D u_sampler;uniform sampler2D u_samplerPalette;uniform float uHeight;uniform float opacity;varying vec2 vPos;void main(){vec4 gray=texture2D(u_sampler,(vPos+1.0)/2.0);float grayAlpha=gray.a;if(grayAlpha<=0.0){discard;}gl_FragColor=texture2D(u_samplerPalette,vec2(grayAlpha,1.0));float addAlpha=1.0;if(gray.a<0.3){addAlpha=gray.a*3.3;}gl_FragColor.a*=addAlpha;gl_FragColor.a*=opacity;}"},this),this.buffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new ot({gl:t,program:this.program,attributes:[{stride:8,name:"aPos",buffer:this.buffer,size:2,type:"FLOAT",offset:0}]}),a=[];for(var n=[],s=Math.floor(t.canvas.width/4),o=Math.floor(t.canvas.height/4),u=s+1,f=0;f<=o;f++)for(var v=0;v<=s;v++)if(a.push(2*v/s-1,2*f/o-1),v<s&&f<o){var l=u*f+v,h=u*(f+1)+v;n.push(l,l+1,h+1),n.push(l,h+1,h)}this.bufferData=a,this.buffer.updateData(new Float32Array(a)),this.indexData=n,this.indexBuffer.updateData(new Uint32Array(n))}},{key:"onDestroy",value:function(){this.bufferData=[]}},{key:"onOptionsChanged",value:function(t,e){var a=this.gl;a&&t.gradient!==e.gradient&&(this.intensity=new Rt({gradient:t.gradient}),this.paletteTexture=Ke(a,this.intensity.paletteCtx.canvas,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}).texture)}},{key:"onDataChanged",value:function(t){if(this.gl){var e=[],a=[];this.getOptions();for(var n=0;n<t.length;n++){var s=t[n],o=this.normizedPoint(t[n].geometry.coordinates),u=s.count===void 0?1:s.count;"properties"in s&&"count"in s.properties&&(u=s.properties.count),e.push(o[0],o[1],o[2]),e.push(-1,-1),e.push(u),e.push(o[0],o[1],o[2]),e.push(-1,1),e.push(u),e.push(o[0],o[1],o[2]),e.push(1,1),e.push(u),e.push(o[0],o[1],o[2]),e.push(1,-1),e.push(u),s=4*n,a.push(s+0,s+2,s+1),a.push(s+0,s+3,s+2)}this.offlineBufferData=e,this.offlineIndexData=a,this.offlineBuffer.updateData(new Float32Array(e)),this.offlineIndexBuffer.updateData(new Uint32Array(a))}}},{key:"render",value:function(t){var e=t.gl,a=t.matrix,n=t.pointToPixelMatrix,s=t.pixelToViewMatrix;if(t=t.projectionMatrix,this.offlineBufferData&&!(0>=this.offlineBufferData.length)){var o=this.getOptions();this.setGLState({blend:!0,blendFunc:[e.ONE,e.ONE],depthTest:!1}),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer.framebuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),this.offlineProgram.use(e),this.offlineProgram.setUniforms({u_matrix:a,uCircle:this.circleTexture,pointToPixelMatrix:n,pixelToViewMatrix:s,projectionMatrix:t,unit:o.unit==="px"?1:0,size:o.size,max:o.max,min:o.min}),this.offlineVertexArray.bind(),this.offlineIndexBuffer.bind(),e.drawElements(e.TRIANGLES,this.offlineIndexData.length,e.UNSIGNED_INT,0),e.bindFramebuffer(e.FRAMEBUFFER,null),this.program.use(e),this.vertexArray.bind(),a=this.inverseMatrix,b.identity(a),b.multiply(a,t,s),b.invert(a,a),this.setGLState({blend:!0,blendFunc:Zt(e,o.blend),depthTest:!!o.height}),this.program.setUniforms({u_sampler:this.frameBuffer.framebuffer.texture,u_samplerPalette:this.paletteTexture,uHeight:o.height,opacity:o.opacity,pixelToViewMatrix:s,inverseMatrix:a,projectionMatrix:t}),this.indexBuffer.bind(),e.drawElements(e.TRIANGLES,this.indexData.length,e.UNSIGNED_INT,0)}}}]),i}(rt),Wf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="BarLayer",t.selectedColor=[-1,-1,-1],t.textureCache={},t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{color:"rgba(0, 180, 0, 1.0)",edgeCount:4,unit:"m",height:1e5,type:"normal",size:5e4}}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions(),a={normal:[`attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aEdgeIndex;attribute float aPointIndex;attribute float aEdgeCount;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vEdgeIndex=aEdgeIndex;vEdgeCount=aEdgeCount;vPointIndex=aPointIndex;float z=aPos.z*uZoomUnits;float x=aPos.x;float y=aPos.y;vSize=aSize*uZoomUnits;float a=radians(360.0/aEdgeCount);float b=a/2.0;float r=vSize/cos(b);if(aEdgeIndex<0.0){float index=aPointIndex;float angle=0.0;if(mod(index,2.0)==0.0){angle=a*(index/2.0)-b;}else{angle=-a*((index-1.0)/2.0)-b;}y=y+r*sin(angle);x=x+r*cos(angle);}else{float i=aEdgeIndex-1.0;float j=aPointIndex;float angle=a*i+b;y=y+r*sin(angle);x=x+r*cos(angle);}vPosition=vec4(aPos,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;if(aEdgeIndex==1.0&&aPointIndex==1.0){gl_PointSize=20.0;}else{gl_PointSize=10.0;}
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,"varying vec4 vColor;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;varying vec4 vPosition;varying vec4 vFragPosition;uniform mat4 uMatrix;void main(){vec4 color=vColor;if(vEdgeIndex<0.0){color.r+=0.2;color.g+=0.2;color.b+=0.2;}else{float i=ceil(vEdgeIndex);;float d=i/vEdgeCount*0.5;if(i<=vEdgeCount/2.0){d=0.2*(i/vEdgeCount*0.5)-0.1;}else{d=0.2*(vEdgeCount-i)/vEdgeCount*0.5-0.1;}color.r+=d;color.g+=d;color.b+=d;}gl_FragColor=color;}"],light:[`attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;attribute float aEdgeIndex;attribute float aPointIndex;attribute float aEdgeCount;varying vec4 vColor;varying vec4 vPosition;varying vec4 vFragPosition;varying float vSize;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;uniform mat4 uMatrix;uniform float uZoomUnits;uniform vec4 uSelectedColor;void main(){vColor=aColor;vEdgeIndex=aEdgeIndex;vEdgeCount=aEdgeCount;vPointIndex=aPointIndex;float z=aPos.z*uZoomUnits;float x=aPos.x;float y=aPos.y;vSize=aSize*uZoomUnits;float a=radians(360.0/aEdgeCount);float b=a/2.0;float i=aEdgeIndex;float j=aPointIndex;float angle=a*(i-1.0)+b;float r=vSize/cos(b);y=y+r*sin(angle);x=x+r*cos(angle);if(j==1.0){z=0.0;}vPosition=vec4(aPos.xyz,1.0);vFragPosition=vec4(x,y,z,1.0);gl_Position=uMatrix*vFragPosition;
#if defined(PICK)
if(mapvIsPicked()){vColor=uSelectedColor;}
#endif
}`,"varying vec4 vColor;varying float vEdgeIndex;varying float vPointIndex;varying float vEdgeCount;varying vec4 vPosition;varying vec4 vFragPosition;uniform mat4 uMatrix;void main(){vec4 color=vColor;color.a=1.0-vFragPosition.z/vPosition.z;gl_FragColor=color;}"]};a=a[e.type]||a.normal,this.program=new J(this.gl,{vertexShader:a[0],fragmentShader:a[1],defines:e.enablePicked?["PICK"]:[]},this),this.buffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{stride:44,name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{stride:44,name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:12},{stride:44,name:"aEdgeIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:16},{stride:44,name:"aPointIndex",buffer:this.buffer,size:1,type:"FLOAT",offset:20},{stride:44,name:"aEdgeCount",buffer:this.buffer,size:1,type:"FLOAT",offset:24},{stride:44,name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:28}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onChanged",value:function(t,e){this.gl&&e&&(this.uniforms={},this.data=e,this.options=t,this.processData(),t.enablePicked&&this.parsePickData(e))}},{key:"processData",value:function(){var t=[],e=[];this.options.type==="light"?this.createLightBuffer(this.data,t,e):this.createNormalBuffer(this.data,t,e),this.bufferData=t,this.indexData=e,this.buffer.updateData(new Float32Array(t)),this.indexBuffer.updateData(new Uint32Array(e))}},{key:"createNormalBuffer",value:function(t,e,a){var n=this,s=parseInt(this.options.edgeCount,10)||4;t.forEach(function(o,u){var f=o.color||n.options.color,v=o.size||n.options.size,l=Array.isArray(o.value)?o.value:typeof o.value=="number"?[o.value]:[1],h=n.normizedPoint(o.geometry.coordinates),d=o.height||n.options.height,c=l.reduce(function(g,x){return Number(g)+Number(x)}),p=0,m="blue";for(l.forEach(function(g,x){m=n.normizedColor(typeof f=="function"?f(g,x,l):Array.isArray(f)?f[x]:f),g=typeof d=="function"?d(g,x,l):Array.isArray(d)?d[x]:d/c*g;var y=a[a.length-1],_=e.length/11;for(0<_&&(s%2===1&&x===0?a.push(y,y,_):a.push(y,_)),x=1;x<=2*s;x++)x%2===0?e.push.apply(e,[h[0],h[1],p,v,x/2,2,s].concat(Q(m))):e.push.apply(e,[h[0],h[1],p+g,v,(x+1)/2,1,s].concat(Q(m))),a.push(_+x-1),x===2*s&&(e.push.apply(e,[h[0],h[1],p+g,v,x/2+1,1,s].concat(Q(m))),e.push.apply(e,[h[0],h[1],p,v,x/2+1,2,s].concat(Q(m))),a.push(_+x,_+x+1));p+=g}),u=a[a.length-1],o=e.length/11,0<o&&a.push(u,o),u=1;u<=s;u++)e.push.apply(e,[h[0],h[1],p,v,-1,u,s].concat(Q(m))),a.push(o+u-1)})}},{key:"createLightBuffer",value:function(t,e,a){var n=this,s=parseInt(this.options.edgeCount,10)||4;t.forEach(function(o,u){u=o.color||n.options.color,u=n.normizedColor(typeof u=="function"?u(o.value):typeof u=="string"?u:"blue");var f=o.size||n.options.size,v=n.normizedPoint(o.geometry.coordinates),l=o.height||n.options.height;for(l=typeof l=="function"?l(o.value):l,o=1;o<=s;o++){var h=a[a.length-1],d=e.length/11;for(0<d&&a.push(h,d),h=1;h<=2*s;h++)h%2===0?e.push.apply(e,[v[0],v[1],l,f,h/2,1,s].concat(Q(u))):e.push.apply(e,[v[0],v[1],l,f,(h+1)/2,2,s].concat(Q(u))),a.push(d+h-1),h===2*s&&a.push(d,d+1)}})}},{key:"render",value:function(t){var e=this.program,a=t.gl,n=t.matrix;this.setGLState({cullFace:this.options.type==="normal"}),e.use(a),this.vertexArray.bind(),this.indexBuffer.bind();var s=this.map.getZoomUnits();G(this.uniforms,this.getCommonUniforms(t),{uZoomUnits:this.options.unit==="px"?s:1,uMatrix:n}),e.setUniforms(this.uniforms),a.drawElements(a.TRIANGLE_STRIP,this.indexData.length,a.UNSIGNED_INT,0)}}]),i}(rt),Yf=function(r){function i(t){O(this,i);var e=X(this,(i.__proto__||U(i)).call(this,t));return t=e.getOptions(),e.fillPoint=new ei({enablePicked:t.enablePicked,autoSelect:t.autoSelect}),e.shadowPoint=new ei,e.textPoint=new Zr,e.children=[e.shadowPoint,e.fillPoint,e.textPoint],e}return W(i,r),z(i,[{key:"pick",value:function(t,e){return this.fillPoint.pick(t,e)}},{key:"onOptionsChanged",value:function(t){this.shadowPoint.setOptions({depthTest:!1,polygonOffset:[1,1],color:t.shadowColor,size:t.shadowSize,borderWidth:t.shadowBorderWidth,borderColor:t.shadowBorderColor}),this.fillPoint.setOptions({onClick:function(e){t.onClick&&t.onClick(e)},selectedIndex:t.selectedIndex,selectedColor:t.selectedColor,depthTest:!1,color:t.fillColor,size:t.fillSize,borderWidth:t.fillBorderWidth,borderColor:t.fillBorderColor}),this.textPoint.setOptions({collides:!1,polygonOffset:[-1,-1],color:t.fontColor,fontFamily:t.fontFamily,fontSize:t.fontSize})}},{key:"onDataChanged",value:function(t){var e=this,a=this.getOptions(),n=JSON.parse(Pr(t)).map(function(o){return o.properties.size=e.getProperty("shadowSize",a.shadowSize,o),o.properties.color=e.getProperty("shadowColor",a.shadowColor,o),o.properties.borderColor=e.getProperty("shadowBorderColor",a.shadowBorderColor,o),o.properties.borderWidth=e.getProperty("shadowBorderWidth",a.shadowBorderWidth,o),o}),s=JSON.parse(Pr(t)).map(function(o){return o.properties.size=e.getProperty("fillSize",a.fillSize,o),o.properties.color=e.getProperty("fillColor",a.fillColor,o),o.properties.borderColor=e.getProperty("fillBorderColor",a.fillBorderColor,o),o.properties.borderWidth=e.getProperty("fillBorderWidth",a.fillBorderWidth,o),o});this.shadowPoint.setData(n),this.fillPoint.setData(s),this.textPoint.setData(t)}},{key:"getProperty",value:function(t,e,a){return Object.prototype.toString.call(e)==="[object Function]"?e(a):(e=a[t]||e,"properties"in a&&t in a.properties&&(e=a.properties[t]),e)}},{key:"getDefaultOptions",value:function(){return{enablePicked:!1,selectedIndex:-1,selectedColor:"#ffff00",autoSelect:!0,fillColor:"rgba(255, 50, 10, 1)",fillSize:20,fillBorderColor:"#ffffff",fillBorderWidth:1.2,shadowColor:"rgba(255, 80, 110, 0.7)",shadowSize:40,shadowBorderColor:"rgba(255, 80, 110, 1)",shadowBorderWidth:1.2,fontSize:12,fontFamily:"Microsoft Yahei",fontColor:"#ffffff"}}}]),i}(ve),Zf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="MaskLayer",t.bufferData=[],t.indices=[],t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{blend:"deeper",color:"rgba(100, 100, 100, 0.6)",height:0,polygonOffset:[0,0],depthTest:!1,depthWrite:!1}}},{key:"initialize",value:function(t){this.gl=t,this.program=new J(this.gl,{vertexShader:"precision highp float;attribute vec2 a_position;uniform mat4 u_matrix;uniform float u_height;void main(){vec4 position=u_matrix*vec4(a_position.xy,u_height,1.0);gl_Position=position;}",fragmentShader:"precision highp float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}",defines:[]},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var e=[{stride:8,name:"a_position",buffer:this.vertexBuffer,size:2,type:"FLOAT",offset:0}];e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){this.bufferData=[],this.index=[]}},{key:"onChanged",value:function(t,e){var a=this;if(this.gl){t=[];for(var n=[],s=0;s<e.length;s++)if(e[s].geometry.coordinates){var o=[[this.normizedPoint([-180,-90]),this.normizedPoint([180,-90]),this.normizedPoint([180,90]),this.normizedPoint([-180,90])]],u=[];if(e[s].geometry.type==="LineString"&&(u=[e[s].geometry.coordinates.map(function(l){return a.normizedPoint(l)})]),e[s].geometry.type==="MultiPolygon")for(var f=e[s].geometry.coordinates,v=0;v<f.length;v++)u=u.concat(f[v].map(function(l){return l.map(function(h){return a.normizedPoint(h)})}));else for(f=0;f<e[s].geometry.coordinates.length;f++)u.push(e[s].geometry.coordinates[f].map(function(l){return a.normizedPoint(l)}));for(u=Dt.flatten(o.concat(u)),o=u.vertices,u=u.holes,f=[],v=0;v<o.length;v+=3)f.push(o[v+0],o[v+1]);this.parseBufferData(t,n,f,u)}this.bufferData=t,this.index=n,this.vertexBuffer.updateData(new Float32Array(t)),this.indexBuffer.updateData(new Uint32Array(n))}}},{key:"parseBufferData",value:function(t,e,a,n){var s=t.length/2;for(n=n&&n.length?Dt(a,n,2):Dt(a),t.push.apply(t,Q(a)),t=0;t<n.length;t++)e.push(n[t]+s)}},{key:"render",value:function(t){if(this.index&&this.index.length){var e=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(e),t=G(this.getCommonUniforms(t),{u_matrix:a,u_height:n.height,u_color:this.normizedColor(n.color)}),s.setUniforms(t),this.setGLState({blend:!0,blendFunc:Zt(e,n.blend),polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite}),this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)}}}]),i}(rt),Vf=function(r){function i(){return O(this,i),X(this,(i.__proto__||U(i)).apply(this,arguments))}return W(i,r),z(i,[{key:"toBBox",value:function(t){var e=nt(t.item.geometry.coordinates,2);return t=e[0],e=e[1],{minX:t,minY:e,maxX:t,maxY:e}}},{key:"compareMinX",value:function(t,e){return t.item.geometry.coordinates[0]-e.item.geometry.coordinates[0]}},{key:"compareMinY",value:function(t,e){return t.item.geometry.coordinates[1]-e.item.geometry.coordinates[1]}}]),i}(ar),Gf=function(r){function i(t,e){return O(this,i),t=X(this,(i.__proto__||U(i)).call(this,t,e)),t.name="PointCanvasCustomLayer",e=t.canvas=document.createElement("canvas"),t.ctx=e.getContext("2d"),t.geoRBush=new Vf,t}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{depthWrite:!1,depthTest:!0,color:"#fff",fontFamily:"Microsoft Yahei",fontSize:14,flat:!1,collides:!0,unit:"px",angle:0,offset:[0,0],padding:[2,2],margin:[0,0],polygonOffset:[0,0],itemDimension:[20,20],renderItem:this.defaultOptionRenderItem}}},{key:"defaultOptionRenderItem",value:function(t,e,a){a.fillStyle="red",a.fillRect(e.x,e.y,e.w,e.h)}},{key:"initialize",value:function(t){this.gl=t;var e=this.getOptions();this.texture=null,this.lastUpdateTime=0,this.program=new J(this.gl,{vertexShader:"precision highp float;uniform mat4 matrix;uniform bool uFlat;uniform bool uUnitPx;uniform float zoomUnits;uniform float devicePixelRatio;uniform float zIndex;uniform vec2 offset;attribute vec3 position;attribute float corner;attribute float scale;attribute float rotation;attribute vec2 size;attribute vec2 aTextCoord;varying vec2 vTextCoord;/***\u70B9A(x,y)\uFF0C\u7ED5\u539F\u70B9\u987A\u65F6\u9488\u65CB\u8F6C\u89D2\u5EA6a\u65B0\u5750\u6807\u7684\u8BA1\u7B97\u516C\u5F0F*x1=x*cos(a)+y*sin(a)*y1=y*cos(a)-x*sin(a)*/vec3 transformCoord(vec3 coord,vec2 size,float corner){float x=coord.x;float y=coord.y;if(corner==1.0){x+=-size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)+size.x*sin(rotation);}else if(corner==2.0){x+=size.x*cos(rotation)+size.y*sin(rotation);y+=size.y*cos(rotation)-size.x*sin(rotation);}else if(corner==3.0){x+=size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)-size.x*sin(rotation);}else{x+=-size.x*cos(rotation)-size.y*sin(rotation);y+=-size.y*cos(rotation)+size.x*sin(rotation);}return vec3(x,y,coord.z);}void main(){vTextCoord=aTextCoord;if(uFlat){vec2 pixelOffset=offset;vec2 halfSize=size/2.0*scale;if(uUnitPx){halfSize*=zoomUnits;pixelOffset*=zoomUnits;}vec3 current=transformCoord(position,halfSize,corner);current.z+=zIndex;gl_Position=matrix*vec4(current.x+pixelOffset[0],current.y-pixelOffset[1],current.z,1.0);}else{vec2 pixelOffset=offset*zoomUnits;vec4 projection=matrix*vec4(position.x+pixelOffset[0],position.y-pixelOffset[1],position.z,1.0);vec3 screen=projection.xyz/projection.w;vec2 halfSize=size/MAPV_resolution*devicePixelRatio*scale;vec3 current=transformCoord(screen,halfSize,corner);current.z+=zIndex;gl_Position=vec4(current,1.0);}}",fragmentShader:`precision highp float;uniform sampler2D textureImage;uniform vec4 uSelectedColor;varying vec2 vTextCoord;void main(){gl_FragColor=texture2D(textureImage,vec2(vTextCoord.x,1.0-vTextCoord.y));
#if defined(PICK)
if(mapvIsPicked()){gl_FragColor=vec4(uSelectedColor.rgb,gl_FragColor.a);}
#endif
}`,defines:e.enablePicked?["PICK"]:[]},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.uvBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),e=[{name:"position",buffer:this.vertexBuffer,size:3,stride:32,type:"FLOAT",offset:0},{name:"corner",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:12},{name:"size",buffer:this.vertexBuffer,size:2,stride:32,type:"FLOAT",offset:16},{name:"scale",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:24},{name:"rotation",buffer:this.vertexBuffer,size:1,stride:32,type:"FLOAT",offset:28},{name:"aTextCoord",buffer:this.uvBuffer,size:2,stride:8,type:"FLOAT",offset:0}],e=e.concat(this.getCommonAttributes()),this.vertexArray=new ot({gl:t,program:this.program,attributes:e})}},{key:"onDestroy",value:function(){}},{key:"onChanged",value:function(t,e){this.gl&&this.processCache(t,e)}},{key:"processCache",value:function(t,e){for(this.cachedData=[],this.geoRBush.clear(),t=0;t<e.length;t++){var a=e[t],n=this.normizedPoint(a.geometry.coordinates);n&&this.cachedData.push({point:n,item:a,extra:{},index:t})}this.geoRBush.load(this.cachedData)}},{key:"render",value:function(t){if(this.cachedData&&this.cachedData.length&&this.map){var e=t.gl,a=t.matrix,n=this.getOptions(),s=this.program;s.use(e),this.throttleUpdate(t),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],polygonOffset:n.polygonOffset,depthTest:n.depthTest,depthMask:n.depthWrite});var o=this.map.getZoomUnits();s.setUniforms(G(this.getCommonUniforms(t),{matrix:a,devicePixelRatio:window.devicePixelRatio,textureImage:this.texture,uFlat:n.flat,offset:n.offset,zoomUnits:o,zIndex:n.zIndex,uUnitPx:n.unit==="px"})),0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0))}}},{key:"throttleUpdate",value:function(t){this.updateText(t)}},{key:"updateText",value:function(t){var e=t.gl,a=t.matrix,n=this.getOptions(),s=n.padding,o=n.margin,u=n.collides;t=n.enablePicked;var f=n.itemDimension,v=n.beforeRenderAll,l=n.beforeComputeDimension;n=n.renderItem;var h=this.map.getBounds(),d=e.canvas.width/window.devicePixelRatio,c=e.canvas.height/window.devicePixelRatio,p=this.canvas;e=this.ctx,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),l&&l(e),h=this.geoRBush.search({minX:h.sw.lng,minY:h.sw.lat,maxX:h.ne.lng,maxY:h.ne.lat});var m=new ar;l=[];for(var g=0;g<h.length;g++){var x=h[g],y=x.point,_=x.item,A=x.extra;x=x.index;var T=nt(y,3);T=ft.clone([T[0],T[1],T[2],1]),ft.transformMat4(T,T,a),ft.scale(T,T,1/T[3]);var w=(T[0]+1)/2*d,E=(-T[1]+1)/2*c,M=Array.isArray(f)?f:f(_,e,A);T=M[0]+2*s[0],M=M[1]+2*s[1];var P=T+o[0],R=M+o[1];if(w-=P/2,E-=R/2,P=w+P,R=E+R,!(0>P||0>R||w>d||E>c)){if(u){if(R={minX:w,maxX:P,minY:E,maxY:R},m.collides(R))continue;m.insert(R)}l.push({w:T,h:M,point:y,item:_,extra:A,dataIndex:x})}}for(e.restore(),s=xe(l),a=s.w,s=s.h,0>=a&&(a=1),0>=s&&(s=1),p.width=a*window.devicePixelRatio,p.height=s*window.devicePixelRatio,e.save(),e.scale(window.devicePixelRatio,window.devicePixelRatio),v&&v(e),v=[],p=[],o=[],u=[],f=0,d=l.length;f<d;++f){for(c=l[f],n(c.item,c,e,c.extra),g=nt(c.point,3),h=g[0],m=g[1],g=g[2],y=0;4>y;y++)v.push(h,m,g),v.push(y),v.push(c.w,c.h),v.push(1,0);h=c.x/a,m=(c.x+c.w)/a,g=(c.y+c.h)/s,y=c.y/s,p.push(h,g,h,y,m,y,m,g),h=4*f,o.push(h,h+2,h+1,h,h+3,h+2),t&&(c=this.indexToRgb(c.dataIndex),u.push(c[0]/255,c[1]/255,c[2]/255),u.push(c[0]/255,c[1]/255,c[2]/255),u.push(c[0]/255,c[1]/255,c[2]/255),u.push(c[0]/255,c[1]/255,c[2]/255))}e.restore(),this.loadTexture(),this.index=o,this.vertexBuffer.updateData(new Float32Array(v)),this.uvBuffer.updateData(new Float32Array(p)),this.indexBuffer.updateData(new Uint32Array(o)),t&&this.pickBuffer.updateData(new Float32Array(u))}},{key:"loadTexture",value:function(){var t=this;this.canvas?yt(this.gl,this.canvas,function(e){t.texture=e},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}):this.texture=null}}]),i}(rt),Kf=function(){function r(i,t){O(this,r),this.name="Mask",this.webglLayer=i,this.options=t||{},this.bufferData=[],this.indices=[]}return z(r,[{key:"initialize",value:function(i){return this.gl=i,this.program=new J(this.gl,{vertexShader:"precision highp float;attribute vec2 a_position;uniform mat4 u_matrix;uniform float u_height;void main(){vec4 position=u_matrix*vec4(a_position.xy,u_height,1.0);gl_Position=position;}",fragmentShader:"precision highp float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}",defines:[]},this),this.vertexBuffer=new I({gl:i,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:i,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new ot({gl:i,program:this.program,attributes:[{stride:8,name:"a_position",buffer:this.vertexBuffer,size:2,type:"FLOAT",offset:0}]}),this}},{key:"onDestroy",value:function(){this.bufferData=[],this.index=[]}},{key:"setData",value:function(i){var t=this;if(this.gl){for(var e=[],a=[],n=0;n<i.length;n++)if(i[n].geometry.coordinates){var s=[];if(i[n].geometry.type==="LineString"&&(s=[i[n].geometry.coordinates.map(function(v){return t.normizedPoint(v)})]),i[n].geometry.type==="MultiPolygon")for(var o=i[n].geometry.coordinates,u=0;u<o.length;u++)s=s.concat(o[u].map(function(v){return v.map(function(l){return t.normizedPoint(l)})}));else for(o=0;o<i[n].geometry.coordinates.length;o++)s.push(i[n].geometry.coordinates[o].map(function(v){return t.normizedPoint(v)}));o=Dt.flatten(s),s=o.vertices,o=o.holes,u=[];for(var f=0;f<s.length;f+=3)u.push(s[f+0],s[f+1]);this.parseBufferData(e,a,u,o)}return this.bufferData=e,this.index=a,this.vertexBuffer.updateData(new Float32Array(e)),this.indexBuffer.updateData(new Uint32Array(a)),this}}},{key:"parseBufferData",value:function(i,t,e,a){var n=i.length/2;for(a=a&&a.length?Dt(e,a,2):Dt(e),i.push.apply(i,Q(e)),i=0;i<a.length;i++)t.push(a[i]+n)}},{key:"render",value:function(i){if(this.index&&this.index.length){var t=i.gl,e=i.matrix,a=this.options;i=this.program,i.use(t),e={u_matrix:e,u_height:a.height||0,u_color:this.normizedColor(a.color)},i.setUniforms(e),this.indexBuffer.bind(),this.vertexArray.bind(),t.drawElements(t.TRIANGLES,this.index.length,t.UNSIGNED_INT,0)}}},{key:"normizedColor",value:function(i){var t=i;return i instanceof Array||(t=pt(i).unitArray()),t[3]===void 0&&(t[3]=1),t}},{key:"normizedPoint",value:function(i){var t=this.getPointOffset();if(!i||!i[0]||!i[1])return[t[0],t[1],0];var e=Number(i[0]),a=Number(i[1]);-180<=e&&180>=e&&-90<=a&&90>=a&&(a=this.webglLayer.map.lnglatToMercator(e,a),e=a[0],a=a[1]);var n=Number(i[2])||0;return this.webglLayer&&this.webglLayer.options.mapType==="cesium"&&window.Cesium?(e=this.convertLngLat([e,a]),n=window.Cesium.Cartesian3.fromDegrees(e[0],e[1],n),e=n.x,a=n.y,n=n.z):this.webglLayer&&this.webglLayer.options.mapType==="bmapgl"&&this.webglLayer.map.map.mapType==="B_EARTH_MAP"&&(e=this.convertLngLat([e,a]),n=this.webglLayer.map.map.getEarth().scene.fromLatLngToXYZ({lng:e[0],lat:e[1]}),e=n.x,a=n.y,n=n.z),3<i.length?[e-t[0],a-t[1],n].concat(Q(i.slice(3))):[e-t[0],a-t[1],n]}},{key:"convertLngLat",value:function(i){return[i[0]/2003750834e-2*180,180/Math.PI*(2*Math.atan(Math.exp(i[1]/2003750834e-2*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){var i=[0,0],t=this.options;return this.webglLayer&&this.webglLayer.options.pointOffset?i=this.webglLayer.options.pointOffset:t.pointOffset&&(i=t.pointOffset),i}}]),r}(),Qf=function(r){function i(t,e){return O(this,i),X(this,(i.__proto__||U(i)).call(this,t,e))}return W(i,r),z(i,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(t){var e=this.getOptions();if(e.source&&e.source.image&&e.domain&&(typeof e.source.image=="string"||e.source.width&&e.source.height)){var a=e.refColors,n=e.refImage;if((a||n)&&(!a||a.colors&&a.positions)&&(!n||typeof n.url=="string")){this.gl=t;var s=[];a?this.imageData=yo(a.colors,a.positions,a.clamp,a.color,a.height):(this.imageData={data:n.url},s.push("USE_IMAGE_TEXTURE"),this.imageTexture=!0),e.isTerrain&&(this.isTerrain=e.isTerrain,s.push("USE_TERRAIN"),this.gridRowMax=1600,e.gridRowMax&&(this.gridRowMax=e.gridRowMax),this.gridColMax=1600,e.gridColMax&&(this.gridColMax=e.gridColMax)),this.texture=null,a=`
        float generateValue(vec4 rgba){
            return rgba.r;
        }`,e.fomularC&&(a=e.fomularC),e=`precision highp float;attribute vec3 a_pos;attribute vec2 a_texture_coord;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform sampler2D uTile;uniform float u_baseLine;uniform float u_elevationScale;varying vec2 v_texture_coord;void main(){v_texture_coord=a_texture_coord;vec3 pos=a_pos.xyz;
#if defined(USE_TERRAIN)
vec4 terrainColor=texture2D(uTile,vec2(a_texture_coord.s,a_texture_coord.t));float value=generateValue(terrainColor);float h=(value-u_baseLine)*u_elevationScale;pos.z=max(0.,h);
#endif
vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;}`.replace("void main()",a+`
void main()`),a=`precision highp float;varying vec2 v_texture_coord;uniform sampler2D uTile;uniform sampler2D uColorRamp;uniform bool uUseFilter;uniform vec4 uFilterColor;uniform float u_opacity;uniform float u_noData;uniform vec3 u_noTextureData;uniform vec2 u_clamp;uniform vec2 u_domain;uniform vec3 u_linearOpacity;uniform bool u_isOneBand;uniform float u_brightness;uniform float u_contrast;uniform float u_exposure;uniform float u_saturation;vec4 indexToRgba(float value){float index=value;float b=floor(index/65536.);index-=b*65536.;float g=floor(index/256.);index-=g*256.;float r=index;return vec4(r,g,b,255.);}vec3 adjustBrightness(vec3 color,float value){return color+value;}vec3 adjustContrast(vec3 color,float value){return 0.5+(1.0+value)*(color-0.5);}vec3 adjustExposure(vec3 color,float value){return color*(1.0+value);}vec3 adjustSaturation(vec3 color,float value){const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);vec3 grayscale=vec3(dot(color,luminosityFactor));return mix(grayscale,color,1.0+value);}void main(){vec4 data=texture2D(uTile,vec2(v_texture_coord.s,v_texture_coord.t));float value=generateValue(data);vec4 textureColor=vec4(0,0,0,0);if(value>=u_clamp.s&&value<=u_clamp.t){float normalisedValue=(value-u_domain.s)/(u_domain.t-u_domain.s);
#if defined(USE_IMAGE_TEXTURE)
vec4 color=texture2D(uColorRamp,vec2(v_texture_coord.s,v_texture_coord.t));if(vec3(color.rgb)==u_noTextureData){color=vec4(0,0,0,0);}
#else
vec4 color=texture2D(uColorRamp,vec2(normalisedValue,0));
#endif
color.a=smoothstep(u_linearOpacity.s,u_linearOpacity.t,color.a*normalisedValue)+u_linearOpacity.p;textureColor=color;textureColor.a=textureColor.a*u_opacity;vec3 mixColor=adjustBrightness(textureColor.rgb,u_brightness);mixColor=adjustContrast(mixColor,u_contrast);mixColor=adjustExposure(mixColor,u_exposure);mixColor=adjustSaturation(mixColor,u_saturation);textureColor=vec4(mixColor,textureColor.a);if(uIsPickRender&&u_isOneBand){textureColor=indexToRgba(value)/255.;}if(uIsPickRender&&!u_isOneBand){textureColor=data;}}if(value==u_noData){textureColor=vec4(0,0,0,0);}if(uUseFilter){textureColor=textureColor*uFilterColor;}gl_FragColor=textureColor;}`.replace("void main()",a+`
void main()`),this.program=new J(this.gl,{vertexShader:e,fragmentShader:a,defines:s},this),this.vertexBuffer=new I({gl:t,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.indexBuffer=new I({gl:t,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"}),this.vertexArray=new ot({gl:t,program:this.program,attributes:[{name:"a_pos",buffer:this.vertexBuffer,stride:20,size:3,type:"FLOAT",offset:0},{name:"a_texture_coord",buffer:this.vertexBuffer,size:2,stride:20,type:"FLOAT",offset:12}]})}}}},{key:"onChanged",value:function(t,e){var a=this;this.gl&&(this.loadDataTexture&&clearTimeout(this.loadDataTexture),this.loadDataTexture=setTimeout(function(){a.loadTexture(function(){a.parseData(e),a.webglLayer.render()})},0))}},{key:"drawMask",value:function(t){var e=t.gl,a=t.matrix,n=t.projectionMatrix,s=t.viewMatrix;if(t=t.polygons){var o=new Kf(this.webglLayer,{color:"rgba(19, 14, 7, 0.8)"});this.setGLState({stencilTest:!0,depthTest:!1,depthMask:!1}),e.clear(e.STENCIL_BUFFER_BIT),e.stencilFunc(e.ALWAYS,1,255),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.colorMask(!1,!1,!1,!1),o.initialize(e).setData(t).render({gl:e,matrix:a,projectionMatrix:n,viewMatrix:s})}}},{key:"onOptionsChanged",value:function(t,e){this.gl&&(this.initialize(this.gl),this.loadTexture(),this.webglLayer.render())}},{key:"render",value:function(t){var e=t.gl,a=t.matrix,n=t.projectionMatrix,s=t.viewMatrix,o=t.isPickRender;t=this.getOptions();var u=this.program;(u||this.texture)&&(t.stencilData&&this.drawMask({gl:e,matrix:a,projectionMatrix:n,viewMatrix:s,polygons:t.stencilData}),this.setGLState({blend:!0,blendEquation:e.FUNC_ADD,blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA],stencilTest:!!t.stencilData,depthTest:t.depthTest,depthMask:t.depthMask}),u.use(e),t.stencilData&&(e.stencilFunc(e.EQUAL,1,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.colorMask(!0,!0,!0,!0)),this.colorRamp&&this.texture&&(a=[0,0,0],t.linearOpacity&&this.formaLinear(t.linearOpacity,a),n={uColorRamp:this.colorRamp,uTile:this.texture,u_proj_matrix:n,uUseFilter:!!t.filterColor,uFilterColor:this.normizedColor(t.filterColor||"rgba(0, 0, 100, 1.0)"),u_mv_matrix:s,uIsPickRender:!!o,u_noData:t.noData||-99999,u_domain:t.domain,u_clamp:t.clamp?t.clamp:t.domain,u_linearOpacity:a,u_opacity:t.opacity||1,u_isOneBand:!!this.isOneBand,u_brightness:t.brightness||0,u_contrast:t.contrast||0,u_exposure:t.exposure||0,u_saturation:t.saturation||0},this.isTerrain&&(n.u_baseLine=t.baseLine||0,n.u_elevationScale=t.elevationScale||1),this.imageTexture&&(n.u_noTextureData=t.baseLine||0),u.setUniforms(n),this.index&&0<this.index.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),e.drawElements(e.TRIANGLES,this.index.length,e.UNSIGNED_INT,0)),t.stencilData&&!t.stencilAfter&&(e.clear(e.STENCIL_BUFFER_BIT),e.stencilMask(255),e.stencilFunc(e.ALWAYS,1,255))))}},{key:"onDestroy",value:function(){this.texturePixels=this.texture=this.colorRamp=this.indexBuffer=this.vertexBuffer=this.index=this.program=null}},{key:"pickAfter",value:function(t,e){var a,n;return this.isOneBand?(e=a=n=e,t=1):(e=t[0],a=t[1],n=t[2],t=t[3]),this.getOptions().fomularJS?this.getOptions().fomularJS({r:e,g:a,b:n,a:t}):e}},{key:"formaLinear",value:function(t,e){t.start&&(e[0]=t.start||0),t.end&&(e[1]=t.end||0),t.base&&(e[2]=t.base||0)}},{key:"loadTexture",value:function(t){var e=this,a=this.getOptions();a.source.image&&this.imageData?yt(this.gl,this.imageData.data,function(n,s){e.colorRamp=n,It(a.source.image)==="object"?(e.isOneBand=!0,yt(e.gl,a.source.image,function(o,u,f){e.texture=o,e.texturePixels=f,e.textureWidth=f.width,e.textureHeight=f.height,t&&t(),e.webglLayer.render()},{TEXTURE_MIN_FILTER:"NEAREST",TEXTURE_MAG_FILTER:"NEAREST",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"},{width:a.source.width,height:a.source.height,format:"LUMINANCE",type:"FLOAT"})):(e.isOneBand=!1,yt(e.gl,a.source.image,function(o,u,f){e.texture=o,e.texturePixels=f,e.textureWidth=f.width,e.textureHeight=f.height,t&&t(),e.webglLayer.render()},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}))},{TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"},{width:this.imageData.width,height:this.imageData.height,flipY:!0,format:"RGBA",type:"UNSIGNED_BYTE"}):(this.texture=null,t&&t())}},{key:"parseData",value:function(t){var e=this;if(this.vertexBuffer){var a=[],n=[];if(t&&t[0]){var s=t[0].geometry.coordinates[0];s=s.map(function(m){return e.normizedPoint(m)}),t=s[0][0];var o=s[0][1],u=s[2][0],f=s[2][1];this.bound=[t,o,u,f],this.gridRowMax>this.textureHeight&&(this.gridRowMax=this.textureHeight),this.gridColMax>this.textureWidth&&(this.gridColMax=this.textureWidth),s=this.isTerrain?this.gridColMax:1;var v=this.isTerrain?this.gridRowMax:1,l=s+1;u=(u-t)/s,f=(f-o)/v;for(var h=0;h<=v;h++)for(var d=0;d<=s;d++)if(a.push(t+u*d,o+f*h,0),a.push(d/s,h/v),d<s&&h<v){var c=l*h+d,p=l*(h+1)+d;n.push(c,p+1,c+1),n.push(c,p,p+1)}}this.index=n,this.vertexBuffer.updateData(new Float32Array(a)),this.indexBuffer.updateData(new Uint32Array(n))}}},{key:"getValue",value:function(t,e){return this.isTerrain&&t&&this.bound&&(t=this.normizedPoint(t),this.containsPoint(t,this.bound)&&(t=this.uvPoint(t,this.bound),e=this.pixelByUV(t,e,this.getOptions().fomularJS),e.result))?e:0}},{key:"containsPoint",value:function(t,e){if(t)return t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}},{key:"uvPoint",value:function(t,e){if(t)return[(t[0]-e[0])/(e[2]-e[0]),(e[3]-t[1])/(e[3]-e[1])]}},{key:"pixelByUV",value:function(t,e,a){if(this.texturePixels){var n=this.texturePixels,s=n.width,o=n.height,u=n.data,f=Math.floor(t[0]*(s-1));t=Math.floor(t[1]*(o-1));var v=1;return n.type==="RGBA"&&(v=4),this._getPixelBound(f,t,e,s,o,u,v,a)}return null}},{key:"_getPixelBound",value:function(t,e,a,n,s,o,u,f){var v=t-a;0>v&&(v=0),t+=a,t>n-1&&(t=n-1);var l=e-a;0>l&&(l=0),e+=a,e>s-1&&(e=s-1),a=s=0;for(var h=[0,0,0,1],d=v;d<=t;d++)for(var c=l;c<=e;c++){var p=(c*n+d)*u,m=o[p],g=o[p+this.min(0,u-3)],x=o[p+this.min(0,u-2)];p=u===4?o[p+3]:1;var y=f?f({r:m,g,b:x,a:p}):m;y>s&&(s=y,h=[m,g,x,p]),a+=y}return{result:a/((t-v+1)*(e-l+1)),pixel:h,max:s}}},{key:"min",value:function(t,e){return e<t?t:e}}]),i}(rt);D.View=Zn,D.CanvasLayer=Bt,D.CircleLayer=function r(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return O(this,r),Sh.includes(i.type)?new Ph(i):new Rh(i)},D.GridLayer=ds,D.HeatGridLayer=Oh,D.ShapeLayer=bi,D.SimpleLineLayer=vs,D.LineLayer3D=bh,D.LineLayer=Jn,D.LineRainbowLayer=Uh,D.WallSpriteLayer=jh,D.LinePointLayer=Ve,D.WallLayer=lf,D.WallTripLayer=ff,D.HeatLineLayer=cf,D.HoneycombLayer=df,D.WebglLayer=ss,D.PointLayer=ei,D.GroundRippleLayer=vf,D.RippleLayer=pf,D.SparkLayer=gf,D.ClusterLayer=mf,D.HeatPointLayer=xf,D.ShapeLineLayer=yf,D.PointTripLayer=_f,D.LineTripLayer=Af,D.IconCollidesLayer=Tf,D.LineFlowLayer=ks,D.TileLayer=wf,D.IconLayer=Is,D.BoardLayer=Mf,D.PolygonLayer=Ef,D.CarLineLayer=Uf,D.Layer=rt,D.TextLayer=Zr,D.BoardTextLayer=Nf,D.LabelLayer=jf,D.TrafficLayer=Hf,D.GltfLayer=Gs,D.HeatmapLayer=Xf,D.BarLayer=Wf,D.MarkerListLayer=Yf,D.MaskLayer=Zf,D.PointCanvasCustomLayer=Gf,D.PixelLayer=Qf,D.FXAA=ph,D.SMAA=gh,D.BlurEffect=mh,D.BloomEffect=xh,D.BrightEffect=yh,D.DepthEffect=_h,D.EffectManager=as,D.getContext=xo,D.createTexture=Ke,D.loadTextureImage=yt,D.getBlend=Zt,D.FrameBufferObject=Mt,D.Program=J,D.StateManager=os,D.Buffer=I,D.VertexArray=ot,D.CommonLayer=Vn,D.MercatorProjection=Lt,D.Canvas=Qi,D.Intensity=Rt,D.BezierCurve=ae,D.GeodesicCurve=ge,D.OdCurve=Cl,D.utilCity={getProvinceNameByCityName:function(r){for(var i=0;i<Ne.length;i++)for(var t=Ne[i].n,e=Ne[i].cities,a=0;a<e.length;a++)if(e[a].n==r)return t;return null},getCenterByCityName:function(r){r=r.replace("\u5E02","");for(var i=0;i<Sn.length;i++)if(Sn[i].n==r)return ni(Sn[i].g);for(i=0;i<Ln.length;i++)if(Ln[i].n==r)return ni(Ln[i].g);for(i=0;i<Ne.length;i++){if(Ne[i].n==r)return ni(Ne[i].g);for(var t=Ne[i].cities,e=0;e<t.length;e++)if(t[e].n==r)return ni(t[e].g)}return null}},D.isMobile=ma,D.isIOSMobile=xa,D.Encryptor={encode:function(r){r=ts.deflateRaw(r);for(var i=[],t=0;t<r.length;t++)i.push(r[t]^23);return new Uint8Array(i)},decode:function(r){r=new Uint8Array(r);for(var i=[],t=0;t<r.length;t++)i.push(r[t]^23);r=new Uint8Array(i);try{var e=window.flate.deflate_decode_raw(r);return new TextDecoder("utf-8").decode(e)}catch(a){return console.warn("inflate by pako!"),ts.inflateRaw(r,{to:"string"})}},download:function(r,i){var t=new Blob([r],{type:"application/octet-binary"});r=document.createElement("a"),t=window.URL.createObjectURL(t),r.href=t,r.download=i||"mapvgl_download",r.click()}},D.createFusionView=function(r,i){var t=void 0,e=!1;r.addEventListener("glmoduleloaded",function(a){e||(e=!0,setTimeout(function(){t=new Zn({cameraNear:10,cameraFar:4e3,gl:r._webglPainter.gl,canvas:r._webglPainter.gl.canvas,autoUpdate:!1,map:r}),t.webglLayer.canvas.style.zIndex=1;var n=t.webglLayer.stateManager;r.insertRender=function(){n.setState({blend:!0,depthTest:!1}),t.render()},i&&i(t)},3e3))}),setTimeout(function(){if(!e&&r._webglMapScene&&r._webglPainter&&r._webglPainter.gl&&r._webglPainter.gl.canvas){e=!0,t=new Zn({cameraNear:10,cameraFar:4e3,gl:r._webglPainter.gl,canvas:r._webglPainter.gl.canvas,autoUpdate:!1,map:r}),t.webglLayer.canvas.style.zIndex=1;var a=t.webglLayer.stateManager;r.insertRender=function(){a.setState({blend:!0,depthTest:!1}),t.render()},i&&i(t)}},4e3)},D.toRadian=Et,D.toAngle=Yi,D.ceilPowerOfTwo=oe,D.floorPowerOfTwo=Zi,D.approximatelyEqual=Vi,D.isClosed=Gi,D.generateColorRamp=yo,D.__moduleExports=Wt,D.vec4=ft,D.vec3=j,D.vec2=q,D.quat2=lh,D.quat=zi,D.mat4=b,D.mat3=hh,D.mat2d=fh,D.mat2=ch,D.glMatrix=dh,Object.defineProperty(D,"__esModule",{value:!0})})})(Ks,Ks.exports);export{Ks as m};
